<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#000" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#000">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"tianfei92.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.23.2","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":false,"codeblock":{"theme":{"light":"atom-one-dark","dark":"atom-one-dark"},"prism":{"light":"prism-okaidia","dark":"prism-okaidia"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false,"highlight_theme":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="第一章：React 基础与核心概念1.1 React 简介与设计哲学（组件化、声明式 UI）基础概念概述React 是什么？ Facebook 推出的用于构建用户界面的 JavaScript 库，核心解决 UI 组件化开发问题。 两大设计哲学  组件化 (Component-Based)：将 UI 拆分为独立、可复用的代码单元（组件），每个组件管理自身状态与逻辑。示例：&lt;Button &#x2F;&amp;g">
<meta property="og:type" content="article">
<meta property="og:title" content="React 知识体系专题学习">
<meta property="og:url" content="https://tianfei92.github.io/2025/06/23/React%20Study%20Notes/index.html">
<meta property="og:site_name" content="Ariel&#39;s Blog">
<meta property="og:description" content="第一章：React 基础与核心概念1.1 React 简介与设计哲学（组件化、声明式 UI）基础概念概述React 是什么？ Facebook 推出的用于构建用户界面的 JavaScript 库，核心解决 UI 组件化开发问题。 两大设计哲学  组件化 (Component-Based)：将 UI 拆分为独立、可复用的代码单元（组件），每个组件管理自身状态与逻辑。示例：&lt;Button &#x2F;&amp;g">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-06-23T09:00:36.000Z">
<meta property="article:modified_time" content="2025-07-09T15:00:39.515Z">
<meta property="article:author" content="Ariel">
<meta property="article:tag" content="React">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://tianfei92.github.io/2025/06/23/React%20Study%20Notes/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://tianfei92.github.io/2025/06/23/React%20Study%20Notes/","path":"2025/06/23/React Study Notes/","title":"React 知识体系专题学习"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>React 知识体系专题学习 | Ariel's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.7.0/mermaid.min.js","integrity":"sha256-4+IKDqhZ/sXjc8Wtl2/MsxI4e0s1KpEVdbEP7V/Lz8U="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Ariel's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">我本地没问题啊</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9AReact-%E5%9F%BA%E7%A1%80%E4%B8%8E%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-text">第一章：React 基础与核心概念</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-React-%E7%AE%80%E4%BB%8B%E4%B8%8E%E8%AE%BE%E8%AE%A1%E5%93%B2%E5%AD%A6%EF%BC%88%E7%BB%84%E4%BB%B6%E5%8C%96%E3%80%81%E5%A3%B0%E6%98%8E%E5%BC%8F-UI%EF%BC%89"><span class="nav-text">1.1 React 简介与设计哲学（组件化、声明式 UI）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E6%A6%82%E8%BF%B0"><span class="nav-text">基础概念概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%B1%E5%85%A5%E5%8E%9F%E7%90%86%E4%B8%8E%E9%9D%A2%E8%AF%95%E8%80%83%E7%82%B9"><span class="nav-text">深入原理与面试考点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%A2%E8%AF%95%E8%AF%9D%E6%9C%AF%E6%8A%80%E5%B7%A7"><span class="nav-text">面试话术技巧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%B6%E4%BC%B8%E8%80%83%E7%82%B9"><span class="nav-text">延伸考点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-JSX-%E8%AF%AD%E6%B3%95%E4%B8%8E%E6%B8%B2%E6%9F%93%E9%80%BB%E8%BE%91%EF%BC%88%E8%A1%A8%E8%BE%BE%E5%BC%8F%E3%80%81%E6%9D%A1%E4%BB%B6%E6%B8%B2%E6%9F%93%E3%80%81%E5%88%97%E8%A1%A8%E6%B8%B2%E6%9F%93%EF%BC%89"><span class="nav-text">1.2 JSX 语法与渲染逻辑（表达式、条件渲染、列表渲染）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E7%AE%80%E8%BF%B0"><span class="nav-text">基础概念简述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6%E4%B8%8E%E6%B7%B1%E5%BA%A6%E5%8E%9F%E7%90%86"><span class="nav-text">核心机制与深度原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E7%A0%B4%E8%A7%A3%E6%8A%80%E5%B7%A7"><span class="nav-text">高频面试题与破解技巧</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E7%BB%84%E4%BB%B6%E5%9F%BA%E7%A1%80%EF%BC%88%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6-vs-%E7%B1%BB%E7%BB%84%E4%BB%B6%EF%BC%89"><span class="nav-text">1.3 组件基础（函数组件 vs. 类组件）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E6%A6%82%E8%BF%B0-1"><span class="nav-text">基础概念概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6%E4%B8%8E%E5%B7%AE%E5%BC%82%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">核心机制与差异深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E7%A0%B4%E8%A7%A3%E6%8A%80%E5%B7%A7-1"><span class="nav-text">高频面试题与破解技巧</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-Props-%E4%B8%8E-State%EF%BC%88%E6%95%B0%E6%8D%AE%E6%B5%81%E3%80%81%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%EF%BC%89"><span class="nav-text">1.4 Props 与 State（数据流、单向数据绑定）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E5%AF%B9%E6%AF%94%E8%A1%A8"><span class="nav-text">基础概念对比表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">核心机制深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%A1%88"><span class="nav-text">高频面试题与破解方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-text">高级应用场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%99%B7%E9%98%B1"><span class="nav-text">性能优化陷阱</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%EF%BC%88%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6%E3%80%81this-%E7%BB%91%E5%AE%9A%E9%97%AE%E9%A2%98%EF%BC%89"><span class="nav-text">1.5 事件处理（合成事件、this 绑定问题）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E6%A6%82%E8%BF%B0-2"><span class="nav-text">基础概念概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6%EF%BC%88SyntheticEvent%EF%BC%89%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">合成事件（SyntheticEvent）深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#this-%E7%BB%91%E5%AE%9A%E9%97%AE%E9%A2%98%E8%AF%A6%E8%A7%A3%EF%BC%88%E7%B1%BB%E7%BB%84%E4%BB%B6%EF%BC%89"><span class="nav-text">this 绑定问题详解（类组件）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">高频面试题与解决方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React-17-%E4%BA%8B%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%8D%87%E7%BA%A7"><span class="nav-text">React 17+ 事件系统升级</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9AReact-%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6"><span class="nav-text">第二章：React 核心机制</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E8%99%9A%E6%8B%9F-DOM-%E4%B8%8E-Diff-%E7%AE%97%E6%B3%95%EF%BC%88Reconciliation%EF%BC%89"><span class="nav-text">2.1 虚拟 DOM 与 Diff 算法（Reconciliation）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E6%A6%82%E8%BF%B0-3"><span class="nav-text">基础概念概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%99%9A%E6%8B%9F-DOM-%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86"><span class="nav-text">虚拟 DOM 核心原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Diff-%E7%AE%97%E6%B3%95%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%88O-n-%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5%EF%BC%89"><span class="nav-text">Diff 算法深度解析（O(n) 优化策略）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React-Fiber-%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%8F%AF%E4%B8%AD%E6%96%AD%E6%B8%B2%E6%9F%93"><span class="nav-text">React Fiber 架构与可中断渲染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%A1%88-1"><span class="nav-text">高频面试题与破解方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7"><span class="nav-text">性能优化技巧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React-18-%E5%B9%B6%E5%8F%91%E6%B8%B2%E6%9F%93%E4%BC%98%E5%8C%96"><span class="nav-text">React 18 并发渲染优化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%EF%BC%88%E7%B1%BB%E7%BB%84%E4%BB%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E3%80%81useEffect-%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88%EF%BC%89"><span class="nav-text">2.2 生命周期（类组件生命周期、useEffect 替代方案）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B1%BB%E7%BB%84%E4%BB%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%85%A8%E6%99%AF%E5%9B%BE"><span class="nav-text">类组件生命周期全景图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6-useEffect-%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88"><span class="nav-text">函数组件 useEffect 替代方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90-1"><span class="nav-text">核心机制深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%A1%88-2"><span class="nav-text">高频面试题与破解方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E8%BE%B9%E7%95%8C%EF%BC%88Error-Boundaries%EF%BC%89%E7%89%B9%E6%AE%8A%E8%AF%B4%E6%98%8E"><span class="nav-text">错误边界（Error Boundaries）特殊说明</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-%E5%8F%97%E6%8E%A7%E7%BB%84%E4%BB%B6-vs-%E9%9D%9E%E5%8F%97%E6%8E%A7%E7%BB%84%E4%BB%B6%EF%BC%88%E8%A1%A8%E5%8D%95%E5%A4%84%E7%90%86%EF%BC%89"><span class="nav-text">2.3 受控组件 vs. 非受控组件（表单处理）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%AF%B9%E6%AF%94"><span class="nav-text">核心概念对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%97%E6%8E%A7%E7%BB%84%E4%BB%B6%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">受控组件深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%9E%E5%8F%97%E6%8E%A7%E7%BB%84%E4%BB%B6%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">非受控组件深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%A1%88-3"><span class="nav-text">高频面试题与破解方案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1%EF%BC%88%E7%88%B6%E5%AD%90%E9%80%9A%E4%BF%A1%E3%80%81Context-API%E3%80%81%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF%EF%BC%89"><span class="nav-text">2.4 组件通信（父子通信、Context API、事件总线）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F%E5%85%A8%E6%99%AF%E5%9B%BE"><span class="nav-text">组件通信方式全景图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1%EF%BC%88Props-%E5%9B%9E%E8%B0%83%EF%BC%89"><span class="nav-text">父子组件通信（Props + 回调）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Context-API-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">Context API 深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF%EF%BC%88Event-Bus%EF%BC%89%E6%A8%A1%E5%BC%8F"><span class="nav-text">事件总线（Event Bus）模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E9%80%9A%E4%BF%A1%E6%A8%A1%E5%BC%8F"><span class="nav-text">高级通信模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%A1%88-4"><span class="nav-text">高频面试题与破解方案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-Refs-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%88DOM-%E6%93%8D%E4%BD%9C%E3%80%81forwardRef%EF%BC%89"><span class="nav-text">2.5 Refs 使用场景（DOM 操作、forwardRef）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Refs-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%85%A8%E6%99%AF%E5%9B%BE"><span class="nav-text">Refs 核心概念全景图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E5%A4%A7-Refs-%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F"><span class="nav-text">三大 Refs 创建方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">核心使用场景深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#forwardRef-%E8%BD%AC%E5%8F%91%E6%9C%BA%E5%88%B6"><span class="nav-text">forwardRef 转发机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useImperativeHandle-%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95"><span class="nav-text">useImperativeHandle 高级用法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%A1%88-5"><span class="nav-text">高频面试题与破解方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9ARefs-%E4%BD%BF%E7%94%A8%E5%86%B3%E7%AD%96"><span class="nav-text">总结：Refs 使用决策</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9AHooks-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">第三章：Hooks 深度解析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-useState-%E4%B8%8E%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86"><span class="nav-text">3.1 useState 与状态管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E6%A6%82%E8%BF%B0-4"><span class="nav-text">基础概念概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90-2"><span class="nav-text">核心机制深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E8%BF%9B%E9%98%B6%E6%A8%A1%E5%BC%8F"><span class="nav-text">状态管理进阶模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%A1%88-6"><span class="nav-text">高频面试题与破解方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7-1"><span class="nav-text">性能优化技巧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8E%E7%B1%BB%E7%BB%84%E4%BB%B6%E7%8A%B6%E6%80%81%E5%AF%B9%E6%AF%94"><span class="nav-text">与类组件状态对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React-18-%E6%96%B0%E7%89%B9%E6%80%A7%EF%BC%9A%E8%87%AA%E5%8A%A8%E6%89%B9%E5%A4%84%E7%90%86"><span class="nav-text">React 18 新特性：自动批处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-useEffect-%E4%B8%8E%E5%89%AF%E4%BD%9C%E7%94%A8%EF%BC%88%E4%BE%9D%E8%B5%96%E6%95%B0%E7%BB%84%E3%80%81%E6%B8%85%E7%90%86%E5%87%BD%E6%95%B0%EF%BC%89"><span class="nav-text">3.2 useEffect 与副作用（依赖数组、清理函数）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E6%A6%82%E8%BF%B0-5"><span class="nav-text">基础概念概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E6%95%B0%E7%BB%84%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">依赖数组深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%85%E7%90%86%E5%87%BD%E6%95%B0%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95"><span class="nav-text">清理函数高级用法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%A1%88-7"><span class="nav-text">高频面试题与破解方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-Hook-%E5%B0%81%E8%A3%85"><span class="nav-text">自定义 Hook 封装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-useContext-%E4%B8%8E%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E5%85%B1%E4%BA%AB"><span class="nav-text">3.3 useContext 与全局状态共享</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E6%A6%82%E8%BF%B0-6"><span class="nav-text">基础概念概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8A%E4%B8%8B%E6%96%87%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3"><span class="nav-text">上下文工作流程详解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8%E6%A8%A1%E5%BC%8F"><span class="nav-text">高级应用模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%A1%88-8"><span class="nav-text">高频面试题与破解方案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-useReducer-%E4%B8%8E%E5%A4%8D%E6%9D%82%E7%8A%B6%E6%80%81%E9%80%BB%E8%BE%91"><span class="nav-text">3.4 useReducer 与复杂状态逻辑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E6%A6%82%E8%BF%B0-7"><span class="nav-text">基础概念概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90-3"><span class="nav-text">核心机制深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8%E6%A8%A1%E5%BC%8F-1"><span class="nav-text">高级应用模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E6%9D%82%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%AE%9E%E6%88%98"><span class="nav-text">复杂状态管理实战</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%A1%88-9"><span class="nav-text">高频面试题与破解方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8E-Context-%E9%9B%86%E6%88%90"><span class="nav-text">与 Context 集成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93"><span class="nav-text">最佳实践总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E5%86%B3%E7%AD%96%E9%80%BB%E8%BE%91"><span class="nav-text">使用场景决策逻辑</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-5-%E8%87%AA%E5%AE%9A%E4%B9%89-Hooks%EF%BC%88%E5%B0%81%E8%A3%85%E5%8F%AF%E5%A4%8D%E7%94%A8%E9%80%BB%E8%BE%91%EF%BC%89"><span class="nav-text">3.5 自定义 Hooks（封装可复用逻辑）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E6%A6%82%E8%BF%B0-8"><span class="nav-text">基础概念概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90-4"><span class="nav-text">核心机制深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-text">设计模式与最佳实践</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%A1%88-10"><span class="nav-text">高频面试题与破解方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5%E6%A1%88%E4%BE%8B"><span class="nav-text">实践案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-Hook-%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="nav-text">自定义 Hook 设计原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89-Hook-%E4%BB%B7%E5%80%BC"><span class="nav-text">总结：自定义 Hook 价值</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-6-%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8-Hooks%EF%BC%88useMemo%E3%80%81useCallback%E3%80%81useRef%EF%BC%89"><span class="nav-text">3.6 其他常用 Hooks（useMemo、useCallback、useRef）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E5%A4%A7-Hook-%E5%BF%AB%E9%80%9F%E5%AF%B9%E6%AF%94"><span class="nav-text">三大 Hook 快速对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useMemo-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">useMemo 深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useCallback-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">useCallback 深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useRef-%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95%EF%BC%88%E8%A1%A5%E5%85%85-2-5-%E7%AB%A0%E8%8A%82%EF%BC%89"><span class="nav-text">useRef 高级用法（补充 2.5 章节）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%A1%88-11"><span class="nav-text">高频面试题与破解方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E4%BC%98%E5%8C%96%E6%A8%A1%E5%BC%8F"><span class="nav-text">高级优化模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%86%B3%E7%AD%96"><span class="nav-text">总结：性能优化决策</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9AReact-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7"><span class="nav-text">第四章：React 高级特性</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%EF%BC%88React-memo%E3%80%81useMemo%E3%80%81useCallback%EF%BC%89"><span class="nav-text">4.1 性能优化（React.memo、useMemo、useCallback）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%A0%B8%E5%BF%83%E5%8E%9F%E5%88%99"><span class="nav-text">性能优化核心原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83-API-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">核心 API 深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%BC%E5%90%88%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="nav-text">综合优化策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7"><span class="nav-text">性能分析工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">常见性能问题与解决方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%8E%9F%E5%88%99%E6%80%BB%E7%BB%93"><span class="nav-text">性能优化原则总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%A2%E8%AF%95%E9%AB%98%E9%A2%91%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E7%AD%94"><span class="nav-text">面试高频问题与解答</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-%E9%94%99%E8%AF%AF%E8%BE%B9%E7%95%8C%EF%BC%88ErrorBoundary%EF%BC%89"><span class="nav-text">4.2 错误边界（ErrorBoundary）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E8%BE%B9%E7%95%8C%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-text">错误边界核心概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E8%BE%B9%E7%95%8C%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6"><span class="nav-text">错误边界实现机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%81%E4%B8%9A%E7%BA%A7%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-text">企业级最佳实践</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%96%B9%E6%A1%88"><span class="nav-text">函数组件错误处理方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E5%9C%BA%E6%99%AF%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">常见错误场景与解决方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E8%BE%B9%E7%95%8C%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-text">错误边界最佳实践</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%A2%E8%AF%95%E9%AB%98%E9%A2%91%E9%97%AE%E9%A2%98%E8%A7%A3%E6%9E%90"><span class="nav-text">面试高频问题解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2%E4%B8%8E%E6%87%92%E5%8A%A0%E8%BD%BD%EF%BC%88React-lazy-Suspense%EF%BC%89"><span class="nav-text">4.3 代码分割与懒加载（React.lazy + Suspense）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-text">代码分割核心概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88"><span class="nav-text">基础实现方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="nav-text">高级优化策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E8%BF%9B%E9%98%B6%E6%8A%80%E5%B7%A7"><span class="nav-text">性能优化进阶技巧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">常见问题与解决方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-1"><span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-Portals%EF%BC%88%E6%B8%B2%E6%9F%93%E5%88%B0-DOM-%E5%A4%96%E9%83%A8%E8%8A%82%E7%82%B9%EF%BC%89"><span class="nav-text">4.4 Portals（渲染到 DOM 外部节点）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Portals-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-text">Portals 核心概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95%E4%B8%8EAPI"><span class="nav-text">基础用法与API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-text">核心应用场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7%E4%B8%8E%E6%A8%A1%E5%BC%8F"><span class="nav-text">高级特性与模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%81%E4%B8%9A%E7%BA%A7%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-1"><span class="nav-text">企业级最佳实践</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%A2%E8%AF%95%E9%AB%98%E9%A2%91%E9%97%AE%E9%A2%98%E8%A7%A3%E6%9E%90-1"><span class="nav-text">面试高频问题解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-2"><span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5-%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6%EF%BC%88HOC%EF%BC%89%E4%B8%8E-Render-Props"><span class="nav-text">4.5 高阶组件（HOC）与 Render Props</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E4%BB%B6%E5%A4%8D%E7%94%A8%E7%9A%84%E6%A0%B8%E5%BF%83%E6%8C%91%E6%88%98"><span class="nav-text">组件复用的核心挑战</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6%EF%BC%88HOC%EF%BC%89%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">高阶组件（HOC）深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Render-Props-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">Render Props 深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HOC-%E4%B8%8E-Render-Props-%E5%AF%B9%E6%AF%94"><span class="nav-text">HOC 与 Render Props 对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%81%E4%B8%9A%E7%BA%A7%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-2"><span class="nav-text">企业级最佳实践</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%B0%E4%BB%A3%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89-Hooks"><span class="nav-text">现代替代方案：自定义 Hooks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E9%80%89%E6%8B%A9%E6%8C%87%E5%8D%97"><span class="nav-text">设计模式选择指南</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%A2%E8%AF%95%E9%AB%98%E9%A2%91%E9%97%AE%E9%A2%98%E8%A7%A3%E6%9E%90-2"><span class="nav-text">面试高频问题解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-3"><span class="nav-text">总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9AReact-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86"><span class="nav-text">第五章：React 状态管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-%E7%8A%B6%E6%80%81%E6%8F%90%E5%8D%87%E4%B8%8E%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="nav-text">5.1 状态提升与单向数据流</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%85%A8%E6%99%AF%E5%9B%BE"><span class="nav-text">核心概念全景图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E6%8F%90%E5%8D%87%EF%BC%88Lifting-State-Up%EF%BC%89%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">状态提升（Lifting State Up）深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81%EF%BC%88Unidirectional-Data-Flow%EF%BC%89"><span class="nav-text">单向数据流（Unidirectional Data Flow）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E6%8F%90%E5%8D%87%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7"><span class="nav-text">状态提升的局限性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%B0%E4%BB%A3%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E6%96%B9%E6%A1%88%E5%9F%BA%E7%A1%80"><span class="nav-text">现代状态管理方案基础</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93-1"><span class="nav-text">最佳实践总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-Redux-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%EF%BC%88Store%E3%80%81Action%E3%80%81Reducer%EF%BC%89"><span class="nav-text">5.2 Redux 核心概念（Store、Action、Reducer）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Redux-%E4%B8%89%E5%A4%A7%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%85%A8%E6%99%AF%E5%9B%BE"><span class="nav-text">Redux 三大核心概念全景图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Action%EF%BC%9A%E7%8A%B6%E6%80%81%E5%8F%98%E5%8C%96%E7%9A%84%E6%8F%8F%E8%BF%B0"><span class="nav-text">Action：状态变化的描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reducer%EF%BC%9A%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2%E7%9A%84%E7%BA%AF%E5%87%BD%E6%95%B0"><span class="nav-text">Reducer：状态转换的纯函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Store%EF%BC%9A%E5%BA%94%E7%94%A8%E7%8A%B6%E6%80%81%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="nav-text">Store：应用状态的容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redux-%E4%B8%89%E5%A4%A7%E5%8E%9F%E5%88%99"><span class="nav-text">Redux 三大原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redux-%E6%95%B0%E6%8D%AE%E6%B5%81%E5%AE%8C%E6%95%B4%E5%91%A8%E6%9C%9F"><span class="nav-text">Redux 数据流完整周期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%A1%88-12"><span class="nav-text">高频面试题与破解方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redux-%E5%9C%A8%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">Redux 在函数组件中的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redux-%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%9C%BA%E5%88%B6"><span class="nav-text">Redux 中间件机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redux-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-text">Redux 最佳实践</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9ARedux-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%85%B3%E7%B3%BB%E5%9B%BE"><span class="nav-text">总结：Redux 核心概念关系图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-Redux-%E4%B8%AD%E9%97%B4%E4%BB%B6%EF%BC%88redux-thunk%E3%80%81redux-saga%EF%BC%89"><span class="nav-text">5.3 Redux 中间件（redux-thunk、redux-saga）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Redux-%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86"><span class="nav-text">Redux 中间件核心原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#redux-thunk%EF%BC%9A%E5%A4%84%E7%90%86%E7%AE%80%E5%8D%95%E5%BC%82%E6%AD%A5"><span class="nav-text">redux-thunk：处理简单异步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#redux-saga%EF%BC%9A%E5%A4%84%E7%90%86%E5%A4%8D%E6%9D%82%E5%BC%82%E6%AD%A5"><span class="nav-text">redux-saga：处理复杂异步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%A1%88-13"><span class="nav-text">高频面试题与破解方案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-React-Redux%EF%BC%88Provider%E3%80%81useSelector%E3%80%81useDispatch%EF%BC%89"><span class="nav-text">5.4 React-Redux（Provider、useSelector、useDispatch）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#React-Redux-%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="nav-text">React-Redux 核心架构图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Provider%EF%BC%9A%E7%8A%B6%E6%80%81%E6%B3%A8%E5%85%A5%E7%9A%84%E5%9F%BA%E7%9F%B3"><span class="nav-text">Provider：状态注入的基石</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useSelector%EF%BC%9A%E7%B2%BE%E5%87%86%E7%8A%B6%E6%80%81%E9%80%89%E6%8B%A9"><span class="nav-text">useSelector：精准状态选择</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useDispatch%EF%BC%9A%E8%A7%A6%E5%8F%91%E7%8A%B6%E6%80%81%E6%9B%B4%E6%96%B0"><span class="nav-text">useDispatch：触发状态更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E5%A4%A7-Hook-%E5%8D%8F%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="nav-text">三大 Hook 协作模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#connect-%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6%EF%BC%88%E4%BC%A0%E7%BB%9F%E5%86%99%E6%B3%95%EF%BC%89"><span class="nav-text">connect 高阶组件（传统写法）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%8E%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%A1%88-14"><span class="nav-text">高频面试题与破解方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9AReact-Redux-%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="nav-text">总结：React-Redux 核心知识点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-5-%E7%8E%B0%E4%BB%A3%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E6%96%B9%E6%A1%88%EF%BC%88Recoil%E3%80%81Zustand%E3%80%81Jotai%EF%BC%89"><span class="nav-text">5.5 现代状态管理方案（Recoil、Zustand、Jotai）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%A6%82%E8%BF%B0-%E7%AE%80%E8%A6%81"><span class="nav-text">基础知识概述 (简要)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Recoil-Meta-%E5%AE%98%E6%96%B9%E5%87%BA%E5%93%81"><span class="nav-text">Recoil (Meta 官方出品)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Zustand"><span class="nav-text">Zustand</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Jotai"><span class="nav-text">Jotai</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E6%AF%94%E4%B8%8E%E9%80%89%E5%9E%8B%E5%BB%BA%E8%AE%AE-%E9%9D%A2%E8%AF%95%E9%AB%98%E9%A2%91"><span class="nav-text">对比与选型建议 (面试高频)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%A2%E8%AF%95%E8%B8%A9%E5%9D%91%E7%82%B9%E4%B8%8E%E9%AB%98%E9%A2%91%E9%97%AE%E9%A2%98"><span class="nav-text">面试踩坑点与高频问题</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0%EF%BC%9AReact-Router-%E4%B8%8E%E6%95%B0%E6%8D%AE%E8%AF%B7%E6%B1%82"><span class="nav-text">第六章：React Router 与数据请求</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-React-Router-%E5%9F%BA%E7%A1%80%EF%BC%88BrowserRouter%E3%80%81Route%E3%80%81Link%EF%BC%89"><span class="nav-text">6.1 React Router 基础（BrowserRouter、Route、Link）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%EF%BC%88%E7%AE%80%E8%A6%81%EF%BC%89"><span class="nav-text">基础概念（简要）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%88React-Router-v6%EF%BC%89"><span class="nav-text">核心组件深度解析（React Router v6）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%BC%8F"><span class="nav-text">基础路由配置模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%A2%E8%AF%95%E9%AB%98%E9%A2%91%E9%97%AE%E9%A2%98%E4%B8%8E%E8%B8%A9%E5%9D%91%E7%82%B9"><span class="nav-text">面试高频问题与踩坑点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%80%BB%E7%BB%93"><span class="nav-text">核心总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E4%B8%8E%E5%B5%8C%E5%A5%97%E8%B7%AF%E7%94%B1"><span class="nav-text">6.2 动态路由与嵌套路由</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-text">核心概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">动态路由深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B5%8C%E5%A5%97%E8%B7%AF%E7%94%B1%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">嵌套路由深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E7%89%B9%E6%80%A7%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-text">关键特性与最佳实践</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%A2%E8%AF%95%E9%AB%98%E9%A2%91%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">面试高频问题与解决方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7-2"><span class="nav-text">性能优化技巧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-4"><span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-%E8%B7%AF%E7%94%B1%E5%AE%88%E5%8D%AB%E4%B8%8E%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="nav-text">6.3 路由守卫与权限控制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-text">权限控制核心概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E8%B7%AF%E7%94%B1%E5%AE%88%E5%8D%AB%E5%AE%9E%E7%8E%B0"><span class="nav-text">基础路由守卫实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E6%96%B9%E6%A1%88"><span class="nav-text">高级权限控制方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%81%E4%B8%9A%E7%BA%A7%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-3"><span class="nav-text">企业级最佳实践</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%A2%E8%AF%95%E9%AB%98%E9%A2%91%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">面试高频问题解决方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E5%A2%9E%E5%BC%BA%E6%8E%AA%E6%96%BD"><span class="nav-text">安全增强措施</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-5"><span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-4-%E6%95%B0%E6%8D%AE%E8%AF%B7%E6%B1%82%E6%96%B9%E6%A1%88%EF%BC%88fetch%E3%80%81axios%E3%80%81React-Query%E3%80%81SWR%EF%BC%89"><span class="nav-text">6.4 数据请求方案（fetch、axios、React Query、SWR）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%AF%B7%E6%B1%82%E6%A0%B8%E5%BF%83%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94"><span class="nav-text">数据请求核心方案对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E8%AF%B7%E6%B1%82%E6%96%B9%E6%A1%88%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">基础请求方案深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%B0%E4%BB%A3%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%BA%93%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="nav-text">现代数据管理库深度解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%AD%96%E7%95%A5"><span class="nav-text">高级数据管理策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%A2%E8%AF%95%E9%AB%98%E9%A2%91%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-1"><span class="nav-text">面试高频问题解决方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5"><span class="nav-text">性能优化实践</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-6"><span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-5-SSR-%E4%B8%8E-Next-js-%E5%9F%BA%E7%A1%80"><span class="nav-text">6.5 SSR 与 Next.js 基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SSR-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-text">SSR 核心概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Next-js-%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84"><span class="nav-text">Next.js 核心架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96%E7%AD%96%E7%95%A5"><span class="nav-text">数据获取策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E6%B8%B2%E6%9F%93%E7%AD%96%E7%95%A5"><span class="nav-text">高级渲染策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Next-js-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7"><span class="nav-text">Next.js 高级特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5-1"><span class="nav-text">性能优化实践</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%A2%E8%AF%95%E9%AB%98%E9%A2%91%E9%97%AE%E9%A2%98"><span class="nav-text">面试高频问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-7"><span class="nav-text">总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0%EF%BC%9AReact-%E5%B7%A5%E7%A8%8B%E5%8C%96%E4%B8%8E%E4%BC%98%E5%8C%96"><span class="nav-text">第七章：React 工程化与优化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-%E7%BB%84%E4%BB%B6%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E5%A4%8D%E5%90%88%E7%BB%84%E4%BB%B6%E3%80%81%E5%8F%97%E6%8E%A7%E7%BB%84%E4%BB%B6%E6%A8%A1%E5%BC%8F%EF%BC%89"><span class="nav-text">7.1 组件设计模式（复合组件、受控组件模式）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-%E6%A0%B7%E5%BC%8F%E6%96%B9%E6%A1%88%EF%BC%88CSS-Modules%E3%80%81Styled-Components%E3%80%81Tailwind-CSS%EF%BC%89"><span class="nav-text">7.2 样式方案（CSS Modules、Styled Components、Tailwind CSS）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3-%E6%B5%8B%E8%AF%95%EF%BC%88Jest-React-Testing-Library%EF%BC%89"><span class="nav-text">7.3 测试（Jest + React Testing Library）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-4-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%EF%BC%88React-Profiler%E3%80%81%E5%87%8F%E5%B0%91%E9%87%8D%E6%B8%B2%E6%9F%93%EF%BC%89"><span class="nav-text">7.4 性能优化（React Profiler、减少重渲染）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-5-%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%EF%BC%88Webpack-%E9%85%8D%E7%BD%AE%E3%80%81Vite-%E4%BC%98%E5%8C%96%EF%BC%89"><span class="nav-text">7.5 构建工具（Webpack 配置、Vite 优化）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E5%85%AB%E7%AB%A0%EF%BC%9AReact-18-%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%8E%E6%9C%AA%E6%9D%A5%E8%B6%8B%E5%8A%BF"><span class="nav-text">第八章：React 18 新特性与未来趋势</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-Concurrent-Mode%EF%BC%88%E5%B9%B6%E5%8F%91%E6%B8%B2%E6%9F%93%EF%BC%89"><span class="nav-text">8.1 Concurrent Mode（并发渲染）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-%E8%87%AA%E5%8A%A8%E6%89%B9%E5%A4%84%E7%90%86%EF%BC%88Automatic-Batching%EF%BC%89"><span class="nav-text">8.2 自动批处理（Automatic Batching）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3-Transition-API%EF%BC%88startTransition%EF%BC%89"><span class="nav-text">8.3 Transition API（startTransition）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-4-Server-Components%EF%BC%88%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%BB%84%E4%BB%B6%EF%BC%89"><span class="nav-text">8.4 Server Components（服务端组件）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-5-React-%E7%94%9F%E6%80%81%E8%B6%8B%E5%8A%BF%EF%BC%88RSC%E3%80%81React-Native%EF%BC%89"><span class="nav-text">8.5 React 生态趋势（RSC、React Native）</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ariel"
      src="/uploads/avatar.JPG">
  <p class="site-author-name" itemprop="name">Ariel</p>
  <div class="site-description" itemprop="description">神游在初见的午后</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/tianfei92" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tianfei92" rel="noopener me" target="_blank">GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:tian.fi@outlook.com" title="E-Mail → mailto:tian.fi@outlook.com" rel="noopener me" target="_blank">E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://juejin.cn/user/3913917124325127" title="Juejin → https:&#x2F;&#x2F;juejin.cn&#x2F;user&#x2F;3913917124325127" rel="noopener me" target="_blank">Juejin</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tianfei92.github.io/2025/06/23/React%20Study%20Notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.JPG">
      <meta itemprop="name" content="Ariel">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ariel's Blog">
      <meta itemprop="description" content="神游在初见的午后">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="React 知识体系专题学习 | Ariel's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          React 知识体系专题学习
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-06-23 17:00:36" itemprop="dateCreated datePublished" datetime="2025-06-23T17:00:36+08:00">2025-06-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-07-09 23:00:39" itemprop="dateModified" datetime="2025-07-09T23:00:39+08:00">2025-07-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>35k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2:07</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="第一章：React-基础与核心概念"><a href="#第一章：React-基础与核心概念" class="headerlink" title="第一章：React 基础与核心概念"></a>第一章：React 基础与核心概念</h1><h2 id="1-1-React-简介与设计哲学（组件化、声明式-UI）"><a href="#1-1-React-简介与设计哲学（组件化、声明式-UI）" class="headerlink" title="1.1 React 简介与设计哲学（组件化、声明式 UI）"></a>1.1 React 简介与设计哲学（组件化、声明式 UI）</h2><h3 id="基础概念概述"><a href="#基础概念概述" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><p><strong>React 是什么？</strong></p>
<p>Facebook 推出的用于构建用户界面的 JavaScript 库，核心解决 UI 组件化开发问题。</p>
<p><strong>两大设计哲学</strong></p>
<ul>
<li>组件化 (Component-Based)：将 UI 拆分为独立、可复用的代码单元（组件），每个组件管理自身状态与逻辑。<em>示例：<code>&lt;Button /&gt;</code>, <code>&lt;Card /&gt;</code> 等</em></li>
<li>声明式 UI (Declarative)：开发者只需描述“UI 应该是什么样子”（What），而非“如何更新到该状态”（How）。<em>对比命令式：直接操作 DOM vs. 返回 JSX 描述结构</em></li>
</ul>
<span id="more"></span>

<h3 id="深入原理与面试考点"><a href="#深入原理与面试考点" class="headerlink" title="深入原理与面试考点"></a>深入原理与面试考点</h3><p><strong>组件化背后的核心思想</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">说明</th>
<th align="left">面试举例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">封装性</td>
<td align="left">组件内部状态&#x2F;逻辑对外隐藏，仅通过 Props 通信</td>
<td align="left">“为何 React 推荐单向数据流？”</td>
</tr>
<tr>
<td align="left">组合性</td>
<td align="left">通过嵌套组件构建复杂 UI（如 <code>&lt;Form&gt;&lt;Input/&gt;&lt;Button/&gt;&lt;/Form&gt;</code>）</td>
<td align="left">“如何设计可复用的高阶组件？”</td>
</tr>
<tr>
<td align="left">复用性</td>
<td align="left">同一组件在不同场景重复使用</td>
<td align="left">“受控组件与非受控组件适用场景差异？”</td>
</tr>
</tbody></table>
<p><strong>声明式 UI 的底层实现</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 声明式写法（What）</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 对应的命令式逻辑（How）</span>
<span class="token keyword">const</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  count<span class="token operator">++</span><span class="token punctuation">;</span>
  button<span class="token punctuation">.</span>textContent <span class="token operator">=</span> count<span class="token punctuation">;</span> <span class="token comment">// 需手动更新 DOM</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>关键优势：</p>
<ul>
<li>避免直接操作 DOM → 减少代码复杂度与潜在 Bug</li>
<li>与状态绑定 → UI 自动随状态更新（通过 Virtual DOM 协调）</li>
</ul>
<p><strong>虚拟 DOM (Virtual DOM) 的角色</strong></p>
<pre><code class="mermaid">graph LR
A[组件状态变化] --&gt; B&#123;生成新 Virtual DOM&#125;
B --&gt; C[对比新旧 Virtual DOM]
C --&gt; D[计算最小 DOM 变更]
D --&gt; E[批量更新真实 DOM]</code></pre>

<p>设计哲学关联：声明式 UI 依赖 Virtual DOM 实现高效的 “状态到 UI 的映射”，开发者无需关注更新过程。</p>
<h3 id="面试话术技巧"><a href="#面试话术技巧" class="headerlink" title="面试话术技巧"></a>面试话术技巧</h3><p><strong>Q：为什么 React 采用声明式而非命令式？</strong></p>
<p>声明式让代码更专注于业务逻辑的描述（What），将底层 DOM 操作交给 React 的 Virtual DOM 协调机制处理。这带来三方面优势：</p>
<ol>
<li>可维护性：状态变化自动触发 UI 更新，避免手动 DOM 操作导致的逻辑分散</li>
<li>性能优化：React 通过 Diff 算法批量 DOM 更新，减少重绘开销</li>
<li>开发体验：更接近自然思维模式的 UI 构建方式，提升开发效率”</li>
</ol>
<h3 id="延伸考点"><a href="#延伸考点" class="headerlink" title="延伸考点"></a>延伸考点</h3><ul>
<li>JSX 的本质：声明式 UI 的语法糖（编译为 React.createElement()）</li>
<li>组件化与设计模式：复合组件 (Compound Components)、容器&#x2F;展示组件等</li>
</ul>
<h2 id="1-2-JSX-语法与渲染逻辑（表达式、条件渲染、列表渲染）"><a href="#1-2-JSX-语法与渲染逻辑（表达式、条件渲染、列表渲染）" class="headerlink" title="1.2 JSX 语法与渲染逻辑（表达式、条件渲染、列表渲染）"></a>1.2 JSX 语法与渲染逻辑（表达式、条件渲染、列表渲染）</h2><h3 id="基础概念简述"><a href="#基础概念简述" class="headerlink" title="基础概念简述"></a>基础概念简述</h3><p><strong>JSX 是什么？</strong></p>
<p>JavaScript 语法扩展，允许在 JavaScript 中编写类似 HTML 的结构（语法糖）</p>
<p><strong>三大核心功能</strong></p>
<ul>
<li>表达式嵌入：{ } 包裹任意 JavaScript 表达式</li>
<li>条件渲染：三元运算符 ? : 或 &amp;&amp; 短路运算</li>
<li>列表渲染：map() + key 属性生成元素列表</li>
</ul>
<h3 id="核心机制与深度原理"><a href="#核心机制与深度原理" class="headerlink" title="核心机制与深度原理"></a>核心机制与深度原理</h3><p><strong>JSX 编译原理（Babel 转换过程）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 原始 JSX</span>
<span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">></span>Hello <span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token comment">// Babel 编译后（React 17+ 无需显式引入 React）</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> jsx <span class="token keyword">as</span> _jsx <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"react/jsx-runtime"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token function">_jsx</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">className</span><span class="token operator">:</span> <span class="token string">"container"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"Hello "</span><span class="token punctuation">,</span> name<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>关键点：</p>
<ul>
<li>JSX 本质是 React.createElement(type, props, children) 的语法糖</li>
<li>每个 JSX 元素会被编译为 虚拟 DOM 对象（包含 type, props, key 等属性）</li>
</ul>
<p><strong>表达式嵌入的运行时机制</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Welcome</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 表达式执行发生在组件 render 阶段</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span>当前用户<span class="token operator">:</span> <span class="token punctuation">&#123;</span>props<span class="token punctuation">.</span>user <span class="token operator">??</span> <span class="token string">'游客'</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意事项：</p>
<ul>
<li>表达式内不能使用语句（如 if&#x2F;for）</li>
<li>表达式结果类型自动转换：<ul>
<li>undefined&#x2F;null&#x2F;true&#x2F;false → 不渲染</li>
<li>数组 → 展开渲染（需包含有效元素）</li>
<li>对象 → 抛出错误（除特殊对象如 ReactElement）</li>
</ul>
</li>
</ul>
<p><strong>条件渲染的底层实现策略</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 方案1：三元表达式（适合简单分支）</span>
<span class="token punctuation">&#123;</span> isLoggedIn <span class="token operator">?</span> <span class="token operator">&lt;</span>LogoutButton <span class="token operator">/</span><span class="token operator">></span> <span class="token operator">:</span> <span class="token operator">&lt;</span>LoginButton <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#125;</span>

<span class="token comment">// 方案2：&amp;&amp; 短路（适合单分支）</span>
<span class="token punctuation">&#123;</span> hasUnread <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>Badge count<span class="token operator">=</span><span class="token punctuation">&#123;</span>unreadCount<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#125;</span>

<span class="token comment">// 方案3：立即执行函数（复杂逻辑 - 不推荐）</span>
<span class="token punctuation">&#123;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>conditionA<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>ComponentA <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>conditionB<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>ComponentB <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Fallback <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>性能优化：条件变化时，React 通过 Diff 算法 复用相同子组件（按组件位置比对）</p>
<p><strong>列表渲染的 key 机制</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> todoItems <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">&#123;</span>todo<span class="token punctuation">.</span>id<span class="token punctuation">&#125;</span><span class="token operator">></span>  <span class="token comment">// ⭐ 关键点：key 必须是稳定唯一标识</span>
    <span class="token punctuation">&#123;</span>todo<span class="token punctuation">.</span>text<span class="token punctuation">&#125;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>无 key 的隐患：</p>
<ul>
<li>列表顺序变化时引发组件状态错乱（如输入框内容错位）</li>
<li>性能下降：全量比对子元素（时间复杂度 O(n²)）</li>
</ul>
<h3 id="高频面试题与破解技巧"><a href="#高频面试题与破解技巧" class="headerlink" title="高频面试题与破解技巧"></a>高频面试题与破解技巧</h3><p><strong>Q：为什么 JSX 中 <code>&#123;boolean &amp;&amp; &lt;Component/&gt;&#125;</code> 可能渲染 0？</strong></p>
<p>true &amp;&amp; jsx 返回 jsx，但 false &amp;&amp; jsx 返回 false → React 将 false 渲染为空白占位符（类似 null），导致 DOM 中出现空文本节点。</p>
<p>解决方案：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 转换为 null 避免空节点</span>
<span class="token punctuation">&#123;</span> shouldRender <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>Component <span class="token operator">/</span><span class="token operator">></span> <span class="token operator">||</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>Q：列表渲染为什么不能用 index 作为 key？</strong></p>
<p>当列表发生增删或排序时：</p>
<ul>
<li>index 变化导致组件被意外销毁重建（状态丢失）</li>
<li>Diff 算法无法准确定位节点变化</li>
<li>正确做法：使用数据唯一 ID（如 todo.id）</li>
</ul>
<p><strong>Q：JSX 如何防止 XSS 攻击？</strong></p>
<p>JSX 在执行表达式插入时自动进行转义处理：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token string">'&lt;script>alert(1)&lt;/script>'</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token punctuation">&#123;</span>title<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span> 
<span class="token comment">// 渲染为：&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>例外：dangerouslySetInnerHTML 需手动防范</p>
<h2 id="1-3-组件基础（函数组件-vs-类组件）"><a href="#1-3-组件基础（函数组件-vs-类组件）" class="headerlink" title="1.3 组件基础（函数组件 vs. 类组件）"></a>1.3 组件基础（函数组件 vs. 类组件）</h2><h3 id="基础概念概述-1"><a href="#基础概念概述-1" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">函数组件</th>
<th align="left">类组件</th>
</tr>
</thead>
<tbody><tr>
<td align="left">定义方式</td>
<td align="left">JavaScript 函数</td>
<td align="left">ES6 class 继承 React.Component</td>
</tr>
<tr>
<td align="left">状态管理</td>
<td align="left">useState Hook (React 16.8+)</td>
<td align="left">this.state + setState</td>
</tr>
<tr>
<td align="left">生命周期</td>
<td align="left">useEffect Hook</td>
<td align="left">生命周期方法（componentDidMount等）</td>
</tr>
<tr>
<td align="left">代码量</td>
<td align="left">更简洁</td>
<td align="left">相对冗长</td>
</tr>
<tr>
<td align="left">推荐场景</td>
<td align="left">现代 React 开发首选</td>
<td align="left">遗留项目或需要 Error Boundaries 时</td>
</tr>
</tbody></table>
<h3 id="核心机制与差异深度解析"><a href="#核心机制与差异深度解析" class="headerlink" title="核心机制与差异深度解析"></a>核心机制与差异深度解析</h3><p><strong>渲染逻辑本质区别</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 函数组件：纯函数执行</span>
<span class="token keyword">function</span> <span class="token function">Welcome</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span>Hello<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>props<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 类组件：实例化后调用 render 方法</span>
<span class="token keyword">class</span> <span class="token class-name">Welcome</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span>Hello<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>关键差异：</p>
<ul>
<li>函数组件：直接返回 JSX，每次渲染都是独立函数调用</li>
<li>类组件：通过 实例化 → 调用 render() 返回 JSX，实例在更新间保持</li>
</ul>
<p><strong>状态管理的底层实现</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 函数组件：闭包存储状态（Hook 链表结构）</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token comment">// React 内部通过顺序索引关联状态</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 类组件：实例属性存储状态</span>
<span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>状态更新差异：</p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">函数组件</th>
<th align="left">类组件</th>
</tr>
</thead>
<tbody><tr>
<td align="left">更新机制</td>
<td align="left">闭包捕获当次渲染状态</td>
<td align="left">始终读取最新 this.state</td>
</tr>
<tr>
<td align="left">批处理</td>
<td align="left">自动批处理（React 18+）</td>
<td align="left">需 unstable_batchedUpdates</td>
</tr>
<tr>
<td align="left">异步性</td>
<td align="left">状态更新队列</td>
<td align="left">setState 合并更新</td>
</tr>
</tbody></table>
<p><strong>生命周期映射关系</strong></p>
<pre><code class="mermaid">graph TD
  A[类组件生命周期] --&gt; B[componentDidMount]
  A --&gt; C[componentDidUpdate]
  A --&gt; D[componentWillUnmount]
  
  E[函数组件等效实现] --&gt; F[&quot;useEffect(() &#x3D;&gt; &#123;&#125;, [])&quot;]
  E --&gt; G[&quot;useEffect(() &#x3D;&gt; &#123;&#125;, [deps])&quot;]
  E --&gt; H[&quot;useEffect(() &#x3D;&gt; &#123; return () &#x3D;&gt; &#123;&#125; &#125;, [])&quot;]
  
  B --&gt;|挂载后执行| F
  C --&gt;|依赖更新后执行| G
  D --&gt;|卸载前清理| H</code></pre>

<p>关键差异点：</p>
<ul>
<li>类组件：生命周期方法分散定义，逻辑易割裂，componentDidMount&#x2F;Update 在 浏览器绘制后 执行</li>
<li>函数组件：useEffect 集中处理副作用，通过依赖数组控制执行时机，useEffect 在 浏览器绘制前 异步执行（使用 useLayoutEffect 可模拟同步行为）</li>
</ul>
<h3 id="高频面试题与破解技巧-1"><a href="#高频面试题与破解技巧-1" class="headerlink" title="高频面试题与破解技巧"></a>高频面试题与破解技巧</h3><p><strong>Q：为什么函数组件取代了类组件成为主流？</strong></p>
<ul>
<li>代码简洁性：减少约 30% 代码量（无 class&#x2F;this&#x2F;constructor）</li>
<li>逻辑复用优势：自定义 Hook 比 HOC&#x2F;Render Props 更直观</li>
<li>性能优化：避免类组件实例化开销，Hook 依赖数组精准控制更新</li>
<li>未来兼容：React 新特性（Concurrent Features）优先支持函数组件</li>
</ul>
<p><strong>Q：函数组件如何实现类似 forceUpdate 的功能？</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">[</span>_<span class="token punctuation">,</span> forceUpdate<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=></span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 调用 forceUpdate() 触发重渲染</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>原理：通过修改无关状态强制触发更新</p>
<p><strong>Q：类组件中 setState 是同步还是异步？</strong></p>
<ul>
<li>React 17 及之前：合成事件&#x2F;生命周期中异步，setTimeout 中同步</li>
<li>React 18+：默认全部异步（自动批处理）</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 获取更新后状态的正确方式</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'更新后：'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 回调函数保证</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="1-4-Props-与-State（数据流、单向数据绑定）"><a href="#1-4-Props-与-State（数据流、单向数据绑定）" class="headerlink" title="1.4 Props 与 State（数据流、单向数据绑定）"></a>1.4 Props 与 State（数据流、单向数据绑定）</h2><h3 id="基础概念对比表"><a href="#基础概念对比表" class="headerlink" title="基础概念对比表"></a>基础概念对比表</h3><table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">Props</th>
<th align="left">State</th>
</tr>
</thead>
<tbody><tr>
<td align="left">定义</td>
<td align="left">组件外部传入的数据</td>
<td align="left">组件内部管理的状态</td>
</tr>
<tr>
<td align="left">可变性</td>
<td align="left">只读（Immutable）</td>
<td align="left">可修改（通过 setState&#x2F;useState）</td>
</tr>
<tr>
<td align="left">数据源</td>
<td align="left">父组件传递</td>
<td align="left">组件自身创建</td>
</tr>
<tr>
<td align="left">更新触发</td>
<td align="left">父组件重渲染</td>
<td align="left">调用状态更新函数</td>
</tr>
<tr>
<td align="left">通信方向</td>
<td align="left">父 → 子</td>
<td align="left">组件内部</td>
</tr>
</tbody></table>
<h3 id="核心机制深度解析"><a href="#核心机制深度解析" class="headerlink" title="核心机制深度解析"></a>核心机制深度解析</h3><p><strong>单向数据流（Unidirectional Data Flow）</strong></p>
<pre><code class="mermaid">graph LR
A[父组件] -- Props --&gt; B[子组件1]
A -- Props --&gt; C[子组件2]
B -- Props --&gt; D[孙子组件]
C -- Props --&gt; E[孙子组件]</code></pre>

<p>核心规则：</p>
<ul>
<li>数据只能从父组件流向子组件，禁止反向流动</li>
<li>子组件修改父组件数据需通过回调函数实现：</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 父组件</span>
<span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Child value<span class="token operator">=</span><span class="token punctuation">&#123;</span>value<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span>setValue<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 子组件</span>
<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> value<span class="token punctuation">,</span> onChange <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">&#123;</span>value<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token function">onChange</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Props 的不可变性（Immutability）</strong></p>
<p>底层原理：</p>
<ul>
<li>React 使用 Object.is 算法进行 props 浅比较（shallow compare）</li>
<li>若检测到 props 引用变化，则触发子组件重渲染</li>
</ul>
<p>开发约束：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 禁止直接修改 props</span>
<span class="token keyword">function</span> <span class="token function">UserCard</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  user<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"Hacked"</span><span class="token punctuation">;</span>  <span class="token comment">// 违反不可变性原则</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">&#123;</span>user<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 正确做法：使用派生数据</span>
<span class="token keyword">function</span> <span class="token function">UserCard</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> displayName <span class="token operator">=</span> user<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 创建新值</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">&#123;</span>displayName<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>State 更新机制</strong></p>
<p>(1) 类组件</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 批量更新：多次 setState 合并为一次更新</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 结果：count 只 +1（使用对象形式）</span>
    
    <span class="token comment">// 函数形式解决连续更新</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> prev<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> prev<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 结果：count +2</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(2) 函数组件</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 闭包捕获当前 count 值</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 仍基于初始值计算</span>
    
    <span class="token comment">// 函数形式获取最新值</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> prev <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> prev <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 正确 +2</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高频面试题与破解方案"><a href="#高频面试题与破解方案" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么React强调Props不可变？</strong></p>
<ul>
<li>可预测性：确保组件行为只取决于输入的props，便于调试</li>
<li>性能优化：浅比较依赖引用不变性（若直接修改，浅比较无法检测变化）</li>
<li>并发安全：避免数据在渲染过程中被意外修改</li>
</ul>
<p><strong>Q：如何实现子组件向父组件通信？</strong></p>
<p>设计模式：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 父组件</span>
<span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 回调函数作为prop传递</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handleChildSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">childData</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setData</span><span class="token punctuation">(</span>childData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Child onSubmit<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleChildSubmit<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 子组件</span>
<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> onSubmit <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>input<span class="token punctuation">,</span> setInput<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">&#123;</span>input<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token function">setInput</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">onSubmit</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Q：什么时候该用Props vs State？</strong></p>
<p>决策过程：</p>
<pre><code class="mermaid">graph TD
A[数据来源] --&gt;|父组件传递| B[用Props]
A --&gt;|组件自身管理| C[用State]
D[是否随时间&#x2F;交互变化] --&gt;|否| E[用Props]
D --&gt;|是| F[用State]</code></pre>

<h3 id="高级应用场景"><a href="#高级应用场景" class="headerlink" title="高级应用场景"></a>高级应用场景</h3><p><strong>状态提升（Lifting State Up）</strong></p>
<p>场景：多个组件需要共享同一状态</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 状态提升到共同父组件</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>theme<span class="token punctuation">,</span> setTheme<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'light'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Toolbar theme<span class="token operator">=</span><span class="token punctuation">&#123;</span>theme<span class="token punctuation">&#125;</span> onThemeChange<span class="token operator">=</span><span class="token punctuation">&#123;</span>setTheme<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>ContentArea theme<span class="token operator">=</span><span class="token punctuation">&#123;</span>theme<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 子组件通过props获取/更新状态</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="性能优化陷阱"><a href="#性能优化陷阱" class="headerlink" title="性能优化陷阱"></a>性能优化陷阱</h3><p><strong>Props 穿透问题</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 不必要重渲染：直接传递对象</span>
<span class="token operator">&lt;</span>Child user<span class="token operator">=</span><span class="token punctuation">&#123;</span>user<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>

<span class="token comment">// ✅ 解决方案：扁平化props或React.memo</span>
<span class="token operator">&lt;</span>Child name<span class="token operator">=</span><span class="token punctuation">&#123;</span>user<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span> age<span class="token operator">=</span><span class="token punctuation">&#123;</span>user<span class="token punctuation">.</span>age<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>状态位置错误导致的渲染风暴</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 状态放在过高层级</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>counter<span class="token punctuation">,</span> setCounter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 任何更新触发全应用重渲染</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Page <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// ✅ 状态下沉到最小范围</span>
<span class="token keyword">function</span> <span class="token function">CounterButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 影响范围局部化</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>c<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="1-5-事件处理（合成事件、this-绑定问题）"><a href="#1-5-事件处理（合成事件、this-绑定问题）" class="headerlink" title="1.5 事件处理（合成事件、this 绑定问题）"></a>1.5 事件处理（合成事件、this 绑定问题）</h2><h3 id="基础概念概述-2"><a href="#基础概念概述-2" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><p>React 事件处理特点：</p>
<ul>
<li>驼峰命名：onClick 而非 onclick</li>
<li>JSX 中传入函数引用而非字符串</li>
<li>默认阻止默认行为需显式调用 e.preventDefault()</li>
</ul>
<p>两大核心问题：</p>
<ul>
<li>合成事件（SyntheticEvent）机制</li>
<li>类组件中的 this 绑定问题</li>
</ul>
<h3 id="合成事件（SyntheticEvent）深度解析"><a href="#合成事件（SyntheticEvent）深度解析" class="headerlink" title="合成事件（SyntheticEvent）深度解析"></a>合成事件（SyntheticEvent）深度解析</h3><p><strong>设计目的与原理</strong></p>
<pre><code class="mermaid">graph LR
A[浏览器原生事件] --&gt; B(React事件系统)
B --&gt; C[创建合成事件对象]
C --&gt; D[事件委托到根容器]
D --&gt; E[触发对应组件处理函数]
E --&gt; F[事件池回收]</code></pre>

<p>核心特性：</p>
<ul>
<li>跨浏览器兼容：统一不同浏览器事件接口</li>
<li>性能优化：事件委托 + 事件池复用（React 17 前）</li>
<li>冒泡机制：基于虚拟DOM树而非实际DOM树</li>
</ul>
<p><strong>事件池机制（React 17 前）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 正常访问</span>
  
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ❌ React 17前：null（事件对象已被回收）</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ✅ 解决方案：e.persist() 保留事件对象</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>React 17+ 改进：移除了事件池，无需 e.persist()</p>
<p><strong>合成事件与原生事件差异</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">合成事件</th>
<th align="left">原生事件</th>
</tr>
</thead>
<tbody><tr>
<td align="left">事件注册</td>
<td align="left">onClick</td>
<td align="left">addEventListener</td>
</tr>
<tr>
<td align="left">事件对象</td>
<td align="left">SyntheticEvent</td>
<td align="left">原生 Event 对象</td>
</tr>
<tr>
<td align="left">事件传播</td>
<td align="left">虚拟DOM树冒泡</td>
<td align="left">实际DOM树冒泡</td>
</tr>
<tr>
<td align="left">阻止冒泡</td>
<td align="left">e.stopPropagation()</td>
<td align="left">同名API</td>
</tr>
<tr>
<td align="left">事件委托</td>
<td align="left">自动委托到根容器</td>
<td align="left">需手动委托</td>
</tr>
</tbody></table>
<h3 id="this-绑定问题详解（类组件）"><a href="#this-绑定问题详解（类组件）" class="headerlink" title="this 绑定问题详解（类组件）"></a>this 绑定问题详解（类组件）</h3><p><strong>问题根源</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ❌ 此时 this 为 undefined（严格模式）</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">&#125;</span><span class="token operator">></span>点击<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>原因：JavaScript 函数中的 this 由调用方式决定，非类实例本身</p>
<p><strong>四种解决方案对比</strong></p>
<table>
<thead>
<tr>
<th align="left">方案</th>
<th align="left">代码示例</th>
<th align="left">优点</th>
<th align="left">缺点</th>
</tr>
</thead>
<tbody><tr>
<td align="left">构造函数绑定</td>
<td align="left">this.handleClick &#x3D; this.handleClick.bind(this)</td>
<td align="left">标准做法</td>
<td align="left">代码冗余</td>
</tr>
<tr>
<td align="left">箭头函数（类属性）</td>
<td align="left">handleClick &#x3D; () &#x3D;&gt; {…}</td>
<td align="left">简洁，推荐方案</td>
<td align="left">实验性语法（需Babel）</td>
</tr>
<tr>
<td align="left">内联箭头函数</td>
<td align="left">onClick&#x3D;{() &#x3D;&gt; this.handleClick()}</td>
<td align="left">简单直接</td>
<td align="left">每次渲染创建新函数</td>
</tr>
<tr>
<td align="left">bind 内联</td>
<td align="left">onClick&#x3D;{this.handleClick.bind(this)}</td>
<td align="left">无额外代码</td>
<td align="left">同内联箭头函数</td>
</tr>
</tbody></table>
<p><strong>性能优化关键点</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 避免内联绑定（每次渲染创建新函数）</span>
<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>点击<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>

<span class="token comment">// ✅ 推荐：构造函数预绑定</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// ✅ 或使用类属性箭头函数</span>
<span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高频面试题与解决方案"><a href="#高频面试题与解决方案" class="headerlink" title="高频面试题与解决方案"></a>高频面试题与解决方案</h3><p><strong>Q：为什么React不直接使用原生事件？</strong></p>
<ul>
<li>跨浏览器兼容：统一事件处理逻辑</li>
<li>性能优化：事件委托减少内存占用</li>
<li>事件池机制：复用事件对象（React 17前）</li>
<li>框架扩展性：为异步渲染等特性铺平道路</li>
</ul>
<p><strong>Q：如何阻止合成事件的默认行为？</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Form</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 显式阻止表单提交</span>
    <span class="token comment">// 处理逻辑...</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleSubmit<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Q：合成事件和原生事件混用时要注意什么？</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleDocumentClick<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function-variable function">handleDocumentClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 原生事件</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token function-variable function">handleButtonClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 合成事件</span>
  e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ❌ 无法阻止原生事件冒泡</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// ✅ 正确方案：在原生事件中使用 nativeEvent</span>
<span class="token function-variable function">handleButtonClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  e<span class="token punctuation">.</span>nativeEvent<span class="token punctuation">.</span><span class="token function">stopImmediatePropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="React-17-事件系统升级"><a href="#React-17-事件系统升级" class="headerlink" title="React 17+ 事件系统升级"></a>React 17+ 事件系统升级</h3><ul>
<li>委托目标变更：从 document 到 ReactDOM.render 的根容器</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// React 16：委托到 document</span>
<span class="token comment">// React 17+：委托到 root DOM 容器</span>
<span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>移除事件池：无需 e.persist() 可异步访问事件对象</li>
<li>更接近原生：e.stopPropagation() 真正阻止原生事件传播</li>
</ul>
<h1 id="第二章：React-核心机制"><a href="#第二章：React-核心机制" class="headerlink" title="第二章：React 核心机制"></a>第二章：React 核心机制</h1><h2 id="2-1-虚拟-DOM-与-Diff-算法（Reconciliation）"><a href="#2-1-虚拟-DOM-与-Diff-算法（Reconciliation）" class="headerlink" title="2.1 虚拟 DOM 与 Diff 算法（Reconciliation）"></a>2.1 虚拟 DOM 与 Diff 算法（Reconciliation）</h2><h3 id="基础概念概述-3"><a href="#基础概念概述-3" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><ul>
<li>虚拟 DOM (Virtual DOM)：<ul>
<li>JavaScript 对象表示的 DOM 副本</li>
<li>轻量化的内存数据结构</li>
<li>与实际 DOM 结构一一对应</li>
</ul>
</li>
<li>Diff 算法 (Reconciliation)：<ul>
<li>React 比较新旧虚拟 DOM 差异的算法</li>
<li>时间复杂度优化到 O(n)</li>
<li>生成最小化 DOM 操作指令</li>
</ul>
</li>
</ul>
<h3 id="虚拟-DOM-核心原理"><a href="#虚拟-DOM-核心原理" class="headerlink" title="虚拟 DOM 核心原理"></a>虚拟 DOM 核心原理</h3><p><strong>虚拟 DOM 结构示例</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 实际 JSX</span>
<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>h1 key<span class="token operator">=</span><span class="token string">"title"</span><span class="token operator">></span>Hello React<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
  <span class="token operator">&lt;</span>List items<span class="token operator">=</span><span class="token punctuation">&#123;</span>items<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>

<span class="token comment">// 对应的虚拟 DOM 对象</span>
<span class="token punctuation">&#123;</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">className</span><span class="token operator">:</span> <span class="token string">'container'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'h1'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'title'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">'Hello React'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> List<span class="token punctuation">,</span>  <span class="token comment">// 组件类型</span>
      <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> items <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token comment">// ... 内部有独立虚拟 DOM 树</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>虚拟 DOM 工作流程</strong></p>
<pre><code class="mermaid">graph LR
A[组件状态变化] --&gt; B[创建新虚拟 DOM 树]
B --&gt; C[Diff 算法比较新旧树]
C --&gt; D[生成 DOM 补丁包]
D --&gt; E[批量更新真实 DOM]</code></pre>

<p><strong>虚拟 DOM 性能优势</strong></p>
<table>
<thead>
<tr>
<th align="left">操作</th>
<th align="left">直接操作 DOM</th>
<th align="left">虚拟 DOM 方案</th>
</tr>
</thead>
<tbody><tr>
<td align="left">更新 10 节点</td>
<td align="left">10 次 DOM 操作</td>
<td align="left">1 次 Diff + 1 次更新</td>
</tr>
<tr>
<td align="left">跨平台能力</td>
<td align="left">依赖浏览器 API</td>
<td align="left">抽象渲染层</td>
</tr>
<tr>
<td align="left">复杂更新</td>
<td align="left">手动优化难度大</td>
<td align="left">自动批量处理</td>
</tr>
</tbody></table>
<h3 id="Diff-算法深度解析（O-n-优化策略）"><a href="#Diff-算法深度解析（O-n-优化策略）" class="headerlink" title="Diff 算法深度解析（O(n) 优化策略）"></a>Diff 算法深度解析（O(n) 优化策略）</h3><p><strong>算法三大设计原则</strong></p>
<p>(1) 同级比较：只比较同一层级的节点，不跨级比较</p>
<pre><code class="mermaid">graph TD
A[旧树] --&gt; B[节点A]
A --&gt; C[节点B]
D[新树] --&gt; E[节点A&#39;]
D --&gt; F[节点B&#39;]
B --&gt;|比较| E
C --&gt;|比较| F</code></pre>

<p>(2) 类型差异直接替换：节点类型不同时直接卸载整棵子树</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 旧：&lt;div>&lt;ComponentA />&lt;/div></span>
<span class="token comment">// 新：&lt;span>&lt;ComponentB />&lt;/span></span>
<span class="token comment">// React 操作：卸载整个 div 及子组件，创建 span 和 ComponentB</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>(3) Key 属性优化列表：列表项使用 key 标识身份，减少节点移动开销</p>
<p><strong>列表 Diff 的 key 机制</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 旧列表</span>
<span class="token operator">&lt;</span>ul<span class="token operator">></span>
  <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"a"</span><span class="token operator">></span><span class="token constant">A</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"b"</span><span class="token operator">></span><span class="token constant">B</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"c"</span><span class="token operator">></span><span class="token constant">C</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>

<span class="token comment">// 新列表（删除B，新增D）</span>
<span class="token operator">&lt;</span>ul<span class="token operator">></span>
  <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"a"</span><span class="token operator">></span><span class="token constant">A</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"c"</span><span class="token operator">></span><span class="token constant">C</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"d"</span><span class="token operator">></span><span class="token constant">D</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Diff 过程：</p>
<ul>
<li>通过 key 匹配新旧节点：a→a, c→c</li>
<li>删除 key&#x3D;”b” 的节点</li>
<li>新增 key&#x3D;”d” 的节点</li>
<li>复用 key&#x3D;”a” 和 “c” 的节点</li>
</ul>
<p><strong>节点复用策略</strong></p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">操作</th>
<th align="left">性能影响</th>
</tr>
</thead>
<tbody><tr>
<td align="left">相同类型 DOM 元素</td>
<td align="left">更新属性</td>
<td align="left">高效</td>
</tr>
<tr>
<td align="left">相同类型组件元素</td>
<td align="left">触发更新（不卸载）</td>
<td align="left">保留组件状态</td>
</tr>
<tr>
<td align="left">不同类型元素</td>
<td align="left">卸载整棵子树</td>
<td align="left">成本较高</td>
</tr>
</tbody></table>
<h3 id="React-Fiber-架构与可中断渲染"><a href="#React-Fiber-架构与可中断渲染" class="headerlink" title="React Fiber 架构与可中断渲染"></a>React Fiber 架构与可中断渲染</h3><p><strong>传统 Diff 算法局限</strong></p>
<ul>
<li>递归遍历：无法中断长时间任务</li>
<li>阻塞主线程：导致动画卡顿</li>
</ul>
<p><strong>Fiber 架构核心改进</strong></p>
<pre><code class="mermaid">graph LR
A[同步递归] --&gt; B[可中断异步任务]
C[虚拟DOM树] --&gt; D[Fiber链表结构]</code></pre>

<p>Fiber 节点结构：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>          <span class="token comment">// 节点类型</span>
  <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>            <span class="token comment">// 唯一标识</span>
  <span class="token keyword">return</span><span class="token operator">:</span> parentFiber<span class="token punctuation">,</span>  <span class="token comment">// 父节点</span>
  <span class="token literal-property property">child</span><span class="token operator">:</span> firstChild<span class="token punctuation">,</span>    <span class="token comment">// 第一个子节点</span>
  <span class="token literal-property property">sibling</span><span class="token operator">:</span> nextSibling<span class="token punctuation">,</span> <span class="token comment">// 兄弟节点</span>
  <span class="token literal-property property">alternate</span><span class="token operator">:</span> oldFiber<span class="token punctuation">,</span>  <span class="token comment">// 指向旧树对应节点</span>
  <span class="token literal-property property">effectTag</span><span class="token operator">:</span> <span class="token string">'UPDATE'</span><span class="token punctuation">,</span>  <span class="token comment">// 需要执行的副作用</span>
  <span class="token comment">// ... 其他元数据</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>双缓存机制（Current 树与 WorkInProgress 树）</strong></p>
<pre><code class="mermaid">graph LR
A[当前显示] --&gt;|Current 树| B[用户界面]
C[正在构建] --&gt;|WorkInProgress 树| D[内存中]
B --&gt;|渲染完成| C</code></pre>

<ul>
<li>无闪烁更新：直接切换树引用</li>
<li>安全回滚：中断时丢弃未完成树</li>
</ul>
<h3 id="高频面试题与破解方案-1"><a href="#高频面试题与破解方案-1" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么列表渲染需要 key？key 可以随机数吗？</strong></p>
<ul>
<li>key 帮助 React 识别元素身份，减少不必要的销毁&#x2F;重建</li>
<li>禁止使用随机数：每次渲染 key 变化导致全量重建</li>
<li>推荐方案：稳定 ID（如数据 id）或索引（仅静态列表）</li>
</ul>
<p><strong>Q：虚拟 DOM 一定比直接操作 DOM 快吗？</strong></p>
<p>辩证回答：</p>
<ul>
<li>初始渲染：虚拟 DOM 需要额外创建对象，稍慢</li>
<li>复杂更新：虚拟 DOM 通过 Diff 减少操作次数，更快</li>
<li>综合优势：<ul>
<li>跨平台能力（React Native）</li>
<li>声明式编程体验</li>
<li>自动批处理优化</li>
</ul>
</li>
</ul>
<p><strong>Q：React 如何实现 O(n) 复杂度的 Diff？</strong></p>
<p>算法原理：</p>
<ul>
<li>仅同层比较（深度优先遍历）</li>
<li>类型不同时跳过子树比较</li>
<li>列表使用 key 匹配减少移动开销</li>
</ul>
<h3 id="性能优化技巧"><a href="#性能优化技巧" class="headerlink" title="性能优化技巧"></a>性能优化技巧</h3><p><strong>避免不必要节点变动</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 每次渲染创建新对象（导致子组件重渲染）</span>
<span class="token operator">&lt;</span>Child style<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>

<span class="token comment">// ✅ 提取静态对象</span>
<span class="token keyword">const</span> staticStyle <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>Child style<span class="token operator">=</span><span class="token punctuation">&#123;</span>staticStyle<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>列表渲染优化</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 索引作为 key（列表变化时状态错乱）</span>
<span class="token punctuation">&#123;</span>todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">todo<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> 
  <span class="token operator">&lt;</span>TodoItem key<span class="token operator">=</span><span class="token punctuation">&#123;</span>index<span class="token punctuation">&#125;</span> todo<span class="token operator">=</span><span class="token punctuation">&#123;</span>todo<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>

<span class="token comment">// ✅ 稳定 ID 作为 key</span>
<span class="token punctuation">&#123;</span>todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=></span> 
  <span class="token operator">&lt;</span>TodoItem key<span class="token operator">=</span><span class="token punctuation">&#123;</span>todo<span class="token punctuation">.</span>id<span class="token punctuation">&#125;</span> todo<span class="token operator">=</span><span class="token punctuation">&#123;</span>todo<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>组件树结构优化</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 深层嵌套导致 Diff 范围大</span>
<span class="token operator">&lt;</span>App<span class="token operator">></span>
  <span class="token operator">&lt;</span>Header<span class="token operator">></span>
    <span class="token operator">&lt;</span>UserPanel<span class="token operator">></span>  <span class="token comment">// 状态变化影响整个 Header</span>
      <span class="token operator">&lt;</span>Avatar <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>UserPanel<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Header<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>App<span class="token operator">></span>

<span class="token comment">// ✅ 状态下沉 + 组件提权</span>
<span class="token operator">&lt;</span>App<span class="token operator">></span>
  <span class="token operator">&lt;</span>Header <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>UserPanel<span class="token operator">></span>   <span class="token comment">// 独立更新</span>
    <span class="token operator">&lt;</span>Avatar <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>UserPanel<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>App<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="React-18-并发渲染优化"><a href="#React-18-并发渲染优化" class="headerlink" title="React 18 并发渲染优化"></a>React 18 并发渲染优化</h3><p><strong>可中断渲染</strong></p>
<pre><code class="mermaid">graph LR
A[高优先级更新] --&gt; B[中断当前渲染]
B --&gt; C[执行紧急任务]
C --&gt; D[恢复渲染]</code></pre>

<p><strong>自动批处理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// React 17：仅事件处理函数内批处理</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 两次独立更新</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// React 18：所有更新自动批处理</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 合并为一次更新</span>
  <span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2-2-生命周期（类组件生命周期、useEffect-替代方案）"><a href="#2-2-生命周期（类组件生命周期、useEffect-替代方案）" class="headerlink" title="2.2 生命周期（类组件生命周期、useEffect 替代方案）"></a>2.2 生命周期（类组件生命周期、useEffect 替代方案）</h2><h3 id="类组件生命周期全景图"><a href="#类组件生命周期全景图" class="headerlink" title="类组件生命周期全景图"></a>类组件生命周期全景图</h3><pre><code class="mermaid">graph TD
  A[挂载阶段] --&gt; B[constructor]
  B --&gt; C[static getDerivedStateFromProps]
  C --&gt; D[render]
  D --&gt; E[componentDidMount]
  
  F[更新阶段] --&gt; G[static getDerivedStateFromProps]
  G --&gt; H[shouldComponentUpdate]
  H --&gt; I[render]
  I --&gt; J[getSnapshotBeforeUpdate]
  J --&gt; K[componentDidUpdate]
  
  L[卸载阶段] --&gt; M[componentWillUnmount]
  
  N[错误处理] --&gt; O[static getDerivedStateFromError]
  O --&gt; P[componentDidCatch]</code></pre>

<p>各阶段核心方法：</p>
<table>
<thead>
<tr>
<th align="left">阶段</th>
<th align="left">方法</th>
<th align="left">执行时机</th>
<th align="left">常见用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">挂载</td>
<td align="left">constructor</td>
<td align="left">组件初始化</td>
<td align="left">初始化 state，绑定 this</td>
</tr>
<tr>
<td align="left">挂载</td>
<td align="left">render</td>
<td align="left">创建虚拟 DOM</td>
<td align="left">返回 JSX 内容</td>
</tr>
<tr>
<td align="left">挂载</td>
<td align="left">componentDidMount</td>
<td align="left">DOM 挂载完成</td>
<td align="left">网络请求、订阅事件</td>
</tr>
<tr>
<td align="left">更新</td>
<td align="left">shouldComponentUpdate</td>
<td align="left">渲染前拦截</td>
<td align="left">性能优化（返回 false 阻止更新）</td>
</tr>
<tr>
<td align="left">更新</td>
<td align="left">getSnapshotBeforeUpdate</td>
<td align="left">DOM 更新前</td>
<td align="left">获取滚动位置等 DOM 信息</td>
</tr>
<tr>
<td align="left">更新</td>
<td align="left">componentDidUpdate</td>
<td align="left">DOM 更新完成</td>
<td align="left">基于新 DOM 操作</td>
</tr>
<tr>
<td align="left">卸载</td>
<td align="left">componentWillUnmount</td>
<td align="left">组件卸载前</td>
<td align="left">清理定时器、取消订阅</td>
</tr>
<tr>
<td align="left">错误</td>
<td align="left">componentDidCatch</td>
<td align="left">子组件抛出错误</td>
<td align="left">错误日志、显示降级 UI</td>
</tr>
</tbody></table>
<h3 id="函数组件-useEffect-替代方案"><a href="#函数组件-useEffect-替代方案" class="headerlink" title="函数组件 useEffect 替代方案"></a>函数组件 useEffect 替代方案</h3><p>生命周期映射关系：</p>
<pre><code class="mermaid">graph LR
  A[componentDidMount] --&gt; B[&quot;useEffect(() &#x3D;&gt; &#123;&#125;, [])&quot;]
  C[componentDidUpdate] --&gt; D[&quot;useEffect(() &#x3D;&gt; &#123;&#125;, [deps])&quot;]
  E[componentWillUnmount] --&gt; F[&quot;useEffect(() &#x3D;&gt; &#123; return cleanup &#125;, [])&quot;]
  G[shouldComponentUpdate] --&gt; H[React.memo 或 useMemo]</code></pre>

<h3 id="核心机制深度解析-1"><a href="#核心机制深度解析-1" class="headerlink" title="核心机制深度解析"></a>核心机制深度解析</h3><p><strong>useEffect 执行时机</strong></p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">执行阶段</th>
<th align="left">是否阻塞渲染</th>
<th align="left">访问 DOM</th>
</tr>
</thead>
<tbody><tr>
<td align="left">componentDidMount</td>
<td align="left">浏览器绘制后</td>
<td align="left">是</td>
<td align="left">可访问</td>
</tr>
<tr>
<td align="left">componentDidUpdate</td>
<td align="left">浏览器绘制后</td>
<td align="left">是</td>
<td align="left">可访问</td>
</tr>
<tr>
<td align="left">useEffect</td>
<td align="left">浏览器绘制前</td>
<td align="left">否（异步）</td>
<td align="left">可访问（但需注意时机）</td>
</tr>
<tr>
<td align="left">useLayoutEffect</td>
<td align="left">DOM 变更后，绘制前</td>
<td align="left">是（同步）</td>
<td align="left">可访问</td>
</tr>
</tbody></table>
<p><strong>依赖数组精妙之处</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ✅ 安全：包含所有依赖</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> total <span class="token operator">=</span> price <span class="token operator">*</span> quantity<span class="token punctuation">;</span>
  <span class="token function">setTotal</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>price<span class="token punctuation">,</span> quantity<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// ❌ 危险：缺少依赖（使用过期状态）</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> total <span class="token operator">=</span> price <span class="token operator">*</span> quantity<span class="token punctuation">;</span>
  <span class="token function">setTotal</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>price<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 缺少 quantity</span>

<span class="token comment">// ✅ 解决方案：函数式更新</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">setTotal</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> price <span class="token operator">*</span> quantity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>price<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不再依赖 quantity</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高频面试题与破解方案-2"><a href="#高频面试题与破解方案-2" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么 useEffect 可能执行两次？</strong></p>
<p>React 18+ 严格模式行为：</p>
<ul>
<li>开发环境下故意双调用：</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>React<span class="token punctuation">.</span>StrictMode<span class="token operator">></span>
  <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#123;</span><span class="token comment">/* useEffect 挂载/卸载各执行两次 */</span><span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>StrictMode<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>目的：检测不纯渲染（例如未正确实现清理）</li>
<li>解决方案：确保清理函数完全复原初始状态</li>
</ul>
<p><strong>Q：如何替代 shouldComponentUpdate？</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 方案1：React.memo 浅比较</span>
<span class="token keyword">const</span> MyComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> data <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 方案2：自定义比较</span>
<span class="token keyword">const</span> MyComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> data <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> nextProps</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> prevProps<span class="token punctuation">.</span>id <span class="token operator">===</span> nextProps<span class="token punctuation">.</span>id<span class="token punctuation">;</span> <span class="token comment">// 自定义比较逻辑</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 方案3：useMemo 控制子组件</span>
<span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> memoizedChild <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>Child data<span class="token operator">=</span><span class="token punctuation">&#123;</span>complexData<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>complexData<span class="token punctuation">]</span> <span class="token comment">// 仅 complexData 变化时重建</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">&#123;</span>memoizedChild<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Q：getSnapshotBeforeUpdate 如何替代？</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 类组件</span>
<span class="token keyword">class</span> <span class="token class-name">ScrollList</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  <span class="token function">getSnapshotBeforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span>scrollHeight<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState<span class="token punctuation">,</span> snapshot</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span>scrollTop <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span>scrollHeight <span class="token operator">-</span> snapshot<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 函数组件：useLayoutEffect + useRef</span>
<span class="token keyword">function</span> <span class="token function">ScrollList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> listRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> lastScrollHeight <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// DOM 更新后，绘制前执行（类似 getSnapshotBeforeUpdate）</span>
    lastScrollHeight<span class="token punctuation">.</span>current <span class="token operator">=</span> listRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>scrollHeight<span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 清理阶段相当于 getSnapshotBeforeUpdate</span>
      <span class="token keyword">const</span> snapshot <span class="token operator">=</span> listRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>scrollHeight<span class="token punctuation">;</span>
      listRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>scrollTop <span class="token operator">+=</span> listRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>scrollHeight <span class="token operator">-</span> lastScrollHeight<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>items<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="错误边界（Error-Boundaries）特殊说明"><a href="#错误边界（Error-Boundaries）特殊说明" class="headerlink" title="错误边界（Error Boundaries）特殊说明"></a>错误边界（Error Boundaries）特殊说明</h3><p><strong>类组件专属能力</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">ErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> info</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">logErrorToService</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> info<span class="token punctuation">.</span>componentStack<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError
      <span class="token operator">?</span> <span class="token operator">&lt;</span>FallbackComponent <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>函数组件解决方案</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用第三方库 react-error-boundary</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ErrorBoundary <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-error-boundary'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ErrorBoundary FallbackComponent<span class="token operator">=</span><span class="token punctuation">&#123;</span>ErrorFallback<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>UnstableComponent <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ErrorBoundary<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2-3-受控组件-vs-非受控组件（表单处理）"><a href="#2-3-受控组件-vs-非受控组件（表单处理）" class="headerlink" title="2.3 受控组件 vs. 非受控组件（表单处理）"></a>2.3 受控组件 vs. 非受控组件（表单处理）</h2><h3 id="核心概念对比"><a href="#核心概念对比" class="headerlink" title="核心概念对比"></a>核心概念对比</h3><table>
<thead>
<tr>
<th>特性</th>
<th>受控组件</th>
<th>非受控组件</th>
</tr>
</thead>
<tbody><tr>
<td>数据管理</td>
<td>React state 完全控制</td>
<td>DOM 节点自身管理</td>
</tr>
<tr>
<td>值获取</td>
<td>value 属性</td>
<td>ref 访问 DOM 节点</td>
</tr>
<tr>
<td>值更新</td>
<td>onChange 事件 + setState</td>
<td>用户直接输入</td>
</tr>
<tr>
<td>初始化</td>
<td>value 属性</td>
<td>defaultValue&#x2F;defaultChecked</td>
</tr>
<tr>
<td>表单提交</td>
<td>从 state 获取</td>
<td>从 ref 获取</td>
</tr>
<tr>
<td>实时验证</td>
<td>容易实现</td>
<td>需要手动监听事件</td>
</tr>
<tr>
<td>适用场景</td>
<td>复杂表单、即时验证</td>
<td>简单表单、文件上传</td>
</tr>
</tbody></table>
<h3 id="受控组件深度解析"><a href="#受控组件深度解析" class="headerlink" title="受控组件深度解析"></a>受控组件深度解析</h3><p><strong>实现原理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">ControlledForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setValue</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 完全控制输入值</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>input 
      type<span class="token operator">=</span><span class="token string">"text"</span>
      value<span class="token operator">=</span><span class="token punctuation">&#123;</span>value<span class="token punctuation">&#125;</span>       <span class="token comment">// 值绑定 state</span>
      onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleChange<span class="token punctuation">&#125;</span> <span class="token comment">// 更新 state</span>
    <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>多字段优化模式</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">MultiFieldForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>formData<span class="token punctuation">,</span> setFormData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 通用变更处理器</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> value <span class="token punctuation">&#125;</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
    <span class="token function">setFormData</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>prev<span class="token punctuation">,</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token operator">:</span> value <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>input name<span class="token operator">=</span><span class="token string">"name"</span> value<span class="token operator">=</span><span class="token punctuation">&#123;</span>formData<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleChange<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>input name<span class="token operator">=</span><span class="token string">"email"</span> value<span class="token operator">=</span><span class="token punctuation">&#123;</span>formData<span class="token punctuation">.</span>email<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleChange<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>即时验证示例</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">EmailInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>email<span class="token punctuation">,</span> setEmail<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isValid<span class="token punctuation">,</span> setIsValid<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token function">setEmail</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setIsValid</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[^\s@]+@[^\s@]+\.[^\s@]+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 实时验证</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"email"</span> value<span class="token operator">=</span><span class="token punctuation">&#123;</span>email<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleChange<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">&#123;</span><span class="token operator">!</span>isValid <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>span<span class="token operator">></span>邮箱格式错误<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="非受控组件深度解析"><a href="#非受控组件深度解析" class="headerlink" title="非受控组件深度解析"></a>非受控组件深度解析</h3><p><strong>实现原理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">UncontrolledForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 提交时获取值</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleSubmit<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>input 
        type<span class="token operator">=</span><span class="token string">"text"</span>
        ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>inputRef<span class="token punctuation">&#125;</span>          <span class="token comment">// 绑定 ref</span>
        defaultValue<span class="token operator">=</span><span class="token string">"初始值"</span>   <span class="token comment">// 仅初始值</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>button<span class="token operator">></span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>文件上传场景（必须使用非受控）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">FileUpload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> fileRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> file <span class="token operator">=</span> fileRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 处理文件...</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"file"</span> ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>fileRef<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#123;</span><span class="token comment">/* 无法受控 */</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleSubmit<span class="token punctuation">&#125;</span><span class="token operator">></span>上传<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>第三方库集成</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">RichTextEditor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> editorRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 初始化第三方编辑器</span>
    <span class="token keyword">const</span> editor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThirdPartyEditor</span><span class="token punctuation">(</span>editorRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> editor<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>editorRef<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// 非受控管理</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高频面试题与破解方案-3"><a href="#高频面试题与破解方案-3" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么文件输入必须用非受控组件？</strong></p>
<ul>
<li>安全限制：浏览器禁止 JavaScript 设置文件输入值（<code>&lt;input type=&quot;file&quot;&gt;</code>）</li>
<li>只读属性：文件路径由用户选择，程序无法控制</li>
<li>数据获取：只能通过 ref.current.files 获取文件对象</li>
</ul>
<p><strong>Q：受控组件相比非受控有何优势？</strong></p>
<ul>
<li>即时验证：每次输入都可触发验证逻辑</li>
<li>条件渲染：基于输入值动态控制其他 UI</li>
<li>状态追溯：完整的状态历史记录</li>
<li>表单重置：轻松实现 reset 功能（setState(‘’)）</li>
</ul>
<p><strong>Q：如何实现表单重置功能？</strong></p>
<p>受控组件方案：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">ResettableForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>form<span class="token punctuation">,</span> setForm<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">handleReset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setForm</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 重置 state</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>form<span class="token operator">></span>
      <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">&#123;</span>form<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token comment">/*...*/</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>button type<span class="token operator">=</span><span class="token string">"button"</span> onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleReset<span class="token punctuation">&#125;</span><span class="token operator">></span>重置<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>非受控组件：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">ResettableForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> formRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">handleReset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    formRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用原生 DOM reset</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>form ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>formRef<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>input defaultValue<span class="token operator">=</span><span class="token string">""</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>button type<span class="token operator">=</span><span class="token string">"button"</span> onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleReset<span class="token punctuation">&#125;</span><span class="token operator">></span>重置<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2-4-组件通信（父子通信、Context-API、事件总线）"><a href="#2-4-组件通信（父子通信、Context-API、事件总线）" class="headerlink" title="2.4 组件通信（父子通信、Context API、事件总线）"></a>2.4 组件通信（父子通信、Context API、事件总线）</h2><h3 id="组件通信方式全景图"><a href="#组件通信方式全景图" class="headerlink" title="组件通信方式全景图"></a>组件通信方式全景图</h3><pre><code class="mermaid">graph TD
  A[组件通信] --&gt; B[父子组件]
  A --&gt; C[兄弟组件]
  A --&gt; D[祖孙组件]
  A --&gt; E[任意组件]
  
  B --&gt; B1[Props&#x2F;回调函数]
  C --&gt; C1[状态提升]
  C --&gt; C2[通过共同父组件]
  D --&gt; D1[Context API]
  D --&gt; D2[逐层传递Props]
  E --&gt; E1[事件总线]
  E --&gt; E2[状态管理库]</code></pre>

<h3 id="父子组件通信（Props-回调）"><a href="#父子组件通信（Props-回调）" class="headerlink" title="父子组件通信（Props + 回调）"></a>父子组件通信（Props + 回调）</h3><p><strong>基础模式</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 父组件</span>
<span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">handleChildData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">childData</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setData</span><span class="token punctuation">(</span>childData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Child onDataSend<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleChildData<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 子组件</span>
<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> onDataSend <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">onDataSend</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>发送数据<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>多层透传问题</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 祖孙组件通信（不推荐）</span>
<span class="token keyword">function</span> <span class="token function">Grandparent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Parent data<span class="token operator">=</span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> data <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Child data<span class="token operator">=</span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// 中间层被迫传递</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> data <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>痛点：Props drilling（属性钻探）导致代码冗余</p>
<h3 id="Context-API-深度解析"><a href="#Context-API-深度解析" class="headerlink" title="Context API 深度解析"></a>Context API 深度解析</h3><p><strong>核心三要素</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 1. 创建Context</span>
<span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">'light'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 默认值</span>

<span class="token comment">// 2. Provider 提供数据</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>theme<span class="token punctuation">,</span> setTheme<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'dark'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> theme<span class="token punctuation">,</span> setTheme <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Toolbar <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 3. Consumer 消费数据（两种方式）</span>
<span class="token comment">// 方式1：useContext Hook</span>
<span class="token keyword">function</span> <span class="token function">Button</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> theme <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ThemeContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>button className<span class="token operator">=</span><span class="token punctuation">&#123;</span>theme<span class="token punctuation">&#125;</span><span class="token operator">></span>按钮<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 方式2：Context.Consumer</span>
<span class="token keyword">function</span> <span class="token function">Button</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span>
      <span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> theme <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>button className<span class="token operator">=</span><span class="token punctuation">&#123;</span>theme<span class="token punctuation">&#125;</span><span class="token operator">></span>按钮<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>性能优化策略</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 错误写法：直接传递对象</span>
<span class="token operator">&lt;</span>MyContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> theme<span class="token punctuation">,</span> setTheme <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
  <span class="token operator">...</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>MyContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>

<span class="token comment">// ✅ 正确方案：useMemo 缓存值</span>
<span class="token keyword">const</span> contextValue <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> theme<span class="token punctuation">,</span> setTheme <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>theme<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>MyContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span>contextValue<span class="token punctuation">&#125;</span><span class="token operator">></span>
    <span class="token operator">...</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>MyContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>多层Context嵌套</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>UserContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span>user<span class="token punctuation">&#125;</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span>theme<span class="token punctuation">&#125;</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>LayoutContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span>layout<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>AppContent <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>LayoutContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>UserContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>

<span class="token comment">// 消费时自动匹配最近Provider</span>
<span class="token keyword">function</span> <span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>UserContext<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 获取user</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ThemeContext<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 获取theme</span>
  <span class="token keyword">const</span> layout <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>LayoutContext<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 获取layout</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="事件总线（Event-Bus）模式"><a href="#事件总线（Event-Bus）模式" class="headerlink" title="事件总线（Event Bus）模式"></a>事件总线（Event Bus）模式</h3><p><strong>实现原理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// eventBus.js</span>
<span class="token keyword">const</span> events <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
  <span class="token function">$on</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span> <span class="token operator">=</span> events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  
  <span class="token function">$off</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span> <span class="token operator">=</span> events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">f</span> <span class="token operator">=></span> f <span class="token operator">!==</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  
  <span class="token function">$emit</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=></span> <span class="token function">fn</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>React 组件中使用</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 组件A（发布事件）</span>
<span class="token keyword">import</span> eventBus <span class="token keyword">from</span> <span class="token string">'./eventBus'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">ComponentA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    eventBus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token string">'数据内容'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleClick<span class="token punctuation">&#125;</span><span class="token operator">></span>发送<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 组件B（订阅事件）</span>
<span class="token keyword">function</span> <span class="token function">ComponentB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>msg<span class="token punctuation">,</span> setMsg<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setMsg</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    eventBus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> eventBus<span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 清理</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">&#123;</span>msg<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>适用场景与风险</strong></p>
<table>
<thead>
<tr>
<th align="left">优点</th>
<th align="left">缺点</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">跨任意组件通信</td>
<td align="left">破坏组件独立性</td>
<td align="left">微前端架构通信</td>
</tr>
<tr>
<td align="left">解耦性强</td>
<td align="left">难以追踪数据流</td>
<td align="left">非父子组件简单交互</td>
</tr>
<tr>
<td align="left">实现简单</td>
<td align="left">可能内存泄漏（未及时取消订阅）</td>
<td align="left">第三方库事件通知</td>
</tr>
</tbody></table>
<h3 id="高级通信模式"><a href="#高级通信模式" class="headerlink" title="高级通信模式"></a>高级通信模式</h3><p><strong>状态提升 + Context 组合</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 创建共享状态上下文</span>
<span class="token keyword">const</span> SharedStateContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>SharedStateContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> state<span class="token punctuation">,</span> setState <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>ComponentA <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>ComponentB <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>SharedStateContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 任意子组件消费</span>
<span class="token keyword">function</span> <span class="token function">ComponentA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> state<span class="token punctuation">,</span> setState <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>SharedStateContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Render Props 模式</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 数据提供者</span>
<span class="token keyword">class</span> <span class="token class-name">DataProvider</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> data <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关键</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 消费组件</span>
<span class="token keyword">function</span> <span class="token function">Consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>DataProvider<span class="token operator">></span>
      <span class="token punctuation">&#123;</span><span class="token parameter">data</span> <span class="token operator">=></span> data <span class="token operator">?</span> <span class="token operator">&lt;</span>ShowData data<span class="token operator">=</span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span> <span class="token operator">:</span> <span class="token operator">&lt;</span>Loading <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>DataProvider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>观察者模式（Pub&#x2F;Sub）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用第三方库 (rxjs)</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Subject <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> message$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 发布</span>
<span class="token keyword">function</span> <span class="token function">publishMessage</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  message$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 订阅</span>
message$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">text</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'收到消息:'</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高频面试题与破解方案-4"><a href="#高频面试题与破解方案-4" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q:：Context 与 Redux 如何选择？</strong></p>
<pre><code class="mermaid">graph TD
A[需要全局状态?] --&gt;|是| B[状态更新频率高?]
A --&gt;|否| C[用Props&#x2F;状态提升]
B --&gt;|是| D[用Redux&#x2F;Zustand]
B --&gt;|否| E[用Context API]</code></pre>

<p>关键区别：</p>
<ul>
<li>Context：轻量级，适合低频更新（主题&#x2F;用户信息）</li>
<li>Redux：重量级，适合高频更新+时间旅行调试</li>
</ul>
<p><strong>Q：如何避免 Context 性能问题？</strong></p>
<ul>
<li>拆分 Context：按业务分离（用户Context&#x2F;主题Context）</li>
<li>使用 React.memo：防止无关组件重渲染</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> Child <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> nonContextProp <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>选择订阅：使用 use-context-selector 库</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useContextSelector <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'use-context-selector'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">useContextSelector</span><span class="token punctuation">(</span>ThemeContext<span class="token punctuation">,</span> <span class="token parameter">ctx</span> <span class="token operator">=></span> ctx<span class="token punctuation">.</span>theme<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>Q：事件总线会导致什么问题？</strong></p>
<ul>
<li>内存泄漏：组件卸载时取消订阅</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  bus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> bus<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>事件冲突：使用命名空间</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">bus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'moduleA:event'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>调试困难：添加事件日志</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[Event] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>event<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...原逻辑</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2-5-Refs-使用场景（DOM-操作、forwardRef）"><a href="#2-5-Refs-使用场景（DOM-操作、forwardRef）" class="headerlink" title="2.5 Refs 使用场景（DOM 操作、forwardRef）"></a>2.5 Refs 使用场景（DOM 操作、forwardRef）</h2><h3 id="Refs-核心概念全景图"><a href="#Refs-核心概念全景图" class="headerlink" title="Refs 核心概念全景图"></a>Refs 核心概念全景图</h3><pre><code class="mermaid">graph TD
  A[Refs 类型] --&gt; B[对象 Ref]
  A --&gt; C[回调 Ref]
  A --&gt; D[函数组件 useRef]
  
  E[使用场景] --&gt; F[访问 DOM 节点]
  E --&gt; G[访问类组件实例]
  E --&gt; H[存储可变值]
  E --&gt; I[集成第三方库]
  
  J[高级特性] --&gt; K[forwardRef 转发]
  J --&gt; L[useImperativeHandle 暴露方法]</code></pre>

<h3 id="三大-Refs-创建方式"><a href="#三大-Refs-创建方式" class="headerlink" title="三大 Refs 创建方式"></a>三大 Refs 创建方式</h3><p><strong>对象 Ref（类组件）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">AutoFocusInput</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  inputRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 创建 Ref 对象</span>
  
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 访问 DOM 节点</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>inputRef<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>回调 Ref（动态场景）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">DynamicRef</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">setRef</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      element<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 元素挂载时执行</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>setRef<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>useRef Hook（函数组件）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">FocusInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 创建 Ref</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 挂载后聚焦</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>inputRef<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="核心使用场景深度解析"><a href="#核心使用场景深度解析" class="headerlink" title="核心使用场景深度解析"></a>核心使用场景深度解析</h3><p><strong>DOM 操作（核心场景）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">VideoPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> videoRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">play</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> videoRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">pause</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> videoRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>video ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>videoRef<span class="token punctuation">&#125;</span> src<span class="token operator">=</span><span class="token string">"movie.mp4"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>play<span class="token punctuation">&#125;</span><span class="token operator">></span>播放<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>pause<span class="token punctuation">&#125;</span><span class="token operator">></span>暂停<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>存储可变值（不触发重渲染）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> intervalRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 存储计时器 ID</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    intervalRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 停止计时器（不依赖 state）</span>
  <span class="token keyword">const</span> <span class="token function-variable function">stop</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>stop<span class="token punctuation">&#125;</span><span class="token operator">></span>停止<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>类组件方法调用</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 子组件（类组件）</span>
<span class="token keyword">class</span> <span class="token class-name">AudioPlayer</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">play</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>audio<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function-variable function">pause</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>audio<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>audio ref<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token parameter">el</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>audio <span class="token operator">=</span> el<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 父组件</span>
<span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> playerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>AudioPlayer ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>playerRef<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> playerRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>播放<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>第三方库集成</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">ChartContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> chartRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> chartInstance <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 初始化图表</span>
    chartInstance<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThirdPartyChart</span><span class="token punctuation">(</span>chartRef<span class="token punctuation">.</span>current<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> chartInstance<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 清理</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>data<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>chartRef<span class="token punctuation">&#125;</span> style<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">'400px'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="forwardRef-转发机制"><a href="#forwardRef-转发机制" class="headerlink" title="forwardRef 转发机制"></a>forwardRef 转发机制</h3><p><strong>问题背景：函数组件不能直接使用 ref</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 错误用法：函数组件无实例</span>
<span class="token keyword">const</span> <span class="token function-variable function">MyInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> value <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">&#123;</span>value<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 无效！inputRef.current 将为 null</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>MyInput ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>inputRef<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>forwardRef 解决方案</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> MyInput <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>input <span class="token punctuation">&#123;</span><span class="token operator">...</span>props<span class="token punctuation">&#125;</span> ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>ref<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ✅ 现在可以操作 DOM</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>MyInput ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>inputRef<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>转发多个 ref</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> MultiInput <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> input1Ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> input2Ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 合并 ref 到父组件</span>
  <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token function-variable function">focusFirst</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> input1Ref<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">focusSecond</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> input2Ref<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>input1Ref<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>input2Ref<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 父组件使用</span>
<span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> inputsRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>MultiInput ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>inputsRef<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> inputsRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focusFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>聚焦输入<span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="useImperativeHandle-高级用法"><a href="#useImperativeHandle-高级用法" class="headerlink" title="useImperativeHandle 高级用法"></a>useImperativeHandle 高级用法</h3><p><strong>暴露自定义方法</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> FancyInput <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token comment">// 暴露特定方法</span>
    <span class="token function-variable function">focus</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">scrollIntoView</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">// 限制访问 DOM 节点</span>
    <span class="token function-variable function">getValue</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>value
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>inputRef<span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>props<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 父组件</span>
<span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>FancyInput ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>inputRef<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>聚焦<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>获取值<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>依赖项控制</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token comment">// 当 value 变化时更新方法</span>
  <span class="token function-variable function">getValue</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>value
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>props<span class="token punctuation">.</span>value<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 依赖项数组</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高频面试题与破解方案-5"><a href="#高频面试题与破解方案-5" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么函数组件默认不能使用 ref？</strong></p>
<ul>
<li>函数组件无实例，ref 无法指向组件对象</li>
<li>React 设计哲学：避免直接操作子组件</li>
<li>解决方案：forwardRef + useImperativeHandle</li>
</ul>
<p><strong>Q：useRef 和 useState 有何区别？</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">useRef</th>
<th align="left">useState</th>
</tr>
</thead>
<tbody><tr>
<td align="left">触发重渲染</td>
<td align="left">否</td>
<td align="left">是</td>
</tr>
<tr>
<td align="left">存储值类型</td>
<td align="left">可变对象（.current）</td>
<td align="left">不可变状态</td>
</tr>
<tr>
<td align="left">数据持久化</td>
<td align="left">组件生命周期</td>
<td align="left">状态更新保留</td>
</tr>
<tr>
<td align="left">典型用途</td>
<td align="left">DOM 引用&#x2F;计时器 ID</td>
<td align="left">渲染相关状态</td>
</tr>
</tbody></table>
<p><strong>Q：回调 Ref 有何特殊用途？</strong></p>
<p>(1) 动态绑定：可在运行时切换 ref 目标</p>
<pre class="line-numbers language-HTML" data-language="HTML"><code class="language-HTML">&lt;input ref&#x3D;&#123;condition ? ref1 : ref2&#125; &#x2F;&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>(2) 精细控制：元素挂载&#x2F;卸载时执行逻辑</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">measureRef</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'尺寸:'</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="总结：Refs-使用决策"><a href="#总结：Refs-使用决策" class="headerlink" title="总结：Refs 使用决策"></a>总结：Refs 使用决策</h3><pre><code class="mermaid">graph TD
  A[是否需要操作 DOM?] --&gt;|是| B[使用 Ref]
  A --&gt;|否| C[考虑 State]
  B --&gt; D&#123;组件类型?&#125;
  D --&gt;|函数组件| E[useRef + forwardRef]
  D --&gt;|类组件| F[createRef]
  B --&gt; G&#123;需要暴露方法?&#125;
  G --&gt;|是| H[useImperativeHandle]
  G --&gt;|否| I[直接访问 DOM]</code></pre>

<h1 id="第三章：Hooks-深度解析"><a href="#第三章：Hooks-深度解析" class="headerlink" title="第三章：Hooks 深度解析"></a>第三章：Hooks 深度解析</h1><h2 id="3-1-useState-与状态管理"><a href="#3-1-useState-与状态管理" class="headerlink" title="3.1 useState 与状态管理"></a>3.1 useState 与状态管理</h2><h3 id="基础概念概述-4"><a href="#基础概念概述-4" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><p><strong>useState 作用</strong>：函数组件中添加状态能力的 Hook，替代类组件的 this.state</p>
<p>基本语法：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>state：当前状态值</li>
<li>setState：状态更新函数</li>
<li>initialValue：初始状态（支持惰性初始化）</li>
</ul>
<h3 id="核心机制深度解析-2"><a href="#核心机制深度解析-2" class="headerlink" title="核心机制深度解析"></a>核心机制深度解析</h3><p><strong>闭包状态快照原理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 闭包捕获当前 count 值</span>
    
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 输出旧值（状态更新是异步的）</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>increment<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>关键特性：</p>
<ul>
<li>每次渲染都有独立的函数作用域</li>
<li>状态更新函数调用时使用当次渲染的快照值</li>
<li>状态更新触发重新渲染（生成新的闭包）</li>
</ul>
<p><strong>函数式更新解决闭包陷阱</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 闭包陷阱（连续点击只增加1）</span>
<span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ✅ 函数式更新（连续点击增加2）</span>
<span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> prev <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> prev <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>原理：更新函数接收 previous state 参数，React 保证这是最新状态</p>
<p><strong>状态批处理机制（React 18+）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token parameter">f</span> <span class="token operator">=></span> <span class="token operator">!</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// React 18：自动批处理为单次渲染</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>事件循环中的表现：</p>
<pre><code class="mermaid">sequenceDiagram
  participant UI as 用户界面
  participant React as React 运行时
  UI-&gt;&gt;React: 触发事件
  React-&gt;&gt;React: 执行所有 setState
  React-&gt;&gt;React: 合并状态更新
  React-&gt;&gt;UI: 单次重渲染</code></pre>

<p><strong>惰性初始化（Lazy Initialization）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ✅ 避免重复计算初始值</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token function">computeExpensiveValue</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> initialState<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>初始化函数仅在挂载时执行一次</li>
<li>避免重新渲染时重复计算</li>
</ul>
<h3 id="状态管理进阶模式"><a href="#状态管理进阶模式" class="headerlink" title="状态管理进阶模式"></a>状态管理进阶模式</h3><p><strong>状态依赖更新</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 当 count 变化时重置 page</span>
  <span class="token function">setPage</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 依赖项触发状态重置</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>状态提升与下沉策略</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 状态提升：共享状态到共同祖先</span>
<span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>sharedState<span class="token punctuation">,</span> setSharedState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ChildA state<span class="token operator">=</span><span class="token punctuation">&#123;</span>sharedState<span class="token punctuation">&#125;</span> setState<span class="token operator">=</span><span class="token punctuation">&#123;</span>setSharedState<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>ChildB state<span class="token operator">=</span><span class="token punctuation">&#123;</span>sharedState<span class="token punctuation">&#125;</span> setState<span class="token operator">=</span><span class="token punctuation">&#123;</span>setSharedState<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 状态下沉：缩小状态影响范围</span>
<span class="token keyword">function</span> <span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 只有按钮依赖 count</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ExpensiveComponent <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>Button count<span class="token operator">=</span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span> onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>状态合并模式</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 方案1：使用对象</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">flag</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>prev<span class="token punctuation">,</span> <span class="token literal-property property">count</span><span class="token operator">:</span> prev<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 方案2：多个 useState</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>flag<span class="token punctuation">,</span> setFlag<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 方案3：useReducer（复杂状态）</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">flag</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高频面试题与破解方案-6"><a href="#高频面试题与破解方案-6" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么连续调用 setState 不更新？</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 本次渲染 count=0</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 本次渲染 count=0</span>
  <span class="token comment">// 结果：count 只增加1</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>闭包捕获的 count 是当次渲染的固定值，解决方案：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ✅ 函数式更新</span>
<span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> prev <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> prev <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>Q：useState 和 useRef 存储数据有何区别？</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">useState</th>
<th align="left">useRef</th>
</tr>
</thead>
<tbody><tr>
<td align="left">触发重渲染</td>
<td align="left">是</td>
<td align="left">否</td>
</tr>
<tr>
<td align="left">数据持久化</td>
<td align="left">跨渲染保留</td>
<td align="left">跨渲染保留</td>
</tr>
<tr>
<td align="left">数据访问</td>
<td align="left">直接使用 state</td>
<td align="left">通过 .current 访问</td>
</tr>
<tr>
<td align="left">更新方式</td>
<td align="left">setState 函数</td>
<td align="left">直接修改 .current</td>
</tr>
<tr>
<td align="left">典型用途</td>
<td align="left">驱动 UI 变化的状态</td>
<td align="left">DOM 引用&#x2F;不触发渲染的值</td>
</tr>
</tbody></table>
<p><strong>Q：如何实现状态重置？</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> initialUser <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> setUser<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ✅ 正确：重置为初始值</span>
    <span class="token function">setUser</span><span class="token punctuation">(</span>initialUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// ❌ 危险：可能导致引用问题</span>
    <span class="token comment">// setUser(&#123; name: 'John', age: 30 &#125;);</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="性能优化技巧-1"><a href="#性能优化技巧-1" class="headerlink" title="性能优化技巧"></a>性能优化技巧</h3><p><strong>避免不必要状态</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 冗余状态（可从 props 派生）</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>fullName<span class="token punctuation">,</span> setFullName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>surname<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ✅ 直接用计算值</span>
<span class="token keyword">const</span> fullName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>surname<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>状态隔离减少重渲染</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 原始结构：状态变化导致整个组件重渲染</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 优化方案：拆分为独立状态</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> setA<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>b<span class="token punctuation">,</span> setB<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>状态记忆化</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ✅ 避免子组件不必要重渲染</span>
  <span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>ExpensiveChild count<span class="token operator">=</span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>count<span class="token punctuation">]</span> <span class="token comment">// 仅 count 变化时更新</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">&#123;</span>child<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="与类组件状态对比"><a href="#与类组件状态对比" class="headerlink" title="与类组件状态对比"></a>与类组件状态对比</h3><table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">useState</th>
<th align="left">this.state</th>
</tr>
</thead>
<tbody><tr>
<td align="left">更新方式</td>
<td align="left">独立 set 函数</td>
<td align="left">this.setState({})</td>
</tr>
<tr>
<td align="left">状态合并</td>
<td align="left">不自动合并</td>
<td align="left">自动浅合并</td>
</tr>
<tr>
<td align="left">异步行为</td>
<td align="left">批处理更新</td>
<td align="left">批处理更新</td>
</tr>
<tr>
<td align="left">函数式更新</td>
<td align="left">setCount(prev &#x3D;&gt; prev+1)</td>
<td align="left">this.setState(prev &#x3D;&gt; {})</td>
</tr>
<tr>
<td align="left">初始化</td>
<td align="left">支持惰性初始化函数</td>
<td align="left">构造函数中初始化</td>
</tr>
</tbody></table>
<h3 id="React-18-新特性：自动批处理"><a href="#React-18-新特性：自动批处理" class="headerlink" title="React 18 新特性：自动批处理"></a>React 18 新特性：自动批处理</h3><p><strong>批处理范围扩展</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// React 17：只在事件处理函数中批处理</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 立即渲染</span>
  <span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 再次渲染</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// React 18：自动批处理所有更新</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 合并更新</span>
  <span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 单次渲染</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>紧急更新与非紧急更新</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> startTransition <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// 紧急更新（用户输入）</span>
<span class="token function">setInputValue</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 标记非紧急更新（搜索结果）</span>
<span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">setSearchQuery</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="3-2-useEffect-与副作用（依赖数组、清理函数）"><a href="#3-2-useEffect-与副作用（依赖数组、清理函数）" class="headerlink" title="3.2 useEffect 与副作用（依赖数组、清理函数）"></a>3.2 useEffect 与副作用（依赖数组、清理函数）</h2><h3 id="基础概念概述-5"><a href="#基础概念概述-5" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><p>useEffect 作用：处理副作用操作：数据获取、订阅管理、手动 DOM 操作等</p>
<p>核心参数：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 副作用逻辑</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">/* 清理函数 */</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dependencies<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 依赖数组</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>执行时机:</p>
<ul>
<li>组件挂载后（componentDidMount）</li>
<li>依赖项变化时（componentDidUpdate）</li>
<li>组件卸载前执行清理（componentWillUnmount）</li>
</ul>
<h3 id="依赖数组深度解析"><a href="#依赖数组深度解析" class="headerlink" title="依赖数组深度解析"></a>依赖数组深度解析</h3><p><strong>三种依赖模式对比</strong></p>
<table>
<thead>
<tr>
<th align="left">依赖数组</th>
<th align="left">执行时机</th>
<th align="left">常见用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[]</td>
<td align="left">仅挂载时执行一次</td>
<td align="left">初始化请求、事件订阅</td>
</tr>
<tr>
<td align="left">[dep1, dep2]</td>
<td align="left">依赖变化时执行</td>
<td align="left">数据请求、状态联动</td>
</tr>
<tr>
<td align="left">无依赖</td>
<td align="left">每次渲染后都执行</td>
<td align="left">极少使用（性能危险）</td>
</tr>
</tbody></table>
<p><strong>依赖项优化技巧</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 错误：缺少必要依赖</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">fetchData</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 当 user.id 变化时不会重新请求</span>

<span class="token comment">// ✅ 正确：包含所有依赖</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">fetchData</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>user<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// ✅ 高级：函数式更新避免依赖</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> prev <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不依赖 count</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 空依赖安全</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>依赖引用陷阱</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 问题：对象引用变化导致无限循环</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">startTimer</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>config<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 每次渲染 config 都是新对象</span>

<span class="token comment">// ✅ 解决方案：useMemo 稳定引用</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="清理函数高级用法"><a href="#清理函数高级用法" class="headerlink" title="清理函数高级用法"></a>清理函数高级用法</h3><p><strong>执行机制</strong></p>
<pre><code class="mermaid">sequenceDiagram
  participant Mount as 组件挂载
  participant Update as 依赖更新
  participant Unmount as 组件卸载
  Mount-&gt;&gt;+Effect: 执行副作用
  Update-&gt;&gt;+Cleanup: 执行旧清理函数
  Update-&gt;&gt;+Effect: 执行新副作用
  Unmount-&gt;&gt;+Cleanup: 执行清理函数</code></pre>

<p><strong>常见清理场景</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 1. 清除定时器</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token comment">/*...*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 取消网络请求</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span>signal <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取消未完成请求</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. 移除事件监听</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handleResize</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token comment">/*...*/</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>清理函数闭包特性</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 总是初始值（闭包陷阱）</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ✅ 解决方案：使用 ref 保存最新值</span>
<span class="token keyword">const</span> countRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
countRef<span class="token punctuation">.</span>current <span class="token operator">=</span> count<span class="token punctuation">;</span>

<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>countRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 最新值</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高频面试题与破解方案-7"><a href="#高频面试题与破解方案-7" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：如何避免 useEffect 无限循环？</strong></p>
<p>常见原因：</p>
<ul>
<li>副作用内更新依赖项状态</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 危险：更新状态触发重渲染</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 每次count变化又触发</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>依赖引用类型未优化</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 对象字面量导致无限循环</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> data <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 每次新对象</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>解决方案：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ✅ 方案1：检查依赖链，移除不必要的状态更新</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>needsUpdate<span class="token punctuation">)</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 条件执行</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>data<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ✅ 方案2：使用 useMemo 稳定依赖</span>
<span class="token keyword">const</span> stableData <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> data<span class="token punctuation">,</span> <span class="token punctuation">[</span>data<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token comment">/*...*/</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>stableData<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Q：为什么严格模式下 useEffect 执行两次？</strong></p>
<p>React 18 严格模式行为：</p>
<ul>
<li>开发环境故意双调用组件（挂载 → 卸载 → 挂载）</li>
<li>目的：暴露未正确清理的副作用</li>
<li>生产环境无此行为</li>
</ul>
<p>正确应对：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  connection<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> connection<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 确保完全清理</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Q：useEffect 和 useLayoutEffect 有何区别？</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">useEffect</th>
<th align="left">useLayoutEffect</th>
</tr>
</thead>
<tbody><tr>
<td align="left">执行时机</td>
<td align="left">浏览器绘制后异步执行</td>
<td align="left">DOM 更新后，绘制前同步执行</td>
</tr>
<tr>
<td align="left">阻塞渲染</td>
<td align="left">否</td>
<td align="left">是</td>
</tr>
<tr>
<td align="left">使用场景</td>
<td align="left">数据获取、订阅等</td>
<td align="left">DOM 测量、同步样式变更</td>
</tr>
<tr>
<td align="left">服务端渲染</td>
<td align="left">正常执行</td>
<td align="left">警告（需用 useEffect 替代）</td>
</tr>
</tbody></table>
<h3 id="自定义-Hook-封装"><a href="#自定义-Hook-封装" class="headerlink" title="自定义 Hook 封装"></a>自定义 Hook 封装</h3><p><strong>通用数据请求 Hook</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">useFetch</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> initialData</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>loading<span class="token punctuation">,</span> setLoading<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> isActive <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isActive<span class="token punctuation">)</span> <span class="token function">setData</span><span class="token punctuation">(</span><span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isActive<span class="token punctuation">)</span> <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> isActive <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> loading <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> loading <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useFetch</span><span class="token punctuation">(</span><span class="token string">'/api/user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>事件监听 Hook</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">useEventListener</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> handler<span class="token punctuation">,</span> element <span class="token operator">=</span> window</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> savedHandler <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    savedHandler<span class="token punctuation">.</span>current <span class="token operator">=</span> handler<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>handler<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">eventListener</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=></span> savedHandler<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> eventListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> element<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> eventListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>eventName<span class="token punctuation">,</span> element<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="3-3-useContext-与全局状态共享"><a href="#3-3-useContext-与全局状态共享" class="headerlink" title="3.3 useContext 与全局状态共享"></a>3.3 useContext 与全局状态共享</h2><h3 id="基础概念概述-6"><a href="#基础概念概述-6" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><p>useContext 作用：解决组件跨层级通信问题，避免 Props drilling（属性钻探）</p>
<p>核心三要素</p>
<ul>
<li>React.createContext()：创建上下文对象</li>
<li><code>&lt;Context.Provider&gt;</code>：提供数据</li>
<li>useContext()：消费数据</li>
</ul>
<p>典型场景:主题切换、用户认证、多语言、全局配置等跨组件共享数据</p>
<h3 id="上下文工作流程详解"><a href="#上下文工作流程详解" class="headerlink" title="上下文工作流程详解"></a>上下文工作流程详解</h3><pre><code class="mermaid">graph TD
  A[创建Context] --&gt; B[Provider 提供数据]
  B --&gt; C[子组件消费数据]
  C --&gt; D&#123;消费方式&#125;
  D --&gt; E[useContext Hook]
  D --&gt; F[Context.Consumer]
  D --&gt; G[Class.contextType]</code></pre>

<p>完整使用示例:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 1. 创建上下文</span>
<span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">'light'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 默认值</span>

<span class="token comment">// 2. Provider 提供数据</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>theme<span class="token punctuation">,</span> setTheme<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'dark'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> theme<span class="token punctuation">,</span> setTheme <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Header <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Content <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 3. 函数组件消费</span>
<span class="token keyword">function</span> <span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> theme <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ThemeContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>header className<span class="token operator">=</span><span class="token punctuation">&#123;</span>theme<span class="token punctuation">&#125;</span><span class="token operator">></span>标题<span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 4. 类组件消费</span>
<span class="token keyword">class</span> <span class="token class-name">Content</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">static</span> contextType <span class="token operator">=</span> ThemeContext<span class="token punctuation">;</span> <span class="token comment">// 类组件绑定</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> theme <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>main className<span class="token operator">=</span><span class="token punctuation">&#123;</span>theme<span class="token punctuation">&#125;</span><span class="token operator">></span>内容<span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高级应用模式"><a href="#高级应用模式" class="headerlink" title="高级应用模式"></a>高级应用模式</h3><p><strong>自定义 Hook 封装</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 创建自定义上下文 Hook</span>
<span class="token keyword">function</span> <span class="token function">useTheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ThemeContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'useTheme 必须在 ThemeProvider 内使用'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> context<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 在组件中使用</span>
<span class="token keyword">function</span> <span class="token function">ThemedButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> theme<span class="token punctuation">,</span> toggleTheme <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useTheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>toggleTheme<span class="token punctuation">&#125;</span> className<span class="token operator">=</span><span class="token punctuation">&#123;</span>theme<span class="token punctuation">&#125;</span><span class="token operator">></span>
      切换主题
    <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高频面试题与破解方案-8"><a href="#高频面试题与破解方案-8" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：Context 与 Redux 如何选择？</strong></p>
<p>决策矩阵：</p>
<table>
<thead>
<tr>
<th align="left">考量因素</th>
<th align="left">Context</th>
<th align="left">Redux</th>
</tr>
</thead>
<tbody><tr>
<td align="left">使用复杂度</td>
<td align="left">简单</td>
<td align="left">复杂（action&#x2F;reducer）</td>
</tr>
<tr>
<td align="left">性能优化</td>
<td align="left">需手动优化</td>
<td align="left">内置精细更新</td>
</tr>
<tr>
<td align="left">中间件支持</td>
<td align="left">不支持</td>
<td align="left">支持（thunk&#x2F;saga）</td>
</tr>
<tr>
<td align="left">调试工具</td>
<td align="left">无</td>
<td align="left">Redux DevTools</td>
</tr>
<tr>
<td align="left">适用场景</td>
<td align="left">低频更新数据（主题&#x2F;用户）</td>
<td align="left">高频更新&#x2F;复杂状态逻辑</td>
</tr>
</tbody></table>
<p>总结：</p>
<ul>
<li>中小应用：Context + useReducer</li>
<li>大型应用：Redux&#x2F;Zustand</li>
</ul>
<p><strong>Q：为什么 Context 会导致不必要的重渲染？</strong></p>
<p>根本原因：</p>
<p>Context 使用 值比较（value comparison），当 Provider 的 value 变化时，所有消费该 Context 的组件都会重渲染，无论是否使用变化的部分。</p>
<p>解决方案：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 1. 拆分 Context（如前文示例）</span>
<span class="token comment">// 2. 使用 React.memo 优化子组件</span>
<span class="token keyword">const</span> ExpensiveComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. 使用选择器库（use-context-selector）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Q：如何检测 Context 未提供？</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 创建时设置默认值（生产环境有用）</span>
<span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">'light'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 自定义 Hook 添加检测</span>
<span class="token keyword">function</span> <span class="token function">useTheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ThemeContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 未提供时使用默认值</span>
    <span class="token keyword">return</span> <span class="token string">'light'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">return</span> context<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="3-4-useReducer-与复杂状态逻辑"><a href="#3-4-useReducer-与复杂状态逻辑" class="headerlink" title="3.4 useReducer 与复杂状态逻辑"></a>3.4 useReducer 与复杂状态逻辑</h2><h3 id="基础概念概述-7"><a href="#基础概念概述-7" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><p>useReducer 作用：管理复杂状态逻辑的 Hook，是 useState 的替代方案，借鉴 Redux 的核心思想</p>
<p>核心参数：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">,</span> initFunc<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>reducer：状态更新函数 (state, action) &#x3D;&gt; newState</li>
<li>initialState：初始状态</li>
<li>initFunc：惰性初始化函数（可选）</li>
</ul>
<p>三大要素:</p>
<ul>
<li>State：应用的状态数据</li>
<li>Action：描述状态变化的普通对象</li>
<li>Dispatch：触发状态更新的函数 dispatch(action)</li>
</ul>
<h3 id="核心机制深度解析-3"><a href="#核心机制深度解析-3" class="headerlink" title="核心机制深度解析"></a>核心机制深度解析</h3><p><strong>Reducer 函数工作原理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 典型 reducer 结构</span>
<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'increment'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'decrement'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'set_user'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">user</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span> <span class="token comment">// 必须返回默认状态</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>状态更新流程</strong></p>
<pre><code class="mermaid">sequenceDiagram
  participant Component as 组件
  participant Reducer as Reducer函数
  participant React as React运行时
  
  Component-&gt;&gt;Reducer: dispatch(&#123; type: &#39;increment&#39; &#125;)
  Reducer-&gt;&gt;Reducer: 计算新状态 (state + 1)
  Reducer-&gt;&gt;React: 返回新状态
  React-&gt;&gt;Component: 触发重渲染</code></pre>

<p><strong>与 useState 对比</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">useReducer</th>
<th align="left">useState</th>
</tr>
</thead>
<tbody><tr>
<td align="left">适用场景</td>
<td align="left">复杂状态逻辑</td>
<td align="left">简单状态</td>
</tr>
<tr>
<td align="left">状态结构</td>
<td align="left">对象&#x2F;复杂结构</td>
<td align="left">任意类型</td>
</tr>
<tr>
<td align="left">更新逻辑</td>
<td align="left">集中管理（reducer）</td>
<td align="left">分散在组件中</td>
</tr>
<tr>
<td align="left">性能优化</td>
<td align="left">容易避免不必要更新</td>
<td align="left">需手动优化</td>
</tr>
<tr>
<td align="left">测试</td>
<td align="left">纯函数易于测试</td>
<td align="left">需渲染组件测试</td>
</tr>
</tbody></table>
<h3 id="高级应用模式-1"><a href="#高级应用模式-1" class="headerlink" title="高级应用模式"></a>高级应用模式</h3><p><strong>中间件模式（类似 Redux）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 增强 dispatch 函数</span>
<span class="token keyword">function</span> <span class="token function">useReducerWithMiddleware</span><span class="token punctuation">(</span><span class="token parameter">reducer<span class="token punctuation">,</span> initialState</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 支持中间件链</span>
  <span class="token keyword">const</span> <span class="token function-variable function">dispatchWithMiddleware</span> <span class="token operator">=</span> <span class="token parameter">action</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Action:'</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 日志中间件</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 继续传递</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatchWithMiddleware<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="复杂状态管理实战"><a href="#复杂状态管理实战" class="headerlink" title="复杂状态管理实战"></a>复杂状态管理实战</h3><p><strong>表单状态管理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">formReducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'change_field'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        <span class="token punctuation">[</span>action<span class="token punctuation">.</span>field<span class="token punctuation">]</span><span class="token operator">:</span> action<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token literal-property property">touched</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">.</span>touched<span class="token punctuation">,</span> <span class="token punctuation">[</span>action<span class="token punctuation">.</span>field<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'validate'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">errors</span><span class="token operator">:</span> <span class="token function">validateForm</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'submit'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">isSubmitting</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'submit_success'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>initialState<span class="token punctuation">,</span> <span class="token literal-property property">submitSuccess</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">Form</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>formReducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'change_field'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">field</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>异步操作管理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">asyncReducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'FETCH_START'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'FETCH_SUCCESS'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'FETCH_FAILURE'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> action<span class="token punctuation">.</span>error <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">UserProfile</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> userId <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>asyncReducer<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">fetchUser</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'FETCH_START'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'FETCH_SUCCESS'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> data <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'FETCH_FAILURE'</span><span class="token punctuation">,</span> error <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>userId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>状态机模式（XState 思想）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">stateMachineReducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'idle'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'FETCH'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">'loading'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'loading'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'SUCCESS'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> action<span class="token punctuation">.</span>data <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'FAILURE'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> action<span class="token punctuation">.</span>error <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'success'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'RESET'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">'idle'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'error'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'RETRY'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">'loading'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高频面试题与破解方案-9"><a href="#高频面试题与破解方案-9" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：何时该用 useReducer 而不是 useState？</strong></p>
<p>决策树：</p>
<pre><code class="mermaid">graph TD
  A[状态结构复杂?] --&gt;|是| B[useReducer]
  A --&gt;|否| C&#123;状态更新逻辑复杂?&#125;
  C --&gt;|是| B
  C --&gt;|否| D[useState]
  E[需要跨组件更新?] --&gt;|是| B
  F[需要可预测状态?] --&gt;|是| B</code></pre>

<p><strong>Q：如何避免 reducer 函数过大？</strong></p>
<p>优化策略：</p>
<ul>
<li>拆分 reducer：</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">rootReducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token function">userReducer</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>user<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">posts</span><span class="token operator">:</span> <span class="token function">postsReducer</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>posts<span class="token punctuation">,</span> action<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>组合 action 创建函数：</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">increment</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'increment'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">addTodo</span><span class="token operator">:</span> <span class="token parameter">text</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'add_todo'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> text <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// 使用：dispatch(actions.increment())</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Q：useReducer 如何实现时间旅行调试？</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 1. 添加历史记录</span>
<span class="token keyword">function</span> <span class="token function">reducerWithHistory</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> nextState <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>current<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">current</span><span class="token operator">:</span> nextState<span class="token punctuation">,</span>
    <span class="token literal-property property">history</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">.</span>history<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> action<span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> nextState <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 2. 实现撤销/重做</span>
<span class="token keyword">function</span> <span class="token function">undoableReducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'UNDO'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">current</span><span class="token operator">:</span> state<span class="token punctuation">.</span>history<span class="token punctuation">[</span>state<span class="token punctuation">.</span>history<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// ...其他action处理</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>undoableReducer<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">current</span><span class="token operator">:</span> initialState<span class="token punctuation">,</span>
  <span class="token literal-property property">history</span><span class="token operator">:</span> <span class="token punctuation">[</span>initialState<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="与-Context-集成"><a href="#与-Context-集成" class="headerlink" title="与 Context 集成"></a>与 Context 集成</h3><p><strong>全局状态管理方案</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 创建 Context</span>
<span class="token keyword">const</span> StateContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> DispatchContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 全局 Provider</span>
<span class="token keyword">function</span> <span class="token function">AppProvider</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>StateContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span>state<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>DispatchContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span>dispatch<span class="token punctuation">&#125;</span><span class="token operator">></span>
        <span class="token punctuation">&#123;</span>children<span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>DispatchContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>StateContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 自定义 Hook 访问</span>
<span class="token keyword">function</span> <span class="token function">useAppState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>StateContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>state<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'必须在 AppProvider 内使用'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">useAppDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>DispatchContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dispatch<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'必须在 AppProvider 内使用'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> dispatch<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 组件中使用</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">useAppState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useAppDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'increment'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token punctuation">&#123;</span>state<span class="token punctuation">.</span>count<span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="最佳实践总结"><a href="#最佳实践总结" class="headerlink" title="最佳实践总结"></a>最佳实践总结</h3><ol>
<li>纯函数原则：Reducer 必须是纯函数，不产生副作用</li>
<li>不可变更新：始终返回新状态对象，不修改原状态</li>
<li>类型安全：使用 TypeScript 强化 action 类型</li>
</ol>
<pre class="line-numbers language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">type</span> <span class="token class-name">Action</span> <span class="token operator">=</span> 
  <span class="token operator">|</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'increment'</span> <span class="token punctuation">&#125;</span>
  <span class="token operator">|</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'decrement'</span> <span class="token punctuation">&#125;</span>
  <span class="token operator">|</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'set_count'</span><span class="token punctuation">;</span> payload<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>逻辑复用：提取 reducer 到独立文件便于测试</li>
<li>合理拆分：大型应用按功能域拆分多个 reducer</li>
<li>避免过度：简单状态仍使用 useState</li>
</ol>
<h3 id="使用场景决策逻辑"><a href="#使用场景决策逻辑" class="headerlink" title="使用场景决策逻辑"></a>使用场景决策逻辑</h3><pre><code class="mermaid">graph TD
  A[状态管理需求] --&gt; B&#123;状态结构&#125;
  B --&gt;|简单值| C[useState]
  B --&gt;|复杂对象| D&#123;更新逻辑&#125;
  D --&gt;|简单| C
  D --&gt;|复杂| E[useReducer]
  A --&gt; F&#123;状态共享范围&#125;
  F --&gt;|组件内| G[useState&#x2F;useReducer]
  F --&gt;|跨组件| H[Context + useReducer]
  A --&gt; I&#123;需要时间旅行&#x2F;撤销&#125;
  I --&gt;|是| E</code></pre>

<h2 id="3-5-自定义-Hooks（封装可复用逻辑）"><a href="#3-5-自定义-Hooks（封装可复用逻辑）" class="headerlink" title="3.5 自定义 Hooks（封装可复用逻辑）"></a>3.5 自定义 Hooks（封装可复用逻辑）</h2><h3 id="基础概念概述-8"><a href="#基础概念概述-8" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><p>自定义 Hook 是什么：将组件逻辑提取到可重用的 JavaScript 函数中的技术，是 React 逻辑复用的终极解决方案</p>
<p>核心特征：</p>
<ul>
<li>名称以 use 开头（如 useFetch）</li>
<li>可以调用其他 Hook（如 useState, useEffect）</li>
<li>不包含 UI 渲染，只包含状态逻辑</li>
</ul>
<p>与普通函数的区别：</p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">自定义 Hook</th>
<th align="left">工具函数</th>
</tr>
</thead>
<tbody><tr>
<td align="left">可调用其他 Hook</td>
<td align="left">✅</td>
<td align="left">❌</td>
</tr>
<tr>
<td align="left">状态隔离</td>
<td align="left">每次调用独立状态</td>
<td align="left">无状态&#x2F;静态</td>
</tr>
<tr>
<td align="left">使用场景</td>
<td align="left">组件逻辑复用</td>
<td align="left">数据处理&#x2F;工具类</td>
</tr>
</tbody></table>
<h3 id="核心机制深度解析-4"><a href="#核心机制深度解析-4" class="headerlink" title="核心机制深度解析"></a>核心机制深度解析</h3><p><strong>状态隔离原理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 自定义 Hook</span>
<span class="token keyword">function</span> <span class="token function">useCounter</span><span class="token punctuation">(</span><span class="token parameter">initialValue <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> increment<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 组件A使用</span>
<span class="token keyword">function</span> <span class="token function">ComponentA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>countA<span class="token punctuation">,</span> incA<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useCounter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 独立状态</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 组件B使用</span>
<span class="token keyword">function</span> <span class="token function">ComponentB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>countB<span class="token punctuation">,</span> incB<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useCounter</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 独立状态</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>关键原理：每次调用自定义 Hook 都会创建独立的状态副本（闭包机制）</p>
<p><strong>Hook 调用规则</strong></p>
<pre><code class="mermaid">graph LR
  A[函数组件] --&gt; B[调用自定义Hook]
  B --&gt; C[内部调用React Hook]
  C --&gt; D[返回状态和逻辑]
  D --&gt; A</code></pre>

<p>强制规则：</p>
<ul>
<li>只在 React 函数组件或自定义 Hook 中调用</li>
<li>只在顶层调用（不能在条件&#x2F;循环中使用）</li>
<li>命名必须以 use 开头</li>
</ul>
<h3 id="设计模式与最佳实践"><a href="#设计模式与最佳实践" class="headerlink" title="设计模式与最佳实践"></a>设计模式与最佳实践</h3><p><strong>参数传递与返回值</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 灵活的参数设计</span>
<span class="token keyword">function</span> <span class="token function">useToggle</span><span class="token punctuation">(</span><span class="token parameter">initial <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initial<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 支持直接设置或切换</span>
  <span class="token keyword">const</span> <span class="token function-variable function">toggle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'boolean'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">setState</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> <span class="token operator">!</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 返回状态和控制方法</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> toggle<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>isOpen<span class="token punctuation">,</span> toggleOpen<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useToggle</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>组合 Hook 模式</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 组合多个 Hook 创建复杂逻辑</span>
<span class="token keyword">function</span> <span class="token function">useUserProfile</span><span class="token punctuation">(</span><span class="token parameter">userId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> loading<span class="token punctuation">,</span> error<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useFetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>userId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>preferences<span class="token punctuation">,</span> setPrefs<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useLocalStorage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">prefs_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>userId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>notifications<span class="token punctuation">,</span> addNotification<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useNotifications</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    user<span class="token punctuation">,</span>
    preferences<span class="token punctuation">,</span>
    <span class="token literal-property property">setPreferences</span><span class="token operator">:</span> setPrefs<span class="token punctuation">,</span>
    notifications<span class="token punctuation">,</span>
    addNotification<span class="token punctuation">,</span>
    loading<span class="token punctuation">,</span>
    error
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>依赖注入模式</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 创建可配置的自定义 Hook</span>
<span class="token keyword">function</span> <span class="token function">useAPI</span><span class="token punctuation">(</span><span class="token parameter">endpoint<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>loading<span class="token punctuation">,</span> setLoading<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> fetchData <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setData</span><span class="token punctuation">(</span><span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
      <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>endpoint<span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>fetchData<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> loading<span class="token punctuation">,</span> <span class="token literal-property property">refetch</span><span class="token operator">:</span> fetchData <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> userAPI <span class="token operator">=</span> <span class="token function">useAPI</span><span class="token punctuation">(</span><span class="token string">'/api/users'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'GET'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高频面试题与破解方案-10"><a href="#高频面试题与破解方案-10" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：自定义 Hook 和 HOC（高阶组件）&#x2F;Render Props 有何区别？</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">自定义 Hook</th>
<th align="left">HOC</th>
<th align="left">Render Props</th>
</tr>
</thead>
<tbody><tr>
<td align="left">逻辑复用方式</td>
<td align="left">直接调用 Hook</td>
<td align="left">包装组件</td>
<td align="left">通过 props 渲染</td>
</tr>
<tr>
<td align="left">组件层级</td>
<td align="left">无额外层级</td>
<td align="left">增加包装层级</td>
<td align="left">增加回调层级</td>
</tr>
<tr>
<td align="left">命名冲突</td>
<td align="left">无</td>
<td align="left">可能发生</td>
<td align="left">可能发生</td>
</tr>
<tr>
<td align="left">调试难度</td>
<td align="left">简单</td>
<td align="left">组件树变深</td>
<td align="left">回调嵌套复杂</td>
</tr>
<tr>
<td align="left">TypeScript 支持</td>
<td align="left">优秀</td>
<td align="left">类型推导复杂</td>
<td align="left">类型推导中等</td>
</tr>
</tbody></table>
<p>结论：<br>自定义 Hook 是 React 官方推荐的逻辑复用方案，解决了 HOC 和 Render Props 的嵌套问题</p>
<p><strong>Q：如何测试自定义 Hook？</strong></p>
<p>测试策略：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用 @testing-library/react-hooks</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> renderHook<span class="token punctuation">,</span> act <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@testing-library/react-hooks'</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'should use counter'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> result <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">renderHook</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">useCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>current<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始值</span>
  
  <span class="token function">act</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    result<span class="token punctuation">.</span>current<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行 increment</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>current<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 更新后值</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Q：自定义 Hook 会导致内存泄漏吗？</strong></p>
<p>风险与防范：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">useEventListener</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> handler<span class="token punctuation">,</span> element <span class="token operator">=</span> window</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> savedHandler <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 保存最新处理函数</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    savedHandler<span class="token punctuation">.</span>current <span class="token operator">=</span> handler<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>handler<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">eventListener</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> savedHandler<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> eventListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// ✅ 必须返回清理函数</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> element<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> eventListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>eventName<span class="token punctuation">,</span> element<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 依赖变化时重新绑定</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="实践案例"><a href="#实践案例" class="headerlink" title="实践案例"></a>实践案例</h3><p><strong>权限控制 Hook</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">usePermission</span><span class="token punctuation">(</span><span class="token parameter">requiredPermission</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>hasPermission<span class="token punctuation">,</span> setHasPermission<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 异步检查权限（如调用API）</span>
    <span class="token function">checkPermission</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> requiredPermission<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>setHasPermission<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> requiredPermission<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> hasPermission<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">function</span> <span class="token function">AdminPanel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> canEdit <span class="token operator">=</span> <span class="token function">usePermission</span><span class="token punctuation">(</span><span class="token string">'admin_edit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> canEdit <span class="token operator">?</span> <span class="token operator">&lt;</span>Editor <span class="token operator">/</span><span class="token operator">></span> <span class="token operator">:</span> <span class="token operator">&lt;</span>PermissionDenied <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>状态机 Hook</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">useStateMachine</span><span class="token punctuation">(</span><span class="token parameter">states<span class="token punctuation">,</span> initialState</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> transition <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> currentState <span class="token operator">=</span> state<span class="token punctuation">;</span>
    <span class="token keyword">const</span> nextState <span class="token operator">=</span> states<span class="token punctuation">[</span>currentState<span class="token punctuation">]</span><span class="token operator">?.</span><span class="token punctuation">[</span>event<span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>nextState<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">无效转换: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>currentState<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> -> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>event<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token function">setState</span><span class="token punctuation">(</span>nextState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> states<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> transition<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> transition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useStateMachine</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">idle</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token constant">START</span><span class="token operator">:</span> <span class="token string">'running'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">running</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token constant">PAUSE</span><span class="token operator">:</span> <span class="token string">'paused'</span><span class="token punctuation">,</span> <span class="token constant">COMPLETE</span><span class="token operator">:</span> <span class="token string">'done'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">paused</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token constant">RESUME</span><span class="token operator">:</span> <span class="token string">'running'</span><span class="token punctuation">,</span> <span class="token constant">CANCEL</span><span class="token operator">:</span> <span class="token string">'idle'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token constant">RESET</span><span class="token operator">:</span> <span class="token string">'idle'</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'idle'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="自定义-Hook-设计原则"><a href="#自定义-Hook-设计原则" class="headerlink" title="自定义 Hook 设计原则"></a>自定义 Hook 设计原则</h3><ol>
<li>单一职责：一个 Hook 只解决一个问题</li>
<li>命名清晰：use + 功能名（useWindowSize）</li>
<li>参数合理：提供默认值和必要配置</li>
<li>返回简洁：返回数组或对象结构</li>
<li>文档完善：使用 JSDoc 说明用法</li>
<li>类型安全：TypeScript 类型定义</li>
</ol>
<h3 id="总结：自定义-Hook-价值"><a href="#总结：自定义-Hook-价值" class="headerlink" title="总结：自定义 Hook 价值"></a>总结：自定义 Hook 价值</h3><pre><code class="mermaid">graph TD
  A[逻辑复用] --&gt; B[减少代码重复]
  A --&gt; C[统一业务逻辑]
  D[关注点分离] --&gt; E[提升可维护性]
  D --&gt; F[便于单元测试]
  G[组件简化] --&gt; H[提升可读性]
  G --&gt; I[降低复杂度]</code></pre>

<h2 id="3-6-其他常用-Hooks（useMemo、useCallback、useRef）"><a href="#3-6-其他常用-Hooks（useMemo、useCallback、useRef）" class="headerlink" title="3.6 其他常用 Hooks（useMemo、useCallback、useRef）"></a>3.6 其他常用 Hooks（useMemo、useCallback、useRef）</h2><h3 id="三大-Hook-快速对比"><a href="#三大-Hook-快速对比" class="headerlink" title="三大 Hook 快速对比"></a>三大 Hook 快速对比</h3><table>
<thead>
<tr>
<th align="left">Hook</th>
<th align="left">主要作用</th>
<th align="left">返回值</th>
<th align="left">性能优化原理</th>
</tr>
</thead>
<tbody><tr>
<td align="left">useMemo</td>
<td align="left">缓存计算结果</td>
<td align="left">记忆化值</td>
<td align="left">避免重复计算</td>
</tr>
<tr>
<td align="left">useCallback</td>
<td align="left">缓存函数引用</td>
<td align="left">记忆化函数</td>
<td align="left">避免子组件不必要重渲染</td>
</tr>
<tr>
<td align="left">useRef</td>
<td align="left">保存可变值&#x2F;DOM 引用</td>
<td align="left">{ current: value }</td>
<td align="left">不触发重渲染</td>
</tr>
</tbody></table>
<h3 id="useMemo-深度解析"><a href="#useMemo-深度解析" class="headerlink" title="useMemo 深度解析"></a>useMemo 深度解析</h3><p><strong>核心语法</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> memoizedValue <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">computeExpensiveValue</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>计算函数：返回需要缓存的值</li>
<li>依赖数组：当依赖变化时重新计算</li>
</ul>
<p><strong>工作原理</strong></p>
<pre><code class="mermaid">graph LR
  A[组件渲染] --&gt; B&#123;依赖是否变化?&#125;
  B --&gt;|否| C[返回缓存值]
  B --&gt;|是| D[执行计算函数]
  D --&gt; E[缓存新值]
  E --&gt; F[返回新值]</code></pre>

<p><strong>使用场景</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 场景1：高开销计算</span>
<span class="token keyword">function</span> <span class="token function">Component</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> items <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> sortedItems <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> items<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a<span class="token punctuation">.</span>value <span class="token operator">-</span> b<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 排序开销大</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>items<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>List items<span class="token operator">=</span><span class="token punctuation">&#123;</span>sortedItems<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 场景2：避免不必要重渲染</span>
<span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> userContext <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> 
    user<span class="token punctuation">,</span> 
    <span class="token literal-property property">isAdmin</span><span class="token operator">:</span> user<span class="token punctuation">.</span>role <span class="token operator">===</span> <span class="token string">'admin'</span> 
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 依赖变化时重建</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Child context<span class="token operator">=</span><span class="token punctuation">&#123;</span>userContext<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>错误用法</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 错误1：没有依赖数组（每次渲染都计算）</span>
<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ❌ 错误2：依赖数组不全</span>
<span class="token keyword">const</span> fullName <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>surname<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="useCallback-深度解析"><a href="#useCallback-深度解析" class="headerlink" title="useCallback 深度解析"></a>useCallback 深度解析</h3><p><strong>核心语法</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> memoizedCallback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">doSomething</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>与 useMemo 关系</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// useCallback 等价于：</span>
<span class="token keyword">const</span> memoizedCallback <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">doSomething</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>使用场景</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 场景1：避免子组件不必要重渲染</span>
<span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ✅ 稳定函数引用</span>
  <span class="token keyword">const</span> increment <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Child onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>increment<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> Child <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> onClick <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 依赖稳定函数引用不会重渲染</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>onClick<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 场景2：依赖数组中的函数</span>
<span class="token keyword">function</span> <span class="token function">Form</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> handleSubmit <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'提交:'</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>text<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 正确捕获最新text</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">keyHandler</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'Enter'</span><span class="token punctuation">)</span> <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> keyHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> keyHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>handleSubmit<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 依赖稳定函数</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>性能陷阱</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 错误：过度使用 useCallback</span>
<span class="token keyword">const</span> handleClick <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'点击'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 简单函数不需要缓存</span>

<span class="token comment">// ✅ 正确：直接定义函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'点击'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="useRef-高级用法（补充-2-5-章节）"><a href="#useRef-高级用法（补充-2-5-章节）" class="headerlink" title="useRef 高级用法（补充 2.5 章节）"></a>useRef 高级用法（补充 2.5 章节）</h3><p><strong>保存可变值</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> countRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; current: 0 &#125;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    countRef<span class="token punctuation">.</span>current <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'计数:'</span><span class="token punctuation">,</span> countRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 不触发重渲染！</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>访问上一状态</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> prevCountRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    prevCountRef<span class="token punctuation">.</span>current <span class="token operator">=</span> count<span class="token punctuation">;</span> <span class="token comment">// 渲染后保存当前值</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> prevCount <span class="token operator">=</span> prevCountRef<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token literal-property property">当前</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token literal-property property">之前</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>prevCount<span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>跨渲染周期存储</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">ChatRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>messages<span class="token punctuation">,</span> setMessages<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> socketRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    socketRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'wss://...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    socketRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">setMessages</span><span class="token punctuation">(</span><span class="token parameter">msgs</span> <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token operator">...</span>msgs<span class="token punctuation">,</span> event<span class="token punctuation">.</span>data<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> socketRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 在其他函数中使用</span>
  <span class="token keyword">const</span> <span class="token function-variable function">sendMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    socketRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高频面试题与破解方案-11"><a href="#高频面试题与破解方案-11" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：useMemo 和 useCallback 有何区别？</strong></p>
<p>核心区别：</p>
<ul>
<li>useMemo 缓存计算结果，用于避免重复计算</li>
<li>useCallback 缓存函数引用，用于保持引用稳定</li>
</ul>
<p>等效关系：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">useCallback</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> deps<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> fn<span class="token punctuation">,</span> deps<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>Q：何时该用 useMemo&#x2F;useCallback？</strong></p>
<pre><code class="mermaid">graph TD
  A[需要优化?] --&gt;|否| B[直接计算&#x2F;定义函数]
  A --&gt;|是| C&#123;优化类型?&#125;
  C --&gt;|避免计算开销| D[用useMemo]
  C --&gt;|避免子组件重渲染| E[useCallback+React.memo]
  C --&gt;|稳定依赖项| F[两者皆可]</code></pre>

<p><strong>Q：useRef 和 useState 有何区别？</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">useRef</th>
<th align="left">useState</th>
</tr>
</thead>
<tbody><tr>
<td align="left">触发重渲染</td>
<td align="left">否</td>
<td align="left">是</td>
</tr>
<tr>
<td align="left">存储值类型</td>
<td align="left">可变对象（.current）</td>
<td align="left">不可变状态</td>
</tr>
<tr>
<td align="left">数据持久化</td>
<td align="left">组件生命周期</td>
<td align="left">状态更新保留</td>
</tr>
<tr>
<td align="left">典型用途</td>
<td align="left">DOM 引用&#x2F;计时器 ID</td>
<td align="left">渲染相关状态</td>
</tr>
<tr>
<td align="left">初始化</td>
<td align="left">useRef(initial)</td>
<td align="left">useState(initial)</td>
</tr>
</tbody></table>
<h3 id="高级优化模式"><a href="#高级优化模式" class="headerlink" title="高级优化模式"></a>高级优化模式</h3><p><strong>虚拟滚动优化</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">VirtualList</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> items<span class="token punctuation">,</span> itemHeight <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> containerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>visibleRange<span class="token punctuation">,</span> setVisibleRange<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 缓存可见项</span>
  <span class="token keyword">const</span> visibleItems <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> items<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>visibleRange<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> visibleRange<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>items<span class="token punctuation">,</span> visibleRange<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 计算总高度（虚拟滚动）</span>
  <span class="token keyword">const</span> totalHeight <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> items<span class="token punctuation">.</span>length <span class="token operator">*</span> itemHeight<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>items<span class="token punctuation">.</span>length<span class="token punctuation">,</span> itemHeight<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>containerRef<span class="token punctuation">&#125;</span> style<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">'500px'</span><span class="token punctuation">,</span> <span class="token literal-property property">overflow</span><span class="token operator">:</span> <span class="token string">'auto'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>totalHeight<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'relative'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
        <span class="token punctuation">&#123;</span>visibleItems<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>Item 
            key<span class="token operator">=</span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>id<span class="token punctuation">&#125;</span> 
            item<span class="token operator">=</span><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span>
            style<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> 
              <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
              <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>item<span class="token punctuation">.</span>index <span class="token operator">*</span> itemHeight<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span> 
            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>防抖&#x2F;节流优化</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">useDebounce</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>debouncedValue<span class="token punctuation">,</span> setDebouncedValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setDebouncedValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> delay<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> debouncedValue<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">Search</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>query<span class="token punctuation">,</span> setQuery<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> debouncedQuery <span class="token operator">=</span> <span class="token function">useDebounce</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 使用useMemo避免重复请求</span>
  <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">fetchResults</span><span class="token punctuation">(</span>debouncedQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>debouncedQuery<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">&#123;</span>query<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token function">setQuery</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Results data<span class="token operator">=</span><span class="token punctuation">&#123;</span>results<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="总结：性能优化决策"><a href="#总结：性能优化决策" class="headerlink" title="总结：性能优化决策"></a>总结：性能优化决策</h3><pre><code class="mermaid">graph TD
  A[性能问题?] --&gt;|是| B&#123;问题类型&#125;
  A --&gt;|否| C[无需优化]
  B --&gt;|组件重渲染过多| D[React.memo+useCallback]
  B --&gt;|计算开销大| E[useMemo]
  B --&gt;|DOM操作频繁| F[useRef+useLayoutEffect]
  D --&gt; G[验证优化效果]
  E --&gt; G
  F --&gt; G
  G --&gt;|解决| H[停止]
  G --&gt;|未解决| I[性能分析工具]</code></pre>

<h1 id="第四章：React-高级特性"><a href="#第四章：React-高级特性" class="headerlink" title="第四章：React 高级特性"></a>第四章：React 高级特性</h1><h2 id="4-1-性能优化（React-memo、useMemo、useCallback）"><a href="#4-1-性能优化（React-memo、useMemo、useCallback）" class="headerlink" title="4.1 性能优化（React.memo、useMemo、useCallback）"></a>4.1 性能优化（React.memo、useMemo、useCallback）</h2><h3 id="性能优化核心原则"><a href="#性能优化核心原则" class="headerlink" title="性能优化核心原则"></a>性能优化核心原则</h3><p><strong>React 渲染机制回顾</strong></p>
<pre><code class="mermaid">graph LR
A[状态&#x2F;Props变化] --&gt; B[组件重新渲染]
B --&gt; C&#123;子组件是否更新?&#125;
C --&gt;|Props变化| D[重新渲染子组件]
C --&gt;|Props未变化| E[跳过子组件渲染]</code></pre>

<p><strong>性能优化核心策略</strong></p>
<table>
<thead>
<tr>
<th align="left">优化策略</th>
<th align="left">适用场景</th>
<th align="left">实现方式</th>
</tr>
</thead>
<tbody><tr>
<td align="left">减少渲染次数</td>
<td align="left">避免不必要的渲染</td>
<td align="left">React.memo、PureComponent</td>
</tr>
<tr>
<td align="left">减少计算量</td>
<td align="left">复杂计算&#x2F;数据转换</td>
<td align="left">useMemo</td>
</tr>
<tr>
<td align="left">保持引用稳定</td>
<td align="left">函数&#x2F;对象作为依赖项</td>
<td align="left">useCallback、useMemo</td>
</tr>
<tr>
<td align="left">虚拟化长列表</td>
<td align="left">大数据量渲染</td>
<td align="left">react-window、react-virtualized</td>
</tr>
</tbody></table>
<h3 id="核心-API-深度解析"><a href="#核心-API-深度解析" class="headerlink" title="核心 API 深度解析"></a>核心 API 深度解析</h3><p><strong>React.memo 详解</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 基础用法</span>
<span class="token keyword">const</span> MyComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">/* 使用 props 渲染 */</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 自定义比较函数</span>
<span class="token keyword">const</span> UserProfile <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> user<span class="token punctuation">,</span> settings <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>Avatar url<span class="token operator">=</span><span class="token punctuation">&#123;</span>user<span class="token punctuation">.</span>avatar<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Preferences options<span class="token operator">=</span><span class="token punctuation">&#123;</span>settings<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> nextProps</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 仅在 user.id 或 settings.theme 变化时重新渲染</span>
  <span class="token keyword">return</span> prevProps<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id <span class="token operator">===</span> nextProps<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id <span class="token operator">&amp;&amp;</span> 
         prevProps<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>theme <span class="token operator">===</span> nextProps<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>theme<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>关键特性：</p>
<ul>
<li>仅进行浅比较（shallow compare）</li>
<li>比较函数返回 true 表示不需要重新渲染</li>
<li>适用于函数组件</li>
</ul>
<p>优化场景：</p>
<ul>
<li>纯展示型组件（无内部状态）</li>
<li>接收复杂对象 Props 的组件</li>
<li>位于渲染频繁组件树中的叶子节点</li>
</ul>
<p><strong>useMemo 深度应用</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">ProductList</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> products<span class="token punctuation">,</span> filterText<span class="token punctuation">,</span> sortBy <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 缓存复杂计算结果</span>
  <span class="token keyword">const</span> filteredProducts <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'重新计算过滤产品'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> products<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=></span> 
      p<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>filterText<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>products<span class="token punctuation">,</span> filterText<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 依赖项</span>
  
  <span class="token comment">// 缓存排序结果</span>
  <span class="token keyword">const</span> sortedProducts <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'重新排序产品'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>filteredProducts<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>sortBy <span class="token operator">===</span> <span class="token string">'price'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> a<span class="token punctuation">.</span>price <span class="token operator">-</span> b<span class="token punctuation">.</span>price<span class="token punctuation">;</span>
      <span class="token keyword">return</span> a<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>filteredProducts<span class="token punctuation">,</span> sortBy<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ul<span class="token operator">></span>
      <span class="token punctuation">&#123;</span>sortedProducts<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">product</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>ProductItem key<span class="token operator">=</span><span class="token punctuation">&#123;</span>product<span class="token punctuation">.</span>id<span class="token punctuation">&#125;</span> product<span class="token operator">=</span><span class="token punctuation">&#123;</span>product<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>关键特性：</p>
<ul>
<li>缓存计算结果，避免重复计算</li>
<li>依赖项变化时重新计算</li>
<li>适用于：复杂计算、数据转换、组件记忆化</li>
</ul>
<p>性能陷阱：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 错误用法：useMemo 作为语义保证</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不会阻止重复请求</span>

<span class="token comment">// 正确用法：仅用于性能优化</span>
<span class="token keyword">const</span> transformedData <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> 
  rawData<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>transformItem<span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token punctuation">[</span>rawData<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>useCallback 高级用法</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">ParentComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 缓存函数引用</span>
  <span class="token keyword">const</span> handleClick <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'点击事件'</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 注意：闭包陷阱！count 是创建时的值</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 依赖 count 保证最新值</span>
  
  <span class="token comment">// 使用 ref 解决闭包问题</span>
  <span class="token keyword">const</span> countRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  countRef<span class="token punctuation">.</span>current <span class="token operator">=</span> count<span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> stableHandler <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'最新值:'</span><span class="token punctuation">,</span> countRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 无依赖，函数引用稳定</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>增加 <span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span>ChildComponent onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>stableHandler<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> ChildComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> onClick <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'子组件渲染'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>onClick<span class="token punctuation">&#125;</span><span class="token operator">></span>触发事件<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>关键特性：</p>
<ul>
<li>缓存函数引用，避免子组件不必要渲染</li>
<li>依赖项变化时创建新函数</li>
<li>适用于：事件处理函数、传递给子组件的回调</li>
</ul>
<p>最佳实践：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 依赖项处理技巧</span>
<span class="token keyword">const</span> handleSubmit <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  api<span class="token punctuation">.</span><span class="token function">submitForm</span><span class="token punctuation">(</span>formState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>formState<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 正确：依赖实际使用的状态</span>

<span class="token comment">// 使用函数式更新避免依赖</span>
<span class="token keyword">const</span> increment <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> prev <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 不依赖 count</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="综合优化策略"><a href="#综合优化策略" class="headerlink" title="综合优化策略"></a>综合优化策略</h3><p><strong>组件结构优化</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 优化前：状态提升导致频繁渲染</span>
<span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>ExpensiveComponent data<span class="token operator">=</span><span class="token punctuation">&#123;</span>state<span class="token punctuation">.</span>data<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>ControlPanel onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span>setState<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 优化后：状态下沉</span>
<span class="token keyword">function</span> <span class="token function">OptimizedParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>DataContainer<span class="token operator">></span>
        <span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>ExpensiveComponent data<span class="token operator">=</span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>DataContainer<span class="token operator">></span>
      <span class="token operator">&lt;</span>ControlPanel <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">DataContainer</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 状态管理隔离在此组件</span>
  <span class="token keyword">return</span> <span class="token function">children</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>上下文优化技巧</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 创建拆分上下文</span>
<span class="token keyword">const</span> UserContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> SettingsContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> setUser<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>settings<span class="token punctuation">,</span> setSettings<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>UserContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span>user<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>SettingsContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span>settings<span class="token punctuation">&#125;</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>Header <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>MainContent <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>SettingsContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>UserContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 消费者组件</span>
<span class="token keyword">const</span> <span class="token function-variable function">ThemeSwitcher</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 只订阅需要的上下文</span>
  <span class="token keyword">const</span> settings <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>SettingsContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>当前主题<span class="token operator">:</span> <span class="token punctuation">&#123;</span>settings<span class="token punctuation">.</span>theme<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用 React.memo 防止不必要渲染</span>
<span class="token keyword">const</span> Header <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>UserContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>header<span class="token operator">></span><span class="token punctuation">&#123;</span>user <span class="token operator">?</span> user<span class="token punctuation">.</span>name <span class="token operator">:</span> <span class="token string">'游客'</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>虚拟化长列表</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> FixedSizeList <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-window'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">BigList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> items <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">Row</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> index<span class="token punctuation">,</span> style <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">&#123;</span>style<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>ListItem item<span class="token operator">=</span><span class="token punctuation">&#123;</span>items<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>FixedSizeList
      height<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">600</span><span class="token punctuation">&#125;</span>
      width<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">800</span><span class="token punctuation">&#125;</span>
      itemCount<span class="token operator">=</span><span class="token punctuation">&#123;</span>items<span class="token punctuation">.</span>length<span class="token punctuation">&#125;</span>
      itemSize<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">100</span><span class="token punctuation">&#125;</span> <span class="token comment">// 每项高度</span>
    <span class="token operator">></span>
      <span class="token punctuation">&#123;</span>Row<span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>FixedSizeList<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 优化列表项</span>
<span class="token keyword">const</span> ListItem <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> item <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"item"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Avatar url<span class="token operator">=</span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>avatar<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span>h3<span class="token operator">></span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
        <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>description<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="性能分析工具"><a href="#性能分析工具" class="headerlink" title="性能分析工具"></a>性能分析工具</h3><p><strong>React DevTools Profiler</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用示例</span>
<span class="token keyword">function</span> <span class="token function">ProfilerTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Profiler id<span class="token operator">=</span><span class="token string">"Navigation"</span> onRender<span class="token operator">=</span><span class="token punctuation">&#123;</span>onRenderCallback<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Navigation <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Profiler<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">onRenderCallback</span><span class="token punctuation">(</span>
  id<span class="token punctuation">,</span> <span class="token comment">// Profiler 树的 "id"</span>
  phase<span class="token punctuation">,</span> <span class="token comment">// "mount" 或 "update"</span>
  actualDuration<span class="token punctuation">,</span> <span class="token comment">// 本次更新花费的渲染时间</span>
  baseDuration<span class="token punctuation">,</span> <span class="token comment">// 估计不使用 memoization 的渲染时间</span>
  startTime<span class="token punctuation">,</span> <span class="token comment">// 本次更新开始时间</span>
  commitTime<span class="token punctuation">,</span> <span class="token comment">// 提交时间</span>
  interactions <span class="token comment">// 本次更新所关联的 set</span>
<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">组件 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> 的 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>phase<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> 阶段耗时: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>actualDuration<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">ms</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Chrome Performance Tab</strong></p>
<ul>
<li>操作步骤：<ul>
<li>打开 Chrome DevTools</li>
<li>切换到 Performance 选项卡</li>
<li>点击 Record 开始记录</li>
<li>执行页面操作</li>
<li>停止记录分析火焰图</li>
</ul>
</li>
<li>关键指标：<ul>
<li>Scripting：JavaScript 执行时间</li>
<li>Rendering：样式计算和布局</li>
<li>Painting：像素绘制时间</li>
<li>Idle：空闲时间</li>
</ul>
</li>
</ul>
<h3 id="常见性能问题与解决方案"><a href="#常见性能问题与解决方案" class="headerlink" title="常见性能问题与解决方案"></a>常见性能问题与解决方案</h3><p><strong>状态频繁变更导致渲染抖动</strong></p>
<p>场景：输入框实时搜索导致频繁渲染</p>
<p>解决方案：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">SearchBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>inputValue<span class="token punctuation">,</span> setInputValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>searchResults<span class="token punctuation">,</span> setSearchResults<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 使用防抖</span>
  <span class="token keyword">const</span> debouncedSearch <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> 
    <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">query</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      api<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>setSearchResults<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">debouncedSearch</span><span class="token punctuation">(</span>inputValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> debouncedSearch<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>inputValue<span class="token punctuation">,</span> debouncedSearch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>input 
        value<span class="token operator">=</span><span class="token punctuation">&#123;</span>inputValue<span class="token punctuation">&#125;</span>
        onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token function">setInputValue</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>ResultsList results<span class="token operator">=</span><span class="token punctuation">&#123;</span>searchResults<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>复杂组件树更新缓慢</strong></p>
<p>场景：大型表单组件局部更新</p>
<p>解决方案：状态隔离 + React.memo</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">BigForm</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>formData<span class="token punctuation">,</span> setFormData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 状态更新函数</span>
  <span class="token keyword">const</span> updateField <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">field<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setFormData</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>prev<span class="token punctuation">,</span> <span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token operator">:</span> value <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>form<span class="token operator">></span>
      <span class="token operator">&lt;</span>PersonalSection 
        data<span class="token operator">=</span><span class="token punctuation">&#123;</span>formData<span class="token punctuation">.</span>personal<span class="token punctuation">&#125;</span> 
        onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span>updateField<span class="token punctuation">&#125;</span> 
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>AddressSection 
        data<span class="token operator">=</span><span class="token punctuation">&#123;</span>formData<span class="token punctuation">.</span>address<span class="token punctuation">&#125;</span> 
        onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span>updateField<span class="token punctuation">&#125;</span> 
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>PaymentSection 
        data<span class="token operator">=</span><span class="token punctuation">&#123;</span>formData<span class="token punctuation">.</span>payment<span class="token punctuation">&#125;</span> 
        onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span>updateField<span class="token punctuation">&#125;</span> 
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 优化子组件</span>
<span class="token keyword">const</span> PersonalSection <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> onChange <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>section<span class="token operator">></span>
      <span class="token operator">&lt;</span>Input 
        label<span class="token operator">=</span><span class="token string">"姓名"</span>
        value<span class="token operator">=</span><span class="token punctuation">&#123;</span>data<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span>
        onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token parameter">v</span> <span class="token operator">=></span> <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">&#123;</span><span class="token comment">/* 其他字段 */</span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 仅当 personal 部分变化时重新渲染</span>
  <span class="token keyword">return</span> <span class="token function">shallowEqual</span><span class="token punctuation">(</span>prev<span class="token punctuation">.</span>data<span class="token punctuation">,</span> next<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>动画卡顿问题</strong></p>
<p>解决方案：使用 CSS 动画 + will-change</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">AnimatedBox</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> position <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div 
      className<span class="token operator">=</span><span class="token string">"animated-box"</span>
      style<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> 
        <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>position<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">willChange</span><span class="token operator">:</span> <span class="token string">'transform'</span> <span class="token comment">// 提示浏览器优化</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
    <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// CSS 中使用 GPU 加速</span>
<span class="token punctuation">.</span>animated<span class="token operator">-</span>box <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">transition</span><span class="token operator">:</span> transform <span class="token number">0</span><span class="token punctuation">.</span>3s ease<span class="token operator">-</span>out<span class="token punctuation">;</span>
  <span class="token comment">/* 启用 GPU 加速 */</span>
  <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token function">translateZ</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  backface<span class="token operator">-</span>visibility<span class="token operator">:</span> hidden<span class="token punctuation">;</span>
  <span class="token literal-property property">perspective</span><span class="token operator">:</span> 1000px<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="性能优化原则总结"><a href="#性能优化原则总结" class="headerlink" title="性能优化原则总结"></a>性能优化原则总结</h3><ol>
<li>测量优先：优化前先使用 Profiler 分析性能瓶颈</li>
<li>避免过早优化：只在必要时应用优化技术</li>
<li>关注关键路径：优先优化渲染频率高的组件</li>
<li>合理使用工具：<ol>
<li>React.memo 用于组件记忆化</li>
<li>useMemo 用于昂贵计算缓存</li>
<li>useCallback 用于函数引用稳定</li>
</ol>
</li>
<li>结构优化：<ol>
<li>组件职责单一化</li>
<li>状态合理下沉</li>
<li>避免深层嵌套</li>
</ol>
</li>
</ol>
<h3 id="面试高频问题与解答"><a href="#面试高频问题与解答" class="headerlink" title="面试高频问题与解答"></a>面试高频问题与解答</h3><p><strong>Q：React.memo 与 useMemo 有什么区别？</strong></p>
<ul>
<li>React.memo 是高阶组件，用于包装组件，避免不必要的重新渲染</li>
<li>useMemo 是Hook，用于在组件内部缓存计算结果</li>
<li>前者优化组件渲染，后者优化计算性能</li>
</ul>
<p><strong>Q：什么情况下应该使用 useCallback？</strong></p>
<ul>
<li>当函数作为 props 传递给记忆化组件（React.memo）</li>
<li>当函数作为其他 Hook 的依赖项（如 useEffect）</li>
<li>当函数在渲染中被创建且依赖项未改变时</li>
</ul>
<p><strong>Q：为什么使用 useMemo&#x2F;useCallback 后性能反而下降？</strong></p>
<ul>
<li>过度使用：简单计算使用 useMemo 得不偿失</li>
<li>依赖项错误：依赖项频繁变化导致重新计算</li>
<li>比较成本高：自定义比较函数复杂度高</li>
<li>闭包陷阱：函数闭包持有旧值导致逻辑错误</li>
</ul>
<p><strong>Q：如何避免 useCallback 的闭包陷阱？</strong></p>
<p>解决方案：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 方案1：使用函数式更新</span>
<span class="token keyword">const</span> increment <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> prev <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 方案2：使用 ref 保存最新值</span>
<span class="token keyword">const</span> countRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
countRef<span class="token punctuation">.</span>current <span class="token operator">=</span> count<span class="token punctuation">;</span>

<span class="token keyword">const</span> logCount <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>countRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 方案3：正确声明依赖项</span>
<span class="token keyword">const</span> logCount <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 依赖 count</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-2-错误边界（ErrorBoundary）"><a href="#4-2-错误边界（ErrorBoundary）" class="headerlink" title="4.2 错误边界（ErrorBoundary）"></a>4.2 错误边界（ErrorBoundary）</h2><h3 id="错误边界核心概念"><a href="#错误边界核心概念" class="headerlink" title="错误边界核心概念"></a>错误边界核心概念</h3><p><strong>错误边界解决的问题</strong></p>
<pre><code class="mermaid">graph TD
    A[组件树中的错误] --&gt; B[React 16 前]
    A --&gt; C[React 16+]
    B --&gt; D[整个应用崩溃]
    C --&gt; E[错误边界捕获]
    E --&gt; F[降级UI展示]
    E --&gt; G[错误日志记录]</code></pre>

<p><strong>错误边界能力范围</strong></p>
<table>
<thead>
<tr>
<th align="left">可捕获</th>
<th align="left">不可捕获</th>
</tr>
</thead>
<tbody><tr>
<td align="left">子组件渲染错误</td>
<td align="left">事件处理器错误</td>
</tr>
<tr>
<td align="left">生命周期方法错误</td>
<td align="left">异步代码错误</td>
</tr>
<tr>
<td align="left">构造函数错误</td>
<td align="left">服务端渲染错误</td>
</tr>
<tr>
<td align="left">整个组件树的错误</td>
<td align="left">错误边界自身错误</td>
</tr>
</tbody></table>
<h3 id="错误边界实现机制"><a href="#错误边界实现机制" class="headerlink" title="错误边界实现机制"></a>错误边界实现机制</h3><p><strong>基础实现方案</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">ErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> error <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> errorInfo</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 记录错误到监控系统</span>
    <span class="token function">logErrorToService</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> errorInfo<span class="token punctuation">.</span>componentStack<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 可选的错误恢复逻辑</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isRecoverable</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>fallback <span class="token operator">||</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"error-boundary"</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>h2<span class="token operator">></span>应用遇到问题<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
          <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>error<span class="token punctuation">.</span>message<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
          <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
            重新加载
          <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ErrorBoundary 
      fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>CriticalErrorScreen <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span>
    <span class="token operator">></span>
      <span class="token operator">&lt;</span>MainApplication <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ErrorBoundary<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>高级特性实现</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 带错误恢复功能的边界</span>
<span class="token keyword">class</span> <span class="token class-name">RecoverableErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">errorInfo</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">recoveryKey</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> errorInfo</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> 
      error<span class="token punctuation">,</span> 
      errorInfo<span class="token punctuation">,</span>
      <span class="token literal-property property">recoveryKey</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>recoveryKey <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function-variable function">handleReset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">errorInfo</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
          <span class="token operator">&lt;</span>h2<span class="token operator">></span>组件崩溃<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
          <span class="token operator">&lt;</span>ErrorDetails 
            error<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>error<span class="token punctuation">&#125;</span> 
            stack<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>errorInfo<span class="token punctuation">.</span>componentStack<span class="token punctuation">&#125;</span>
          <span class="token operator">/</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleReset<span class="token punctuation">&#125;</span><span class="token operator">></span>
            重置组件
          <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// 使用 key 强制重置子组件</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div key<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>recoveryKey<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 错误详情组件</span>
<span class="token keyword">function</span> <span class="token function">ErrorDetails</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> error<span class="token punctuation">,</span> stack <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>details style<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">whiteSpace</span><span class="token operator">:</span> <span class="token string">'pre-wrap'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>summary<span class="token operator">></span><span class="token punctuation">&#123;</span>error<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>summary<span class="token operator">></span>
      <span class="token operator">&lt;</span>pre<span class="token operator">></span><span class="token punctuation">&#123;</span>stack<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>pre<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>details<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="企业级最佳实践"><a href="#企业级最佳实践" class="headerlink" title="企业级最佳实践"></a>企业级最佳实践</h3><p><strong>多层错误边界策略</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">AppHierarchy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ErrorBoundary 
      level<span class="token operator">=</span><span class="token string">"app"</span> 
      fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>AppCrashScreen <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span>
    <span class="token operator">></span>
      <span class="token operator">&lt;</span>Header <span class="token operator">/</span><span class="token operator">></span>
      
      <span class="token operator">&lt;</span>ErrorBoundary 
        level<span class="token operator">=</span><span class="token string">"billing"</span> 
        fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>BillingModuleError <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span>
      <span class="token operator">></span>
        <span class="token operator">&lt;</span>BillingDashboard <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ErrorBoundary<span class="token operator">></span>
      
      <span class="token operator">&lt;</span>ErrorBoundary 
        level<span class="token operator">=</span><span class="token string">"user-profile"</span> 
        fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>ProfileError <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span>
      <span class="token operator">></span>
        <span class="token operator">&lt;</span>UserProfile <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ErrorBoundary<span class="token operator">></span>
      
      <span class="token operator">&lt;</span>ErrorBoundary 
        level<span class="token operator">=</span><span class="token string">"notifications"</span> 
        fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">null</span><span class="token punctuation">&#125;</span> <span class="token comment">// 静默失败</span>
      <span class="token operator">></span>
        <span class="token operator">&lt;</span>NotificationCenter <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ErrorBoundary<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ErrorBoundary<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>错误边界与监控系统集成</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">MonitoringErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> errorInfo</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 发送错误到监控平台</span>
    monitoringClient<span class="token punctuation">.</span><span class="token function">captureException</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">extra</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">componentStack</span><span class="token operator">:</span> errorInfo<span class="token punctuation">.</span>componentStack<span class="token punctuation">,</span>
        <span class="token literal-property property">userId</span><span class="token operator">:</span> <span class="token function">getCurrentUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span>id<span class="token punctuation">,</span>
        <span class="token literal-property property">route</span><span class="token operator">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">tags</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">error_boundary</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 自定义错误处理</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>onError<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> errorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError 
      <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>fallback 
      <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用示例</span>
<span class="token operator">&lt;</span>MonitoringErrorBoundary
  fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>ErrorScreen <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span>
  onError<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 特殊错误类型处理</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token keyword">instanceof</span> <span class="token class-name">PaymentError</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      router<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token string">'/payment-failed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token operator">></span>
  <span class="token operator">&lt;</span>CheckoutProcess <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>MonitoringErrorBoundary<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>错误边界与Suspense集成</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">AsyncBoundary</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children<span class="token punctuation">,</span> fallback<span class="token punctuation">,</span> errorFallback <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ErrorBoundary fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span>errorFallback<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>React<span class="token punctuation">.</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span>fallback<span class="token punctuation">&#125;</span><span class="token operator">></span>
        <span class="token punctuation">&#123;</span>children<span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>Suspense<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ErrorBoundary<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用示例</span>
<span class="token operator">&lt;</span>AsyncBoundary 
  fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>Spinner <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span>
  errorFallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>AsyncError <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span>
<span class="token operator">></span>
  <span class="token operator">&lt;</span>LazyComponent <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>AsyncBoundary<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="函数组件错误处理方案"><a href="#函数组件错误处理方案" class="headerlink" title="函数组件错误处理方案"></a>函数组件错误处理方案</h3><p><strong>自定义Hook实现</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">useErrorBoundary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> handleError <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> err<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> resetError <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setError</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> handleError<span class="token punctuation">,</span> resetError<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">function</span> <span class="token function">ComponentWithError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> handleError<span class="token punctuation">,</span> resetError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useErrorBoundary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span>h3<span class="token operator">></span>组件出错<span class="token operator">:</span> <span class="token punctuation">&#123;</span>error<span class="token punctuation">.</span>message<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>resetError<span class="token punctuation">&#125;</span><span class="token operator">></span>重试<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>UnstableComponent onError<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleError<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">UnstableComponent</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> onError <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 模拟错误</span>
  <span class="token keyword">const</span> <span class="token function-variable function">throwError</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 可能出错的操作</span>
      <span class="token function">riskyOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">onError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 手动触发错误边界</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>throwError<span class="token punctuation">&#125;</span><span class="token operator">></span>执行危险操作<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>第三方Hook库</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用 react-error-boundary 库</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useErrorBoundary <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-error-boundary'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">UserProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> showBoundary <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useErrorBoundary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">loadData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 处理数据...</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">showBoundary</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>loadData<span class="token punctuation">&#125;</span><span class="token operator">></span>加载数据<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="常见错误场景与解决方案"><a href="#常见错误场景与解决方案" class="headerlink" title="常见错误场景与解决方案"></a>常见错误场景与解决方案</h3><p><strong>异步错误捕获</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 错误边界无法捕获的异步错误解决方案</span>
<span class="token keyword">function</span> <span class="token function">AsyncErrorHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 全局未捕获错误处理</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleUnhandledRejection</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">setError</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> <span class="token function-variable function">handleUncaughtError</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">setError</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'unhandledrejection'</span><span class="token punctuation">,</span> handleUnhandledRejection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> handleUncaughtError<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'unhandledrejection'</span><span class="token punctuation">,</span> handleUnhandledRejection<span class="token punctuation">)</span><span class="token punctuation">;</span>
      window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> handleUncaughtError<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>GlobalErrorScreen error<span class="token operator">=</span><span class="token punctuation">&#123;</span>error<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 在应用顶层使用</span>
<span class="token operator">&lt;</span>AsyncErrorHandler<span class="token operator">></span>
  <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>AsyncErrorHandler<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>错误边界嵌套冲突</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 自定义错误传播机制</span>
<span class="token keyword">class</span> <span class="token class-name">PropagatingErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> errorInfo</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>onError<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 将错误传递给父级边界</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> errorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 没有父级处理器时处理错误</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Unhandled error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">,</span> errorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError 
      <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>fallback 
      <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用示例</span>
<span class="token operator">&lt;</span>PropagatingErrorBoundary 
  onError<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">/* 传递给上层 */</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
  fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>LocalFallback <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span>
<span class="token operator">></span>
  <span class="token operator">&lt;</span>ChildComponent <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>PropagatingErrorBoundary<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>生产环境错误处理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 生产环境专用错误边界</span>
<span class="token keyword">class</span> <span class="token class-name">ProductionErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> errorInfo</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">hasError</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 生产环境特殊处理</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">sendProductionErrorReport</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">componentStack</span><span class="token operator">:</span> errorInfo<span class="token punctuation">.</span>componentStack<span class="token punctuation">,</span>
        <span class="token literal-property property">userAgent</span><span class="token operator">:</span> navigator<span class="token punctuation">.</span>userAgent
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>productionFallback <span class="token operator">||</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"production-error"</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>h2<span class="token operator">></span>抱歉，出现了一些问题<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
          <span class="token operator">&lt;</span>p<span class="token operator">></span>我们的团队已收到通知，正在修复<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
          <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
            刷新页面
          <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="错误边界最佳实践"><a href="#错误边界最佳实践" class="headerlink" title="错误边界最佳实践"></a>错误边界最佳实践</h3><p><strong>分层错误处理策略</strong></p>
<pre><code class="mermaid">graph LR
    A[顶层边界] --&gt;|捕获全局错误| B[应用崩溃页面]
    C[模块边界] --&gt;|捕获模块错误| D[模块降级UI]
    E[组件边界] --&gt;|捕获组件错误| F[组件占位符]
    G[API边界] --&gt;|捕获数据错误| H[空状态提示]</code></pre>

<p><strong>错误恢复策略比较</strong></p>
<table>
<thead>
<tr>
<th align="left">策略</th>
<th align="left">实现方式</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">页面刷新</td>
<td align="left">window.location.reload()</td>
<td align="left">全局状态不可恢复</td>
</tr>
<tr>
<td align="left">组件重置</td>
<td align="left">key 属性变化</td>
<td align="left">独立组件失败</td>
</tr>
<tr>
<td align="left">状态回滚</td>
<td align="left">恢复之前的状态快照</td>
<td align="left">表单操作失败</td>
</tr>
<tr>
<td align="left">备用数据</td>
<td align="left">显示缓存数据</td>
<td align="left">数据获取失败</td>
</tr>
</tbody></table>
<p><strong>错误日志规范</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">logErrorBoundary</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> info</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> logEntry <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">timestamp</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> error<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
    <span class="token literal-property property">stack</span><span class="token operator">:</span> error<span class="token punctuation">.</span>stack<span class="token punctuation">,</span>
    <span class="token literal-property property">componentStack</span><span class="token operator">:</span> info<span class="token punctuation">.</span>componentStack<span class="token punctuation">,</span>
    <span class="token literal-property property">location</span><span class="token operator">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">,</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> currentUser <span class="token operator">?</span> currentUser<span class="token punctuation">.</span>id <span class="token operator">:</span> <span class="token string">'anonymous'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">platform</span><span class="token operator">:</span> navigator<span class="token punctuation">.</span>platform<span class="token punctuation">,</span>
    <span class="token literal-property property">environment</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">,</span>
    <span class="token literal-property property">version</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">REACT_APP_VERSION</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 发送到日志服务</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/logs/errors'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>logEntry<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="面试高频问题解析"><a href="#面试高频问题解析" class="headerlink" title="面试高频问题解析"></a>面试高频问题解析</h3><p><strong>Q：错误边界可以捕获哪些类型的错误？</strong></p>
<ul>
<li>子组件渲染期间的错误</li>
<li>生命周期方法中的错误（包括渲染阶段）</li>
<li>构造函数中的错误</li>
<li>整个组件树的错误（包括异步代码中的错误？不行！）</li>
</ul>
<p>特别注意：</p>
<ul>
<li>事件处理程序中的错误不会被捕获</li>
<li>异步代码（setTimeout, Promise）错误不会被捕获</li>
<li>服务端渲染错误不会被捕获</li>
<li>错误边界自身抛出的错误不会被捕获</li>
</ul>
<p><strong>Q：为什么错误边界必须用类组件实现？</strong></p>
<ul>
<li>因为错误边界依赖 getDerivedStateFromError 和 componentDidCatch 生命周期方法</li>
<li>这两个方法目前只在类组件中可用</li>
<li>React 团队表示暂时没有计划在函数组件中添加类似能力</li>
</ul>
<p><strong>Q：如何在函数组件中实现类似错误边界的功能？</strong></p>
<ul>
<li>使用类组件包装：创建错误边界类组件包裹函数组件</li>
<li>自定义Hook：使用 useErrorBoundary Hook 手动捕获错误</li>
<li>第三方库：使用 react-error-boundary 库的 useErrorBoundary Hook</li>
<li>错误传播：在函数组件中抛出错误让父级错误边界捕获</li>
</ul>
<p><strong>Q：如何测试错误边界组件？</strong></p>
<p>测试策略：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用 Jest 和 React Testing Library</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'捕获错误并显示降级UI'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 创建抛出错误的组件</span>
  <span class="token keyword">const</span> <span class="token function-variable function">ErrorComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'测试错误'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> getByText <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ErrorBoundary fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>div<span class="token operator">></span>错误捕获<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>ErrorComponent <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ErrorBoundary<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">'错误捕获'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 测试错误日志</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'记录错误到监控系统'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> mockErrorLogger <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'测试错误'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ErrorBoundary onError<span class="token operator">=</span><span class="token punctuation">&#123;</span>mockErrorLogger<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>ErrorComponent <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ErrorBoundary<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">expect</span><span class="token punctuation">(</span>mockErrorLogger<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span>
    error<span class="token punctuation">,</span>
    expect<span class="token punctuation">.</span><span class="token function">objectContaining</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      <span class="token literal-property property">componentStack</span><span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>核心功能：<ul>
<li>捕获子组件树中的渲染错误</li>
<li>展示降级UI替代崩溃界面</li>
<li>记录错误信息用于分析</li>
</ul>
</li>
<li>实现关键：<ul>
<li>getDerivedStateFromError 设置错误状态</li>
<li>componentDidCatch 记录错误信息</li>
<li>类组件专属实现</li>
</ul>
</li>
<li>最佳实践：<ul>
<li>分层错误边界策略</li>
<li>生产环境专用处理</li>
<li>与Suspense协同使用</li>
<li>完善的错误日志记录</li>
</ul>
</li>
<li>React 18 增强：<ul>
<li>与并发渲染兼容</li>
<li>与Suspense深度集成</li>
<li>更精细的错误处理控制</li>
</ul>
</li>
<li>面试重点：<ul>
<li>错误边界的捕获范围</li>
<li>类组件的必要性</li>
<li>函数组件的替代方案</li>
<li>测试策略与方法</li>
</ul>
</li>
</ul>
<h2 id="4-3-代码分割与懒加载（React-lazy-Suspense）"><a href="#4-3-代码分割与懒加载（React-lazy-Suspense）" class="headerlink" title="4.3 代码分割与懒加载（React.lazy + Suspense）"></a>4.3 代码分割与懒加载（React.lazy + Suspense）</h2><h3 id="代码分割核心概念"><a href="#代码分割核心概念" class="headerlink" title="代码分割核心概念"></a>代码分割核心概念</h3><p><strong>问题背景：传统打包痛点</strong></p>
<pre><code class="mermaid">graph TD
    A[单入口打包] --&gt; B[巨大的 bundle 文件]
    B --&gt; C[首屏加载缓慢]
    B --&gt; D[资源浪费]
    B --&gt; E[用户体验差]</code></pre>

<p><strong>代码分割核心价值</strong></p>
<table>
<thead>
<tr>
<th align="left">优化方向</th>
<th align="left">实现效果</th>
<th align="left">技术手段</th>
</tr>
</thead>
<tbody><tr>
<td align="left">首屏加载</td>
<td align="left">减少初始加载体积</td>
<td align="left">路由级分割</td>
</tr>
<tr>
<td align="left">按需加载</td>
<td align="left">使用时才加载资源</td>
<td align="left">组件级懒加载</td>
</tr>
<tr>
<td align="left">缓存优化</td>
<td align="left">更细粒度缓存控制</td>
<td align="left">模块分离</td>
</tr>
<tr>
<td align="left">并行加载</td>
<td align="left">利用浏览器并发能力</td>
<td align="left">多 chunk 并行</td>
</tr>
</tbody></table>
<h3 id="基础实现方案"><a href="#基础实现方案" class="headerlink" title="基础实现方案"></a>基础实现方案</h3><p><strong>Webpack 动态导入</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 动态导入语法</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"./math"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">math</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// React 组件动态导入</span>
<span class="token keyword">const</span> ProductModal <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./ProductModal'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>React.lazy 基础用法</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> HomePage <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./pages/HomePage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> AboutPage <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./pages/AboutPage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ContactPage <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./pages/ContactPage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Routes<span class="token operator">></span>
      <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span>
        <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>Spinner <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>HomePage <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
      <span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/about"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span>
        <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>Spinner <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>AboutPage <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
      <span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/contact"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span>
        <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>Spinner <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>ContactPage <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
      <span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Routes<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Suspense 核心机制</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">UserDashboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>UserProfile <span class="token operator">/</span><span class="token operator">></span>
      
      <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>CardSkeleton <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>RecentActivities <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
      
      <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>ChartPlaceholder <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>PerformanceChart <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 嵌套 Suspense 示例</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>FullPageSpinner <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Header <span class="token operator">/</span><span class="token operator">></span>
      
      <span class="token operator">&lt;</span>main<span class="token operator">></span>
        <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>ContentLoader <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>Router<span class="token operator">></span>
            <span class="token operator">&lt;</span>Routes<span class="token operator">></span>
              <span class="token punctuation">&#123;</span><span class="token comment">/* 路由配置 */</span><span class="token punctuation">&#125;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>Routes<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">></span>
      
      <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">null</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>LiveChatWidget <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高级优化策略"><a href="#高级优化策略" class="headerlink" title="高级优化策略"></a>高级优化策略</h3><p><strong>路由级代码分割</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 路由配置文件</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>PageLoader <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>HomePage <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/dashboard'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>DashboardSkeleton <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>DashboardLayout <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'analytics'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>ChartLoader <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>AnalyticsPage <span class="token operator">/</span><span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'settings'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>SettingsPlaceholder <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>SettingsPage <span class="token operator">/</span><span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>组件级懒加载</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> ProductGallery <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./ProductGallery'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ProductReviews <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./ProductReviews'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> RelatedProducts <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./RelatedProducts'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">ProductDetailPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>activeTab<span class="token punctuation">,</span> setActiveTab<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'gallery'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token punctuation">&#123;</span><span class="token comment">/* 标签切换 */</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>Tabs onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span>setActiveTab<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"tab-content"</span><span class="token operator">></span>
        <span class="token punctuation">&#123;</span>activeTab <span class="token operator">===</span> <span class="token string">'gallery'</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>ImageGridSkeleton <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>ProductGallery <span class="token operator">/</span><span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
        
        <span class="token punctuation">&#123;</span>activeTab <span class="token operator">===</span> <span class="token string">'reviews'</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>ReviewListSkeleton <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>ProductReviews <span class="token operator">/</span><span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
        
        <span class="token punctuation">&#123;</span>activeTab <span class="token operator">===</span> <span class="token string">'related'</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>ProductCardSkeleton count<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">3</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>RelatedProducts <span class="token operator">/</span><span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>预加载优化</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 预加载组件</span>
<span class="token keyword">function</span> <span class="token function">PreloadComponent</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> component <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    component<span class="token punctuation">.</span><span class="token function">preload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>component<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 路由预加载</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 预加载可能访问的页面</span>
    <span class="token keyword">const</span> preloadPages <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./pages/AboutPage'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./pages/ContactPage'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 用户空闲时预加载</span>
    <span class="token keyword">const</span> idleCallback <span class="token operator">=</span> <span class="token function">requestIdleCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      preloadPages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">preload</span> <span class="token operator">=></span> <span class="token function">preload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">cancelIdleCallback</span><span class="token punctuation">(</span>idleCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Router<span class="token operator">></span>
      <span class="token operator">&lt;</span>Routes<span class="token operator">></span>
        <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>HomePage <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/about"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span>
          <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>Loader <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./pages/AboutPage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
        <span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/contact"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span>
          <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>Loader <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./pages/ContactPage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
        <span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Routes<span class="token operator">></span>
      
      <span class="token punctuation">&#123;</span><span class="token comment">/* 悬停预加载 */</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>NavLink 
        to<span class="token operator">=</span><span class="token string">"/about"</span>
        onMouseEnter<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./pages/AboutPage'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
      <span class="token operator">></span>
        关于我们
      <span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="性能优化进阶技巧"><a href="#性能优化进阶技巧" class="headerlink" title="性能优化进阶技巧"></a>性能优化进阶技巧</h3><p><strong>模块联合（微前端）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 动态加载远程模块</span>
<span class="token keyword">const</span> RemoteComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'remote_app/Component'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> 
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./FallbackComponent'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>RemoteLoader <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>RemoteComponent <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// Webpack 配置</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'host_app'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">remotes</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">remote_app</span><span class="token operator">:</span> <span class="token string">'remote_app@http://remote-domain.com/remoteEntry.js'</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>资源优先级控制</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 预加载关键资源</span>
<span class="token keyword">function</span> <span class="token function">CriticalResourceLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Head<span class="token operator">></span>
      <span class="token punctuation">&#123;</span><span class="token comment">/* 关键 CSS */</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>link 
        rel<span class="token operator">=</span><span class="token string">"preload"</span> 
        href<span class="token operator">=</span><span class="token string">"/critical.css"</span> 
        <span class="token keyword">as</span><span class="token operator">=</span><span class="token string">"style"</span> 
        onLoad<span class="token operator">=</span><span class="token string">"this.rel='stylesheet'"</span>
      <span class="token operator">/</span><span class="token operator">></span>
      
      <span class="token punctuation">&#123;</span><span class="token comment">/* 关键脚本 */</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>link 
        rel<span class="token operator">=</span><span class="token string">"modulepreload"</span> 
        href<span class="token operator">=</span><span class="token string">"/main.js"</span> 
        <span class="token keyword">as</span><span class="token operator">=</span><span class="token string">"script"</span>
      <span class="token operator">/</span><span class="token operator">></span>
      
      <span class="token punctuation">&#123;</span><span class="token comment">/* 字体预加载 */</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>link
        rel<span class="token operator">=</span><span class="token string">"preload"</span>
        href<span class="token operator">=</span><span class="token string">"/fonts/inter.woff2"</span>
        <span class="token keyword">as</span><span class="token operator">=</span><span class="token string">"font"</span>
        type<span class="token operator">=</span><span class="token string">"font/woff2"</span>
        crossOrigin<span class="token operator">=</span><span class="token string">"anonymous"</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Head<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 延迟加载非关键资源</span>
<span class="token keyword">function</span> <span class="token function">LazyNonCritical</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">loadNonCritical</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./analytics.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./chat-widget.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 空闲时加载</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'requestIdleCallback'</span> <span class="token keyword">in</span> window<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">requestIdleCallback</span><span class="token punctuation">(</span>loadNonCritical<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span>loadNonCritical<span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>骨架屏优化技巧</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 高级骨架屏组件</span>
<span class="token keyword">function</span> <span class="token function">ProductCardSkeleton</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> count <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">length</span><span class="token operator">:</span> count <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div key<span class="token operator">=</span><span class="token punctuation">&#123;</span>index<span class="token punctuation">&#125;</span> className<span class="token operator">=</span><span class="token string">"skeleton-card"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"skeleton-image"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"skeleton-line w-3/4"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"skeleton-line w-1/2"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"skeleton-line w-1/3"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-CSS" data-language="CSS"><code class="language-CSS">&#x2F;&#x2F; CSS 动画优化
@keyframes pulse &#123;
  0%, 100% &#123; opacity: 1; &#125;
  50% &#123; opacity: 0.5; &#125;
&#125;

.skeleton-card &#123;
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  background-color: #e5e7eb;
  border-radius: 0.5rem;
  overflow: hidden;
&#125;

.skeleton-line &#123;
  height: 1rem;
  margin-top: 0.75rem;
  background-color: #d1d5db;
  border-radius: 0.25rem;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="常见问题与解决方案"><a href="#常见问题与解决方案" class="headerlink" title="常见问题与解决方案"></a>常见问题与解决方案</h3><p><strong>大型模块加载优化</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 分块加载大型模块</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loadLargeModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>part1<span class="token punctuation">,</span> part2<span class="token punctuation">,</span> part3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./modulePart1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./modulePart2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./modulePart3'</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token operator">...</span>part1<span class="token punctuation">,</span>
    <span class="token operator">...</span>part2<span class="token punctuation">,</span>
    <span class="token operator">...</span>part3
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 渐进式加载</span>
<span class="token keyword">const</span> LargeComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 先加载核心部分</span>
  <span class="token keyword">const</span> core <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./CoreComponent'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 空闲时加载增强部分</span>
  <span class="token function">requestIdleCallback</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> enhancements <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./Enhancements'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    core<span class="token punctuation">.</span><span class="token function">enhance</span><span class="token punctuation">(</span>enhancements<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> core<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><ul>
<li>核心价值：<ul>
<li>显著减少首屏加载时间</li>
<li>按需加载提升资源利用率</li>
<li>改善用户体验</li>
</ul>
</li>
<li>关键技术：<ul>
<li>React.lazy：组件动态导入</li>
<li>Suspense：加载状态管理</li>
<li>动态 import()：代码分割基础</li>
</ul>
</li>
<li>最佳实践：<ul>
<li>路由级分割：按页面拆分</li>
<li>组件级懒加载：非核心功能延迟加载</li>
<li>预加载优化：预测用户行为</li>
<li>骨架屏技术：优化加载体验</li>
</ul>
</li>
<li>React 18 增强：<ul>
<li>流式 SSR 渲染</li>
<li>并发模式下的 Suspense</li>
<li>更精细的加载控制</li>
</ul>
</li>
<li>企业级方案：<ul>
<li>错误边界集成</li>
<li>微前端架构支持</li>
<li>性能监控与分析</li>
</ul>
</li>
<li>常见问题解决：<ul>
<li>加载闪烁控制</li>
<li>模块加载失败处理</li>
<li>大型模块优化</li>
</ul>
</li>
</ul>
<h2 id="4-4-Portals（渲染到-DOM-外部节点）"><a href="#4-4-Portals（渲染到-DOM-外部节点）" class="headerlink" title="4.4 Portals（渲染到 DOM 外部节点）"></a>4.4 Portals（渲染到 DOM 外部节点）</h2><h3 id="Portals-核心概念"><a href="#Portals-核心概念" class="headerlink" title="Portals 核心概念"></a>Portals 核心概念</h3><p><strong>解决的问题场景</strong></p>
<pre><code class="mermaid">graph TD
    A[父组件] --&gt; B[overflow: hidden]
    A --&gt; C[z-index 层级限制]
    A --&gt; D[transform 上下文]
    B --&gt; E[子元素显示不全]
    C --&gt; F[模态框被遮挡]
    D --&gt; G[fixed 定位失效]</code></pre>

<p><strong>Portals 核心能力</strong></p>
<table>
<thead>
<tr>
<th align="left">能力</th>
<th align="left">描述</th>
<th align="left">应用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">突破层级限制</td>
<td align="left">渲染到 DOM 树任意位置</td>
<td align="left">模态框、弹出层</td>
</tr>
<tr>
<td align="left">保留 React 上下文</td>
<td align="left">保持事件冒泡和上下文</td>
<td align="left">全局通知</td>
</tr>
<tr>
<td align="left">样式隔离</td>
<td align="left">避免父容器样式影响</td>
<td align="left">工具提示</td>
</tr>
<tr>
<td align="left">无障碍支持</td>
<td align="left">管理焦点和键盘事件</td>
<td align="left">无障碍对话框</td>
</tr>
</tbody></table>
<h3 id="基础用法与API"><a href="#基础用法与API" class="headerlink" title="基础用法与API"></a>基础用法与API</h3><p><strong>ReactDOM.createPortal 基础</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Modal</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children<span class="token punctuation">,</span> isOpen <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isOpen<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 创建 Portal 渲染到 body 外的独立容器</span>
  <span class="token keyword">return</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createPortal</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"modal"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"modal-content"</span><span class="token operator">></span>
        <span class="token punctuation">&#123;</span>children<span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'modal-root'</span><span class="token punctuation">)</span> <span class="token comment">// 外部容器</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 在 public/index.html 中添加容器</span>
<span class="token operator">&lt;</span>body<span class="token operator">></span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"root"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"modal-root"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Portal 目标容器 <span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>动态容器管理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">SmartPortal</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> children<span class="token punctuation">,</span> containerId <span class="token operator">=</span> <span class="token string">'portal-root'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>container<span class="token punctuation">,</span> setContainer<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 查找或创建容器</span>
    <span class="token keyword">let</span> portalContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>containerId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>portalContainer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      portalContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      portalContainer<span class="token punctuation">.</span>id <span class="token operator">=</span> containerId<span class="token punctuation">;</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>portalContainer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token function">setContainer</span><span class="token punctuation">(</span>portalContainer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 清理容器</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>portalContainer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>portalContainer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>containerId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>container<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createPortal</span><span class="token punctuation">(</span>children<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用示例</span>
<span class="token operator">&lt;</span>SmartPortal<span class="token operator">></span>
  <span class="token operator">&lt;</span>Notification message<span class="token operator">=</span><span class="token string">"操作成功！"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>SmartPortal<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="核心应用场景"><a href="#核心应用场景" class="headerlink" title="核心应用场景"></a>核心应用场景</h3><p><strong>模态对话框实现</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">ModalDialog</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> title<span class="token punctuation">,</span> children<span class="token punctuation">,</span> onClose <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 阻止背景滚动</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> <span class="token string">'hidden'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"modal-overlay"</span> onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>onClose<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>div 
        className<span class="token operator">=</span><span class="token string">"modal-dialog"</span> 
        onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token parameter">e</span> <span class="token operator">=></span> e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
      <span class="token operator">></span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"modal-header"</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>h2<span class="token operator">></span><span class="token punctuation">&#123;</span>title<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
          <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>onClose<span class="token punctuation">&#125;</span> aria<span class="token operator">-</span>label<span class="token operator">=</span><span class="token string">"关闭"</span><span class="token operator">></span>
            <span class="token operator">&amp;</span>times<span class="token punctuation">;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"modal-body"</span><span class="token operator">></span>
          <span class="token punctuation">&#123;</span>children<span class="token punctuation">&#125;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用 Portal 的模态框组件</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Modal</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> isOpen<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isOpen<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createPortal</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ModalDialog <span class="token punctuation">&#123;</span><span class="token operator">...</span>props<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'modal-root'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>全局通知系统</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> NotificationContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">NotificationProvider</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>notifications<span class="token punctuation">,</span> setNotifications<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> addNotification <span class="token operator">=</span> <span class="token punctuation">(</span>message<span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">'info'</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setNotifications</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token operator">...</span>prev<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> id<span class="token punctuation">,</span> message<span class="token punctuation">,</span> type <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 自动关闭</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">removeNotification</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">removeNotification</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setNotifications</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> prev<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">n</span> <span class="token operator">=></span> n<span class="token punctuation">.</span>id <span class="token operator">!==</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>NotificationContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> addNotification <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token punctuation">&#123;</span>children<span class="token punctuation">&#125;</span>
      
      <span class="token punctuation">&#123;</span><span class="token comment">/* 使用 Portal 渲染到独立区域 */</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>SmartPortal containerId<span class="token operator">=</span><span class="token string">"notification-portal"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"notification-container"</span><span class="token operator">></span>
          <span class="token punctuation">&#123;</span>notifications<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">notification</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>NotificationItem 
              key<span class="token operator">=</span><span class="token punctuation">&#123;</span>notification<span class="token punctuation">.</span>id<span class="token punctuation">&#125;</span>
              notification<span class="token operator">=</span><span class="token punctuation">&#123;</span>notification<span class="token punctuation">&#125;</span>
              onClose<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">removeNotification</span><span class="token punctuation">(</span>notification<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
            <span class="token operator">/</span><span class="token operator">></span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>SmartPortal<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>NotificationContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 通知项组件</span>
<span class="token keyword">function</span> <span class="token function">NotificationItem</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> notification<span class="token punctuation">,</span> onClose <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">notification </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>notification<span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span>notification<span class="token punctuation">.</span>message<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>onClose<span class="token punctuation">&#125;</span> aria<span class="token operator">-</span>label<span class="token operator">=</span><span class="token string">"关闭通知"</span><span class="token operator">></span>
        <span class="token operator">&amp;</span>times<span class="token punctuation">;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工具提示与悬浮框</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Tooltip</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children<span class="token punctuation">,</span> content <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isVisible<span class="token punctuation">,</span> setIsVisible<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>position<span class="token punctuation">,</span> setPosition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> triggerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">updatePosition</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>triggerRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> rect <span class="token operator">=</span> triggerRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> rect<span class="token punctuation">.</span>bottom <span class="token operator">+</span> window<span class="token punctuation">.</span>scrollY<span class="token punctuation">,</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> rect<span class="token punctuation">.</span>left <span class="token operator">+</span> rect<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isVisible<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">updatePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> updatePosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> updatePosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>isVisible<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>span
        ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>triggerRef<span class="token punctuation">&#125;</span>
        onMouseEnter<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setIsVisible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
        onMouseLeave<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setIsVisible</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
        onFocus<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setIsVisible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
        onBlur<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setIsVisible</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
        aria<span class="token operator">-</span>describedby<span class="token operator">=</span><span class="token string">"tooltip-content"</span>
      <span class="token operator">></span>
        <span class="token punctuation">&#123;</span>children<span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
      
      <span class="token punctuation">&#123;</span><span class="token comment">/* 使用 Portal 避免被父容器裁剪 */</span><span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#123;</span>isVisible <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>SmartPortal<span class="token operator">></span>
          <span class="token operator">&lt;</span>div 
            id<span class="token operator">=</span><span class="token string">"tooltip-content"</span>
            className<span class="token operator">=</span><span class="token string">"tooltip"</span>
            role<span class="token operator">=</span><span class="token string">"tooltip"</span>
            style<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>
              <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
              <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>position<span class="token punctuation">.</span>top<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
              <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>position<span class="token punctuation">.</span>left<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
              <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token string">'translateX(-50%)'</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
          <span class="token operator">></span>
            <span class="token punctuation">&#123;</span>content<span class="token punctuation">&#125;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>SmartPortal<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高级特性与模式"><a href="#高级特性与模式" class="headerlink" title="高级特性与模式"></a>高级特性与模式</h3><p><strong>事件冒泡处理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">EventDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handlePortalClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Portal 内容被点击'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">handleParentClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'父组件被点击'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleParentClick<span class="token punctuation">&#125;</span> className<span class="token operator">=</span><span class="token string">"parent"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>h2<span class="token operator">></span>事件冒泡测试<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      
      <span class="token punctuation">&#123;</span><span class="token comment">/* Portal 内容会冒泡到 React 树中的父组件 */</span><span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#123;</span>ReactDOM<span class="token punctuation">.</span><span class="token function">createPortal</span><span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>handlePortalClick<span class="token punctuation">&#125;</span><span class="token operator">></span>
          点击我（Portal 按钮）
        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">,</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'portal-root'</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
      
      <span class="token operator">&lt;</span>p<span class="token operator">></span>
        点击 Portal 按钮会触发两个日志：<span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">></span>
        <span class="token number">1.</span> <span class="token string">"Portal 内容被点击"</span><span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">></span>
        <span class="token number">2.</span> <span class="token string">"父组件被点击"</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>上下文传递</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">'light'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">ThemedPortalDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token string">"dark"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>Header <span class="token operator">/</span><span class="token operator">></span>
        
        <span class="token punctuation">&#123;</span><span class="token comment">/* Portal 内容能访问 React 树中的上下文 */</span><span class="token punctuation">&#125;</span>
        <span class="token operator">&lt;</span>SmartPortal<span class="token operator">></span>
          <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span>
            <span class="token punctuation">&#123;</span><span class="token parameter">theme</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
              <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">theme-box </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>theme<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
                <span class="token literal-property property">当前主题</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>theme<span class="token punctuation">&#125;</span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
            <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>SmartPortal<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>无障碍对话框实现</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">AccessibleModal</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> isOpen<span class="token punctuation">,</span> title<span class="token punctuation">,</span> children<span class="token punctuation">,</span> onClose <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> modalRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 关闭时返回焦点到触发元素</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> triggerElement <span class="token operator">=</span> document<span class="token punctuation">.</span>activeElement<span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isOpen <span class="token operator">&amp;&amp;</span> modalRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      modalRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>triggerElement<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        triggerElement<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>isOpen<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ESC 键关闭</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleKeyDown</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'Escape'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">onClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isOpen<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> handleKeyDown<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> handleKeyDown<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>isOpen<span class="token punctuation">,</span> onClose<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isOpen<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createPortal</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div 
      className<span class="token operator">=</span><span class="token string">"modal"</span>
      role<span class="token operator">=</span><span class="token string">"dialog"</span>
      aria<span class="token operator">-</span>modal<span class="token operator">=</span><span class="token string">"true"</span>
      aria<span class="token operator">-</span>labelledby<span class="token operator">=</span><span class="token string">"modal-title"</span>
      ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>modalRef<span class="token punctuation">&#125;</span>
      tabIndex<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">&#125;</span>
    <span class="token operator">></span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"modal-content"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>h2 id<span class="token operator">=</span><span class="token string">"modal-title"</span><span class="token operator">></span><span class="token punctuation">&#123;</span>title<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">&#123;</span>children<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>onClose<span class="token punctuation">&#125;</span> aria<span class="token operator">-</span>label<span class="token operator">=</span><span class="token string">"关闭对话框"</span><span class="token operator">></span>
          关闭
        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'modal-root'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="企业级最佳实践-1"><a href="#企业级最佳实践-1" class="headerlink" title="企业级最佳实践"></a>企业级最佳实践</h3><p><strong>微前端集成</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">MicroFrontendPortal</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> appName<span class="token punctuation">,</span> componentName <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>Component<span class="token punctuation">,</span> setComponent<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 动态加载远程模块</span>
    <span class="token keyword">const</span> <span class="token function-variable function">loadRemoteComponent</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> remoteModule <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">[</span>appName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>componentName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setComponent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> remoteModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">加载 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>appName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>componentName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> 失败:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token function">loadRemoteComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>appName<span class="token punctuation">,</span> componentName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Component<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>加载中<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>SmartPortal containerId<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>appName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">-portal</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Component <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>SmartPortal<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用示例</span>
<span class="token operator">&lt;</span>MicroFrontendPortal 
  appName<span class="token operator">=</span><span class="token string">"billingApp"</span> 
  componentName<span class="token operator">=</span><span class="token string">"PaymentWidget"</span> 
<span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="面试高频问题解析-1"><a href="#面试高频问题解析-1" class="headerlink" title="面试高频问题解析"></a>面试高频问题解析</h3><p><strong>Q：Portals 和普通渲染有什么区别？</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">普通渲染</th>
<th align="left">Portal</th>
</tr>
</thead>
<tbody><tr>
<td align="left">DOM 位置</td>
<td align="left">父组件内</td>
<td align="left">任意 DOM 节点</td>
</tr>
<tr>
<td align="left">事件冒泡</td>
<td align="left">遵循 DOM 结构</td>
<td align="left">遵循 React 树结构</td>
</tr>
<tr>
<td align="left">上下文访问</td>
<td align="left">正常访问</td>
<td align="left">正常访问</td>
</tr>
<tr>
<td align="left">样式继承</td>
<td align="left">受父容器影响</td>
<td align="left">可避免父容器影响</td>
</tr>
<tr>
<td align="left">应用场景</td>
<td align="left">常规 UI</td>
<td align="left">模态框、通知等</td>
</tr>
</tbody></table>
<p><strong>Q：为什么 Portal 的事件冒泡到 React 父组件？</strong></p>
<ul>
<li>Portal 的特殊之处在于它在 DOM 树中的位置是独立的</li>
<li>但 React 的事件系统是合成的，不依赖实际 DOM 结构</li>
<li>事件冒泡基于 React 组件树结构，而非实际 DOM 结构</li>
<li>因此 Portal 中的事件会冒泡到 React 树中的父组件</li>
</ul>
<p><strong>Q：如何阻止 Portal 的事件冒泡？</strong></p>
<p>解决方案：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">PortalWithStopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handlePortalClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 阻止事件冒泡</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Portal 点击'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createPortal</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>handlePortalClick<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>button<span class="token operator">></span>点击我<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'portal-root'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Q：Portals 对无障碍有什么影响？</strong></p>
<p>最佳实践：</p>
<ul>
<li>焦点管理：打开 Portal 时移动焦点到内容，关闭时返回焦点</li>
<li>ARIA 属性：使用 role&#x3D;”dialog” 和 aria-modal&#x3D;”true”</li>
<li>键盘导航：实现 ESC 关闭和 Tab 键陷阱</li>
<li>屏幕阅读器：使用 aria-labelledby 关联标题</li>
<li>背景遮蔽：添加 aria-hidden&#x3D;”true” 到背景内容</li>
</ul>
<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><ul>
<li>核心价值：<ul>
<li>突破 CSS 层级限制（overflow, z-index, transform）</li>
<li>保持 React 上下文和事件系统</li>
<li>实现全局 UI 元素（模态框、通知、工具提示）</li>
</ul>
</li>
<li>关键技术：<ul>
<li>ReactDOM.createPortal() API</li>
<li>动态容器管理</li>
<li>事件冒泡处理</li>
<li>无障碍支持</li>
</ul>
</li>
<li>最佳实践：<ul>
<li>模态框实现（包含焦点管理）</li>
<li>全局通知系统</li>
<li>服务端渲染兼容</li>
<li>微前端集成</li>
</ul>
</li>
<li>React 18 增强：<ul>
<li>新的 Root API 支持</li>
<li>并发渲染兼容</li>
<li>更精细的控制能力</li>
</ul>
</li>
<li>企业级应用：<ul>
<li>安全沙箱模式</li>
<li>性能优化策略</li>
<li>调试与监控</li>
</ul>
</li>
<li>面试重点：<ul>
<li>Portals 与普通渲染的区别</li>
<li>事件冒泡机制</li>
<li>无障碍实现</li>
<li>服务端渲染处理</li>
</ul>
</li>
</ul>
<h2 id="4-5-高阶组件（HOC）与-Render-Props"><a href="#4-5-高阶组件（HOC）与-Render-Props" class="headerlink" title="4.5 高阶组件（HOC）与 Render Props"></a>4.5 高阶组件（HOC）与 Render Props</h2><h3 id="组件复用的核心挑战"><a href="#组件复用的核心挑战" class="headerlink" title="组件复用的核心挑战"></a>组件复用的核心挑战</h3><p><strong>传统组件复用的问题</strong></p>
<pre><code class="mermaid">graph TD
    A[组件复用需求] --&gt; B[直接继承]
    A --&gt; C[组合模式]
    B --&gt; D[紧耦合]
    B --&gt; E[灵活性差]
    C --&gt; F[多层嵌套]
    C --&gt; G[props 透传问题]</code></pre>

<p><strong>解决方案对比</strong></p>
<table>
<thead>
<tr>
<th align="left">模式</th>
<th align="left">核心思想</th>
<th align="left">适用场景</th>
<th align="left">优点</th>
<th align="left">缺点</th>
</tr>
</thead>
<tbody><tr>
<td align="left">高阶组件 (HOC)</td>
<td align="left">函数接受组件返回新组件</td>
<td align="left">横切关注点</td>
<td align="left">逻辑复用强</td>
<td align="left">嵌套过深</td>
</tr>
<tr>
<td align="left">Render Props</td>
<td align="left">组件通过 prop 渲染内容</td>
<td align="left">动态组合</td>
<td align="left">灵活直观</td>
<td align="left">回调地狱</td>
</tr>
<tr>
<td align="left">自定义 Hooks</td>
<td align="left">函数封装可复用逻辑</td>
<td align="left">功能复用</td>
<td align="left">简洁高效</td>
<td align="left">仅函数组件</td>
</tr>
</tbody></table>
<h3 id="高阶组件（HOC）深度解析"><a href="#高阶组件（HOC）深度解析" class="headerlink" title="高阶组件（HOC）深度解析"></a>高阶组件（HOC）深度解析</h3><p><strong>HOC 核心概念</strong></p>
<p>定义：高阶组件是一个函数，接受一个组件并返回一个新的增强组件。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> EnhancedComponent <span class="token operator">=</span> <span class="token function">withEnhancement</span><span class="token punctuation">(</span>WrappedComponent<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>HOC 实现模式</strong></p>
<p>(1) 属性代理（Props Proxy）</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">withDataFetching</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent<span class="token punctuation">,</span> fetchUrl</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> React<span class="token punctuation">.</span>Component <span class="token punctuation">&#123;</span>
    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">fetch</span><span class="token punctuation">(</span>fetchUrl<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> error<span class="token punctuation">,</span> <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> loading<span class="token punctuation">,</span> error <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
      
      <span class="token comment">// 注入额外 props</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>WrappedComponent 
          <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">&#125;</span> 
          data<span class="token operator">=</span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span> 
          loading<span class="token operator">=</span><span class="token punctuation">&#123;</span>loading<span class="token punctuation">&#125;</span> 
          error<span class="token operator">=</span><span class="token punctuation">&#123;</span>error<span class="token punctuation">&#125;</span> 
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> UserProfileWithData <span class="token operator">=</span> <span class="token function">withDataFetching</span><span class="token punctuation">(</span>UserProfile<span class="token punctuation">,</span> <span class="token string">'/api/user/123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(2) 反向继承（Inheritance Inversion）</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">withLogging</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> WrappedComponent <span class="token punctuation">&#123;</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Component mounted:'</span><span class="token punctuation">,</span> WrappedComponent<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">super</span><span class="token punctuation">.</span>componentDidMount<span class="token operator">?.</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Component unmounted:'</span><span class="token punctuation">,</span> WrappedComponent<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">super</span><span class="token punctuation">.</span>componentWillUnmount<span class="token operator">?.</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 可操作渲染输出</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>hidden<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      
      <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> EnhancedComponent <span class="token operator">=</span> <span class="token function">withLogging</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>HOC 链式组合</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 组合多个 HOC</span>
<span class="token keyword">const</span> enhance <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>
  withRouter<span class="token punctuation">,</span>
  <span class="token function">withStyles</span><span class="token punctuation">(</span>styles<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">withDataFetching</span><span class="token punctuation">(</span><span class="token string">'/api/data'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  withErrorBoundary
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> SuperComponent <span class="token operator">=</span> <span class="token function">enhance</span><span class="token punctuation">(</span>BaseComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 自定义 compose 函数</span>
<span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>hocs</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token parameter">Component</span> <span class="token operator">=></span> 
    hocs<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> hoc</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">hoc</span><span class="token punctuation">(</span>acc<span class="token punctuation">)</span><span class="token punctuation">,</span> Component<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>HOC 最佳实践</strong></p>
<p>(1) 显示名称设置</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">withDisplayName</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">WithDisplayName</span> <span class="token operator">=</span> <span class="token parameter">props</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">&#123;</span><span class="token operator">...</span>props<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  
  <span class="token comment">// 设置 displayName 便于调试</span>
  <span class="token keyword">const</span> displayName <span class="token operator">=</span> 
    WrappedComponent<span class="token punctuation">.</span>displayName <span class="token operator">||</span> WrappedComponent<span class="token punctuation">.</span>name <span class="token operator">||</span> <span class="token string">'Component'</span><span class="token punctuation">;</span>
  
  WithDisplayName<span class="token punctuation">.</span>displayName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">WithDisplayName(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>displayName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> WithDisplayName<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(2) 静态方法复制</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">copyStaticMethods</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent<span class="token punctuation">,</span> EnhancedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 复制静态方法</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>WrappedComponent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> WrappedComponent<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      EnhancedComponent<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> WrappedComponent<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 复制静态属性</span>
  EnhancedComponent<span class="token punctuation">.</span>staticProperty <span class="token operator">=</span> WrappedComponent<span class="token punctuation">.</span>staticProperty<span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> EnhancedComponent<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(3) Refs 转发</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">withRefForwarding</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">class</span> <span class="token class-name">WithRefForwarding</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> forwardedRef<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
      
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>WrappedComponent 
          ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>forwardedRef<span class="token punctuation">&#125;</span> 
          <span class="token punctuation">&#123;</span><span class="token operator">...</span>rest<span class="token punctuation">&#125;</span> 
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token comment">// 使用 forwardRef 转发 ref</span>
  <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>WithRefForwarding <span class="token punctuation">&#123;</span><span class="token operator">...</span>props<span class="token punctuation">&#125;</span> forwardedRef<span class="token operator">=</span><span class="token punctuation">&#123;</span>ref<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Render-Props-深度解析"><a href="#Render-Props-深度解析" class="headerlink" title="Render Props 深度解析"></a>Render Props 深度解析</h3><p><strong>Render Props 核心概念</strong></p>
<p>定义：组件通过一个函数 prop（通常命名为 render 或 children）来动态决定渲染内容。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>DataProvider render<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>基础实现模式</strong></p>
<p>(1) 标准 Render Prop</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">MouseTracker</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token function-variable function">handleMouseMove</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      <span class="token literal-property property">x</span><span class="token operator">:</span> event<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>
      <span class="token literal-property property">y</span><span class="token operator">:</span> event<span class="token punctuation">.</span>clientY
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div onMouseMove<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleMouseMove<span class="token punctuation">&#125;</span><span class="token operator">></span>
        <span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token operator">&lt;</span>MouseTracker render<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> x<span class="token punctuation">,</span> y <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>p<span class="token operator">></span>鼠标位置<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>x<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>y<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(2) Children as Function</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Toggle</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>on<span class="token punctuation">,</span> setOn<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">toggle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setOn</span><span class="token punctuation">(</span><span class="token operator">!</span>on<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    on<span class="token punctuation">,</span>
    toggle
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token operator">&lt;</span>Toggle<span class="token operator">></span>
  <span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> on<span class="token punctuation">,</span> toggle <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>toggle<span class="token punctuation">&#125;</span><span class="token operator">></span>
        <span class="token punctuation">&#123;</span>on <span class="token operator">?</span> <span class="token string">'ON'</span> <span class="token operator">:</span> <span class="token string">'OFF'</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token punctuation">&#123;</span>on <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>Modal content<span class="token operator">=</span><span class="token string">"开启状态"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Toggle<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>高级 Render Props 模式</strong></p>
<p>(1) 组合多个 Render Props</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">CombinedProvider</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> theme<span class="token punctuation">,</span> children <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>DataProvider data<span class="token operator">=</span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token punctuation">&#123;</span><span class="token parameter">dataProps</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>ThemeProvider theme<span class="token operator">=</span><span class="token punctuation">&#123;</span>theme<span class="token punctuation">&#125;</span><span class="token operator">></span>
          <span class="token punctuation">&#123;</span><span class="token parameter">themeProps</span> <span class="token operator">=></span> <span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>dataProps<span class="token punctuation">,</span> <span class="token operator">...</span>themeProps <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeProvider<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>DataProvider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token operator">&lt;</span>CombinedProvider data<span class="token operator">=</span><span class="token punctuation">&#123;</span>apiData<span class="token punctuation">&#125;</span> theme<span class="token operator">=</span><span class="token string">"dark"</span><span class="token operator">></span>
  <span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> loading<span class="token punctuation">,</span> theme <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">app </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>theme<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token punctuation">&#123;</span>loading <span class="token operator">?</span> <span class="token operator">&lt;</span>Spinner <span class="token operator">/</span><span class="token operator">></span> <span class="token operator">:</span> <span class="token operator">&lt;</span>Content data<span class="token operator">=</span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>CombinedProvider<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(2) Render Props + Hooks</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">useCounter</span><span class="token punctuation">(</span><span class="token parameter">initialCount <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">decrement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> c <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> count<span class="token punctuation">,</span> increment<span class="token punctuation">,</span> decrement <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">useCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">children</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token operator">&lt;</span>Counter<span class="token operator">></span>
  <span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> count<span class="token punctuation">,</span> increment<span class="token punctuation">,</span> decrement <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>decrement<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>increment<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Counter<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="HOC-与-Render-Props-对比"><a href="#HOC-与-Render-Props-对比" class="headerlink" title="HOC 与 Render Props 对比"></a>HOC 与 Render Props 对比</h3><p><strong>技术对比</strong></p>
<pre><code class="mermaid">graph LR
    A[HOC] --&gt; B[属性代理]
    A --&gt; C[反向继承]
    D[Render Props] --&gt; E[函数作为子组件]
    D --&gt; F[Render Prop]
    
    B --&gt; G[注入Props]
    C --&gt; H[操作组件]
    E --&gt; I[直接组合]
    F --&gt; I</code></pre>

<p><strong>详细对比分析</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">高阶组件 (HOC)</th>
<th align="left">Render Props</th>
</tr>
</thead>
<tbody><tr>
<td align="left">复用方式</td>
<td align="left">组件作为参数返回增强组件</td>
<td align="left">函数作为prop渲染内容</td>
</tr>
<tr>
<td align="left">组件关系</td>
<td align="left">包装关系</td>
<td align="left">包含关系</td>
</tr>
<tr>
<td align="left">调试难度</td>
<td align="left">较难（多层包装）</td>
<td align="left">较易（直接显示）</td>
</tr>
<tr>
<td align="left">静态类型</td>
<td align="left">类型推导复杂</td>
<td align="left">类型推导简单</td>
</tr>
<tr>
<td align="left">灵活性</td>
<td align="left">中等</td>
<td align="left">高</td>
</tr>
<tr>
<td align="left">性能影响</td>
<td align="left">可能引起额外渲染</td>
<td align="left">可能引起额外渲染</td>
</tr>
<tr>
<td align="left">学习曲线</td>
<td align="left">较陡峭</td>
<td align="left">较平缓</td>
</tr>
<tr>
<td align="left">适用场景</td>
<td align="left">横切关注点</td>
<td align="left">动态组合</td>
</tr>
</tbody></table>
<h3 id="企业级最佳实践-2"><a href="#企业级最佳实践-2" class="headerlink" title="企业级最佳实践"></a>企业级最佳实践</h3><p><strong>权限控制</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">withAuthorization</span><span class="token punctuation">(</span><span class="token parameter">requiredRoles</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token parameter">WrappedComponent</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">AuthorizedComponent</span> <span class="token operator">=</span> <span class="token parameter">props</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user <span class="token operator">||</span> <span class="token operator">!</span>requiredRoles<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">role</span> <span class="token operator">=></span> user<span class="token punctuation">.</span>roles<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>ForbiddenPage <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">&#123;</span><span class="token operator">...</span>props<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> AuthorizedComponent<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> AdminDashboard <span class="token operator">=</span> <span class="token function">withAuthorization</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'superadmin'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Dashboard<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="现代替代方案：自定义-Hooks"><a href="#现代替代方案：自定义-Hooks" class="headerlink" title="现代替代方案：自定义 Hooks"></a>现代替代方案：自定义 Hooks</h3><p><strong>重构 HOC 为 Hook</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 原 HOC</span>
<span class="token keyword">function</span> <span class="token function">withWindowSize</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> React<span class="token punctuation">.</span>Component <span class="token punctuation">&#123;</span>
    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">width</span><span class="token operator">:</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> window<span class="token punctuation">.</span>innerHeight <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token function-variable function">handleResize</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">width</span><span class="token operator">:</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span>
        <span class="token literal-property property">height</span><span class="token operator">:</span> window<span class="token punctuation">.</span>innerHeight
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">&#125;</span> windowSize<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 自定义 Hook</span>
<span class="token keyword">function</span> <span class="token function">useWindowSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>size<span class="token punctuation">,</span> setSize<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> window<span class="token punctuation">.</span>innerHeight
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleResize</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">setSize</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">width</span><span class="token operator">:</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span>
        <span class="token literal-property property">height</span><span class="token operator">:</span> window<span class="token punctuation">.</span>innerHeight
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> size<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">function</span> <span class="token function">ResponsiveComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> width <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useWindowSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>窗口宽度<span class="token operator">:</span> <span class="token punctuation">&#123;</span>width<span class="token punctuation">&#125;</span>px<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>重构 Render Props 为 Hook</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 原 Render Prop 组件</span>
<span class="token keyword">class</span> <span class="token class-name">DataFetcher</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> error<span class="token punctuation">,</span> <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 自定义 Hook</span>
<span class="token keyword">function</span> <span class="token function">useDataFetcher</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> 
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">null</span> 
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>prev<span class="token punctuation">,</span> <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=></span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> state<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">function</span> <span class="token function">UserProfile</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> userId <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> loading <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useDataFetcher</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>userId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>loading<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>Spinner <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>ProfileCard user<span class="token operator">=</span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="设计模式选择指南"><a href="#设计模式选择指南" class="headerlink" title="设计模式选择指南"></a>设计模式选择指南</h3><p><strong>模式选择决策</strong></p>
<pre><code class="mermaid">graph TD
    A[需要逻辑复用] --&gt; B&#123;需要访问组件内部?&#125;
    B --&gt;|是| C[Render Props]
    B --&gt;|否| D&#123;需要包装组件?&#125;
    D --&gt;|是| E[HOC]
    D --&gt;|否| F[自定义 Hook]
    C --&gt; G&#123;功能简单?&#125;
    G --&gt;|是| H[Render Props]
    G --&gt;|否| I[自定义 Hook]</code></pre>

<p><strong>场景化建议</strong></p>
<ul>
<li>跨组件共享逻辑：HOC（如 Redux connect）</li>
<li>动态组合UI：Render Props（如 Context.Consumer）</li>
<li>功能复用：自定义 Hooks（如 useForm）</li>
<li>类组件扩展：HOC（如 withRouter）</li>
<li>函数组件扩展：自定义 Hooks（如 useEffect）</li>
</ul>
<h3 id="面试高频问题解析-2"><a href="#面试高频问题解析-2" class="headerlink" title="面试高频问题解析"></a>面试高频问题解析</h3><p><strong>Q：HOC 和 Render Props 的主要区别是什么？</strong></p>
<ul>
<li>HOC：组件工厂模式，通过包装组件增强功能，可能引入多层嵌套</li>
<li>Render Props：回调模式，通过函数 prop 共享状态，更直接但可能嵌套回调</li>
<li>关键区别：HOC 创建新组件，Render Props 动态组合组件</li>
</ul>
<p><strong>Q：使用 HOC 时如何避免命名冲突？</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">withEnhancedProps</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> React<span class="token punctuation">.</span>Component <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 使用命名空间避免冲突</span>
      <span class="token keyword">const</span> enhancedProps <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">hoc</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'hoc data'</span><span class="token punctuation">,</span>
          <span class="token function-variable function">method</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'HOC method'</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props
      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">&#123;</span><span class="token operator">...</span>enhancedProps<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Q：Render Props 会导致性能问题吗？如何优化？</strong></p>
<p>优化策略：</p>
<p>(1) 避免内联函数</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 不推荐：每次渲染创建新函数</span>
<span class="token operator">&lt;</span>DataProvider render<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>Child data<span class="token operator">=</span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>

<span class="token comment">// 推荐：使用实例方法</span>
<span class="token function-variable function">renderData</span> <span class="token operator">=</span> <span class="token parameter">data</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>Child data<span class="token operator">=</span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>

<span class="token operator">&lt;</span>DataProvider render<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>renderData<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(2) 使用 PureComponent&#x2F;memo</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">OptimizedProvider</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 仅当 props 变化时重新渲染</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>(3) 分离渲染职责</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">SplitProvider</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">useData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> ui <span class="token operator">=</span> <span class="token function">useUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>DataContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>UIContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span>ui<span class="token punctuation">&#125;</span><span class="token operator">></span>
        <span class="token punctuation">&#123;</span>children<span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>UIContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>DataContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Q：何时应该选择自定义 Hooks 替代 HOC 或 Render Props？</strong></p>
<ul>
<li>选择自定义 Hooks 当：<ul>
<li>复用逻辑不依赖 React 生命周期</li>
<li>需要在多个组件中使用相同逻辑</li>
<li>项目主要使用函数组件</li>
<li>希望减少组件嵌套层级</li>
</ul>
</li>
<li>保留 HOC&#x2F;Render Props 当：<ul>
<li>维护类组件代码库</li>
<li>需要操作组件实例（如 refs）</li>
<li>需要访问组件的生命周期方法</li>
<li>需要包装组件（如添加错误边界）</li>
</ul>
</li>
</ul>
<h3 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h3><ul>
<li>高阶组件 (HOC)：<ul>
<li>本质：组件工厂函数（输入组件 → 输出增强组件）</li>
<li>模式：属性代理、反向继承</li>
<li>适用：横切关注点、类组件扩展</li>
<li>注意：ref 传递、命名冲突、静态方法</li>
</ul>
</li>
<li>Render Props：<ul>
<li>本质：通过函数 prop 共享状态</li>
<li>模式：render prop 或 children as function</li>
<li>适用：动态组合、复杂状态共享</li>
<li>注意：回调嵌套、性能优化</li>
</ul>
</li>
<li>现代演进：<ul>
<li>自定义 Hooks 成为函数组件首选</li>
<li>HOC 和 Render Props 仍适合特定场景</li>
<li>三种模式可混合使用</li>
</ul>
</li>
<li>设计原则：<ul>
<li>单一职责原则</li>
<li>开闭原则（对扩展开放，对修改关闭）</li>
<li>组合优于继承</li>
</ul>
</li>
<li>企业实践：<ul>
<li>复杂状态管理</li>
<li>权限控制</li>
<li>性能优化</li>
<li>类型安全（TypeScript）</li>
</ul>
</li>
<li>面试重点：<ul>
<li>HOC 与 Render Props 区别</li>
<li>命名冲突解决方案</li>
<li>性能优化策略</li>
<li>模式选择决策</li>
</ul>
</li>
</ul>
<h1 id="第五章：React-状态管理"><a href="#第五章：React-状态管理" class="headerlink" title="第五章：React 状态管理"></a>第五章：React 状态管理</h1><h2 id="5-1-状态提升与单向数据流"><a href="#5-1-状态提升与单向数据流" class="headerlink" title="5.1 状态提升与单向数据流"></a>5.1 状态提升与单向数据流</h2><h3 id="核心概念全景图"><a href="#核心概念全景图" class="headerlink" title="核心概念全景图"></a>核心概念全景图</h3><pre><code class="mermaid">graph TD
  A[状态管理方案] --&gt; B[组件内部状态]
  A --&gt; C[状态提升]
  A --&gt; D[全局状态管理]
  C --&gt; E[父子组件通信]
  C --&gt; F[兄弟组件通信]</code></pre>

<h3 id="状态提升（Lifting-State-Up）深度解析"><a href="#状态提升（Lifting-State-Up）深度解析" class="headerlink" title="状态提升（Lifting State Up）深度解析"></a>状态提升（Lifting State Up）深度解析</h3><p><strong>基本定义</strong><br>将多个组件需要共享的状态提升到它们最近的公共父组件中管理，通过 props 向下传递数据，通过回调函数向上传递状态变更</p>
<p><strong>解决什么问题</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 问题场景：两个独立组件需要同步状态</span>
<span class="token keyword">function</span> <span class="token function">TemperatureInputA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>temp<span class="token punctuation">,</span> setTemp<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 独立状态</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">TemperatureInputB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>temp<span class="token punctuation">,</span> setTemp<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 独立状态</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 无法保持两个输入框温度值同步</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>解决方案</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 1. 状态提升到公共父组件</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>temperature<span class="token punctuation">,</span> setTemperature<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 2. 通过props传递状态</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>TemperatureInput 
        value<span class="token operator">=</span><span class="token punctuation">&#123;</span>temperature<span class="token punctuation">&#125;</span> 
        onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span>setTemperature<span class="token punctuation">&#125;</span> <span class="token comment">// 3. 传递回调函数</span>
      <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>TemperatureDisplay 
        value<span class="token operator">=</span><span class="token punctuation">&#123;</span>temperature<span class="token punctuation">&#125;</span> 
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 子组件成为受控组件</span>
<span class="token keyword">function</span> <span class="token function">TemperatureInput</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> value<span class="token punctuation">,</span> onChange <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>input 
      type<span class="token operator">=</span><span class="token string">"number"</span>
      value<span class="token operator">=</span><span class="token punctuation">&#123;</span>value<span class="token punctuation">&#125;</span>
      onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
    <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="单向数据流（Unidirectional-Data-Flow）"><a href="#单向数据流（Unidirectional-Data-Flow）" class="headerlink" title="单向数据流（Unidirectional Data Flow）"></a>单向数据流（Unidirectional Data Flow）</h3><p><strong>核心原则</strong></p>
<pre><code class="mermaid">graph LR
  A[State] --&gt; B[UI]
  B --&gt; C[Actions]
  C --&gt; D[State Changes]
  D --&gt; A</code></pre>

<p><strong>React 中的实现</strong></p>
<pre><code class="mermaid">graph TD
  P[父组件State] --&gt;|Props| C1[子组件A]
  P --&gt;|Props| C2[子组件B]
  C1 --&gt;|回调函数| P
  C2 --&gt;|回调函数| P</code></pre>

<p><strong>与双向绑定的对比</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">单向数据流</th>
<th align="left">双向绑定</th>
</tr>
</thead>
<tbody><tr>
<td align="left">数据方向</td>
<td align="left">父→子</td>
<td align="left">父⇄子</td>
</tr>
<tr>
<td align="left">状态管理</td>
<td align="left">集中管理</td>
<td align="left">分散管理</td>
</tr>
<tr>
<td align="left">数据可预测性</td>
<td align="left">高</td>
<td align="left">低</td>
</tr>
<tr>
<td align="left">调试难度</td>
<td align="left">相对容易</td>
<td align="left">相对复杂</td>
</tr>
<tr>
<td align="left">典型框架</td>
<td align="left">React</td>
<td align="left">Vue&#x2F;Angular</td>
</tr>
</tbody></table>
<h3 id="状态提升的局限性"><a href="#状态提升的局限性" class="headerlink" title="状态提升的局限性"></a>状态提升的局限性</h3><ul>
<li>组件树层级过深时（超过3层）</li>
<li>非直系组件需要通信（如堂兄弟组件）</li>
<li>跨路由组件状态共享</li>
</ul>
<h3 id="现代状态管理方案基础"><a href="#现代状态管理方案基础" class="headerlink" title="现代状态管理方案基础"></a>现代状态管理方案基础</h3><p><strong>Flux 架构思想</strong></p>
<pre><code class="mermaid">graph LR
  A[Action] --&gt; B[Dispatcher]
  B --&gt; C[Store]
  C --&gt; D[View]
  D --&gt; A</code></pre>

<p><strong>状态提升 vs Redux</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">状态提升</th>
<th align="left">Redux</th>
</tr>
</thead>
<tbody><tr>
<td align="left">状态存储</td>
<td align="left">组件 state</td>
<td align="left">独立 store</td>
</tr>
<tr>
<td align="left">状态更新</td>
<td align="left">setState</td>
<td align="left">dispatch(action)</td>
</tr>
<tr>
<td align="left">更新逻辑</td>
<td align="left">在组件内</td>
<td align="left">reducer 纯函数</td>
</tr>
<tr>
<td align="left">状态共享范围</td>
<td align="left">父组件及子组件</td>
<td align="left">全局可访问</td>
</tr>
<tr>
<td align="left">中间件支持</td>
<td align="left">无</td>
<td align="left">支持异步操作</td>
</tr>
</tbody></table>
<h3 id="最佳实践总结-1"><a href="#最佳实践总结-1" class="headerlink" title="最佳实践总结"></a>最佳实践总结</h3><ol>
<li>最小状态原则：只提升必要共享的状态</li>
<li>保持状态局部：非共享状态保持在组件内部</li>
<li>避免过度提升：超过3层传递考虑 Context</li>
<li>数据不可变：状态更新时创建新对象</li>
</ol>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 错误</span>
formData<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setFormData</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ✅ 正确</span>
<span class="token function">setFormData</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token operator">...</span>prev<span class="token punctuation">,</span>
  <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>prev<span class="token punctuation">.</span>items<span class="token punctuation">,</span> newItem<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="5">
<li>回调函数命名：统一使用 on{Event} 格式</li>
</ol>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>Button onSave<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleSave<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="5-2-Redux-核心概念（Store、Action、Reducer）"><a href="#5-2-Redux-核心概念（Store、Action、Reducer）" class="headerlink" title="5.2 Redux 核心概念（Store、Action、Reducer）"></a>5.2 Redux 核心概念（Store、Action、Reducer）</h2><h3 id="Redux-三大核心概念全景图"><a href="#Redux-三大核心概念全景图" class="headerlink" title="Redux 三大核心概念全景图"></a>Redux 三大核心概念全景图</h3><pre><code class="mermaid">graph LR
  A[Action] --&gt;|描述事件| B[Reducer]
  B --&gt;|处理事件| C[Store]
  C --&gt;|提供状态| D[View]
  D --&gt;|触发| A</code></pre>

<h3 id="Action：状态变化的描述"><a href="#Action：状态变化的描述" class="headerlink" title="Action：状态变化的描述"></a>Action：状态变化的描述</h3><p><strong>本质与结构</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 基本结构</span>
<span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'ADD_TODO'</span><span class="token punctuation">,</span>      <span class="token comment">// 必需：动作类型</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">'Learn Redux'</span> <span class="token comment">// 可选：携带数据</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// Flux Standard Action (FSA) 规范</span>
<span class="token punctuation">&#123;</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'FETCH_USER_SUCCESS'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'John'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// 成功数据</span>
  <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>                     <span class="token comment">// 是否错误</span>
  <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">timestamp</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>    <span class="token comment">// 元信息</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Action 创建函数（Action Creators）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 同步 Action</span>
<span class="token keyword">function</span> <span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'ADD_TODO'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">payload</span><span class="token operator">:</span> text
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 异步 Action (需中间件支持)</span>
<span class="token keyword">function</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token parameter">dispatch</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'FETCH_USER_REQUEST'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'FETCH_USER_SUCCESS'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> user <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'FETCH_USER_FAILURE'</span><span class="token punctuation">,</span> error <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Reducer：状态转换的纯函数"><a href="#Reducer：状态转换的纯函数" class="headerlink" title="Reducer：状态转换的纯函数"></a>Reducer：状态转换的纯函数</h3><p><strong>核心特征</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">todosReducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'ADD_TODO'</span><span class="token operator">:</span>
      <span class="token comment">// ✅ 正确：返回新对象</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">text</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">,</span> <span class="token literal-property property">completed</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token keyword">case</span> <span class="token string">'TOGGLE_TODO'</span><span class="token operator">:</span>
      <span class="token comment">// ✅ 正确：使用map创建新数组</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">todo<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> 
        index <span class="token operator">===</span> action<span class="token punctuation">.</span>index 
          <span class="token operator">?</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>todo<span class="token punctuation">,</span> <span class="token literal-property property">completed</span><span class="token operator">:</span> <span class="token operator">!</span>todo<span class="token punctuation">.</span>completed <span class="token punctuation">&#125;</span>
          <span class="token operator">:</span> todo
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token comment">// ⚠️ 必须：返回当前state</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>不可变更新模式</strong></p>
<table>
<thead>
<tr>
<th align="left">操作</th>
<th align="left">错误方式</th>
<th align="left">正确方式</th>
</tr>
</thead>
<tbody><tr>
<td align="left">添加项</td>
<td align="left">state.push(item)</td>
<td align="left">[…state, item]</td>
</tr>
<tr>
<td align="left">删除项</td>
<td align="left">state.splice(index, 1)</td>
<td align="left">state.filter((_, i) &#x3D;&gt; i !&#x3D;&#x3D; index)</td>
</tr>
<tr>
<td align="left">更新对象属性</td>
<td align="left">state[prop] &#x3D; value</td>
<td align="left">{ …state, [prop]: value }</td>
</tr>
<tr>
<td align="left">嵌套对象更新</td>
<td align="left">state.a.b &#x3D; value</td>
<td align="left">{ …state, a: { …state.a, b: value } }</td>
</tr>
</tbody></table>
<p><strong>Reducer 拆分与组合</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 根Reducer</span>
<span class="token keyword">function</span> <span class="token function">rootReducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">todos</span><span class="token operator">:</span> <span class="token function">todosReducer</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>todos<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">visibilityFilter</span><span class="token operator">:</span> <span class="token function">filterReducer</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>visibilityFilter<span class="token punctuation">,</span> action<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用 combineReducers 简化</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> combineReducers <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">todos</span><span class="token operator">:</span> todosReducer<span class="token punctuation">,</span>
  <span class="token literal-property property">visibilityFilter</span><span class="token operator">:</span> filterReducer
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Store：应用状态的容器"><a href="#Store：应用状态的容器" class="headerlink" title="Store：应用状态的容器"></a>Store：应用状态的容器</h3><p><strong>核心职责</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createStore <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>

<span class="token comment">// 创建Store</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 主要API</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 触发状态更新</span>
store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 获取当前状态</span>
store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 监听状态变化</span>

<span class="token comment">// 使用示例</span>
store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'新状态:'</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token string">'Learn Redux'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Store 工作流程</strong></p>
<pre><code class="mermaid">sequenceDiagram
  participant View as 视图
  participant Store as Store
  participant Reducer as Reducer
  
  View-&gt;&gt;Store: dispatch(action)
  Store-&gt;&gt;Reducer: 当前state + action
  Reducer-&gt;&gt;Reducer: 计算新state
  Reducer-&gt;&gt;Store: 返回新state
  Store-&gt;&gt;View: 通知订阅者更新</code></pre>

<h3 id="Redux-三大原则"><a href="#Redux-三大原则" class="headerlink" title="Redux 三大原则"></a>Redux 三大原则</h3><p>(1) 单一数据源 (Single Source of Truth)</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 整个应用只有一个Store</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 输出：
&#123;
  todos: [],
  visibilityFilter: 'SHOW_ALL'
&#125;
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(2) 状态只读 (State is Read-Only)</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 禁止直接修改</span>
store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'Illegal mutation!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ✅ 唯一修改方式：dispatch(action)</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'ADD_TODO'</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'Legal update'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(3) 纯函数修改 (Changes with Pure Functions)</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// Reducer必须是纯函数</span>
<span class="token keyword">function</span> <span class="token function">impureReducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ❌ 错误：包含副作用</span>
  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'state'</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
  <span class="token comment">// ❌ 错误：不纯（依赖外部变量）</span>
  <span class="token keyword">return</span> state <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Redux-数据流完整周期"><a href="#Redux-数据流完整周期" class="headerlink" title="Redux 数据流完整周期"></a>Redux 数据流完整周期</h3><pre><code class="mermaid">sequenceDiagram
  participant View as 视图
  participant Action as Action
  participant Middleware as 中间件
  participant Store as Store
  participant Reducer as Reducer
  
  View-&gt;&gt;Action: 用户交互触发
  Action-&gt;&gt;Middleware: 处理异步&#x2F;副作用
  Middleware-&gt;&gt;Store: dispatch(action)
  Store-&gt;&gt;Reducer: (currentState, action)
  Reducer-&gt;&gt;Store: 返回newState
  Store-&gt;&gt;View: 通知订阅者
  View-&gt;&gt;View: 使用新状态重渲染</code></pre>

<h3 id="高频面试题与破解方案-12"><a href="#高频面试题与破解方案-12" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么Redux要求Reducer是纯函数？</strong></p>
<ol>
<li>可预测性：相同输入必定得到相同输出</li>
<li>时间旅行：支持状态快照和回滚</li>
<li>易于测试：无需模拟环境，直接测试输入输出</li>
<li>性能优化：可安全进行浅比较</li>
</ol>
<p><strong>Q：Redux如何实现时间旅行调试？</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 核心原理</span>
<span class="token keyword">function</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token parameter">reducer</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> state <span class="token operator">=</span> initialState<span class="token punctuation">;</span>
  <span class="token keyword">const</span> listeners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// ⭐ 历史状态记录</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">dispatch</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 保存当前状态</span>
      state <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 计算新状态</span>
      listeners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">listener</span> <span class="token operator">=></span> <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">getState</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">,</span>
    <span class="token function-variable function">undo</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>history<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        state <span class="token operator">=</span> history<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 恢复历史状态</span>
        listeners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">listener</span> <span class="token operator">=></span> <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 实际使用redux-undo库</span>
<span class="token keyword">import</span> undoable <span class="token keyword">from</span> <span class="token string">'redux-undo'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token function">undoable</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Q：Redux与Flux架构有何区别？</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">Redux</th>
<th align="left">Flux</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Store数量</td>
<td align="left">单一Store</td>
<td align="left">多个Store</td>
</tr>
<tr>
<td align="left">Dispatcher</td>
<td align="left">无独立Dispatcher</td>
<td align="left">有中央Dispatcher</td>
</tr>
<tr>
<td align="left">状态更新</td>
<td align="left">纯函数Reducer</td>
<td align="left">Store内方法更新</td>
</tr>
<tr>
<td align="left">样板代码</td>
<td align="left">相对较少</td>
<td align="left">相对较多</td>
</tr>
<tr>
<td align="left">时间旅行</td>
<td align="left">原生支持</td>
<td align="left">需要额外实现</td>
</tr>
</tbody></table>
<h3 id="Redux-在函数组件中的使用"><a href="#Redux-在函数组件中的使用" class="headerlink" title="Redux 在函数组件中的使用"></a>Redux 在函数组件中的使用</h3><p><strong>基础连接方式</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Provider <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>

<span class="token comment">// 根组件包裹Provider</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">&#123;</span>store<span class="token punctuation">&#125;</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 子组件连接</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> connect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">TodoList</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> todos<span class="token punctuation">,</span> dispatch <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>
  <span class="token parameter">state</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">todos</span><span class="token operator">:</span> state<span class="token punctuation">.</span>todos <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// mapStateToProps</span>
  <span class="token parameter">dispatch</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> dispatch <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>         <span class="token comment">// mapDispatchToProps</span>
<span class="token punctuation">)</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Hooks API（推荐）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useSelector<span class="token punctuation">,</span> useDispatch <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">TodoList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 获取状态</span>
  <span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>todos<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 获取dispatch函数</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">addTodo</span> <span class="token operator">=</span> <span class="token parameter">text</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'ADD_TODO'</span><span class="token punctuation">,</span> text <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ul<span class="token operator">></span>
      <span class="token punctuation">&#123;</span>todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">&#123;</span>todo<span class="token punctuation">.</span>id<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">&#123;</span>todo<span class="token punctuation">.</span>text<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Redux-中间件机制"><a href="#Redux-中间件机制" class="headerlink" title="Redux 中间件机制"></a>Redux 中间件机制</h3><p><strong>中间件原理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 中间件签名</span>
<span class="token keyword">const</span> <span class="token function-variable function">middleware</span> <span class="token operator">=</span> <span class="token parameter">store</span> <span class="token operator">=></span> <span class="token parameter">next</span> <span class="token operator">=></span> <span class="token parameter">action</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 处理前逻辑</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dispatching'</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 调用下一个中间件</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 处理后逻辑</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'next state'</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建支持中间件的store</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> applyMiddleware<span class="token punctuation">,</span> createStore <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  rootReducer<span class="token punctuation">,</span>
  <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>middleware1<span class="token punctuation">,</span> middleware2<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>常用中间件</strong></p>
<table>
<thead>
<tr>
<th align="left">中间件</th>
<th align="left">解决的核心问题</th>
<th align="left">典型使用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">redux-thunk</td>
<td align="left">异步Action处理</td>
<td align="left">简单API请求</td>
</tr>
<tr>
<td align="left">redux-saga</td>
<td align="left">复杂异步流程管理</td>
<td align="left">多步骤异步、竞态处理</td>
</tr>
<tr>
<td align="left">redux-observable</td>
<td align="left">响应式编程</td>
<td align="left">复杂事件流处理</td>
</tr>
<tr>
<td align="left">redux-logger</td>
<td align="left">状态变更日志</td>
<td align="left">开发环境调试</td>
</tr>
</tbody></table>
<h3 id="Redux-最佳实践"><a href="#Redux-最佳实践" class="headerlink" title="Redux 最佳实践"></a>Redux 最佳实践</h3><p><strong>项目结构组织</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">src/
  ├── store/           <span class="token comment"># Redux相关</span>
  │   ├── actions/     <span class="token comment"># Action创建函数</span>
  │   ├── reducers/    <span class="token comment"># Reducer函数</span>
  │   ├── sagas/       <span class="token comment"># Saga中间件</span>
  │   └── store.js     <span class="token comment"># Store配置</span>
  │
  ├── components/      <span class="token comment"># 展示组件</span>
  └── containers/      <span class="token comment"># 容器组件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>命名规范</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// Action类型：&lt;名词>_&lt;动词></span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">USER_FETCH_REQUESTED</span> <span class="token operator">=</span> <span class="token string">'USER_FETCH_REQUESTED'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">TODOS_ADD</span> <span class="token operator">=</span> <span class="token string">'TODOS_ADD'</span><span class="token punctuation">;</span>

<span class="token comment">// Action创建函数：动词+名词</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>状态设计原则</strong></p>
<ol>
<li>扁平化结构：避免嵌套过深</li>
<li>按业务域拆分：不同功能独立状态分支</li>
<li>ID驱动：通过ID关联数据</li>
</ol>
<h3 id="总结：Redux-核心概念关系图"><a href="#总结：Redux-核心概念关系图" class="headerlink" title="总结：Redux 核心概念关系图"></a>总结：Redux 核心概念关系图</h3><pre><code class="mermaid">graph TD
  A[Action] --&gt;|描述| B[Reducer]
  B --&gt;|生成| C[Store]
  C --&gt;|提供| D[View]
  D --&gt;|触发| A
  E[Middleware] --&gt;|拦截| A
  F[Selector] --&gt;|获取| C
  G[React-Redux] --&gt;|连接| D</code></pre>

<h2 id="5-3-Redux-中间件（redux-thunk、redux-saga）"><a href="#5-3-Redux-中间件（redux-thunk、redux-saga）" class="headerlink" title="5.3 Redux 中间件（redux-thunk、redux-saga）"></a>5.3 Redux 中间件（redux-thunk、redux-saga）</h2><h3 id="Redux-中间件核心原理"><a href="#Redux-中间件核心原理" class="headerlink" title="Redux 中间件核心原理"></a>Redux 中间件核心原理</h3><p><strong>中间件在数据流中的位置</strong></p>
<pre><code class="mermaid">graph LR
  A[View] --&gt;|dispatch| B[Middleware]
  B --&gt;|&quot;next(action)&quot;| C[Reducer]
  C --&gt; D[Store]
  D --&gt;|newState| A</code></pre>

<p><strong>中间件签名与执行链</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 中间件结构（柯里化函数）</span>
<span class="token keyword">const</span> <span class="token function-variable function">middleware</span> <span class="token operator">=</span> <span class="token parameter">store</span> <span class="token operator">=></span> <span class="token parameter">next</span> <span class="token operator">=></span> <span class="token parameter">action</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 前置处理</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dispatching:'</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 传递 action 给下一个中间件或 reducer</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 后置处理</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'next state:'</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 中间件执行顺序</span>
<span class="token function">applyMiddleware</span><span class="token punctuation">(</span>mid1<span class="token punctuation">,</span> mid2<span class="token punctuation">,</span> mid3<span class="token punctuation">)</span>
<span class="token comment">// 实际调用顺序：</span>
<span class="token comment">// mid1(store) -> mid2(store) -> mid3(store) -> reducer</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="redux-thunk：处理简单异步"><a href="#redux-thunk：处理简单异步" class="headerlink" title="redux-thunk：处理简单异步"></a>redux-thunk：处理简单异步</h3><p><strong>核心概念</strong></p>
<p>允许 action 创建函数返回函数（而不仅是对象），该函数接收 dispatch 和 getState 作为参数</p>
<p><strong>使用示例</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 同步 action</span>
<span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'INCREMENT'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 异步 action (thunk)</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetchUser</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">userId</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> getState</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'USER_REQUEST'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'USER_SUCCESS'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> user <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 可访问当前状态</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> settings <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>settings<span class="token punctuation">.</span>notify<span class="token punctuation">)</span> <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token string">'用户加载成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'USER_FAILURE'</span><span class="token punctuation">,</span> error <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 组件中触发</span>
<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>适用场景</strong></p>
<ul>
<li>API 请求</li>
<li>简单异步操作</li>
<li>需要访问当前状态的异步逻辑</li>
</ul>
<p><strong>优点与局限</strong></p>
<table>
<thead>
<tr>
<th align="left">优点</th>
<th align="left">局限</th>
</tr>
</thead>
<tbody><tr>
<td align="left">学习成本低</td>
<td align="left">复杂异步流程难管理</td>
</tr>
<tr>
<td align="left">代码简洁</td>
<td align="left">测试相对复杂</td>
</tr>
<tr>
<td align="left">无需额外库</td>
<td align="left">不支持高级异步模式</td>
</tr>
</tbody></table>
<h3 id="redux-saga：处理复杂异步"><a href="#redux-saga：处理复杂异步" class="headerlink" title="redux-saga：处理复杂异步"></a>redux-saga：处理复杂异步</h3><p><strong>核心概念</strong></p>
<pre><code class="mermaid">graph TD
  A[View] --&gt;|dispatch| B[Action]
  B --&gt; C[Watcher Saga]
  C --&gt; D[Worker Saga]
  D --&gt; E[API Call]
  E --&gt; F[Action to Store]</code></pre>

<p><strong>关键特性</strong></p>
<ul>
<li>基于 ES6 Generator 函数</li>
<li>集中管理副作用（side effects）</li>
<li>提供丰富异步控制原语（takeEvery, takeLatest 等）</li>
<li>支持竞态条件处理、并行任务等复杂场景</li>
</ul>
<p><strong>使用示例</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> call<span class="token punctuation">,</span> put<span class="token punctuation">,</span> takeEvery <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'redux-saga/effects'</span><span class="token punctuation">;</span>

<span class="token comment">// Worker Saga</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span>getUser<span class="token punctuation">,</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'USER_SUCCESS'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> user <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'USER_FAILURE'</span><span class="token punctuation">,</span> error <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// Watcher Saga</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">watchUserRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">yield</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span><span class="token string">'USER_REQUEST'</span><span class="token punctuation">,</span> fetchUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 根Saga</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">yield</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">watchUserRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 其他 watcher</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>常用 Effect 原语</strong></p>
<table>
<thead>
<tr>
<th align="left">Effect</th>
<th align="left">作用</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">call</td>
<td align="left">调用异步函数</td>
<td align="left">yield call(api.fetch, url)</td>
</tr>
<tr>
<td align="left">put</td>
<td align="left">发起 action</td>
<td align="left">yield put({ type: ‘SUCCESS’ })</td>
</tr>
<tr>
<td align="left">take</td>
<td align="left">等待指定 action</td>
<td align="left">yield take(‘ACTION’)</td>
</tr>
<tr>
<td align="left">takeEvery</td>
<td align="left">监听每个 action</td>
<td align="left">yield takeEvery(‘ACTION’, saga)</td>
</tr>
<tr>
<td align="left">takeLatest</td>
<td align="left">只响应最新的 action</td>
<td align="left">yield takeLatest(‘ACTION’, saga)</td>
</tr>
<tr>
<td align="left">fork</td>
<td align="left">非阻塞调用 saga</td>
<td align="left">yield fork(otherSaga)</td>
</tr>
<tr>
<td align="left">all</td>
<td align="left">并行运行多个 Effect</td>
<td align="left">yield all([call(a), call(b)])</td>
</tr>
<tr>
<td align="left">race</td>
<td align="left">竞态执行</td>
<td align="left">yield race({ task: call(fn), cancel: take(‘CANCEL’) })</td>
</tr>
</tbody></table>
<h3 id="高频面试题与破解方案-13"><a href="#高频面试题与破解方案-13" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么需要中间件处理异步？</strong></p>
<ol>
<li>Redux 自身限制：reducer 必须是纯函数，不能包含副作用</li>
<li>可预测性：集中管理副作用，避免分散在组件中</li>
<li>可维护性：统一处理错误、日志、重试等通用逻辑</li>
<li>高级功能：实现请求取消、竞态处理等复杂场景</li>
</ol>
<p><strong>Q：如何选择 thunk 还是 saga？</strong></p>
<pre><code class="mermaid">graph TD
  A[项目需求] --&gt; B&#123;异步复杂度&#125;
  B --&gt;|简单API请求| C[redux-thunk]
  B --&gt;|复杂流程&#x2F;竞态| D[redux-saga]
  A --&gt; E&#123;团队熟悉度&#125;
  E --&gt;|熟悉Generator| D
  E --&gt;|新手团队| C
  A --&gt; F&#123;包大小敏感&#125;
  F --&gt;|是| C
  F --&gt;|否| D</code></pre>

<h2 id="5-4-React-Redux（Provider、useSelector、useDispatch）"><a href="#5-4-React-Redux（Provider、useSelector、useDispatch）" class="headerlink" title="5.4 React-Redux（Provider、useSelector、useDispatch）"></a>5.4 React-Redux（Provider、useSelector、useDispatch）</h2><h3 id="React-Redux-核心架构图"><a href="#React-Redux-核心架构图" class="headerlink" title="React-Redux 核心架构图"></a>React-Redux 核心架构图</h3><pre><code class="mermaid">graph TD
  A[Redux Store] --&gt; B[Provider]
  B --&gt;|Context| C[React Components]
  C --&gt;|useSelector| A
  C --&gt;|useDispatch| A</code></pre>

<h3 id="Provider：状态注入的基石"><a href="#Provider：状态注入的基石" class="headerlink" title="Provider：状态注入的基石"></a>Provider：状态注入的基石</h3><p><strong>核心作用与原理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Provider <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">&#123;</span>store<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>MainApp <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>作用：通过 React Context 将 Redux store 注入整个组件树</li>
<li>原理：使用 React.createContext() 创建 Store 上下文</li>
<li>位置：必须在组件树最顶层</li>
</ul>
<p><strong>实现原理揭秘</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 简化版 Provider 实现</span>
<span class="token keyword">const</span> StoreContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Provider</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> store<span class="token punctuation">,</span> children <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 使用 useMemo 避免重复渲染</span>
  <span class="token keyword">const</span> contextValue <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> store <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>store<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>StoreContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span>contextValue<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token punctuation">&#123;</span>children<span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>StoreContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="useSelector：精准状态选择"><a href="#useSelector：精准状态选择" class="headerlink" title="useSelector：精准状态选择"></a>useSelector：精准状态选择</h3><p><strong>基础用法</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useSelector <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">UserProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 从 Redux store 选择所需状态</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">&#123;</span>user<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>性能优化机制</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 默认使用 === 严格相等比较</span>
<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 自定义比较函数</span>
<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span>
  <span class="token parameter">state</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>user<span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">prevUser<span class="token punctuation">,</span> nextUser</span><span class="token punctuation">)</span> <span class="token operator">=></span> prevUser<span class="token punctuation">.</span>id <span class="token operator">===</span> nextUser<span class="token punctuation">.</span>id
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>高级选择器模式</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用 reselect 库创建记忆化选择器</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createSelector <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'reselect'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> selectActiveUsers <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span><span class="token parameter">state</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>users<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token parameter">users</span> <span class="token operator">=></span> users<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=></span> user<span class="token punctuation">.</span>isActive<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">ActiveUsersList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> activeUsers <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span>selectActiveUsers<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="useDispatch：触发状态更新"><a href="#useDispatch：触发状态更新" class="headerlink" title="useDispatch：触发状态更新"></a>useDispatch：触发状态更新</h3><p><strong>基础用法</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useDispatch <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">AddTodoButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'ADD_TODO'</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'New todo'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleClick<span class="token punctuation">&#125;</span><span class="token operator">></span>添加<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>封装动作创建函数</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 动作创建函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">addTodo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'ADD_TODO'</span><span class="token punctuation">,</span> text <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 组件中使用</span>
<span class="token keyword">function</span> <span class="token function">AddTodoButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token string">'New todo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 直接 dispatch action</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleClick<span class="token punctuation">&#125;</span><span class="token operator">></span>添加<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>异步操作集成</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用 redux-thunk</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetchUser</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">async</span> <span class="token parameter">dispatch</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'USER_REQUEST'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'USER_SUCCESS'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> user <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">UserLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="三大-Hook-协作模式"><a href="#三大-Hook-协作模式" class="headerlink" title="三大 Hook 协作模式"></a>三大 Hook 协作模式</h3><p>完整数据流示例</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">TodoList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 1. 获取状态</span>
  <span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>todos<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 2. 获取 dispatch 函数</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 3. 事件处理</span>
  <span class="token keyword">const</span> handleAdd <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token string">'新任务'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> handleToggle <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">toggleTodo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleAdd<span class="token punctuation">&#125;</span><span class="token operator">></span>添加任务<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span>ul<span class="token operator">></span>
        <span class="token punctuation">&#123;</span>todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>TodoItem 
            key<span class="token operator">=</span><span class="token punctuation">&#123;</span>todo<span class="token punctuation">.</span>id<span class="token punctuation">&#125;</span> 
            todo<span class="token operator">=</span><span class="token punctuation">&#123;</span>todo<span class="token punctuation">&#125;</span> 
            onToggle<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleToggle<span class="token punctuation">&#125;</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="connect-高阶组件（传统写法）"><a href="#connect-高阶组件（传统写法）" class="headerlink" title="connect 高阶组件（传统写法）"></a>connect 高阶组件（传统写法）</h3><p><strong>mapStateToProps</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> ownProps</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">todos</span><span class="token operator">:</span> state<span class="token punctuation">.</span>todos<span class="token punctuation">,</span>
  <span class="token literal-property property">currentUser</span><span class="token operator">:</span> state<span class="token punctuation">.</span>users<span class="token punctuation">[</span>ownProps<span class="token punctuation">.</span>userId<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 组件中通过 props 访问</span>
<span class="token keyword">function</span> <span class="token function">TodoList</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> todos<span class="token punctuation">,</span> currentUser <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>mapDispatchToProps</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 对象简写（自动绑定 dispatch）</span>
<span class="token keyword">const</span> mapDispatchToProps <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  addTodo<span class="token punctuation">,</span>
  deleteTodo
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 函数形式</span>
<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token function-variable function">addTodo</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addTodo</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">deleteTodo</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">deleteTodo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>connect 使用</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> connect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ConnectedTodoList <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>
  mapStateToProps<span class="token punctuation">,</span>
  mapDispatchToProps
<span class="token punctuation">)</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高频面试题与破解方案-14"><a href="#高频面试题与破解方案-14" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么需要 React-Redux？</strong></p>
<ol>
<li>解耦组件：避免组件直接依赖 Redux store</li>
<li>性能优化：自动实现 shouldComponentUpdate 优化</li>
<li>上下文管理：通过 Provider 优雅注入 store</li>
<li>简化开发：提供 useSelector&#x2F;useDispatch 便捷 API</li>
<li>未来兼容：官方维护，保证与 React 新特性兼容</li>
</ol>
<p><strong>Q：useSelector 如何避免不必要重渲染？</strong></p>
<p>优化策略：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 策略1：返回原始值（非引用类型）</span>
<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// number</span>

<span class="token comment">// 策略2：使用浅比较</span>
<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>user<span class="token punctuation">,</span> shallowEqual<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 策略3：记忆化选择器</span>
<span class="token keyword">const</span> selectUser <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
  <span class="token parameter">state</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
  <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span>selectUser<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Q：如何在类组件中使用 Hooks？</strong></p>
<p>解决方案：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 创建连接组件</span>
<span class="token keyword">function</span> <span class="token function">withReduxHooks</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">&#123;</span><span class="token operator">...</span>props<span class="token punctuation">&#125;</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span> dispatch<span class="token operator">=</span><span class="token punctuation">&#123;</span>dispatch<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">class</span> <span class="token class-name">LegacyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 通过 props 访问 data 和 dispatch</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">withReduxHooks</span><span class="token punctuation">(</span>LegacyComponent<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="总结：React-Redux-核心知识点"><a href="#总结：React-Redux-核心知识点" class="headerlink" title="总结：React-Redux 核心知识点"></a>总结：React-Redux 核心知识点</h3><table>
<thead>
<tr>
<th align="left">概念</th>
<th align="left">作用</th>
<th align="left">最佳实践</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Provider</td>
<td align="left">注入 Redux store 到组件树</td>
<td align="left">包裹整个应用根组件</td>
</tr>
<tr>
<td align="left">useSelector</td>
<td align="left">从 store 选择状态</td>
<td align="left">返回原始值 + 精细选择</td>
</tr>
<tr>
<td align="left">useDispatch</td>
<td align="left">获取 dispatch 方法</td>
<td align="left">封装动作创建函数</td>
</tr>
<tr>
<td align="left">connect</td>
<td align="left">类组件连接方案（传统）</td>
<td align="left">使用 mapState&#x2F;mapDispatch</td>
</tr>
<tr>
<td align="left">记忆化选择器</td>
<td align="left">优化性能</td>
<td align="left">使用 reselect 或 useMemo</td>
</tr>
<tr>
<td align="left">Redux Toolkit</td>
<td align="left">现代 Redux 开发标准</td>
<td align="left">使用 createSlice + configureStore</td>
</tr>
</tbody></table>
<h2 id="5-5-现代状态管理方案（Recoil、Zustand、Jotai）"><a href="#5-5-现代状态管理方案（Recoil、Zustand、Jotai）" class="headerlink" title="5.5 现代状态管理方案（Recoil、Zustand、Jotai）"></a>5.5 现代状态管理方案（Recoil、Zustand、Jotai）</h2><h3 id="基础知识概述-简要"><a href="#基础知识概述-简要" class="headerlink" title="基础知识概述 (简要)"></a>基础知识概述 (简要)</h3><p>目标： 解决 React 应用中跨组件状态共享和复杂状态逻辑的管理问题，特别是当 Context + useState&#x2F;useReducer 在性能或开发体验上显得不足时。</p>
<p>核心诉求：</p>
<ul>
<li>简化 API： 减少模板代码（boilerplate），提升开发效率。</li>
<li>高性能更新： 精确控制组件更新范围，避免不必要的渲染。</li>
<li>更好的 TypeScript 支持： 提供出色的类型推断。</li>
<li>更自然的 React 集成： 拥抱 Hooks 和 React 的并发特性。</li>
<li>更小的包体积： 减小应用体积。</li>
</ul>
<p>与 Redux 的主要区别：</p>
<ul>
<li>通常不需要显式定义 action types, action creators, reducers。</li>
<li>状态存储和更新逻辑更分散或原子化。</li>
<li>API 设计更贴近 React Hooks，学习曲线相对平缓。</li>
</ul>
<h3 id="Recoil-Meta-官方出品"><a href="#Recoil-Meta-官方出品" class="headerlink" title="Recoil (Meta 官方出品)"></a>Recoil (Meta 官方出品)</h3><p><strong>核心概念： 原子 (Atoms) 和 选择器 (Selectors)</strong></p>
<ul>
<li>Atom: 状态的最小单位。一个原子代表一份独立的状态（可以是任何类型）。组件通过 useRecoilState, useRecoilValue, useSetRecoilState 订阅或更新它。原子变化只触发订阅它的组件重渲染。</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> atom <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'recoil'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> countState <span class="token operator">=</span> <span class="token function">atom</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'countState'</span><span class="token punctuation">,</span> <span class="token comment">// 必须全局唯一</span>
  <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 初始值</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>Selector: 派生状态。基于一个或多个 Atom 或其他 Selector 的值通过纯函数计算得出。组件同样使用 Hook 订阅。依赖的 Atom&#x2F;Selector 变化时自动重新计算，并触发订阅组件更新。</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> selector <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'recoil'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> doubledCountState <span class="token operator">=</span> <span class="token function">selector</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'doubledCountState'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> get <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>countState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> count <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token comment">// 可选：定义如何设置（会反向更新依赖的 Atom）</span>
  <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> set <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> newValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">set</span><span class="token punctuation">(</span>countState<span class="token punctuation">,</span> newValue <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Hooks API:</strong></p>
<ul>
<li>useRecoilState(atom&#x2F;selector)： 类似于 useState，返回 [state, setter]。</li>
<li>useRecoilValue(atom&#x2F;selector)： 只读取状态值。</li>
<li>useSetRecoilState(atom&#x2F;selector)： 只获取设置状态的函数。</li>
<li>useRecoilCallback()： 用于在回调中异步读取&#x2F;更新状态，避免闭包问题。</li>
</ul>
<p><strong>关键特性</strong></p>
<ul>
<li>细粒度响应： 组件只订阅它真正需要的具体 Atom&#x2F;Selector，状态变化时只有依赖这些状态的组件才会更新。这是解决 Redux 中 connect 或 useSelector 可能导致的“大范围更新”问题的关键。</li>
<li>Hooks-First API： 完全使用 React Hooks 的方式读取和修改状态，与函数组件无缝集成。</li>
<li>异步支持： Selector 可以方便地处理异步数据获取和派生状态（如 useRecoilValueLoadable）。</li>
<li>状态快照与时间旅行： 内置支持状态快照，便于调试（如 <RecoilRoot> 的 initializeState 和快照 API）。</li>
</ul>
<p><strong>优点</strong></p>
<ul>
<li>概念相对清晰（Atom&#x2F;Selector）。</li>
<li>细粒度更新性能优秀。</li>
<li>官方背景，社区和文档较好。</li>
<li>内置异步支持良好。</li>
</ul>
<p><strong>缺点&#x2F;考量</strong></p>
<ul>
<li>API 相对复杂： 理解 Atom、Selector 及其各种 Hook（useRecoilCallback, useRecoilValueLoadable, useRecoilTransaction_UNSTABLE 等）需要一定学习成本。</li>
<li>仍在实验阶段 (Experimental)： 虽然 Meta 内部广泛使用，但官方文档仍标记为 Experimental，API 稳定性有一定风险（尽管重大变更已较少）。</li>
<li>Bundle Size： 相对其他轻量方案稍大。</li>
</ul>
<p><strong>面试要点</strong></p>
<ul>
<li>解释 Atom 和 Selector 的区别和联系。</li>
<li>如何用 Selector 处理异步数据？</li>
<li>Recoil 如何实现细粒度更新？（依赖图追踪）</li>
<li>对比 Recoil 与 Context + useState&#x2F;useReducer 在性能上的差异（Context 更新会触发所有消费组件更新，Recoil 只更新依赖特定 Atom&#x2F;Selector 的组件）。</li>
<li>了解 atomFamily &#x2F; selectorFamily 的作用（参数化状态）。</li>
</ul>
<h3 id="Zustand"><a href="#Zustand" class="headerlink" title="Zustand"></a>Zustand</h3><p><strong>核心思想</strong>：创建一个单一的、不可变的 Store。Store 包含状态和修改状态的方法（Action）。API 极其简洁。</p>
<p><strong>核心 API（create）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> create <span class="token keyword">from</span> <span class="token string">'zustand'</span><span class="token punctuation">;</span>
<span class="token comment">// 类型提示 (TypeScript): import &#123; create &#125; from 'zustand'</span>
<span class="token keyword">const</span> useStore <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">set<span class="token punctuation">,</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token function-variable function">increment</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">decrement</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">reset</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 访问当前状态 (非更新时): get().count</span>
  <span class="token comment">// 异步 Action 示例</span>
  <span class="token keyword">async</span> <span class="token function-variable function">fetchData</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/data'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 更新状态</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Hooks API</strong></p>
<ul>
<li>useStore()： 默认会订阅整个 Store 的变化（不推荐，可能导致过多渲染）。</li>
<li>useStore(selector)： 推荐用法。通过一个选择器函数从 Store 中选取需要的部分状态或 Action。组件只在选择器返回的部分发生变化时才会重新渲染。Zustand 会对选择器结果进行严格的浅比较 (Object.is)。使用选择器函数是性能优化的关键。</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 组件A: 只需要 count 和 increment</span>
<span class="token keyword">function</span> <span class="token function">CounterA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> count<span class="token punctuation">,</span> increment <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">count</span><span class="token operator">:</span> state<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
    <span class="token literal-property property">increment</span><span class="token operator">:</span> state<span class="token punctuation">.</span>increment
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ... render</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 组件B: 只需要 decrement</span>
<span class="token keyword">function</span> <span class="token function">CounterB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> decrement <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>decrement<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ... render</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>关键特性&#x2F;优势</strong></p>
<ul>
<li>极致简洁： API 极其精简，学习成本低，样板代码极少。</li>
<li>高性能： 精确的订阅机制（通过选择器）确保组件只在相关状态变化时更新。</li>
<li>无 Provider 地狱： Store 是全局单例（虽然可以创建多个 Store），不需要用 Context Provider 包裹应用根节点。组件可以直接在任何地方使用 useStore。</li>
<li>Middleware 支持： 内置支持中间件（如 persist 持久化、immer 简化不可变更新、devtools 连接 Redux DevTools）。</li>
<li>出色的 TS 支持： 类型推断非常友好。</li>
</ul>
<p><strong>适用场景</strong></p>
<ul>
<li>绝大多数应用场景，特别是追求简洁、高效、易用的项目。从中小型到大型项目都适用。是目前非常流行的 Redux 替代品。</li>
</ul>
<h3 id="Jotai"><a href="#Jotai" class="headerlink" title="Jotai"></a>Jotai</h3><p><strong>核心思想</strong>： 受 Recoil 的 Atom 概念启发，但 API 设计更精简和原始（Primitive）。完全拥抱 React 的 Context 和 Hooks 思想。</p>
<p><strong>核心概念</strong></p>
<ul>
<li>Atom: 状态的基本单位。定义一个包含初始值的 Atom（不需要唯一的全局 key！）。</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> atom <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'jotai'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> countAtom <span class="token operator">=</span> <span class="token function">atom</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始值</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>Derived Atom: 通过读取其他 Atom 的值计算而来。可以是只读的或可写的（通过定义一个 get 函数和一个可选的 set 函数）。</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> doubledCountAtom <span class="token operator">=</span> <span class="token function">atom</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">get</span><span class="token punctuation">(</span>countAtom<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 只读派生</span>
<span class="token comment">// 可写派生 (set 会更新依赖的原始 atom)</span>
<span class="token keyword">const</span> countPlusOneAtom <span class="token operator">=</span> <span class="token function">atom</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">get</span><span class="token punctuation">(</span>countAtom<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// getter</span>
  <span class="token punctuation">(</span><span class="token parameter">get<span class="token punctuation">,</span> set<span class="token punctuation">,</span> newValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token function">set</span><span class="token punctuation">(</span>countAtom<span class="token punctuation">,</span> newValue <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span> <span class="token comment">// setter</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Hooks API</strong></p>
<ul>
<li>useAtom(atom)： 核心 Hook。返回 [value, setter]。组件会订阅传递给 useAtom 的这个特定 Atom 的变化。</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useAtom</span><span class="token punctuation">(</span>countAtom<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ... render</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Provider 与 Context</strong></p>
<ul>
<li>默认情况下，Atom 状态是全局共享的（通过 Jotai 内部的默认 Context）。</li>
<li>Provider： 如果需要创建隔离的状态作用域（例如在微前端、测试或需要多个独立实例的场景），可以使用 <code>&lt;Provider&gt;</code> 包裹组件树。Provider 内的组件访问的是该 Provider 作用域内的 Atom 状态。</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Provider <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'jotai'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Provider<span class="token operator">></span>
      <span class="token operator">&lt;</span>ComponentThatUsesAtoms <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>关键特性&#x2F;优势</strong></p>
<ul>
<li>极简 API： 核心 API 只有 atom 和 useAtom。概念极其精简。</li>
<li>灵活的组合性： Atom 可以自由组合，构建复杂状态逻辑。</li>
<li>无 Key 设计： 不需要为 Atom 定义全局唯一的 key，简化了定义和使用。</li>
<li>基于 Context： 底层利用 React Context 实现，但通过优化避免了 Context 的渲染爆炸问题。Provider 提供了状态隔离能力。</li>
<li>轻量级： 包体积非常小。</li>
<li>优秀的并发模式兼容性。</li>
</ul>
<p><strong>适用场景</strong></p>
<ul>
<li>喜欢极简 API、原子化思想，且可能需要状态隔离（Provider）的项目。中小型到大型项目均可。</li>
</ul>
<h3 id="对比与选型建议-面试高频"><a href="#对比与选型建议-面试高频" class="headerlink" title="对比与选型建议 (面试高频)"></a>对比与选型建议 (面试高频)</h3><table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">Recoil</th>
<th align="left">Zustand</th>
<th align="left">Jotai</th>
</tr>
</thead>
<tbody><tr>
<td align="left">核心模型</td>
<td align="left">Atoms + Selectors (Graph)</td>
<td align="left">Centralized Store + Actions</td>
<td align="left">Atoms (Primitive)</td>
</tr>
<tr>
<td align="left">API 复杂度</td>
<td align="left">中等 (概念较多)</td>
<td align="left">极低 (非常简洁)</td>
<td align="left">很低 (极其精简)</td>
</tr>
<tr>
<td align="left">学习曲线</td>
<td align="left">中等偏上</td>
<td align="left">低</td>
<td align="left">低</td>
</tr>
<tr>
<td align="left">状态更新粒度</td>
<td align="left">细粒度 (Atom&#x2F;Selector 级)</td>
<td align="left">细粒度 (Selector 函数级)</td>
<td align="left">细粒度 (Atom 级)</td>
</tr>
<tr>
<td align="left">Provider 要求</td>
<td align="left"><code>&lt;RecoilRoot&gt;</code> 必需</td>
<td align="left">不需要 (全局 Store)</td>
<td align="left">可选 (默认全局，可隔离)</td>
</tr>
<tr>
<td align="left">异步处理</td>
<td align="left">强大 (Selector + Suspense)</td>
<td align="left">良好 (在 Action 中处理)</td>
<td align="left">良好 (在 Atom 或 Effect 中处理)</td>
</tr>
<tr>
<td align="left">TypeScript</td>
<td align="left">优秀</td>
<td align="left">极佳</td>
<td align="left">极佳</td>
</tr>
<tr>
<td align="left">包体积</td>
<td align="left">较大</td>
<td align="left">很小</td>
<td align="left">极小</td>
</tr>
<tr>
<td align="left">开发体验 (DX)</td>
<td align="left">好 (Meta 工具)</td>
<td align="left">极佳 (简洁，DevTools)</td>
<td align="left">极佳 (简洁)</td>
</tr>
<tr>
<td align="left">适用规模</td>
<td align="left">大型 &#x2F; 复杂派生状态</td>
<td align="left">全规模 (尤其推荐)</td>
<td align="left">全规模 (推荐中小到中大型)</td>
</tr>
<tr>
<td align="left">类似库</td>
<td align="left">-</td>
<td align="left">Valtio, React Tracked</td>
<td align="left">Recoil (简化版)</td>
</tr>
</tbody></table>
<h3 id="面试踩坑点与高频问题"><a href="#面试踩坑点与高频问题" class="headerlink" title="面试踩坑点与高频问题"></a>面试踩坑点与高频问题</h3><ul>
<li>useRecoilValueLoadable 状态 (state, contents)? Recoil 异步 Selector 使用 useRecoilValueLoadable 获取 Loadable 对象，其 state 表示状态 (‘hasValue’, ‘loading’, ‘hasError’)，contents 包含实际值或 Error 对象。</li>
<li>Zustand 性能关键 (selector 函数)： 务必使用带选择器函数的 useStore(selector) 来避免订阅整个 Store 导致的无效渲染。强调选择器结果变化才会触发渲染。</li>
<li>Jotai 的 Provider 作用： 理解默认全局 Context 和 <Provider> 创建隔离作用域的区别及适用场景（微前端、测试、组件库）。</li>
<li>不可变更新 (所有库)： 虽然 Zustand 和 Jotai 在 set 时可以“直接修改”，但最佳实践仍是保持不可变性（尤其数组&#x2F;对象），以避免潜在的渲染问题或 DevTools 跟踪问题。Zustand 常配合 immer 中间件。</li>
<li>闭包陷阱 (异步 Action)： 在 Zustand&#x2F;Jotai 的异步 Action 中，如果依赖当前状态进行计算，应使用 get() 函数 (Zustand) 或 get 参数 (Jotai 的 Atom set)，而不是直接读取闭包中的旧状态值。<ul>
<li>错误示例 (Zustand 闭包陷阱):</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ❌ 错误：闭包可能捕获旧的 count</span>
<span class="token keyword">const</span> useStore <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">set</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token function-variable function">incrementAsync</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里的 `count` 是创建时的初始值 0！</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>正确做法 (使用 get):</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ✅ 正确：通过 get 访问最新状态</span>
<span class="token keyword">const</span> useStore <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">set<span class="token punctuation">,</span> <span class="token keyword">get</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token function-variable function">incrementAsync</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取当前最新值</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>与 React 18 并发特性的兼容性： 强调 Recoil 和 Jotai 在设计上考虑了并发渲染。Zustand 也基本兼容，但需注意在严格模式下的双重渲染可能带来的副作用问题（可通过中间件或状态稳定化处理）。</li>
<li>为什么不用 Context 代替？ Context 在状态更新时会导致所有消费该 Context 的组件重新渲染，无论它们是否依赖于变化的那部分状态。这在频繁更新或大型状态对象时性能极差。Recoil&#x2F;Zustand&#x2F;Jotai 都通过订阅机制实现了细粒度更新。</li>
</ul>
<h1 id="第六章：React-Router-与数据请求"><a href="#第六章：React-Router-与数据请求" class="headerlink" title="第六章：React Router 与数据请求"></a>第六章：React Router 与数据请求</h1><h2 id="6-1-React-Router-基础（BrowserRouter、Route、Link）"><a href="#6-1-React-Router-基础（BrowserRouter、Route、Link）" class="headerlink" title="6.1 React Router 基础（BrowserRouter、Route、Link）"></a>6.1 React Router 基础（BrowserRouter、Route、Link）</h2><h3 id="基础概念（简要）"><a href="#基础概念（简要）" class="headerlink" title="基础概念（简要）"></a>基础概念（简要）</h3><p><strong>SPA 路由原理</strong></p>
<ul>
<li>在单页应用中，路由切换不会触发页面刷新</li>
<li>通过监听 URL 变化（hash 或 history API），动态渲染对应组件</li>
<li>保持应用状态的同时实现视图切换</li>
</ul>
<p><strong>React Router 核心作用</strong></p>
<ul>
<li>声明式路由配置</li>
<li>URL 与组件的映射关系管理</li>
<li>导航控制（声明式 <code>&lt;Link&gt;</code> 和编程式 navigate）</li>
</ul>
<h3 id="核心组件深度解析（React-Router-v6）"><a href="#核心组件深度解析（React-Router-v6）" class="headerlink" title="核心组件深度解析（React Router v6）"></a>核心组件深度解析（React Router v6）</h3><p><strong><code>&lt;BrowserRouter&gt;</code></strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 入口文件 index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> BrowserRouter <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>BrowserRouter<span class="token operator">></span>
    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>BrowserRouter<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>作用：使用 HTML5 History API (pushState, replaceState) 管理路由</li>
<li>特点：<ul>
<li>URL 格式为干净的路径（如 &#x2F;dashboard）</li>
<li>需要服务器配合：所有路由请求需返回 index.html</li>
<li>面试坑点：直接访问子路由出现 404 的解决方案（配置服务器 fallback）</li>
</ul>
</li>
</ul>
<p><strong><code>&lt;Routes&gt;</code> 与 <code>&lt;Route&gt;</code></strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Routes<span class="token punctuation">,</span> Route <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Routes<span class="token operator">></span>
      <span class="token punctuation">&#123;</span><span class="token comment">/* 基础路由 */</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>HomePage <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      
      <span class="token punctuation">&#123;</span><span class="token comment">/* 动态路由 */</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/users/:id"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>UserDetail <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      
      <span class="token punctuation">&#123;</span><span class="token comment">/* 嵌套路由 */</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/dashboard"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>DashboardLayout <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>Route index element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>DashboardHome <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#123;</span><span class="token comment">/* index 路由 */</span><span class="token punctuation">&#125;</span>
        <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"settings"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>SettingsPage <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
      
      <span class="token punctuation">&#123;</span><span class="token comment">/* 404 路由 */</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"*"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>NotFoundPage <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Routes<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>&lt;Routes&gt;</code>：<ul>
<li>路由匹配容器，替代 v5 的 <Switch></li>
<li>自动选择最佳匹配的路由（不再按顺序匹配）</li>
</ul>
</li>
<li><code>&lt;Route&gt;</code> 关键属性：<ul>
<li>path：URL 匹配规则（支持 :id 动态参数）</li>
<li>element：匹配时渲染的组件（必须是 React 元素，如 <Component />）</li>
<li>index：标识默认子路由（当父路由匹配时渲染）</li>
</ul>
</li>
</ul>
<p><strong><code>&lt;Link&gt;</code> 与 <code>&lt;NavLink&gt;</code></strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Link<span class="token punctuation">,</span> NavLink <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>

<span class="token comment">// 基础链接</span>
<span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">"/about"</span><span class="token operator">></span>关于我们<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span>

<span class="token comment">// 带状态的导航</span>
<span class="token operator">&lt;</span>Link 
  to<span class="token operator">=</span><span class="token string">"/users/123"</span>
  state<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">fromDashboard</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>  <span class="token comment">// 传递状态</span>
<span class="token operator">></span>
  用户详情
<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span>

<span class="token comment">// 活动链接样式</span>
<span class="token operator">&lt;</span>NavLink 
  to<span class="token operator">=</span><span class="token string">"/dashboard"</span>
  style<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> isActive <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> 
    <span class="token literal-property property">color</span><span class="token operator">:</span> isActive <span class="token operator">?</span> <span class="token string">'red'</span> <span class="token operator">:</span> <span class="token string">'blue'</span> 
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
  end  <span class="token comment">// 精确匹配（v6 新特性）</span>
<span class="token operator">></span>
  控制台
<span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>&lt;Link&gt;</code>：<ul>
<li>声明式导航组件，渲染为 <code>&lt;a&gt;</code> 标签</li>
<li>to 属性支持字符串&#x2F;对象（可包含 pathname, search, hash, state）</li>
</ul>
</li>
<li><code>&lt;NavLink&gt;</code>：<ul>
<li>增强版 <code>&lt;Link&gt;</code>，可添加活动状态样式</li>
<li>isActive 标志当前是否匹配</li>
<li>end 属性确保精确匹配（避免父路由激活时子路由也被激活）</li>
</ul>
</li>
</ul>
<h3 id="基础路由配置模式"><a href="#基础路由配置模式" class="headerlink" title="基础路由配置模式"></a>基础路由配置模式</h3><p><strong>集中式配置（推荐）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// routes.js</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>Home <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span> 
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/products'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>ProductLayout <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span> <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>ProductList <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">':id'</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>ProductDetail <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// App.js</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useRoutes <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token function">useRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>编程式导航</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useNavigate <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">LoginButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> navigate <span class="token operator">=</span> <span class="token function">useNavigate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">handleLogin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 跳转并替换历史记录（不可回退）</span>
      <span class="token function">navigate</span><span class="token punctuation">(</span><span class="token string">'/dashboard'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">replace</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleLogin<span class="token punctuation">&#125;</span><span class="token operator">></span>登录<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>useNavigate() 返回导航函数</li>
<li>参数选项：<ul>
<li>replace: true 替换当前历史记录</li>
<li>state 传递路由状态（可通过 useLocation() 获取）</li>
</ul>
</li>
</ul>
<h3 id="面试高频问题与踩坑点"><a href="#面试高频问题与踩坑点" class="headerlink" title="面试高频问题与踩坑点"></a>面试高频问题与踩坑点</h3><p><strong>BrowserRouter 的服务器配置问题</strong></p>
<p>问题：直接访问 &#x2F;dashboard 路由出现 404</p>
<p>解决方案：</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token comment"># Nginx 配置</span>
<span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">&#123;</span>
  <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>v5 到 v6 的重大变化</strong></p>
<ul>
<li>废除 <code>&lt;Switch&gt;</code> → 改用 <code>&lt;Routes&gt;</code></li>
<li>废除 component&#x3D;{Component} → 改用 <code>element=&#123;&lt;Component /&gt;&#125;</code></li>
<li>废除 exact 属性 → 路径匹配规则变更（默认部分匹配）</li>
<li>嵌套路由必须使用 <code>&lt;Outlet&gt;</code> 作为占位符</li>
</ul>
<p><strong>动态路由参数获取</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useParams <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">UserDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> id <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 获取 :id 参数</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>路由状态传递与获取</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 发送方</span>
<span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">"/profile"</span> state<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">fromHome</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>

<span class="token comment">// 接收方</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useLocation <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> location <span class="token operator">=</span> <span class="token function">useLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>state<span class="token operator">?.</span>fromHome<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong><code>&lt;NavLink&gt;</code> 精确匹配问题</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 错误：/dashboard/settings 会同时激活两个链接</span>
<span class="token operator">&lt;</span>NavLink to<span class="token operator">=</span><span class="token string">"/dashboard"</span><span class="token operator">></span>控制台<span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span>
<span class="token operator">&lt;</span>NavLink to<span class="token operator">=</span><span class="token string">"/dashboard/settings"</span><span class="token operator">></span>设置<span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span>

<span class="token comment">// 正确：父链接添加 end 属性</span>
<span class="token operator">&lt;</span>NavLink to<span class="token operator">=</span><span class="token string">"/dashboard"</span> end<span class="token operator">></span>控制台<span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>路由鉴权基础模式</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 高阶组件示例</span>
<span class="token keyword">const</span> <span class="token function-variable function">PrivateRoute</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> user <span class="token operator">?</span> children <span class="token operator">:</span> <span class="token operator">&lt;</span>Navigate to<span class="token operator">=</span><span class="token string">"/login"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token operator">&lt;</span>Route 
  path<span class="token operator">=</span><span class="token string">"/admin"</span>
  element<span class="token operator">=</span><span class="token punctuation">&#123;</span>
    <span class="token operator">&lt;</span>PrivateRoute<span class="token operator">></span>
      <span class="token operator">&lt;</span>AdminPanel <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>PrivateRoute<span class="token operator">></span>
  <span class="token punctuation">&#125;</span>
<span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="核心总结"><a href="#核心总结" class="headerlink" title="核心总结"></a>核心总结</h3><ul>
<li>路由三件套：<ul>
<li><code>&lt;BrowserRouter&gt;</code> 提供路由上下文</li>
<li><code>&lt;Routes&gt;</code> + <code>&lt;Route&gt;</code> 定义路由规则</li>
<li><code>&lt;Link&gt;</code>&#x2F;<code>&lt;NavLink&gt;</code> 实现声明式导航</li>
</ul>
</li>
<li>v6 核心变化：<ul>
<li>路由配置从 component 改为 element</li>
<li>嵌套路由使用 <code>&lt;Outlet&gt;</code> 作为渲染出口</li>
<li>匹配规则优化（自动选择最佳匹配）</li>
</ul>
</li>
<li>面试必考：<ul>
<li>动态路由参数获取（useParams）</li>
<li>编程式导航（useNavigate）</li>
<li>路由守卫实现方案</li>
<li>v5 到 v6 的迁移问题</li>
</ul>
</li>
</ul>
<h2 id="6-2-动态路由与嵌套路由"><a href="#6-2-动态路由与嵌套路由" class="headerlink" title="6.2 动态路由与嵌套路由"></a>6.2 动态路由与嵌套路由</h2><h3 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h3><p><strong>动态路由</strong></p>
<ul>
<li>定义：路径中包含参数的路由（如 &#x2F;users&#x2F;:id）</li>
<li>核心价值：<ul>
<li>创建可复用的视图模板</li>
<li>根据URL参数动态加载数据</li>
<li>实现SEO友好的URL结构</li>
</ul>
</li>
</ul>
<p><strong>嵌套路由</strong></p>
<ul>
<li>定义：路由之间的父子层级关系</li>
<li>核心价值：<ul>
<li>实现布局复用（共享header&#x2F;sidebar）</li>
<li>组织复杂的应用结构</li>
<li>保持局部UI状态（仅更新子路由区域）</li>
</ul>
</li>
</ul>
<h3 id="动态路由深度解析"><a href="#动态路由深度解析" class="headerlink" title="动态路由深度解析"></a>动态路由深度解析</h3><p><strong>基础实现</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 路由配置</span>
<span class="token operator">&lt;</span>Routes<span class="token operator">></span>
  <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/products/:productId"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>ProductDetail <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Routes<span class="token operator">></span>

<span class="token comment">// 组件内获取参数</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useParams <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">ProductDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> productId <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取动态参数</span>
  <span class="token comment">// 使用 productId 加载数据...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>高级匹配模式</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 多参数路由</span>
<span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/category/:categoryId/product/:productId"</span> <span class="token operator">/</span><span class="token operator">></span>

<span class="token comment">// 可选参数</span>
<span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/search/:keyword?/:filter?"</span> <span class="token operator">/</span><span class="token operator">></span>

<span class="token comment">// 正则约束 (v6.8+)</span>
<span class="token operator">&lt;</span>Route 
  path<span class="token operator">=</span><span class="token string">"/user/:id(\\d+)"</span> <span class="token comment">// 只匹配数字ID</span>
  element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>UserProfile <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> 
<span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>数据加载模式</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// React Router v6.4+ 数据路由</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createBrowserRouter</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"products/:id"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>ProductLayout <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token function-variable function">loader</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> params <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/products/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>params<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 预加载数据</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span> <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>ProductOverview <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"reviews"</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>ProductReviews <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="嵌套路由深度解析"><a href="#嵌套路由深度解析" class="headerlink" title="嵌套路由深度解析"></a>嵌套路由深度解析</h3><p><strong>基础嵌套结构</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>Routes<span class="token operator">></span>
  <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"dashboard"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>DashboardLayout <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>Route index element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>DashboardHome <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"analytics"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>AnalyticsPage <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"settings"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>SettingsPage <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Routes<span class="token operator">></span>

<span class="token comment">// DashboardLayout.jsx</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Outlet <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">DashboardLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"dashboard"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Sidebar <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"content"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>Outlet <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#123;</span><span class="token comment">/* 子路由渲染位置 */</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>多级嵌套实现</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"admin"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>AdminLayout <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>Route index element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>AdminDashboard <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"users"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>UserManagementLayout <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>Route index element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>UserList <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">":userId"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>UserDetail <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>布局路由模式</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 创建共享布局组件</span>
<span class="token keyword">function</span> <span class="token function">MainLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Header <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>main<span class="token operator">></span>
        <span class="token operator">&lt;</span>Outlet <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">></span>
      <span class="token operator">&lt;</span>Footer <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 应用布局</span>
<span class="token operator">&lt;</span>Route element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>MainLayout <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>HomePage <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/about"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>AboutPage <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"/contact"</span> element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>ContactPage <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="关键特性与最佳实践"><a href="#关键特性与最佳实践" class="headerlink" title="关键特性与最佳实践"></a>关键特性与最佳实践</h3><p><strong>动态路径生成</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 根据数据生成动态路由</span>
<span class="token keyword">const</span> products <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> products<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">product</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">products/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>product<span class="token punctuation">.</span>slug<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>ProductPage <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
  <span class="token function-variable function">loader</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> product
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>相对路由导航</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 在 /dashboard/settings 中</span>
<span class="token keyword">function</span> <span class="token function">SettingsPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">"../analytics"</span><span class="token operator">></span>返回分析<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span> 
      <span class="token punctuation">&#123;</span><span class="token comment">/* 指向 /dashboard/analytics */</span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>错误边界处理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 路由级错误处理</span>
<span class="token operator">&lt;</span>Route
  path<span class="token operator">=</span><span class="token string">"projects/:projectId"</span>
  element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>ProjectDetail <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span>
  errorElement<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>ProjectError <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> <span class="token comment">// 捕获组件渲染错误</span>
  loader<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> params <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> project <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchProject</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>projectId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>project<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">"Not Found"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">404</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> project<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="面试高频问题与解决方案"><a href="#面试高频问题与解决方案" class="headerlink" title="面试高频问题与解决方案"></a>面试高频问题与解决方案</h3><p><strong>动态路由数据加载竞态条件</strong></p>
<p>问题：快速切换路由时，后发请求可能先返回导致数据错乱</p>
<p>解决方案：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> isActive <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/products/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>productId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isActive<span class="token punctuation">)</span> <span class="token function">setProduct</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> isActive <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// 清理函数取消旧请求</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>productId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>嵌套路由权限控制</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 路由守卫组件</span>
<span class="token keyword">const</span> <span class="token function-variable function">ProtectedRoute</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children<span class="token punctuation">,</span> roles <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>Navigate to<span class="token operator">=</span><span class="token string">"/login"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>roles <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>roles<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>role<span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Navigate to<span class="token operator">=</span><span class="token string">"/unauthorized"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> children<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token operator">&lt;</span>Route 
  path<span class="token operator">=</span><span class="token string">"admin"</span>
  element<span class="token operator">=</span><span class="token punctuation">&#123;</span>
    <span class="token operator">&lt;</span>ProtectedRoute roles<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'superadmin'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>AdminLayout <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ProtectedRoute<span class="token operator">></span>
  <span class="token punctuation">&#125;</span>
<span class="token operator">></span>
  <span class="token punctuation">&#123;</span><span class="token comment">/* 子路由自动继承保护 */</span><span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>面包屑导航实现</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用 useMatches() 获取路由层级</span>
<span class="token keyword">function</span> <span class="token function">Breadcrumbs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> matches <span class="token operator">=</span> <span class="token function">useMatches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>nav<span class="token operator">></span>
      <span class="token punctuation">&#123;</span>matches
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">match</span> <span class="token operator">=></span> match<span class="token punctuation">.</span>handle<span class="token operator">?.</span>breadcrumb<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">match</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>span key<span class="token operator">=</span><span class="token punctuation">&#123;</span>match<span class="token punctuation">.</span>pathname<span class="token punctuation">&#125;</span><span class="token operator">></span>
            <span class="token punctuation">&#123;</span>match<span class="token punctuation">.</span>handle<span class="token punctuation">.</span><span class="token function">breadcrumb</span><span class="token punctuation">(</span>match<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>nav<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 路由配置中添加元数据</span>
<span class="token operator">&lt;</span>Route 
  path<span class="token operator">=</span><span class="token string">"products/:id"</span>
  element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>ProductPage <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span>
  handle<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token function-variable function">breadcrumb</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">match</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Product </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>match<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>滚动位置恢复</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 创建自定义滚动管理</span>
<span class="token keyword">function</span> <span class="token function">ScrollToTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> location <span class="token operator">=</span> <span class="token function">useLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 排除需要保留滚动位置的路由</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>location<span class="token punctuation">.</span>state<span class="token operator">?.</span>preserveScroll<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>location<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 在根路由使用</span>
<span class="token operator">&lt;</span>Router<span class="token operator">></span>
  <span class="token operator">&lt;</span>ScrollToTop <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>Routes<span class="token operator">></span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>Routes<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="性能优化技巧-2"><a href="#性能优化技巧-2" class="headerlink" title="性能优化技巧"></a>性能优化技巧</h3><p><strong>路由级代码分割</strong>：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> ProductDetail <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./ProductDetail'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">&lt;</span>Route 
  path<span class="token operator">=</span><span class="token string">"products/:id"</span> 
  element<span class="token operator">=</span><span class="token punctuation">&#123;</span>
    <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>Loading <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>ProductDetail <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
  <span class="token punctuation">&#125;</span>
<span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>预加载策略</strong>：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 鼠标悬停时预加载路由组件</span>
<span class="token operator">&lt;</span>Link 
  to<span class="token operator">=</span><span class="token string">"/dashboard/analytics"</span>
  onMouseEnter<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./AnalyticsPage'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
<span class="token operator">></span>
  分析面板
<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h3><p><strong>动态路由核心</strong>：</p>
<ul>
<li>使用 :param 语法定义动态段</li>
<li>通过 useParams() 获取参数</li>
<li>支持正则约束和可选参数</li>
</ul>
<p><strong>嵌套路由核心</strong>：</p>
<ul>
<li>使用 <code>&lt;Outlet&gt;</code> 作为子路由渲染出口</li>
<li>布局路由共享UI结构</li>
<li>路由配置反映UI层次关系</li>
</ul>
<p><strong>高级模式</strong>：</p>
<ul>
<li>数据路由（v6.4+）实现预加载</li>
<li>相对导航简化路径管理</li>
<li>错误边界增强健壮性</li>
</ul>
<p><strong>面试重点</strong>：</p>
<ul>
<li>动态路由的数据加载问题</li>
<li>嵌套路由的权限控制方案</li>
<li>复杂路由结构设计能力</li>
<li>性能优化实践</li>
</ul>
<h2 id="6-3-路由守卫与权限控制"><a href="#6-3-路由守卫与权限控制" class="headerlink" title="6.3 路由守卫与权限控制"></a>6.3 路由守卫与权限控制</h2><h3 id="权限控制核心概念"><a href="#权限控制核心概念" class="headerlink" title="权限控制核心概念"></a>权限控制核心概念</h3><p><strong>权限控制类型</strong></p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">场景</th>
<th align="left">实现难度</th>
</tr>
</thead>
<tbody><tr>
<td align="left">路由级守卫</td>
<td align="left">整个路由模块的访问控制</td>
<td align="left">★★☆</td>
</tr>
<tr>
<td align="left">组件级守卫</td>
<td align="left">页面内特定功能的访问控制</td>
<td align="left">★★★</td>
</tr>
<tr>
<td align="left">数据级守卫</td>
<td align="left">API 请求和数据显示控制</td>
<td align="left">★★★★</td>
</tr>
</tbody></table>
<p><strong>认证与授权</strong></p>
<ul>
<li>认证(Authentication)：验证用户身份（是否登录）</li>
<li>授权(Authorization)：验证用户权限（是否有权访问）</li>
</ul>
<h3 id="基础路由守卫实现"><a href="#基础路由守卫实现" class="headerlink" title="基础路由守卫实现"></a>基础路由守卫实现</h3><p><strong>高阶组件模式 (HOC)</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 路由守卫高阶组件</span>
<span class="token keyword">const</span> <span class="token function-variable function">withAuth</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">Component<span class="token punctuation">,</span> requiredRole <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> user<span class="token punctuation">,</span> isAuthenticated <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> location <span class="token operator">=</span> <span class="token function">useLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isAuthenticated<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 未登录重定向到登录页</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>Navigate to<span class="token operator">=</span><span class="token string">"/login"</span> state<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">from</span><span class="token operator">:</span> location <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> replace <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>requiredRole <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>role <span class="token operator">!==</span> requiredRole<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 权限不足</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>Navigate to<span class="token operator">=</span><span class="token string">"/unauthorized"</span> replace <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">&#123;</span><span class="token operator">...</span>props<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> AdminDashboard <span class="token operator">=</span> <span class="token function">withAuth</span><span class="token punctuation">(</span>DashboardComponent<span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 路由配置</span>
<span class="token operator">&lt;</span>Route 
  path<span class="token operator">=</span><span class="token string">"/admin"</span> 
  element<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>AdminDashboard <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span> 
<span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>包装器组件模式</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 路由守卫组件</span>
<span class="token keyword">const</span> <span class="token function-variable function">RouteGuard</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children<span class="token punctuation">,</span> roles <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> user<span class="token punctuation">,</span> isAuthenticated <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> location <span class="token operator">=</span> <span class="token function">useLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isAuthenticated<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Navigate to<span class="token operator">=</span><span class="token string">"/login"</span> state<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">from</span><span class="token operator">:</span> location <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> replace <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>roles <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>roles<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>role<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"unauthorized"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>h2<span class="token operator">></span><span class="token number">403</span> Forbidden<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
      <span class="token operator">&lt;</span>p<span class="token operator">></span>您没有权限访问此页面<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">return</span> children<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用示例</span>
<span class="token operator">&lt;</span>Route 
  path<span class="token operator">=</span><span class="token string">"/dashboard"</span> 
  element<span class="token operator">=</span><span class="token punctuation">&#123;</span>
    <span class="token operator">&lt;</span>RouteGuard roles<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>DashboardPage <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>RouteGuard<span class="token operator">></span>
  <span class="token punctuation">&#125;</span> 
<span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高级权限控制方案"><a href="#高级权限控制方案" class="headerlink" title="高级权限控制方案"></a>高级权限控制方案</h3><p><strong>基于路由配置的集中式管理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 路由配置文件</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>HomePage <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token keyword">public</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/dashboard'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>DashboardLayout <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token literal-property property">roles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'analytics'</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>Analytics <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span> 
        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> 
        <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>AdminPanel <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
        <span class="token literal-property property">roles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">]</span> <span class="token comment">// 子路由可以覆盖父路由权限</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/system-settings'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>SystemSettings <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token literal-property property">roles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'superadmin'</span><span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 路由渲染器</span>
<span class="token keyword">const</span> <span class="token function-variable function">renderRoutes</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">routes</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> routes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">route</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Route
      key<span class="token operator">=</span><span class="token punctuation">&#123;</span>route<span class="token punctuation">.</span>path<span class="token punctuation">&#125;</span>
      path<span class="token operator">=</span><span class="token punctuation">&#123;</span>route<span class="token punctuation">.</span>path<span class="token punctuation">&#125;</span>
      element<span class="token operator">=</span><span class="token punctuation">&#123;</span>
        route<span class="token punctuation">.</span>public <span class="token operator">?</span> <span class="token punctuation">(</span>
          route<span class="token punctuation">.</span>element
        <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>RouteGuard roles<span class="token operator">=</span><span class="token punctuation">&#123;</span>route<span class="token punctuation">.</span>roles<span class="token punctuation">&#125;</span><span class="token operator">></span>
            <span class="token punctuation">&#123;</span>route<span class="token punctuation">.</span>element<span class="token punctuation">&#125;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>RouteGuard<span class="token operator">></span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token operator">></span>
      <span class="token punctuation">&#123;</span>route<span class="token punctuation">.</span>children <span class="token operator">&amp;&amp;</span> <span class="token function">renderRoutes</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>RBAC（基于角色的访问控制）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 权限服务</span>
<span class="token keyword">const</span> permissionService <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 角色权限映射</span>
  <span class="token literal-property property">roles</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">guest</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'view_public'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'view_dashboard'</span><span class="token punctuation">,</span> <span class="token string">'edit_profile'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">admin</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'manage_users'</span><span class="token punctuation">,</span> <span class="token string">'view_reports'</span><span class="token punctuation">,</span> <span class="token string">'edit_settings'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">superadmin</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'*'</span><span class="token punctuation">]</span> <span class="token comment">// 所有权限</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  
  <span class="token comment">// 检查权限</span>
  <span class="token function">hasPermission</span><span class="token punctuation">(</span><span class="token parameter">user<span class="token punctuation">,</span> requiredPermission</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user <span class="token operator">||</span> <span class="token operator">!</span>user<span class="token punctuation">.</span>role<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> userPermissions <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>roles<span class="token punctuation">[</span>user<span class="token punctuation">.</span>role<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> userPermissions<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token operator">||</span> 
           userPermissions<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>requiredPermission<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 权限检查钩子</span>
<span class="token keyword">const</span> <span class="token function-variable function">usePermission</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">requiredPermission</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> permissionService<span class="token punctuation">.</span><span class="token function">hasPermission</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> requiredPermission<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">function</span> <span class="token function">AnalyticsPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> canViewReports <span class="token operator">=</span> <span class="token function">usePermission</span><span class="token punctuation">(</span><span class="token string">'view_reports'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token punctuation">&#123;</span>canViewReports <span class="token operator">?</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>AnalyticsChart <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"permission-warning"</span><span class="token operator">></span>
          您没有查看报表的权限
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>ABAC（基于属性的访问控制）</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ABAC 策略引擎</span>
<span class="token keyword">const</span> abacEngine <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token parameter">policy<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 简化版策略评估</span>
    <span class="token keyword">return</span> policy<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token parameter">rule</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> context<span class="token punctuation">[</span>rule<span class="token punctuation">.</span>attribute<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>rule<span class="token punctuation">.</span>operator<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token string">'eq'</span><span class="token operator">:</span> <span class="token keyword">return</span> value <span class="token operator">==</span> rule<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">'gt'</span><span class="token operator">:</span> <span class="token keyword">return</span> value <span class="token operator">></span> rule<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">'in'</span><span class="token operator">:</span> <span class="token keyword">return</span> rule<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 项目访问权限检查</span>
<span class="token keyword">const</span> <span class="token function-variable function">useProjectAccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">projectId</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>project<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useFetchProject</span><span class="token punctuation">(</span>projectId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> canEdit <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user <span class="token operator">||</span> <span class="token operator">!</span>project<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">userId</span><span class="token operator">:</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
      <span class="token literal-property property">userRole</span><span class="token operator">:</span> user<span class="token punctuation">.</span>role<span class="token punctuation">,</span>
      <span class="token literal-property property">projectOwner</span><span class="token operator">:</span> project<span class="token punctuation">.</span>ownerId<span class="token punctuation">,</span>
      <span class="token literal-property property">projectStatus</span><span class="token operator">:</span> project<span class="token punctuation">.</span>status<span class="token punctuation">,</span>
      <span class="token literal-property property">teamMembers</span><span class="token operator">:</span> project<span class="token punctuation">.</span>teamMembers
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> editPolicy <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span> <span class="token literal-property property">attribute</span><span class="token operator">:</span> <span class="token string">'userRole'</span><span class="token punctuation">,</span> <span class="token literal-property property">operator</span><span class="token operator">:</span> <span class="token string">'in'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'pm'</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> 
          <span class="token literal-property property">attribute</span><span class="token operator">:</span> <span class="token string">'projectStatus'</span><span class="token punctuation">,</span> 
          <span class="token literal-property property">operator</span><span class="token operator">:</span> <span class="token string">'neq'</span><span class="token punctuation">,</span> 
          <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'archived'</span> 
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">anyOf</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">attribute</span><span class="token operator">:</span> <span class="token string">'projectOwner'</span><span class="token punctuation">,</span> <span class="token literal-property property">operator</span><span class="token operator">:</span> <span class="token string">'eq'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> user<span class="token punctuation">.</span>id <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">attribute</span><span class="token operator">:</span> <span class="token string">'teamMembers'</span><span class="token punctuation">,</span> <span class="token literal-property property">operator</span><span class="token operator">:</span> <span class="token string">'in'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> user<span class="token punctuation">.</span>id <span class="token punctuation">&#125;</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> abacEngine<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>editPolicy<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> project<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> canEdit <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="企业级最佳实践-3"><a href="#企业级最佳实践-3" class="headerlink" title="企业级最佳实践"></a>企业级最佳实践</h3><p><strong>路由元数据方案 (React Router 6.4+)</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用loader实现权限控制</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createBrowserRouter</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/admin"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>AdminLayout <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token function-variable function">loader</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 权限检查</span>
      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">await</span> authService<span class="token punctuation">.</span><span class="token function">getCurrentUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      
      <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>role <span class="token operator">!==</span> <span class="token string">"admin"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">"Forbidden"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">403</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">errorElement</span><span class="token operator">:</span> <span class="token operator">&lt;</span>AdminErrorBoundary <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span> <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>AdminDashboard <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"users"</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>UserManagement <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>JWT 认证集成方案</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// Axios 请求拦截器</span>
api<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">config</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'access_token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    config<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>Authorization <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>token<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Axios 响应拦截器 (处理token刷新)</span>
api<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token parameter">response</span> <span class="token operator">=></span> response<span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> originalRequest <span class="token operator">=</span> error<span class="token punctuation">.</span>config<span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">401</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>originalRequest<span class="token punctuation">.</span>_retry<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      originalRequest<span class="token punctuation">.</span>_retry <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      
      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 刷新token</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">refreshToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'access_token'</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>access_token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 重试原始请求</span>
        originalRequest<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>Authorization <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>data<span class="token punctuation">.</span>access_token<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">api</span><span class="token punctuation">(</span>originalRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>refreshError<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 刷新失败，跳转登录</span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>refreshError<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>权限指令式组件</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 权限控制组件</span>
<span class="token keyword">const</span> <span class="token function-variable function">Permission</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> 
  children<span class="token punctuation">,</span> 
  requiredPermission<span class="token punctuation">,</span>
  fallback <span class="token operator">=</span> <span class="token keyword">null</span> 
<span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> hasPermission <span class="token operator">=</span> <span class="token function">usePermission</span><span class="token punctuation">(</span>requiredPermission<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasPermission<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> fallback<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">return</span> children<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">function</span> <span class="token function">UserManagementPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>h1<span class="token operator">></span>用户管理<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      
      <span class="token operator">&lt;</span>Permission requiredPermission<span class="token operator">=</span><span class="token string">"create_user"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>button<span class="token operator">></span>创建新用户<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Permission<span class="token operator">></span>
      
      <span class="token operator">&lt;</span>Permission 
        requiredPermission<span class="token operator">=</span><span class="token string">"delete_user"</span>
        fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>p <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"text-muted"</span><span class="token operator">></span>您无权删除用户<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">&#125;</span>
      <span class="token operator">></span>
        <span class="token operator">&lt;</span>UserTable withActions <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Permission<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="面试高频问题解决方案"><a href="#面试高频问题解决方案" class="headerlink" title="面试高频问题解决方案"></a>面试高频问题解决方案</h3><p><strong>Q：路由切换时的权限验证</strong></p>
<p>问题：用户权限变更后，已打开页面的权限未更新</p>
<p>解决方案：事件总线通知 + 全局状态监听</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 权限变更事件</span>
<span class="token keyword">const</span> AuthEvents <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token constant">PERMISSION_CHANGED</span><span class="token operator">:</span> <span class="token string">'permission_changed'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 在权限服务中</span>
authService<span class="token punctuation">.</span><span class="token function-variable function">onPermissionsChanged</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  eventBus<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>AuthEvents<span class="token punctuation">.</span><span class="token constant">PERMISSION_CHANGED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 在路由守卫组件中</span>
<span class="token keyword">const</span> <span class="token function-variable function">RouteGuard</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children<span class="token punctuation">,</span> roles <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>permissionsValid<span class="token punctuation">,</span> setPermissionsValid<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">setPermissionsValid</span><span class="token punctuation">(</span><span class="token function">checkPermissions</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    eventBus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>AuthEvents<span class="token punctuation">.</span><span class="token constant">PERMISSION_CHANGED</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> eventBus<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>roles<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>permissionsValid<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Navigate to<span class="token operator">=</span><span class="token string">"/unauthorized"</span> replace <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">return</span> children<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Q：按钮级权限的防抖控制</strong></p>
<p>问题：频繁点击权限按钮导致多次权限检查请求</p>
<p>解决方案：权限缓存 + 防抖机制</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">useCachedPermission</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">permission<span class="token punctuation">,</span> ttl <span class="token operator">=</span> <span class="token number">5000</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>cache<span class="token punctuation">,</span> setCache<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> check <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>permission<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> cache<span class="token punctuation">[</span>permission<span class="token punctuation">]</span><span class="token punctuation">.</span>expires <span class="token operator">></span> now<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">[</span>permission<span class="token punctuation">]</span><span class="token punctuation">.</span>result<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">checkPermission</span><span class="token punctuation">(</span>permission<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setCache</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      <span class="token operator">...</span>prev<span class="token punctuation">,</span>
      <span class="token punctuation">[</span>permission<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> result<span class="token punctuation">,</span> <span class="token literal-property property">expires</span><span class="token operator">:</span> now <span class="token operator">+</span> ttl <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>permission<span class="token punctuation">,</span> ttl<span class="token punctuation">,</span> cache<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> check<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">function</span> <span class="token function">DeleteButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> checkDeletePermission <span class="token operator">=</span> <span class="token function">useCachedPermission</span><span class="token punctuation">(</span><span class="token string">'delete_item'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>disabled<span class="token punctuation">,</span> setDisabled<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">checkDeletePermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">hasPermission</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">setDisabled</span><span class="token punctuation">(</span><span class="token operator">!</span>hasPermission<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>button 
      disabled<span class="token operator">=</span><span class="token punctuation">&#123;</span>disabled<span class="token punctuation">&#125;</span>
      onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleDelete<span class="token punctuation">&#125;</span>
    <span class="token operator">></span>
      删除
    <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Q：动态菜单权限控制</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 动态生成菜单</span>
<span class="token keyword">const</span> <span class="token function-variable function">useAuthorizedMenu</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>menuItems<span class="token punctuation">,</span> setMenuItems<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">loadMenu</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> allItems <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getMenuItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword">const</span> authorizedItems <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
        allItems<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>item<span class="token punctuation">.</span>permission<span class="token punctuation">)</span> <span class="token keyword">return</span> item<span class="token punctuation">;</span>
          
          <span class="token keyword">const</span> hasPerm <span class="token operator">=</span> <span class="token keyword">await</span> permissionService<span class="token punctuation">.</span><span class="token function">checkPermission</span><span class="token punctuation">(</span>
            item<span class="token punctuation">.</span>permission
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> hasPerm <span class="token operator">?</span> item <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token function">setMenuItems</span><span class="token punctuation">(</span>authorizedItems<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token function">loadMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> menuItems<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 菜单组件</span>
<span class="token keyword">function</span> <span class="token function">AppSidebar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> menuItems <span class="token operator">=</span> <span class="token function">useAuthorizedMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>nav<span class="token operator">></span>
      <span class="token operator">&lt;</span>ul<span class="token operator">></span>
        <span class="token punctuation">&#123;</span>menuItems<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>path<span class="token punctuation">&#125;</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>path<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>title<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>nav<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="安全增强措施"><a href="#安全增强措施" class="headerlink" title="安全增强措施"></a>安全增强措施</h3><p><strong>敏感数据保护</strong>：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用权限hook封装数据请求</span>
<span class="token keyword">const</span> <span class="token function-variable function">useProtectedData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">endpoint<span class="token punctuation">,</span> requiredPermission</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> hasPermission <span class="token operator">=</span> <span class="token function">usePermission</span><span class="token punctuation">(</span>requiredPermission<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hasPermission<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">fetch</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>setData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      <span class="token function">setData</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 清除已有数据</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>hasPermission<span class="token punctuation">,</span> endpoint<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> hasPermission <span class="token operator">?</span> data <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>路由权限审计日志</strong>：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 在路由守卫中添加日志</span>
<span class="token keyword">const</span> <span class="token function-variable function">RouteGuard</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children<span class="token punctuation">,</span> roles <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ...权限检查逻辑</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isAuthenticated<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      auditService<span class="token punctuation">.</span><span class="token function">logRouteAccess</span><span class="token punctuation">(</span>
        location<span class="token punctuation">.</span>pathname<span class="token punctuation">,</span> 
        user<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
        hasPermission <span class="token operator">?</span> <span class="token string">'GRANTED'</span> <span class="token operator">:</span> <span class="token string">'DENIED'</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>location<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>权限变更强制刷新</strong>：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 监听权限变更</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handlePermissionChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 显示刷新提示</span>
    <span class="token function">setShowRefresh</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  permissionService<span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span>handlePermissionChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> permissionService<span class="token punctuation">.</span><span class="token function">offChange</span><span class="token punctuation">(</span>handlePermissionChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在UI中显示提示</span>
<span class="token punctuation">&#123;</span>showRefresh <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"refresh-banner"</span><span class="token operator">></span>
    您的权限已更新，请
    <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      刷新页面
    <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    以应用更改
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="总结-5"><a href="#总结-5" class="headerlink" title="总结"></a>总结</h3><ul>
<li>核心模式：<ul>
<li>高阶组件(HOC)模式：适合类组件场景</li>
<li>包装器组件：函数组件推荐方案</li>
<li>路由元数据：React Router 6.4+最佳实践</li>
</ul>
</li>
<li>权限模型：<ul>
<li>RBAC：基于角色的权限控制（适合大多数场景）</li>
<li>ABAC：基于属性的动态权限控制（复杂系统适用）</li>
</ul>
</li>
<li>企业级方案：<ul>
<li>JWT认证集成</li>
<li>权限变更实时响应</li>
<li>动态菜单控制</li>
<li>审计日志追踪</li>
</ul>
</li>
<li>面试重点：<ul>
<li>路由级 vs 组件级权限控制</li>
<li>权限变更后的状态同步</li>
<li>按钮级权限的性能优化</li>
<li>动态菜单的实现方案</li>
</ul>
</li>
</ul>
<h2 id="6-4-数据请求方案（fetch、axios、React-Query、SWR）"><a href="#6-4-数据请求方案（fetch、axios、React-Query、SWR）" class="headerlink" title="6.4 数据请求方案（fetch、axios、React Query、SWR）"></a>6.4 数据请求方案（fetch、axios、React Query、SWR）</h2><h3 id="数据请求核心方案对比"><a href="#数据请求核心方案对比" class="headerlink" title="数据请求核心方案对比"></a>数据请求核心方案对比</h3><table>
<thead>
<tr>
<th align="left">方案</th>
<th align="left">特点</th>
<th align="left">适用场景</th>
<th align="left">包大小</th>
</tr>
</thead>
<tbody><tr>
<td align="left">原生 fetch</td>
<td align="left">浏览器原生 API，无需安装</td>
<td align="left">简单请求、现代浏览器项目	0kB</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Axios</td>
<td align="left">功能丰富、拦截器、自动转换 JSON</td>
<td align="left">企业级应用、复杂请求处理	4.8kB</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">React Query</td>
<td align="left">数据缓存、自动重试、请求管理</td>
<td align="left">复杂数据交互、实时应用	11.8kB</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">SWR</td>
<td align="left">轻量级、快速集成、智能缓存</td>
<td align="left">快速开发、中小型项目	3.5kB</td>
<td align="left"></td>
</tr>
</tbody></table>
<h3 id="基础请求方案深度解析"><a href="#基础请求方案深度解析" class="headerlink" title="基础请求方案深度解析"></a>基础请求方案深度解析</h3><p><strong>Fetch API</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 基础 GET 请求</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/data'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">HTTP error! status: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>response<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> data<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Fetch error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// POST 请求示例</span>
<span class="token keyword">const</span> <span class="token function-variable function">postData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/data'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'Authorization'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>token<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>核心特性：</p>
<ul>
<li>优点：浏览器原生支持、Promise 接口</li>
<li>缺点：无请求取消、无超时控制（需手动实现）</li>
<li>关键配置：</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 超时控制</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetchWithTimeout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> timeout <span class="token operator">=</span> <span class="token number">8000</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> 
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Request timeout'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timeout<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Axios 高级应用</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>

<span class="token comment">// 创建实例</span>
<span class="token keyword">const</span> api <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">baseURL</span><span class="token operator">:</span> <span class="token string">'https://api.example.com'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string-property property">'X-Custom-Header'</span><span class="token operator">:</span> <span class="token string">'value'</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 请求拦截器</span>
api<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">config</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    config<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>Authorization <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>token<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=></span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 响应拦截器</span>
api<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token parameter">response</span> <span class="token operator">=></span> response<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
  <span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token operator">?.</span>status <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 处理未授权</span>
      window<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">'/login'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 取消令牌</span>
<span class="token keyword">const</span> source <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
api<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/data'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">cancelToken</span><span class="token operator">:</span> source<span class="token punctuation">.</span>token <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
source<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token string">'Operation canceled by user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>核心特性：</p>
<ul>
<li>自动转换 JSON 数据</li>
<li>客户端 XSRF 防护</li>
<li>并发请求支持 (axios.all)</li>
<li>上传进度监控</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">api<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> formData<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">onUploadProgress</span><span class="token operator">:</span> <span class="token parameter">progressEvent</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> percent <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span>progressEvent<span class="token punctuation">.</span>loaded <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> progressEvent<span class="token punctuation">.</span>total
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Upload progress: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>percent<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">%</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="现代数据管理库深度解析"><a href="#现代数据管理库深度解析" class="headerlink" title="现代数据管理库深度解析"></a>现代数据管理库深度解析</h3><p><strong>React Query 核心概念</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useQuery<span class="token punctuation">,</span> useMutation<span class="token punctuation">,</span> QueryClient<span class="token punctuation">,</span> QueryClientProvider <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-query'</span><span class="token punctuation">;</span>

<span class="token comment">// 创建查询客户端</span>
<span class="token keyword">const</span> queryClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>QueryClientProvider client<span class="token operator">=</span><span class="token punctuation">&#123;</span>queryClient<span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>UserProfile <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>QueryClientProvider<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 查询示例</span>
<span class="token keyword">function</span> <span class="token function">UserProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> isLoading<span class="token punctuation">,</span> isError<span class="token punctuation">,</span> error <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span>
    <span class="token string">'userData'</span><span class="token punctuation">,</span> 
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> api<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/users/123'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">staleTime</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// 5分钟保鲜期</span>
      <span class="token literal-property property">retry</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 失败重试次数</span>
      <span class="token literal-property property">refetchOnWindowFocus</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 窗口聚焦时重新获取</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 突变示例</span>
  <span class="token keyword">const</span> updateUser <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">newData</span><span class="token punctuation">)</span> <span class="token operator">=></span> api<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/users/123'</span><span class="token punctuation">,</span> newData<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token function-variable function">onSuccess</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 更新成功后重新获取用户数据</span>
        queryClient<span class="token punctuation">.</span><span class="token function">invalidateQueries</span><span class="token punctuation">(</span><span class="token string">'userData'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token function-variable function">onError</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        toast<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">更新失败: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>error<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>isLoading<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>Spinner <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isError<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>Error message<span class="token operator">=</span><span class="token punctuation">&#123;</span>error<span class="token punctuation">.</span>message<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token punctuation">&#123;</span>data<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> updateUser<span class="token punctuation">.</span><span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'新名字'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
        更新用户
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>核心特性：</p>
<ul>
<li>智能缓存：自动管理请求缓存</li>
<li>后台刷新：数据过期时在后台更新</li>
<li>分页查询：</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> fetchNextPage <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useInfiniteQuery</span><span class="token punctuation">(</span>
  <span class="token string">'projects'</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> pageParam <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> api<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/projects?page=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>pageParam<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">getNextPageParam</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">lastPage</span><span class="token punctuation">)</span> <span class="token operator">=></span> lastPage<span class="token punctuation">.</span>nextPage
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>SWR 核心应用</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> useSWR <span class="token keyword">from</span> <span class="token string">'swr'</span><span class="token punctuation">;</span>

<span class="token comment">// 自定义 fetcher</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetcher</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> error<span class="token punctuation">,</span> mutate <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useSWR</span><span class="token punctuation">(</span>
    <span class="token string">'/api/user/123'</span><span class="token punctuation">,</span> 
    fetcher<span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">revalidateOnFocus</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">refreshInterval</span><span class="token operator">:</span> <span class="token number">60000</span><span class="token punctuation">,</span> <span class="token comment">// 60秒刷新一次</span>
      <span class="token function-variable function">onErrorRetry</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> key<span class="token punctuation">,</span> config<span class="token punctuation">,</span> revalidate<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> retryCount <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 404错误不重试</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">404</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">// 10秒后重试</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">revalidate</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> retryCount <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 乐观更新</span>
  <span class="token keyword">const</span> <span class="token function-variable function">updateName</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">newName</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 立即更新本地数据</span>
    <span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>data<span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> newName <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">patch</span><span class="token punctuation">(</span><span class="token string">'/api/user/123'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> newName <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 重新验证确保数据最新</span>
      <span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 出错时回滚</span>
      <span class="token function">mutate</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token punctuation">&#123;</span>data <span class="token operator">?</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token punctuation">&#123;</span>data<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span> <span class="token operator">:</span> <span class="token string">'Loading...'</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">updateName</span><span class="token punctuation">(</span><span class="token string">'New Name'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
        更新名字
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>核心特性：</p>
<ul>
<li>请求去重：自动避免重复请求</li>
<li>依赖请求：基于数据依赖的请求链</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">data</span><span class="token operator">:</span> user <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useSWR</span><span class="token punctuation">(</span><span class="token string">'/api/user/123'</span><span class="token punctuation">,</span> fetcher<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">data</span><span class="token operator">:</span> projects <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useSWR</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/projects?userId=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>user<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> 
  fetcher
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>SSR 支持：</li>
</ul>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getServerSideProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetcher</span><span class="token punctuation">(</span><span class="token string">'/api/user/123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">fallback</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">'/api/user/123'</span><span class="token operator">:</span> user <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> fallback <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>SWRConfig value<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> fallback <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Profile <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>SWRConfig<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高级数据管理策略"><a href="#高级数据管理策略" class="headerlink" title="高级数据管理策略"></a>高级数据管理策略</h3><p><strong>请求状态统一管理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 封装 useApi 钩子</span>
<span class="token keyword">const</span> <span class="token function-variable function">useApi</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>status<span class="token punctuation">,</span> setStatus<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'idle'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> execute <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">'pending'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">setError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>fn<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    status<span class="token punctuation">,</span>  <span class="token comment">// 'idle' | 'pending' | 'success' | 'error'</span>
    data<span class="token punctuation">,</span>
    error<span class="token punctuation">,</span>
    execute<span class="token punctuation">,</span>
    <span class="token literal-property property">isLoading</span><span class="token operator">:</span> status <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isError</span><span class="token operator">:</span> status <span class="token operator">===</span> <span class="token string">'error'</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> status<span class="token punctuation">,</span> <span class="token literal-property property">execute</span><span class="token operator">:</span> fetchUser <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useApi</span><span class="token punctuation">(</span>
  <span class="token string">'userData'</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">userId</span><span class="token punctuation">)</span> <span class="token operator">=></span> api<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>userId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>数据缓存策略</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用 React Query 的缓存工具</span>
<span class="token keyword">const</span> queryClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryClient</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">defaultOptions</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">queries</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">cacheTime</span><span class="token operator">:</span> <span class="token number">15</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// 15分钟缓存</span>
      <span class="token literal-property property">staleTime</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>  <span class="token comment">// 5分钟保鲜</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 手动管理缓存</span>
<span class="token keyword">const</span> <span class="token function-variable function">updateCache</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">newUser</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  queryClient<span class="token punctuation">.</span><span class="token function">setQueryData</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">,</span> newUser<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span> newUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 更新列表缓存</span>
  queryClient<span class="token punctuation">.</span><span class="token function">setQueryData</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'users'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">old</span><span class="token punctuation">)</span> <span class="token operator">=></span> 
    old<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=></span> user<span class="token punctuation">.</span>id <span class="token operator">===</span> newUser<span class="token punctuation">.</span>id <span class="token operator">?</span> newUser <span class="token operator">:</span> user<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// SWR 全局配置</span>
<span class="token operator">&lt;</span>SWRConfig 
  value<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>
    <span class="token function-variable function">provider</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">isOnline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// 自定义网络状态检测</span>
      <span class="token keyword">return</span> navigator<span class="token punctuation">.</span>onLine<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token operator">></span>
  <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>SWRConfig<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="面试高频问题解决方案-1"><a href="#面试高频问题解决方案-1" class="headerlink" title="面试高频问题解决方案"></a>面试高频问题解决方案</h3><p><strong>请求竞态问题（Race Condition）</strong></p>
<p>问题：快速切换参数导致旧请求覆盖新响应</p>
<p>解决方案：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">UserProfile</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> userId <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> isActive <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token function">setData</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    api<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>userId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isActive<span class="token punctuation">)</span> <span class="token function">setData</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isActive<span class="token punctuation">)</span> <span class="token function">setError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> isActive <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>userId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>请求重试策略</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// React Query 指数退避重试</span>
<span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token string">'todos'</span><span class="token punctuation">,</span> fetchTodos<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">retry</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token function-variable function">retryDelay</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">attemptIndex</span><span class="token punctuation">)</span> <span class="token operator">=></span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">**</span> attemptIndex<span class="token punctuation">,</span> <span class="token number">30000</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Axios 拦截器重试</span>
api<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> config <span class="token operator">=</span> error<span class="token punctuation">.</span>config<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>config <span class="token operator">||</span> <span class="token operator">!</span>config<span class="token punctuation">.</span>retry<span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  config<span class="token punctuation">.</span>retryCount <span class="token operator">=</span> config<span class="token punctuation">.</span>retryCount <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>retryCount <span class="token operator">>=</span> config<span class="token punctuation">.</span>retry<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  config<span class="token punctuation">.</span>retryCount <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> 
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">api</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>retryDelay <span class="token operator">||</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>大数据量分页优化</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// React Query 无限加载</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> fetchNextPage<span class="token punctuation">,</span> hasNextPage <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useInfiniteQuery</span><span class="token punctuation">(</span>
  <span class="token string">'projects'</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> pageParam <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> api<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/projects?offset=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>pageParam<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&amp;limit=20</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">getNextPageParam</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">lastPage</span><span class="token punctuation">)</span> <span class="token operator">=></span> 
      lastPage<span class="token punctuation">.</span>hasMore <span class="token operator">?</span> lastPage<span class="token punctuation">.</span>nextOffset <span class="token operator">:</span> <span class="token keyword">undefined</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 虚拟列表渲染</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> FixedSizeList <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-window'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">ProjectList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>FixedSizeList
      height<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">600</span><span class="token punctuation">&#125;</span>
      itemCount<span class="token operator">=</span><span class="token punctuation">&#123;</span>data<span class="token operator">?.</span>pages<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">&#125;</span>
      itemSize<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">100</span><span class="token punctuation">&#125;</span>
      width<span class="token operator">=</span><span class="token string">"100%"</span>
    <span class="token operator">></span>
      <span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> index<span class="token punctuation">,</span> style <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> item <span class="token operator">=</span> data<span class="token punctuation">.</span>pages<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">&#123;</span>style<span class="token punctuation">&#125;</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>ProjectItem data<span class="token operator">=</span><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">&#123;</span>index <span class="token operator">===</span> data<span class="token punctuation">.</span>pages<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> hasNextPage <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
              <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>fetchNextPage<span class="token punctuation">&#125;</span><span class="token operator">></span>加载更多<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>FixedSizeList<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>请求取消与垃圾回收</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// AbortController 取消请求</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span>signal
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 处理响应</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'AbortError'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Request aborted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 处理其他错误</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// React Query 自动垃圾回收</span>
<span class="token keyword">const</span> queryClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryClient</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">defaultOptions</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">queries</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">gcTime</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token comment">// 10分钟后清理缓存</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="性能优化实践"><a href="#性能优化实践" class="headerlink" title="性能优化实践"></a>性能优化实践</h3><p><strong>请求合并与批处理</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// GraphQL 请求合并</span>
<span class="token keyword">const</span> <span class="token constant">GET_USERS</span> <span class="token operator">=</span> gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  query GetUsers($ids: [ID!]!) &#123;
    users(ids: $ids) &#123;
      id
      name
      email
    &#125;
  &#125;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token comment">// REST API 批处理中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api/batch'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> requests <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
  Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>requests<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> url<span class="token punctuation">,</span> method<span class="token punctuation">,</span> body <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> 
    <span class="token function">handleRequest</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> method<span class="token punctuation">,</span> body<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">results</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>数据预取策略</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// React Router v6.4+ 数据预取</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createBrowserRouter</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/user/:id"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>UserProfile <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token function-variable function">loader</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> params <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> queryClient<span class="token punctuation">.</span><span class="token function">fetchQuery</span><span class="token punctuation">(</span>
        <span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> api<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>params<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 用户悬停预取</span>
<span class="token operator">&lt;</span>Link 
  to<span class="token operator">=</span><span class="token string">"/user/123"</span>
  onMouseEnter<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> queryClient<span class="token punctuation">.</span><span class="token function">prefetchQuery</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> api<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/users/123'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
<span class="token operator">></span>
  用户资料
<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>离线数据策略</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用 IndexedDB 缓存数据</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useSWR</span><span class="token punctuation">(</span><span class="token string">'/api/data'</span><span class="token punctuation">,</span> fetcher<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">onSuccess</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 保存到 IndexedDB</span>
    idb<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'cachedData'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">fallbackData</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 从 IndexedDB 获取缓存</span>
    <span class="token keyword">return</span> idb<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'cachedData'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// React Query 离线恢复</span>
<span class="token keyword">const</span> queryClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryClient</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">defaultOptions</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">queries</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">networkMode</span><span class="token operator">:</span> <span class="token string">'offlineFirst'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cacheTime</span><span class="token operator">:</span> <span class="token number">Infinity</span> <span class="token comment">// 持久化缓存</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="总结-6"><a href="#总结-6" class="headerlink" title="总结"></a>总结</h3><ul>
<li>基础方案选择：<ul>
<li>简单场景：优先使用 fetch</li>
<li>企业应用：推荐 axios 作为 HTTP 客户端</li>
</ul>
</li>
<li>现代数据管理：<ul>
<li>复杂应用：选择 React Query（功能全面）</li>
<li>轻量项目：选择 SWR（快速集成）</li>
</ul>
</li>
<li>关键能力：<ul>
<li>智能缓存管理</li>
<li>自动请求重试</li>
<li>乐观更新实现</li>
<li>分页&#x2F;无限加载</li>
</ul>
</li>
<li>性能优化：<ul>
<li>请求批处理</li>
<li>数据预取</li>
<li>离线缓存策略</li>
<li>虚拟列表渲染</li>
</ul>
</li>
<li>面试重点：<ul>
<li>请求竞态解决方案</li>
<li>缓存策略设计</li>
<li>错误处理与重试机制</li>
<li>大型数据分页优化</li>
</ul>
</li>
</ul>
<h2 id="6-5-SSR-与-Next-js-基础"><a href="#6-5-SSR-与-Next-js-基础" class="headerlink" title="6.5 SSR 与 Next.js 基础"></a>6.5 SSR 与 Next.js 基础</h2><h3 id="SSR-核心概念"><a href="#SSR-核心概念" class="headerlink" title="SSR 核心概念"></a>SSR 核心概念</h3><p><strong>渲染模式对比</strong></p>
<table>
<thead>
<tr>
<th align="left">渲染方式</th>
<th align="left">特点</th>
<th align="left">SEO</th>
<th align="left">首屏时间</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">客户端渲染 (CSR)</td>
<td align="left">浏览器下载 JS 后渲染</td>
<td align="left">差</td>
<td align="left">慢</td>
<td align="left">后台系统、Dashboard</td>
</tr>
<tr>
<td align="left">服务器端渲染 (SSR)</td>
<td align="left">服务器生成完整 HTML</td>
<td align="left">优</td>
<td align="left">快</td>
<td align="left">内容网站、电商</td>
</tr>
<tr>
<td align="left">静态站点生成 (SSG)</td>
<td align="left">构建时生成 HTML</td>
<td align="left">优</td>
<td align="left">极快</td>
<td align="left">博客、文档站</td>
</tr>
<tr>
<td align="left">增量静态再生 (ISR)</td>
<td align="left">按需重新生成页面</td>
<td align="left">优</td>
<td align="left">快</td>
<td align="left">动态内容站点</td>
</tr>
</tbody></table>
<p><strong>SSR 核心优势</strong></p>
<ul>
<li>SEO 优化：搜索引擎可直接抓取完整 HTML 内容</li>
<li>性能提升：减少首屏内容可见时间（FCP）</li>
<li>社交分享优化：社交媒体爬虫获取完整页面内容</li>
<li>低端设备支持：服务器处理渲染工作，降低客户端压力</li>
</ul>
<h3 id="Next-js-核心架构"><a href="#Next-js-核心架构" class="headerlink" title="Next.js 核心架构"></a>Next.js 核心架构</h3><p><strong>Next.js 核心特性</strong></p>
<pre><code class="mermaid">graph TD
    A[Next.js] --&gt; B[路由系统]
    A --&gt; C[渲染策略]
    A --&gt; D[数据获取]
    A --&gt; E[API 路由]
    A --&gt; F[优化功能]
    
    B --&gt; B1[文件系统路由]
    B --&gt; B2[动态路由]
    B --&gt; B3[嵌套路由]
    
    C --&gt; C1[SSG 静态生成]
    C --&gt; C2[SSR 服务器渲染]
    C --&gt; C3[ISR 增量再生]
    
    D --&gt; D1[getStaticProps]
    D --&gt; D2[getServerSideProps]
    D --&gt; D3[getStaticPaths]
    
    E --&gt; E1[无服务器 API]
    E --&gt; E2[中间件支持]
    
    F --&gt; F1[Image 优化]
    F --&gt; F2[字体优化]
    F --&gt; F3[脚本优化]</code></pre>

<p><strong>文件系统路由</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pages/
├── index.js          <span class="token comment"># / 根路由</span>
├── about.js          <span class="token comment"># /about</span>
├── blog/
│   ├── index.js      <span class="token comment"># /blog</span>
│   ├── <span class="token punctuation">[</span>slug<span class="token punctuation">]</span>.js     <span class="token comment"># /blog/:slug 动态路由</span>
│   └── categories/
│       └── <span class="token punctuation">[</span>id<span class="token punctuation">]</span>.js   <span class="token comment"># /blog/categories/:id 嵌套路由</span>
└── api/
    └── user.js       <span class="token comment"># /api/user API 路由</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="数据获取策略"><a href="#数据获取策略" class="headerlink" title="数据获取策略"></a>数据获取策略</h3><p><strong>静态生成 (SSG)</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 页面组件</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Blog</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> posts <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ul<span class="token operator">></span>
      <span class="token punctuation">&#123;</span>posts<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">post</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">&#123;</span>post<span class="token punctuation">.</span>id<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">&#123;</span>post<span class="token punctuation">.</span>title<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 构建时获取数据</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getStaticProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/posts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> posts <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> posts <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">revalidate</span><span class="token operator">:</span> <span class="token number">60</span> <span class="token comment">// 启用 ISR，60秒后重新生成</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 动态路由路径生成</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getStaticPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/posts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> posts <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> paths <span class="token operator">=</span> posts<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">post</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">slug</span><span class="token operator">:</span> post<span class="token punctuation">.</span>slug <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    paths<span class="token punctuation">,</span>
    <span class="token literal-property property">fallback</span><span class="token operator">:</span> <span class="token string">'blocking'</span> <span class="token comment">// 处理未预生成的路径</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>服务器端渲染 (SSR)</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">UserProfile</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token punctuation">&#123;</span>user<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span>user<span class="token punctuation">.</span>bio<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 每次请求时获取数据</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getServerSideProps</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> params<span class="token punctuation">,</span> query <span class="token punctuation">&#125;</span> <span class="token operator">=</span> context<span class="token punctuation">;</span>
  
  <span class="token comment">// 基于 cookie 认证</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>authToken<span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://api.example.com/users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>params<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>token<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">redirect</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">destination</span><span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">permanent</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="高级渲染策略"><a href="#高级渲染策略" class="headerlink" title="高级渲染策略"></a>高级渲染策略</h3><p><strong>增量静态再生 (ISR)</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getStaticProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/products'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> products <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> products <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">revalidate</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// 最多每30秒重新生成一次</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getStaticPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">paths</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span> <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">category</span><span class="token operator">:</span> <span class="token string">'electronics'</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">fallback</span><span class="token operator">:</span> <span class="token string">'blocking'</span> <span class="token comment">// 其他类别按需生成</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>按需再验证 (On-demand Revalidation)</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// pages/api/revalidate.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 检查密钥</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>secret <span class="token operator">!==</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">REVALIDATE_SECRET</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'Invalid token'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 重新验证特定路径</span>
    <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">revalidate</span><span class="token punctuation">(</span><span class="token string">'/blog/'</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>slug<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">revalidated</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Error revalidating'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 内容更新后调用</span>
<span class="token comment">// POST /api/revalidate?secret=&lt;token>&amp;slug=new-post</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Next-js-高级特性"><a href="#Next-js-高级特性" class="headerlink" title="Next.js 高级特性"></a>Next.js 高级特性</h3><p><strong>中间件</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// middleware.js</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> NextResponse <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'next/server'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">middleware</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 重定向旧路径</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>nextUrl<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/old-blog'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> NextResponse<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'/blog'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token comment">// 路径重写</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>nextUrl<span class="token punctuation">.</span>pathname <span class="token operator">===</span> <span class="token string">'/dashboard'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> NextResponse<span class="token punctuation">.</span><span class="token function">rewrite</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'/internal-dashboard'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token comment">// 身份验证检查</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'authToken'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span>nextUrl<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/protected'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> NextResponse<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">return</span> NextResponse<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 配置匹配路径</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">matcher</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/dashboard/:path*'</span><span class="token punctuation">,</span> <span class="token string">'/protected/:path*'</span><span class="token punctuation">,</span> <span class="token string">'/old-blog/:path*'</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>图像优化</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> Image <span class="token keyword">from</span> <span class="token string">'next/image'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">ProductImage</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> src<span class="token punctuation">,</span> alt <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Image
      src<span class="token operator">=</span><span class="token punctuation">&#123;</span>src<span class="token punctuation">&#125;</span>
      alt<span class="token operator">=</span><span class="token punctuation">&#123;</span>alt<span class="token punctuation">&#125;</span>
      width<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">800</span><span class="token punctuation">&#125;</span>  <span class="token comment">// 最大显示宽度</span>
      height<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">600</span><span class="token punctuation">&#125;</span> <span class="token comment">// 最大显示高度</span>
      placeholder<span class="token operator">=</span><span class="token string">"blur"</span> <span class="token comment">// 加载占位符</span>
      blurDataURL<span class="token operator">=</span><span class="token string">"data:image/svg+xml;base64,..."</span> <span class="token comment">// 低质量占位图</span>
      quality<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">85</span><span class="token punctuation">&#125;</span> <span class="token comment">// 图像质量 (1-100)</span>
      priority <span class="token comment">// 关键图像优先加载</span>
      sizes<span class="token operator">=</span><span class="token string">"(max-width: 768px) 100vw, 50vw"</span> <span class="token comment">// 响应式尺寸</span>
    <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>API 路由</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// pages/api/user/[id].js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> id <span class="token punctuation">&#125;</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
  
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'GET'</span><span class="token operator">:</span>
      <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">findUnique</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> id <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">'User not found'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">case</span> <span class="token string">'PUT'</span><span class="token operator">:</span>
      <span class="token keyword">const</span> updatedUser <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> id <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> req<span class="token punctuation">.</span>body
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>updatedUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">case</span> <span class="token string">'DELETE'</span><span class="token operator">:</span>
      <span class="token keyword">await</span> db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> id <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">204</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">default</span><span class="token operator">:</span>
      res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Allow'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'PUT'</span><span class="token punctuation">,</span> <span class="token string">'DELETE'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">405</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Method </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>req<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> Not Allowed</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="性能优化实践-1"><a href="#性能优化实践-1" class="headerlink" title="性能优化实践"></a>性能优化实践</h3><p><strong>代码分割与动态导入</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> dynamic <span class="token keyword">from</span> <span class="token string">'next/dynamic'</span><span class="token punctuation">;</span>

<span class="token comment">// 动态加载重组件（禁用 SSR）</span>
<span class="token keyword">const</span> HeavyChart <span class="token operator">=</span> <span class="token function">dynamic</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../components/HeavyChart'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span> <span class="token literal-property property">ssr</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 带加载状态</span>
<span class="token keyword">const</span> MapComponent <span class="token operator">=</span> <span class="token function">dynamic</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../components/Map'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span> 
    <span class="token function-variable function">loading</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>div<span class="token operator">></span>Loading map<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token literal-property property">ssr</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 预加载关键组件</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../components/CriticalComponent'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">module</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 组件已加载</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>字体优化</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// _document.js</span>
<span class="token keyword">import</span> Document<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> Html<span class="token punctuation">,</span> Head <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'next/document'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyDocument</span> <span class="token keyword">extends</span> <span class="token class-name">Document</span> <span class="token punctuation">&#123;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Html<span class="token operator">></span>
        <span class="token operator">&lt;</span>Head<span class="token operator">></span>
          <span class="token operator">&lt;</span>link
            rel<span class="token operator">=</span><span class="token string">"preload"</span>
            href<span class="token operator">=</span><span class="token string">"/fonts/Inter.woff2"</span>
            <span class="token keyword">as</span><span class="token operator">=</span><span class="token string">"font"</span>
            type<span class="token operator">=</span><span class="token string">"font/woff2"</span>
            crossOrigin<span class="token operator">=</span><span class="token string">"anonymous"</span>
          <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Head<span class="token operator">></span>
        <span class="token operator">&lt;</span>body<span class="token operator">></span>
          <span class="token operator">&lt;</span>Main <span class="token operator">/</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>NextScript <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Html<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 全局 CSS 中使用</span>
@font<span class="token operator">-</span>face <span class="token punctuation">&#123;</span>
  font<span class="token operator">-</span>family<span class="token operator">:</span> <span class="token string">'Inter'</span><span class="token punctuation">;</span>
  <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token string">'/fonts/Inter.woff2'</span><span class="token punctuation">)</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'woff2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  font<span class="token operator">-</span>weight<span class="token operator">:</span> <span class="token number">100</span> <span class="token number">900</span><span class="token punctuation">;</span>
  font<span class="token operator">-</span>display<span class="token operator">:</span> swap<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>分析工具集成</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// next.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">experimental</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">instrumentationHook</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// instrumentation.js</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@vercel/analytics'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> inject <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">inject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> init <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@sentry/nextjs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      <span class="token literal-property property">dsn</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SENTRY_DSN</span><span class="token punctuation">,</span>
      <span class="token literal-property property">tracesSampleRate</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="面试高频问题"><a href="#面试高频问题" class="headerlink" title="面试高频问题"></a>面试高频问题</h3><p><strong>Q：SSR 与 CSR 如何选择？</strong></p>
<ul>
<li>选择 SSR 当：<ul>
<li>SEO 是关键需求（内容型网站）</li>
<li>首屏性能至关重要</li>
<li>社交媒体分享需要正确预览</li>
</ul>
</li>
<li>选择 CSR 当：<ul>
<li>应用是认证后使用（后台系统）</li>
<li>高度交互式应用（如 Figma）</li>
<li>对服务器成本敏感</li>
</ul>
</li>
</ul>
<p><strong>Q：getStaticProps vs getServerSideProps</strong></p>
<p>对比：</p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">getStaticProps</th>
<th align="left">getServerSideProps</th>
</tr>
</thead>
<tbody><tr>
<td align="left">运行时机</td>
<td align="left">构建时</td>
<td align="left">每次请求时</td>
</tr>
<tr>
<td align="left">数据新鲜度</td>
<td align="left">静态（可重新验证）</td>
<td align="left">实时动态</td>
</tr>
<tr>
<td align="left">性能</td>
<td align="left">极快（CDN 缓存）</td>
<td align="left">较慢（服务器处理）</td>
</tr>
<tr>
<td align="left">SEO</td>
<td align="left">优</td>
<td align="left">优</td>
</tr>
<tr>
<td align="left">使用场景</td>
<td align="left">博客、产品目录</td>
<td align="left">个性化页面、仪表盘</td>
</tr>
</tbody></table>
<p><strong>Q：如何处理 SSR 中的身份认证？</strong></p>
<p>解决方案：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用 getServerSideProps 传递用户数据</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getServerSideProps</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getSession</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>session<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">redirect</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">destination</span><span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token literal-property property">permanent</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">user</span><span class="token operator">:</span> session<span class="token punctuation">.</span>user <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 客户端使用共享状态</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useSession <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'next-auth/react'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">data</span><span class="token operator">:</span> session <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>session<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>p<span class="token operator">></span>Welcome <span class="token punctuation">&#123;</span>session<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>p<span class="token operator">></span>Please sign <span class="token keyword">in</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Q：如何优化大型 Next.js 应用性能？</strong></p>
<p>优化策略：</p>
<ul>
<li>代码分割：使用动态导入拆分代码</li>
<li>图像优化：使用 Next Image 组件</li>
<li>CDN 缓存：配置静态资源和 ISR 页面缓存</li>
<li>数据库优化：使用缓存层（Redis&#x2F;Memcached）</li>
<li>减少 Bundle 大小：分析并优化依赖</li>
<li>服务端缓存：对 SSR 结果进行短期缓存</li>
<li>边缘计算：使用 Edge Functions 处理请求</li>
</ul>
<h3 id="总结-7"><a href="#总结-7" class="headerlink" title="总结"></a>总结</h3><ul>
<li>SSR 核心价值：<ul>
<li>提升 SEO 和首屏性能</li>
<li>改善社交分享体验</li>
<li>支持低端设备用户</li>
</ul>
</li>
<li>Next.js 核心能力：<ul>
<li>文件系统路由</li>
<li>混合渲染策略（SSG&#x2F;SSR&#x2F;ISR）</li>
<li>内置图像优化</li>
<li>API 路由支持</li>
</ul>
</li>
<li>关键数据获取方法：<ul>
<li>getStaticProps：构建时获取数据</li>
<li>getServerSideProps：请求时获取数据</li>
<li>getStaticPaths：定义动态路由</li>
</ul>
</li>
<li>高级特性：<ul>
<li>中间件：请求处理管道</li>
<li>按需重新验证：内容更新后刷新</li>
<li>分析工具：性能监控</li>
</ul>
</li>
<li>面试重点：<ul>
<li>渲染策略选择依据</li>
<li>身份认证实现方案</li>
<li>性能优化手段</li>
<li>部署架构设计</li>
</ul>
</li>
</ul>
<h1 id="第七章：React-工程化与优化"><a href="#第七章：React-工程化与优化" class="headerlink" title="第七章：React 工程化与优化"></a>第七章：React 工程化与优化</h1><h2 id="7-1-组件设计模式（复合组件、受控组件模式）"><a href="#7-1-组件设计模式（复合组件、受控组件模式）" class="headerlink" title="7.1 组件设计模式（复合组件、受控组件模式）"></a>7.1 组件设计模式（复合组件、受控组件模式）</h2><h2 id="7-2-样式方案（CSS-Modules、Styled-Components、Tailwind-CSS）"><a href="#7-2-样式方案（CSS-Modules、Styled-Components、Tailwind-CSS）" class="headerlink" title="7.2 样式方案（CSS Modules、Styled Components、Tailwind CSS）"></a>7.2 样式方案（CSS Modules、Styled Components、Tailwind CSS）</h2><h2 id="7-3-测试（Jest-React-Testing-Library）"><a href="#7-3-测试（Jest-React-Testing-Library）" class="headerlink" title="7.3 测试（Jest + React Testing Library）"></a>7.3 测试（Jest + React Testing Library）</h2><h2 id="7-4-性能优化（React-Profiler、减少重渲染）"><a href="#7-4-性能优化（React-Profiler、减少重渲染）" class="headerlink" title="7.4 性能优化（React Profiler、减少重渲染）"></a>7.4 性能优化（React Profiler、减少重渲染）</h2><h2 id="7-5-构建工具（Webpack-配置、Vite-优化）"><a href="#7-5-构建工具（Webpack-配置、Vite-优化）" class="headerlink" title="7.5 构建工具（Webpack 配置、Vite 优化）"></a>7.5 构建工具（Webpack 配置、Vite 优化）</h2><h1 id="第八章：React-18-新特性与未来趋势"><a href="#第八章：React-18-新特性与未来趋势" class="headerlink" title="第八章：React 18 新特性与未来趋势"></a>第八章：React 18 新特性与未来趋势</h1><h2 id="8-1-Concurrent-Mode（并发渲染）"><a href="#8-1-Concurrent-Mode（并发渲染）" class="headerlink" title="8.1 Concurrent Mode（并发渲染）"></a>8.1 Concurrent Mode（并发渲染）</h2><h2 id="8-2-自动批处理（Automatic-Batching）"><a href="#8-2-自动批处理（Automatic-Batching）" class="headerlink" title="8.2 自动批处理（Automatic Batching）"></a>8.2 自动批处理（Automatic Batching）</h2><h2 id="8-3-Transition-API（startTransition）"><a href="#8-3-Transition-API（startTransition）" class="headerlink" title="8.3 Transition API（startTransition）"></a>8.3 Transition API（startTransition）</h2><h2 id="8-4-Server-Components（服务端组件）"><a href="#8-4-Server-Components（服务端组件）" class="headerlink" title="8.4 Server Components（服务端组件）"></a>8.4 Server Components（服务端组件）</h2><h2 id="8-5-React-生态趋势（RSC、React-Native）"><a href="#8-5-React-生态趋势（RSC、React-Native）" class="headerlink" title="8.5 React 生态趋势（RSC、React Native）"></a>8.5 React 生态趋势（RSC、React Native）</h2>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/React/" rel="tag"><i class="fa fa-tag"></i> React</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/06/22/CSS%20Study%20Notes/" rel="prev" title="CSS 专题知识学习">
                  <i class="fa fa-angle-left"></i> CSS 专题知识学习
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/06/29/Performance%20Optimization/" rel="next" title="前端性能优化知识专题学习">
                  前端性能优化知识专题学习 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Ariel</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">210k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">12:45</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/tianfei92" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
