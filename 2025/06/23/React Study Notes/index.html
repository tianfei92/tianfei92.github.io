

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Ariel">
  <meta name="keywords" content="">
  
    <meta name="description" content="第一章：React 基础与核心概念1.1 React 简介与设计哲学（组件化、声明式 UI）基础概念概述React 是什么？ Facebook 推出的用于构建用户界面的 JavaScript 库，核心解决 UI 组件化开发问题。 两大设计哲学  组件化 (Component-Based)：将 UI 拆分为独立、可复用的代码单元（组件），每个组件管理自身状态与逻辑。示例：&lt;Button &#x2F;&amp;g">
<meta property="og:type" content="article">
<meta property="og:title" content="React 知识体系专题学习">
<meta property="og:url" content="https://tianfei92.github.io/2025/06/23/React%20Study%20Notes/index.html">
<meta property="og:site_name" content="Ariel&#39;s Blog">
<meta property="og:description" content="第一章：React 基础与核心概念1.1 React 简介与设计哲学（组件化、声明式 UI）基础概念概述React 是什么？ Facebook 推出的用于构建用户界面的 JavaScript 库，核心解决 UI 组件化开发问题。 两大设计哲学  组件化 (Component-Based)：将 UI 拆分为独立、可复用的代码单元（组件），每个组件管理自身状态与逻辑。示例：&lt;Button &#x2F;&amp;g">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-06-23T09:00:36.000Z">
<meta property="article:modified_time" content="2025-07-02T07:32:50.354Z">
<meta property="article:author" content="Ariel">
<meta property="article:tag" content="React">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>React 知识体系专题学习 - Ariel&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"tianfei92.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Ariel</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="React 知识体系专题学习"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-06-23 17:00" pubdate>
          2025年6月23日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          41k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          340 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">React 知识体系专题学习</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="第一章：React-基础与核心概念"><a href="#第一章：React-基础与核心概念" class="headerlink" title="第一章：React 基础与核心概念"></a>第一章：React 基础与核心概念</h1><h2 id="1-1-React-简介与设计哲学（组件化、声明式-UI）"><a href="#1-1-React-简介与设计哲学（组件化、声明式-UI）" class="headerlink" title="1.1 React 简介与设计哲学（组件化、声明式 UI）"></a>1.1 React 简介与设计哲学（组件化、声明式 UI）</h2><h3 id="基础概念概述"><a href="#基础概念概述" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><p><strong>React 是什么？</strong></p>
<p>Facebook 推出的用于构建用户界面的 JavaScript 库，核心解决 UI 组件化开发问题。</p>
<p><strong>两大设计哲学</strong></p>
<ul>
<li>组件化 (Component-Based)：将 UI 拆分为独立、可复用的代码单元（组件），每个组件管理自身状态与逻辑。<em>示例：<code>&lt;Button /&gt;</code>, <code>&lt;Card /&gt;</code> 等</em></li>
<li>声明式 UI (Declarative)：开发者只需描述“UI 应该是什么样子”（What），而非“如何更新到该状态”（How）。<em>对比命令式：直接操作 DOM vs. 返回 JSX 描述结构</em></li>
</ul>
<span id="more"></span>

<h3 id="深入原理与面试考点"><a href="#深入原理与面试考点" class="headerlink" title="深入原理与面试考点"></a>深入原理与面试考点</h3><p><strong>组件化背后的核心思想</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">说明</th>
<th align="left">面试举例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">封装性</td>
<td align="left">组件内部状态&#x2F;逻辑对外隐藏，仅通过 Props 通信</td>
<td align="left">“为何 React 推荐单向数据流？”</td>
</tr>
<tr>
<td align="left">组合性</td>
<td align="left">通过嵌套组件构建复杂 UI（如 <code>&lt;Form&gt;&lt;Input/&gt;&lt;Button/&gt;&lt;/Form&gt;</code>）</td>
<td align="left">“如何设计可复用的高阶组件？”</td>
</tr>
<tr>
<td align="left">复用性</td>
<td align="left">同一组件在不同场景重复使用</td>
<td align="left">“受控组件与非受控组件适用场景差异？”</td>
</tr>
</tbody></table>
<p><strong>声明式 UI 的底层实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 声明式写法（What）</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-comment">// 对应的命令式逻辑（How）</span><br><span class="hljs-keyword">const</span> button = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;button&#x27;</span>);<br><span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;<br>button.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  count++;<br>  button.<span class="hljs-property">textContent</span> = count; <span class="hljs-comment">// 需手动更新 DOM</span><br>&#125;);<br></code></pre></td></tr></table></figure>

<p>关键优势：</p>
<ul>
<li>避免直接操作 DOM → 减少代码复杂度与潜在 Bug</li>
<li>与状态绑定 → UI 自动随状态更新（通过 Virtual DOM 协调）</li>
</ul>
<p><strong>虚拟 DOM (Virtual DOM) 的角色</strong></p>
<pre class="mermaid">graph LR
A[组件状态变化] --> B{生成新 Virtual DOM}
B --> C[对比新旧 Virtual DOM]
C --> D[计算最小 DOM 变更]
D --> E[批量更新真实 DOM]</pre>

<p>设计哲学关联：声明式 UI 依赖 Virtual DOM 实现高效的 “状态到 UI 的映射”，开发者无需关注更新过程。</p>
<h3 id="面试话术技巧"><a href="#面试话术技巧" class="headerlink" title="面试话术技巧"></a>面试话术技巧</h3><p><strong>Q：为什么 React 采用声明式而非命令式？</strong></p>
<p>声明式让代码更专注于业务逻辑的描述（What），将底层 DOM 操作交给 React 的 Virtual DOM 协调机制处理。这带来三方面优势：</p>
<ol>
<li>可维护性：状态变化自动触发 UI 更新，避免手动 DOM 操作导致的逻辑分散</li>
<li>性能优化：React 通过 Diff 算法批量 DOM 更新，减少重绘开销</li>
<li>开发体验：更接近自然思维模式的 UI 构建方式，提升开发效率”</li>
</ol>
<h3 id="延伸考点"><a href="#延伸考点" class="headerlink" title="延伸考点"></a>延伸考点</h3><ul>
<li>JSX 的本质：声明式 UI 的语法糖（编译为 React.createElement()）</li>
<li>组件化与设计模式：复合组件 (Compound Components)、容器&#x2F;展示组件等</li>
</ul>
<h2 id="1-2-JSX-语法与渲染逻辑（表达式、条件渲染、列表渲染）"><a href="#1-2-JSX-语法与渲染逻辑（表达式、条件渲染、列表渲染）" class="headerlink" title="1.2 JSX 语法与渲染逻辑（表达式、条件渲染、列表渲染）"></a>1.2 JSX 语法与渲染逻辑（表达式、条件渲染、列表渲染）</h2><h3 id="基础概念简述"><a href="#基础概念简述" class="headerlink" title="基础概念简述"></a>基础概念简述</h3><p><strong>JSX 是什么？</strong></p>
<p>JavaScript 语法扩展，允许在 JavaScript 中编写类似 HTML 的结构（语法糖）</p>
<p><strong>三大核心功能</strong></p>
<ul>
<li>表达式嵌入：{ } 包裹任意 JavaScript 表达式</li>
<li>条件渲染：三元运算符 ? : 或 &amp;&amp; 短路运算</li>
<li>列表渲染：map() + key 属性生成元素列表</li>
</ul>
<h3 id="核心机制与深度原理"><a href="#核心机制与深度原理" class="headerlink" title="核心机制与深度原理"></a>核心机制与深度原理</h3><p><strong>JSX 编译原理（Babel 转换过程）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 原始 JSX</span><br><span class="hljs-keyword">const</span> element = <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span>Hello &#123;name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br><br><span class="hljs-comment">// Babel 编译后（React 17+ 无需显式引入 React）</span><br><span class="hljs-keyword">import</span> &#123; jsx <span class="hljs-keyword">as</span> _jsx &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react/jsx-runtime&quot;</span>;<br><span class="hljs-keyword">const</span> element = <span class="hljs-title function_">_jsx</span>(<span class="hljs-string">&quot;div&quot;</span>, &#123;<br>  <span class="hljs-attr">className</span>: <span class="hljs-string">&quot;container&quot;</span>,<br>  <span class="hljs-attr">children</span>: [<span class="hljs-string">&quot;Hello &quot;</span>, name]<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>关键点：</p>
<ul>
<li>JSX 本质是 React.createElement(type, props, children) 的语法糖</li>
<li>每个 JSX 元素会被编译为 虚拟 DOM 对象（包含 type, props, key 等属性）</li>
</ul>
<p><strong>表达式嵌入的运行时机制</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Welcome</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-comment">// 表达式执行发生在组件 render 阶段</span><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>当前用户: &#123;props.user ?? &#x27;游客&#x27;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>注意事项：</p>
<ul>
<li>表达式内不能使用语句（如 if&#x2F;for）</li>
<li>表达式结果类型自动转换：<ul>
<li>undefined&#x2F;null&#x2F;true&#x2F;false → 不渲染</li>
<li>数组 → 展开渲染（需包含有效元素）</li>
<li>对象 → 抛出错误（除特殊对象如 ReactElement）</li>
</ul>
</li>
</ul>
<p><strong>条件渲染的底层实现策略</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 方案1：三元表达式（适合简单分支）</span><br>&#123; isLoggedIn ? <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">LogoutButton</span> /&gt;</span></span> : <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">LoginButton</span> /&gt;</span></span> &#125;<br><br><span class="hljs-comment">// 方案2：&amp;&amp; 短路（适合单分支）</span><br>&#123; hasUnread &amp;&amp; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Badge</span> <span class="hljs-attr">count</span>=<span class="hljs-string">&#123;unreadCount&#125;</span> /&gt;</span></span> &#125;<br><br><span class="hljs-comment">// 方案3：立即执行函数（复杂逻辑 - 不推荐）</span><br>&#123; (<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (conditionA) <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ComponentA</span> /&gt;</span></span>;<br>    <span class="hljs-keyword">if</span> (conditionB) <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ComponentB</span> /&gt;</span></span>;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Fallback</span> /&gt;</span></span>;<br>  &#125;)() <br>&#125;<br></code></pre></td></tr></table></figure>

<p>性能优化：条件变化时，React 通过 Diff 算法 复用相同子组件（按组件位置比对）</p>
<p><strong>列表渲染的 key 机制</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> todoItems = todos.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;todo.id&#125;</span>&gt;</span>  // ⭐ 关键点：key 必须是稳定唯一标识</span><br><span class="language-xml">    &#123;todo.text&#125;</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br>));<br></code></pre></td></tr></table></figure>

<p>无 key 的隐患：</p>
<ul>
<li>列表顺序变化时引发组件状态错乱（如输入框内容错位）</li>
<li>性能下降：全量比对子元素（时间复杂度 O(n²)）</li>
</ul>
<h3 id="高频面试题与破解技巧"><a href="#高频面试题与破解技巧" class="headerlink" title="高频面试题与破解技巧"></a>高频面试题与破解技巧</h3><p><strong>Q：为什么 JSX 中 <code>&#123;boolean &amp;&amp; &lt;Component/&gt;&#125;</code> 可能渲染 0？</strong></p>
<p>true &amp;&amp; jsx 返回 jsx，但 false &amp;&amp; jsx 返回 false → React 将 false 渲染为空白占位符（类似 null），导致 DOM 中出现空文本节点。</p>
<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 转换为 null 避免空节点</span><br>&#123; shouldRender &amp;&amp; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Component</span> /&gt;</span></span> || <span class="hljs-literal">null</span> &#125;<br></code></pre></td></tr></table></figure>

<p><strong>Q：列表渲染为什么不能用 index 作为 key？</strong></p>
<p>当列表发生增删或排序时：</p>
<ul>
<li>index 变化导致组件被意外销毁重建（状态丢失）</li>
<li>Diff 算法无法准确定位节点变化</li>
<li>正确做法：使用数据唯一 ID（如 todo.id）</li>
</ul>
<p><strong>Q：JSX 如何防止 XSS 攻击？</strong></p>
<p>JSX 在执行表达式插入时自动进行转义处理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> title = <span class="hljs-string">&#x27;&lt;script&gt;alert(1)&lt;/script&gt;&#x27;</span>;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;title&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span> <br><span class="hljs-comment">// 渲染为：&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;</span><br></code></pre></td></tr></table></figure>

<p>例外：dangerouslySetInnerHTML 需手动防范</p>
<h2 id="1-3-组件基础（函数组件-vs-类组件）"><a href="#1-3-组件基础（函数组件-vs-类组件）" class="headerlink" title="1.3 组件基础（函数组件 vs. 类组件）"></a>1.3 组件基础（函数组件 vs. 类组件）</h2><h3 id="基础概念概述-1"><a href="#基础概念概述-1" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">函数组件</th>
<th align="left">类组件</th>
</tr>
</thead>
<tbody><tr>
<td align="left">定义方式</td>
<td align="left">JavaScript 函数</td>
<td align="left">ES6 class 继承 React.Component</td>
</tr>
<tr>
<td align="left">状态管理</td>
<td align="left">useState Hook (React 16.8+)</td>
<td align="left">this.state + setState</td>
</tr>
<tr>
<td align="left">生命周期</td>
<td align="left">useEffect Hook</td>
<td align="left">生命周期方法（componentDidMount等）</td>
</tr>
<tr>
<td align="left">代码量</td>
<td align="left">更简洁</td>
<td align="left">相对冗长</td>
</tr>
<tr>
<td align="left">推荐场景</td>
<td align="left">现代 React 开发首选</td>
<td align="left">遗留项目或需要 Error Boundaries 时</td>
</tr>
</tbody></table>
<h3 id="核心机制与差异深度解析"><a href="#核心机制与差异深度解析" class="headerlink" title="核心机制与差异深度解析"></a>核心机制与差异深度解析</h3><p><strong>渲染逻辑本质区别</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 函数组件：纯函数执行</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Welcome</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, &#123;props.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-comment">// 类组件：实例化后调用 render 方法</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Welcome</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, &#123;this.props.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>关键差异：</p>
<ul>
<li>函数组件：直接返回 JSX，每次渲染都是独立函数调用</li>
<li>类组件：通过 实例化 → 调用 render() 返回 JSX，实例在更新间保持</li>
</ul>
<p><strong>状态管理的底层实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 函数组件：闭包存储状态（Hook 链表结构）</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>); <br>  <span class="hljs-comment">// React 内部通过顺序索引关联状态</span><br>&#125;<br><br><span class="hljs-comment">// 类组件：实例属性存储状态</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  state = &#123; <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> &#125;;<br>  <br>  increment = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; <span class="hljs-attr">count</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>状态更新差异：</p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">函数组件</th>
<th align="left">类组件</th>
</tr>
</thead>
<tbody><tr>
<td align="left">更新机制</td>
<td align="left">闭包捕获当次渲染状态</td>
<td align="left">始终读取最新 this.state</td>
</tr>
<tr>
<td align="left">批处理</td>
<td align="left">自动批处理（React 18+）</td>
<td align="left">需 unstable_batchedUpdates</td>
</tr>
<tr>
<td align="left">异步性</td>
<td align="left">状态更新队列</td>
<td align="left">setState 合并更新</td>
</tr>
</tbody></table>
<p><strong>生命周期映射关系</strong></p>
<pre class="mermaid">graph TD
  A[类组件生命周期] --> B[componentDidMount]
  A --> C[componentDidUpdate]
  A --> D[componentWillUnmount]
  
  E[函数组件等效实现] --> F["useEffect(() => {}, [])"]
  E --> G["useEffect(() => {}, [deps])"]
  E --> H["useEffect(() => { return () => {} }, [])"]
  
  B -->|挂载后执行| F
  C -->|依赖更新后执行| G
  D -->|卸载前清理| H</pre>

<p>关键差异点：</p>
<ul>
<li>类组件：生命周期方法分散定义，逻辑易割裂，componentDidMount&#x2F;Update 在 浏览器绘制后 执行</li>
<li>函数组件：useEffect 集中处理副作用，通过依赖数组控制执行时机，useEffect 在 浏览器绘制前 异步执行（使用 useLayoutEffect 可模拟同步行为）</li>
</ul>
<h3 id="高频面试题与破解技巧-1"><a href="#高频面试题与破解技巧-1" class="headerlink" title="高频面试题与破解技巧"></a>高频面试题与破解技巧</h3><p><strong>Q：为什么函数组件取代了类组件成为主流？</strong></p>
<ul>
<li>代码简洁性：减少约 30% 代码量（无 class&#x2F;this&#x2F;constructor）</li>
<li>逻辑复用优势：自定义 Hook 比 HOC&#x2F;Render Props 更直观</li>
<li>性能优化：避免类组件实例化开销，Hook 依赖数组精准控制更新</li>
<li>未来兼容：React 新特性（Concurrent Features）优先支持函数组件</li>
</ul>
<p><strong>Q：函数组件如何实现类似 forceUpdate 的功能？</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> [_, forceUpdate] = <span class="hljs-title function_">useReducer</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br><br><span class="hljs-comment">// 调用 forceUpdate() 触发重渲染</span><br></code></pre></td></tr></table></figure>

<p>原理：通过修改无关状态强制触发更新</p>
<p><strong>Q：类组件中 setState 是同步还是异步？</strong></p>
<ul>
<li>React 17 及之前：合成事件&#x2F;生命周期中异步，setTimeout 中同步</li>
<li>React 18+：默认全部异步（自动批处理）</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 获取更新后状态的正确方式</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; <span class="hljs-attr">count</span>: <span class="hljs-number">42</span> &#125;, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;更新后：&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">count</span>); <span class="hljs-comment">// 回调函数保证</span><br>&#125;);<br></code></pre></td></tr></table></figure>

<h2 id="1-4-Props-与-State（数据流、单向数据绑定）"><a href="#1-4-Props-与-State（数据流、单向数据绑定）" class="headerlink" title="1.4 Props 与 State（数据流、单向数据绑定）"></a>1.4 Props 与 State（数据流、单向数据绑定）</h2><h3 id="基础概念对比表"><a href="#基础概念对比表" class="headerlink" title="基础概念对比表"></a>基础概念对比表</h3><table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">Props</th>
<th align="left">State</th>
</tr>
</thead>
<tbody><tr>
<td align="left">定义</td>
<td align="left">组件外部传入的数据</td>
<td align="left">组件内部管理的状态</td>
</tr>
<tr>
<td align="left">可变性</td>
<td align="left">只读（Immutable）</td>
<td align="left">可修改（通过 setState&#x2F;useState）</td>
</tr>
<tr>
<td align="left">数据源</td>
<td align="left">父组件传递</td>
<td align="left">组件自身创建</td>
</tr>
<tr>
<td align="left">更新触发</td>
<td align="left">父组件重渲染</td>
<td align="left">调用状态更新函数</td>
</tr>
<tr>
<td align="left">通信方向</td>
<td align="left">父 → 子</td>
<td align="left">组件内部</td>
</tr>
</tbody></table>
<h3 id="核心机制深度解析"><a href="#核心机制深度解析" class="headerlink" title="核心机制深度解析"></a>核心机制深度解析</h3><p><strong>单向数据流（Unidirectional Data Flow）</strong></p>
<pre class="mermaid">graph LR
A[父组件] -- Props --> B[子组件1]
A -- Props --> C[子组件2]
B -- Props --> D[孙子组件]
C -- Props --> E[孙子组件]</pre>

<p>核心规则：</p>
<ul>
<li>数据只能从父组件流向子组件，禁止反向流动</li>
<li>子组件修改父组件数据需通过回调函数实现：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 父组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [value, setValue] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;value&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;setValue&#125;</span> /&gt;</span></span>;<br>&#125;<br><br><span class="hljs-comment">// 子组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params">&#123; value, onChange &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;value&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> onChange(e.target.value)&#125; /&gt;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Props 的不可变性（Immutability）</strong></p>
<p>底层原理：</p>
<ul>
<li>React 使用 Object.is 算法进行 props 浅比较（shallow compare）</li>
<li>若检测到 props 引用变化，则触发子组件重渲染</li>
</ul>
<p>开发约束：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 禁止直接修改 props</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserCard</span>(<span class="hljs-params">&#123; user &#125;</span>) &#123;<br>  user.<span class="hljs-property">name</span> = <span class="hljs-string">&quot;Hacked&quot;</span>;  <span class="hljs-comment">// 违反不可变性原则</span><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;user.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-comment">// 正确做法：使用派生数据</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserCard</span>(<span class="hljs-params">&#123; user &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> displayName = user.<span class="hljs-property">name</span>.<span class="hljs-title function_">toUpperCase</span>();  <span class="hljs-comment">// 创建新值</span><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;displayName&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>State 更新机制</strong></p>
<p>(1) 类组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  state = &#123; <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> &#125;;<br>  <br>  increment = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 批量更新：多次 setState 合并为一次更新</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; <span class="hljs-attr">count</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> &#125;);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; <span class="hljs-attr">count</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> &#125;);<br>    <span class="hljs-comment">// 结果：count 只 +1（使用对象形式）</span><br>    <br>    <span class="hljs-comment">// 函数形式解决连续更新</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> (&#123; <span class="hljs-attr">count</span>: prev.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> &#125;));<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> (&#123; <span class="hljs-attr">count</span>: prev.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> &#125;));<br>    <span class="hljs-comment">// 结果：count +2</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) 函数组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">increment</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);  <span class="hljs-comment">// 闭包捕获当前 count 值</span><br>    <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);  <span class="hljs-comment">// 仍基于初始值计算</span><br>    <br>    <span class="hljs-comment">// 函数形式获取最新值</span><br>    <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>);<br>    <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>); <span class="hljs-comment">// 正确 +2</span><br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="高频面试题与破解方案"><a href="#高频面试题与破解方案" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么React强调Props不可变？</strong></p>
<ul>
<li>可预测性：确保组件行为只取决于输入的props，便于调试</li>
<li>性能优化：浅比较依赖引用不变性（若直接修改，浅比较无法检测变化）</li>
<li>并发安全：避免数据在渲染过程中被意外修改</li>
</ul>
<p><strong>Q：如何实现子组件向父组件通信？</strong></p>
<p>设计模式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 父组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <br>  <span class="hljs-comment">// 回调函数作为prop传递</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChildSubmit</span> = (<span class="hljs-params">childData</span>) =&gt; &#123;<br>    <span class="hljs-title function_">setData</span>(childData);<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">&#123;handleChildSubmit&#125;</span> /&gt;</span></span>;<br>&#125;<br><br><span class="hljs-comment">// 子组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params">&#123; onSubmit &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [input, setInput] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;input&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setInput(e.target.value)&#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> onSubmit(input)&#125;&gt;提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Q：什么时候该用Props vs State？</strong></p>
<p>决策过程：</p>
<pre class="mermaid">graph TD
A[数据来源] -->|父组件传递| B[用Props]
A -->|组件自身管理| C[用State]
D[是否随时间/交互变化] -->|否| E[用Props]
D -->|是| F[用State]</pre>

<h3 id="高级应用场景"><a href="#高级应用场景" class="headerlink" title="高级应用场景"></a>高级应用场景</h3><p><strong>状态提升（Lifting State Up）</strong></p>
<p>场景：多个组件需要共享同一状态</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// 状态提升到共同父组件</span><br>  <span class="hljs-keyword">const</span> [theme, setTheme] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;light&#x27;</span>);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Toolbar</span> <span class="hljs-attr">theme</span>=<span class="hljs-string">&#123;theme&#125;</span> <span class="hljs-attr">onThemeChange</span>=<span class="hljs-string">&#123;setTheme&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ContentArea</span> <span class="hljs-attr">theme</span>=<span class="hljs-string">&#123;theme&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 子组件通过props获取/更新状态</span><br></code></pre></td></tr></table></figure>

<h3 id="性能优化陷阱"><a href="#性能优化陷阱" class="headerlink" title="性能优化陷阱"></a>性能优化陷阱</h3><p><strong>Props 穿透问题</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 不必要重渲染：直接传递对象</span><br>&lt;<span class="hljs-title class_">Child</span> user=&#123;user&#125; /&gt;<br><br><span class="hljs-comment">// ✅ 解决方案：扁平化props或React.memo</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#123;user.name&#125;</span> <span class="hljs-attr">age</span>=<span class="hljs-string">&#123;user.age&#125;</span> /&gt;</span></span><br></code></pre></td></tr></table></figure>

<p><strong>状态位置错误导致的渲染风暴</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 状态放在过高层级</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [counter, setCounter] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// 任何更新触发全应用重渲染</span><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Page</span> /&gt;</span></span>;<br>&#125;<br><br><span class="hljs-comment">// ✅ 状态下沉到最小范围</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">CounterButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// 影响范围局部化</span><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setCount(c+1)&#125;&gt;&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="1-5-事件处理（合成事件、this-绑定问题）"><a href="#1-5-事件处理（合成事件、this-绑定问题）" class="headerlink" title="1.5 事件处理（合成事件、this 绑定问题）"></a>1.5 事件处理（合成事件、this 绑定问题）</h2><h3 id="基础概念概述-2"><a href="#基础概念概述-2" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><p>React 事件处理特点：</p>
<ul>
<li>驼峰命名：onClick 而非 onclick</li>
<li>JSX 中传入函数引用而非字符串</li>
<li>默认阻止默认行为需显式调用 e.preventDefault()</li>
</ul>
<p>两大核心问题：</p>
<ul>
<li>合成事件（SyntheticEvent）机制</li>
<li>类组件中的 this 绑定问题</li>
</ul>
<h3 id="合成事件（SyntheticEvent）深度解析"><a href="#合成事件（SyntheticEvent）深度解析" class="headerlink" title="合成事件（SyntheticEvent）深度解析"></a>合成事件（SyntheticEvent）深度解析</h3><p><strong>设计目的与原理</strong></p>
<pre class="mermaid">graph LR
A[浏览器原生事件] --> B(React事件系统)
B --> C[创建合成事件对象]
C --> D[事件委托到根容器]
D --> E[触发对应组件处理函数]
E --> F[事件池回收]</pre>

<p>核心特性：</p>
<ul>
<li>跨浏览器兼容：统一不同浏览器事件接口</li>
<li>性能优化：事件委托 + 事件池复用（React 17 前）</li>
<li>冒泡机制：基于虚拟DOM树而非实际DOM树</li>
</ul>
<p><strong>事件池机制（React 17 前）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params">e</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">target</span>); <span class="hljs-comment">// 正常访问</span><br>  <br>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">target</span>); <span class="hljs-comment">// ❌ React 17前：null（事件对象已被回收）</span><br>  &#125;, <span class="hljs-number">0</span>);<br>  <br>  <span class="hljs-comment">// ✅ 解决方案：e.persist() 保留事件对象</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>React 17+ 改进：移除了事件池，无需 e.persist()</p>
<p><strong>合成事件与原生事件差异</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">合成事件</th>
<th align="left">原生事件</th>
</tr>
</thead>
<tbody><tr>
<td align="left">事件注册</td>
<td align="left">onClick</td>
<td align="left">addEventListener</td>
</tr>
<tr>
<td align="left">事件对象</td>
<td align="left">SyntheticEvent</td>
<td align="left">原生 Event 对象</td>
</tr>
<tr>
<td align="left">事件传播</td>
<td align="left">虚拟DOM树冒泡</td>
<td align="left">实际DOM树冒泡</td>
</tr>
<tr>
<td align="left">阻止冒泡</td>
<td align="left">e.stopPropagation()</td>
<td align="left">同名API</td>
</tr>
<tr>
<td align="left">事件委托</td>
<td align="left">自动委托到根容器</td>
<td align="left">需手动委托</td>
</tr>
</tbody></table>
<h3 id="this-绑定问题详解（类组件）"><a href="#this-绑定问题详解（类组件）" class="headerlink" title="this 绑定问题详解（类组件）"></a>this 绑定问题详解（类组件）</h3><p><strong>问题根源</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Button</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// ❌ 此时 this 为 undefined（严格模式）</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>); <br>  &#125;<br>  <br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;this.handleClick&#125;</span>&gt;</span>点击<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>原因：JavaScript 函数中的 this 由调用方式决定，非类实例本身</p>
<p><strong>四种解决方案对比</strong></p>
<table>
<thead>
<tr>
<th align="left">方案</th>
<th align="left">代码示例</th>
<th align="left">优点</th>
<th align="left">缺点</th>
</tr>
</thead>
<tbody><tr>
<td align="left">构造函数绑定</td>
<td align="left">this.handleClick &#x3D; this.handleClick.bind(this)</td>
<td align="left">标准做法</td>
<td align="left">代码冗余</td>
</tr>
<tr>
<td align="left">箭头函数（类属性）</td>
<td align="left">handleClick &#x3D; () &#x3D;&gt; {…}</td>
<td align="left">简洁，推荐方案</td>
<td align="left">实验性语法（需Babel）</td>
</tr>
<tr>
<td align="left">内联箭头函数</td>
<td align="left">onClick&#x3D;{() &#x3D;&gt; this.handleClick()}</td>
<td align="left">简单直接</td>
<td align="left">每次渲染创建新函数</td>
</tr>
<tr>
<td align="left">bind 内联</td>
<td align="left">onClick&#x3D;{this.handleClick.bind(this)}</td>
<td align="left">无额外代码</td>
<td align="left">同内联箭头函数</td>
</tr>
</tbody></table>
<p><strong>性能优化关键点</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 避免内联绑定（每次渲染创建新函数）</span><br>&lt;button onClick=&#123;<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleClick</span>(id)&#125;&gt;点击&lt;/button&gt;<br><br><span class="hljs-comment">// ✅ 推荐：构造函数预绑定</span><br><span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleClick</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleClick</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);<br>&#125;<br><br><span class="hljs-comment">// ✅ 或使用类属性箭头函数</span><br>handleClick = <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> &#123; ... &#125;<br></code></pre></td></tr></table></figure>

<h3 id="高频面试题与解决方案"><a href="#高频面试题与解决方案" class="headerlink" title="高频面试题与解决方案"></a>高频面试题与解决方案</h3><p><strong>Q：为什么React不直接使用原生事件？</strong></p>
<ul>
<li>跨浏览器兼容：统一事件处理逻辑</li>
<li>性能优化：事件委托减少内存占用</li>
<li>事件池机制：复用事件对象（React 17前）</li>
<li>框架扩展性：为异步渲染等特性铺平道路</li>
</ul>
<p><strong>Q：如何阻止合成事件的默认行为？</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = (<span class="hljs-params">e</span>) =&gt; &#123;<br>    e.<span class="hljs-title function_">preventDefault</span>(); <span class="hljs-comment">// ✅ 显式阻止表单提交</span><br>    <span class="hljs-comment">// 处理逻辑...</span><br>  &#125;;<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">&#123;handleSubmit&#125;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Q：合成事件和原生事件混用时要注意什么？</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleDocumentClick</span>);<br>&#125;<br><br>handleDocumentClick = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 原生事件</span><br>&#125;;<br><br>handleButtonClick = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 合成事件</span><br>  e.<span class="hljs-title function_">stopPropagation</span>(); <span class="hljs-comment">// ❌ 无法阻止原生事件冒泡</span><br>&#125;;<br><br><span class="hljs-comment">// ✅ 正确方案：在原生事件中使用 nativeEvent</span><br>handleButtonClick = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>  e.<span class="hljs-property">nativeEvent</span>.<span class="hljs-title function_">stopImmediatePropagation</span>();<br>&#125;;<br></code></pre></td></tr></table></figure>

<h3 id="React-17-事件系统升级"><a href="#React-17-事件系统升级" class="headerlink" title="React 17+ 事件系统升级"></a>React 17+ 事件系统升级</h3><ul>
<li>委托目标变更：从 document 到 ReactDOM.render 的根容器</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// React 16：委托到 document</span><br><span class="hljs-comment">// React 17+：委托到 root DOM 容器</span><br><span class="hljs-keyword">const</span> root = <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>));<br>root.<span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>);<br></code></pre></td></tr></table></figure>

<ul>
<li>移除事件池：无需 e.persist() 可异步访问事件对象</li>
<li>更接近原生：e.stopPropagation() 真正阻止原生事件传播</li>
</ul>
<h1 id="第二章：React-核心机制"><a href="#第二章：React-核心机制" class="headerlink" title="第二章：React 核心机制"></a>第二章：React 核心机制</h1><h2 id="2-1-虚拟-DOM-与-Diff-算法（Reconciliation）"><a href="#2-1-虚拟-DOM-与-Diff-算法（Reconciliation）" class="headerlink" title="2.1 虚拟 DOM 与 Diff 算法（Reconciliation）"></a>2.1 虚拟 DOM 与 Diff 算法（Reconciliation）</h2><h3 id="基础概念概述-3"><a href="#基础概念概述-3" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><ul>
<li>虚拟 DOM (Virtual DOM)：<ul>
<li>JavaScript 对象表示的 DOM 副本</li>
<li>轻量化的内存数据结构</li>
<li>与实际 DOM 结构一一对应</li>
</ul>
</li>
<li>Diff 算法 (Reconciliation)：<ul>
<li>React 比较新旧虚拟 DOM 差异的算法</li>
<li>时间复杂度优化到 O(n)</li>
<li>生成最小化 DOM 操作指令</li>
</ul>
</li>
</ul>
<h3 id="虚拟-DOM-核心原理"><a href="#虚拟-DOM-核心原理" class="headerlink" title="虚拟 DOM 核心原理"></a>虚拟 DOM 核心原理</h3><p><strong>虚拟 DOM 结构示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 实际 JSX</span><br>&lt;div className=<span class="hljs-string">&quot;container&quot;</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span>Hello React<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">List</span> <span class="hljs-attr">items</span>=<span class="hljs-string">&#123;items&#125;</span> /&gt;</span></span><br>&lt;/div&gt;<br><br><span class="hljs-comment">// 对应的虚拟 DOM 对象</span><br>&#123;<br>  <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;div&#x27;</span>,<br>  <span class="hljs-attr">props</span>: &#123; <span class="hljs-attr">className</span>: <span class="hljs-string">&#x27;container&#x27;</span> &#125;,<br>  <span class="hljs-attr">children</span>: [<br>    &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;h1&#x27;</span>,<br>      <span class="hljs-attr">props</span>: &#123; <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;title&#x27;</span> &#125;,<br>      <span class="hljs-attr">children</span>: <span class="hljs-string">&#x27;Hello React&#x27;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-title class_">List</span>,  <span class="hljs-comment">// 组件类型</span><br>      <span class="hljs-attr">props</span>: &#123; items &#125;,<br>      <span class="hljs-comment">// ... 内部有独立虚拟 DOM 树</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>虚拟 DOM 工作流程</strong></p>
<pre class="mermaid">graph LR
A[组件状态变化] --> B[创建新虚拟 DOM 树]
B --> C[Diff 算法比较新旧树]
C --> D[生成 DOM 补丁包]
D --> E[批量更新真实 DOM]</pre>

<p><strong>虚拟 DOM 性能优势</strong></p>
<table>
<thead>
<tr>
<th align="left">操作</th>
<th align="left">直接操作 DOM</th>
<th align="left">虚拟 DOM 方案</th>
</tr>
</thead>
<tbody><tr>
<td align="left">更新 10 节点</td>
<td align="left">10 次 DOM 操作</td>
<td align="left">1 次 Diff + 1 次更新</td>
</tr>
<tr>
<td align="left">跨平台能力</td>
<td align="left">依赖浏览器 API</td>
<td align="left">抽象渲染层</td>
</tr>
<tr>
<td align="left">复杂更新</td>
<td align="left">手动优化难度大</td>
<td align="left">自动批量处理</td>
</tr>
</tbody></table>
<h3 id="Diff-算法深度解析（O-n-优化策略）"><a href="#Diff-算法深度解析（O-n-优化策略）" class="headerlink" title="Diff 算法深度解析（O(n) 优化策略）"></a>Diff 算法深度解析（O(n) 优化策略）</h3><p><strong>算法三大设计原则</strong></p>
<p>(1) 同级比较：只比较同一层级的节点，不跨级比较</p>
<pre class="mermaid">graph TD
A[旧树] --> B[节点A]
A --> C[节点B]
D[新树] --> E[节点A']
D --> F[节点B']
B -->|比较| E
C -->|比较| F</pre>

<p>(2) 类型差异直接替换：节点类型不同时直接卸载整棵子树</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 旧：&lt;div&gt;&lt;ComponentA /&gt;&lt;/div&gt;</span><br><span class="hljs-comment">// 新：&lt;span&gt;&lt;ComponentB /&gt;&lt;/span&gt;</span><br><span class="hljs-comment">// React 操作：卸载整个 div 及子组件，创建 span 和 ComponentB</span><br></code></pre></td></tr></table></figure>

<p>(3) Key 属性优化列表：列表项使用 key 标识身份，减少节点移动开销</p>
<p><strong>列表 Diff 的 key 机制</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 旧列表</span><br>&lt;ul&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;a&quot;</span>&gt;</span>A<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;b&quot;</span>&gt;</span>B<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;c&quot;</span>&gt;</span>C<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br>&lt;/ul&gt;<br><br><span class="hljs-comment">// 新列表（删除B，新增D）</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;a&quot;</span>&gt;</span>A<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;c&quot;</span>&gt;</span>C<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;d&quot;</span>&gt;</span>D<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>Diff 过程：</p>
<ul>
<li>通过 key 匹配新旧节点：a→a, c→c</li>
<li>删除 key&#x3D;”b” 的节点</li>
<li>新增 key&#x3D;”d” 的节点</li>
<li>复用 key&#x3D;”a” 和 “c” 的节点</li>
</ul>
<p><strong>节点复用策略</strong></p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">操作</th>
<th align="left">性能影响</th>
</tr>
</thead>
<tbody><tr>
<td align="left">相同类型 DOM 元素</td>
<td align="left">更新属性</td>
<td align="left">高效</td>
</tr>
<tr>
<td align="left">相同类型组件元素</td>
<td align="left">触发更新（不卸载）</td>
<td align="left">保留组件状态</td>
</tr>
<tr>
<td align="left">不同类型元素</td>
<td align="left">卸载整棵子树</td>
<td align="left">成本较高</td>
</tr>
</tbody></table>
<h3 id="React-Fiber-架构与可中断渲染"><a href="#React-Fiber-架构与可中断渲染" class="headerlink" title="React Fiber 架构与可中断渲染"></a>React Fiber 架构与可中断渲染</h3><p><strong>传统 Diff 算法局限</strong></p>
<ul>
<li>递归遍历：无法中断长时间任务</li>
<li>阻塞主线程：导致动画卡顿</li>
</ul>
<p><strong>Fiber 架构核心改进</strong></p>
<pre class="mermaid">graph LR
A[同步递归] --> B[可中断异步任务]
C[虚拟DOM树] --> D[Fiber链表结构]</pre>

<p>Fiber 节点结构：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">&#123;<br>  <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;div&#x27;</span>,          <span class="hljs-comment">// 节点类型</span><br>  <span class="hljs-attr">key</span>: <span class="hljs-literal">null</span>,            <span class="hljs-comment">// 唯一标识</span><br>  <span class="hljs-attr">return</span>: parentFiber,  <span class="hljs-comment">// 父节点</span><br>  <span class="hljs-attr">child</span>: firstChild,    <span class="hljs-comment">// 第一个子节点</span><br>  <span class="hljs-attr">sibling</span>: nextSibling, <span class="hljs-comment">// 兄弟节点</span><br>  <span class="hljs-attr">alternate</span>: oldFiber,  <span class="hljs-comment">// 指向旧树对应节点</span><br>  <span class="hljs-attr">effectTag</span>: <span class="hljs-string">&#x27;UPDATE&#x27;</span>,  <span class="hljs-comment">// 需要执行的副作用</span><br>  <span class="hljs-comment">// ... 其他元数据</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>双缓存机制（Current 树与 WorkInProgress 树）</strong></p>
<pre class="mermaid">graph LR
A[当前显示] -->|Current 树| B[用户界面]
C[正在构建] -->|WorkInProgress 树| D[内存中]
B -->|渲染完成| C</pre>

<ul>
<li>无闪烁更新：直接切换树引用</li>
<li>安全回滚：中断时丢弃未完成树</li>
</ul>
<h3 id="高频面试题与破解方案-1"><a href="#高频面试题与破解方案-1" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么列表渲染需要 key？key 可以随机数吗？</strong></p>
<ul>
<li>key 帮助 React 识别元素身份，减少不必要的销毁&#x2F;重建</li>
<li>禁止使用随机数：每次渲染 key 变化导致全量重建</li>
<li>推荐方案：稳定 ID（如数据 id）或索引（仅静态列表）</li>
</ul>
<p><strong>Q：虚拟 DOM 一定比直接操作 DOM 快吗？</strong></p>
<p>辩证回答：</p>
<ul>
<li>初始渲染：虚拟 DOM 需要额外创建对象，稍慢</li>
<li>复杂更新：虚拟 DOM 通过 Diff 减少操作次数，更快</li>
<li>综合优势：<ul>
<li>跨平台能力（React Native）</li>
<li>声明式编程体验</li>
<li>自动批处理优化</li>
</ul>
</li>
</ul>
<p><strong>Q：React 如何实现 O(n) 复杂度的 Diff？</strong></p>
<p>算法原理：</p>
<ul>
<li>仅同层比较（深度优先遍历）</li>
<li>类型不同时跳过子树比较</li>
<li>列表使用 key 匹配减少移动开销</li>
</ul>
<h3 id="性能优化技巧"><a href="#性能优化技巧" class="headerlink" title="性能优化技巧"></a>性能优化技巧</h3><p><strong>避免不必要节点变动</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 每次渲染创建新对象（导致子组件重渲染）</span><br>&lt;<span class="hljs-title class_">Child</span> style=&#123;&#123; <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;red&#x27;</span> &#125;&#125; /&gt;<br><br><span class="hljs-comment">// ✅ 提取静态对象</span><br><span class="hljs-keyword">const</span> staticStyle = &#123; <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;red&#x27;</span> &#125;;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;staticStyle&#125;</span> /&gt;</span></span><br></code></pre></td></tr></table></figure>

<p><strong>列表渲染优化</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 索引作为 key（列表变化时状态错乱）</span><br>&#123;todos.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">todo, index</span>) =&gt;</span> <br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">TodoItem</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;index&#125;</span> <span class="hljs-attr">todo</span>=<span class="hljs-string">&#123;todo&#125;</span> /&gt;</span></span><br>)&#125;<br><br><span class="hljs-comment">// ✅ 稳定 ID 作为 key</span><br>&#123;todos.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> <br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">TodoItem</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;todo.id&#125;</span> <span class="hljs-attr">todo</span>=<span class="hljs-string">&#123;todo&#125;</span> /&gt;</span></span><br>)&#125;<br></code></pre></td></tr></table></figure>

<p><strong>组件树结构优化</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 深层嵌套导致 Diff 范围大</span><br>&lt;<span class="hljs-title class_">App</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Header</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">UserPanel</span>&gt;</span>  // 状态变化影响整个 Header</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">UserPanel</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">Header</span>&gt;</span></span><br>&lt;/<span class="hljs-title class_">App</span>&gt;<br><br><span class="hljs-comment">// ✅ 状态下沉 + 组件提权</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">UserPanel</span>&gt;</span>   // 独立更新</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">UserPanel</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">App</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<h3 id="React-18-并发渲染优化"><a href="#React-18-并发渲染优化" class="headerlink" title="React 18 并发渲染优化"></a>React 18 并发渲染优化</h3><p><strong>可中断渲染</strong></p>
<pre class="mermaid">graph LR
A[高优先级更新] --> B[中断当前渲染]
B --> C[执行紧急任务]
C --> D[恢复渲染]</pre>

<p><strong>自动批处理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// React 17：仅事件处理函数内批处理</span><br><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">setCount</span>(<span class="hljs-number">1</span>);<br>  <span class="hljs-title function_">setFlag</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// 两次独立更新</span><br>&#125;, <span class="hljs-number">100</span>);<br><br><span class="hljs-comment">// React 18：所有更新自动批处理</span><br><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">setCount</span>(<span class="hljs-number">1</span>);   <span class="hljs-comment">// 合并为一次更新</span><br>  <span class="hljs-title function_">setFlag</span>(<span class="hljs-literal">true</span>);<br>&#125;, <span class="hljs-number">100</span>);<br></code></pre></td></tr></table></figure>

<h2 id="2-2-生命周期（类组件生命周期、useEffect-替代方案）"><a href="#2-2-生命周期（类组件生命周期、useEffect-替代方案）" class="headerlink" title="2.2 生命周期（类组件生命周期、useEffect 替代方案）"></a>2.2 生命周期（类组件生命周期、useEffect 替代方案）</h2><h3 id="类组件生命周期全景图"><a href="#类组件生命周期全景图" class="headerlink" title="类组件生命周期全景图"></a>类组件生命周期全景图</h3><pre class="mermaid">graph TD
  A[挂载阶段] --> B[constructor]
  B --> C[static getDerivedStateFromProps]
  C --> D[render]
  D --> E[componentDidMount]
  
  F[更新阶段] --> G[static getDerivedStateFromProps]
  G --> H[shouldComponentUpdate]
  H --> I[render]
  I --> J[getSnapshotBeforeUpdate]
  J --> K[componentDidUpdate]
  
  L[卸载阶段] --> M[componentWillUnmount]
  
  N[错误处理] --> O[static getDerivedStateFromError]
  O --> P[componentDidCatch]</pre>

<p>各阶段核心方法：</p>
<table>
<thead>
<tr>
<th align="left">阶段</th>
<th align="left">方法</th>
<th align="left">执行时机</th>
<th align="left">常见用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">挂载</td>
<td align="left">constructor</td>
<td align="left">组件初始化</td>
<td align="left">初始化 state，绑定 this</td>
</tr>
<tr>
<td align="left">挂载</td>
<td align="left">render</td>
<td align="left">创建虚拟 DOM</td>
<td align="left">返回 JSX 内容</td>
</tr>
<tr>
<td align="left">挂载</td>
<td align="left">componentDidMount</td>
<td align="left">DOM 挂载完成</td>
<td align="left">网络请求、订阅事件</td>
</tr>
<tr>
<td align="left">更新</td>
<td align="left">shouldComponentUpdate</td>
<td align="left">渲染前拦截</td>
<td align="left">性能优化（返回 false 阻止更新）</td>
</tr>
<tr>
<td align="left">更新</td>
<td align="left">getSnapshotBeforeUpdate</td>
<td align="left">DOM 更新前</td>
<td align="left">获取滚动位置等 DOM 信息</td>
</tr>
<tr>
<td align="left">更新</td>
<td align="left">componentDidUpdate</td>
<td align="left">DOM 更新完成</td>
<td align="left">基于新 DOM 操作</td>
</tr>
<tr>
<td align="left">卸载</td>
<td align="left">componentWillUnmount</td>
<td align="left">组件卸载前</td>
<td align="left">清理定时器、取消订阅</td>
</tr>
<tr>
<td align="left">错误</td>
<td align="left">componentDidCatch</td>
<td align="left">子组件抛出错误</td>
<td align="left">错误日志、显示降级 UI</td>
</tr>
</tbody></table>
<h3 id="函数组件-useEffect-替代方案"><a href="#函数组件-useEffect-替代方案" class="headerlink" title="函数组件 useEffect 替代方案"></a>函数组件 useEffect 替代方案</h3><p>生命周期映射关系：</p>
<pre class="mermaid">graph LR
  A[componentDidMount] --> B["useEffect(() => {}, [])"]
  C[componentDidUpdate] --> D["useEffect(() => {}, [deps])"]
  E[componentWillUnmount] --> F["useEffect(() => { return cleanup }, [])"]
  G[shouldComponentUpdate] --> H[React.memo 或 useMemo]</pre>

<h3 id="核心机制深度解析-1"><a href="#核心机制深度解析-1" class="headerlink" title="核心机制深度解析"></a>核心机制深度解析</h3><p><strong>useEffect 执行时机</strong></p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">执行阶段</th>
<th align="left">是否阻塞渲染</th>
<th align="left">访问 DOM</th>
</tr>
</thead>
<tbody><tr>
<td align="left">componentDidMount</td>
<td align="left">浏览器绘制后</td>
<td align="left">是</td>
<td align="left">可访问</td>
</tr>
<tr>
<td align="left">componentDidUpdate</td>
<td align="left">浏览器绘制后</td>
<td align="left">是</td>
<td align="left">可访问</td>
</tr>
<tr>
<td align="left">useEffect</td>
<td align="left">浏览器绘制前</td>
<td align="left">否（异步）</td>
<td align="left">可访问（但需注意时机）</td>
</tr>
<tr>
<td align="left">useLayoutEffect</td>
<td align="left">DOM 变更后，绘制前</td>
<td align="left">是（同步）</td>
<td align="left">可访问</td>
</tr>
</tbody></table>
<p><strong>依赖数组精妙之处</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ✅ 安全：包含所有依赖</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> total = price * quantity;<br>  <span class="hljs-title function_">setTotal</span>(total);<br>&#125;, [price, quantity]); <br><br><span class="hljs-comment">// ❌ 危险：缺少依赖（使用过期状态）</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> total = price * quantity;<br>  <span class="hljs-title function_">setTotal</span>(total);<br>&#125;, [price]); <span class="hljs-comment">// 缺少 quantity</span><br><br><span class="hljs-comment">// ✅ 解决方案：函数式更新</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">setTotal</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> price * quantity);<br>&#125;, [price]); <span class="hljs-comment">// 不再依赖 quantity</span><br></code></pre></td></tr></table></figure>

<h3 id="高频面试题与破解方案-2"><a href="#高频面试题与破解方案-2" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么 useEffect 可能执行两次？</strong></p>
<p>React 18+ 严格模式行为：</p>
<ul>
<li>开发环境下故意双调用：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">&lt;<span class="hljs-title class_">React</span>.<span class="hljs-property">StrictMode</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span> &#123;<span class="hljs-comment">/* useEffect 挂载/卸载各执行两次 */</span>&#125;<br>&lt;/<span class="hljs-title class_">React</span>.<span class="hljs-property">StrictMode</span>&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li>目的：检测不纯渲染（例如未正确实现清理）</li>
<li>解决方案：确保清理函数完全复原初始状态</li>
</ul>
<p><strong>Q：如何替代 shouldComponentUpdate？</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 方案1：React.memo 浅比较</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">MyComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-function">(<span class="hljs-params">&#123; data &#125;</span>) =&gt;</span> &#123; ... &#125;);<br><br><span class="hljs-comment">// 方案2：自定义比较</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">MyComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<br>  <span class="hljs-function">(<span class="hljs-params">&#123; data &#125;</span>) =&gt;</span> &#123; ... &#125;,<br>  <span class="hljs-function">(<span class="hljs-params">prevProps, nextProps</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> prevProps.<span class="hljs-property">id</span> === nextProps.<span class="hljs-property">id</span>; <span class="hljs-comment">// 自定义比较逻辑</span><br>  &#125;<br>);<br><br><span class="hljs-comment">// 方案3：useMemo 控制子组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> memoizedChild = <span class="hljs-title function_">useMemo</span>(<br>    <span class="hljs-function">() =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;complexData&#125;</span> /&gt;</span></span>,<br>    [complexData] <span class="hljs-comment">// 仅 complexData 变化时重建</span><br>  );<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;memoizedChild&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Q：getSnapshotBeforeUpdate 如何替代？</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 类组件</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ScrollList</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  <span class="hljs-title function_">getSnapshotBeforeUpdate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>.<span class="hljs-property">scrollHeight</span>;<br>  &#125;<br>  <br>  <span class="hljs-title function_">componentDidUpdate</span>(<span class="hljs-params">prevProps, prevState, snapshot</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>.<span class="hljs-property">scrollTop</span> += <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>.<span class="hljs-property">scrollHeight</span> - snapshot;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 函数组件：useLayoutEffect + useRef</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ScrollList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> listRef = <span class="hljs-title function_">useRef</span>();<br>  <span class="hljs-keyword">const</span> lastScrollHeight = <span class="hljs-title function_">useRef</span>();<br>  <br>  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// DOM 更新后，绘制前执行（类似 getSnapshotBeforeUpdate）</span><br>    lastScrollHeight.<span class="hljs-property">current</span> = listRef.<span class="hljs-property">current</span>.<span class="hljs-property">scrollHeight</span>;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-comment">// 清理阶段相当于 getSnapshotBeforeUpdate</span><br>      <span class="hljs-keyword">const</span> snapshot = listRef.<span class="hljs-property">current</span>.<span class="hljs-property">scrollHeight</span>;<br>      listRef.<span class="hljs-property">current</span>.<span class="hljs-property">scrollTop</span> += listRef.<span class="hljs-property">current</span>.<span class="hljs-property">scrollHeight</span> - lastScrollHeight.<span class="hljs-property">current</span>;<br>    &#125;;<br>  &#125;, [items]);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="错误边界（Error-Boundaries）特殊说明"><a href="#错误边界（Error-Boundaries）特殊说明" class="headerlink" title="错误边界（Error Boundaries）特殊说明"></a>错误边界（Error Boundaries）特殊说明</h3><p><strong>类组件专属能力</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ErrorBoundary</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  state = &#123; <span class="hljs-attr">hasError</span>: <span class="hljs-literal">false</span> &#125;;<br>  <br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getDerivedStateFromError</span>(<span class="hljs-params">error</span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">hasError</span>: <span class="hljs-literal">true</span> &#125;;<br>  &#125;<br>  <br>  <span class="hljs-title function_">componentDidCatch</span>(<span class="hljs-params">error, info</span>) &#123;<br>    <span class="hljs-title function_">logErrorToService</span>(error, info.<span class="hljs-property">componentStack</span>);<br>  &#125;<br>  <br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">hasError</span><br>      ? <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">FallbackComponent</span> /&gt;</span></span><br>      : <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">children</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>函数组件解决方案</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 使用第三方库 react-error-boundary</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ErrorBoundary</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-error-boundary&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span> <span class="hljs-attr">FallbackComponent</span>=<span class="hljs-string">&#123;ErrorFallback&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">UnstableComponent</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="2-3-受控组件-vs-非受控组件（表单处理）"><a href="#2-3-受控组件-vs-非受控组件（表单处理）" class="headerlink" title="2.3 受控组件 vs. 非受控组件（表单处理）"></a>2.3 受控组件 vs. 非受控组件（表单处理）</h2><h3 id="核心概念对比"><a href="#核心概念对比" class="headerlink" title="核心概念对比"></a>核心概念对比</h3><table>
<thead>
<tr>
<th>特性</th>
<th>受控组件</th>
<th>非受控组件</th>
</tr>
</thead>
<tbody><tr>
<td>数据管理</td>
<td>React state 完全控制</td>
<td>DOM 节点自身管理</td>
</tr>
<tr>
<td>值获取</td>
<td>value 属性</td>
<td>ref 访问 DOM 节点</td>
</tr>
<tr>
<td>值更新</td>
<td>onChange 事件 + setState</td>
<td>用户直接输入</td>
</tr>
<tr>
<td>初始化</td>
<td>value 属性</td>
<td>defaultValue&#x2F;defaultChecked</td>
</tr>
<tr>
<td>表单提交</td>
<td>从 state 获取</td>
<td>从 ref 获取</td>
</tr>
<tr>
<td>实时验证</td>
<td>容易实现</td>
<td>需要手动监听事件</td>
</tr>
<tr>
<td>适用场景</td>
<td>复杂表单、即时验证</td>
<td>简单表单、文件上传</td>
</tr>
</tbody></table>
<h3 id="受控组件深度解析"><a href="#受控组件深度解析" class="headerlink" title="受控组件深度解析"></a>受控组件深度解析</h3><p><strong>实现原理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ControlledForm</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [value, setValue] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChange</span> = (<span class="hljs-params">e</span>) =&gt; &#123;<br>    <span class="hljs-title function_">setValue</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>); <span class="hljs-comment">// 完全控制输入值</span><br>  &#125;;<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> </span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;value&#125;</span>       // <span class="hljs-attr">值绑定</span> <span class="hljs-attr">state</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleChange&#125;</span> // <span class="hljs-attr">更新</span> <span class="hljs-attr">state</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>多字段优化模式</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MultiFieldForm</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [formData, setFormData] = <span class="hljs-title function_">useState</span>(&#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-attr">email</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-attr">password</span>: <span class="hljs-string">&#x27;&#x27;</span><br>  &#125;);<br><br>  <span class="hljs-comment">// 通用变更处理器</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChange</span> = (<span class="hljs-params">e</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; name, value &#125; = e.<span class="hljs-property">target</span>;<br>    <span class="hljs-title function_">setFormData</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> (&#123; ...prev, [name]: value &#125;));<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;formData.name&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleChange&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;formData.email&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleChange&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>即时验证示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">EmailInput</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [email, setEmail] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [isValid, setIsValid] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChange</span> = (<span class="hljs-params">e</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> value = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;<br>    <span class="hljs-title function_">setEmail</span>(value);<br>    <span class="hljs-title function_">setIsValid</span>(<span class="hljs-regexp">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>.<span class="hljs-title function_">test</span>(value)); <span class="hljs-comment">// 实时验证</span><br>  &#125;;<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;email&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleChange&#125;</span> /&gt;</span></span><br><span class="language-xml">      &#123;!isValid &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>邮箱格式错误<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="非受控组件深度解析"><a href="#非受控组件深度解析" class="headerlink" title="非受控组件深度解析"></a>非受控组件深度解析</h3><p><strong>实现原理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">UncontrolledForm</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = (<span class="hljs-params">e</span>) =&gt; &#123;<br>    e.<span class="hljs-title function_">preventDefault</span>();<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(inputRef.<span class="hljs-property">current</span>.<span class="hljs-property">value</span>); <span class="hljs-comment">// 提交时获取值</span><br>  &#125;;<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">&#123;handleSubmit&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;inputRef&#125;</span>          // <span class="hljs-attr">绑定</span> <span class="hljs-attr">ref</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">&quot;初始值&quot;</span>   // <span class="hljs-attr">仅初始值</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>文件上传场景（必须使用非受控）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">FileUpload</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> fileRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> file = fileRef.<span class="hljs-property">current</span>.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];<br>    <span class="hljs-comment">// 处理文件...</span><br>  &#125;;<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;fileRef&#125;</span> /&gt;</span> &#123;/* 无法受控 */&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleSubmit&#125;</span>&gt;</span>上传<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>第三方库集成</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">RichTextEditor</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> editorRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 初始化第三方编辑器</span><br>    <span class="hljs-keyword">const</span> editor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThirdPartyEditor</span>(editorRef.<span class="hljs-property">current</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> editor.<span class="hljs-title function_">destroy</span>();<br>  &#125;, []);<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;editorRef&#125;</span> /&gt;</span></span>; <span class="hljs-comment">// 非受控管理</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="高频面试题与破解方案-3"><a href="#高频面试题与破解方案-3" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么文件输入必须用非受控组件？</strong></p>
<ul>
<li>安全限制：浏览器禁止 JavaScript 设置文件输入值（<code>&lt;input type=&quot;file&quot;&gt;</code>）</li>
<li>只读属性：文件路径由用户选择，程序无法控制</li>
<li>数据获取：只能通过 ref.current.files 获取文件对象</li>
</ul>
<p><strong>Q：受控组件相比非受控有何优势？</strong></p>
<ul>
<li>即时验证：每次输入都可触发验证逻辑</li>
<li>条件渲染：基于输入值动态控制其他 UI</li>
<li>状态追溯：完整的状态历史记录</li>
<li>表单重置：轻松实现 reset 功能（setState(‘’)）</li>
</ul>
<p><strong>Q：如何实现表单重置功能？</strong></p>
<p>受控组件方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ResettableForm</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [form, setForm] = <span class="hljs-title function_">useState</span>(&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">&#x27;&#x27;</span> &#125;);<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleReset</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-title function_">setForm</span>(&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">&#x27;&#x27;</span> &#125;); <span class="hljs-comment">// 重置 state</span><br>  &#125;;<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;form.name&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;/*...*/&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleReset&#125;</span>&gt;</span>重置<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p>非受控组件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ResettableForm</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> formRef = <span class="hljs-title function_">useRef</span>();<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleReset</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    formRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">reset</span>(); <span class="hljs-comment">// 调用原生 DOM reset</span><br>  &#125;;<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;formRef&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">&quot;&quot;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleReset&#125;</span>&gt;</span>重置<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="2-4-组件通信（父子通信、Context-API、事件总线）"><a href="#2-4-组件通信（父子通信、Context-API、事件总线）" class="headerlink" title="2.4 组件通信（父子通信、Context API、事件总线）"></a>2.4 组件通信（父子通信、Context API、事件总线）</h2><h3 id="组件通信方式全景图"><a href="#组件通信方式全景图" class="headerlink" title="组件通信方式全景图"></a>组件通信方式全景图</h3><pre class="mermaid">graph TD
  A[组件通信] --> B[父子组件]
  A --> C[兄弟组件]
  A --> D[祖孙组件]
  A --> E[任意组件]
  
  B --> B1[Props/回调函数]
  C --> C1[状态提升]
  C --> C2[通过共同父组件]
  D --> D1[Context API]
  D --> D2[逐层传递Props]
  E --> E1[事件总线]
  E --> E2[状态管理库]</pre>

<h3 id="父子组件通信（Props-回调）"><a href="#父子组件通信（Props-回调）" class="headerlink" title="父子组件通信（Props + 回调）"></a>父子组件通信（Props + 回调）</h3><p><strong>基础模式</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 父组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChildData</span> = (<span class="hljs-params">childData</span>) =&gt; &#123;<br>    <span class="hljs-title function_">setData</span>(childData);<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">onDataSend</span>=<span class="hljs-string">&#123;handleChildData&#125;</span> /&gt;</span></span>;<br>&#125;<br><br><span class="hljs-comment">// 子组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params">&#123; onDataSend &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> onDataSend(&#x27;Hello&#x27;)&#125;&gt;发送数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>多层透传问题</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 祖孙组件通信（不推荐）</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Grandparent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Parent</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> /&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params">&#123; data &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> /&gt;</span></span>; <span class="hljs-comment">// 中间层被迫传递</span><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params">&#123; data &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;data&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>痛点：Props drilling（属性钻探）导致代码冗余</p>
<h3 id="Context-API-深度解析"><a href="#Context-API-深度解析" class="headerlink" title="Context API 深度解析"></a>Context API 深度解析</h3><p><strong>核心三要素</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 1. 创建Context</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ThemeContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createContext</span>(<span class="hljs-string">&#x27;light&#x27;</span>); <span class="hljs-comment">// 默认值</span><br><br><span class="hljs-comment">// 2. Provider 提供数据</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [theme, setTheme] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;dark&#x27;</span>);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">theme</span>, <span class="hljs-attr">setTheme</span> &#125;&#125;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Toolbar</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Provider</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 3. Consumer 消费数据（两种方式）</span><br><span class="hljs-comment">// 方式1：useContext Hook</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; theme &#125; = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ThemeContext</span>);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;theme&#125;</span>&gt;</span>按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-comment">// 方式2：Context.Consumer</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span></span><br><span class="language-xml">      &#123;(&#123; theme &#125;) =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;theme&#125;</span>&gt;</span>按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>性能优化策略</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 错误写法：直接传递对象</span><br>&lt;<span class="hljs-title class_">MyContext</span>.<span class="hljs-property">Provider</span> value=&#123;&#123; theme, setTheme &#125;&#125;&gt;<br>  ...<br>&lt;/<span class="hljs-title class_">MyContext</span>.<span class="hljs-property">Provider</span>&gt;<br><br><span class="hljs-comment">// ✅ 正确方案：useMemo 缓存值</span><br><span class="hljs-keyword">const</span> contextValue = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> (&#123; theme, setTheme &#125;), [theme]);<br><span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;contextValue&#125;</span>&gt;</span></span><br><span class="language-xml">    ...</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">MyContext.Provider</span>&gt;</span></span><br>);<br></code></pre></td></tr></table></figure>

<p><strong>多层Context嵌套</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">&lt;<span class="hljs-title class_">UserContext</span>.<span class="hljs-property">Provider</span> value=&#123;user&#125;&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;theme&#125;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">LayoutContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;layout&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">AppContent</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">LayoutContext.Provider</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Provider</span>&gt;</span></span><br>&lt;/<span class="hljs-title class_">UserContext</span>.<span class="hljs-property">Provider</span>&gt;<br><br><span class="hljs-comment">// 消费时自动匹配最近Provider</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Header</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> user = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">UserContext</span>);       <span class="hljs-comment">// 获取user</span><br>  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ThemeContext</span>);     <span class="hljs-comment">// 获取theme</span><br>  <span class="hljs-keyword">const</span> layout = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">LayoutContext</span>);   <span class="hljs-comment">// 获取layout</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="事件总线（Event-Bus）模式"><a href="#事件总线（Event-Bus）模式" class="headerlink" title="事件总线（Event Bus）模式"></a>事件总线（Event Bus）模式</h3><p><strong>实现原理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// eventBus.js</span><br><span class="hljs-keyword">const</span> events = &#123;&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  $on(eventName, fn) &#123;<br>    events[eventName] = events[eventName] || [];<br>    events[eventName].<span class="hljs-title function_">push</span>(fn);<br>  &#125;,<br>  <br>  $off(eventName, fn) &#123;<br>    <span class="hljs-keyword">if</span> (events[eventName]) &#123;<br>      events[eventName] = events[eventName].<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f !== fn);<br>    &#125;<br>  &#125;,<br>  <br>  $emit(eventName, data) &#123;<br>    <span class="hljs-keyword">if</span> (events[eventName]) &#123;<br>      events[eventName].<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">fn</span> =&gt;</span> <span class="hljs-title function_">fn</span>(data));<br>    &#125;<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>React 组件中使用</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 组件A（发布事件）</span><br><span class="hljs-keyword">import</span> eventBus <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./eventBus&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ComponentA</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    eventBus.$emit(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-string">&#x27;数据内容&#x27;</span>);<br>  &#125;;<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span>发送<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-comment">// 组件B（订阅事件）</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ComponentB</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [msg, setMsg] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handler</span> = (<span class="hljs-params">data</span>) =&gt; <span class="hljs-title function_">setMsg</span>(data);<br>    eventBus.$on(<span class="hljs-string">&#x27;message&#x27;</span>, handler);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> eventBus.$off(<span class="hljs-string">&#x27;message&#x27;</span>, handler); <span class="hljs-comment">// 清理</span><br>  &#125;, []);<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;msg&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>适用场景与风险</strong></p>
<table>
<thead>
<tr>
<th align="left">优点</th>
<th align="left">缺点</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">跨任意组件通信</td>
<td align="left">破坏组件独立性</td>
<td align="left">微前端架构通信</td>
</tr>
<tr>
<td align="left">解耦性强</td>
<td align="left">难以追踪数据流</td>
<td align="left">非父子组件简单交互</td>
</tr>
<tr>
<td align="left">实现简单</td>
<td align="left">可能内存泄漏（未及时取消订阅）</td>
<td align="left">第三方库事件通知</td>
</tr>
</tbody></table>
<h3 id="高级通信模式"><a href="#高级通信模式" class="headerlink" title="高级通信模式"></a>高级通信模式</h3><p><strong>状态提升 + Context 组合</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 创建共享状态上下文</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">SharedStateContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createContext</span>();<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>(initialState);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SharedStateContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">state</span>, <span class="hljs-attr">setState</span> &#125;&#125;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ComponentA</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ComponentB</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">SharedStateContext.Provider</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 任意子组件消费</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ComponentA</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; state, setState &#125; = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">SharedStateContext</span>);<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Render Props 模式</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 数据提供者</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  state = &#123; <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span> &#125;;<br>  <br>  <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">fetchData</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; data &#125;));<br>  &#125;<br>  <br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-title function_">children</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">data</span>); <span class="hljs-comment">// 关键</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 消费组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Consumer</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">DataProvider</span>&gt;</span></span><br><span class="language-xml">      &#123;data =&gt; data ? <span class="hljs-tag">&lt;<span class="hljs-name">ShowData</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> /&gt;</span> : <span class="hljs-tag">&lt;<span class="hljs-name">Loading</span> /&gt;</span>&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">DataProvider</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>观察者模式（Pub&#x2F;Sub）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 使用第三方库 (rxjs)</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Subject</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;rxjs&#x27;</span>;<br><br><span class="hljs-keyword">const</span> message$ = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>();<br><br><span class="hljs-comment">// 发布</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">publishMessage</span>(<span class="hljs-params">text</span>) &#123;<br>  message$.<span class="hljs-title function_">next</span>(text);<br>&#125;<br><br><span class="hljs-comment">// 订阅</span><br>message$.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;收到消息:&#x27;</span>, text);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="高频面试题与破解方案-4"><a href="#高频面试题与破解方案-4" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q:：Context 与 Redux 如何选择？</strong></p>
<pre class="mermaid">graph TD
A[需要全局状态?] -->|是| B[状态更新频率高?]
A -->|否| C[用Props/状态提升]
B -->|是| D[用Redux/Zustand]
B -->|否| E[用Context API]</pre>

<p>关键区别：</p>
<ul>
<li>Context：轻量级，适合低频更新（主题&#x2F;用户信息）</li>
<li>Redux：重量级，适合高频更新+时间旅行调试</li>
</ul>
<p><strong>Q：如何避免 Context 性能问题？</strong></p>
<ul>
<li>拆分 Context：按业务分离（用户Context&#x2F;主题Context）</li>
<li>使用 React.memo：防止无关组件重渲染</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Child</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-function">(<span class="hljs-params">&#123; nonContextProp &#125;</span>) =&gt;</span> &#123; ... &#125;);<br></code></pre></td></tr></table></figure>

<ul>
<li>选择订阅：使用 use-context-selector 库</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; useContextSelector &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;use-context-selector&#x27;</span>;<br><span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useContextSelector</span>(<span class="hljs-title class_">ThemeContext</span>, <span class="hljs-function"><span class="hljs-params">ctx</span> =&gt;</span> ctx.<span class="hljs-property">theme</span>);<br></code></pre></td></tr></table></figure>

<p><strong>Q：事件总线会导致什么问题？</strong></p>
<ul>
<li>内存泄漏：组件卸载时取消订阅</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handler</span> = (<span class="hljs-params"></span>) =&gt; &#123;...&#125;;<br>  bus.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;event&#x27;</span>, handler);<br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> bus.<span class="hljs-title function_">off</span>(<span class="hljs-string">&#x27;event&#x27;</span>, handler); <span class="hljs-comment">// ✅</span><br>&#125;, []);<br></code></pre></td></tr></table></figure>

<ul>
<li>事件冲突：使用命名空间</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">bus.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;moduleA:event&#x27;</span>, data);<br></code></pre></td></tr></table></figure>

<ul>
<li>调试困难：添加事件日志</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">emit</span>(<span class="hljs-params">event, data</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Event] <span class="hljs-subst">$&#123;event&#125;</span>`</span>, data);<br>  <span class="hljs-comment">// ...原逻辑</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="2-5-Refs-使用场景（DOM-操作、forwardRef）"><a href="#2-5-Refs-使用场景（DOM-操作、forwardRef）" class="headerlink" title="2.5 Refs 使用场景（DOM 操作、forwardRef）"></a>2.5 Refs 使用场景（DOM 操作、forwardRef）</h2><h3 id="Refs-核心概念全景图"><a href="#Refs-核心概念全景图" class="headerlink" title="Refs 核心概念全景图"></a>Refs 核心概念全景图</h3><pre class="mermaid">graph TD
  A[Refs 类型] --> B[对象 Ref]
  A --> C[回调 Ref]
  A --> D[函数组件 useRef]
  
  E[使用场景] --> F[访问 DOM 节点]
  E --> G[访问类组件实例]
  E --> H[存储可变值]
  E --> I[集成第三方库]
  
  J[高级特性] --> K[forwardRef 转发]
  J --> L[useImperativeHandle 暴露方法]</pre>

<h3 id="三大-Refs-创建方式"><a href="#三大-Refs-创建方式" class="headerlink" title="三大 Refs 创建方式"></a>三大 Refs 创建方式</h3><p><strong>对象 Ref（类组件）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoFocusInput</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  inputRef = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createRef</span>();  <span class="hljs-comment">// 创建 Ref 对象</span><br>  <br>  <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputRef</span>.<span class="hljs-property">current</span>.<span class="hljs-title function_">focus</span>();  <span class="hljs-comment">// 访问 DOM 节点</span><br>  &#125;<br>  <br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;this.inputRef&#125;</span> /&gt;</span></span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>回调 Ref（动态场景）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicRef</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  setRef = <span class="hljs-function">(<span class="hljs-params">element</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (element) &#123;<br>      element.<span class="hljs-title function_">focus</span>();  <span class="hljs-comment">// 元素挂载时执行</span><br>    &#125;<br>  &#125;;<br>  <br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;this.setRef&#125;</span> /&gt;</span></span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>useRef Hook（函数组件）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">FocusInput</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);  <span class="hljs-comment">// 创建 Ref</span><br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    inputRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">focus</span>();  <span class="hljs-comment">// 挂载后聚焦</span><br>  &#125;, []);<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;inputRef&#125;</span> /&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="核心使用场景深度解析"><a href="#核心使用场景深度解析" class="headerlink" title="核心使用场景深度解析"></a>核心使用场景深度解析</h3><p><strong>DOM 操作（核心场景）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">VideoPlayer</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> videoRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">play</span> = (<span class="hljs-params"></span>) =&gt; videoRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">play</span>();<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">pause</span> = (<span class="hljs-params"></span>) =&gt; videoRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">pause</span>();<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;videoRef&#125;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;movie.mp4&quot;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;play&#125;</span>&gt;</span>播放<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;pause&#125;</span>&gt;</span>暂停<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>存储可变值（不触发重渲染）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Timer</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> intervalRef = <span class="hljs-title function_">useRef</span>();  <span class="hljs-comment">// 存储计时器 ID</span><br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    intervalRef.<span class="hljs-property">current</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c + <span class="hljs-number">1</span>);<br>    &#125;, <span class="hljs-number">1000</span>);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(intervalRef.<span class="hljs-property">current</span>);<br>  &#125;, []);<br>  <br>  <span class="hljs-comment">// 停止计时器（不依赖 state）</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">stop</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-built_in">clearInterval</span>(intervalRef.<span class="hljs-property">current</span>);<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;count&#125; <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;stop&#125;</span>&gt;</span>停止<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>类组件方法调用</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 子组件（类组件）</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AudioPlayer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  play = <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">audio</span>.<span class="hljs-title function_">play</span>();<br>  pause = <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">audio</span>.<span class="hljs-title function_">pause</span>();<br>  <br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">audio</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;el</span> =&gt;</span> this.audio = el&#125; /&gt;</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 父组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> playerRef = <span class="hljs-title function_">useRef</span>();<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">AudioPlayer</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;playerRef&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> playerRef.current.play()&#125;&gt;播放<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>第三方库集成</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChartContainer</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> chartRef = <span class="hljs-title function_">useRef</span>();<br>  <span class="hljs-keyword">const</span> chartInstance = <span class="hljs-title function_">useRef</span>();<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 初始化图表</span><br>    chartInstance.<span class="hljs-property">current</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThirdPartyChart</span>(chartRef.<span class="hljs-property">current</span>, data);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> chartInstance.<span class="hljs-property">current</span>.<span class="hljs-title function_">destroy</span>();  <span class="hljs-comment">// 清理</span><br>  &#125;, [data]);<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;chartRef&#125;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">height:</span> &#x27;<span class="hljs-attr">400px</span>&#x27; &#125;&#125; /&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="forwardRef-转发机制"><a href="#forwardRef-转发机制" class="headerlink" title="forwardRef 转发机制"></a>forwardRef 转发机制</h3><p><strong>问题背景：函数组件不能直接使用 ref</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 错误用法：函数组件无实例</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">MyInput</span> = (<span class="hljs-params">&#123; value &#125;</span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;value&#125;</span> /&gt;</span></span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>();<br>  <span class="hljs-comment">// 无效！inputRef.current 将为 null</span><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyInput</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;inputRef&#125;</span> /&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>forwardRef 解决方案</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">MyInput</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> &#123;<span class="hljs-attr">...props</span>&#125; <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;ref&#125;</span> /&gt;</span></span>;<br>&#125;);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>();<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    inputRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">focus</span>();  <span class="hljs-comment">// ✅ 现在可以操作 DOM</span><br>  &#125;, []);<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyInput</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;inputRef&#125;</span> /&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>转发多个 ref</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">MultiInput</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> input1Ref = <span class="hljs-title function_">useRef</span>();<br>  <span class="hljs-keyword">const</span> input2Ref = <span class="hljs-title function_">useRef</span>();<br>  <br>  <span class="hljs-comment">// 合并 ref 到父组件</span><br>  <span class="hljs-title function_">useImperativeHandle</span>(ref, <span class="hljs-function">() =&gt;</span> (&#123;<br>    <span class="hljs-attr">focusFirst</span>: <span class="hljs-function">() =&gt;</span> input1Ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">focus</span>(),<br>    <span class="hljs-attr">focusSecond</span>: <span class="hljs-function">() =&gt;</span> input2Ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">focus</span>()<br>  &#125;));<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;input1Ref&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;input2Ref&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;);<br><br><span class="hljs-comment">// 父组件使用</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> inputsRef = <span class="hljs-title function_">useRef</span>();<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MultiInput</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;inputsRef&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> inputsRef.current.focusFirst()&#125;&gt;聚焦输入1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="useImperativeHandle-高级用法"><a href="#useImperativeHandle-高级用法" class="headerlink" title="useImperativeHandle 高级用法"></a>useImperativeHandle 高级用法</h3><p><strong>暴露自定义方法</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">FancyInput</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>();<br>  <br>  <span class="hljs-title function_">useImperativeHandle</span>(ref, <span class="hljs-function">() =&gt;</span> (&#123;<br>    <span class="hljs-comment">// 暴露特定方法</span><br>    <span class="hljs-attr">focus</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>      inputRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">focus</span>();<br>    &#125;,<br>    <span class="hljs-attr">scrollIntoView</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>      inputRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">scrollIntoView</span>();<br>    &#125;,<br>    <span class="hljs-comment">// 限制访问 DOM 节点</span><br>    <span class="hljs-attr">getValue</span>: <span class="hljs-function">() =&gt;</span> inputRef.<span class="hljs-property">current</span>.<span class="hljs-property">value</span><br>  &#125;));<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;inputRef&#125;</span> &#123;<span class="hljs-attr">...props</span>&#125; /&gt;</span></span>;<br>&#125;);<br><br><span class="hljs-comment">// 父组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>();<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">FancyInput</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;inputRef&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> inputRef.current.focus()&#125;&gt;聚焦<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> console.log(inputRef.current.getValue())&#125;&gt;获取值<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>依赖项控制</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title function_">useImperativeHandle</span>(ref, <span class="hljs-function">() =&gt;</span> (&#123;<br>  <span class="hljs-comment">// 当 value 变化时更新方法</span><br>  <span class="hljs-attr">getValue</span>: <span class="hljs-function">() =&gt;</span> inputRef.<span class="hljs-property">current</span>.<span class="hljs-property">value</span><br>&#125;), [props.<span class="hljs-property">value</span>]);  <span class="hljs-comment">// 依赖项数组</span><br></code></pre></td></tr></table></figure>

<h3 id="高频面试题与破解方案-5"><a href="#高频面试题与破解方案-5" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么函数组件默认不能使用 ref？</strong></p>
<ul>
<li>函数组件无实例，ref 无法指向组件对象</li>
<li>React 设计哲学：避免直接操作子组件</li>
<li>解决方案：forwardRef + useImperativeHandle</li>
</ul>
<p><strong>Q：useRef 和 useState 有何区别？</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">useRef</th>
<th align="left">useState</th>
</tr>
</thead>
<tbody><tr>
<td align="left">触发重渲染</td>
<td align="left">否</td>
<td align="left">是</td>
</tr>
<tr>
<td align="left">存储值类型</td>
<td align="left">可变对象（.current）</td>
<td align="left">不可变状态</td>
</tr>
<tr>
<td align="left">数据持久化</td>
<td align="left">组件生命周期</td>
<td align="left">状态更新保留</td>
</tr>
<tr>
<td align="left">典型用途</td>
<td align="left">DOM 引用&#x2F;计时器 ID</td>
<td align="left">渲染相关状态</td>
</tr>
</tbody></table>
<p><strong>Q：回调 Ref 有何特殊用途？</strong></p>
<p>(1) 动态绑定：可在运行时切换 ref 目标</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs HTML">&lt;input ref=&#123;condition ? ref1 : ref2&#125; /&gt;<br></code></pre></td></tr></table></figure>

<p>(2) 精细控制：元素挂载&#x2F;卸载时执行逻辑</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">measureRef</span> = (<span class="hljs-params">el</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (el) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;尺寸:&#x27;</span>, el.<span class="hljs-title function_">getBoundingClientRect</span>());<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<h3 id="总结：Refs-使用决策"><a href="#总结：Refs-使用决策" class="headerlink" title="总结：Refs 使用决策"></a>总结：Refs 使用决策</h3><pre class="mermaid">graph TD
  A[是否需要操作 DOM?] -->|是| B[使用 Ref]
  A -->|否| C[考虑 State]
  B --> D{组件类型?}
  D -->|函数组件| E[useRef + forwardRef]
  D -->|类组件| F[createRef]
  B --> G{需要暴露方法?}
  G -->|是| H[useImperativeHandle]
  G -->|否| I[直接访问 DOM]</pre>

<h1 id="第三章：Hooks-深度解析"><a href="#第三章：Hooks-深度解析" class="headerlink" title="第三章：Hooks 深度解析"></a>第三章：Hooks 深度解析</h1><h2 id="3-1-useState-与状态管理"><a href="#3-1-useState-与状态管理" class="headerlink" title="3.1 useState 与状态管理"></a>3.1 useState 与状态管理</h2><h3 id="基础概念概述-4"><a href="#基础概念概述-4" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><p><strong>useState 作用</strong>：函数组件中添加状态能力的 Hook，替代类组件的 this.state</p>
<p>基本语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>(initialValue);<br></code></pre></td></tr></table></figure>

<ul>
<li>state：当前状态值</li>
<li>setState：状态更新函数</li>
<li>initialValue：初始状态（支持惰性初始化）</li>
</ul>
<h3 id="核心机制深度解析-2"><a href="#核心机制深度解析-2" class="headerlink" title="核心机制深度解析"></a>核心机制深度解析</h3><p><strong>闭包状态快照原理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">increment</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);   <span class="hljs-comment">// 闭包捕获当前 count 值</span><br>    <br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(count);    <span class="hljs-comment">// 输出旧值（状态更新是异步的）</span><br>  &#125;;<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;increment&#125;</span>&gt;</span>&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>关键特性：</p>
<ul>
<li>每次渲染都有独立的函数作用域</li>
<li>状态更新函数调用时使用当次渲染的快照值</li>
<li>状态更新触发重新渲染（生成新的闭包）</li>
</ul>
<p><strong>函数式更新解决闭包陷阱</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 闭包陷阱（连续点击只增加1）</span><br><span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);<br><span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);<br><br><span class="hljs-comment">// ✅ 函数式更新（连续点击增加2）</span><br><span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>);<br><span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure>

<p>原理：更新函数接收 previous state 参数，React 保证这是最新状态</p>
<p><strong>状态批处理机制（React 18+）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c + <span class="hljs-number">1</span>);<br>  <span class="hljs-title function_">setFlag</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> !f);<br>  <span class="hljs-comment">// React 18：自动批处理为单次渲染</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p>事件循环中的表现：</p>
<pre class="mermaid">sequenceDiagram
  participant UI as 用户界面
  participant React as React 运行时
  UI->>React: 触发事件
  React->>React: 执行所有 setState
  React->>React: 合并状态更新
  React->>UI: 单次重渲染</pre>

<p><strong>惰性初始化（Lazy Initialization）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ✅ 避免重复计算初始值</span><br><span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> initialState = <span class="hljs-title function_">computeExpensiveValue</span>(props);<br>  <span class="hljs-keyword">return</span> initialState;<br>&#125;);<br></code></pre></td></tr></table></figure>

<ul>
<li>初始化函数仅在挂载时执行一次</li>
<li>避免重新渲染时重复计算</li>
</ul>
<h3 id="状态管理进阶模式"><a href="#状态管理进阶模式" class="headerlink" title="状态管理进阶模式"></a>状态管理进阶模式</h3><p><strong>状态依赖更新</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 当 count 变化时重置 page</span><br>  <span class="hljs-title function_">setPage</span>(<span class="hljs-number">1</span>);<br>&#125;, [count]); <span class="hljs-comment">// 依赖项触发状态重置</span><br></code></pre></td></tr></table></figure>

<p><strong>状态提升与下沉策略</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 状态提升：共享状态到共同祖先</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [sharedState, setSharedState] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ChildA</span> <span class="hljs-attr">state</span>=<span class="hljs-string">&#123;sharedState&#125;</span> <span class="hljs-attr">setState</span>=<span class="hljs-string">&#123;setSharedState&#125;</span> /&gt;</span></span><br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ChildB</span> <span class="hljs-attr">state</span>=<span class="hljs-string">&#123;sharedState&#125;</span> <span class="hljs-attr">setState</span>=<span class="hljs-string">&#123;setSharedState&#125;</span> /&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 状态下沉：缩小状态影响范围</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Component</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// 只有按钮依赖 count</span><br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ExpensiveComponent</span> /&gt;</span></span><br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">count</span>=<span class="hljs-string">&#123;count&#125;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setCount(c =&gt; c + 1)&#125; /&gt;</span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>状态合并模式</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 方案1：使用对象</span><br><span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>(&#123; <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">flag</span>: <span class="hljs-literal">false</span> &#125;);<br><span class="hljs-title function_">setState</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> (&#123; ...prev, <span class="hljs-attr">count</span>: prev.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> &#125;));<br><br><span class="hljs-comment">// 方案2：多个 useState</span><br><span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">const</span> [flag, setFlag] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><br><span class="hljs-comment">// 方案3：useReducer（复杂状态）</span><br><span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(reducer, &#123; <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">flag</span>: <span class="hljs-literal">false</span> &#125;);<br></code></pre></td></tr></table></figure>

<h3 id="高频面试题与破解方案-6"><a href="#高频面试题与破解方案-6" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么连续调用 setState 不更新？</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>); <span class="hljs-comment">// 本次渲染 count=0</span><br>  <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>); <span class="hljs-comment">// 本次渲染 count=0</span><br>  <span class="hljs-comment">// 结果：count 只增加1</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p>闭包捕获的 count 是当次渲染的固定值，解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ✅ 函数式更新</span><br><span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>);<br><span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure>

<p><strong>Q：useState 和 useRef 存储数据有何区别？</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">useState</th>
<th align="left">useRef</th>
</tr>
</thead>
<tbody><tr>
<td align="left">触发重渲染</td>
<td align="left">是</td>
<td align="left">否</td>
</tr>
<tr>
<td align="left">数据持久化</td>
<td align="left">跨渲染保留</td>
<td align="left">跨渲染保留</td>
</tr>
<tr>
<td align="left">数据访问</td>
<td align="left">直接使用 state</td>
<td align="left">通过 .current 访问</td>
</tr>
<tr>
<td align="left">更新方式</td>
<td align="left">setState 函数</td>
<td align="left">直接修改 .current</td>
</tr>
<tr>
<td align="left">典型用途</td>
<td align="left">驱动 UI 变化的状态</td>
<td align="left">DOM 引用&#x2F;不触发渲染的值</td>
</tr>
</tbody></table>
<p><strong>Q：如何实现状态重置？</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> initialUser = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;John&#x27;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> &#125;;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [user, setUser] = <span class="hljs-title function_">useState</span>(initialUser);<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">reset</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-comment">// ✅ 正确：重置为初始值</span><br>    <span class="hljs-title function_">setUser</span>(initialUser);<br>    <br>    <span class="hljs-comment">// ❌ 危险：可能导致引用问题</span><br>    <span class="hljs-comment">// setUser(&#123; name: &#x27;John&#x27;, age: 30 &#125;);</span><br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="性能优化技巧-1"><a href="#性能优化技巧-1" class="headerlink" title="性能优化技巧"></a>性能优化技巧</h3><p><strong>避免不必要状态</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 冗余状态（可从 props 派生）</span><br><span class="hljs-keyword">const</span> [fullName, setFullName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;name&#125;</span> <span class="hljs-subst">$&#123;surname&#125;</span>`</span>);<br><br><span class="hljs-comment">// ✅ 直接用计算值</span><br><span class="hljs-keyword">const</span> fullName = <span class="hljs-string">`<span class="hljs-subst">$&#123;name&#125;</span> <span class="hljs-subst">$&#123;surname&#125;</span>`</span>;<br></code></pre></td></tr></table></figure>

<p><strong>状态隔离减少重渲染</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 原始结构：状态变化导致整个组件重渲染</span><br><span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>(&#123; <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">2</span> &#125;);<br><br><span class="hljs-comment">// 优化方案：拆分为独立状态</span><br><span class="hljs-keyword">const</span> [a, setA] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">1</span>);<br><span class="hljs-keyword">const</span> [b, setB] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">2</span>);<br></code></pre></td></tr></table></figure>

<p><strong>状态记忆化</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <br>  <span class="hljs-comment">// ✅ 避免子组件不必要重渲染</span><br>  <span class="hljs-keyword">const</span> child = <span class="hljs-title function_">useMemo</span>(<br>    <span class="hljs-function">() =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ExpensiveChild</span> <span class="hljs-attr">count</span>=<span class="hljs-string">&#123;count&#125;</span> /&gt;</span></span>,<br>    [count] <span class="hljs-comment">// 仅 count 变化时更新</span><br>  );<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;child&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="与类组件状态对比"><a href="#与类组件状态对比" class="headerlink" title="与类组件状态对比"></a>与类组件状态对比</h3><table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">useState</th>
<th align="left">this.state</th>
</tr>
</thead>
<tbody><tr>
<td align="left">更新方式</td>
<td align="left">独立 set 函数</td>
<td align="left">this.setState({})</td>
</tr>
<tr>
<td align="left">状态合并</td>
<td align="left">不自动合并</td>
<td align="left">自动浅合并</td>
</tr>
<tr>
<td align="left">异步行为</td>
<td align="left">批处理更新</td>
<td align="left">批处理更新</td>
</tr>
<tr>
<td align="left">函数式更新</td>
<td align="left">setCount(prev &#x3D;&gt; prev+1)</td>
<td align="left">this.setState(prev &#x3D;&gt; {})</td>
</tr>
<tr>
<td align="left">初始化</td>
<td align="left">支持惰性初始化函数</td>
<td align="left">构造函数中初始化</td>
</tr>
</tbody></table>
<h3 id="React-18-新特性：自动批处理"><a href="#React-18-新特性：自动批处理" class="headerlink" title="React 18 新特性：自动批处理"></a>React 18 新特性：自动批处理</h3><p><strong>批处理范围扩展</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// React 17：只在事件处理函数中批处理</span><br><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">setCount</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// 立即渲染</span><br>  <span class="hljs-title function_">setFlag</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// 再次渲染</span><br>&#125;, <span class="hljs-number">100</span>);<br><br><span class="hljs-comment">// React 18：自动批处理所有更新</span><br><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">setCount</span>(<span class="hljs-number">1</span>);   <span class="hljs-comment">// 合并更新</span><br>  <span class="hljs-title function_">setFlag</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// 单次渲染</span><br>&#125;, <span class="hljs-number">100</span>);<br></code></pre></td></tr></table></figure>

<p><strong>紧急更新与非紧急更新</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; startTransition &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-comment">// 紧急更新（用户输入）</span><br><span class="hljs-title function_">setInputValue</span>(input);<br><br><span class="hljs-comment">// 标记非紧急更新（搜索结果）</span><br><span class="hljs-title function_">startTransition</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">setSearchQuery</span>(input);<br>&#125;);<br></code></pre></td></tr></table></figure>

<h2 id="3-2-useEffect-与副作用（依赖数组、清理函数）"><a href="#3-2-useEffect-与副作用（依赖数组、清理函数）" class="headerlink" title="3.2 useEffect 与副作用（依赖数组、清理函数）"></a>3.2 useEffect 与副作用（依赖数组、清理函数）</h2><h3 id="基础概念概述-5"><a href="#基础概念概述-5" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><p>useEffect 作用：处理副作用操作：数据获取、订阅管理、手动 DOM 操作等</p>
<p>核心参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 副作用逻辑</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123; <span class="hljs-comment">/* 清理函数 */</span> &#125;;<br>&#125;, [dependencies]); <span class="hljs-comment">// 依赖数组</span><br></code></pre></td></tr></table></figure>

<p>执行时机:</p>
<ul>
<li>组件挂载后（componentDidMount）</li>
<li>依赖项变化时（componentDidUpdate）</li>
<li>组件卸载前执行清理（componentWillUnmount）</li>
</ul>
<h3 id="依赖数组深度解析"><a href="#依赖数组深度解析" class="headerlink" title="依赖数组深度解析"></a>依赖数组深度解析</h3><p><strong>三种依赖模式对比</strong></p>
<table>
<thead>
<tr>
<th align="left">依赖数组</th>
<th align="left">执行时机</th>
<th align="left">常见用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[]</td>
<td align="left">仅挂载时执行一次</td>
<td align="left">初始化请求、事件订阅</td>
</tr>
<tr>
<td align="left">[dep1, dep2]</td>
<td align="left">依赖变化时执行</td>
<td align="left">数据请求、状态联动</td>
</tr>
<tr>
<td align="left">无依赖</td>
<td align="left">每次渲染后都执行</td>
<td align="left">极少使用（性能危险）</td>
</tr>
</tbody></table>
<p><strong>依赖项优化技巧</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 错误：缺少必要依赖</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">fetchData</span>(user.<span class="hljs-property">id</span>); <br>&#125;, []); <span class="hljs-comment">// 当 user.id 变化时不会重新请求</span><br><br><span class="hljs-comment">// ✅ 正确：包含所有依赖</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">fetchData</span>(user.<span class="hljs-property">id</span>);<br>&#125;, [user.<span class="hljs-property">id</span>]); <br><br><span class="hljs-comment">// ✅ 高级：函数式更新避免依赖</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>); <span class="hljs-comment">// 不依赖 count</span><br>  &#125;, <span class="hljs-number">1000</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(timer);<br>&#125;, []); <span class="hljs-comment">// 空依赖安全</span><br></code></pre></td></tr></table></figure>

<p><strong>依赖引用陷阱</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 问题：对象引用变化导致无限循环</span><br><span class="hljs-keyword">const</span> config = &#123; <span class="hljs-attr">timeout</span>: <span class="hljs-number">1000</span> &#125;;<br><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">startTimer</span>(config);<br>&#125;, [config]); <span class="hljs-comment">// 每次渲染 config 都是新对象</span><br><br><span class="hljs-comment">// ✅ 解决方案：useMemo 稳定引用</span><br><span class="hljs-keyword">const</span> config = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> (&#123; <span class="hljs-attr">timeout</span>: <span class="hljs-number">1000</span> &#125;), []);<br></code></pre></td></tr></table></figure>

<h3 id="清理函数高级用法"><a href="#清理函数高级用法" class="headerlink" title="清理函数高级用法"></a>清理函数高级用法</h3><p><strong>执行机制</strong></p>
<pre class="mermaid">sequenceDiagram
  participant Mount as 组件挂载
  participant Update as 依赖更新
  participant Unmount as 组件卸载
  Mount->>+Effect: 执行副作用
  Update->>+Cleanup: 执行旧清理函数
  Update->>+Effect: 执行新副作用
  Unmount->>+Cleanup: 执行清理函数</pre>

<p><strong>常见清理场景</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 1. 清除定时器</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-comment">/*...*/</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(timer);<br>&#125;, []);<br><br><span class="hljs-comment">// 2. 取消网络请求</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();<br>  <span class="hljs-title function_">fetch</span>(url, &#123; <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span> &#125;);<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> controller.<span class="hljs-title function_">abort</span>(); <span class="hljs-comment">// 取消未完成请求</span><br>&#125;, [url]);<br><br><span class="hljs-comment">// 3. 移除事件监听</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleResize</span> = (<span class="hljs-params"></span>) =&gt; &#123;<span class="hljs-comment">/*...*/</span>&#125;;<br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, handleResize);<br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, handleResize);<br>&#125;, []);<br></code></pre></td></tr></table></figure>

<p><strong>清理函数闭包特性</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(count); <span class="hljs-comment">// 总是初始值（闭包陷阱）</span><br>  &#125;, <span class="hljs-number">1000</span>);<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(timer);<br>&#125;, []);<br><br><span class="hljs-comment">// ✅ 解决方案：使用 ref 保存最新值</span><br><span class="hljs-keyword">const</span> countRef = <span class="hljs-title function_">useRef</span>(count);<br>countRef.<span class="hljs-property">current</span> = count;<br><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(countRef.<span class="hljs-property">current</span>); <span class="hljs-comment">// 最新值</span><br>  &#125;, <span class="hljs-number">1000</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(timer);<br>&#125;, []);<br></code></pre></td></tr></table></figure>

<h3 id="高频面试题与破解方案-7"><a href="#高频面试题与破解方案-7" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：如何避免 useEffect 无限循环？</strong></p>
<p>常见原因：</p>
<ul>
<li>副作用内更新依赖项状态</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 危险：更新状态触发重渲染</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>); <br>&#125;, [count]); <span class="hljs-comment">// 每次count变化又触发</span><br></code></pre></td></tr></table></figure>

<ul>
<li>依赖引用类型未优化</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 对象字面量导致无限循环</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;, [&#123; data &#125;]); <span class="hljs-comment">// 每次新对象</span><br></code></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ✅ 方案1：检查依赖链，移除不必要的状态更新</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (needsUpdate) <span class="hljs-title function_">fetchData</span>(); <span class="hljs-comment">// 条件执行</span><br>&#125;, [data]);<br><br><span class="hljs-comment">// ✅ 方案2：使用 useMemo 稳定依赖</span><br><span class="hljs-keyword">const</span> stableData = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> data, [data.<span class="hljs-property">id</span>]);<br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<span class="hljs-comment">/*...*/</span>&#125;, [stableData]);<br></code></pre></td></tr></table></figure>

<p><strong>Q：为什么严格模式下 useEffect 执行两次？</strong></p>
<p>React 18 严格模式行为：</p>
<ul>
<li>开发环境故意双调用组件（挂载 → 卸载 → 挂载）</li>
<li>目的：暴露未正确清理的副作用</li>
<li>生产环境无此行为</li>
</ul>
<p>正确应对：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>();<br>  connection.<span class="hljs-title function_">connect</span>();<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>(); <span class="hljs-comment">// ✅ 确保完全清理</span><br>&#125;, []);<br></code></pre></td></tr></table></figure>

<p><strong>Q：useEffect 和 useLayoutEffect 有何区别？</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">useEffect</th>
<th align="left">useLayoutEffect</th>
</tr>
</thead>
<tbody><tr>
<td align="left">执行时机</td>
<td align="left">浏览器绘制后异步执行</td>
<td align="left">DOM 更新后，绘制前同步执行</td>
</tr>
<tr>
<td align="left">阻塞渲染</td>
<td align="left">否</td>
<td align="left">是</td>
</tr>
<tr>
<td align="left">使用场景</td>
<td align="left">数据获取、订阅等</td>
<td align="left">DOM 测量、同步样式变更</td>
</tr>
<tr>
<td align="left">服务端渲染</td>
<td align="left">正常执行</td>
<td align="left">警告（需用 useEffect 替代）</td>
</tr>
</tbody></table>
<h3 id="自定义-Hook-封装"><a href="#自定义-Hook-封装" class="headerlink" title="自定义 Hook 封装"></a>自定义 Hook 封装</h3><p><strong>通用数据请求 Hook</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useFetch</span>(<span class="hljs-params">url, initialData</span>) &#123;<br>  <span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title function_">useState</span>(initialData);<br>  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> isActive = <span class="hljs-literal">true</span>;<br>    <br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);<br>      <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url);<br>        <span class="hljs-keyword">if</span> (isActive) <span class="hljs-title function_">setData</span>(<span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>());<br>      &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">if</span> (isActive) <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);<br>      &#125;<br>    &#125;;<br>    <br>    <span class="hljs-title function_">fetchData</span>();<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123; isActive = <span class="hljs-literal">false</span> &#125;;<br>  &#125;, [url]);<br>  <br>  <span class="hljs-keyword">return</span> &#123; data, loading &#125;;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> &#123; data, loading &#125; = <span class="hljs-title function_">useFetch</span>(<span class="hljs-string">&#x27;/api/user&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p><strong>事件监听 Hook</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useEventListener</span>(<span class="hljs-params">eventName, handler, element = <span class="hljs-variable language_">window</span></span>) &#123;<br>  <span class="hljs-keyword">const</span> savedHandler = <span class="hljs-title function_">useRef</span>();<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    savedHandler.<span class="hljs-property">current</span> = handler;<br>  &#125;, [handler]);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">eventListener</span> = e =&gt; savedHandler.<span class="hljs-title function_">current</span>(e);<br>    element.<span class="hljs-title function_">addEventListener</span>(eventName, eventListener);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> element.<span class="hljs-title function_">removeEventListener</span>(eventName, eventListener);<br>  &#125;, [eventName, element]);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-3-useContext-与全局状态共享"><a href="#3-3-useContext-与全局状态共享" class="headerlink" title="3.3 useContext 与全局状态共享"></a>3.3 useContext 与全局状态共享</h2><h3 id="基础概念概述-6"><a href="#基础概念概述-6" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><p>useContext 作用：解决组件跨层级通信问题，避免 Props drilling（属性钻探）</p>
<p>核心三要素</p>
<ul>
<li>React.createContext()：创建上下文对象</li>
<li><code>&lt;Context.Provider&gt;</code>：提供数据</li>
<li>useContext()：消费数据</li>
</ul>
<p>典型场景:主题切换、用户认证、多语言、全局配置等跨组件共享数据</p>
<h3 id="上下文工作流程详解"><a href="#上下文工作流程详解" class="headerlink" title="上下文工作流程详解"></a>上下文工作流程详解</h3><pre class="mermaid">graph TD
  A[创建Context] --> B[Provider 提供数据]
  B --> C[子组件消费数据]
  C --> D{消费方式}
  D --> E[useContext Hook]
  D --> F[Context.Consumer]
  D --> G[Class.contextType]</pre>

<p>完整使用示例:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 1. 创建上下文</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ThemeContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createContext</span>(<span class="hljs-string">&#x27;light&#x27;</span>); <span class="hljs-comment">// 默认值</span><br><br><span class="hljs-comment">// 2. Provider 提供数据</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [theme, setTheme] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;dark&#x27;</span>);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">theme</span>, <span class="hljs-attr">setTheme</span> &#125;&#125;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Content</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Provider</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 3. 函数组件消费</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Header</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; theme &#125; = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ThemeContext</span>);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;theme&#125;</span>&gt;</span>标题<span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-comment">// 4. 类组件消费</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Content</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  <span class="hljs-keyword">static</span> contextType = <span class="hljs-title class_">ThemeContext</span>; <span class="hljs-comment">// 类组件绑定</span><br>  <br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; theme &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;theme&#125;</span>&gt;</span>内容<span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="高级应用模式"><a href="#高级应用模式" class="headerlink" title="高级应用模式"></a>高级应用模式</h3><p><strong>自定义 Hook 封装</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 创建自定义上下文 Hook</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useTheme</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> context = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ThemeContext</span>);<br>  <span class="hljs-keyword">if</span> (!context) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;useTheme 必须在 ThemeProvider 内使用&#x27;</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> context;<br>&#125;<br><br><span class="hljs-comment">// 在组件中使用</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ThemedButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; theme, toggleTheme &#125; = <span class="hljs-title function_">useTheme</span>();<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;toggleTheme&#125;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;theme&#125;</span>&gt;</span></span><br><span class="language-xml">      切换主题</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="高频面试题与破解方案-8"><a href="#高频面试题与破解方案-8" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：Context 与 Redux 如何选择？</strong></p>
<p>决策矩阵：</p>
<table>
<thead>
<tr>
<th align="left">考量因素</th>
<th align="left">Context</th>
<th align="left">Redux</th>
</tr>
</thead>
<tbody><tr>
<td align="left">使用复杂度</td>
<td align="left">简单</td>
<td align="left">复杂（action&#x2F;reducer）</td>
</tr>
<tr>
<td align="left">性能优化</td>
<td align="left">需手动优化</td>
<td align="left">内置精细更新</td>
</tr>
<tr>
<td align="left">中间件支持</td>
<td align="left">不支持</td>
<td align="left">支持（thunk&#x2F;saga）</td>
</tr>
<tr>
<td align="left">调试工具</td>
<td align="left">无</td>
<td align="left">Redux DevTools</td>
</tr>
<tr>
<td align="left">适用场景</td>
<td align="left">低频更新数据（主题&#x2F;用户）</td>
<td align="left">高频更新&#x2F;复杂状态逻辑</td>
</tr>
</tbody></table>
<p>总结：</p>
<ul>
<li>中小应用：Context + useReducer</li>
<li>大型应用：Redux&#x2F;Zustand</li>
</ul>
<p><strong>Q：为什么 Context 会导致不必要的重渲染？</strong></p>
<p>根本原因：</p>
<p>Context 使用 值比较（value comparison），当 Provider 的 value 变化时，所有消费该 Context 的组件都会重渲染，无论是否使用变化的部分。</p>
<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 1. 拆分 Context（如前文示例）</span><br><span class="hljs-comment">// 2. 使用 React.memo 优化子组件</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ExpensiveComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-function">() =&gt;</span> &#123; ... &#125;);<br><br><span class="hljs-comment">// 3. 使用选择器库（use-context-selector）</span><br></code></pre></td></tr></table></figure>

<p><strong>Q：如何检测 Context 未提供？</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 创建时设置默认值（生产环境有用）</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ThemeContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-string">&#x27;light&#x27;</span>);<br><br><span class="hljs-comment">// 自定义 Hook 添加检测</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useTheme</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> context = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ThemeContext</span>);<br>  <br>  <span class="hljs-keyword">if</span> (context === <span class="hljs-literal">undefined</span>) &#123; <span class="hljs-comment">// 未提供时使用默认值</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;light&#x27;</span>;<br>  &#125;<br>  <br>  <span class="hljs-keyword">return</span> context;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-4-useReducer-与复杂状态逻辑"><a href="#3-4-useReducer-与复杂状态逻辑" class="headerlink" title="3.4 useReducer 与复杂状态逻辑"></a>3.4 useReducer 与复杂状态逻辑</h2><h3 id="基础概念概述-7"><a href="#基础概念概述-7" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><p>useReducer 作用：管理复杂状态逻辑的 Hook，是 useState 的替代方案，借鉴 Redux 的核心思想</p>
<p>核心参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(reducer, initialState, initFunc);<br></code></pre></td></tr></table></figure>

<ul>
<li>reducer：状态更新函数 (state, action) &#x3D;&gt; newState</li>
<li>initialState：初始状态</li>
<li>initFunc：惰性初始化函数（可选）</li>
</ul>
<p>三大要素:</p>
<ul>
<li>State：应用的状态数据</li>
<li>Action：描述状态变化的普通对象</li>
<li>Dispatch：触发状态更新的函数 dispatch(action)</li>
</ul>
<h3 id="核心机制深度解析-3"><a href="#核心机制深度解析-3" class="headerlink" title="核心机制深度解析"></a>核心机制深度解析</h3><p><strong>Reducer 函数工作原理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 典型 reducer 结构</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">reducer</span>(<span class="hljs-params">state, action</span>) &#123;<br>  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;increment&#x27;</span>:<br>      <span class="hljs-keyword">return</span> &#123; ...state, <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> &#125;;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;decrement&#x27;</span>:<br>      <span class="hljs-keyword">return</span> &#123; ...state, <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span> &#125;;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;set_user&#x27;</span>:<br>      <span class="hljs-keyword">return</span> &#123; ...state, <span class="hljs-attr">user</span>: action.<span class="hljs-property">payload</span> &#125;;<br>    <span class="hljs-attr">default</span>:<br>      <span class="hljs-keyword">return</span> state; <span class="hljs-comment">// 必须返回默认状态</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>状态更新流程</strong></p>
<pre class="mermaid">sequenceDiagram
  participant Component as 组件
  participant Reducer as Reducer函数
  participant React as React运行时
  
  Component->>Reducer: dispatch({ type: 'increment' })
  Reducer->>Reducer: 计算新状态 (state + 1)
  Reducer->>React: 返回新状态
  React->>Component: 触发重渲染</pre>

<p><strong>与 useState 对比</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">useReducer</th>
<th align="left">useState</th>
</tr>
</thead>
<tbody><tr>
<td align="left">适用场景</td>
<td align="left">复杂状态逻辑</td>
<td align="left">简单状态</td>
</tr>
<tr>
<td align="left">状态结构</td>
<td align="left">对象&#x2F;复杂结构</td>
<td align="left">任意类型</td>
</tr>
<tr>
<td align="left">更新逻辑</td>
<td align="left">集中管理（reducer）</td>
<td align="left">分散在组件中</td>
</tr>
<tr>
<td align="left">性能优化</td>
<td align="left">容易避免不必要更新</td>
<td align="left">需手动优化</td>
</tr>
<tr>
<td align="left">测试</td>
<td align="left">纯函数易于测试</td>
<td align="left">需渲染组件测试</td>
</tr>
</tbody></table>
<h3 id="高级应用模式-1"><a href="#高级应用模式-1" class="headerlink" title="高级应用模式"></a>高级应用模式</h3><p><strong>中间件模式（类似 Redux）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 增强 dispatch 函数</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useReducerWithMiddleware</span>(<span class="hljs-params">reducer, initialState</span>) &#123;<br>  <span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(reducer, initialState);<br>  <br>  <span class="hljs-comment">// 支持中间件链</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">dispatchWithMiddleware</span> = action =&gt; &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Action:&#x27;</span>, action); <span class="hljs-comment">// 日志中间件</span><br>    <span class="hljs-title function_">dispatch</span>(action); <span class="hljs-comment">// 继续传递</span><br>  &#125;;<br>  <br>  <span class="hljs-keyword">return</span> [state, dispatchWithMiddleware];<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="复杂状态管理实战"><a href="#复杂状态管理实战" class="headerlink" title="复杂状态管理实战"></a>复杂状态管理实战</h3><p><strong>表单状态管理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">formReducer</span>(<span class="hljs-params">state, action</span>) &#123;<br>  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;change_field&#x27;</span>:<br>      <span class="hljs-keyword">return</span> &#123;<br>        ...state,<br>        [action.<span class="hljs-property">field</span>]: action.<span class="hljs-property">value</span>,<br>        <span class="hljs-attr">touched</span>: &#123; ...state.<span class="hljs-property">touched</span>, [action.<span class="hljs-property">field</span>]: <span class="hljs-literal">true</span> &#125;<br>      &#125;;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;validate&#x27;</span>:<br>      <span class="hljs-keyword">return</span> &#123; ...state, <span class="hljs-attr">errors</span>: <span class="hljs-title function_">validateForm</span>(state) &#125;;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;submit&#x27;</span>:<br>      <span class="hljs-keyword">return</span> &#123; ...state, <span class="hljs-attr">isSubmitting</span>: <span class="hljs-literal">true</span> &#125;;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;submit_success&#x27;</span>:<br>      <span class="hljs-keyword">return</span> &#123; ...initialState, <span class="hljs-attr">submitSuccess</span>: <span class="hljs-literal">true</span> &#125;;<br>    <span class="hljs-attr">default</span>:<br>      <span class="hljs-keyword">return</span> state;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(formReducer, initialState);<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChange</span> = (<span class="hljs-params">e</span>) =&gt; &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;change_field&#x27;</span>,<br>      <span class="hljs-attr">field</span>: e.<span class="hljs-property">target</span>.<span class="hljs-property">name</span>,<br>      <span class="hljs-attr">value</span>: e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span><br>    &#125;);<br>  &#125;;<br>  <br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>异步操作管理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">asyncReducer</span>(<span class="hljs-params">state, action</span>) &#123;<br>  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;FETCH_START&#x27;</span>:<br>      <span class="hljs-keyword">return</span> &#123; ...state, <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span> &#125;;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;FETCH_SUCCESS&#x27;</span>:<br>      <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">data</span>: action.<span class="hljs-property">payload</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span> &#125;;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;FETCH_FAILURE&#x27;</span>:<br>      <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">error</span>: action.<span class="hljs-property">error</span> &#125;;<br>    <span class="hljs-attr">default</span>:<br>      <span class="hljs-keyword">return</span> state;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params">&#123; userId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(asyncReducer, &#123;<br>    <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>,<br>    <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span><br>  &#125;);<br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchUser</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>      <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;FETCH_START&#x27;</span> &#125;);<br>      <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>(userId);<br>        <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;FETCH_SUCCESS&#x27;</span>, <span class="hljs-attr">payload</span>: data &#125;);<br>      &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>        <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;FETCH_FAILURE&#x27;</span>, error &#125;);<br>      &#125;<br>    &#125;;<br>    <br>    <span class="hljs-title function_">fetchUser</span>();<br>  &#125;, [userId]);<br>  <br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>状态机模式（XState 思想）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">stateMachineReducer</span>(<span class="hljs-params">state, action</span>) &#123;<br>  <span class="hljs-keyword">switch</span> (state.<span class="hljs-property">status</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;idle&#x27;</span>:<br>      <span class="hljs-keyword">if</span> (action.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;FETCH&#x27;</span>) <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;loading&#x27;</span> &#125;;<br>      <span class="hljs-keyword">return</span> state;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;loading&#x27;</span>:<br>      <span class="hljs-keyword">if</span> (action.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;SUCCESS&#x27;</span>) <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;success&#x27;</span>, <span class="hljs-attr">data</span>: action.<span class="hljs-property">data</span> &#125;;<br>      <span class="hljs-keyword">if</span> (action.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;FAILURE&#x27;</span>) <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-attr">error</span>: action.<span class="hljs-property">error</span> &#125;;<br>      <span class="hljs-keyword">return</span> state;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;success&#x27;</span>:<br>      <span class="hljs-keyword">if</span> (action.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;RESET&#x27;</span>) <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;idle&#x27;</span> &#125;;<br>      <span class="hljs-keyword">return</span> state;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;error&#x27;</span>:<br>      <span class="hljs-keyword">if</span> (action.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;RETRY&#x27;</span>) <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;loading&#x27;</span> &#125;;<br>      <span class="hljs-keyword">return</span> state;<br>    <span class="hljs-attr">default</span>:<br>      <span class="hljs-keyword">return</span> state;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="高频面试题与破解方案-9"><a href="#高频面试题与破解方案-9" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：何时该用 useReducer 而不是 useState？</strong></p>
<p>决策树：</p>
<pre class="mermaid">graph TD
  A[状态结构复杂?] -->|是| B[useReducer]
  A -->|否| C{状态更新逻辑复杂?}
  C -->|是| B
  C -->|否| D[useState]
  E[需要跨组件更新?] -->|是| B
  F[需要可预测状态?] -->|是| B</pre>

<p><strong>Q：如何避免 reducer 函数过大？</strong></p>
<p>优化策略：</p>
<ul>
<li>拆分 reducer：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">rootReducer</span>(<span class="hljs-params">state, action</span>) &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">user</span>: <span class="hljs-title function_">userReducer</span>(state.<span class="hljs-property">user</span>, action),<br>    <span class="hljs-attr">posts</span>: <span class="hljs-title function_">postsReducer</span>(state.<span class="hljs-property">posts</span>, action)<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>组合 action 创建函数：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> actions = &#123;<br>  <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> (&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;increment&#x27;</span> &#125;),<br>  <span class="hljs-attr">addTodo</span>: <span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span> (&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;add_todo&#x27;</span>, <span class="hljs-attr">payload</span>: text &#125;)<br>&#125;;<br><span class="hljs-comment">// 使用：dispatch(actions.increment())</span><br></code></pre></td></tr></table></figure>

<p><strong>Q：useReducer 如何实现时间旅行调试？</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 1. 添加历史记录</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">reducerWithHistory</span>(<span class="hljs-params">state, action</span>) &#123;<br>  <span class="hljs-keyword">const</span> nextState = <span class="hljs-title function_">reducer</span>(state.<span class="hljs-property">current</span>, action);<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">current</span>: nextState,<br>    <span class="hljs-attr">history</span>: [...state.<span class="hljs-property">history</span>, &#123; action, <span class="hljs-attr">state</span>: nextState &#125;]<br>  &#125;;<br>&#125;<br><br><span class="hljs-comment">// 2. 实现撤销/重做</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">undoableReducer</span>(<span class="hljs-params">state, action</span>) &#123;<br>  <span class="hljs-keyword">if</span> (action.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;UNDO&#x27;</span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123; ...state, <span class="hljs-attr">current</span>: state.<span class="hljs-property">history</span>[state.<span class="hljs-property">history</span>.<span class="hljs-property">length</span> - <span class="hljs-number">2</span>] &#125;;<br>  &#125;<br>  <span class="hljs-comment">// ...其他action处理</span><br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(undoableReducer, &#123;<br>  <span class="hljs-attr">current</span>: initialState,<br>  <span class="hljs-attr">history</span>: [initialState]<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="与-Context-集成"><a href="#与-Context-集成" class="headerlink" title="与 Context 集成"></a>与 Context 集成</h3><p><strong>全局状态管理方案</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 创建 Context</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">StateContext</span> = <span class="hljs-title function_">createContext</span>();<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">DispatchContext</span> = <span class="hljs-title function_">createContext</span>();<br><br><span class="hljs-comment">// 全局 Provider</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">AppProvider</span>(<span class="hljs-params">&#123; children &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(rootReducer, initialState);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">StateContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;state&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">DispatchContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;dispatch&#125;</span>&gt;</span></span><br><span class="language-xml">        &#123;children&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">DispatchContext.Provider</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">StateContext.Provider</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 自定义 Hook 访问</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useAppState</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">StateContext</span>);<br>  <span class="hljs-keyword">if</span> (!state) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;必须在 AppProvider 内使用&#x27;</span>);<br>  <span class="hljs-keyword">return</span> state;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useAppDispatch</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">DispatchContext</span>);<br>  <span class="hljs-keyword">if</span> (!dispatch) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;必须在 AppProvider 内使用&#x27;</span>);<br>  <span class="hljs-keyword">return</span> dispatch;<br>&#125;<br><br><span class="hljs-comment">// 组件中使用</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">useAppState</span>();<br>  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useAppDispatch</span>();<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &#x27;increment&#x27; &#125;)&#125;&gt;</span><br><span class="language-xml">      &#123;state.count&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="最佳实践总结"><a href="#最佳实践总结" class="headerlink" title="最佳实践总结"></a>最佳实践总结</h3><ol>
<li>纯函数原则：Reducer 必须是纯函数，不产生副作用</li>
<li>不可变更新：始终返回新状态对象，不修改原状态</li>
<li>类型安全：使用 TypeScript 强化 action 类型</li>
</ol>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Action</span> = <br>  | &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;increment&#x27;</span> &#125;<br>  | &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;decrement&#x27;</span> &#125;<br>  | &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;set_count&#x27;</span>; <span class="hljs-attr">payload</span>: <span class="hljs-built_in">number</span> &#125;;<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>逻辑复用：提取 reducer 到独立文件便于测试</li>
<li>合理拆分：大型应用按功能域拆分多个 reducer</li>
<li>避免过度：简单状态仍使用 useState</li>
</ol>
<h3 id="使用场景决策逻辑"><a href="#使用场景决策逻辑" class="headerlink" title="使用场景决策逻辑"></a>使用场景决策逻辑</h3><pre class="mermaid">graph TD
  A[状态管理需求] --> B{状态结构}
  B -->|简单值| C[useState]
  B -->|复杂对象| D{更新逻辑}
  D -->|简单| C
  D -->|复杂| E[useReducer]
  A --> F{状态共享范围}
  F -->|组件内| G[useState/useReducer]
  F -->|跨组件| H[Context + useReducer]
  A --> I{需要时间旅行/撤销}
  I -->|是| E</pre>

<h2 id="3-5-自定义-Hooks（封装可复用逻辑）"><a href="#3-5-自定义-Hooks（封装可复用逻辑）" class="headerlink" title="3.5 自定义 Hooks（封装可复用逻辑）"></a>3.5 自定义 Hooks（封装可复用逻辑）</h2><h3 id="基础概念概述-8"><a href="#基础概念概述-8" class="headerlink" title="基础概念概述"></a>基础概念概述</h3><p>自定义 Hook 是什么：将组件逻辑提取到可重用的 JavaScript 函数中的技术，是 React 逻辑复用的终极解决方案</p>
<p>核心特征：</p>
<ul>
<li>名称以 use 开头（如 useFetch）</li>
<li>可以调用其他 Hook（如 useState, useEffect）</li>
<li>不包含 UI 渲染，只包含状态逻辑</li>
</ul>
<p>与普通函数的区别：</p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">自定义 Hook</th>
<th align="left">工具函数</th>
</tr>
</thead>
<tbody><tr>
<td align="left">可调用其他 Hook</td>
<td align="left">✅</td>
<td align="left">❌</td>
</tr>
<tr>
<td align="left">状态隔离</td>
<td align="left">每次调用独立状态</td>
<td align="left">无状态&#x2F;静态</td>
</tr>
<tr>
<td align="left">使用场景</td>
<td align="left">组件逻辑复用</td>
<td align="left">数据处理&#x2F;工具类</td>
</tr>
</tbody></table>
<h3 id="核心机制深度解析-4"><a href="#核心机制深度解析-4" class="headerlink" title="核心机制深度解析"></a>核心机制深度解析</h3><p><strong>状态隔离原理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 自定义 Hook</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useCounter</span>(<span class="hljs-params">initialValue = <span class="hljs-number">0</span></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(initialValue);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">increment</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c + <span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">return</span> [count, increment];<br>&#125;<br><br><span class="hljs-comment">// 组件A使用</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ComponentA</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [countA, incA] = <span class="hljs-title function_">useCounter</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// 独立状态</span><br>&#125;<br><br><span class="hljs-comment">// 组件B使用</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ComponentB</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [countB, incB] = <span class="hljs-title function_">useCounter</span>(<span class="hljs-number">10</span>); <span class="hljs-comment">// 独立状态</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>关键原理：每次调用自定义 Hook 都会创建独立的状态副本（闭包机制）</p>
<p><strong>Hook 调用规则</strong></p>
<pre class="mermaid">graph LR
  A[函数组件] --> B[调用自定义Hook]
  B --> C[内部调用React Hook]
  C --> D[返回状态和逻辑]
  D --> A</pre>

<p>强制规则：</p>
<ul>
<li>只在 React 函数组件或自定义 Hook 中调用</li>
<li>只在顶层调用（不能在条件&#x2F;循环中使用）</li>
<li>命名必须以 use 开头</li>
</ul>
<h3 id="设计模式与最佳实践"><a href="#设计模式与最佳实践" class="headerlink" title="设计模式与最佳实践"></a>设计模式与最佳实践</h3><p><strong>参数传递与返回值</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 灵活的参数设计</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useToggle</span>(<span class="hljs-params">initial = <span class="hljs-literal">false</span></span>) &#123;<br>  <span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>(initial);<br>  <br>  <span class="hljs-comment">// 支持直接设置或切换</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">toggle</span> = (<span class="hljs-params">value</span>) =&gt; &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">&#x27;boolean&#x27;</span>) &#123;<br>      <span class="hljs-title function_">setState</span>(value);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">setState</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> !prev);<br>    &#125;<br>  &#125;;<br>  <br>  <span class="hljs-comment">// 返回状态和控制方法</span><br>  <span class="hljs-keyword">return</span> [state, toggle];<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> [isOpen, toggleOpen] = <span class="hljs-title function_">useToggle</span>(<span class="hljs-literal">false</span>);<br></code></pre></td></tr></table></figure>

<p><strong>组合 Hook 模式</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 组合多个 Hook 创建复杂逻辑</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useUserProfile</span>(<span class="hljs-params">userId</span>) &#123;<br>  <span class="hljs-keyword">const</span> [user, loading, error] = <span class="hljs-title function_">useFetch</span>(<span class="hljs-string">`/api/users/<span class="hljs-subst">$&#123;userId&#125;</span>`</span>);<br>  <span class="hljs-keyword">const</span> [preferences, setPrefs] = <span class="hljs-title function_">useLocalStorage</span>(<span class="hljs-string">`prefs_<span class="hljs-subst">$&#123;userId&#125;</span>`</span>, &#123;&#125;);<br>  <span class="hljs-keyword">const</span> [notifications, addNotification] = <span class="hljs-title function_">useNotifications</span>();<br>  <br>  <span class="hljs-keyword">return</span> &#123;<br>    user,<br>    preferences,<br>    <span class="hljs-attr">setPreferences</span>: setPrefs,<br>    notifications,<br>    addNotification,<br>    loading,<br>    error<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>依赖注入模式</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 创建可配置的自定义 Hook</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useAPI</span>(<span class="hljs-params">endpoint, options = &#123;&#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <br>  <span class="hljs-keyword">const</span> fetchData = <span class="hljs-title function_">useCallback</span>(<span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(endpoint, options);<br>      <span class="hljs-title function_">setData</span>(<span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>());<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);<br>    &#125;<br>  &#125;, [endpoint, options]);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">fetchData</span>();<br>  &#125;, [fetchData]);<br>  <br>  <span class="hljs-keyword">return</span> &#123; data, loading, <span class="hljs-attr">refetch</span>: fetchData &#125;;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> userAPI = <span class="hljs-title function_">useAPI</span>(<span class="hljs-string">&#x27;/api/users&#x27;</span>, &#123; <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;GET&#x27;</span> &#125;);<br></code></pre></td></tr></table></figure>

<h3 id="高频面试题与破解方案-10"><a href="#高频面试题与破解方案-10" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：自定义 Hook 和 HOC（高阶组件）&#x2F;Render Props 有何区别？</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">自定义 Hook</th>
<th align="left">HOC</th>
<th align="left">Render Props</th>
</tr>
</thead>
<tbody><tr>
<td align="left">逻辑复用方式</td>
<td align="left">直接调用 Hook</td>
<td align="left">包装组件</td>
<td align="left">通过 props 渲染</td>
</tr>
<tr>
<td align="left">组件层级</td>
<td align="left">无额外层级</td>
<td align="left">增加包装层级</td>
<td align="left">增加回调层级</td>
</tr>
<tr>
<td align="left">命名冲突</td>
<td align="left">无</td>
<td align="left">可能发生</td>
<td align="left">可能发生</td>
</tr>
<tr>
<td align="left">调试难度</td>
<td align="left">简单</td>
<td align="left">组件树变深</td>
<td align="left">回调嵌套复杂</td>
</tr>
<tr>
<td align="left">TypeScript 支持</td>
<td align="left">优秀</td>
<td align="left">类型推导复杂</td>
<td align="left">类型推导中等</td>
</tr>
</tbody></table>
<p>结论：<br>自定义 Hook 是 React 官方推荐的逻辑复用方案，解决了 HOC 和 Render Props 的嵌套问题</p>
<p><strong>Q：如何测试自定义 Hook？</strong></p>
<p>测试策略：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 使用 @testing-library/react-hooks</span><br><span class="hljs-keyword">import</span> &#123; renderHook, act &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@testing-library/react-hooks&#x27;</span>;<br><br><span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;should use counter&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> &#123; result &#125; = <span class="hljs-title function_">renderHook</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">useCounter</span>());<br>  <br>  <span class="hljs-title function_">expect</span>(result.<span class="hljs-property">current</span>[<span class="hljs-number">0</span>]).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// 初始值</span><br>  <br>  <span class="hljs-title function_">act</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    result.<span class="hljs-property">current</span>[<span class="hljs-number">1</span>](); <span class="hljs-comment">// 执行 increment</span><br>  &#125;);<br>  <br>  <span class="hljs-title function_">expect</span>(result.<span class="hljs-property">current</span>[<span class="hljs-number">0</span>]).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 更新后值</span><br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>Q：自定义 Hook 会导致内存泄漏吗？</strong></p>
<p>风险与防范：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useEventListener</span>(<span class="hljs-params">eventName, handler, element = <span class="hljs-variable language_">window</span></span>) &#123;<br>  <span class="hljs-keyword">const</span> savedHandler = <span class="hljs-title function_">useRef</span>();<br>  <br>  <span class="hljs-comment">// 保存最新处理函数</span><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    savedHandler.<span class="hljs-property">current</span> = handler;<br>  &#125;, [handler]);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">eventListener</span> = event =&gt; savedHandler.<span class="hljs-title function_">current</span>(event);<br>    element.<span class="hljs-title function_">addEventListener</span>(eventName, eventListener);<br>    <br>    <span class="hljs-comment">// ✅ 必须返回清理函数</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> element.<span class="hljs-title function_">removeEventListener</span>(eventName, eventListener);<br>  &#125;, [eventName, element]); <span class="hljs-comment">// 依赖变化时重新绑定</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="实践案例"><a href="#实践案例" class="headerlink" title="实践案例"></a>实践案例</h3><p><strong>权限控制 Hook</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">usePermission</span>(<span class="hljs-params">requiredPermission</span>) &#123;<br>  <span class="hljs-keyword">const</span> [user] = <span class="hljs-title function_">useAuth</span>();<br>  <span class="hljs-keyword">const</span> [hasPermission, setHasPermission] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (!user) <span class="hljs-keyword">return</span>;<br>    <br>    <span class="hljs-comment">// 异步检查权限（如调用API）</span><br>    <span class="hljs-title function_">checkPermission</span>(user.<span class="hljs-property">id</span>, requiredPermission).<span class="hljs-title function_">then</span>(setHasPermission);<br>  &#125;, [user, requiredPermission]);<br>  <br>  <span class="hljs-keyword">return</span> hasPermission;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">AdminPanel</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> canEdit = <span class="hljs-title function_">usePermission</span>(<span class="hljs-string">&#x27;admin_edit&#x27;</span>);<br>  <br>  <span class="hljs-keyword">return</span> canEdit ? <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Editor</span> /&gt;</span></span> : <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">PermissionDenied</span> /&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>状态机 Hook</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useStateMachine</span>(<span class="hljs-params">states, initialState</span>) &#123;<br>  <span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>(initialState);<br>  <br>  <span class="hljs-keyword">const</span> transition = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> currentState = state;<br>    <span class="hljs-keyword">const</span> nextState = states[currentState]?.[event];<br>    <br>    <span class="hljs-keyword">if</span> (!nextState) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`无效转换: <span class="hljs-subst">$&#123;currentState&#125;</span> -&gt; <span class="hljs-subst">$&#123;event&#125;</span>`</span>);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-title function_">setState</span>(nextState);<br>  &#125;, [state, states]);<br>  <br>  <span class="hljs-keyword">return</span> [state, transition];<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> [state, transition] = <span class="hljs-title function_">useStateMachine</span>(&#123;<br>  <span class="hljs-attr">idle</span>: &#123; <span class="hljs-attr">START</span>: <span class="hljs-string">&#x27;running&#x27;</span> &#125;,<br>  <span class="hljs-attr">running</span>: &#123; <span class="hljs-attr">PAUSE</span>: <span class="hljs-string">&#x27;paused&#x27;</span>, <span class="hljs-attr">COMPLETE</span>: <span class="hljs-string">&#x27;done&#x27;</span> &#125;,<br>  <span class="hljs-attr">paused</span>: &#123; <span class="hljs-attr">RESUME</span>: <span class="hljs-string">&#x27;running&#x27;</span>, <span class="hljs-attr">CANCEL</span>: <span class="hljs-string">&#x27;idle&#x27;</span> &#125;,<br>  <span class="hljs-attr">done</span>: &#123; <span class="hljs-attr">RESET</span>: <span class="hljs-string">&#x27;idle&#x27;</span> &#125;<br>&#125;, <span class="hljs-string">&#x27;idle&#x27;</span>);<br></code></pre></td></tr></table></figure>

<h3 id="自定义-Hook-设计原则"><a href="#自定义-Hook-设计原则" class="headerlink" title="自定义 Hook 设计原则"></a>自定义 Hook 设计原则</h3><ol>
<li>单一职责：一个 Hook 只解决一个问题</li>
<li>命名清晰：use + 功能名（useWindowSize）</li>
<li>参数合理：提供默认值和必要配置</li>
<li>返回简洁：返回数组或对象结构</li>
<li>文档完善：使用 JSDoc 说明用法</li>
<li>类型安全：TypeScript 类型定义</li>
</ol>
<h3 id="总结：自定义-Hook-价值"><a href="#总结：自定义-Hook-价值" class="headerlink" title="总结：自定义 Hook 价值"></a>总结：自定义 Hook 价值</h3><pre class="mermaid">graph TD
  A[逻辑复用] --> B[减少代码重复]
  A --> C[统一业务逻辑]
  D[关注点分离] --> E[提升可维护性]
  D --> F[便于单元测试]
  G[组件简化] --> H[提升可读性]
  G --> I[降低复杂度]</pre>

<h2 id="3-6-其他常用-Hooks（useMemo、useCallback、useRef）"><a href="#3-6-其他常用-Hooks（useMemo、useCallback、useRef）" class="headerlink" title="3.6 其他常用 Hooks（useMemo、useCallback、useRef）"></a>3.6 其他常用 Hooks（useMemo、useCallback、useRef）</h2><h3 id="三大-Hook-快速对比"><a href="#三大-Hook-快速对比" class="headerlink" title="三大 Hook 快速对比"></a>三大 Hook 快速对比</h3><table>
<thead>
<tr>
<th align="left">Hook</th>
<th align="left">主要作用</th>
<th align="left">返回值</th>
<th align="left">性能优化原理</th>
</tr>
</thead>
<tbody><tr>
<td align="left">useMemo</td>
<td align="left">缓存计算结果</td>
<td align="left">记忆化值</td>
<td align="left">避免重复计算</td>
</tr>
<tr>
<td align="left">useCallback</td>
<td align="left">缓存函数引用</td>
<td align="left">记忆化函数</td>
<td align="left">避免子组件不必要重渲染</td>
</tr>
<tr>
<td align="left">useRef</td>
<td align="left">保存可变值&#x2F;DOM 引用</td>
<td align="left">{ current: value }</td>
<td align="left">不触发重渲染</td>
</tr>
</tbody></table>
<h3 id="useMemo-深度解析"><a href="#useMemo-深度解析" class="headerlink" title="useMemo 深度解析"></a>useMemo 深度解析</h3><p><strong>核心语法</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> memoizedValue = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">computeExpensiveValue</span>(a, b), [a, b]);<br></code></pre></td></tr></table></figure>

<ul>
<li>计算函数：返回需要缓存的值</li>
<li>依赖数组：当依赖变化时重新计算</li>
</ul>
<p><strong>工作原理</strong></p>
<pre class="mermaid">graph LR
  A[组件渲染] --> B{依赖是否变化?}
  B -->|否| C[返回缓存值]
  B -->|是| D[执行计算函数]
  D --> E[缓存新值]
  E --> F[返回新值]</pre>

<p><strong>使用场景</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 场景1：高开销计算</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Component</span>(<span class="hljs-params">&#123; items &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> sortedItems = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> items.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a.<span class="hljs-property">value</span> - b.<span class="hljs-property">value</span>); <span class="hljs-comment">// 排序开销大</span><br>  &#125;, [items]);<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">List</span> <span class="hljs-attr">items</span>=<span class="hljs-string">&#123;sortedItems&#125;</span> /&gt;</span></span>;<br>&#125;<br><br><span class="hljs-comment">// 场景2：避免不必要重渲染</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params">&#123; user &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> userContext = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> (&#123; <br>    user, <br>    <span class="hljs-attr">isAdmin</span>: user.<span class="hljs-property">role</span> === <span class="hljs-string">&#x27;admin&#x27;</span> <br>  &#125;), [user]); <span class="hljs-comment">// 依赖变化时重建</span><br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">context</span>=<span class="hljs-string">&#123;userContext&#125;</span> /&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>错误用法</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 错误1：没有依赖数组（每次渲染都计算）</span><br><span class="hljs-keyword">const</span> value = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">compute</span>());<br><br><span class="hljs-comment">// ❌ 错误2：依赖数组不全</span><br><span class="hljs-keyword">const</span> fullName = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;name&#125;</span> <span class="hljs-subst">$&#123;surname&#125;</span>`</span>, [name]);<br></code></pre></td></tr></table></figure>

<h3 id="useCallback-深度解析"><a href="#useCallback-深度解析" class="headerlink" title="useCallback 深度解析"></a>useCallback 深度解析</h3><p><strong>核心语法</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> memoizedCallback = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">doSomething</span>(a, b);<br>&#125;, [a, b]);<br></code></pre></td></tr></table></figure>

<p><strong>与 useMemo 关系</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// useCallback 等价于：</span><br><span class="hljs-keyword">const</span> memoizedCallback = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">doSomething</span>(a, b), [a, b]);<br></code></pre></td></tr></table></figure>

<p><strong>使用场景</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 场景1：避免子组件不必要重渲染</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <br>  <span class="hljs-comment">// ✅ 稳定函数引用</span><br>  <span class="hljs-keyword">const</span> increment = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c + <span class="hljs-number">1</span>), []);<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;increment&#125;</span> /&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Child</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-function">(<span class="hljs-params">&#123; onClick &#125;</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 依赖稳定函数引用不会重渲染</span><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;onClick&#125;</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;<br>&#125;);<br><br><span class="hljs-comment">// 场景2：依赖数组中的函数</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <br>  <span class="hljs-keyword">const</span> handleSubmit = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;提交:&#x27;</span>, text);<br>  &#125;, [text]); <span class="hljs-comment">// 正确捕获最新text</span><br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">keyHandler</span> = e =&gt; &#123;<br>      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">&#x27;Enter&#x27;</span>) <span class="hljs-title function_">handleSubmit</span>();<br>    &#125;;<br>    <br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;keydown&#x27;</span>, keyHandler);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;keydown&#x27;</span>, keyHandler);<br>  &#125;, [handleSubmit]); <span class="hljs-comment">// 依赖稳定函数</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>性能陷阱</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 错误：过度使用 useCallback</span><br><span class="hljs-keyword">const</span> handleClick = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;点击&#x27;</span>);<br>&#125;, []); <span class="hljs-comment">// 简单函数不需要缓存</span><br><br><span class="hljs-comment">// ✅ 正确：直接定义函数</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;点击&#x27;</span>);<br></code></pre></td></tr></table></figure>

<h3 id="useRef-高级用法（补充-2-5-章节）"><a href="#useRef-高级用法（补充-2-5-章节）" class="headerlink" title="useRef 高级用法（补充 2.5 章节）"></a>useRef 高级用法（补充 2.5 章节）</h3><p><strong>保存可变值</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Timer</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> countRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// &#123; current: 0 &#125;</span><br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">increment</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    countRef.<span class="hljs-property">current</span> += <span class="hljs-number">1</span>;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;计数:&#x27;</span>, countRef.<span class="hljs-property">current</span>);<br>  &#125;;<br>  <br>  <span class="hljs-comment">// 不触发重渲染！</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>访问上一状态</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> prevCountRef = <span class="hljs-title function_">useRef</span>();<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    prevCountRef.<span class="hljs-property">current</span> = count; <span class="hljs-comment">// 渲染后保存当前值</span><br>  &#125;);<br>  <br>  <span class="hljs-keyword">const</span> prevCount = prevCountRef.<span class="hljs-property">current</span>;<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      当前: &#123;count&#125;, 之前: &#123;prevCount&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>跨渲染周期存储</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [messages, setMessages] = <span class="hljs-title function_">useState</span>([]);<br>  <span class="hljs-keyword">const</span> socketRef = <span class="hljs-title function_">useRef</span>();<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    socketRef.<span class="hljs-property">current</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-string">&#x27;wss://...&#x27;</span>);<br>    socketRef.<span class="hljs-property">current</span>.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">setMessages</span>(<span class="hljs-function"><span class="hljs-params">msgs</span> =&gt;</span> [...msgs, event.<span class="hljs-property">data</span>]);<br>    &#125;;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> socketRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">close</span>();<br>  &#125;, []);<br>  <br>  <span class="hljs-comment">// 在其他函数中使用</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">sendMessage</span> = (<span class="hljs-params">text</span>) =&gt; &#123;<br>    socketRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">send</span>(text);<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="高频面试题与破解方案-11"><a href="#高频面试题与破解方案-11" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：useMemo 和 useCallback 有何区别？</strong></p>
<p>核心区别：</p>
<ul>
<li>useMemo 缓存计算结果，用于避免重复计算</li>
<li>useCallback 缓存函数引用，用于保持引用稳定</li>
</ul>
<p>等效关系：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title function_">useCallback</span>(fn, deps) === <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> fn, deps)<br></code></pre></td></tr></table></figure>

<p><strong>Q：何时该用 useMemo&#x2F;useCallback？</strong></p>
<pre class="mermaid">graph TD
  A[需要优化？] -->|否| B[直接计算/定义函数]
  A -->|是| C{优化类型?}
  C -->|避免计算开销| D[用useMemo]
  C -->|避免子组件重渲染| E[useCallback+React.memo]
  C -->|稳定依赖项| F[两者皆可]</pre>

<p><strong>Q：useRef 和 useState 有何区别？</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">useRef</th>
<th align="left">useState</th>
</tr>
</thead>
<tbody><tr>
<td align="left">触发重渲染</td>
<td align="left">否</td>
<td align="left">是</td>
</tr>
<tr>
<td align="left">存储值类型</td>
<td align="left">可变对象（.current）</td>
<td align="left">不可变状态</td>
</tr>
<tr>
<td align="left">数据持久化</td>
<td align="left">组件生命周期</td>
<td align="left">状态更新保留</td>
</tr>
<tr>
<td align="left">典型用途</td>
<td align="left">DOM 引用&#x2F;计时器 ID</td>
<td align="left">渲染相关状态</td>
</tr>
<tr>
<td align="left">初始化</td>
<td align="left">useRef(initial)</td>
<td align="left">useState(initial)</td>
</tr>
</tbody></table>
<h3 id="高级优化模式"><a href="#高级优化模式" class="headerlink" title="高级优化模式"></a>高级优化模式</h3><p><strong>虚拟滚动优化</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">VirtualList</span>(<span class="hljs-params">&#123; items, itemHeight &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> containerRef = <span class="hljs-title function_">useRef</span>();<br>  <span class="hljs-keyword">const</span> [visibleRange, setVisibleRange] = <span class="hljs-title function_">useState</span>([<span class="hljs-number">0</span>, <span class="hljs-number">10</span>]);<br>  <br>  <span class="hljs-comment">// 缓存可见项</span><br>  <span class="hljs-keyword">const</span> visibleItems = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> items.<span class="hljs-title function_">slice</span>(visibleRange[<span class="hljs-number">0</span>], visibleRange[<span class="hljs-number">1</span>]);<br>  &#125;, [items, visibleRange]);<br>  <br>  <span class="hljs-comment">// 计算总高度（虚拟滚动）</span><br>  <span class="hljs-keyword">const</span> totalHeight = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> items.<span class="hljs-property">length</span> * itemHeight;<br>  &#125;, [items.<span class="hljs-property">length</span>, itemHeight]);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;containerRef&#125;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">height:</span> &#x27;<span class="hljs-attr">500px</span>&#x27;, <span class="hljs-attr">overflow:</span> &#x27;<span class="hljs-attr">auto</span>&#x27; &#125;&#125;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">height:</span> `$&#123;<span class="hljs-attr">totalHeight</span>&#125;<span class="hljs-attr">px</span>`, <span class="hljs-attr">position:</span> &#x27;<span class="hljs-attr">relative</span>&#x27; &#125;&#125;&gt;</span></span><br><span class="language-xml">        &#123;visibleItems.map(item =&gt; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Item</span> </span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.id&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">item</span>=<span class="hljs-string">&#123;item&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">position:</span> &#x27;<span class="hljs-attr">absolute</span>&#x27;,</span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">top:</span> `$&#123;<span class="hljs-attr">item.index</span> * <span class="hljs-attr">itemHeight</span>&#125;<span class="hljs-attr">px</span>` </span></span><br><span class="hljs-tag"><span class="language-xml">            &#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">          /&gt;</span></span><br><span class="language-xml">        ))&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>防抖&#x2F;节流优化</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useDebounce</span>(<span class="hljs-params">value, delay</span>) &#123;<br>  <span class="hljs-keyword">const</span> [debouncedValue, setDebouncedValue] = <span class="hljs-title function_">useState</span>(value);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setDebouncedValue</span>(value), delay);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer);<br>  &#125;, [value, delay]);<br>  <br>  <span class="hljs-keyword">return</span> debouncedValue;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Search</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [query, setQuery] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> debouncedQuery = <span class="hljs-title function_">useDebounce</span>(query, <span class="hljs-number">300</span>);<br>  <br>  <span class="hljs-comment">// 使用useMemo避免重复请求</span><br>  <span class="hljs-keyword">const</span> results = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetchResults</span>(debouncedQuery);<br>  &#125;, [debouncedQuery]);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;query&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setQuery(e.target.value)&#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Results</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;results&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="总结：性能优化决策"><a href="#总结：性能优化决策" class="headerlink" title="总结：性能优化决策"></a>总结：性能优化决策</h3><pre class="mermaid">graph TD
  A[性能问题?] -->|是| B{问题类型}
  A -->|否| C[无需优化]
  B -->|组件重渲染过多| D[React.memo+useCallback]
  B -->|计算开销大| E[useMemo]
  B -->|DOM操作频繁| F[useRef+useLayoutEffect]
  D --> G[验证优化效果]
  E --> G
  F --> G
  G -->|解决| H[停止]
  G -->|未解决| I[性能分析工具]</pre>

<h1 id="第四章：React-高级特性"><a href="#第四章：React-高级特性" class="headerlink" title="第四章：React 高级特性"></a>第四章：React 高级特性</h1><h2 id="4-1-性能优化（React-memo、useMemo、useCallback）"><a href="#4-1-性能优化（React-memo、useMemo、useCallback）" class="headerlink" title="4.1 性能优化（React.memo、useMemo、useCallback）"></a>4.1 性能优化（React.memo、useMemo、useCallback）</h2><h3 id="性能优化核心原则"><a href="#性能优化核心原则" class="headerlink" title="性能优化核心原则"></a>性能优化核心原则</h3><p><strong>React 渲染机制回顾</strong></p>
<pre class="mermaid">graph LR
A[状态/Props变化] --> B[组件重新渲染]
B --> C{子组件是否更新?}
C -->|Props变化| D[重新渲染子组件]
C -->|Props未变化| E[跳过子组件渲染]</pre>

<p><strong>性能优化核心策略</strong></p>
<table>
<thead>
<tr>
<th align="left">优化策略</th>
<th align="left">适用场景</th>
<th align="left">实现方式</th>
</tr>
</thead>
<tbody><tr>
<td align="left">减少渲染次数</td>
<td align="left">避免不必要的渲染</td>
<td align="left">React.memo、PureComponent</td>
</tr>
<tr>
<td align="left">减少计算量</td>
<td align="left">复杂计算&#x2F;数据转换</td>
<td align="left">useMemo</td>
</tr>
<tr>
<td align="left">保持引用稳定</td>
<td align="left">函数&#x2F;对象作为依赖项</td>
<td align="left">useCallback、useMemo</td>
</tr>
<tr>
<td align="left">虚拟化长列表</td>
<td align="left">大数据量渲染</td>
<td align="left">react-window、react-virtualized</td>
</tr>
</tbody></table>
<h3 id="核心-API-深度解析"><a href="#核心-API-深度解析" class="headerlink" title="核心 API 深度解析"></a>核心 API 深度解析</h3><p><strong>React.memo 详解</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 基础用法</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">MyComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-comment">/* 使用 props 渲染 */</span><br>&#125;);<br><br><span class="hljs-comment">// 自定义比较函数</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">UserProfile</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-function">(<span class="hljs-params">&#123; user, settings &#125;</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span> <span class="hljs-attr">url</span>=<span class="hljs-string">&#123;user.avatar&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Preferences</span> <span class="hljs-attr">options</span>=<span class="hljs-string">&#123;settings&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;, <span class="hljs-function">(<span class="hljs-params">prevProps, nextProps</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 仅在 user.id 或 settings.theme 变化时重新渲染</span><br>  <span class="hljs-keyword">return</span> prevProps.<span class="hljs-property">user</span>.<span class="hljs-property">id</span> === nextProps.<span class="hljs-property">user</span>.<span class="hljs-property">id</span> &amp;&amp; <br>         prevProps.<span class="hljs-property">settings</span>.<span class="hljs-property">theme</span> === nextProps.<span class="hljs-property">settings</span>.<span class="hljs-property">theme</span>;<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>关键特性：</p>
<ul>
<li>仅进行浅比较（shallow compare）</li>
<li>比较函数返回 true 表示不需要重新渲染</li>
<li>适用于函数组件</li>
</ul>
<p>优化场景：</p>
<ul>
<li>纯展示型组件（无内部状态）</li>
<li>接收复杂对象 Props 的组件</li>
<li>位于渲染频繁组件树中的叶子节点</li>
</ul>
<p><strong>useMemo 深度应用</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductList</span>(<span class="hljs-params">&#123; products, filterText, sortBy &#125;</span>) &#123;<br>  <span class="hljs-comment">// 缓存复杂计算结果</span><br>  <span class="hljs-keyword">const</span> filteredProducts = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;重新计算过滤产品&#x27;</span>);<br>    <span class="hljs-keyword">return</span> products.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> <br>      p.<span class="hljs-property">name</span>.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">includes</span>(filterText.<span class="hljs-title function_">toLowerCase</span>())<br>    );<br>  &#125;, [products, filterText]); <span class="hljs-comment">// 依赖项</span><br>  <br>  <span class="hljs-comment">// 缓存排序结果</span><br>  <span class="hljs-keyword">const</span> sortedProducts = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;重新排序产品&#x27;</span>);<br>    <span class="hljs-keyword">return</span> [...filteredProducts].<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (sortBy === <span class="hljs-string">&#x27;price&#x27;</span>) <span class="hljs-keyword">return</span> a.<span class="hljs-property">price</span> - b.<span class="hljs-property">price</span>;<br>      <span class="hljs-keyword">return</span> a.<span class="hljs-property">name</span>.<span class="hljs-title function_">localeCompare</span>(b.<span class="hljs-property">name</span>);<br>    &#125;);<br>  &#125;, [filteredProducts, sortBy]);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">      &#123;sortedProducts.map(product =&gt; (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">ProductItem</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;product.id&#125;</span> <span class="hljs-attr">product</span>=<span class="hljs-string">&#123;product&#125;</span> /&gt;</span></span><br><span class="language-xml">      ))&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p>关键特性：</p>
<ul>
<li>缓存计算结果，避免重复计算</li>
<li>依赖项变化时重新计算</li>
<li>适用于：复杂计算、数据转换、组件记忆化</li>
</ul>
<p>性能陷阱：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 错误用法：useMemo 作为语义保证</span><br><span class="hljs-keyword">const</span> data = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">fetchData</span>(), []); <span class="hljs-comment">// 不会阻止重复请求</span><br><br><span class="hljs-comment">// 正确用法：仅用于性能优化</span><br><span class="hljs-keyword">const</span> transformedData = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <br>  rawData.<span class="hljs-title function_">map</span>(transformItem), <br>[rawData]);<br></code></pre></td></tr></table></figure>

<p><strong>useCallback 高级用法</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ParentComponent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <br>  <span class="hljs-comment">// 缓存函数引用</span><br>  <span class="hljs-keyword">const</span> handleClick = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;点击事件&#x27;</span>, count);<br>    <span class="hljs-comment">// 注意：闭包陷阱！count 是创建时的值</span><br>  &#125;, [count]); <span class="hljs-comment">// 依赖 count 保证最新值</span><br>  <br>  <span class="hljs-comment">// 使用 ref 解决闭包问题</span><br>  <span class="hljs-keyword">const</span> countRef = <span class="hljs-title function_">useRef</span>(count);<br>  countRef.<span class="hljs-property">current</span> = count;<br>  <br>  <span class="hljs-keyword">const</span> stableHandler = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;最新值:&#x27;</span>, countRef.<span class="hljs-property">current</span>);<br>  &#125;, []); <span class="hljs-comment">// 无依赖，函数引用稳定</span><br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setCount(c =&gt; c + 1)&#125;&gt;增加 &#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;stableHandler&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ChildComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-function">(<span class="hljs-params">&#123; onClick &#125;</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;子组件渲染&#x27;</span>);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;onClick&#125;</span>&gt;</span>触发事件<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>关键特性：</p>
<ul>
<li>缓存函数引用，避免子组件不必要渲染</li>
<li>依赖项变化时创建新函数</li>
<li>适用于：事件处理函数、传递给子组件的回调</li>
</ul>
<p>最佳实践：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 依赖项处理技巧</span><br><span class="hljs-keyword">const</span> handleSubmit = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  api.<span class="hljs-title function_">submitForm</span>(formState);<br>&#125;, [formState]); <span class="hljs-comment">// ✅ 正确：依赖实际使用的状态</span><br><br><span class="hljs-comment">// 使用函数式更新避免依赖</span><br><span class="hljs-keyword">const</span> increment = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>); <span class="hljs-comment">// ✅ 不依赖 count</span><br>&#125;, []);<br></code></pre></td></tr></table></figure>

<h3 id="综合优化策略"><a href="#综合优化策略" class="headerlink" title="综合优化策略"></a>综合优化策略</h3><p><strong>组件结构优化</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 优化前：状态提升导致频繁渲染</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>(&#123;&#125;);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ExpensiveComponent</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;state.data&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ControlPanel</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;setState&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 优化后：状态下沉</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">OptimizedParent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">DataContainer</span>&gt;</span></span><br><span class="language-xml">        &#123;(data) =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">ExpensiveComponent</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> /&gt;</span>&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">DataContainer</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ControlPanel</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">DataContainer</span>(<span class="hljs-params">&#123; children &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-comment">// 状态管理隔离在此组件</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">children</span>(data);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>上下文优化技巧</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 创建拆分上下文</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">UserContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">SettingsContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [user, setUser] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> [settings, setSettings] = <span class="hljs-title function_">useState</span>(&#123;&#125;);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;user&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">SettingsContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;settings&#125;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">MainContent</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">SettingsContext.Provider</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">UserContext.Provider</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 消费者组件</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">ThemeSwitcher</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-comment">// 只订阅需要的上下文</span><br>  <span class="hljs-keyword">const</span> settings = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">SettingsContext</span>);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>当前主题: &#123;settings.theme&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;;<br><br><span class="hljs-comment">// 使用 React.memo 防止不必要渲染</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Header</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> user = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">UserContext</span>);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>&#123;user ? user.name : &#x27;游客&#x27;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span></span>;<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>虚拟化长列表</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">FixedSizeList</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-window&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">BigList</span> = (<span class="hljs-params">&#123; items &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">Row</span> = (<span class="hljs-params">&#123; index, style &#125;</span>) =&gt; (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;style&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ListItem</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&#123;items[index]&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">FixedSizeList</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">height</span>=<span class="hljs-string">&#123;600&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">width</span>=<span class="hljs-string">&#123;800&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">itemCount</span>=<span class="hljs-string">&#123;items.length&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">itemSize</span>=<span class="hljs-string">&#123;100&#125;</span> // <span class="hljs-attr">每项高度</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span></span><br><span class="language-xml">      &#123;Row&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">FixedSizeList</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-comment">// 优化列表项</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ListItem</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-function">(<span class="hljs-params">&#123; item &#125;</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span> <span class="hljs-attr">url</span>=<span class="hljs-string">&#123;item.avatar&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>&#123;item.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;item.description&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="性能分析工具"><a href="#性能分析工具" class="headerlink" title="性能分析工具"></a>性能分析工具</h3><p><strong>React DevTools Profiler</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 使用示例</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProfilerTest</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Profiler</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;Navigation&quot;</span> <span class="hljs-attr">onRender</span>=<span class="hljs-string">&#123;onRenderCallback&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Navigation</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Profiler</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">onRenderCallback</span>(<span class="hljs-params"></span><br><span class="hljs-params">  id, <span class="hljs-comment">// Profiler 树的 &quot;id&quot;</span></span><br><span class="hljs-params">  phase, <span class="hljs-comment">// &quot;mount&quot; 或 &quot;update&quot;</span></span><br><span class="hljs-params">  actualDuration, <span class="hljs-comment">// 本次更新花费的渲染时间</span></span><br><span class="hljs-params">  baseDuration, <span class="hljs-comment">// 估计不使用 memoization 的渲染时间</span></span><br><span class="hljs-params">  startTime, <span class="hljs-comment">// 本次更新开始时间</span></span><br><span class="hljs-params">  commitTime, <span class="hljs-comment">// 提交时间</span></span><br><span class="hljs-params">  interactions <span class="hljs-comment">// 本次更新所关联的 set</span></span><br><span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`组件 <span class="hljs-subst">$&#123;id&#125;</span> 的 <span class="hljs-subst">$&#123;phase&#125;</span> 阶段耗时: <span class="hljs-subst">$&#123;actualDuration&#125;</span>ms`</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Chrome Performance Tab</strong></p>
<ul>
<li>操作步骤：<ul>
<li>打开 Chrome DevTools</li>
<li>切换到 Performance 选项卡</li>
<li>点击 Record 开始记录</li>
<li>执行页面操作</li>
<li>停止记录分析火焰图</li>
</ul>
</li>
<li>关键指标：<ul>
<li>Scripting：JavaScript 执行时间</li>
<li>Rendering：样式计算和布局</li>
<li>Painting：像素绘制时间</li>
<li>Idle：空闲时间</li>
</ul>
</li>
</ul>
<h3 id="常见性能问题与解决方案"><a href="#常见性能问题与解决方案" class="headerlink" title="常见性能问题与解决方案"></a>常见性能问题与解决方案</h3><p><strong>状态频繁变更导致渲染抖动</strong></p>
<p>场景：输入框实时搜索导致频繁渲染</p>
<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchBox</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [inputValue, setInputValue] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [searchResults, setSearchResults] = <span class="hljs-title function_">useState</span>([]);<br>  <br>  <span class="hljs-comment">// 使用防抖</span><br>  <span class="hljs-keyword">const</span> debouncedSearch = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <br>    <span class="hljs-title function_">debounce</span>(<span class="hljs-function"><span class="hljs-params">query</span> =&gt;</span> &#123;<br>      api.<span class="hljs-title function_">search</span>(query).<span class="hljs-title function_">then</span>(setSearchResults);<br>    &#125;, <span class="hljs-number">300</span>),<br>  []);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">debouncedSearch</span>(inputValue);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> debouncedSearch.<span class="hljs-title function_">cancel</span>();<br>  &#125;, [inputValue, debouncedSearch]);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;inputValue&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setInputValue(e.target.value)&#125;</span><br><span class="language-xml">      /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ResultsList</span> <span class="hljs-attr">results</span>=<span class="hljs-string">&#123;searchResults&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>复杂组件树更新缓慢</strong></p>
<p>场景：大型表单组件局部更新</p>
<p>解决方案：状态隔离 + React.memo</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">BigForm</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [formData, setFormData] = <span class="hljs-title function_">useState</span>(initialData);<br>  <br>  <span class="hljs-comment">// 状态更新函数</span><br>  <span class="hljs-keyword">const</span> updateField = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">field, value</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">setFormData</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> (&#123; ...prev, [field]: value &#125;));<br>  &#125;, []);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">PersonalSection</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;formData.personal&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;updateField&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">AddressSection</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;formData.address&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;updateField&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">PaymentSection</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;formData.payment&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;updateField&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-comment">// 优化子组件</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">PersonalSection</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-function">(<span class="hljs-params">&#123; data, onChange &#125;</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Input</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;姓名&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;data.name&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;v</span> =&gt;</span> onChange(&#x27;name&#x27;, v)&#125;</span><br><span class="language-xml">      /&gt;</span><br><span class="language-xml">      &#123;/* 其他字段 */&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>  );<br>&#125;, <span class="hljs-function">(<span class="hljs-params">prev, next</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 仅当 personal 部分变化时重新渲染</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">shallowEqual</span>(prev.<span class="hljs-property">data</span>, next.<span class="hljs-property">data</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>动画卡顿问题</strong></p>
<p>解决方案：使用 CSS 动画 + will-change</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">AnimatedBox</span> = (<span class="hljs-params">&#123; position &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> </span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;animated-box&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">transform:</span> `<span class="hljs-attr">translateX</span>($&#123;<span class="hljs-attr">position</span>&#125;<span class="hljs-attr">px</span>)`,</span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">willChange:</span> &#x27;<span class="hljs-attr">transform</span>&#x27; // <span class="hljs-attr">提示浏览器优化</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-comment">// CSS 中使用 GPU 加速</span><br>.<span class="hljs-property">animated</span>-box &#123;<br>  <span class="hljs-attr">transition</span>: transform <span class="hljs-number">0.</span>3s ease-out;<br>  <span class="hljs-comment">/* 启用 GPU 加速 */</span><br>  <span class="hljs-attr">transform</span>: <span class="hljs-title function_">translateZ</span>(<span class="hljs-number">0</span>);<br>  backface-<span class="hljs-attr">visibility</span>: hidden;<br>  <span class="hljs-attr">perspective</span>: 1000px;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="性能优化原则总结"><a href="#性能优化原则总结" class="headerlink" title="性能优化原则总结"></a>性能优化原则总结</h3><ol>
<li>测量优先：优化前先使用 Profiler 分析性能瓶颈</li>
<li>避免过早优化：只在必要时应用优化技术</li>
<li>关注关键路径：优先优化渲染频率高的组件</li>
<li>合理使用工具：<ol>
<li>React.memo 用于组件记忆化</li>
<li>useMemo 用于昂贵计算缓存</li>
<li>useCallback 用于函数引用稳定</li>
</ol>
</li>
<li>结构优化：<ol>
<li>组件职责单一化</li>
<li>状态合理下沉</li>
<li>避免深层嵌套</li>
</ol>
</li>
</ol>
<h3 id="面试高频问题与解答"><a href="#面试高频问题与解答" class="headerlink" title="面试高频问题与解答"></a>面试高频问题与解答</h3><p><strong>Q：React.memo 与 useMemo 有什么区别？</strong></p>
<ul>
<li>React.memo 是高阶组件，用于包装组件，避免不必要的重新渲染</li>
<li>useMemo 是Hook，用于在组件内部缓存计算结果</li>
<li>前者优化组件渲染，后者优化计算性能</li>
</ul>
<p><strong>Q：什么情况下应该使用 useCallback？</strong></p>
<ul>
<li>当函数作为 props 传递给记忆化组件（React.memo）</li>
<li>当函数作为其他 Hook 的依赖项（如 useEffect）</li>
<li>当函数在渲染中被创建且依赖项未改变时</li>
</ul>
<p><strong>Q：为什么使用 useMemo&#x2F;useCallback 后性能反而下降？</strong></p>
<ul>
<li>过度使用：简单计算使用 useMemo 得不偿失</li>
<li>依赖项错误：依赖项频繁变化导致重新计算</li>
<li>比较成本高：自定义比较函数复杂度高</li>
<li>闭包陷阱：函数闭包持有旧值导致逻辑错误</li>
</ul>
<p><strong>Q：如何避免 useCallback 的闭包陷阱？</strong></p>
<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 方案1：使用函数式更新</span><br><span class="hljs-keyword">const</span> increment = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>);<br>&#125;, []);<br><br><span class="hljs-comment">// 方案2：使用 ref 保存最新值</span><br><span class="hljs-keyword">const</span> countRef = <span class="hljs-title function_">useRef</span>(count);<br>countRef.<span class="hljs-property">current</span> = count;<br><br><span class="hljs-keyword">const</span> logCount = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(countRef.<span class="hljs-property">current</span>);<br>&#125;, []);<br><br><span class="hljs-comment">// 方案3：正确声明依赖项</span><br><span class="hljs-keyword">const</span> logCount = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(count);<br>&#125;, [count]); <span class="hljs-comment">// 依赖 count</span><br></code></pre></td></tr></table></figure>

<h2 id="4-2-错误边界（ErrorBoundary）"><a href="#4-2-错误边界（ErrorBoundary）" class="headerlink" title="4.2 错误边界（ErrorBoundary）"></a>4.2 错误边界（ErrorBoundary）</h2><h3 id="错误边界核心概念"><a href="#错误边界核心概念" class="headerlink" title="错误边界核心概念"></a>错误边界核心概念</h3><p><strong>错误边界解决的问题</strong></p>
<pre class="mermaid">graph TD
    A[组件树中的错误] --> B[React 16 前]
    A --> C[React 16+]
    B --> D[整个应用崩溃]
    C --> E[错误边界捕获]
    E --> F[降级UI展示]
    E --> G[错误日志记录]</pre>

<p><strong>错误边界能力范围</strong></p>
<table>
<thead>
<tr>
<th align="left">可捕获</th>
<th align="left">不可捕获</th>
</tr>
</thead>
<tbody><tr>
<td align="left">子组件渲染错误</td>
<td align="left">事件处理器错误</td>
</tr>
<tr>
<td align="left">生命周期方法错误</td>
<td align="left">异步代码错误</td>
</tr>
<tr>
<td align="left">构造函数错误</td>
<td align="left">服务端渲染错误</td>
</tr>
<tr>
<td align="left">整个组件树的错误</td>
<td align="left">错误边界自身错误</td>
</tr>
</tbody></table>
<h3 id="错误边界实现机制"><a href="#错误边界实现机制" class="headerlink" title="错误边界实现机制"></a>错误边界实现机制</h3><p><strong>基础实现方案</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ErrorBoundary</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  state = &#123; <span class="hljs-attr">hasError</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span> &#125;;<br>  <br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getDerivedStateFromError</span>(<span class="hljs-params">error</span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">hasError</span>: <span class="hljs-literal">true</span>, error &#125;;<br>  &#125;<br>  <br>  <span class="hljs-title function_">componentDidCatch</span>(<span class="hljs-params">error, errorInfo</span>) &#123;<br>    <span class="hljs-comment">// 记录错误到监控系统</span><br>    <span class="hljs-title function_">logErrorToService</span>(error, errorInfo.<span class="hljs-property">componentStack</span>);<br>    <br>    <span class="hljs-comment">// 可选的错误恢复逻辑</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isRecoverable</span>(error)) &#123;<br>      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; <span class="hljs-attr">hasError</span>: <span class="hljs-literal">false</span> &#125;), <span class="hljs-number">5000</span>);<br>    &#125;<br>  &#125;<br>  <br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">hasError</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">fallback</span> || (<br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;error-boundary&quot;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>应用遇到问题<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;this.state.error.message&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> window.location.reload()&#125;&gt;</span><br><span class="language-xml">            重新加载</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>      );<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">children</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用示例</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span> </span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">CriticalErrorScreen</span> /&gt;</span>&#125;</span><br><span class="language-xml">    &gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MainApplication</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>高级特性实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 带错误恢复功能的边界</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RecoverableErrorBoundary</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  state = &#123; <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">errorInfo</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">recoveryKey</span>: <span class="hljs-number">0</span> &#125;;<br>  <br>  <span class="hljs-title function_">componentDidCatch</span>(<span class="hljs-params">error, errorInfo</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; <br>      error, <br>      errorInfo,<br>      <span class="hljs-attr">recoveryKey</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">recoveryKey</span> + <span class="hljs-number">1</span><br>    &#125;);<br>  &#125;<br>  <br>  handleReset = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">errorInfo</span>: <span class="hljs-literal">null</span> &#125;);<br>  &#125;;<br>  <br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">error</span>) &#123;<br>      <span class="hljs-keyword">return</span> (<br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>组件崩溃<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">ErrorDetails</span> </span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">error</span>=<span class="hljs-string">&#123;this.state.error&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">stack</span>=<span class="hljs-string">&#123;this.state.errorInfo.componentStack&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          /&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;this.handleReset&#125;</span>&gt;</span></span><br><span class="language-xml">            重置组件</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>      );<br>    &#125;<br>    <br>    <span class="hljs-comment">// 使用 key 强制重置子组件</span><br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;this.state.recoveryKey&#125;</span>&gt;</span>&#123;this.props.children&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 错误详情组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ErrorDetails</span>(<span class="hljs-params">&#123; error, stack &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">details</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">whiteSpace:</span> &#x27;<span class="hljs-attr">pre-wrap</span>&#x27; &#125;&#125;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span>&#123;error.toString()&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span>&#123;stack&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">details</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="企业级最佳实践"><a href="#企业级最佳实践" class="headerlink" title="企业级最佳实践"></a>企业级最佳实践</h3><p><strong>多层错误边界策略</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">AppHierarchy</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span> </span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;app&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">AppCrashScreen</span> /&gt;</span>&#125;</span><br><span class="language-xml">    &gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span></span><br><span class="language-xml">      </span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;billing&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">BillingModuleError</span> /&gt;</span>&#125;</span><br><span class="language-xml">      &gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">BillingDashboard</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span><br><span class="language-xml">      </span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;user-profile&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">ProfileError</span> /&gt;</span>&#125;</span><br><span class="language-xml">      &gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">UserProfile</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span><br><span class="language-xml">      </span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;notifications&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;null&#125;</span> // <span class="hljs-attr">静默失败</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">NotificationCenter</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>错误边界与监控系统集成</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MonitoringErrorBoundary</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  state = &#123; <span class="hljs-attr">hasError</span>: <span class="hljs-literal">false</span> &#125;;<br>  <br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getDerivedStateFromError</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">hasError</span>: <span class="hljs-literal">true</span> &#125;;<br>  &#125;<br>  <br>  <span class="hljs-title function_">componentDidCatch</span>(<span class="hljs-params">error, errorInfo</span>) &#123;<br>    <span class="hljs-comment">// 发送错误到监控平台</span><br>    monitoringClient.<span class="hljs-title function_">captureException</span>(error, &#123;<br>      <span class="hljs-attr">extra</span>: &#123;<br>        <span class="hljs-attr">componentStack</span>: errorInfo.<span class="hljs-property">componentStack</span>,<br>        <span class="hljs-attr">userId</span>: <span class="hljs-title function_">getCurrentUser</span>()?.<span class="hljs-property">id</span>,<br>        <span class="hljs-attr">route</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span><br>      &#125;,<br>      <span class="hljs-attr">tags</span>: &#123; <span class="hljs-attr">error_boundary</span>: <span class="hljs-literal">true</span> &#125;<br>    &#125;);<br>    <br>    <span class="hljs-comment">// 自定义错误处理</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">onError</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-title function_">onError</span>(error, errorInfo);<br>    &#125;<br>  &#125;<br>  <br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">hasError</span> <br>      ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">fallback</span> <br>      : <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">children</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用示例</span><br>&lt;<span class="hljs-title class_">MonitoringErrorBoundary</span><br>  fallback=&#123;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorScreen</span> /&gt;</span></span>&#125;<br>  onError=&#123;<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// 特殊错误类型处理</span><br>    <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">PaymentError</span>) &#123;<br>      router.<span class="hljs-title function_">navigate</span>(<span class="hljs-string">&#x27;/payment-failed&#x27;</span>);<br>    &#125;<br>  &#125;&#125;<br>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">CheckoutProcess</span> /&gt;</span></span><br>&lt;/<span class="hljs-title class_">MonitoringErrorBoundary</span>&gt;<br></code></pre></td></tr></table></figure>

<p><strong>错误边界与Suspense集成</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">AsyncBoundary</span>(<span class="hljs-params">&#123; children, fallback, errorFallback &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;errorFallback&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">React.Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;fallback&#125;</span>&gt;</span></span><br><span class="language-xml">        &#123;children&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">React.Suspense</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 使用示例</span><br>&lt;<span class="hljs-title class_">AsyncBoundary</span> <br>  fallback=&#123;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Spinner</span> /&gt;</span></span>&#125;<br>  errorFallback=&#123;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">AsyncError</span> /&gt;</span></span>&#125;<br>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">LazyComponent</span> /&gt;</span></span><br>&lt;/<span class="hljs-title class_">AsyncBoundary</span>&gt;<br></code></pre></td></tr></table></figure>

<h3 id="函数组件错误处理方案"><a href="#函数组件错误处理方案" class="headerlink" title="函数组件错误处理方案"></a>函数组件错误处理方案</h3><p><strong>自定义Hook实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useErrorBoundary</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [error, setError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <br>  <span class="hljs-keyword">const</span> handleError = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">setError</span>(err);<br>    <span class="hljs-keyword">return</span> err;<br>  &#125;, []);<br>  <br>  <span class="hljs-keyword">const</span> resetError = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">setError</span>(<span class="hljs-literal">null</span>);<br>  &#125;, []);<br>  <br>  <span class="hljs-keyword">return</span> [error, handleError, resetError];<br>&#125;<br><br><span class="hljs-comment">// 使用示例</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ComponentWithError</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [error, handleError, resetError] = <span class="hljs-title function_">useErrorBoundary</span>();<br>  <br>  <span class="hljs-keyword">if</span> (error) &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>组件出错: &#123;error.message&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;resetError&#125;</span>&gt;</span>重试<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    );<br>  &#125;<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">UnstableComponent</span> <span class="hljs-attr">onError</span>=<span class="hljs-string">&#123;handleError&#125;</span> /&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">UnstableComponent</span>(<span class="hljs-params">&#123; onError &#125;</span>) &#123;<br>  <span class="hljs-comment">// 模拟错误</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">throwError</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-comment">// 可能出错的操作</span><br>      <span class="hljs-title function_">riskyOperation</span>();<br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>      <span class="hljs-title function_">onError</span>(err); <span class="hljs-comment">// 手动触发错误边界</span><br>    &#125;<br>  &#125;;<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;throwError&#125;</span>&gt;</span>执行危险操作<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>第三方Hook库</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 使用 react-error-boundary 库</span><br><span class="hljs-keyword">import</span> &#123; useErrorBoundary &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-error-boundary&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; showBoundary &#125; = <span class="hljs-title function_">useErrorBoundary</span>();<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">loadData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUserData</span>();<br>      <span class="hljs-comment">// 处理数据...</span><br>    &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>      <span class="hljs-title function_">showBoundary</span>(error);<br>    &#125;<br>  &#125;;<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;loadData&#125;</span>&gt;</span>加载数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="常见错误场景与解决方案"><a href="#常见错误场景与解决方案" class="headerlink" title="常见错误场景与解决方案"></a>常见错误场景与解决方案</h3><p><strong>异步错误捕获</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 错误边界无法捕获的异步错误解决方案</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">AsyncErrorHandler</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [error, setError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 全局未捕获错误处理</span><br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleUnhandledRejection</span> = (<span class="hljs-params">event</span>) =&gt; &#123;<br>      <span class="hljs-title function_">setError</span>(event.<span class="hljs-property">reason</span>);<br>    &#125;;<br>    <br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleUncaughtError</span> = (<span class="hljs-params">event</span>) =&gt; &#123;<br>      <span class="hljs-title function_">setError</span>(event.<span class="hljs-property">error</span>);<br>    &#125;;<br>    <br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;unhandledrejection&#x27;</span>, handleUnhandledRejection);<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;error&#x27;</span>, handleUncaughtError);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;unhandledrejection&#x27;</span>, handleUnhandledRejection);<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;error&#x27;</span>, handleUncaughtError);<br>    &#125;;<br>  &#125;, []);<br>  <br>  <span class="hljs-keyword">if</span> (error) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">GlobalErrorScreen</span> <span class="hljs-attr">error</span>=<span class="hljs-string">&#123;error&#125;</span> /&gt;</span></span>;<br>  &#125;<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">children</span>;<br>&#125;<br><br><span class="hljs-comment">// 在应用顶层使用</span><br>&lt;<span class="hljs-title class_">AsyncErrorHandler</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span><br>&lt;/<span class="hljs-title class_">AsyncErrorHandler</span>&gt;<br></code></pre></td></tr></table></figure>

<p><strong>错误边界嵌套冲突</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 自定义错误传播机制</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PropagatingErrorBoundary</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  state = &#123; <span class="hljs-attr">hasError</span>: <span class="hljs-literal">false</span> &#125;;<br>  <br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getDerivedStateFromError</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">hasError</span>: <span class="hljs-literal">true</span> &#125;;<br>  &#125;<br>  <br>  <span class="hljs-title function_">componentDidCatch</span>(<span class="hljs-params">error, errorInfo</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">onError</span>) &#123;<br>      <span class="hljs-comment">// 将错误传递给父级边界</span><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-title function_">onError</span>(error, errorInfo);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">hasError</span>) &#123;<br>      <span class="hljs-comment">// 没有父级处理器时处理错误</span><br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Unhandled error:&#x27;</span>, error, errorInfo);<br>    &#125;<br>  &#125;<br>  <br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">hasError</span> <br>      ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">fallback</span> <br>      : <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">children</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用示例</span><br>&lt;<span class="hljs-title class_">PropagatingErrorBoundary</span> <br>  onError=&#123;<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123; <span class="hljs-comment">/* 传递给上层 */</span> &#125;&#125;<br>  fallback=&#123;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">LocalFallback</span> /&gt;</span></span>&#125;<br>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> /&gt;</span></span><br>&lt;/<span class="hljs-title class_">PropagatingErrorBoundary</span>&gt;<br></code></pre></td></tr></table></figure>

<p><strong>生产环境错误处理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 生产环境专用错误边界</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductionErrorBoundary</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  state = &#123; <span class="hljs-attr">hasError</span>: <span class="hljs-literal">false</span> &#125;;<br>  <br>  <span class="hljs-title function_">componentDidCatch</span>(<span class="hljs-params">error, errorInfo</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; <span class="hljs-attr">hasError</span>: <span class="hljs-literal">true</span> &#125;);<br>    <br>    <span class="hljs-comment">// 生产环境特殊处理</span><br>    <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span>) &#123;<br>      <span class="hljs-title function_">sendProductionErrorReport</span>(error, &#123;<br>        <span class="hljs-attr">componentStack</span>: errorInfo.<span class="hljs-property">componentStack</span>,<br>        <span class="hljs-attr">userAgent</span>: navigator.<span class="hljs-property">userAgent</span><br>      &#125;);<br>    &#125;<br>  &#125;<br>  <br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">hasError</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">productionFallback</span> || (<br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;production-error&quot;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>抱歉，出现了一些问题<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>我们的团队已收到通知，正在修复<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> window.location.reload()&#125;&gt;</span><br><span class="language-xml">            刷新页面</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>      );<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">children</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="错误边界最佳实践"><a href="#错误边界最佳实践" class="headerlink" title="错误边界最佳实践"></a>错误边界最佳实践</h3><p><strong>分层错误处理策略</strong></p>
<pre class="mermaid">graph LR
    A[顶层边界] -->|捕获全局错误| B[应用崩溃页面]
    C[模块边界] -->|捕获模块错误| D[模块降级UI]
    E[组件边界] -->|捕获组件错误| F[组件占位符]
    G[API边界] -->|捕获数据错误| H[空状态提示]</pre>

<p><strong>错误恢复策略比较</strong></p>
<table>
<thead>
<tr>
<th align="left">策略</th>
<th align="left">实现方式</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">页面刷新</td>
<td align="left">window.location.reload()</td>
<td align="left">全局状态不可恢复</td>
</tr>
<tr>
<td align="left">组件重置</td>
<td align="left">key 属性变化</td>
<td align="left">独立组件失败</td>
</tr>
<tr>
<td align="left">状态回滚</td>
<td align="left">恢复之前的状态快照</td>
<td align="left">表单操作失败</td>
</tr>
<tr>
<td align="left">备用数据</td>
<td align="left">显示缓存数据</td>
<td align="left">数据获取失败</td>
</tr>
</tbody></table>
<p><strong>错误日志规范</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">logErrorBoundary</span>(<span class="hljs-params">error, info</span>) &#123;<br>  <span class="hljs-keyword">const</span> logEntry = &#123;<br>    <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),<br>    <span class="hljs-attr">message</span>: error.<span class="hljs-property">message</span>,<br>    <span class="hljs-attr">stack</span>: error.<span class="hljs-property">stack</span>,<br>    <span class="hljs-attr">componentStack</span>: info.<span class="hljs-property">componentStack</span>,<br>    <span class="hljs-attr">location</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,<br>    <span class="hljs-attr">user</span>: currentUser ? currentUser.<span class="hljs-property">id</span> : <span class="hljs-string">&#x27;anonymous&#x27;</span>,<br>    <span class="hljs-attr">platform</span>: navigator.<span class="hljs-property">platform</span>,<br>    <span class="hljs-attr">environment</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span>,<br>    <span class="hljs-attr">version</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">REACT_APP_VERSION</span><br>  &#125;;<br>  <br>  <span class="hljs-comment">// 发送到日志服务</span><br>  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api/logs/errors&#x27;</span>, &#123;<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>    <span class="hljs-attr">headers</span>: &#123; <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span> &#125;,<br>    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(logEntry)<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="面试高频问题解析"><a href="#面试高频问题解析" class="headerlink" title="面试高频问题解析"></a>面试高频问题解析</h3><p><strong>Q：错误边界可以捕获哪些类型的错误？</strong></p>
<ul>
<li>子组件渲染期间的错误</li>
<li>生命周期方法中的错误（包括渲染阶段）</li>
<li>构造函数中的错误</li>
<li>整个组件树的错误（包括异步代码中的错误？不行！）</li>
</ul>
<p>特别注意：</p>
<ul>
<li>事件处理程序中的错误不会被捕获</li>
<li>异步代码（setTimeout, Promise）错误不会被捕获</li>
<li>服务端渲染错误不会被捕获</li>
<li>错误边界自身抛出的错误不会被捕获</li>
</ul>
<p><strong>Q：为什么错误边界必须用类组件实现？</strong></p>
<ul>
<li>因为错误边界依赖 getDerivedStateFromError 和 componentDidCatch 生命周期方法</li>
<li>这两个方法目前只在类组件中可用</li>
<li>React 团队表示暂时没有计划在函数组件中添加类似能力</li>
</ul>
<p><strong>Q：如何在函数组件中实现类似错误边界的功能？</strong></p>
<ul>
<li>使用类组件包装：创建错误边界类组件包裹函数组件</li>
<li>自定义Hook：使用 useErrorBoundary Hook 手动捕获错误</li>
<li>第三方库：使用 react-error-boundary 库的 useErrorBoundary Hook</li>
<li>错误传播：在函数组件中抛出错误让父级错误边界捕获</li>
</ul>
<p><strong>Q：如何测试错误边界组件？</strong></p>
<p>测试策略：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 使用 Jest 和 React Testing Library</span><br><span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;捕获错误并显示降级UI&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// 创建抛出错误的组件</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">ErrorComponent</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;测试错误&#x27;</span>);<br>  &#125;;<br>  <br>  <span class="hljs-keyword">const</span> &#123; getByText &#125; = <span class="hljs-title function_">render</span>(<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">div</span>&gt;</span>错误捕获<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>&#125;&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ErrorComponent</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span><br>  );<br>  <br>  <span class="hljs-title function_">expect</span>(<span class="hljs-title function_">getByText</span>(<span class="hljs-string">&#x27;错误捕获&#x27;</span>)).<span class="hljs-title function_">toBeInTheDocument</span>();<br>&#125;);<br><br><span class="hljs-comment">// 测试错误日志</span><br><span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;记录错误到监控系统&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> mockErrorLogger = jest.<span class="hljs-title function_">fn</span>();<br>  <span class="hljs-keyword">const</span> error = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;测试错误&#x27;</span>);<br>  <br>  <span class="hljs-title function_">render</span>(<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span> <span class="hljs-attr">onError</span>=<span class="hljs-string">&#123;mockErrorLogger&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ErrorComponent</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span><br>  );<br>  <br>  <span class="hljs-title function_">expect</span>(mockErrorLogger).<span class="hljs-title function_">toHaveBeenCalledWith</span>(<br>    error,<br>    expect.<span class="hljs-title function_">objectContaining</span>(&#123;<br>      <span class="hljs-attr">componentStack</span>: expect.<span class="hljs-title function_">any</span>(<span class="hljs-title class_">String</span>)<br>    &#125;)<br>  );<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>核心功能：<ul>
<li>捕获子组件树中的渲染错误</li>
<li>展示降级UI替代崩溃界面</li>
<li>记录错误信息用于分析</li>
</ul>
</li>
<li>实现关键：<ul>
<li>getDerivedStateFromError 设置错误状态</li>
<li>componentDidCatch 记录错误信息</li>
<li>类组件专属实现</li>
</ul>
</li>
<li>最佳实践：<ul>
<li>分层错误边界策略</li>
<li>生产环境专用处理</li>
<li>与Suspense协同使用</li>
<li>完善的错误日志记录</li>
</ul>
</li>
<li>React 18 增强：<ul>
<li>与并发渲染兼容</li>
<li>与Suspense深度集成</li>
<li>更精细的错误处理控制</li>
</ul>
</li>
<li>面试重点：<ul>
<li>错误边界的捕获范围</li>
<li>类组件的必要性</li>
<li>函数组件的替代方案</li>
<li>测试策略与方法</li>
</ul>
</li>
</ul>
<h2 id="4-3-代码分割与懒加载（React-lazy-Suspense）"><a href="#4-3-代码分割与懒加载（React-lazy-Suspense）" class="headerlink" title="4.3 代码分割与懒加载（React.lazy + Suspense）"></a>4.3 代码分割与懒加载（React.lazy + Suspense）</h2><h3 id="代码分割核心概念"><a href="#代码分割核心概念" class="headerlink" title="代码分割核心概念"></a>代码分割核心概念</h3><p><strong>问题背景：传统打包痛点</strong></p>
<pre class="mermaid">graph TD
    A[单入口打包] --> B[巨大的 bundle 文件]
    B --> C[首屏加载缓慢]
    B --> D[资源浪费]
    B --> E[用户体验差]</pre>

<p><strong>代码分割核心价值</strong></p>
<table>
<thead>
<tr>
<th align="left">优化方向</th>
<th align="left">实现效果</th>
<th align="left">技术手段</th>
</tr>
</thead>
<tbody><tr>
<td align="left">首屏加载</td>
<td align="left">减少初始加载体积</td>
<td align="left">路由级分割</td>
</tr>
<tr>
<td align="left">按需加载</td>
<td align="left">使用时才加载资源</td>
<td align="left">组件级懒加载</td>
</tr>
<tr>
<td align="left">缓存优化</td>
<td align="left">更细粒度缓存控制</td>
<td align="left">模块分离</td>
</tr>
<tr>
<td align="left">并行加载</td>
<td align="left">利用浏览器并发能力</td>
<td align="left">多 chunk 并行</td>
</tr>
</tbody></table>
<h3 id="基础实现方案"><a href="#基础实现方案" class="headerlink" title="基础实现方案"></a>基础实现方案</h3><p><strong>Webpack 动态导入</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 动态导入语法</span><br><span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;./math&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">math</span> =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(math.<span class="hljs-title function_">add</span>(<span class="hljs-number">16</span>, <span class="hljs-number">26</span>));<br>&#125;);<br><br><span class="hljs-comment">// React 组件动态导入</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ProductModal</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./ProductModal&#x27;</span>));<br></code></pre></td></tr></table></figure>

<p><strong>React.lazy 基础用法</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">HomePage</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./pages/HomePage&#x27;</span>));<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">AboutPage</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./pages/AboutPage&#x27;</span>));<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ContactPage</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./pages/ContactPage&#x27;</span>));<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        &lt;<span class="hljs-attr">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">Spinner</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">HomePage</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br><span class="language-xml">      &#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/about&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        &lt;<span class="hljs-attr">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">Spinner</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">AboutPage</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br><span class="language-xml">      &#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/contact&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        &lt;<span class="hljs-attr">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">Spinner</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">ContactPage</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br><span class="language-xml">      &#125; /&gt;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Suspense 核心机制</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserDashboard</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">UserProfile</span> /&gt;</span></span><br><span class="language-xml">      </span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">CardSkeleton</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">RecentActivities</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br><span class="language-xml">      </span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">ChartPlaceholder</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">PerformanceChart</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 嵌套 Suspense 示例</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">FullPageSpinner</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span></span><br><span class="language-xml">      </span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">ContentLoader</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span></span><br><span class="language-xml">              &#123;/* 路由配置 */&#125;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span></span><br><span class="language-xml">      </span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;null&#125;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">LiveChatWidget</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="高级优化策略"><a href="#高级优化策略" class="headerlink" title="高级优化策略"></a>高级优化策略</h3><p><strong>路由级代码分割</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 路由配置文件</span><br><span class="hljs-keyword">const</span> routes = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>,<br>    <span class="hljs-attr">element</span>: (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">PageLoader</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">HomePage</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br>    )<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/dashboard&#x27;</span>,<br>    <span class="hljs-attr">element</span>: (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">DashboardSkeleton</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">DashboardLayout</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br>    ),<br>    <span class="hljs-attr">children</span>: [<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;analytics&#x27;</span>,<br>        <span class="hljs-attr">element</span>: (<br>          <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">ChartLoader</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">AnalyticsPage</span> /&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br>        )<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;settings&#x27;</span>,<br>        <span class="hljs-attr">element</span>: (<br>          <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">SettingsPlaceholder</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">SettingsPage</span> /&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br>        )<br>      &#125;<br>    ]<br>  &#125;<br>];<br></code></pre></td></tr></table></figure>

<p><strong>组件级懒加载</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">ProductGallery</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./ProductGallery&#x27;</span>));<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ProductReviews</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./ProductReviews&#x27;</span>));<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">RelatedProducts</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./RelatedProducts&#x27;</span>));<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductDetailPage</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [activeTab, setActiveTab] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;gallery&#x27;</span>);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      &#123;/* 标签切换 */&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Tabs</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;setActiveTab&#125;</span> /&gt;</span></span><br><span class="language-xml">      </span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;tab-content&quot;</span>&gt;</span></span><br><span class="language-xml">        &#123;activeTab === &#x27;gallery&#x27; &amp;&amp; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">ImageGridSkeleton</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">ProductGallery</span> /&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br><span class="language-xml">        )&#125;</span><br><span class="language-xml">        </span><br><span class="language-xml">        &#123;activeTab === &#x27;reviews&#x27; &amp;&amp; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">ReviewListSkeleton</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">ProductReviews</span> /&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br><span class="language-xml">        )&#125;</span><br><span class="language-xml">        </span><br><span class="language-xml">        &#123;activeTab === &#x27;related&#x27; &amp;&amp; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">ProductCardSkeleton</span> <span class="hljs-attr">count</span>=<span class="hljs-string">&#123;3&#125;</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">RelatedProducts</span> /&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br><span class="language-xml">        )&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>预加载优化</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 预加载组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">PreloadComponent</span>(<span class="hljs-params">&#123; component &#125;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    component.<span class="hljs-title function_">preload</span>();<br>  &#125;, [component]);<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br><br><span class="hljs-comment">// 路由预加载</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 预加载可能访问的页面</span><br>    <span class="hljs-keyword">const</span> preloadPages = [<br>      <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./pages/AboutPage&#x27;</span>),<br>      <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./pages/ContactPage&#x27;</span>)<br>    ];<br>    <br>    <span class="hljs-comment">// 用户空闲时预加载</span><br>    <span class="hljs-keyword">const</span> idleCallback = <span class="hljs-title function_">requestIdleCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      preloadPages.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">preload</span> =&gt;</span> <span class="hljs-title function_">preload</span>());<br>    &#125;);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">cancelIdleCallback</span>(idleCallback);<br>  &#125;, []);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">HomePage</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/about&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          &lt;<span class="hljs-attr">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">Loader</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">            &lt;React.lazy(() =&gt; import(&#x27;./pages/AboutPage&#x27;)) /&gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br><span class="language-xml">        &#125; /&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/contact&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          &lt;<span class="hljs-attr">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">Loader</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">            &lt;React.lazy(() =&gt; import(&#x27;./pages/ContactPage&#x27;)) /&gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br><span class="language-xml">        &#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span></span><br><span class="language-xml">      </span><br><span class="language-xml">      &#123;/* 悬停预加载 */&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">NavLink</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/about&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onMouseEnter</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> import(&#x27;./pages/AboutPage&#x27;)&#125;</span><br><span class="language-xml">      &gt;</span><br><span class="language-xml">        关于我们</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">NavLink</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="性能优化进阶技巧"><a href="#性能优化进阶技巧" class="headerlink" title="性能优化进阶技巧"></a>性能优化进阶技巧</h3><p><strong>模块联合（微前端）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 动态加载远程模块</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">RemoteComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span><br>  <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;remote_app/Component&#x27;</span>).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> <br>    <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./FallbackComponent&#x27;</span>)<br>  )<br>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">RemoteLoader</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">RemoteComponent</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// Webpack 配置</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModuleFederationPlugin</span>(&#123;<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;host_app&#x27;</span>,<br>      <span class="hljs-attr">remotes</span>: &#123;<br>        <span class="hljs-attr">remote_app</span>: <span class="hljs-string">&#x27;remote_app@http://remote-domain.com/remoteEntry.js&#x27;</span><br>      &#125;<br>    &#125;)<br>  ]<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>资源优先级控制</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 预加载关键资源</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">CriticalResourceLoader</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Head</span>&gt;</span></span><br><span class="language-xml">      &#123;/* 关键 CSS */&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">link</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;preload&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/critical.css&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">as</span>=<span class="hljs-string">&quot;style&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onLoad</span>=<span class="hljs-string">&quot;this.rel=&#x27;stylesheet&#x27;&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">      </span><br><span class="language-xml">      &#123;/* 关键脚本 */&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">link</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;modulepreload&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/main.js&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">as</span>=<span class="hljs-string">&quot;script&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">      </span><br><span class="language-xml">      &#123;/* 字体预加载 */&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">link</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;preload&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/fonts/inter.woff2&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">as</span>=<span class="hljs-string">&quot;font&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;font/woff2&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">crossOrigin</span>=<span class="hljs-string">&quot;anonymous&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Head</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 延迟加载非关键资源</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">LazyNonCritical</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">loadNonCritical</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>      <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./analytics.js&#x27;</span>);<br>      <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./chat-widget.js&#x27;</span>);<br>    &#125;;<br>    <br>    <span class="hljs-comment">// 空闲时加载</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;requestIdleCallback&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span>) &#123;<br>      <span class="hljs-title function_">requestIdleCallback</span>(loadNonCritical);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-built_in">setTimeout</span>(loadNonCritical, <span class="hljs-number">5000</span>);<br>    &#125;<br>  &#125;, []);<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>骨架屏优化技巧</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 高级骨架屏组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductCardSkeleton</span>(<span class="hljs-params">&#123; count = <span class="hljs-number">1</span> &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(&#123; <span class="hljs-attr">length</span>: count &#125;).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">_, index</span>) =&gt;</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;index&#125;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;skeleton-card&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;skeleton-image&quot;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;skeleton-line w-3/4&quot;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;skeleton-line w-1/2&quot;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;skeleton-line w-1/3&quot;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  ));<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs CSS">// CSS 动画优化<br><span class="hljs-keyword">@keyframes</span> pulse &#123;<br>  <span class="hljs-number">0%</span>, <span class="hljs-number">100%</span> &#123; <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; &#125;<br>  <span class="hljs-number">50%</span> &#123; <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.5</span>; &#125;<br>&#125;<br><br><span class="hljs-selector-class">.skeleton-card</span> &#123;<br>  <span class="hljs-attribute">animation</span>: pulse <span class="hljs-number">2s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.4</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">1</span>) infinite;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e5e7eb</span>;<br>  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">0.5rem</span>;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>&#125;<br><br><span class="hljs-selector-class">.skeleton-line</span> &#123;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">1rem</span>;<br>  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">0.75rem</span>;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#d1d5db</span>;<br>  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">0.25rem</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="常见问题与解决方案"><a href="#常见问题与解决方案" class="headerlink" title="常见问题与解决方案"></a>常见问题与解决方案</h3><p><strong>大型模块加载优化</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 分块加载大型模块</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadLargeModule</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [part1, part2, part3] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<br>    <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./modulePart1&#x27;</span>),<br>    <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./modulePart2&#x27;</span>),<br>    <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./modulePart3&#x27;</span>)<br>  ]);<br>  <br>  <span class="hljs-keyword">return</span> &#123;<br>    ...part1,<br>    ...part2,<br>    ...part3<br>  &#125;;<br>&#125;<br><br><span class="hljs-comment">// 渐进式加载</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">LargeComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-title function_">async</span> () =&gt; &#123;<br>  <span class="hljs-comment">// 先加载核心部分</span><br>  <span class="hljs-keyword">const</span> core = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./CoreComponent&#x27;</span>);<br>  <br>  <span class="hljs-comment">// 空闲时加载增强部分</span><br>  <span class="hljs-title function_">requestIdleCallback</span>(<span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> enhancements = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./Enhancements&#x27;</span>);<br>    core.<span class="hljs-title function_">enhance</span>(enhancements);<br>  &#125;);<br>  <br>  <span class="hljs-keyword">return</span> core;<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><ul>
<li>核心价值：<ul>
<li>显著减少首屏加载时间</li>
<li>按需加载提升资源利用率</li>
<li>改善用户体验</li>
</ul>
</li>
<li>关键技术：<ul>
<li>React.lazy：组件动态导入</li>
<li>Suspense：加载状态管理</li>
<li>动态 import()：代码分割基础</li>
</ul>
</li>
<li>最佳实践：<ul>
<li>路由级分割：按页面拆分</li>
<li>组件级懒加载：非核心功能延迟加载</li>
<li>预加载优化：预测用户行为</li>
<li>骨架屏技术：优化加载体验</li>
</ul>
</li>
<li>React 18 增强：<ul>
<li>流式 SSR 渲染</li>
<li>并发模式下的 Suspense</li>
<li>更精细的加载控制</li>
</ul>
</li>
<li>企业级方案：<ul>
<li>错误边界集成</li>
<li>微前端架构支持</li>
<li>性能监控与分析</li>
</ul>
</li>
<li>常见问题解决：<ul>
<li>加载闪烁控制</li>
<li>模块加载失败处理</li>
<li>大型模块优化</li>
</ul>
</li>
</ul>
<h2 id="4-4-Portals（渲染到-DOM-外部节点）"><a href="#4-4-Portals（渲染到-DOM-外部节点）" class="headerlink" title="4.4 Portals（渲染到 DOM 外部节点）"></a>4.4 Portals（渲染到 DOM 外部节点）</h2><h3 id="Portals-核心概念"><a href="#Portals-核心概念" class="headerlink" title="Portals 核心概念"></a>Portals 核心概念</h3><p><strong>解决的问题场景</strong></p>
<pre class="mermaid">graph TD
    A[父组件] --> B[overflow: hidden]
    A --> C[z-index 层级限制]
    A --> D[transform 上下文]
    B --> E[子元素显示不全]
    C --> F[模态框被遮挡]
    D --> G[fixed 定位失效]</pre>

<p><strong>Portals 核心能力</strong></p>
<table>
<thead>
<tr>
<th align="left">能力</th>
<th align="left">描述</th>
<th align="left">应用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">突破层级限制</td>
<td align="left">渲染到 DOM 树任意位置</td>
<td align="left">模态框、弹出层</td>
</tr>
<tr>
<td align="left">保留 React 上下文</td>
<td align="left">保持事件冒泡和上下文</td>
<td align="left">全局通知</td>
</tr>
<tr>
<td align="left">样式隔离</td>
<td align="left">避免父容器样式影响</td>
<td align="left">工具提示</td>
</tr>
<tr>
<td align="left">无障碍支持</td>
<td align="left">管理焦点和键盘事件</td>
<td align="left">无障碍对话框</td>
</tr>
</tbody></table>
<h3 id="基础用法与API"><a href="#基础用法与API" class="headerlink" title="基础用法与API"></a>基础用法与API</h3><p><strong>ReactDOM.createPortal 基础</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Modal</span>(<span class="hljs-params">&#123; children, isOpen &#125;</span>) &#123;<br>  <span class="hljs-keyword">if</span> (!isOpen) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>  <br>  <span class="hljs-comment">// 创建 Portal 渲染到 body 外的独立容器</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createPortal</span>(<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;modal&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;modal-content&quot;</span>&gt;</span></span><br><span class="language-xml">        &#123;children&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;modal-root&#x27;</span>) <span class="hljs-comment">// 外部容器</span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 在 public/index.html 中添加容器</span><br>&lt;body&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;modal-root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span> &lt;!-- <span class="hljs-title class_">Portal</span> 目标容器 --&gt;<br>&lt;/body&gt;<br></code></pre></td></tr></table></figure>

<p><strong>动态容器管理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">SmartPortal</span>(<span class="hljs-params">&#123; children, containerId = <span class="hljs-string">&#x27;portal-root&#x27;</span> &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [container, setContainer] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 查找或创建容器</span><br>    <span class="hljs-keyword">let</span> portalContainer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(containerId);<br>    <br>    <span class="hljs-keyword">if</span> (!portalContainer) &#123;<br>      portalContainer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;div&#x27;</span>);<br>      portalContainer.<span class="hljs-property">id</span> = containerId;<br>      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(portalContainer);<br>    &#125;<br>    <br>    <span class="hljs-title function_">setContainer</span>(portalContainer);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-comment">// 清理容器</span><br>      <span class="hljs-keyword">if</span> (portalContainer) &#123;<br>        <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(portalContainer);<br>      &#125;<br>    &#125;;<br>  &#125;, [containerId]);<br>  <br>  <span class="hljs-keyword">if</span> (!container) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createPortal</span>(children, container);<br>&#125;<br><br><span class="hljs-comment">// 使用示例</span><br>&lt;<span class="hljs-title class_">SmartPortal</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Notification</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&quot;操作成功！&quot;</span> /&gt;</span></span><br>&lt;/<span class="hljs-title class_">SmartPortal</span>&gt;<br></code></pre></td></tr></table></figure>

<h3 id="核心应用场景"><a href="#核心应用场景" class="headerlink" title="核心应用场景"></a>核心应用场景</h3><p><strong>模态对话框实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ModalDialog</span>(<span class="hljs-params">&#123; title, children, onClose &#125;</span>) &#123;<br>  <span class="hljs-comment">// 阻止背景滚动</span><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">overflow</span> = <span class="hljs-string">&#x27;hidden&#x27;</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">overflow</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    &#125;;<br>  &#125;, []);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;modal-overlay&quot;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;onClose&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;modal-dialog&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> e.stopPropagation()&#125;</span><br><span class="language-xml">      &gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;modal-header&quot;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>&#123;title&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;onClose&#125;</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">&quot;关闭&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-symbol">&amp;times;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;modal-body&quot;</span>&gt;</span></span><br><span class="language-xml">          &#123;children&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 使用 Portal 的模态框组件</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Modal</span>(<span class="hljs-params">&#123; isOpen, ...props &#125;</span>) &#123;<br>  <span class="hljs-keyword">if</span> (!isOpen) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createPortal</span>(<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ModalDialog</span> &#123;<span class="hljs-attr">...props</span>&#125; /&gt;</span></span>,<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;modal-root&#x27;</span>)<br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>全局通知系统</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">NotificationContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createContext</span>();<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">NotificationProvider</span>(<span class="hljs-params">&#123; children &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [notifications, setNotifications] = <span class="hljs-title function_">useState</span>([]);<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">addNotification</span> = (<span class="hljs-params">message, type = <span class="hljs-string">&#x27;info&#x27;</span></span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> id = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();<br>    <span class="hljs-title function_">setNotifications</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> [...prev, &#123; id, message, type &#125;]);<br>    <br>    <span class="hljs-comment">// 自动关闭</span><br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-title function_">removeNotification</span>(id);<br>    &#125;, <span class="hljs-number">5000</span>);<br>  &#125;;<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">removeNotification</span> = (<span class="hljs-params">id</span>) =&gt; &#123;<br>    <span class="hljs-title function_">setNotifications</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n.<span class="hljs-property">id</span> !== id));<br>  &#125;;<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">NotificationContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">addNotification</span> &#125;&#125;&gt;</span></span><br><span class="language-xml">      &#123;children&#125;</span><br><span class="language-xml">      </span><br><span class="language-xml">      &#123;/* 使用 Portal 渲染到独立区域 */&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">SmartPortal</span> <span class="hljs-attr">containerId</span>=<span class="hljs-string">&quot;notification-portal&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;notification-container&quot;</span>&gt;</span></span><br><span class="language-xml">          &#123;notifications.map(notification =&gt; (</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">NotificationItem</span> </span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;notification.id&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">notification</span>=<span class="hljs-string">&#123;notification&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">onClose</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> removeNotification(notification.id)&#125;</span><br><span class="language-xml">            /&gt;</span><br><span class="language-xml">          ))&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">SmartPortal</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">NotificationContext.Provider</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 通知项组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">NotificationItem</span>(<span class="hljs-params">&#123; notification, onClose &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>`<span class="hljs-attr">notification</span> $&#123;<span class="hljs-attr">notification.type</span>&#125;`&#125;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;notification.message&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;onClose&#125;</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">&quot;关闭通知&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-symbol">&amp;times;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>工具提示与悬浮框</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Tooltip</span>(<span class="hljs-params">&#123; children, content &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [isVisible, setIsVisible] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">const</span> [position, setPosition] = <span class="hljs-title function_">useState</span>(&#123; <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">0</span> &#125;);<br>  <span class="hljs-keyword">const</span> triggerRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">updatePosition</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">if</span> (triggerRef.<span class="hljs-property">current</span>) &#123;<br>      <span class="hljs-keyword">const</span> rect = triggerRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();<br>      <span class="hljs-title function_">setPosition</span>(&#123;<br>        <span class="hljs-attr">top</span>: rect.<span class="hljs-property">bottom</span> + <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span>,<br>        <span class="hljs-attr">left</span>: rect.<span class="hljs-property">left</span> + rect.<span class="hljs-property">width</span> / <span class="hljs-number">2</span><br>      &#125;);<br>    &#125;<br>  &#125;;<br>  <br>  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (isVisible) &#123;<br>      <span class="hljs-title function_">updatePosition</span>();<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, updatePosition);<br>      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, updatePosition);<br>    &#125;<br>  &#125;, [isVisible]);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">span</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;triggerRef&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onMouseEnter</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setIsVisible(true)&#125;</span><br><span class="language-xml">        onMouseLeave=&#123;() =&gt; setIsVisible(false)&#125;</span><br><span class="language-xml">        onFocus=&#123;() =&gt; setIsVisible(true)&#125;</span><br><span class="language-xml">        onBlur=&#123;() =&gt; setIsVisible(false)&#125;</span><br><span class="language-xml">        aria-describedby=&quot;tooltip-content&quot;</span><br><span class="language-xml">      &gt;</span><br><span class="language-xml">        &#123;children&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">      </span><br><span class="language-xml">      &#123;/* 使用 Portal 避免被父容器裁剪 */&#125;</span><br><span class="language-xml">      &#123;isVisible &amp;&amp; (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">SmartPortal</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> </span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;tooltip-content&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;tooltip&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;tooltip&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">position:</span> &#x27;<span class="hljs-attr">absolute</span>&#x27;,</span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">top:</span> `$&#123;<span class="hljs-attr">position.top</span>&#125;<span class="hljs-attr">px</span>`,</span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">left:</span> `$&#123;<span class="hljs-attr">position.left</span>&#125;<span class="hljs-attr">px</span>`,</span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">transform:</span> &#x27;<span class="hljs-attr">translateX</span>(<span class="hljs-attr">-50</span>%)&#x27;</span></span><br><span class="hljs-tag"><span class="language-xml">            &#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">          &gt;</span></span><br><span class="language-xml">            &#123;content&#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">SmartPortal</span>&gt;</span></span><br><span class="language-xml">      )&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="高级特性与模式"><a href="#高级特性与模式" class="headerlink" title="高级特性与模式"></a>高级特性与模式</h3><p><strong>事件冒泡处理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">EventDemo</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePortalClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Portal 内容被点击&#x27;</span>);<br>  &#125;;<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleParentClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;父组件被点击&#x27;</span>);<br>  &#125;;<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleParentClick&#125;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>事件冒泡测试<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      </span><br><span class="language-xml">      &#123;/* Portal 内容会冒泡到 React 树中的父组件 */&#125;</span><br><span class="language-xml">      &#123;ReactDOM.createPortal(</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handlePortalClick&#125;</span>&gt;</span></span><br><span class="language-xml">          点击我（Portal 按钮）</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>,</span><br><span class="language-xml">        document.getElementById(&#x27;portal-root&#x27;)</span><br><span class="language-xml">      )&#125;</span><br><span class="language-xml">      </span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        点击 Portal 按钮会触发两个日志：<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></span><br><span class="language-xml">        1. &quot;Portal 内容被点击&quot;<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></span><br><span class="language-xml">        2. &quot;父组件被点击&quot;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>上下文传递</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">ThemeContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createContext</span>(<span class="hljs-string">&#x27;light&#x27;</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ThemedPortalDemo</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;dark&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span></span><br><span class="language-xml">        </span><br><span class="language-xml">        &#123;/* Portal 内容能访问 React 树中的上下文 */&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">SmartPortal</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span></span><br><span class="language-xml">            &#123;theme =&gt; (</span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>`<span class="hljs-attr">theme-box</span> $&#123;<span class="hljs-attr">theme</span>&#125;`&#125;&gt;</span></span><br><span class="language-xml">                当前主题: &#123;theme&#125;</span><br><span class="language-xml">              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">            )&#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">SmartPortal</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Provider</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>无障碍对话框实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">AccessibleModal</span>(<span class="hljs-params">&#123; isOpen, title, children, onClose &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> modalRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br>  <br>  <span class="hljs-comment">// 关闭时返回焦点到触发元素</span><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> triggerElement = <span class="hljs-variable language_">document</span>.<span class="hljs-property">activeElement</span>;<br>    <br>    <span class="hljs-keyword">if</span> (isOpen &amp;&amp; modalRef.<span class="hljs-property">current</span>) &#123;<br>      modalRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">focus</span>();<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (triggerElement) &#123;<br>        triggerElement.<span class="hljs-title function_">focus</span>();<br>      &#125;<br>    &#125;;<br>  &#125;, [isOpen]);<br>  <br>  <span class="hljs-comment">// ESC 键关闭</span><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleKeyDown</span> = (<span class="hljs-params">e</span>) =&gt; &#123;<br>      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">&#x27;Escape&#x27;</span>) &#123;<br>        <span class="hljs-title function_">onClose</span>();<br>      &#125;<br>    &#125;;<br>    <br>    <span class="hljs-keyword">if</span> (isOpen) &#123;<br>      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;keydown&#x27;</span>, handleKeyDown);<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;keydown&#x27;</span>, handleKeyDown);<br>    &#125;;<br>  &#125;, [isOpen, onClose]);<br>  <br>  <span class="hljs-keyword">if</span> (!isOpen) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createPortal</span>(<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> </span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;modal&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;dialog&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">aria-modal</span>=<span class="hljs-string">&quot;true&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">aria-labelledby</span>=<span class="hljs-string">&quot;modal-title&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;modalRef&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">tabIndex</span>=<span class="hljs-string">&#123;-1&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;modal-content&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;modal-title&quot;</span>&gt;</span>&#123;title&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;children&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;onClose&#125;</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">&quot;关闭对话框&quot;</span>&gt;</span></span><br><span class="language-xml">          关闭</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;modal-root&#x27;</span>)<br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="企业级最佳实践-1"><a href="#企业级最佳实践-1" class="headerlink" title="企业级最佳实践"></a>企业级最佳实践</h3><p><strong>微前端集成</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MicroFrontendPortal</span>(<span class="hljs-params">&#123; appName, componentName &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [<span class="hljs-title class_">Component</span>, setComponent] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 动态加载远程模块</span><br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">loadRemoteComponent</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">const</span> remoteModule = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>[appName].<span class="hljs-title function_">get</span>(componentName);<br>        <span class="hljs-title function_">setComponent</span>(<span class="hljs-function">() =&gt;</span> remoteModule);<br>      &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`加载 <span class="hljs-subst">$&#123;appName&#125;</span>/<span class="hljs-subst">$&#123;componentName&#125;</span> 失败:`</span>, error);<br>      &#125;<br>    &#125;;<br>    <br>    <span class="hljs-title function_">loadRemoteComponent</span>();<br>  &#125;, [appName, componentName]);<br>  <br>  <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Component</span>) <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>加载中...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SmartPortal</span> <span class="hljs-attr">containerId</span>=<span class="hljs-string">&#123;</span>`$&#123;<span class="hljs-attr">appName</span>&#125;<span class="hljs-attr">-portal</span>`&#125;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Component</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">SmartPortal</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 使用示例</span><br>&lt;<span class="hljs-title class_">MicroFrontendPortal</span> <br>  appName=<span class="hljs-string">&quot;billingApp&quot;</span> <br>  componentName=<span class="hljs-string">&quot;PaymentWidget&quot;</span> <br>/&gt;<br></code></pre></td></tr></table></figure>

<h3 id="面试高频问题解析-1"><a href="#面试高频问题解析-1" class="headerlink" title="面试高频问题解析"></a>面试高频问题解析</h3><p><strong>Q：Portals 和普通渲染有什么区别？</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">普通渲染</th>
<th align="left">Portal</th>
</tr>
</thead>
<tbody><tr>
<td align="left">DOM 位置</td>
<td align="left">父组件内</td>
<td align="left">任意 DOM 节点</td>
</tr>
<tr>
<td align="left">事件冒泡</td>
<td align="left">遵循 DOM 结构</td>
<td align="left">遵循 React 树结构</td>
</tr>
<tr>
<td align="left">上下文访问</td>
<td align="left">正常访问</td>
<td align="left">正常访问</td>
</tr>
<tr>
<td align="left">样式继承</td>
<td align="left">受父容器影响</td>
<td align="left">可避免父容器影响</td>
</tr>
<tr>
<td align="left">应用场景</td>
<td align="left">常规 UI</td>
<td align="left">模态框、通知等</td>
</tr>
</tbody></table>
<p><strong>Q：为什么 Portal 的事件冒泡到 React 父组件？</strong></p>
<ul>
<li>Portal 的特殊之处在于它在 DOM 树中的位置是独立的</li>
<li>但 React 的事件系统是合成的，不依赖实际 DOM 结构</li>
<li>事件冒泡基于 React 组件树结构，而非实际 DOM 结构</li>
<li>因此 Portal 中的事件会冒泡到 React 树中的父组件</li>
</ul>
<p><strong>Q：如何阻止 Portal 的事件冒泡？</strong></p>
<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">PortalWithStopPropagation</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePortalClick</span> = (<span class="hljs-params">e</span>) =&gt; &#123;<br>    e.<span class="hljs-title function_">stopPropagation</span>(); <span class="hljs-comment">// 阻止事件冒泡</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Portal 点击&#x27;</span>);<br>  &#125;;<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createPortal</span>(<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handlePortalClick&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>点击我<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;portal-root&#x27;</span>)<br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Q：Portals 对无障碍有什么影响？</strong></p>
<p>最佳实践：</p>
<ul>
<li>焦点管理：打开 Portal 时移动焦点到内容，关闭时返回焦点</li>
<li>ARIA 属性：使用 role&#x3D;”dialog” 和 aria-modal&#x3D;”true”</li>
<li>键盘导航：实现 ESC 关闭和 Tab 键陷阱</li>
<li>屏幕阅读器：使用 aria-labelledby 关联标题</li>
<li>背景遮蔽：添加 aria-hidden&#x3D;”true” 到背景内容</li>
</ul>
<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><ul>
<li>核心价值：<ul>
<li>突破 CSS 层级限制（overflow, z-index, transform）</li>
<li>保持 React 上下文和事件系统</li>
<li>实现全局 UI 元素（模态框、通知、工具提示）</li>
</ul>
</li>
<li>关键技术：<ul>
<li>ReactDOM.createPortal() API</li>
<li>动态容器管理</li>
<li>事件冒泡处理</li>
<li>无障碍支持</li>
</ul>
</li>
<li>最佳实践：<ul>
<li>模态框实现（包含焦点管理）</li>
<li>全局通知系统</li>
<li>服务端渲染兼容</li>
<li>微前端集成</li>
</ul>
</li>
<li>React 18 增强：<ul>
<li>新的 Root API 支持</li>
<li>并发渲染兼容</li>
<li>更精细的控制能力</li>
</ul>
</li>
<li>企业级应用：<ul>
<li>安全沙箱模式</li>
<li>性能优化策略</li>
<li>调试与监控</li>
</ul>
</li>
<li>面试重点：<ul>
<li>Portals 与普通渲染的区别</li>
<li>事件冒泡机制</li>
<li>无障碍实现</li>
<li>服务端渲染处理</li>
</ul>
</li>
</ul>
<h2 id="4-5-高阶组件（HOC）与-Render-Props"><a href="#4-5-高阶组件（HOC）与-Render-Props" class="headerlink" title="4.5 高阶组件（HOC）与 Render Props"></a>4.5 高阶组件（HOC）与 Render Props</h2><h3 id="组件复用的核心挑战"><a href="#组件复用的核心挑战" class="headerlink" title="组件复用的核心挑战"></a>组件复用的核心挑战</h3><p><strong>传统组件复用的问题</strong></p>
<pre class="mermaid">graph TD
    A[组件复用需求] --> B[直接继承]
    A --> C[组合模式]
    B --> D[紧耦合]
    B --> E[灵活性差]
    C --> F[多层嵌套]
    C --> G[props 透传问题]</pre>

<p><strong>解决方案对比</strong></p>
<table>
<thead>
<tr>
<th align="left">模式</th>
<th align="left">核心思想</th>
<th align="left">适用场景</th>
<th align="left">优点</th>
<th align="left">缺点</th>
</tr>
</thead>
<tbody><tr>
<td align="left">高阶组件 (HOC)</td>
<td align="left">函数接受组件返回新组件</td>
<td align="left">横切关注点</td>
<td align="left">逻辑复用强</td>
<td align="left">嵌套过深</td>
</tr>
<tr>
<td align="left">Render Props</td>
<td align="left">组件通过 prop 渲染内容</td>
<td align="left">动态组合</td>
<td align="left">灵活直观</td>
<td align="left">回调地狱</td>
</tr>
<tr>
<td align="left">自定义 Hooks</td>
<td align="left">函数封装可复用逻辑</td>
<td align="left">功能复用</td>
<td align="left">简洁高效</td>
<td align="left">仅函数组件</td>
</tr>
</tbody></table>
<h3 id="高阶组件（HOC）深度解析"><a href="#高阶组件（HOC）深度解析" class="headerlink" title="高阶组件（HOC）深度解析"></a>高阶组件（HOC）深度解析</h3><p><strong>HOC 核心概念</strong></p>
<p>定义：高阶组件是一个函数，接受一个组件并返回一个新的增强组件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">EnhancedComponent</span> = <span class="hljs-title function_">withEnhancement</span>(<span class="hljs-title class_">WrappedComponent</span>);<br></code></pre></td></tr></table></figure>

<p><strong>HOC 实现模式</strong></p>
<p>(1) 属性代理（Props Proxy）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">withDataFetching</span>(<span class="hljs-params">WrappedComponent, fetchUrl</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">Component</span> &#123;<br>    state = &#123; <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span> &#125;;<br>    <br>    <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title function_">fetch</span>(fetchUrl)<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; data, <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> &#125;))<br>        .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; error, <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> &#125;));<br>    &#125;<br>    <br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">const</span> &#123; data, loading, error &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>      <br>      <span class="hljs-comment">// 注入额外 props</span><br>      <span class="hljs-keyword">return</span> (<br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">WrappedComponent</span> </span></span><br><span class="hljs-tag"><span class="language-xml">          &#123;<span class="hljs-attr">...this.props</span>&#125; </span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">loading</span>=<span class="hljs-string">&#123;loading&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">error</span>=<span class="hljs-string">&#123;error&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br>      );<br>    &#125;<br>  &#125;;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">UserProfileWithData</span> = <span class="hljs-title function_">withDataFetching</span>(<span class="hljs-title class_">UserProfile</span>, <span class="hljs-string">&#x27;/api/user/123&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p>(2) 反向继承（Inheritance Inversion）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">withLogging</span>(<span class="hljs-params">WrappedComponent</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">WrappedComponent</span> &#123;<br>    <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Component mounted:&#x27;</span>, <span class="hljs-title class_">WrappedComponent</span>.<span class="hljs-property">name</span>);<br>      <span class="hljs-variable language_">super</span>.<span class="hljs-property">componentDidMount</span>?.();<br>    &#125;<br>    <br>    <span class="hljs-title function_">componentWillUnmount</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Component unmounted:&#x27;</span>, <span class="hljs-title class_">WrappedComponent</span>.<span class="hljs-property">name</span>);<br>      <span class="hljs-variable language_">super</span>.<span class="hljs-property">componentWillUnmount</span>?.();<br>    &#125;<br>    <br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-comment">// 可操作渲染输出</span><br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">hidden</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>      &#125;<br>      <br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">render</span>();<br>    &#125;<br>  &#125;;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">EnhancedComponent</span> = <span class="hljs-title function_">withLogging</span>(<span class="hljs-title class_">MyComponent</span>);<br></code></pre></td></tr></table></figure>

<p><strong>HOC 链式组合</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 组合多个 HOC</span><br><span class="hljs-keyword">const</span> enhance = <span class="hljs-title function_">compose</span>(<br>  withRouter,<br>  <span class="hljs-title function_">withStyles</span>(styles),<br>  <span class="hljs-title function_">withDataFetching</span>(<span class="hljs-string">&#x27;/api/data&#x27;</span>),<br>  withErrorBoundary<br>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">SuperComponent</span> = <span class="hljs-title function_">enhance</span>(<span class="hljs-title class_">BaseComponent</span>);<br><br><span class="hljs-comment">// 自定义 compose 函数</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">compose</span>(<span class="hljs-params">...hocs</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">Component</span> =&gt;</span> <br>    hocs.<span class="hljs-title function_">reduceRight</span>(<span class="hljs-function">(<span class="hljs-params">acc, hoc</span>) =&gt;</span> <span class="hljs-title function_">hoc</span>(acc), <span class="hljs-title class_">Component</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>HOC 最佳实践</strong></p>
<p>(1) 显示名称设置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">withDisplayName</span>(<span class="hljs-params">WrappedComponent</span>) &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">WithDisplayName</span> = props =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">WrappedComponent</span> &#123;<span class="hljs-attr">...props</span>&#125; /&gt;</span></span>;<br>  <br>  <span class="hljs-comment">// 设置 displayName 便于调试</span><br>  <span class="hljs-keyword">const</span> displayName = <br>    <span class="hljs-title class_">WrappedComponent</span>.<span class="hljs-property">displayName</span> || <span class="hljs-title class_">WrappedComponent</span>.<span class="hljs-property">name</span> || <span class="hljs-string">&#x27;Component&#x27;</span>;<br>  <br>  <span class="hljs-title class_">WithDisplayName</span>.<span class="hljs-property">displayName</span> = <span class="hljs-string">`WithDisplayName(<span class="hljs-subst">$&#123;displayName&#125;</span>)`</span>;<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">WithDisplayName</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) 静态方法复制</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">copyStaticMethods</span>(<span class="hljs-params">WrappedComponent, EnhancedComponent</span>) &#123;<br>  <span class="hljs-comment">// 复制静态方法</span><br>  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(<span class="hljs-title class_">WrappedComponent</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">WrappedComponent</span>[key] === <span class="hljs-string">&#x27;function&#x27;</span>) &#123;<br>      <span class="hljs-title class_">EnhancedComponent</span>[key] = <span class="hljs-title class_">WrappedComponent</span>[key];<br>    &#125;<br>  &#125;);<br>  <br>  <span class="hljs-comment">// 复制静态属性</span><br>  <span class="hljs-title class_">EnhancedComponent</span>.<span class="hljs-property">staticProperty</span> = <span class="hljs-title class_">WrappedComponent</span>.<span class="hljs-property">staticProperty</span>;<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">EnhancedComponent</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(3) Refs 转发</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">withRefForwarding</span>(<span class="hljs-params">WrappedComponent</span>) &#123;<br>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">WithRefForwarding</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">const</span> &#123; forwardedRef, ...rest &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>;<br>      <br>      <span class="hljs-keyword">return</span> (<br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">WrappedComponent</span> </span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;forwardedRef&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">          &#123;<span class="hljs-attr">...rest</span>&#125; </span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br>      );<br>    &#125;<br>  &#125;<br>  <br>  <span class="hljs-comment">// 使用 forwardRef 转发 ref</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">React</span>.<span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">WithRefForwarding</span> &#123;<span class="hljs-attr">...props</span>&#125; <span class="hljs-attr">forwardedRef</span>=<span class="hljs-string">&#123;ref&#125;</span> /&gt;</span></span><br>  ));<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="Render-Props-深度解析"><a href="#Render-Props-深度解析" class="headerlink" title="Render Props 深度解析"></a>Render Props 深度解析</h3><p><strong>Render Props 核心概念</strong></p>
<p>定义：组件通过一个函数 prop（通常命名为 render 或 children）来动态决定渲染内容。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">&lt;<span class="hljs-title class_">DataProvider</span> render=&#123;<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;data&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>)&#125; /&gt;<br></code></pre></td></tr></table></figure>

<p><strong>基础实现模式</strong></p>
<p>(1) 标准 Render Prop</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MouseTracker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  state = &#123; <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> &#125;;<br>  <br>  handleMouseMove = <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>      <span class="hljs-attr">x</span>: event.<span class="hljs-property">clientX</span>,<br>      <span class="hljs-attr">y</span>: event.<span class="hljs-property">clientY</span><br>    &#125;);<br>  &#125;;<br>  <br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onMouseMove</span>=<span class="hljs-string">&#123;this.handleMouseMove&#125;</span>&gt;</span></span><br><span class="language-xml">        &#123;this.props.render(this.state)&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br>&lt;<span class="hljs-title class_">MouseTracker</span> render=&#123;<span class="hljs-function">(<span class="hljs-params">&#123; x, y &#125;</span>) =&gt;</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>鼠标位置: (&#123;x&#125;, &#123;y&#125;)<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br>)&#125; /&gt;<br></code></pre></td></tr></table></figure>

<p>(2) Children as Function</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Toggle</span>(<span class="hljs-params">&#123; children &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [on, setOn] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">toggle</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">setOn</span>(!on);<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">children</span>(&#123;<br>    on,<br>    toggle<br>  &#125;);<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br>&lt;<span class="hljs-title class_">Toggle</span>&gt;<br>  &#123;<span class="hljs-function">(<span class="hljs-params">&#123; on, toggle &#125;</span>) =&gt;</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;toggle&#125;</span>&gt;</span></span><br><span class="language-xml">        &#123;on ? &#x27;ON&#x27; : &#x27;OFF&#x27;&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      &#123;on &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">Modal</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;开启状态&quot;</span> /&gt;</span>&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  )&#125;<br>&lt;/<span class="hljs-title class_">Toggle</span>&gt;<br></code></pre></td></tr></table></figure>

<p><strong>高级 Render Props 模式</strong></p>
<p>(1) 组合多个 Render Props</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">CombinedProvider</span>(<span class="hljs-params">&#123; data, theme, children &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">DataProvider</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span>&gt;</span></span><br><span class="language-xml">      &#123;dataProps =&gt; (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">ThemeProvider</span> <span class="hljs-attr">theme</span>=<span class="hljs-string">&#123;theme&#125;</span>&gt;</span></span><br><span class="language-xml">          &#123;themeProps =&gt; children(&#123; ...dataProps, ...themeProps &#125;)&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeProvider</span>&gt;</span></span><br><span class="language-xml">      )&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">DataProvider</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br>&lt;<span class="hljs-title class_">CombinedProvider</span> data=&#123;apiData&#125; theme=<span class="hljs-string">&quot;dark&quot;</span>&gt;<br>  &#123;<span class="hljs-function">(<span class="hljs-params">&#123; data, loading, theme &#125;</span>) =&gt;</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>`<span class="hljs-attr">app</span> $&#123;<span class="hljs-attr">theme</span>&#125;`&#125;&gt;</span></span><br><span class="language-xml">      &#123;loading ? <span class="hljs-tag">&lt;<span class="hljs-name">Spinner</span> /&gt;</span> : <span class="hljs-tag">&lt;<span class="hljs-name">Content</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> /&gt;</span>&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  )&#125;<br>&lt;/<span class="hljs-title class_">CombinedProvider</span>&gt;<br></code></pre></td></tr></table></figure>

<p>(2) Render Props + Hooks</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useCounter</span>(<span class="hljs-params">initialCount = <span class="hljs-number">0</span></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(initialCount);<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">increment</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c + <span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">decrement</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c - <span class="hljs-number">1</span>);<br>  <br>  <span class="hljs-keyword">return</span> &#123; count, increment, decrement &#125;;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params">&#123; children &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> counter = <span class="hljs-title function_">useCounter</span>();<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">children</span>(counter);<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br>&lt;<span class="hljs-title class_">Counter</span>&gt;<br>  &#123;<span class="hljs-function">(<span class="hljs-params">&#123; count, increment, decrement &#125;</span>) =&gt;</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;decrement&#125;</span>&gt;</span>-<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;increment&#125;</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  )&#125;<br>&lt;/<span class="hljs-title class_">Counter</span>&gt;<br></code></pre></td></tr></table></figure>

<h3 id="HOC-与-Render-Props-对比"><a href="#HOC-与-Render-Props-对比" class="headerlink" title="HOC 与 Render Props 对比"></a>HOC 与 Render Props 对比</h3><p><strong>技术对比</strong></p>
<pre class="mermaid">graph LR
    A[HOC] --> B[属性代理]
    A --> C[反向继承]
    D[Render Props] --> E[函数作为子组件]
    D --> F[Render Prop]
    
    B --> G[注入Props]
    C --> H[操作组件]
    E --> I[直接组合]
    F --> I</pre>

<p><strong>详细对比分析</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">高阶组件 (HOC)</th>
<th align="left">Render Props</th>
</tr>
</thead>
<tbody><tr>
<td align="left">复用方式</td>
<td align="left">组件作为参数返回增强组件</td>
<td align="left">函数作为prop渲染内容</td>
</tr>
<tr>
<td align="left">组件关系</td>
<td align="left">包装关系</td>
<td align="left">包含关系</td>
</tr>
<tr>
<td align="left">调试难度</td>
<td align="left">较难（多层包装）</td>
<td align="left">较易（直接显示）</td>
</tr>
<tr>
<td align="left">静态类型</td>
<td align="left">类型推导复杂</td>
<td align="left">类型推导简单</td>
</tr>
<tr>
<td align="left">灵活性</td>
<td align="left">中等</td>
<td align="left">高</td>
</tr>
<tr>
<td align="left">性能影响</td>
<td align="left">可能引起额外渲染</td>
<td align="left">可能引起额外渲染</td>
</tr>
<tr>
<td align="left">学习曲线</td>
<td align="left">较陡峭</td>
<td align="left">较平缓</td>
</tr>
<tr>
<td align="left">适用场景</td>
<td align="left">横切关注点</td>
<td align="left">动态组合</td>
</tr>
</tbody></table>
<h3 id="企业级最佳实践-2"><a href="#企业级最佳实践-2" class="headerlink" title="企业级最佳实践"></a>企业级最佳实践</h3><p><strong>权限控制</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">withAuthorization</span>(<span class="hljs-params">requiredRoles</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">WrappedComponent</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">AuthorizedComponent</span> = props =&gt; &#123;<br>      <span class="hljs-keyword">const</span> &#123; user &#125; = <span class="hljs-title function_">useAuth</span>();<br>      <br>      <span class="hljs-keyword">if</span> (!user || !requiredRoles.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">role</span> =&gt;</span> user.<span class="hljs-property">roles</span>.<span class="hljs-title function_">includes</span>(role))) &#123;<br>        <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ForbiddenPage</span> /&gt;</span></span>;<br>      &#125;<br>      <br>      <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">WrappedComponent</span> &#123;<span class="hljs-attr">...props</span>&#125; /&gt;</span></span>;<br>    &#125;;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">AuthorizedComponent</span>;<br>  &#125;;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">AdminDashboard</span> = <span class="hljs-title function_">withAuthorization</span>([<span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;superadmin&#x27;</span>])(<span class="hljs-title class_">Dashboard</span>);<br></code></pre></td></tr></table></figure>

<h3 id="现代替代方案：自定义-Hooks"><a href="#现代替代方案：自定义-Hooks" class="headerlink" title="现代替代方案：自定义 Hooks"></a>现代替代方案：自定义 Hooks</h3><p><strong>重构 HOC 为 Hook</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 原 HOC</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">withWindowSize</span>(<span class="hljs-params">WrappedComponent</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">Component</span> &#123;<br>    state = &#123; <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> &#125;;<br>    <br>    handleResize = <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>        <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,<br>        <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br>      &#125;);<br>    &#125;;<br>    <br>    <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleResize</span>);<br>    &#125;<br>    <br>    <span class="hljs-title function_">componentWillUnmount</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleResize</span>);<br>    &#125;<br>    <br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">WrappedComponent</span> &#123;<span class="hljs-attr">...this.props</span>&#125; <span class="hljs-attr">windowSize</span>=<span class="hljs-string">&#123;this.state&#125;</span> /&gt;</span></span>;<br>    &#125;<br>  &#125;;<br>&#125;<br><br><span class="hljs-comment">// 自定义 Hook</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useWindowSize</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [size, setSize] = <span class="hljs-title function_">useState</span>(&#123;<br>    <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,<br>    <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br>  &#125;);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleResize</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>      <span class="hljs-title function_">setSize</span>(&#123;<br>        <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,<br>        <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span><br>      &#125;);<br>    &#125;;<br>    <br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, handleResize);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, handleResize);<br>  &#125;, []);<br>  <br>  <span class="hljs-keyword">return</span> size;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ResponsiveComponent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; width &#125; = <span class="hljs-title function_">useWindowSize</span>();<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>窗口宽度: &#123;width&#125;px<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>重构 Render Props 为 Hook</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 原 Render Prop 组件</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataFetcher</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  state = &#123; <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span> &#125;;<br>  <br>  <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">fetch</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">url</span>)<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; data, <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> &#125;))<br>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; error, <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> &#125;));<br>  &#125;<br>  <br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-title function_">children</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 自定义 Hook</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useDataFetcher</span>(<span class="hljs-params">url</span>) &#123;<br>  <span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>(&#123; <br>    <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>, <br>    <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span>, <br>    <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span> <br>  &#125;);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">setState</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> (&#123; ...prev, <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span> &#125;));<br>    <br>    <span class="hljs-title function_">fetch</span>(url)<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-title function_">setState</span>(&#123; data, <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span> &#125;))<br>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-title function_">setState</span>(&#123; <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>, error &#125;));<br>  &#125;, [url]);<br>  <br>  <span class="hljs-keyword">return</span> state;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params">&#123; userId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; data, loading &#125; = <span class="hljs-title function_">useDataFetcher</span>(<span class="hljs-string">`/api/users/<span class="hljs-subst">$&#123;userId&#125;</span>`</span>);<br>  <br>  <span class="hljs-keyword">if</span> (loading) <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Spinner</span> /&gt;</span></span>;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProfileCard</span> <span class="hljs-attr">user</span>=<span class="hljs-string">&#123;data&#125;</span> /&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="设计模式选择指南"><a href="#设计模式选择指南" class="headerlink" title="设计模式选择指南"></a>设计模式选择指南</h3><p><strong>模式选择决策</strong></p>
<pre class="mermaid">graph TD
    A[需要逻辑复用] --> B{需要访问组件内部?}
    B -->|是| C[Render Props]
    B -->|否| D{需要包装组件?}
    D -->|是| E[HOC]
    D -->|否| F[自定义 Hook]
    C --> G{功能简单?}
    G -->|是| H[Render Props]
    G -->|否| I[自定义 Hook]</pre>

<p><strong>场景化建议</strong></p>
<ul>
<li>跨组件共享逻辑：HOC（如 Redux connect）</li>
<li>动态组合UI：Render Props（如 Context.Consumer）</li>
<li>功能复用：自定义 Hooks（如 useForm）</li>
<li>类组件扩展：HOC（如 withRouter）</li>
<li>函数组件扩展：自定义 Hooks（如 useEffect）</li>
</ul>
<h3 id="面试高频问题解析-2"><a href="#面试高频问题解析-2" class="headerlink" title="面试高频问题解析"></a>面试高频问题解析</h3><p><strong>Q：HOC 和 Render Props 的主要区别是什么？</strong></p>
<ul>
<li>HOC：组件工厂模式，通过包装组件增强功能，可能引入多层嵌套</li>
<li>Render Props：回调模式，通过函数 prop 共享状态，更直接但可能嵌套回调</li>
<li>关键区别：HOC 创建新组件，Render Props 动态组合组件</li>
</ul>
<p><strong>Q：使用 HOC 时如何避免命名冲突？</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">withEnhancedProps</span>(<span class="hljs-params">WrappedComponent</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">Component</span> &#123;<br>    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-comment">// 使用命名空间避免冲突</span><br>      <span class="hljs-keyword">const</span> enhancedProps = &#123;<br>        <span class="hljs-attr">hoc</span>: &#123;<br>          <span class="hljs-attr">data</span>: <span class="hljs-string">&#x27;hoc data&#x27;</span>,<br>          <span class="hljs-attr">method</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;HOC method&#x27;</span>)<br>        &#125;,<br>        ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span><br>      &#125;;<br>      <br>      <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">WrappedComponent</span> &#123;<span class="hljs-attr">...enhancedProps</span>&#125; /&gt;</span></span>;<br>    &#125;<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Q：Render Props 会导致性能问题吗？如何优化？</strong></p>
<p>优化策略：</p>
<p>(1) 避免内联函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 不推荐：每次渲染创建新函数</span><br>&lt;<span class="hljs-title class_">DataProvider</span> render=&#123;<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> /&gt;</span></span>&#125; /&gt;<br><br><span class="hljs-comment">// 推荐：使用实例方法</span><br>renderData = <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> /&gt;</span></span>;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">DataProvider</span> <span class="hljs-attr">render</span>=<span class="hljs-string">&#123;this.renderData&#125;</span> /&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>(2) 使用 PureComponent&#x2F;memo</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizedProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.PureComponent</span> &#123;<br>  <span class="hljs-comment">// 仅当 props 变化时重新渲染</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>(3) 分离渲染职责</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">SplitProvider</span>(<span class="hljs-params">&#123; children &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">useData</span>();<br>  <span class="hljs-keyword">const</span> ui = <span class="hljs-title function_">useUI</span>();<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">DataContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;data&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">UIContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;ui&#125;</span>&gt;</span></span><br><span class="language-xml">        &#123;children&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">UIContext.Provider</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">DataContext.Provider</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Q：何时应该选择自定义 Hooks 替代 HOC 或 Render Props？</strong></p>
<ul>
<li>选择自定义 Hooks 当：<ul>
<li>复用逻辑不依赖 React 生命周期</li>
<li>需要在多个组件中使用相同逻辑</li>
<li>项目主要使用函数组件</li>
<li>希望减少组件嵌套层级</li>
</ul>
</li>
<li>保留 HOC&#x2F;Render Props 当：<ul>
<li>维护类组件代码库</li>
<li>需要操作组件实例（如 refs）</li>
<li>需要访问组件的生命周期方法</li>
<li>需要包装组件（如添加错误边界）</li>
</ul>
</li>
</ul>
<h3 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h3><ul>
<li>高阶组件 (HOC)：<ul>
<li>本质：组件工厂函数（输入组件 → 输出增强组件）</li>
<li>模式：属性代理、反向继承</li>
<li>适用：横切关注点、类组件扩展</li>
<li>注意：ref 传递、命名冲突、静态方法</li>
</ul>
</li>
<li>Render Props：<ul>
<li>本质：通过函数 prop 共享状态</li>
<li>模式：render prop 或 children as function</li>
<li>适用：动态组合、复杂状态共享</li>
<li>注意：回调嵌套、性能优化</li>
</ul>
</li>
<li>现代演进：<ul>
<li>自定义 Hooks 成为函数组件首选</li>
<li>HOC 和 Render Props 仍适合特定场景</li>
<li>三种模式可混合使用</li>
</ul>
</li>
<li>设计原则：<ul>
<li>单一职责原则</li>
<li>开闭原则（对扩展开放，对修改关闭）</li>
<li>组合优于继承</li>
</ul>
</li>
<li>企业实践：<ul>
<li>复杂状态管理</li>
<li>权限控制</li>
<li>性能优化</li>
<li>类型安全（TypeScript）</li>
</ul>
</li>
<li>面试重点：<ul>
<li>HOC 与 Render Props 区别</li>
<li>命名冲突解决方案</li>
<li>性能优化策略</li>
<li>模式选择决策</li>
</ul>
</li>
</ul>
<h1 id="第五章：React-状态管理"><a href="#第五章：React-状态管理" class="headerlink" title="第五章：React 状态管理"></a>第五章：React 状态管理</h1><h2 id="5-1-状态提升与单向数据流"><a href="#5-1-状态提升与单向数据流" class="headerlink" title="5.1 状态提升与单向数据流"></a>5.1 状态提升与单向数据流</h2><h3 id="核心概念全景图"><a href="#核心概念全景图" class="headerlink" title="核心概念全景图"></a>核心概念全景图</h3><pre class="mermaid">graph TD
  A[状态管理方案] --> B[组件内部状态]
  A --> C[状态提升]
  A --> D[全局状态管理]
  C --> E[父子组件通信]
  C --> F[兄弟组件通信]</pre>

<h3 id="状态提升（Lifting-State-Up）深度解析"><a href="#状态提升（Lifting-State-Up）深度解析" class="headerlink" title="状态提升（Lifting State Up）深度解析"></a>状态提升（Lifting State Up）深度解析</h3><p><strong>基本定义</strong><br>将多个组件需要共享的状态提升到它们最近的公共父组件中管理，通过 props 向下传递数据，通过回调函数向上传递状态变更</p>
<p><strong>解决什么问题</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 问题场景：两个独立组件需要同步状态</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">TemperatureInputA</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [temp, setTemp] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// 独立状态</span><br>  <span class="hljs-comment">// ...</span><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">TemperatureInputB</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [temp, setTemp] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// 独立状态</span><br>  <span class="hljs-comment">// ...</span><br>&#125;<br><br><span class="hljs-comment">// 无法保持两个输入框温度值同步</span><br></code></pre></td></tr></table></figure>

<p><strong>解决方案</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// 1. 状态提升到公共父组件</span><br>  <span class="hljs-keyword">const</span> [temperature, setTemperature] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <br>  <span class="hljs-comment">// 2. 通过props传递状态</span><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">TemperatureInput</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;temperature&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;setTemperature&#125;</span> // <span class="hljs-attr">3.</span> <span class="hljs-attr">传递回调函数</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">TemperatureDisplay</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;temperature&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 子组件成为受控组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">TemperatureInput</span>(<span class="hljs-params">&#123; value, onChange &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> </span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;number&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;value&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;(e)</span> =&gt;</span> onChange(Number(e.target.value))&#125;</span><br><span class="language-xml">    /&gt;</span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="单向数据流（Unidirectional-Data-Flow）"><a href="#单向数据流（Unidirectional-Data-Flow）" class="headerlink" title="单向数据流（Unidirectional Data Flow）"></a>单向数据流（Unidirectional Data Flow）</h3><p><strong>核心原则</strong></p>
<pre class="mermaid">graph LR
  A[State] --> B[UI]
  B --> C[Actions]
  C --> D[State Changes]
  D --> A</pre>

<p><strong>React 中的实现</strong></p>
<pre class="mermaid">graph TD
  P[父组件State] -->|Props| C1[子组件A]
  P -->|Props| C2[子组件B]
  C1 -->|回调函数| P
  C2 -->|回调函数| P</pre>

<p><strong>与双向绑定的对比</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">单向数据流</th>
<th align="left">双向绑定</th>
</tr>
</thead>
<tbody><tr>
<td align="left">数据方向</td>
<td align="left">父→子</td>
<td align="left">父⇄子</td>
</tr>
<tr>
<td align="left">状态管理</td>
<td align="left">集中管理</td>
<td align="left">分散管理</td>
</tr>
<tr>
<td align="left">数据可预测性</td>
<td align="left">高</td>
<td align="left">低</td>
</tr>
<tr>
<td align="left">调试难度</td>
<td align="left">相对容易</td>
<td align="left">相对复杂</td>
</tr>
<tr>
<td align="left">典型框架</td>
<td align="left">React</td>
<td align="left">Vue&#x2F;Angular</td>
</tr>
</tbody></table>
<h3 id="状态提升的局限性"><a href="#状态提升的局限性" class="headerlink" title="状态提升的局限性"></a>状态提升的局限性</h3><ul>
<li>组件树层级过深时（超过3层）</li>
<li>非直系组件需要通信（如堂兄弟组件）</li>
<li>跨路由组件状态共享</li>
</ul>
<h3 id="现代状态管理方案基础"><a href="#现代状态管理方案基础" class="headerlink" title="现代状态管理方案基础"></a>现代状态管理方案基础</h3><p><strong>Flux 架构思想</strong></p>
<pre class="mermaid">graph LR
  A[Action] --> B[Dispatcher]
  B --> C[Store]
  C --> D[View]
  D --> A</pre>

<p><strong>状态提升 vs Redux</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">状态提升</th>
<th align="left">Redux</th>
</tr>
</thead>
<tbody><tr>
<td align="left">状态存储</td>
<td align="left">组件 state</td>
<td align="left">独立 store</td>
</tr>
<tr>
<td align="left">状态更新</td>
<td align="left">setState</td>
<td align="left">dispatch(action)</td>
</tr>
<tr>
<td align="left">更新逻辑</td>
<td align="left">在组件内</td>
<td align="left">reducer 纯函数</td>
</tr>
<tr>
<td align="left">状态共享范围</td>
<td align="left">父组件及子组件</td>
<td align="left">全局可访问</td>
</tr>
<tr>
<td align="left">中间件支持</td>
<td align="left">无</td>
<td align="left">支持异步操作</td>
</tr>
</tbody></table>
<h3 id="最佳实践总结-1"><a href="#最佳实践总结-1" class="headerlink" title="最佳实践总结"></a>最佳实践总结</h3><ol>
<li>最小状态原则：只提升必要共享的状态</li>
<li>保持状态局部：非共享状态保持在组件内部</li>
<li>避免过度提升：超过3层传递考虑 Context</li>
<li>数据不可变：状态更新时创建新对象</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 错误</span><br>formData.<span class="hljs-property">items</span>.<span class="hljs-title function_">push</span>(newItem);<br><span class="hljs-title function_">setFormData</span>(formData);<br><br><span class="hljs-comment">// ✅ 正确</span><br><span class="hljs-title function_">setFormData</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> (&#123;<br>  ...prev,<br>  <span class="hljs-attr">items</span>: [...prev.<span class="hljs-property">items</span>, newItem]<br>&#125;));<br></code></pre></td></tr></table></figure>

<ol start="5">
<li>回调函数命名：统一使用 on{Event} 格式</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">&lt;<span class="hljs-title class_">Button</span> onSave=&#123;handleSave&#125; /&gt;<br></code></pre></td></tr></table></figure>

<h2 id="5-2-Redux-核心概念（Store、Action、Reducer）"><a href="#5-2-Redux-核心概念（Store、Action、Reducer）" class="headerlink" title="5.2 Redux 核心概念（Store、Action、Reducer）"></a>5.2 Redux 核心概念（Store、Action、Reducer）</h2><h3 id="Redux-三大核心概念全景图"><a href="#Redux-三大核心概念全景图" class="headerlink" title="Redux 三大核心概念全景图"></a>Redux 三大核心概念全景图</h3><pre class="mermaid">graph LR
  A[Action] -->|描述事件| B[Reducer]
  B -->|处理事件| C[Store]
  C -->|提供状态| D[View]
  D -->|触发| A</pre>

<h3 id="Action：状态变化的描述"><a href="#Action：状态变化的描述" class="headerlink" title="Action：状态变化的描述"></a>Action：状态变化的描述</h3><p><strong>本质与结构</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 基本结构</span><br><span class="hljs-keyword">const</span> action = &#123;<br>  <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;ADD_TODO&#x27;</span>,      <span class="hljs-comment">// 必需：动作类型</span><br>  <span class="hljs-attr">payload</span>: <span class="hljs-string">&#x27;Learn Redux&#x27;</span> <span class="hljs-comment">// 可选：携带数据</span><br>&#125;<br><br><span class="hljs-comment">// Flux Standard Action (FSA) 规范</span><br>&#123;<br>  <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;FETCH_USER_SUCCESS&#x27;</span>,<br>  <span class="hljs-attr">payload</span>: &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;John&#x27;</span> &#125;, <span class="hljs-comment">// 成功数据</span><br>  <span class="hljs-attr">error</span>: <span class="hljs-literal">false</span>,                     <span class="hljs-comment">// 是否错误</span><br>  <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() &#125;    <span class="hljs-comment">// 元信息</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Action 创建函数（Action Creators）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 同步 Action</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">addTodo</span>(<span class="hljs-params">text</span>) &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;ADD_TODO&#x27;</span>,<br>    <span class="hljs-attr">payload</span>: text<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 异步 Action (需中间件支持)</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUser</span>(<span class="hljs-params">id</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> dispatch =&gt; &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;FETCH_USER_REQUEST&#x27;</span> &#125;);<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">getUser</span>(id);<br>      <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;FETCH_USER_SUCCESS&#x27;</span>, <span class="hljs-attr">payload</span>: user &#125;);<br>    &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>      <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;FETCH_USER_FAILURE&#x27;</span>, error &#125;);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="Reducer：状态转换的纯函数"><a href="#Reducer：状态转换的纯函数" class="headerlink" title="Reducer：状态转换的纯函数"></a>Reducer：状态转换的纯函数</h3><p><strong>核心特征</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">todosReducer</span>(<span class="hljs-params">state = [], action</span>) &#123;<br>  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;ADD_TODO&#x27;</span>:<br>      <span class="hljs-comment">// ✅ 正确：返回新对象</span><br>      <span class="hljs-keyword">return</span> [...state, &#123; <span class="hljs-attr">text</span>: action.<span class="hljs-property">payload</span>, <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span> &#125;];<br>    <br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;TOGGLE_TODO&#x27;</span>:<br>      <span class="hljs-comment">// ✅ 正确：使用map创建新数组</span><br>      <span class="hljs-keyword">return</span> state.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">todo, index</span>) =&gt;</span> <br>        index === action.<span class="hljs-property">index</span> <br>          ? &#123; ...todo, <span class="hljs-attr">completed</span>: !todo.<span class="hljs-property">completed</span> &#125;<br>          : todo<br>      );<br>      <br>    <span class="hljs-attr">default</span>:<br>      <span class="hljs-comment">// ⚠️ 必须：返回当前state</span><br>      <span class="hljs-keyword">return</span> state;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>不可变更新模式</strong></p>
<table>
<thead>
<tr>
<th align="left">操作</th>
<th align="left">错误方式</th>
<th align="left">正确方式</th>
</tr>
</thead>
<tbody><tr>
<td align="left">添加项</td>
<td align="left">state.push(item)</td>
<td align="left">[…state, item]</td>
</tr>
<tr>
<td align="left">删除项</td>
<td align="left">state.splice(index, 1)</td>
<td align="left">state.filter((_, i) &#x3D;&gt; i !&#x3D;&#x3D; index)</td>
</tr>
<tr>
<td align="left">更新对象属性</td>
<td align="left">state[prop] &#x3D; value</td>
<td align="left">{ …state, [prop]: value }</td>
</tr>
<tr>
<td align="left">嵌套对象更新</td>
<td align="left">state.a.b &#x3D; value</td>
<td align="left">{ …state, a: { …state.a, b: value } }</td>
</tr>
</tbody></table>
<p><strong>Reducer 拆分与组合</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 根Reducer</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">rootReducer</span>(<span class="hljs-params">state = &#123;&#125;, action</span>) &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">todos</span>: <span class="hljs-title function_">todosReducer</span>(state.<span class="hljs-property">todos</span>, action),<br>    <span class="hljs-attr">visibilityFilter</span>: <span class="hljs-title function_">filterReducer</span>(state.<span class="hljs-property">visibilityFilter</span>, action)<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用 combineReducers 简化</span><br><span class="hljs-keyword">import</span> &#123; combineReducers &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux&#x27;</span>;<br><span class="hljs-keyword">const</span> rootReducer = <span class="hljs-title function_">combineReducers</span>(&#123;<br>  <span class="hljs-attr">todos</span>: todosReducer,<br>  <span class="hljs-attr">visibilityFilter</span>: filterReducer<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="Store：应用状态的容器"><a href="#Store：应用状态的容器" class="headerlink" title="Store：应用状态的容器"></a>Store：应用状态的容器</h3><p><strong>核心职责</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; createStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux&#x27;</span>;<br><br><span class="hljs-comment">// 创建Store</span><br><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>(rootReducer, initialState);<br><br><span class="hljs-comment">// 主要API</span><br>store.<span class="hljs-title function_">dispatch</span>(action);  <span class="hljs-comment">// 触发状态更新</span><br>store.<span class="hljs-title function_">getState</span>();        <span class="hljs-comment">// 获取当前状态</span><br>store.<span class="hljs-title function_">subscribe</span>(listener); <span class="hljs-comment">// 监听状态变化</span><br><br><span class="hljs-comment">// 使用示例</span><br>store.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;新状态:&#x27;</span>, store.<span class="hljs-title function_">getState</span>());<br>&#125;);<br><br>store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">addTodo</span>(<span class="hljs-string">&#x27;Learn Redux&#x27;</span>));<br></code></pre></td></tr></table></figure>

<p><strong>Store 工作流程</strong></p>
<pre class="mermaid">sequenceDiagram
  participant View as 视图
  participant Store as Store
  participant Reducer as Reducer
  
  View->>Store: dispatch(action)
  Store->>Reducer: 当前state + action
  Reducer->>Reducer: 计算新state
  Reducer->>Store: 返回新state
  Store->>View: 通知订阅者更新</pre>

<h3 id="Redux-三大原则"><a href="#Redux-三大原则" class="headerlink" title="Redux 三大原则"></a>Redux 三大原则</h3><p>(1) 单一数据源 (Single Source of Truth)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 整个应用只有一个Store</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(store.<span class="hljs-title function_">getState</span>());<br><span class="hljs-comment">/* 输出：</span><br><span class="hljs-comment">&#123;</span><br><span class="hljs-comment">  todos: [],</span><br><span class="hljs-comment">  visibilityFilter: &#x27;SHOW_ALL&#x27;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure>

<p>(2) 状态只读 (State is Read-Only)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 禁止直接修改</span><br>store.<span class="hljs-title function_">getState</span>().<span class="hljs-property">todos</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;Illegal mutation!&#x27;</span>);<br><br><span class="hljs-comment">// ✅ 唯一修改方式：dispatch(action)</span><br>store.<span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;ADD_TODO&#x27;</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;Legal update&#x27;</span> &#125;);<br></code></pre></td></tr></table></figure>

<p>(3) 纯函数修改 (Changes with Pure Functions)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// Reducer必须是纯函数</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">impureReducer</span>(<span class="hljs-params">state = <span class="hljs-number">0</span>, action</span>) &#123;<br>  <span class="hljs-comment">// ❌ 错误：包含副作用</span><br>  <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;state&#x27;</span>, state); <br>  <br>  <span class="hljs-comment">// ❌ 错误：不纯（依赖外部变量）</span><br>  <span class="hljs-keyword">return</span> state + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>(); <br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="Redux-数据流完整周期"><a href="#Redux-数据流完整周期" class="headerlink" title="Redux 数据流完整周期"></a>Redux 数据流完整周期</h3><pre class="mermaid">sequenceDiagram
  participant View as 视图
  participant Action as Action
  participant Middleware as 中间件
  participant Store as Store
  participant Reducer as Reducer
  
  View->>Action: 用户交互触发
  Action->>Middleware: 处理异步/副作用
  Middleware->>Store: dispatch(action)
  Store->>Reducer: (currentState, action)
  Reducer->>Store: 返回newState
  Store->>View: 通知订阅者
  View->>View: 使用新状态重渲染</pre>

<h3 id="高频面试题与破解方案-12"><a href="#高频面试题与破解方案-12" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么Redux要求Reducer是纯函数？</strong></p>
<ol>
<li>可预测性：相同输入必定得到相同输出</li>
<li>时间旅行：支持状态快照和回滚</li>
<li>易于测试：无需模拟环境，直接测试输入输出</li>
<li>性能优化：可安全进行浅比较</li>
</ol>
<p><strong>Q：Redux如何实现时间旅行调试？</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 核心原理</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createStore</span>(<span class="hljs-params">reducer</span>) &#123;<br>  <span class="hljs-keyword">let</span> state = initialState;<br>  <span class="hljs-keyword">const</span> listeners = [];<br>  <span class="hljs-keyword">const</span> history = []; <span class="hljs-comment">// ⭐ 历史状态记录</span><br>  <br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">dispatch</span>: <span class="hljs-function">(<span class="hljs-params">action</span>) =&gt;</span> &#123;<br>      history.<span class="hljs-title function_">push</span>(state); <span class="hljs-comment">// 保存当前状态</span><br>      state = <span class="hljs-title function_">reducer</span>(state, action); <span class="hljs-comment">// 计算新状态</span><br>      listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> <span class="hljs-title function_">listener</span>());<br>    &#125;,<br>    <span class="hljs-attr">getState</span>: <span class="hljs-function">() =&gt;</span> state,<br>    <span class="hljs-attr">undo</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (history.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) &#123;<br>        state = history.<span class="hljs-title function_">pop</span>(); <span class="hljs-comment">// 恢复历史状态</span><br>        listeners.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> <span class="hljs-title function_">listener</span>());<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 实际使用redux-undo库</span><br><span class="hljs-keyword">import</span> undoable <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux-undo&#x27;</span>;<br><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>(<span class="hljs-title function_">undoable</span>(rootReducer));<br></code></pre></td></tr></table></figure>

<p><strong>Q：Redux与Flux架构有何区别？</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">Redux</th>
<th align="left">Flux</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Store数量</td>
<td align="left">单一Store</td>
<td align="left">多个Store</td>
</tr>
<tr>
<td align="left">Dispatcher</td>
<td align="left">无独立Dispatcher</td>
<td align="left">有中央Dispatcher</td>
</tr>
<tr>
<td align="left">状态更新</td>
<td align="left">纯函数Reducer</td>
<td align="left">Store内方法更新</td>
</tr>
<tr>
<td align="left">样板代码</td>
<td align="left">相对较少</td>
<td align="left">相对较多</td>
</tr>
<tr>
<td align="left">时间旅行</td>
<td align="left">原生支持</td>
<td align="left">需要额外实现</td>
</tr>
</tbody></table>
<h3 id="Redux-在函数组件中的使用"><a href="#Redux-在函数组件中的使用" class="headerlink" title="Redux 在函数组件中的使用"></a>Redux 在函数组件中的使用</h3><p><strong>基础连接方式</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Provider</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>;<br><br><span class="hljs-comment">// 根组件包裹Provider</span><br><span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Provider</span> <span class="hljs-attr">store</span>=<span class="hljs-string">&#123;store&#125;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">Provider</span>&gt;</span></span>,<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>)<br>);<br><br><span class="hljs-comment">// 子组件连接</span><br><span class="hljs-keyword">import</span> &#123; connect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params">&#123; todos, dispatch &#125;</span>) &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">connect</span>(<br>  <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> (&#123; <span class="hljs-attr">todos</span>: state.<span class="hljs-property">todos</span> &#125;), <span class="hljs-comment">// mapStateToProps</span><br>  <span class="hljs-function"><span class="hljs-params">dispatch</span> =&gt;</span> (&#123; dispatch &#125;)         <span class="hljs-comment">// mapDispatchToProps</span><br>)(<span class="hljs-title class_">TodoList</span>);<br></code></pre></td></tr></table></figure>

<p><strong>Hooks API（推荐）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; useSelector, useDispatch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// 获取状态</span><br>  <span class="hljs-keyword">const</span> todos = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">todos</span>);<br>  <br>  <span class="hljs-comment">// 获取dispatch函数</span><br>  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useDispatch</span>();<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">addTodo</span> = text =&gt; <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;ADD_TODO&#x27;</span>, text &#125;);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">      &#123;todos.map(todo =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;todo.id&#125;</span>&gt;</span>&#123;todo.text&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>)&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="Redux-中间件机制"><a href="#Redux-中间件机制" class="headerlink" title="Redux 中间件机制"></a>Redux 中间件机制</h3><p><strong>中间件原理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 中间件签名</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">middleware</span> = store =&gt; <span class="hljs-function"><span class="hljs-params">next</span> =&gt;</span> <span class="hljs-function"><span class="hljs-params">action</span> =&gt;</span> &#123;<br>  <span class="hljs-comment">// 处理前逻辑</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;dispatching&#x27;</span>, action);<br>  <br>  <span class="hljs-comment">// 调用下一个中间件</span><br>  <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">next</span>(action);<br>  <br>  <span class="hljs-comment">// 处理后逻辑</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;next state&#x27;</span>, store.<span class="hljs-title function_">getState</span>());<br>  <span class="hljs-keyword">return</span> result;<br>&#125;;<br><br><span class="hljs-comment">// 创建支持中间件的store</span><br><span class="hljs-keyword">import</span> &#123; applyMiddleware, createStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux&#x27;</span>;<br><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>(<br>  rootReducer,<br>  <span class="hljs-title function_">applyMiddleware</span>(middleware1, middleware2)<br>);<br></code></pre></td></tr></table></figure>

<p><strong>常用中间件</strong></p>
<table>
<thead>
<tr>
<th align="left">中间件</th>
<th align="left">解决的核心问题</th>
<th align="left">典型使用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">redux-thunk</td>
<td align="left">异步Action处理</td>
<td align="left">简单API请求</td>
</tr>
<tr>
<td align="left">redux-saga</td>
<td align="left">复杂异步流程管理</td>
<td align="left">多步骤异步、竞态处理</td>
</tr>
<tr>
<td align="left">redux-observable</td>
<td align="left">响应式编程</td>
<td align="left">复杂事件流处理</td>
</tr>
<tr>
<td align="left">redux-logger</td>
<td align="left">状态变更日志</td>
<td align="left">开发环境调试</td>
</tr>
</tbody></table>
<h3 id="Redux-最佳实践"><a href="#Redux-最佳实践" class="headerlink" title="Redux 最佳实践"></a>Redux 最佳实践</h3><p><strong>项目结构组织</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">src/<br>  ├── store/           <span class="hljs-comment"># Redux相关</span><br>  │   ├── actions/     <span class="hljs-comment"># Action创建函数</span><br>  │   ├── reducers/    <span class="hljs-comment"># Reducer函数</span><br>  │   ├── sagas/       <span class="hljs-comment"># Saga中间件</span><br>  │   └── store.js     <span class="hljs-comment"># Store配置</span><br>  │<br>  ├── components/      <span class="hljs-comment"># 展示组件</span><br>  └── containers/      <span class="hljs-comment"># 容器组件</span><br></code></pre></td></tr></table></figure>

<p><strong>命名规范</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// Action类型：&lt;名词&gt;_&lt;动词&gt;</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">USER_FETCH_REQUESTED</span> = <span class="hljs-string">&#x27;USER_FETCH_REQUESTED&#x27;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TODOS_ADD</span> = <span class="hljs-string">&#x27;TODOS_ADD&#x27;</span>;<br><br><span class="hljs-comment">// Action创建函数：动词+名词</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUser</span>(<span class="hljs-params">id</span>) &#123; ... &#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">addTodo</span>(<span class="hljs-params">text</span>) &#123; ... &#125;<br></code></pre></td></tr></table></figure>

<p><strong>状态设计原则</strong></p>
<ol>
<li>扁平化结构：避免嵌套过深</li>
<li>按业务域拆分：不同功能独立状态分支</li>
<li>ID驱动：通过ID关联数据</li>
</ol>
<h3 id="总结：Redux-核心概念关系图"><a href="#总结：Redux-核心概念关系图" class="headerlink" title="总结：Redux 核心概念关系图"></a>总结：Redux 核心概念关系图</h3><pre class="mermaid">graph TD
  A[Action] -->|描述| B[Reducer]
  B -->|生成| C[Store]
  C -->|提供| D[View]
  D -->|触发| A
  E[Middleware] -->|拦截| A
  F[Selector] -->|获取| C
  G[React-Redux] -->|连接| D</pre>

<h2 id="5-3-Redux-中间件（redux-thunk、redux-saga）"><a href="#5-3-Redux-中间件（redux-thunk、redux-saga）" class="headerlink" title="5.3 Redux 中间件（redux-thunk、redux-saga）"></a>5.3 Redux 中间件（redux-thunk、redux-saga）</h2><h3 id="Redux-中间件核心原理"><a href="#Redux-中间件核心原理" class="headerlink" title="Redux 中间件核心原理"></a>Redux 中间件核心原理</h3><p><strong>中间件在数据流中的位置</strong></p>
<pre class="mermaid">graph LR
  A[View] -->|dispatch| B[Middleware]
  B -->|"next(action)"| C[Reducer]
  C --> D[Store]
  D -->|newState| A</pre>

<p><strong>中间件签名与执行链</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 中间件结构（柯里化函数）</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">middleware</span> = store =&gt; <span class="hljs-function"><span class="hljs-params">next</span> =&gt;</span> <span class="hljs-function"><span class="hljs-params">action</span> =&gt;</span> &#123;<br>  <span class="hljs-comment">// 前置处理</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;dispatching:&#x27;</span>, action);<br>  <br>  <span class="hljs-comment">// 传递 action 给下一个中间件或 reducer</span><br>  <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">next</span>(action);<br>  <br>  <span class="hljs-comment">// 后置处理</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;next state:&#x27;</span>, store.<span class="hljs-title function_">getState</span>());<br>  <span class="hljs-keyword">return</span> result;<br>&#125;;<br><br><span class="hljs-comment">// 中间件执行顺序</span><br><span class="hljs-title function_">applyMiddleware</span>(mid1, mid2, mid3)<br><span class="hljs-comment">// 实际调用顺序：</span><br><span class="hljs-comment">// mid1(store) -&gt; mid2(store) -&gt; mid3(store) -&gt; reducer</span><br></code></pre></td></tr></table></figure>

<h3 id="redux-thunk：处理简单异步"><a href="#redux-thunk：处理简单异步" class="headerlink" title="redux-thunk：处理简单异步"></a>redux-thunk：处理简单异步</h3><p><strong>核心概念</strong></p>
<p>允许 action 创建函数返回函数（而不仅是对象），该函数接收 dispatch 和 getState 作为参数</p>
<p><strong>使用示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 同步 action</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">increment</span> = (<span class="hljs-params"></span>) =&gt; (&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;INCREMENT&#x27;</span> &#125;);<br><br><span class="hljs-comment">// 异步 action (thunk)</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchUser</span> = (<span class="hljs-params">userId</span>) =&gt; <span class="hljs-title function_">async</span> (dispatch, getState) =&gt; &#123;<br>  <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;USER_REQUEST&#x27;</span> &#125;);<br>  <br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">getUser</span>(userId);<br>    <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;USER_SUCCESS&#x27;</span>, <span class="hljs-attr">payload</span>: user &#125;);<br>    <br>    <span class="hljs-comment">// 可访问当前状态</span><br>    <span class="hljs-keyword">const</span> &#123; settings &#125; = <span class="hljs-title function_">getState</span>();<br>    <span class="hljs-keyword">if</span> (settings.<span class="hljs-property">notify</span>) <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">&#x27;用户加载成功&#x27;</span>);<br>    <br>  &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;USER_FAILURE&#x27;</span>, error &#125;);<br>  &#125;<br>&#125;;<br><br><span class="hljs-comment">// 组件中触发</span><br><span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">fetchUser</span>(<span class="hljs-number">123</span>));<br></code></pre></td></tr></table></figure>

<p><strong>适用场景</strong></p>
<ul>
<li>API 请求</li>
<li>简单异步操作</li>
<li>需要访问当前状态的异步逻辑</li>
</ul>
<p><strong>优点与局限</strong></p>
<table>
<thead>
<tr>
<th align="left">优点</th>
<th align="left">局限</th>
</tr>
</thead>
<tbody><tr>
<td align="left">学习成本低</td>
<td align="left">复杂异步流程难管理</td>
</tr>
<tr>
<td align="left">代码简洁</td>
<td align="left">测试相对复杂</td>
</tr>
<tr>
<td align="left">无需额外库</td>
<td align="left">不支持高级异步模式</td>
</tr>
</tbody></table>
<h3 id="redux-saga：处理复杂异步"><a href="#redux-saga：处理复杂异步" class="headerlink" title="redux-saga：处理复杂异步"></a>redux-saga：处理复杂异步</h3><p><strong>核心概念</strong></p>
<pre class="mermaid">graph TD
  A[View] -->|dispatch| B[Action]
  B --> C[Watcher Saga]
  C --> D[Worker Saga]
  D --> E[API Call]
  E --> F[Action to Store]</pre>

<p><strong>关键特性</strong></p>
<ul>
<li>基于 ES6 Generator 函数</li>
<li>集中管理副作用（side effects）</li>
<li>提供丰富异步控制原语（takeEvery, takeLatest 等）</li>
<li>支持竞态条件处理、并行任务等复杂场景</li>
</ul>
<p><strong>使用示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; call, put, takeEvery &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux-saga/effects&#x27;</span>;<br><br><span class="hljs-comment">// Worker Saga</span><br><span class="hljs-keyword">function</span>* <span class="hljs-title function_">fetchUser</span>(<span class="hljs-params">action</span>) &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">yield</span> <span class="hljs-title function_">call</span>(api.<span class="hljs-property">getUser</span>, action.<span class="hljs-property">payload</span>);<br>    <span class="hljs-keyword">yield</span> <span class="hljs-title function_">put</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;USER_SUCCESS&#x27;</span>, <span class="hljs-attr">payload</span>: user &#125;);<br>  &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>    <span class="hljs-keyword">yield</span> <span class="hljs-title function_">put</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;USER_FAILURE&#x27;</span>, error &#125;);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// Watcher Saga</span><br><span class="hljs-keyword">function</span>* <span class="hljs-title function_">watchUserRequests</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">yield</span> <span class="hljs-title function_">takeEvery</span>(<span class="hljs-string">&#x27;USER_REQUEST&#x27;</span>, fetchUser);<br>&#125;<br><br><span class="hljs-comment">// 根Saga</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span>* <span class="hljs-title function_">rootSaga</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">yield</span> <span class="hljs-title function_">all</span>([<br>    <span class="hljs-title function_">watchUserRequests</span>(),<br>    <span class="hljs-comment">// 其他 watcher</span><br>  ]);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>常用 Effect 原语</strong></p>
<table>
<thead>
<tr>
<th align="left">Effect</th>
<th align="left">作用</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">call</td>
<td align="left">调用异步函数</td>
<td align="left">yield call(api.fetch, url)</td>
</tr>
<tr>
<td align="left">put</td>
<td align="left">发起 action</td>
<td align="left">yield put({ type: ‘SUCCESS’ })</td>
</tr>
<tr>
<td align="left">take</td>
<td align="left">等待指定 action</td>
<td align="left">yield take(‘ACTION’)</td>
</tr>
<tr>
<td align="left">takeEvery</td>
<td align="left">监听每个 action</td>
<td align="left">yield takeEvery(‘ACTION’, saga)</td>
</tr>
<tr>
<td align="left">takeLatest</td>
<td align="left">只响应最新的 action</td>
<td align="left">yield takeLatest(‘ACTION’, saga)</td>
</tr>
<tr>
<td align="left">fork</td>
<td align="left">非阻塞调用 saga</td>
<td align="left">yield fork(otherSaga)</td>
</tr>
<tr>
<td align="left">all</td>
<td align="left">并行运行多个 Effect</td>
<td align="left">yield all([call(a), call(b)])</td>
</tr>
<tr>
<td align="left">race</td>
<td align="left">竞态执行</td>
<td align="left">yield race({ task: call(fn), cancel: take(‘CANCEL’) })</td>
</tr>
</tbody></table>
<h3 id="高频面试题与破解方案-13"><a href="#高频面试题与破解方案-13" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么需要中间件处理异步？</strong></p>
<ol>
<li>Redux 自身限制：reducer 必须是纯函数，不能包含副作用</li>
<li>可预测性：集中管理副作用，避免分散在组件中</li>
<li>可维护性：统一处理错误、日志、重试等通用逻辑</li>
<li>高级功能：实现请求取消、竞态处理等复杂场景</li>
</ol>
<p><strong>Q：如何选择 thunk 还是 saga？</strong></p>
<pre class="mermaid">graph TD
  A[项目需求] --> B{异步复杂度}
  B -->|简单API请求| C[redux-thunk]
  B -->|复杂流程/竞态| D[redux-saga]
  A --> E{团队熟悉度}
  E -->|熟悉Generator| D
  E -->|新手团队| C
  A --> F{包大小敏感}
  F -->|是| C
  F -->|否| D</pre>

<h2 id="5-4-React-Redux（Provider、useSelector、useDispatch）"><a href="#5-4-React-Redux（Provider、useSelector、useDispatch）" class="headerlink" title="5.4 React-Redux（Provider、useSelector、useDispatch）"></a>5.4 React-Redux（Provider、useSelector、useDispatch）</h2><h3 id="React-Redux-核心架构图"><a href="#React-Redux-核心架构图" class="headerlink" title="React-Redux 核心架构图"></a>React-Redux 核心架构图</h3><pre class="mermaid">graph TD
  A[Redux Store] --> B[Provider]
  B -->|Context| C[React Components]
  C -->|useSelector| A
  C -->|useDispatch| A</pre>

<h3 id="Provider：状态注入的基石"><a href="#Provider：状态注入的基石" class="headerlink" title="Provider：状态注入的基石"></a>Provider：状态注入的基石</h3><p><strong>核心作用与原理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Provider</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>;<br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./store&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Provider</span> <span class="hljs-attr">store</span>=<span class="hljs-string">&#123;store&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MainApp</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Provider</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>作用：通过 React Context 将 Redux store 注入整个组件树</li>
<li>原理：使用 React.createContext() 创建 Store 上下文</li>
<li>位置：必须在组件树最顶层</li>
</ul>
<p><strong>实现原理揭秘</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 简化版 Provider 实现</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">StoreContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createContext</span>();<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Provider</span>(<span class="hljs-params">&#123; store, children &#125;</span>) &#123;<br>  <span class="hljs-comment">// 使用 useMemo 避免重复渲染</span><br>  <span class="hljs-keyword">const</span> contextValue = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> (&#123; store &#125;), [store]);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">StoreContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;contextValue&#125;</span>&gt;</span></span><br><span class="language-xml">      &#123;children&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">StoreContext.Provider</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="useSelector：精准状态选择"><a href="#useSelector：精准状态选择" class="headerlink" title="useSelector：精准状态选择"></a>useSelector：精准状态选择</h3><p><strong>基础用法</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; useSelector &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// 从 Redux store 选择所需状态</span><br>  <span class="hljs-keyword">const</span> user = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">user</span>);<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;user.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>性能优化机制</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 默认使用 === 严格相等比较</span><br><span class="hljs-keyword">const</span> user = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">user</span>);<br><br><span class="hljs-comment">// 自定义比较函数</span><br><span class="hljs-keyword">const</span> user = <span class="hljs-title function_">useSelector</span>(<br>  <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">user</span>,<br>  <span class="hljs-function">(<span class="hljs-params">prevUser, nextUser</span>) =&gt;</span> prevUser.<span class="hljs-property">id</span> === nextUser.<span class="hljs-property">id</span><br>);<br></code></pre></td></tr></table></figure>

<p><strong>高级选择器模式</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 使用 reselect 库创建记忆化选择器</span><br><span class="hljs-keyword">import</span> &#123; createSelector &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;reselect&#x27;</span>;<br><br><span class="hljs-keyword">const</span> selectActiveUsers = <span class="hljs-title function_">createSelector</span>(<br>  [<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">users</span>],<br>  <span class="hljs-function"><span class="hljs-params">users</span> =&gt;</span> users.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">isActive</span>)<br>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ActiveUsersList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> activeUsers = <span class="hljs-title function_">useSelector</span>(selectActiveUsers);<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="useDispatch：触发状态更新"><a href="#useDispatch：触发状态更新" class="headerlink" title="useDispatch：触发状态更新"></a>useDispatch：触发状态更新</h3><p><strong>基础用法</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; useDispatch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">AddTodoButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useDispatch</span>();<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;ADD_TODO&#x27;</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;New todo&#x27;</span> &#125;);<br>  &#125;;<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span>添加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>封装动作创建函数</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 动作创建函数</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">addTodo</span> = (<span class="hljs-params">text</span>) =&gt; (&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;ADD_TODO&#x27;</span>, text &#125;);<br><br><span class="hljs-comment">// 组件中使用</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">AddTodoButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useDispatch</span>();<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">addTodo</span>(<span class="hljs-string">&#x27;New todo&#x27;</span>)); <span class="hljs-comment">// 直接 dispatch action</span><br>  &#125;;<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span>添加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>异步操作集成</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 使用 redux-thunk</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchUser</span> = (<span class="hljs-params">id</span>) =&gt; <span class="hljs-keyword">async</span> dispatch =&gt; &#123;<br>  <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;USER_REQUEST&#x27;</span> &#125;);<br>  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">getUser</span>(id);<br>  <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;USER_SUCCESS&#x27;</span>, <span class="hljs-attr">payload</span>: user &#125;);<br>&#125;;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserLoader</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useDispatch</span>();<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">fetchUser</span>(<span class="hljs-number">123</span>));<br>  &#125;, [dispatch]);<br>  <br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="三大-Hook-协作模式"><a href="#三大-Hook-协作模式" class="headerlink" title="三大 Hook 协作模式"></a>三大 Hook 协作模式</h3><p>完整数据流示例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// 1. 获取状态</span><br>  <span class="hljs-keyword">const</span> todos = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">todos</span>);<br>  <br>  <span class="hljs-comment">// 2. 获取 dispatch 函数</span><br>  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useDispatch</span>();<br>  <br>  <span class="hljs-comment">// 3. 事件处理</span><br>  <span class="hljs-keyword">const</span> handleAdd = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">addTodo</span>(<span class="hljs-string">&#x27;新任务&#x27;</span>));<br>  &#125;, [dispatch]);<br>  <br>  <span class="hljs-keyword">const</span> handleToggle = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> &#123;<br>    <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">toggleTodo</span>(id));<br>  &#125;, [dispatch]);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleAdd&#125;</span>&gt;</span>添加任务<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">        &#123;todos.map(todo =&gt; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">TodoItem</span> </span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;todo.id&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">todo</span>=<span class="hljs-string">&#123;todo&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">onToggle</span>=<span class="hljs-string">&#123;handleToggle&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          /&gt;</span></span><br><span class="language-xml">        ))&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="connect-高阶组件（传统写法）"><a href="#connect-高阶组件（传统写法）" class="headerlink" title="connect 高阶组件（传统写法）"></a>connect 高阶组件（传统写法）</h3><p><strong>mapStateToProps</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">mapStateToProps</span> = (<span class="hljs-params">state, ownProps</span>) =&gt; (&#123;<br>  <span class="hljs-attr">todos</span>: state.<span class="hljs-property">todos</span>,<br>  <span class="hljs-attr">currentUser</span>: state.<span class="hljs-property">users</span>[ownProps.<span class="hljs-property">userId</span>]<br>&#125;);<br><br><span class="hljs-comment">// 组件中通过 props 访问</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params">&#123; todos, currentUser &#125;</span>) &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>mapDispatchToProps</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 对象简写（自动绑定 dispatch）</span><br><span class="hljs-keyword">const</span> mapDispatchToProps = &#123;<br>  addTodo,<br>  deleteTodo<br>&#125;;<br><br><span class="hljs-comment">// 函数形式</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">mapDispatchToProps</span> = (<span class="hljs-params">dispatch</span>) =&gt; (&#123;<br>  <span class="hljs-attr">addTodo</span>: <span class="hljs-function">(<span class="hljs-params">text</span>) =&gt;</span> <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">addTodo</span>(text)),<br>  <span class="hljs-attr">deleteTodo</span>: <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">deleteTodo</span>(id))<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>connect 使用</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; connect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ConnectedTodoList</span> = <span class="hljs-title function_">connect</span>(<br>  mapStateToProps,<br>  mapDispatchToProps<br>)(<span class="hljs-title class_">TodoList</span>);<br></code></pre></td></tr></table></figure>

<h3 id="高频面试题与破解方案-14"><a href="#高频面试题与破解方案-14" class="headerlink" title="高频面试题与破解方案"></a>高频面试题与破解方案</h3><p><strong>Q：为什么需要 React-Redux？</strong></p>
<ol>
<li>解耦组件：避免组件直接依赖 Redux store</li>
<li>性能优化：自动实现 shouldComponentUpdate 优化</li>
<li>上下文管理：通过 Provider 优雅注入 store</li>
<li>简化开发：提供 useSelector&#x2F;useDispatch 便捷 API</li>
<li>未来兼容：官方维护，保证与 React 新特性兼容</li>
</ol>
<p><strong>Q：useSelector 如何避免不必要重渲染？</strong></p>
<p>优化策略：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 策略1：返回原始值（非引用类型）</span><br><span class="hljs-keyword">const</span> count = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">counter</span>); <span class="hljs-comment">// number</span><br><br><span class="hljs-comment">// 策略2：使用浅比较</span><br><span class="hljs-keyword">const</span> user = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">user</span>, shallowEqual);<br><br><span class="hljs-comment">// 策略3：记忆化选择器</span><br><span class="hljs-keyword">const</span> selectUser = <span class="hljs-title function_">useCallback</span>(<br>  <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> (&#123; <span class="hljs-attr">name</span>: state.<span class="hljs-property">user</span>.<span class="hljs-property">name</span>, <span class="hljs-attr">id</span>: state.<span class="hljs-property">user</span>.<span class="hljs-property">id</span> &#125;), <br>  []<br>);<br><span class="hljs-keyword">const</span> userInfo = <span class="hljs-title function_">useSelector</span>(selectUser);<br></code></pre></td></tr></table></figure>

<p><strong>Q：如何在类组件中使用 Hooks？</strong></p>
<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 创建连接组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">withReduxHooks</span>(<span class="hljs-params">WrappedComponent</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">data</span>);<br>    <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useDispatch</span>();<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">WrappedComponent</span> &#123;<span class="hljs-attr">...props</span>&#125; <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> <span class="hljs-attr">dispatch</span>=<span class="hljs-string">&#123;dispatch&#125;</span> /&gt;</span></span>;<br>  &#125;;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LegacyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  <span class="hljs-comment">// 通过 props 访问 data 和 dispatch</span><br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">withReduxHooks</span>(<span class="hljs-title class_">LegacyComponent</span>);<br></code></pre></td></tr></table></figure>

<h3 id="总结：React-Redux-核心知识点"><a href="#总结：React-Redux-核心知识点" class="headerlink" title="总结：React-Redux 核心知识点"></a>总结：React-Redux 核心知识点</h3><table>
<thead>
<tr>
<th align="left">概念</th>
<th align="left">作用</th>
<th align="left">最佳实践</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Provider</td>
<td align="left">注入 Redux store 到组件树</td>
<td align="left">包裹整个应用根组件</td>
</tr>
<tr>
<td align="left">useSelector</td>
<td align="left">从 store 选择状态</td>
<td align="left">返回原始值 + 精细选择</td>
</tr>
<tr>
<td align="left">useDispatch</td>
<td align="left">获取 dispatch 方法</td>
<td align="left">封装动作创建函数</td>
</tr>
<tr>
<td align="left">connect</td>
<td align="left">类组件连接方案（传统）</td>
<td align="left">使用 mapState&#x2F;mapDispatch</td>
</tr>
<tr>
<td align="left">记忆化选择器</td>
<td align="left">优化性能</td>
<td align="left">使用 reselect 或 useMemo</td>
</tr>
<tr>
<td align="left">Redux Toolkit</td>
<td align="left">现代 Redux 开发标准</td>
<td align="left">使用 createSlice + configureStore</td>
</tr>
</tbody></table>
<h2 id="5-5-现代状态管理方案（Recoil、Zustand、Jotai）"><a href="#5-5-现代状态管理方案（Recoil、Zustand、Jotai）" class="headerlink" title="5.5 现代状态管理方案（Recoil、Zustand、Jotai）"></a>5.5 现代状态管理方案（Recoil、Zustand、Jotai）</h2><h3 id="基础知识概述-简要"><a href="#基础知识概述-简要" class="headerlink" title="基础知识概述 (简要)"></a>基础知识概述 (简要)</h3><p>目标： 解决 React 应用中跨组件状态共享和复杂状态逻辑的管理问题，特别是当 Context + useState&#x2F;useReducer 在性能或开发体验上显得不足时。</p>
<p>核心诉求：</p>
<ul>
<li>简化 API： 减少模板代码（boilerplate），提升开发效率。</li>
<li>高性能更新： 精确控制组件更新范围，避免不必要的渲染。</li>
<li>更好的 TypeScript 支持： 提供出色的类型推断。</li>
<li>更自然的 React 集成： 拥抱 Hooks 和 React 的并发特性。</li>
<li>更小的包体积： 减小应用体积。</li>
</ul>
<p>与 Redux 的主要区别：</p>
<ul>
<li>通常不需要显式定义 action types, action creators, reducers。</li>
<li>状态存储和更新逻辑更分散或原子化。</li>
<li>API 设计更贴近 React Hooks，学习曲线相对平缓。</li>
</ul>
<h3 id="Recoil-Meta-官方出品"><a href="#Recoil-Meta-官方出品" class="headerlink" title="Recoil (Meta 官方出品)"></a>Recoil (Meta 官方出品)</h3><p><strong>核心概念： 原子 (Atoms) 和 选择器 (Selectors)</strong></p>
<ul>
<li>Atom: 状态的最小单位。一个原子代表一份独立的状态（可以是任何类型）。组件通过 useRecoilState, useRecoilValue, useSetRecoilState 订阅或更新它。原子变化只触发订阅它的组件重渲染。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; atom &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;recoil&#x27;</span>;<br><span class="hljs-keyword">const</span> countState = <span class="hljs-title function_">atom</span>(&#123;<br>  <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;countState&#x27;</span>, <span class="hljs-comment">// 必须全局唯一</span><br>  <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 初始值</span><br>&#125;);<br></code></pre></td></tr></table></figure>

<ul>
<li>Selector: 派生状态。基于一个或多个 Atom 或其他 Selector 的值通过纯函数计算得出。组件同样使用 Hook 订阅。依赖的 Atom&#x2F;Selector 变化时自动重新计算，并触发订阅组件更新。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; selector &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;recoil&#x27;</span>;<br><span class="hljs-keyword">const</span> doubledCountState = <span class="hljs-title function_">selector</span>(&#123;<br>  <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;doubledCountState&#x27;</span>,<br>  <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">&#123; get &#125;</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">get</span>(countState);<br>    <span class="hljs-keyword">return</span> count * <span class="hljs-number">2</span>;<br>  &#125;,<br>  <span class="hljs-comment">// 可选：定义如何设置（会反向更新依赖的 Atom）</span><br>  <span class="hljs-attr">set</span>: <span class="hljs-function">(<span class="hljs-params">&#123; set &#125;, newValue</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">set</span>(countState, newValue / <span class="hljs-number">2</span>);<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>Hooks API:</strong></p>
<ul>
<li>useRecoilState(atom&#x2F;selector)： 类似于 useState，返回 [state, setter]。</li>
<li>useRecoilValue(atom&#x2F;selector)： 只读取状态值。</li>
<li>useSetRecoilState(atom&#x2F;selector)： 只获取设置状态的函数。</li>
<li>useRecoilCallback()： 用于在回调中异步读取&#x2F;更新状态，避免闭包问题。</li>
</ul>
<p><strong>关键特性</strong></p>
<ul>
<li>细粒度响应： 组件只订阅它真正需要的具体 Atom&#x2F;Selector，状态变化时只有依赖这些状态的组件才会更新。这是解决 Redux 中 connect 或 useSelector 可能导致的“大范围更新”问题的关键。</li>
<li>Hooks-First API： 完全使用 React Hooks 的方式读取和修改状态，与函数组件无缝集成。</li>
<li>异步支持： Selector 可以方便地处理异步数据获取和派生状态（如 useRecoilValueLoadable）。</li>
<li>状态快照与时间旅行： 内置支持状态快照，便于调试（如 <RecoilRoot> 的 initializeState 和快照 API）。</li>
</ul>
<p><strong>优点</strong></p>
<ul>
<li>概念相对清晰（Atom&#x2F;Selector）。</li>
<li>细粒度更新性能优秀。</li>
<li>官方背景，社区和文档较好。</li>
<li>内置异步支持良好。</li>
</ul>
<p><strong>缺点&#x2F;考量</strong></p>
<ul>
<li>API 相对复杂： 理解 Atom、Selector 及其各种 Hook（useRecoilCallback, useRecoilValueLoadable, useRecoilTransaction_UNSTABLE 等）需要一定学习成本。</li>
<li>仍在实验阶段 (Experimental)： 虽然 Meta 内部广泛使用，但官方文档仍标记为 Experimental，API 稳定性有一定风险（尽管重大变更已较少）。</li>
<li>Bundle Size： 相对其他轻量方案稍大。</li>
</ul>
<p><strong>面试要点</strong></p>
<ul>
<li>解释 Atom 和 Selector 的区别和联系。</li>
<li>如何用 Selector 处理异步数据？</li>
<li>Recoil 如何实现细粒度更新？（依赖图追踪）</li>
<li>对比 Recoil 与 Context + useState&#x2F;useReducer 在性能上的差异（Context 更新会触发所有消费组件更新，Recoil 只更新依赖特定 Atom&#x2F;Selector 的组件）。</li>
<li>了解 atomFamily &#x2F; selectorFamily 的作用（参数化状态）。</li>
</ul>
<h3 id="Zustand"><a href="#Zustand" class="headerlink" title="Zustand"></a>Zustand</h3><p><strong>核心思想</strong>：创建一个单一的、不可变的 Store。Store 包含状态和修改状态的方法（Action）。API 极其简洁。</p>
<p><strong>核心 API（create）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> create <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;zustand&#x27;</span>;<br><span class="hljs-comment">// 类型提示 (TypeScript): import &#123; create &#125; from &#x27;zustand&#x27;</span><br><span class="hljs-keyword">const</span> useStore = <span class="hljs-title function_">create</span>(<span class="hljs-function">(<span class="hljs-params">set, get</span>) =&gt;</span> (&#123;<br>  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> (&#123; <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> &#125;)),<br>  <span class="hljs-attr">decrement</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> (&#123; <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span> &#125;)),<br>  <span class="hljs-attr">reset</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(&#123; <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> &#125;),<br>  <span class="hljs-comment">// 访问当前状态 (非更新时): get().count</span><br>  <span class="hljs-comment">// 异步 Action 示例</span><br>  <span class="hljs-keyword">async</span> <span class="hljs-attr">fetchData</span>: <span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api/data&#x27;</span>);<br>    <span class="hljs-title function_">set</span>(&#123; <span class="hljs-attr">data</span>: <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>() &#125;); <span class="hljs-comment">// 更新状态</span><br>  &#125;<br>&#125;));<br></code></pre></td></tr></table></figure>

<p><strong>Hooks API</strong></p>
<ul>
<li>useStore()： 默认会订阅整个 Store 的变化（不推荐，可能导致过多渲染）。</li>
<li>useStore(selector)： 推荐用法。通过一个选择器函数从 Store 中选取需要的部分状态或 Action。组件只在选择器返回的部分发生变化时才会重新渲染。Zustand 会对选择器结果进行严格的浅比较 (Object.is)。使用选择器函数是性能优化的关键。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 组件A: 只需要 count 和 increment</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">CounterA</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; count, increment &#125; = <span class="hljs-title function_">useStore</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> (&#123;<br>    <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span>,<br>    <span class="hljs-attr">increment</span>: state.<span class="hljs-property">increment</span><br>  &#125;));<br>  <span class="hljs-comment">// ... render</span><br>&#125;<br><span class="hljs-comment">// 组件B: 只需要 decrement</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">CounterB</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> decrement = <span class="hljs-title function_">useStore</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">decrement</span>);<br>  <span class="hljs-comment">// ... render</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>关键特性&#x2F;优势</strong></p>
<ul>
<li>极致简洁： API 极其精简，学习成本低，样板代码极少。</li>
<li>高性能： 精确的订阅机制（通过选择器）确保组件只在相关状态变化时更新。</li>
<li>无 Provider 地狱： Store 是全局单例（虽然可以创建多个 Store），不需要用 Context Provider 包裹应用根节点。组件可以直接在任何地方使用 useStore。</li>
<li>Middleware 支持： 内置支持中间件（如 persist 持久化、immer 简化不可变更新、devtools 连接 Redux DevTools）。</li>
<li>出色的 TS 支持： 类型推断非常友好。</li>
</ul>
<p><strong>适用场景</strong></p>
<ul>
<li>绝大多数应用场景，特别是追求简洁、高效、易用的项目。从中小型到大型项目都适用。是目前非常流行的 Redux 替代品。</li>
</ul>
<h3 id="Jotai"><a href="#Jotai" class="headerlink" title="Jotai"></a>Jotai</h3><p><strong>核心思想</strong>： 受 Recoil 的 Atom 概念启发，但 API 设计更精简和原始（Primitive）。完全拥抱 React 的 Context 和 Hooks 思想。</p>
<p><strong>核心概念</strong></p>
<ul>
<li>Atom: 状态的基本单位。定义一个包含初始值的 Atom（不需要唯一的全局 key！）。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; atom &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;jotai&#x27;</span>;<br><span class="hljs-keyword">const</span> countAtom = <span class="hljs-title function_">atom</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// 初始值</span><br></code></pre></td></tr></table></figure>

<ul>
<li>Derived Atom: 通过读取其他 Atom 的值计算而来。可以是只读的或可写的（通过定义一个 get 函数和一个可选的 set 函数）。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> doubledCountAtom = <span class="hljs-title function_">atom</span>(<span class="hljs-function">(<span class="hljs-params">get</span>) =&gt;</span> <span class="hljs-title function_">get</span>(countAtom) * <span class="hljs-number">2</span>); <span class="hljs-comment">// 只读派生</span><br><span class="hljs-comment">// 可写派生 (set 会更新依赖的原始 atom)</span><br><span class="hljs-keyword">const</span> countPlusOneAtom = <span class="hljs-title function_">atom</span>(<br>  <span class="hljs-function">(<span class="hljs-params">get</span>) =&gt;</span> <span class="hljs-title function_">get</span>(countAtom) + <span class="hljs-number">1</span>, <span class="hljs-comment">// getter</span><br>  <span class="hljs-function">(<span class="hljs-params">get, set, newValue</span>) =&gt;</span> &#123; <span class="hljs-title function_">set</span>(countAtom, newValue - <span class="hljs-number">1</span>) &#125; <span class="hljs-comment">// setter</span><br>);<br></code></pre></td></tr></table></figure>

<p><strong>Hooks API</strong></p>
<ul>
<li>useAtom(atom)： 核心 Hook。返回 [value, setter]。组件会订阅传递给 useAtom 的这个特定 Atom 的变化。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useAtom</span>(countAtom);<br>  <span class="hljs-comment">// ... render</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Provider 与 Context</strong></p>
<ul>
<li>默认情况下，Atom 状态是全局共享的（通过 Jotai 内部的默认 Context）。</li>
<li>Provider： 如果需要创建隔离的状态作用域（例如在微前端、测试或需要多个独立实例的场景），可以使用 <code>&lt;Provider&gt;</code> 包裹组件树。Provider 内的组件访问的是该 Provider 作用域内的 Atom 状态。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Provider</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;jotai&#x27;</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Provider</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ComponentThatUsesAtoms</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Provider</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>关键特性&#x2F;优势</strong></p>
<ul>
<li>极简 API： 核心 API 只有 atom 和 useAtom。概念极其精简。</li>
<li>灵活的组合性： Atom 可以自由组合，构建复杂状态逻辑。</li>
<li>无 Key 设计： 不需要为 Atom 定义全局唯一的 key，简化了定义和使用。</li>
<li>基于 Context： 底层利用 React Context 实现，但通过优化避免了 Context 的渲染爆炸问题。Provider 提供了状态隔离能力。</li>
<li>轻量级： 包体积非常小。</li>
<li>优秀的并发模式兼容性。</li>
</ul>
<p><strong>适用场景</strong></p>
<ul>
<li>喜欢极简 API、原子化思想，且可能需要状态隔离（Provider）的项目。中小型到大型项目均可。</li>
</ul>
<h3 id="对比与选型建议-面试高频"><a href="#对比与选型建议-面试高频" class="headerlink" title="对比与选型建议 (面试高频)"></a>对比与选型建议 (面试高频)</h3><table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">Recoil</th>
<th align="left">Zustand</th>
<th align="left">Jotai</th>
</tr>
</thead>
<tbody><tr>
<td align="left">核心模型</td>
<td align="left">Atoms + Selectors (Graph)</td>
<td align="left">Centralized Store + Actions</td>
<td align="left">Atoms (Primitive)</td>
</tr>
<tr>
<td align="left">API 复杂度</td>
<td align="left">中等 (概念较多)</td>
<td align="left">极低 (非常简洁)</td>
<td align="left">很低 (极其精简)</td>
</tr>
<tr>
<td align="left">学习曲线</td>
<td align="left">中等偏上</td>
<td align="left">低</td>
<td align="left">低</td>
</tr>
<tr>
<td align="left">状态更新粒度</td>
<td align="left">细粒度 (Atom&#x2F;Selector 级)</td>
<td align="left">细粒度 (Selector 函数级)</td>
<td align="left">细粒度 (Atom 级)</td>
</tr>
<tr>
<td align="left">Provider 要求</td>
<td align="left"><code>&lt;RecoilRoot&gt;</code> 必需</td>
<td align="left">不需要 (全局 Store)</td>
<td align="left">可选 (默认全局，可隔离)</td>
</tr>
<tr>
<td align="left">异步处理</td>
<td align="left">强大 (Selector + Suspense)</td>
<td align="left">良好 (在 Action 中处理)</td>
<td align="left">良好 (在 Atom 或 Effect 中处理)</td>
</tr>
<tr>
<td align="left">TypeScript</td>
<td align="left">优秀</td>
<td align="left">极佳</td>
<td align="left">极佳</td>
</tr>
<tr>
<td align="left">包体积</td>
<td align="left">较大</td>
<td align="left">很小</td>
<td align="left">极小</td>
</tr>
<tr>
<td align="left">开发体验 (DX)</td>
<td align="left">好 (Meta 工具)</td>
<td align="left">极佳 (简洁，DevTools)</td>
<td align="left">极佳 (简洁)</td>
</tr>
<tr>
<td align="left">适用规模</td>
<td align="left">大型 &#x2F; 复杂派生状态</td>
<td align="left">全规模 (尤其推荐)</td>
<td align="left">全规模 (推荐中小到中大型)</td>
</tr>
<tr>
<td align="left">类似库</td>
<td align="left">-</td>
<td align="left">Valtio, React Tracked</td>
<td align="left">Recoil (简化版)</td>
</tr>
</tbody></table>
<h3 id="面试踩坑点与高频问题"><a href="#面试踩坑点与高频问题" class="headerlink" title="面试踩坑点与高频问题"></a>面试踩坑点与高频问题</h3><ul>
<li>useRecoilValueLoadable 状态 (state, contents)? Recoil 异步 Selector 使用 useRecoilValueLoadable 获取 Loadable 对象，其 state 表示状态 (‘hasValue’, ‘loading’, ‘hasError’)，contents 包含实际值或 Error 对象。</li>
<li>Zustand 性能关键 (selector 函数)： 务必使用带选择器函数的 useStore(selector) 来避免订阅整个 Store 导致的无效渲染。强调选择器结果变化才会触发渲染。</li>
<li>Jotai 的 Provider 作用： 理解默认全局 Context 和 <Provider> 创建隔离作用域的区别及适用场景（微前端、测试、组件库）。</li>
<li>不可变更新 (所有库)： 虽然 Zustand 和 Jotai 在 set 时可以“直接修改”，但最佳实践仍是保持不可变性（尤其数组&#x2F;对象），以避免潜在的渲染问题或 DevTools 跟踪问题。Zustand 常配合 immer 中间件。</li>
<li>闭包陷阱 (异步 Action)： 在 Zustand&#x2F;Jotai 的异步 Action 中，如果依赖当前状态进行计算，应使用 get() 函数 (Zustand) 或 get 参数 (Jotai 的 Atom set)，而不是直接读取闭包中的旧状态值。<ul>
<li>错误示例 (Zustand 闭包陷阱):</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ❌ 错误：闭包可能捕获旧的 count</span><br><span class="hljs-keyword">const</span> useStore = <span class="hljs-title function_">create</span>(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> (&#123;<br>  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-attr">incrementAsync</span>: <span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">1000</span>);<br>    <span class="hljs-title function_">set</span>(&#123; <span class="hljs-attr">count</span>: count + <span class="hljs-number">1</span> &#125;); <span class="hljs-comment">// 这里的 `count` 是创建时的初始值 0！</span><br>  &#125;<br>&#125;));<br></code></pre></td></tr></table></figure>
<ul>
<li>正确做法 (使用 get):</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ✅ 正确：通过 get 访问最新状态</span><br><span class="hljs-keyword">const</span> useStore = <span class="hljs-title function_">create</span>(<span class="hljs-function">(<span class="hljs-params">set, get</span>) =&gt;</span> (&#123;<br>  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-attr">incrementAsync</span>: <span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">1000</span>);<br>    <span class="hljs-title function_">set</span>(&#123; <span class="hljs-attr">count</span>: <span class="hljs-title function_">get</span>().<span class="hljs-property">count</span> + <span class="hljs-number">1</span> &#125;); <span class="hljs-comment">// 获取当前最新值</span><br>  &#125;<br>&#125;));<br></code></pre></td></tr></table></figure>

<ul>
<li>与 React 18 并发特性的兼容性： 强调 Recoil 和 Jotai 在设计上考虑了并发渲染。Zustand 也基本兼容，但需注意在严格模式下的双重渲染可能带来的副作用问题（可通过中间件或状态稳定化处理）。</li>
<li>为什么不用 Context 代替？ Context 在状态更新时会导致所有消费该 Context 的组件重新渲染，无论它们是否依赖于变化的那部分状态。这在频繁更新或大型状态对象时性能极差。Recoil&#x2F;Zustand&#x2F;Jotai 都通过订阅机制实现了细粒度更新。</li>
</ul>
<h1 id="第六章：React-Router-与数据请求"><a href="#第六章：React-Router-与数据请求" class="headerlink" title="第六章：React Router 与数据请求"></a>第六章：React Router 与数据请求</h1><h2 id="6-1-React-Router-基础（BrowserRouter、Route、Link）"><a href="#6-1-React-Router-基础（BrowserRouter、Route、Link）" class="headerlink" title="6.1 React Router 基础（BrowserRouter、Route、Link）"></a>6.1 React Router 基础（BrowserRouter、Route、Link）</h2><h3 id="基础概念（简要）"><a href="#基础概念（简要）" class="headerlink" title="基础概念（简要）"></a>基础概念（简要）</h3><p><strong>SPA 路由原理</strong></p>
<ul>
<li>在单页应用中，路由切换不会触发页面刷新</li>
<li>通过监听 URL 变化（hash 或 history API），动态渲染对应组件</li>
<li>保持应用状态的同时实现视图切换</li>
</ul>
<p><strong>React Router 核心作用</strong></p>
<ul>
<li>声明式路由配置</li>
<li>URL 与组件的映射关系管理</li>
<li>导航控制（声明式 <code>&lt;Link&gt;</code> 和编程式 navigate）</li>
</ul>
<h3 id="核心组件深度解析（React-Router-v6）"><a href="#核心组件深度解析（React-Router-v6）" class="headerlink" title="核心组件深度解析（React Router v6）"></a>核心组件深度解析（React Router v6）</h3><p><strong><code>&lt;BrowserRouter&gt;</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 入口文件 index.js</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">BrowserRouter</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;<br><br><span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>)).<span class="hljs-title function_">render</span>(<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">BrowserRouter</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">BrowserRouter</span>&gt;</span></span><br>);<br></code></pre></td></tr></table></figure>

<ul>
<li>作用：使用 HTML5 History API (pushState, replaceState) 管理路由</li>
<li>特点：<ul>
<li>URL 格式为干净的路径（如 &#x2F;dashboard）</li>
<li>需要服务器配合：所有路由请求需返回 index.html</li>
<li>面试坑点：直接访问子路由出现 404 的解决方案（配置服务器 fallback）</li>
</ul>
</li>
</ul>
<p><strong><code>&lt;Routes&gt;</code> 与 <code>&lt;Route&gt;</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Routes</span>, <span class="hljs-title class_">Route</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span></span><br><span class="language-xml">      &#123;/* 基础路由 */&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">HomePage</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">      </span><br><span class="language-xml">      &#123;/* 动态路由 */&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/users/:id&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">UserDetail</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">      </span><br><span class="language-xml">      &#123;/* 嵌套路由 */&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/dashboard&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">DashboardLayout</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">index</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">DashboardHome</span> /&gt;</span>&#125; /&gt; &#123;/* index 路由 */&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;settings&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">SettingsPage</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span></span><br><span class="language-xml">      </span><br><span class="language-xml">      &#123;/* 404 路由 */&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;*&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">NotFoundPage</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><code>&lt;Routes&gt;</code>：<ul>
<li>路由匹配容器，替代 v5 的 <Switch></li>
<li>自动选择最佳匹配的路由（不再按顺序匹配）</li>
</ul>
</li>
<li><code>&lt;Route&gt;</code> 关键属性：<ul>
<li>path：URL 匹配规则（支持 :id 动态参数）</li>
<li>element：匹配时渲染的组件（必须是 React 元素，如 <Component />）</li>
<li>index：标识默认子路由（当父路由匹配时渲染）</li>
</ul>
</li>
</ul>
<p><strong><code>&lt;Link&gt;</code> 与 <code>&lt;NavLink&gt;</code></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Link</span>, <span class="hljs-title class_">NavLink</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;<br><br><span class="hljs-comment">// 基础链接</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/about&quot;</span>&gt;</span>关于我们<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span><br><br><span class="hljs-comment">// 带状态的导航</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> </span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/users/123&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">state</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">fromDashboard:</span> <span class="hljs-attr">true</span> &#125;&#125;  // <span class="hljs-attr">传递状态</span></span></span><br><span class="hljs-tag"><span class="language-xml">&gt;</span></span><br><span class="language-xml">  用户详情</span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span><br><br><span class="hljs-comment">// 活动链接样式</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">NavLink</span> </span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/dashboard&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;(&#123;</span> <span class="hljs-attr">isActive</span> &#125;) =&gt;</span> (&#123; </span><br><span class="language-xml">    color: isActive ? &#x27;red&#x27; : &#x27;blue&#x27; </span><br><span class="language-xml">  &#125;)&#125;</span><br><span class="language-xml">  end  // 精确匹配（v6 新特性）</span><br><span class="language-xml">&gt;</span><br><span class="language-xml">  控制台</span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">NavLink</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<ul>
<li><code>&lt;Link&gt;</code>：<ul>
<li>声明式导航组件，渲染为 <code>&lt;a&gt;</code> 标签</li>
<li>to 属性支持字符串&#x2F;对象（可包含 pathname, search, hash, state）</li>
</ul>
</li>
<li><code>&lt;NavLink&gt;</code>：<ul>
<li>增强版 <code>&lt;Link&gt;</code>，可添加活动状态样式</li>
<li>isActive 标志当前是否匹配</li>
<li>end 属性确保精确匹配（避免父路由激活时子路由也被激活）</li>
</ul>
</li>
</ul>
<h3 id="基础路由配置模式"><a href="#基础路由配置模式" class="headerlink" title="基础路由配置模式"></a>基础路由配置模式</h3><p><strong>集中式配置（推荐）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// routes.js</span><br><span class="hljs-keyword">const</span> routes = [<br>  &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Home</span> /&gt;</span></span> &#125;,<br>  &#123; <br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/products&#x27;</span>,<br>    <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProductLayout</span> /&gt;</span></span>,<br>    <span class="hljs-attr">children</span>: [<br>      &#123; <span class="hljs-attr">index</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProductList</span> /&gt;</span></span> &#125;,<br>      &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;:id&#x27;</span>, <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProductDetail</span> /&gt;</span></span> &#125;<br>    ]<br>  &#125;<br>];<br><br><span class="hljs-comment">// App.js</span><br><span class="hljs-keyword">import</span> &#123; useRoutes &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useRoutes</span>(routes);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>编程式导航</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; useNavigate &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> navigate = <span class="hljs-title function_">useNavigate</span>();<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogin</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-title function_">login</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-comment">// 跳转并替换历史记录（不可回退）</span><br>      <span class="hljs-title function_">navigate</span>(<span class="hljs-string">&#x27;/dashboard&#x27;</span>, &#123; <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">state</span>: &#123; user &#125; &#125;);<br>    &#125;);<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleLogin&#125;</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>useNavigate() 返回导航函数</li>
<li>参数选项：<ul>
<li>replace: true 替换当前历史记录</li>
<li>state 传递路由状态（可通过 useLocation() 获取）</li>
</ul>
</li>
</ul>
<h3 id="面试高频问题与踩坑点"><a href="#面试高频问题与踩坑点" class="headerlink" title="面试高频问题与踩坑点"></a>面试高频问题与踩坑点</h3><p><strong>BrowserRouter 的服务器配置问题</strong></p>
<p>问题：直接访问 &#x2F;dashboard 路由出现 404</p>
<p>解决方案：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># Nginx 配置</span><br><span class="hljs-section">location</span> / &#123;<br>  <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>v5 到 v6 的重大变化</strong></p>
<ul>
<li>废除 <code>&lt;Switch&gt;</code> → 改用 <code>&lt;Routes&gt;</code></li>
<li>废除 component&#x3D;{Component} → 改用 <code>element=&#123;&lt;Component /&gt;&#125;</code></li>
<li>废除 exact 属性 → 路径匹配规则变更（默认部分匹配）</li>
<li>嵌套路由必须使用 <code>&lt;Outlet&gt;</code> 作为占位符</li>
</ul>
<p><strong>动态路由参数获取</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; useParams &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserDetail</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; id &#125; = <span class="hljs-title function_">useParams</span>();  <span class="hljs-comment">// 获取 :id 参数</span><br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>路由状态传递与获取</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 发送方</span><br>&lt;<span class="hljs-title class_">Link</span> to=<span class="hljs-string">&quot;/profile&quot;</span> state=&#123;&#123; <span class="hljs-attr">fromHome</span>: <span class="hljs-literal">true</span> &#125;&#125; /&gt;<br><br><span class="hljs-comment">// 接收方</span><br><span class="hljs-keyword">import</span> &#123; useLocation &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> location = <span class="hljs-title function_">useLocation</span>();<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(location.<span class="hljs-property">state</span>?.<span class="hljs-property">fromHome</span>); <span class="hljs-comment">// true</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong><code>&lt;NavLink&gt;</code> 精确匹配问题</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 错误：/dashboard/settings 会同时激活两个链接</span><br>&lt;<span class="hljs-title class_">NavLink</span> to=<span class="hljs-string">&quot;/dashboard&quot;</span>&gt;控制台&lt;/<span class="hljs-title class_">NavLink</span>&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">NavLink</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/dashboard/settings&quot;</span>&gt;</span>设置<span class="hljs-tag">&lt;/<span class="hljs-name">NavLink</span>&gt;</span></span><br><br><span class="hljs-comment">// 正确：父链接添加 end 属性</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">NavLink</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/dashboard&quot;</span> <span class="hljs-attr">end</span>&gt;</span>控制台<span class="hljs-tag">&lt;/<span class="hljs-name">NavLink</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p><strong>路由鉴权基础模式</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 高阶组件示例</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">PrivateRoute</span> = (<span class="hljs-params">&#123; children &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; user &#125; = <span class="hljs-title function_">useAuth</span>();<br>  <span class="hljs-keyword">return</span> user ? children : <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navigate</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/login&quot;</span> /&gt;</span></span>;<br>&#125;;<br><br><span class="hljs-comment">// 使用</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> </span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/admin&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &lt;<span class="hljs-attr">PrivateRoute</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">AdminPanel</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">PrivateRoute</span>&gt;</span></span><br><span class="language-xml">  &#125;</span><br><span class="language-xml">/&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="核心总结"><a href="#核心总结" class="headerlink" title="核心总结"></a>核心总结</h3><ul>
<li>路由三件套：<ul>
<li><code>&lt;BrowserRouter&gt;</code> 提供路由上下文</li>
<li><code>&lt;Routes&gt;</code> + <code>&lt;Route&gt;</code> 定义路由规则</li>
<li><code>&lt;Link&gt;</code>&#x2F;<code>&lt;NavLink&gt;</code> 实现声明式导航</li>
</ul>
</li>
<li>v6 核心变化：<ul>
<li>路由配置从 component 改为 element</li>
<li>嵌套路由使用 <code>&lt;Outlet&gt;</code> 作为渲染出口</li>
<li>匹配规则优化（自动选择最佳匹配）</li>
</ul>
</li>
<li>面试必考：<ul>
<li>动态路由参数获取（useParams）</li>
<li>编程式导航（useNavigate）</li>
<li>路由守卫实现方案</li>
<li>v5 到 v6 的迁移问题</li>
</ul>
</li>
</ul>
<h2 id="6-2-动态路由与嵌套路由"><a href="#6-2-动态路由与嵌套路由" class="headerlink" title="6.2 动态路由与嵌套路由"></a>6.2 动态路由与嵌套路由</h2><h3 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h3><p><strong>动态路由</strong></p>
<ul>
<li>定义：路径中包含参数的路由（如 &#x2F;users&#x2F;:id）</li>
<li>核心价值：<ul>
<li>创建可复用的视图模板</li>
<li>根据URL参数动态加载数据</li>
<li>实现SEO友好的URL结构</li>
</ul>
</li>
</ul>
<p><strong>嵌套路由</strong></p>
<ul>
<li>定义：路由之间的父子层级关系</li>
<li>核心价值：<ul>
<li>实现布局复用（共享header&#x2F;sidebar）</li>
<li>组织复杂的应用结构</li>
<li>保持局部UI状态（仅更新子路由区域）</li>
</ul>
</li>
</ul>
<h3 id="动态路由深度解析"><a href="#动态路由深度解析" class="headerlink" title="动态路由深度解析"></a>动态路由深度解析</h3><p><strong>基础实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 路由配置</span><br>&lt;<span class="hljs-title class_">Routes</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/products/:productId&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">ProductDetail</span> /&gt;</span>&#125; /&gt;</span><br>&lt;/<span class="hljs-title class_">Routes</span>&gt;<br><br><span class="hljs-comment">// 组件内获取参数</span><br><span class="hljs-keyword">import</span> &#123; useParams &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductDetail</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; productId &#125; = <span class="hljs-title function_">useParams</span>(); <span class="hljs-comment">// 获取动态参数</span><br>  <span class="hljs-comment">// 使用 productId 加载数据...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>高级匹配模式</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 多参数路由</span><br>&lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">&quot;/category/:categoryId/product/:productId&quot;</span> /&gt;<br><br><span class="hljs-comment">// 可选参数</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/search/:keyword?/:filter?&quot;</span> /&gt;</span></span><br><br><span class="hljs-comment">// 正则约束 (v6.8+)</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> </span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/user/:id(\\d+)&quot;</span> // <span class="hljs-attr">只匹配数字ID</span></span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">UserProfile</span> /&gt;</span>&#125; </span><br><span class="language-xml">/&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>数据加载模式</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// React Router v6.4+ 数据路由</span><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createBrowserRouter</span>([<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;products/:id&quot;</span>,<br>    <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProductLayout</span> /&gt;</span></span>,<br>    <span class="hljs-attr">loader</span>: <span class="hljs-title function_">async</span> (&#123; params &#125;) =&gt; &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/products/<span class="hljs-subst">$&#123;params.id&#125;</span>`</span>); <span class="hljs-comment">// 预加载数据</span><br>    &#125;,<br>    <span class="hljs-attr">children</span>: [<br>      &#123; <span class="hljs-attr">index</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProductOverview</span> /&gt;</span></span> &#125;,<br>      &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;reviews&quot;</span>, <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProductReviews</span> /&gt;</span></span> &#125;<br>    ]<br>  &#125;<br>]);<br></code></pre></td></tr></table></figure>

<h3 id="嵌套路由深度解析"><a href="#嵌套路由深度解析" class="headerlink" title="嵌套路由深度解析"></a>嵌套路由深度解析</h3><p><strong>基础嵌套结构</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">&lt;<span class="hljs-title class_">Routes</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;dashboard&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">DashboardLayout</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">index</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">DashboardHome</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;analytics&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">AnalyticsPage</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;settings&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">SettingsPage</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span></span><br>&lt;/<span class="hljs-title class_">Routes</span>&gt;<br><br><span class="hljs-comment">// DashboardLayout.jsx</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Outlet</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">DashboardLayout</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;dashboard&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Sidebar</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Outlet</span> /&gt;</span> &#123;/* 子路由渲染位置 */&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>多级嵌套实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">&lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">&quot;admin&quot;</span> element=&#123;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">AdminLayout</span> /&gt;</span></span>&#125;&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">index</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">AdminDashboard</span> /&gt;</span>&#125; /&gt;</span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;users&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">UserManagementLayout</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">index</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">UserList</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;:userId&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">UserDetail</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span></span><br>&lt;/<span class="hljs-title class_">Route</span>&gt;<br></code></pre></td></tr></table></figure>

<p><strong>布局路由模式</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 创建共享布局组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">MainLayout</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Outlet</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Footer</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 应用布局</span><br>&lt;<span class="hljs-title class_">Route</span> element=&#123;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">MainLayout</span> /&gt;</span></span>&#125;&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">HomePage</span> /&gt;</span>&#125; /&gt;</span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/about&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">AboutPage</span> /&gt;</span>&#125; /&gt;</span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/contact&quot;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">ContactPage</span> /&gt;</span>&#125; /&gt;</span><br>&lt;/<span class="hljs-title class_">Route</span>&gt;<br></code></pre></td></tr></table></figure>

<h3 id="关键特性与最佳实践"><a href="#关键特性与最佳实践" class="headerlink" title="关键特性与最佳实践"></a>关键特性与最佳实践</h3><p><strong>动态路径生成</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 根据数据生成动态路由</span><br><span class="hljs-keyword">const</span> products = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchProducts</span>();<br><br><span class="hljs-keyword">const</span> routes = products.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> (&#123;<br>  <span class="hljs-attr">path</span>: <span class="hljs-string">`products/<span class="hljs-subst">$&#123;product.slug&#125;</span>`</span>,<br>  <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProductPage</span> /&gt;</span></span>,<br>  <span class="hljs-attr">loader</span>: <span class="hljs-function">() =&gt;</span> product<br>&#125;));<br></code></pre></td></tr></table></figure>

<p><strong>相对路由导航</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 在 /dashboard/settings 中</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">SettingsPage</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;../analytics&quot;</span>&gt;</span>返回分析<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span> </span><br><span class="language-xml">      &#123;/* 指向 /dashboard/analytics */&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>错误边界处理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 路由级错误处理</span><br>&lt;<span class="hljs-title class_">Route</span><br>  path=<span class="hljs-string">&quot;projects/:projectId&quot;</span><br>  element=&#123;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProjectDetail</span> /&gt;</span></span>&#125;<br>  errorElement=&#123;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProjectError</span> /&gt;</span></span>&#125; <span class="hljs-comment">// 捕获组件渲染错误</span><br>  loader=&#123;<span class="hljs-title function_">async</span> (&#123; params &#125;) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> project = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchProject</span>(params.<span class="hljs-property">projectId</span>);<br>    <span class="hljs-keyword">if</span> (!project) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">&quot;Not Found&quot;</span>, &#123; <span class="hljs-attr">status</span>: <span class="hljs-number">404</span> &#125;);<br>    <span class="hljs-keyword">return</span> project;<br>  &#125;&#125;<br>/&gt;<br></code></pre></td></tr></table></figure>

<h3 id="面试高频问题与解决方案"><a href="#面试高频问题与解决方案" class="headerlink" title="面试高频问题与解决方案"></a>面试高频问题与解决方案</h3><p><strong>动态路由数据加载竞态条件</strong></p>
<p>问题：快速切换路由时，后发请求可能先返回导致数据错乱</p>
<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">let</span> isActive = <span class="hljs-literal">true</span>;<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/products/<span class="hljs-subst">$&#123;productId&#125;</span>`</span>);<br>    <span class="hljs-keyword">if</span> (isActive) <span class="hljs-title function_">setProduct</span>(data);<br>  &#125;;<br><br>  <span class="hljs-title function_">fetchData</span>();<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123; isActive = <span class="hljs-literal">false</span>; &#125;; <span class="hljs-comment">// 清理函数取消旧请求</span><br>&#125;, [productId]);<br></code></pre></td></tr></table></figure>

<p><strong>嵌套路由权限控制</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 路由守卫组件</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">ProtectedRoute</span> = (<span class="hljs-params">&#123; children, roles &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; user &#125; = <span class="hljs-title function_">useAuth</span>();<br>  <br>  <span class="hljs-keyword">if</span> (!user) <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navigate</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/login&quot;</span> /&gt;</span></span>;<br>  <span class="hljs-keyword">if</span> (roles &amp;&amp; !roles.<span class="hljs-title function_">includes</span>(user.<span class="hljs-property">role</span>)) <br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navigate</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/unauthorized&quot;</span> /&gt;</span></span>;<br>  <br>  <span class="hljs-keyword">return</span> children;<br>&#125;;<br><br><span class="hljs-comment">// 使用</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> </span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;admin&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &lt;<span class="hljs-attr">ProtectedRoute</span> <span class="hljs-attr">roles</span>=<span class="hljs-string">&#123;[</span>&#x27;<span class="hljs-attr">admin</span>&#x27;, &#x27;<span class="hljs-attr">superadmin</span>&#x27;]&#125;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">AdminLayout</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ProtectedRoute</span>&gt;</span></span><br><span class="language-xml">  &#125;</span><br><span class="language-xml">&gt;</span><br><span class="language-xml">  &#123;/* 子路由自动继承保护 */&#125;</span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p><strong>面包屑导航实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 使用 useMatches() 获取路由层级</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Breadcrumbs</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> matches = <span class="hljs-title function_">useMatches</span>();<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span></span><br><span class="language-xml">      &#123;matches</span><br><span class="language-xml">        .filter(match =&gt; match.handle?.breadcrumb)</span><br><span class="language-xml">        .map(match =&gt; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;match.pathname&#125;</span>&gt;</span></span><br><span class="language-xml">            &#123;match.handle.breadcrumb(match)&#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="language-xml">        ))&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 路由配置中添加元数据</span><br>&lt;<span class="hljs-title class_">Route</span> <br>  path=<span class="hljs-string">&quot;products/:id&quot;</span><br>  element=&#123;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProductPage</span> /&gt;</span></span>&#125;<br>  handle=&#123;&#123; <span class="hljs-attr">breadcrumb</span>: <span class="hljs-function">(<span class="hljs-params">match</span>) =&gt;</span> <span class="hljs-string">`Product <span class="hljs-subst">$&#123;match.params.id&#125;</span>`</span> &#125;&#125;<br>/&gt;<br></code></pre></td></tr></table></figure>

<p><strong>滚动位置恢复</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 创建自定义滚动管理</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ScrollToTop</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> location = <span class="hljs-title function_">useLocation</span>();<br>  <br>  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 排除需要保留滚动位置的路由</span><br>    <span class="hljs-keyword">if</span> (!location.<span class="hljs-property">state</span>?.<span class="hljs-property">preserveScroll</span>) &#123;<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollTo</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>    &#125;<br>  &#125;, [location.<span class="hljs-property">key</span>]);<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br><br><span class="hljs-comment">// 在根路由使用</span><br>&lt;<span class="hljs-title class_">Router</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ScrollToTop</span> /&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span></span><br>&lt;/<span class="hljs-title class_">Router</span>&gt;<br></code></pre></td></tr></table></figure>

<h3 id="性能优化技巧-2"><a href="#性能优化技巧-2" class="headerlink" title="性能优化技巧"></a>性能优化技巧</h3><p><strong>路由级代码分割</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">ProductDetail</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./ProductDetail&#x27;</span>));<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> </span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;products/:id&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &lt;<span class="hljs-attr">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">Loading</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ProductDetail</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br><span class="language-xml">  &#125;</span><br><span class="language-xml">/&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>预加载策略</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 鼠标悬停时预加载路由组件</span><br>&lt;<span class="hljs-title class_">Link</span> <br>  to=<span class="hljs-string">&quot;/dashboard/analytics&quot;</span><br>  onMouseEnter=&#123;<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./AnalyticsPage&#x27;</span>)&#125;<br>&gt;<br>  分析面板<br>&lt;/<span class="hljs-title class_">Link</span>&gt;<br></code></pre></td></tr></table></figure>

<h3 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h3><p><strong>动态路由核心</strong>：</p>
<ul>
<li>使用 :param 语法定义动态段</li>
<li>通过 useParams() 获取参数</li>
<li>支持正则约束和可选参数</li>
</ul>
<p><strong>嵌套路由核心</strong>：</p>
<ul>
<li>使用 <code>&lt;Outlet&gt;</code> 作为子路由渲染出口</li>
<li>布局路由共享UI结构</li>
<li>路由配置反映UI层次关系</li>
</ul>
<p><strong>高级模式</strong>：</p>
<ul>
<li>数据路由（v6.4+）实现预加载</li>
<li>相对导航简化路径管理</li>
<li>错误边界增强健壮性</li>
</ul>
<p><strong>面试重点</strong>：</p>
<ul>
<li>动态路由的数据加载问题</li>
<li>嵌套路由的权限控制方案</li>
<li>复杂路由结构设计能力</li>
<li>性能优化实践</li>
</ul>
<h2 id="6-3-路由守卫与权限控制"><a href="#6-3-路由守卫与权限控制" class="headerlink" title="6.3 路由守卫与权限控制"></a>6.3 路由守卫与权限控制</h2><h3 id="权限控制核心概念"><a href="#权限控制核心概念" class="headerlink" title="权限控制核心概念"></a>权限控制核心概念</h3><p><strong>权限控制类型</strong></p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">场景</th>
<th align="left">实现难度</th>
</tr>
</thead>
<tbody><tr>
<td align="left">路由级守卫</td>
<td align="left">整个路由模块的访问控制</td>
<td align="left">★★☆</td>
</tr>
<tr>
<td align="left">组件级守卫</td>
<td align="left">页面内特定功能的访问控制</td>
<td align="left">★★★</td>
</tr>
<tr>
<td align="left">数据级守卫</td>
<td align="left">API 请求和数据显示控制</td>
<td align="left">★★★★</td>
</tr>
</tbody></table>
<p><strong>认证与授权</strong></p>
<ul>
<li>认证(Authentication)：验证用户身份（是否登录）</li>
<li>授权(Authorization)：验证用户权限（是否有权访问）</li>
</ul>
<h3 id="基础路由守卫实现"><a href="#基础路由守卫实现" class="headerlink" title="基础路由守卫实现"></a>基础路由守卫实现</h3><p><strong>高阶组件模式 (HOC)</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 路由守卫高阶组件</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">withAuth</span> = (<span class="hljs-params">Component, requiredRole = <span class="hljs-literal">null</span></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">props</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; user, isAuthenticated &#125; = <span class="hljs-title function_">useAuth</span>();<br>    <span class="hljs-keyword">const</span> location = <span class="hljs-title function_">useLocation</span>();<br>    <br>    <span class="hljs-keyword">if</span> (!isAuthenticated) &#123;<br>      <span class="hljs-comment">// 未登录重定向到登录页</span><br>      <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navigate</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/login&quot;</span> <span class="hljs-attr">state</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">from:</span> <span class="hljs-attr">location</span> &#125;&#125; <span class="hljs-attr">replace</span> /&gt;</span></span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> (requiredRole &amp;&amp; user.<span class="hljs-property">role</span> !== requiredRole) &#123;<br>      <span class="hljs-comment">// 权限不足</span><br>      <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navigate</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/unauthorized&quot;</span> <span class="hljs-attr">replace</span> /&gt;</span></span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Component</span> &#123;<span class="hljs-attr">...props</span>&#125; /&gt;</span></span>;<br>  &#125;;<br>&#125;;<br><br><span class="hljs-comment">// 使用示例</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">AdminDashboard</span> = <span class="hljs-title function_">withAuth</span>(<span class="hljs-title class_">DashboardComponent</span>, <span class="hljs-string">&#x27;admin&#x27;</span>);<br><br><span class="hljs-comment">// 路由配置</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> </span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/admin&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">AdminDashboard</span> /&gt;</span>&#125; </span><br><span class="language-xml">/&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>包装器组件模式</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 路由守卫组件</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">RouteGuard</span> = (<span class="hljs-params">&#123; children, roles &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; user, isAuthenticated &#125; = <span class="hljs-title function_">useAuth</span>();<br>  <span class="hljs-keyword">const</span> location = <span class="hljs-title function_">useLocation</span>();<br>  <br>  <span class="hljs-keyword">if</span> (!isAuthenticated) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navigate</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/login&quot;</span> <span class="hljs-attr">state</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">from:</span> <span class="hljs-attr">location</span> &#125;&#125; <span class="hljs-attr">replace</span> /&gt;</span></span>;<br>  &#125;<br>  <br>  <span class="hljs-keyword">if</span> (roles &amp;&amp; !roles.<span class="hljs-title function_">includes</span>(user.<span class="hljs-property">role</span>)) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;unauthorized&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>403 Forbidden<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>您没有权限访问此页面<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>  &#125;<br>  <br>  <span class="hljs-keyword">return</span> children;<br>&#125;;<br><br><span class="hljs-comment">// 使用示例</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> </span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/dashboard&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &lt;<span class="hljs-attr">RouteGuard</span> <span class="hljs-attr">roles</span>=<span class="hljs-string">&#123;[</span>&#x27;<span class="hljs-attr">user</span>&#x27;, &#x27;<span class="hljs-attr">admin</span>&#x27;]&#125;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">DashboardPage</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">RouteGuard</span>&gt;</span></span><br><span class="language-xml">  &#125; </span><br><span class="language-xml">/&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="高级权限控制方案"><a href="#高级权限控制方案" class="headerlink" title="高级权限控制方案"></a>高级权限控制方案</h3><p><strong>基于路由配置的集中式管理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 路由配置文件</span><br><span class="hljs-keyword">const</span> routes = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>,<br>    <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">HomePage</span> /&gt;</span></span>,<br>    <span class="hljs-attr">public</span>: <span class="hljs-literal">true</span><br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/dashboard&#x27;</span>,<br>    <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">DashboardLayout</span> /&gt;</span></span>,<br>    <span class="hljs-attr">roles</span>: [<span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-string">&#x27;admin&#x27;</span>],<br>    <span class="hljs-attr">children</span>: [<br>      &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;analytics&#x27;</span>, <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Analytics</span> /&gt;</span></span> &#125;,<br>      &#123; <br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;admin&#x27;</span>, <br>        <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">AdminPanel</span> /&gt;</span></span>,<br>        <span class="hljs-attr">roles</span>: [<span class="hljs-string">&#x27;admin&#x27;</span>] <span class="hljs-comment">// 子路由可以覆盖父路由权限</span><br>      &#125;<br>    ]<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/system-settings&#x27;</span>,<br>    <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SystemSettings</span> /&gt;</span></span>,<br>    <span class="hljs-attr">roles</span>: [<span class="hljs-string">&#x27;superadmin&#x27;</span>]<br>  &#125;<br>];<br><br><span class="hljs-comment">// 路由渲染器</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">renderRoutes</span> = (<span class="hljs-params">routes</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> routes.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">route</span>) =&gt;</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;route.path&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">path</span>=<span class="hljs-string">&#123;route.path&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">route.public</span> ? (</span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">route.element</span></span></span><br><span class="hljs-tag"><span class="language-xml">        ) <span class="hljs-attr">:</span> (</span></span><br><span class="hljs-tag"><span class="language-xml">          &lt;<span class="hljs-attr">RouteGuard</span> <span class="hljs-attr">roles</span>=<span class="hljs-string">&#123;route.roles&#125;</span>&gt;</span></span><br><span class="language-xml">            &#123;route.element&#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">RouteGuard</span>&gt;</span></span><br><span class="language-xml">        )</span><br><span class="language-xml">      &#125;</span><br><span class="language-xml">    &gt;</span><br><span class="language-xml">      &#123;route.children &amp;&amp; renderRoutes(route.children)&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span></span><br>  ));<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>RBAC（基于角色的访问控制）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 权限服务</span><br><span class="hljs-keyword">const</span> permissionService = &#123;<br>  <span class="hljs-comment">// 角色权限映射</span><br>  <span class="hljs-attr">roles</span>: &#123;<br>    <span class="hljs-attr">guest</span>: [<span class="hljs-string">&#x27;view_public&#x27;</span>],<br>    <span class="hljs-attr">user</span>: [<span class="hljs-string">&#x27;view_dashboard&#x27;</span>, <span class="hljs-string">&#x27;edit_profile&#x27;</span>],<br>    <span class="hljs-attr">admin</span>: [<span class="hljs-string">&#x27;manage_users&#x27;</span>, <span class="hljs-string">&#x27;view_reports&#x27;</span>, <span class="hljs-string">&#x27;edit_settings&#x27;</span>],<br>    <span class="hljs-attr">superadmin</span>: [<span class="hljs-string">&#x27;*&#x27;</span>] <span class="hljs-comment">// 所有权限</span><br>  &#125;,<br>  <br>  <span class="hljs-comment">// 检查权限</span><br>  <span class="hljs-title function_">hasPermission</span>(<span class="hljs-params">user, requiredPermission</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!user || !user.<span class="hljs-property">role</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <br>    <span class="hljs-keyword">const</span> userPermissions = <span class="hljs-variable language_">this</span>.<span class="hljs-property">roles</span>[user.<span class="hljs-property">role</span>] || [];<br>    <br>    <span class="hljs-keyword">return</span> userPermissions.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;*&#x27;</span>) || <br>           userPermissions.<span class="hljs-title function_">includes</span>(requiredPermission);<br>  &#125;<br>&#125;;<br><br><span class="hljs-comment">// 权限检查钩子</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">usePermission</span> = (<span class="hljs-params">requiredPermission</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; user &#125; = <span class="hljs-title function_">useAuth</span>();<br>  <br>  <span class="hljs-keyword">return</span> permissionService.<span class="hljs-title function_">hasPermission</span>(user, requiredPermission);<br>&#125;;<br><br><span class="hljs-comment">// 使用示例</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">AnalyticsPage</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> canViewReports = <span class="hljs-title function_">usePermission</span>(<span class="hljs-string">&#x27;view_reports&#x27;</span>);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      &#123;canViewReports ? (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">AnalyticsChart</span> /&gt;</span></span><br><span class="language-xml">      ) : (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;permission-warning&quot;</span>&gt;</span></span><br><span class="language-xml">          您没有查看报表的权限</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      )&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>ABAC（基于属性的访问控制）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ABAC 策略引擎</span><br><span class="hljs-keyword">const</span> abacEngine = &#123;<br>  <span class="hljs-title function_">evaluate</span>(<span class="hljs-params">policy, context</span>) &#123;<br>    <span class="hljs-comment">// 简化版策略评估</span><br>    <span class="hljs-keyword">return</span> policy.<span class="hljs-property">rules</span>.<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">rule</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> value = context[rule.<span class="hljs-property">attribute</span>];<br>      <span class="hljs-keyword">switch</span> (rule.<span class="hljs-property">operator</span>) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;eq&#x27;</span>: <span class="hljs-keyword">return</span> value == rule.<span class="hljs-property">value</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;gt&#x27;</span>: <span class="hljs-keyword">return</span> value &gt; rule.<span class="hljs-property">value</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;in&#x27;</span>: <span class="hljs-keyword">return</span> rule.<span class="hljs-property">value</span>.<span class="hljs-title function_">includes</span>(value);<br>        <span class="hljs-attr">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>      &#125;<br>    &#125;);<br>  &#125;<br>&#125;;<br><br><span class="hljs-comment">// 项目访问权限检查</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">useProjectAccess</span> = (<span class="hljs-params">projectId</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; user &#125; = <span class="hljs-title function_">useAuth</span>();<br>  <span class="hljs-keyword">const</span> [project] = <span class="hljs-title function_">useFetchProject</span>(projectId);<br>  <br>  <span class="hljs-keyword">const</span> canEdit = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (!user || !project) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <br>    <span class="hljs-keyword">const</span> context = &#123;<br>      <span class="hljs-attr">userId</span>: user.<span class="hljs-property">id</span>,<br>      <span class="hljs-attr">userRole</span>: user.<span class="hljs-property">role</span>,<br>      <span class="hljs-attr">projectOwner</span>: project.<span class="hljs-property">ownerId</span>,<br>      <span class="hljs-attr">projectStatus</span>: project.<span class="hljs-property">status</span>,<br>      <span class="hljs-attr">teamMembers</span>: project.<span class="hljs-property">teamMembers</span><br>    &#125;;<br>    <br>    <span class="hljs-keyword">const</span> editPolicy = &#123;<br>      <span class="hljs-attr">rules</span>: [<br>        &#123; <span class="hljs-attr">attribute</span>: <span class="hljs-string">&#x27;userRole&#x27;</span>, <span class="hljs-attr">operator</span>: <span class="hljs-string">&#x27;in&#x27;</span>, <span class="hljs-attr">value</span>: [<span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;pm&#x27;</span>] &#125;,<br>        &#123; <br>          <span class="hljs-attr">attribute</span>: <span class="hljs-string">&#x27;projectStatus&#x27;</span>, <br>          <span class="hljs-attr">operator</span>: <span class="hljs-string">&#x27;neq&#x27;</span>, <br>          <span class="hljs-attr">value</span>: <span class="hljs-string">&#x27;archived&#x27;</span> <br>        &#125;,<br>        &#123;<br>          <span class="hljs-attr">anyOf</span>: [<br>            &#123; <span class="hljs-attr">attribute</span>: <span class="hljs-string">&#x27;projectOwner&#x27;</span>, <span class="hljs-attr">operator</span>: <span class="hljs-string">&#x27;eq&#x27;</span>, <span class="hljs-attr">value</span>: user.<span class="hljs-property">id</span> &#125;,<br>            &#123; <span class="hljs-attr">attribute</span>: <span class="hljs-string">&#x27;teamMembers&#x27;</span>, <span class="hljs-attr">operator</span>: <span class="hljs-string">&#x27;in&#x27;</span>, <span class="hljs-attr">value</span>: user.<span class="hljs-property">id</span> &#125;<br>          ]<br>        &#125;<br>      ]<br>    &#125;;<br>    <br>    <span class="hljs-keyword">return</span> abacEngine.<span class="hljs-title function_">evaluate</span>(editPolicy, context);<br>  &#125;, [user, project]);<br>  <br>  <span class="hljs-keyword">return</span> &#123; canEdit &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure>

<h3 id="企业级最佳实践-3"><a href="#企业级最佳实践-3" class="headerlink" title="企业级最佳实践"></a>企业级最佳实践</h3><p><strong>路由元数据方案 (React Router 6.4+)</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 使用loader实现权限控制</span><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createBrowserRouter</span>([<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/admin&quot;</span>,<br>    <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">AdminLayout</span> /&gt;</span></span>,<br>    <span class="hljs-attr">loader</span>: <span class="hljs-title function_">async</span> () =&gt; &#123;<br>      <span class="hljs-comment">// 权限检查</span><br>      <span class="hljs-keyword">const</span> &#123; user &#125; = <span class="hljs-keyword">await</span> authService.<span class="hljs-title function_">getCurrentUser</span>();<br>      <br>      <span class="hljs-keyword">if</span> (!user) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-title function_">redirect</span>(<span class="hljs-string">&quot;/login&quot;</span>);<br>      &#125;<br>      <br>      <span class="hljs-keyword">if</span> (user.<span class="hljs-property">role</span> !== <span class="hljs-string">&quot;admin&quot;</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">&quot;Forbidden&quot;</span>, &#123; <span class="hljs-attr">status</span>: <span class="hljs-number">403</span> &#125;);<br>      &#125;<br>      <br>      <span class="hljs-keyword">return</span> &#123; user &#125;;<br>    &#125;,<br>    <span class="hljs-attr">errorElement</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">AdminErrorBoundary</span> /&gt;</span></span>,<br>    <span class="hljs-attr">children</span>: [<br>      &#123; <span class="hljs-attr">index</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">AdminDashboard</span> /&gt;</span></span> &#125;,<br>      &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;users&quot;</span>, <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserManagement</span> /&gt;</span></span> &#125;<br>    ]<br>  &#125;<br>]);<br></code></pre></td></tr></table></figure>

<p><strong>JWT 认证集成方案</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// Axios 请求拦截器</span><br>api.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> token = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;access_token&#x27;</span>);<br>  <span class="hljs-keyword">if</span> (token) &#123;<br>    config.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">$&#123;token&#125;</span>`</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> config;<br>&#125;);<br><br><span class="hljs-comment">// Axios 响应拦截器 (处理token刷新)</span><br>api.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<br>  <span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response,<br>  <span class="hljs-keyword">async</span> error =&gt; &#123;<br>    <span class="hljs-keyword">const</span> originalRequest = error.<span class="hljs-property">config</span>;<br>    <br>    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span>.<span class="hljs-property">status</span> === <span class="hljs-number">401</span> &amp;&amp; !originalRequest.<span class="hljs-property">_retry</span>) &#123;<br>      originalRequest.<span class="hljs-property">_retry</span> = <span class="hljs-literal">true</span>;<br>      <br>      <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// 刷新token</span><br>        <span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-keyword">await</span> <span class="hljs-title function_">refreshToken</span>();<br>        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;access_token&#x27;</span>, data.<span class="hljs-property">access_token</span>);<br>        <br>        <span class="hljs-comment">// 重试原始请求</span><br>        originalRequest.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">$&#123;data.access_token&#125;</span>`</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">api</span>(originalRequest);<br>      &#125; <span class="hljs-keyword">catch</span> (refreshError) &#123;<br>        <span class="hljs-comment">// 刷新失败，跳转登录</span><br>        store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">logout</span>());<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(refreshError);<br>      &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);<br>  &#125;<br>);<br></code></pre></td></tr></table></figure>

<p><strong>权限指令式组件</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 权限控制组件</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Permission</span> = (<span class="hljs-params">&#123; </span><br><span class="hljs-params">  children, </span><br><span class="hljs-params">  requiredPermission,</span><br><span class="hljs-params">  fallback = <span class="hljs-literal">null</span> </span><br><span class="hljs-params">&#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> hasPermission = <span class="hljs-title function_">usePermission</span>(requiredPermission);<br>  <br>  <span class="hljs-keyword">if</span> (!hasPermission) &#123;<br>    <span class="hljs-keyword">return</span> fallback;<br>  &#125;<br>  <br>  <span class="hljs-keyword">return</span> children;<br>&#125;;<br><br><span class="hljs-comment">// 使用示例</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserManagementPage</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>用户管理<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      </span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Permission</span> <span class="hljs-attr">requiredPermission</span>=<span class="hljs-string">&quot;create_user&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>创建新用户<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Permission</span>&gt;</span></span><br><span class="language-xml">      </span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Permission</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">requiredPermission</span>=<span class="hljs-string">&quot;delete_user&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-muted&quot;</span>&gt;</span>您无权删除用户<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>&#125;</span><br><span class="language-xml">      &gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">UserTable</span> <span class="hljs-attr">withActions</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Permission</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="面试高频问题解决方案"><a href="#面试高频问题解决方案" class="headerlink" title="面试高频问题解决方案"></a>面试高频问题解决方案</h3><p><strong>Q：路由切换时的权限验证</strong></p>
<p>问题：用户权限变更后，已打开页面的权限未更新</p>
<p>解决方案：事件总线通知 + 全局状态监听</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 权限变更事件</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">AuthEvents</span> = &#123;<br>  <span class="hljs-attr">PERMISSION_CHANGED</span>: <span class="hljs-string">&#x27;permission_changed&#x27;</span><br>&#125;;<br><br><span class="hljs-comment">// 在权限服务中</span><br>authService.<span class="hljs-property">onPermissionsChanged</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>  eventBus.<span class="hljs-title function_">emit</span>(<span class="hljs-title class_">AuthEvents</span>.<span class="hljs-property">PERMISSION_CHANGED</span>);<br>&#125;;<br><br><span class="hljs-comment">// 在路由守卫组件中</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">RouteGuard</span> = (<span class="hljs-params">&#123; children, roles &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [permissionsValid, setPermissionsValid] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handler</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>      <span class="hljs-title function_">setPermissionsValid</span>(<span class="hljs-title function_">checkPermissions</span>(roles));<br>    &#125;;<br>    <br>    eventBus.<span class="hljs-title function_">on</span>(<span class="hljs-title class_">AuthEvents</span>.<span class="hljs-property">PERMISSION_CHANGED</span>, handler);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> eventBus.<span class="hljs-title function_">off</span>(handler);<br>  &#125;, [roles]);<br>  <br>  <span class="hljs-keyword">if</span> (!permissionsValid) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navigate</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/unauthorized&quot;</span> <span class="hljs-attr">replace</span> /&gt;</span></span>;<br>  &#125;<br>  <br>  <span class="hljs-keyword">return</span> children;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>Q：按钮级权限的防抖控制</strong></p>
<p>问题：频繁点击权限按钮导致多次权限检查请求</p>
<p>解决方案：权限缓存 + 防抖机制</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">useCachedPermission</span> = (<span class="hljs-params">permission, ttl = <span class="hljs-number">5000</span></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [cache, setCache] = <span class="hljs-title function_">useState</span>(&#123;&#125;);<br>  <br>  <span class="hljs-keyword">const</span> check = <span class="hljs-title function_">useCallback</span>(<span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();<br>    <br>    <span class="hljs-keyword">if</span> (cache[permission] &amp;&amp; cache[permission].<span class="hljs-property">expires</span> &gt; now) &#123;<br>      <span class="hljs-keyword">return</span> cache[permission].<span class="hljs-property">result</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">checkPermission</span>(permission);<br>    <span class="hljs-title function_">setCache</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> (&#123;<br>      ...prev,<br>      [permission]: &#123; result, <span class="hljs-attr">expires</span>: now + ttl &#125;<br>    &#125;));<br>    <br>    <span class="hljs-keyword">return</span> result;<br>  &#125;, [permission, ttl, cache]);<br>  <br>  <span class="hljs-keyword">return</span> check;<br>&#125;;<br><br><span class="hljs-comment">// 使用示例</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">DeleteButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> checkDeletePermission = <span class="hljs-title function_">useCachedPermission</span>(<span class="hljs-string">&#x27;delete_item&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [disabled, setDisabled] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">checkDeletePermission</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">hasPermission</span> =&gt;</span> &#123;<br>      <span class="hljs-title function_">setDisabled</span>(!hasPermission);<br>    &#125;);<br>  &#125;, []);<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> </span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;disabled&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleDelete&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span></span><br><span class="language-xml">      删除</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Q：动态菜单权限控制</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 动态生成菜单</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">useAuthorizedMenu</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; user &#125; = <span class="hljs-title function_">useAuth</span>();<br>  <span class="hljs-keyword">const</span> [menuItems, setMenuItems] = <span class="hljs-title function_">useState</span>([]);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">loadMenu</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>      <span class="hljs-keyword">const</span> allItems = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">getMenuItems</span>();<br>      <br>      <span class="hljs-keyword">const</span> authorizedItems = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(<br>        allItems.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> item =&gt; &#123;<br>          <span class="hljs-keyword">if</span> (!item.<span class="hljs-property">permission</span>) <span class="hljs-keyword">return</span> item;<br>          <br>          <span class="hljs-keyword">const</span> hasPerm = <span class="hljs-keyword">await</span> permissionService.<span class="hljs-title function_">checkPermission</span>(<br>            item.<span class="hljs-property">permission</span><br>          );<br>          <span class="hljs-keyword">return</span> hasPerm ? item : <span class="hljs-literal">null</span>;<br>        &#125;)<br>      );<br>      <br>      <span class="hljs-title function_">setMenuItems</span>(authorizedItems.<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>));<br>    &#125;;<br>    <br>    <span class="hljs-title function_">loadMenu</span>();<br>  &#125;, [user]);<br>  <br>  <span class="hljs-keyword">return</span> menuItems;<br>&#125;;<br><br><span class="hljs-comment">// 菜单组件</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">AppSidebar</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> menuItems = <span class="hljs-title function_">useAuthorizedMenu</span>();<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">        &#123;menuItems.map(item =&gt; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.path&#125;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&#123;item.path&#125;</span>&gt;</span>&#123;item.title&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">        ))&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="安全增强措施"><a href="#安全增强措施" class="headerlink" title="安全增强措施"></a>安全增强措施</h3><p><strong>敏感数据保护</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 使用权限hook封装数据请求</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">useProtectedData</span> = (<span class="hljs-params">endpoint, requiredPermission</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> hasPermission = <span class="hljs-title function_">usePermission</span>(requiredPermission);<br>  <span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (hasPermission) &#123;<br>      <span class="hljs-title function_">fetch</span>(endpoint)<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())<br>        .<span class="hljs-title function_">then</span>(setData);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">setData</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// 清除已有数据</span><br>    &#125;<br>  &#125;, [hasPermission, endpoint]);<br>  <br>  <span class="hljs-keyword">return</span> hasPermission ? data : <span class="hljs-literal">null</span>;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>路由权限审计日志</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 在路由守卫中添加日志</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">RouteGuard</span> = (<span class="hljs-params">&#123; children, roles &#125;</span>) =&gt; &#123;<br>  <span class="hljs-comment">// ...权限检查逻辑</span><br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (isAuthenticated) &#123;<br>      auditService.<span class="hljs-title function_">logRouteAccess</span>(<br>        location.<span class="hljs-property">pathname</span>, <br>        user.<span class="hljs-property">id</span>,<br>        hasPermission ? <span class="hljs-string">&#x27;GRANTED&#x27;</span> : <span class="hljs-string">&#x27;DENIED&#x27;</span><br>      );<br>    &#125;<br>  &#125;, [location]);<br>  <br>  <span class="hljs-comment">// ...</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>权限变更强制刷新</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 监听权限变更</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePermissionChange</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-comment">// 显示刷新提示</span><br>    <span class="hljs-title function_">setShowRefresh</span>(<span class="hljs-literal">true</span>);<br>  &#125;;<br>  <br>  permissionService.<span class="hljs-title function_">onChange</span>(handlePermissionChange);<br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> permissionService.<span class="hljs-title function_">offChange</span>(handlePermissionChange);<br>&#125;, []);<br><br><span class="hljs-comment">// 在UI中显示提示</span><br>&#123;showRefresh &amp;&amp; (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;refresh-banner&quot;</span>&gt;</span></span><br><span class="language-xml">    您的权限已更新，请</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> window.location.reload()&#125;&gt;</span><br><span class="language-xml">      刷新页面</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    以应用更改</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>)&#125;<br></code></pre></td></tr></table></figure>

<h3 id="总结-5"><a href="#总结-5" class="headerlink" title="总结"></a>总结</h3><ul>
<li>核心模式：<ul>
<li>高阶组件(HOC)模式：适合类组件场景</li>
<li>包装器组件：函数组件推荐方案</li>
<li>路由元数据：React Router 6.4+最佳实践</li>
</ul>
</li>
<li>权限模型：<ul>
<li>RBAC：基于角色的权限控制（适合大多数场景）</li>
<li>ABAC：基于属性的动态权限控制（复杂系统适用）</li>
</ul>
</li>
<li>企业级方案：<ul>
<li>JWT认证集成</li>
<li>权限变更实时响应</li>
<li>动态菜单控制</li>
<li>审计日志追踪</li>
</ul>
</li>
<li>面试重点：<ul>
<li>路由级 vs 组件级权限控制</li>
<li>权限变更后的状态同步</li>
<li>按钮级权限的性能优化</li>
<li>动态菜单的实现方案</li>
</ul>
</li>
</ul>
<h2 id="6-4-数据请求方案（fetch、axios、React-Query、SWR）"><a href="#6-4-数据请求方案（fetch、axios、React-Query、SWR）" class="headerlink" title="6.4 数据请求方案（fetch、axios、React Query、SWR）"></a>6.4 数据请求方案（fetch、axios、React Query、SWR）</h2><h3 id="数据请求核心方案对比"><a href="#数据请求核心方案对比" class="headerlink" title="数据请求核心方案对比"></a>数据请求核心方案对比</h3><table>
<thead>
<tr>
<th align="left">方案</th>
<th align="left">特点</th>
<th align="left">适用场景</th>
<th align="left">包大小</th>
</tr>
</thead>
<tbody><tr>
<td align="left">原生 fetch</td>
<td align="left">浏览器原生 API，无需安装</td>
<td align="left">简单请求、现代浏览器项目	0kB</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Axios</td>
<td align="left">功能丰富、拦截器、自动转换 JSON</td>
<td align="left">企业级应用、复杂请求处理	4.8kB</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">React Query</td>
<td align="left">数据缓存、自动重试、请求管理</td>
<td align="left">复杂数据交互、实时应用	11.8kB</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">SWR</td>
<td align="left">轻量级、快速集成、智能缓存</td>
<td align="left">快速开发、中小型项目	3.5kB</td>
<td align="left"></td>
</tr>
</tbody></table>
<h3 id="基础请求方案深度解析"><a href="#基础请求方案深度解析" class="headerlink" title="基础请求方案深度解析"></a>基础请求方案深度解析</h3><p><strong>Fetch API</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 基础 GET 请求</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;https://api.example.com/data&#x27;</span>);<br>    <br>    <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP error! status: <span class="hljs-subst">$&#123;response.status&#125;</span>`</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();<br>    <span class="hljs-keyword">return</span> data;<br>  &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Fetch error:&#x27;</span>, error);<br>    <span class="hljs-keyword">throw</span> error;<br>  &#125;<br>&#125;;<br><br><span class="hljs-comment">// POST 请求示例</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">postData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">payload</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;https://api.example.com/data&#x27;</span>, &#123;<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>    <span class="hljs-attr">headers</span>: &#123;<br>      <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>,<br>      <span class="hljs-string">&#x27;Authorization&#x27;</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">$&#123;token&#125;</span>`</span><br>    &#125;,<br>    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(payload)<br>  &#125;);<br>  <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">json</span>();<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>核心特性：</p>
<ul>
<li>优点：浏览器原生支持、Promise 接口</li>
<li>缺点：无请求取消、无超时控制（需手动实现）</li>
<li>关键配置：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 超时控制</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchWithTimeout</span> = (<span class="hljs-params">url, options = &#123;&#125;, timeout = <span class="hljs-number">8000</span></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([<br>    <span class="hljs-title function_">fetch</span>(url, options),<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">_, reject</span>) =&gt;</span> <br>      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Request timeout&#x27;</span>)), timeout)<br>    )<br>  ]);<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>Axios 高级应用</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;axios&#x27;</span>;<br><br><span class="hljs-comment">// 创建实例</span><br><span class="hljs-keyword">const</span> api = axios.<span class="hljs-title function_">create</span>(&#123;<br>  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">&#x27;https://api.example.com&#x27;</span>,<br>  <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,<br>  <span class="hljs-attr">headers</span>: &#123;<span class="hljs-string">&#x27;X-Custom-Header&#x27;</span>: <span class="hljs-string">&#x27;value&#x27;</span>&#125;<br>&#125;);<br><br><span class="hljs-comment">// 请求拦截器</span><br>api.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> token = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;token&#x27;</span>);<br>  <span class="hljs-keyword">if</span> (token) &#123;<br>    config.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">$&#123;token&#125;</span>`</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> config;<br>&#125;, <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error));<br><br><span class="hljs-comment">// 响应拦截器</span><br>api.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<br>  <span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-property">data</span>,<br>  <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span>?.<span class="hljs-property">status</span> === <span class="hljs-number">401</span>) &#123;<br>      <span class="hljs-comment">// 处理未授权</span><br>      <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&#x27;/login&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);<br>  &#125;<br>);<br><br><span class="hljs-comment">// 取消令牌</span><br><span class="hljs-keyword">const</span> source = axios.<span class="hljs-property">CancelToken</span>.<span class="hljs-title function_">source</span>();<br>api.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/data&#x27;</span>, &#123; <span class="hljs-attr">cancelToken</span>: source.<span class="hljs-property">token</span> &#125;);<br>source.<span class="hljs-title function_">cancel</span>(<span class="hljs-string">&#x27;Operation canceled by user&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p>核心特性：</p>
<ul>
<li>自动转换 JSON 数据</li>
<li>客户端 XSRF 防护</li>
<li>并发请求支持 (axios.all)</li>
<li>上传进度监控</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">api.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/upload&#x27;</span>, formData, &#123;<br>  <span class="hljs-attr">onUploadProgress</span>: <span class="hljs-function"><span class="hljs-params">progressEvent</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> percent = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<br>      (progressEvent.<span class="hljs-property">loaded</span> * <span class="hljs-number">100</span>) / progressEvent.<span class="hljs-property">total</span><br>    );<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Upload progress: <span class="hljs-subst">$&#123;percent&#125;</span>%`</span>);<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="现代数据管理库深度解析"><a href="#现代数据管理库深度解析" class="headerlink" title="现代数据管理库深度解析"></a>现代数据管理库深度解析</h3><p><strong>React Query 核心概念</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; useQuery, useMutation, <span class="hljs-title class_">QueryClient</span>, <span class="hljs-title class_">QueryClientProvider</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-query&#x27;</span>;<br><br><span class="hljs-comment">// 创建查询客户端</span><br><span class="hljs-keyword">const</span> queryClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryClient</span>();<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">QueryClientProvider</span> <span class="hljs-attr">client</span>=<span class="hljs-string">&#123;queryClient&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">UserProfile</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">QueryClientProvider</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 查询示例</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; data, isLoading, isError, error &#125; = <span class="hljs-title function_">useQuery</span>(<br>    <span class="hljs-string">&#x27;userData&#x27;</span>, <br>    <span class="hljs-function">() =&gt;</span> api.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/users/123&#x27;</span>),<br>    &#123;<br>      <span class="hljs-attr">staleTime</span>: <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 5分钟保鲜期</span><br>      <span class="hljs-attr">retry</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// 失败重试次数</span><br>      <span class="hljs-attr">refetchOnWindowFocus</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 窗口聚焦时重新获取</span><br>    &#125;<br>  );<br><br>  <span class="hljs-comment">// 突变示例</span><br>  <span class="hljs-keyword">const</span> updateUser = <span class="hljs-title function_">useMutation</span>(<br>    <span class="hljs-function">(<span class="hljs-params">newData</span>) =&gt;</span> api.<span class="hljs-title function_">put</span>(<span class="hljs-string">&#x27;/users/123&#x27;</span>, newData),<br>    &#123;<br>      <span class="hljs-attr">onSuccess</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-comment">// 更新成功后重新获取用户数据</span><br>        queryClient.<span class="hljs-title function_">invalidateQueries</span>(<span class="hljs-string">&#x27;userData&#x27;</span>);<br>      &#125;,<br>      <span class="hljs-attr">onError</span>: <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>        toast.<span class="hljs-title function_">error</span>(<span class="hljs-string">`更新失败: <span class="hljs-subst">$&#123;error.message&#125;</span>`</span>);<br>      &#125;<br>    &#125;<br>  );<br><br>  <span class="hljs-keyword">if</span> (isLoading) <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Spinner</span> /&gt;</span></span>;<br>  <span class="hljs-keyword">if</span> (isError) <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Error</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&#123;error.message&#125;</span> /&gt;</span></span>;<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;data.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> updateUser.mutate(&#123; name: &#x27;新名字&#x27; &#125;)&#125;&gt;</span><br><span class="language-xml">        更新用户</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p>核心特性：</p>
<ul>
<li>智能缓存：自动管理请求缓存</li>
<li>后台刷新：数据过期时在后台更新</li>
<li>分页查询：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> &#123; data, fetchNextPage &#125; = <span class="hljs-title function_">useInfiniteQuery</span>(<br>  <span class="hljs-string">&#x27;projects&#x27;</span>,<br>  <span class="hljs-function">(<span class="hljs-params">&#123; pageParam = <span class="hljs-number">1</span> &#125;</span>) =&gt;</span> api.<span class="hljs-title function_">get</span>(<span class="hljs-string">`/projects?page=<span class="hljs-subst">$&#123;pageParam&#125;</span>`</span>),<br>  &#123;<br>    <span class="hljs-attr">getNextPageParam</span>: <span class="hljs-function">(<span class="hljs-params">lastPage</span>) =&gt;</span> lastPage.<span class="hljs-property">nextPage</span><br>  &#125;<br>);<br></code></pre></td></tr></table></figure>

<p><strong>SWR 核心应用</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> useSWR <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;swr&#x27;</span>;<br><br><span class="hljs-comment">// 自定义 fetcher</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">fetcher</span> = (<span class="hljs-params">...args</span>) =&gt; <span class="hljs-title function_">fetch</span>(...args).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>());<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; data, error, mutate &#125; = <span class="hljs-title function_">useSWR</span>(<br>    <span class="hljs-string">&#x27;/api/user/123&#x27;</span>, <br>    fetcher,<br>    &#123;<br>      <span class="hljs-attr">revalidateOnFocus</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-attr">refreshInterval</span>: <span class="hljs-number">60000</span>, <span class="hljs-comment">// 60秒刷新一次</span><br>      <span class="hljs-attr">onErrorRetry</span>: <span class="hljs-function">(<span class="hljs-params">error, key, config, revalidate, &#123; retryCount &#125;</span>) =&gt;</span> &#123;<br>        <span class="hljs-comment">// 404错误不重试</span><br>        <span class="hljs-keyword">if</span> (error.<span class="hljs-property">status</span> === <span class="hljs-number">404</span>) <span class="hljs-keyword">return</span>;<br>        <span class="hljs-comment">// 10秒后重试</span><br>        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">revalidate</span>(&#123; retryCount &#125;), <span class="hljs-number">10000</span>);<br>      &#125;<br>    &#125;<br>  );<br><br>  <span class="hljs-comment">// 乐观更新</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateName</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">newName</span>) =&gt; &#123;<br>    <span class="hljs-comment">// 立即更新本地数据</span><br>    <span class="hljs-title function_">mutate</span>(&#123; ...data, <span class="hljs-attr">name</span>: newName &#125;, <span class="hljs-literal">false</span>);<br>    <br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">patch</span>(<span class="hljs-string">&#x27;/api/user/123&#x27;</span>, &#123; <span class="hljs-attr">name</span>: newName &#125;);<br>      <span class="hljs-comment">// 重新验证确保数据最新</span><br>      <span class="hljs-title function_">mutate</span>();<br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>      <span class="hljs-comment">// 出错时回滚</span><br>      <span class="hljs-title function_">mutate</span>(data, <span class="hljs-literal">false</span>);<br>    &#125;<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      &#123;data ? <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;data.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span> : &#x27;Loading...&#x27;&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> updateName(&#x27;New Name&#x27;)&#125;&gt;</span><br><span class="language-xml">        更新名字</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p>核心特性：</p>
<ul>
<li>请求去重：自动避免重复请求</li>
<li>依赖请求：基于数据依赖的请求链</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> &#123; <span class="hljs-attr">data</span>: user &#125; = <span class="hljs-title function_">useSWR</span>(<span class="hljs-string">&#x27;/api/user/123&#x27;</span>, fetcher);<br><span class="hljs-keyword">const</span> &#123; <span class="hljs-attr">data</span>: projects &#125; = <span class="hljs-title function_">useSWR</span>(<br>  <span class="hljs-function">() =&gt;</span> <span class="hljs-string">`/api/projects?userId=<span class="hljs-subst">$&#123;user.id&#125;</span>`</span>, <br>  fetcher<br>);<br></code></pre></td></tr></table></figure>

<ul>
<li>SSR 支持：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getServerSideProps</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetcher</span>(<span class="hljs-string">&#x27;/api/user/123&#x27;</span>);<br>  <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">props</span>: &#123; <span class="hljs-attr">fallback</span>: &#123; <span class="hljs-string">&#x27;/api/user/123&#x27;</span>: user &#125; &#125; &#125;;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params">&#123; fallback &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SWRConfig</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">fallback</span> &#125;&#125;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Profile</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">SWRConfig</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="高级数据管理策略"><a href="#高级数据管理策略" class="headerlink" title="高级数据管理策略"></a>高级数据管理策略</h3><p><strong>请求状态统一管理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 封装 useApi 钩子</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">useApi</span> = (<span class="hljs-params">key, fn, options = &#123;&#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [status, setStatus] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;idle&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> [error, setError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <br>  <span class="hljs-keyword">const</span> execute = <span class="hljs-title function_">useCallback</span>(<span class="hljs-title function_">async</span> (params) =&gt; &#123;<br>    <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">&#x27;pending&#x27;</span>);<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fn</span>(params);<br>      <span class="hljs-title function_">setData</span>(result);<br>      <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">&#x27;success&#x27;</span>);<br>      <span class="hljs-keyword">return</span> result;<br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>      <span class="hljs-title function_">setError</span>(err);<br>      <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">&#x27;error&#x27;</span>);<br>      <span class="hljs-keyword">throw</span> err;<br>    &#125;<br>  &#125;, [fn]);<br><br>  <span class="hljs-keyword">return</span> &#123;<br>    status,  <span class="hljs-comment">// &#x27;idle&#x27; | &#x27;pending&#x27; | &#x27;success&#x27; | &#x27;error&#x27;</span><br>    data,<br>    error,<br>    execute,<br>    <span class="hljs-attr">isLoading</span>: status === <span class="hljs-string">&#x27;pending&#x27;</span>,<br>    <span class="hljs-attr">isError</span>: status === <span class="hljs-string">&#x27;error&#x27;</span><br>  &#125;;<br>&#125;;<br><br><span class="hljs-comment">// 使用示例</span><br><span class="hljs-keyword">const</span> &#123; data, status, <span class="hljs-attr">execute</span>: fetchUser &#125; = <span class="hljs-title function_">useApi</span>(<br>  <span class="hljs-string">&#x27;userData&#x27;</span>,<br>  <span class="hljs-function">(<span class="hljs-params">userId</span>) =&gt;</span> api.<span class="hljs-title function_">get</span>(<span class="hljs-string">`/users/<span class="hljs-subst">$&#123;userId&#125;</span>`</span>)<br>);<br></code></pre></td></tr></table></figure>

<p><strong>数据缓存策略</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 使用 React Query 的缓存工具</span><br><span class="hljs-keyword">const</span> queryClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryClient</span>(&#123;<br>  <span class="hljs-attr">defaultOptions</span>: &#123;<br>    <span class="hljs-attr">queries</span>: &#123;<br>      <span class="hljs-attr">cacheTime</span>: <span class="hljs-number">15</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 15分钟缓存</span><br>      <span class="hljs-attr">staleTime</span>: <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,  <span class="hljs-comment">// 5分钟保鲜</span><br>    &#125;<br>  &#125;<br>&#125;);<br><br><span class="hljs-comment">// 手动管理缓存</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">updateCache</span> = (<span class="hljs-params">newUser</span>) =&gt; &#123;<br>  queryClient.<span class="hljs-title function_">setQueryData</span>([<span class="hljs-string">&#x27;user&#x27;</span>, newUser.<span class="hljs-property">id</span>], newUser);<br>  <br>  <span class="hljs-comment">// 更新列表缓存</span><br>  queryClient.<span class="hljs-title function_">setQueryData</span>([<span class="hljs-string">&#x27;users&#x27;</span>], <span class="hljs-function">(<span class="hljs-params">old</span>) =&gt;</span> <br>    old.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">id</span> === newUser.<span class="hljs-property">id</span> ? newUser : user)<br>  );<br>&#125;;<br><br><span class="hljs-comment">// SWR 全局配置</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SWRConfig</span> </span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">provider:</span> () =&gt;</span> new Map(),</span><br><span class="language-xml">    isOnline() &#123;</span><br><span class="language-xml">      // 自定义网络状态检测</span><br><span class="language-xml">      return navigator.onLine;</span><br><span class="language-xml">    &#125;</span><br><span class="language-xml">  &#125;&#125;</span><br><span class="language-xml">&gt;</span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">SWRConfig</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<h3 id="面试高频问题解决方案-1"><a href="#面试高频问题解决方案-1" class="headerlink" title="面试高频问题解决方案"></a>面试高频问题解决方案</h3><p><strong>请求竞态问题（Race Condition）</strong></p>
<p>问题：快速切换参数导致旧请求覆盖新响应</p>
<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params">&#123; userId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> [error, setError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> isActive = <span class="hljs-literal">true</span>;<br>    <span class="hljs-title function_">setData</span>(<span class="hljs-literal">null</span>);<br>    <br>    api.<span class="hljs-title function_">get</span>(<span class="hljs-string">`/users/<span class="hljs-subst">$&#123;userId&#125;</span>`</span>)<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (isActive) <span class="hljs-title function_">setData</span>(res.<span class="hljs-property">data</span>);<br>      &#125;)<br>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (isActive) <span class="hljs-title function_">setError</span>(err);<br>      &#125;);<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123; isActive = <span class="hljs-literal">false</span>; &#125;;<br>  &#125;, [userId]);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>请求重试策略</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// React Query 指数退避重试</span><br><span class="hljs-title function_">useQuery</span>(<span class="hljs-string">&#x27;todos&#x27;</span>, fetchTodos, &#123;<br>  <span class="hljs-attr">retry</span>: <span class="hljs-number">3</span>,<br>  <span class="hljs-attr">retryDelay</span>: <span class="hljs-function">(<span class="hljs-params">attemptIndex</span>) =&gt;</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">1000</span> * <span class="hljs-number">2</span> ** attemptIndex, <span class="hljs-number">30000</span>)<br>&#125;);<br><br><span class="hljs-comment">// Axios 拦截器重试</span><br>api.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<span class="hljs-literal">null</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> config = error.<span class="hljs-property">config</span>;<br>  <span class="hljs-keyword">if</span> (!config || !config.<span class="hljs-property">retry</span>) <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);<br>  <br>  config.<span class="hljs-property">retryCount</span> = config.<span class="hljs-property">retryCount</span> || <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> (config.<span class="hljs-property">retryCount</span> &gt;= config.<span class="hljs-property">retry</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);<br>  &#125;<br>  <br>  config.<span class="hljs-property">retryCount</span> += <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">api</span>(config)), config.<span class="hljs-property">retryDelay</span> || <span class="hljs-number">1000</span>)<br>  );<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>大数据量分页优化</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// React Query 无限加载</span><br><span class="hljs-keyword">const</span> &#123; data, fetchNextPage, hasNextPage &#125; = <span class="hljs-title function_">useInfiniteQuery</span>(<br>  <span class="hljs-string">&#x27;projects&#x27;</span>,<br>  <span class="hljs-function">(<span class="hljs-params">&#123; pageParam = <span class="hljs-number">0</span> &#125;</span>) =&gt;</span> api.<span class="hljs-title function_">get</span>(<span class="hljs-string">`/projects?offset=<span class="hljs-subst">$&#123;pageParam&#125;</span>&amp;limit=20`</span>),<br>  &#123;<br>    <span class="hljs-attr">getNextPageParam</span>: <span class="hljs-function">(<span class="hljs-params">lastPage</span>) =&gt;</span> <br>      lastPage.<span class="hljs-property">hasMore</span> ? lastPage.<span class="hljs-property">nextOffset</span> : <span class="hljs-literal">undefined</span><br>  &#125;<br>);<br><br><span class="hljs-comment">// 虚拟列表渲染</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">FixedSizeList</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-window&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProjectList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">FixedSizeList</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">height</span>=<span class="hljs-string">&#123;600&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">itemCount</span>=<span class="hljs-string">&#123;data?.pages.flat().length</span> || <span class="hljs-attr">0</span>&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">itemSize</span>=<span class="hljs-string">&#123;100&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;100%&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span></span><br><span class="language-xml">      &#123;(&#123; index, style &#125;) =&gt; &#123;</span><br><span class="language-xml">        const item = data.pages.flat()[index];</span><br><span class="language-xml">        return (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;style&#125;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">ProjectItem</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;item&#125;</span> /&gt;</span></span><br><span class="language-xml">            &#123;index === data.pages.flat().length - 1 &amp;&amp; hasNextPage &amp;&amp; (</span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;fetchNextPage&#125;</span>&gt;</span>加载更多<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">            )&#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        );</span><br><span class="language-xml">      &#125;&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">FixedSizeList</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>请求取消与垃圾回收</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// AbortController 取消请求</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url, &#123;<br>        <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span><br>      &#125;);<br>      <span class="hljs-comment">// 处理响应</span><br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>      <span class="hljs-keyword">if</span> (err.<span class="hljs-property">name</span> === <span class="hljs-string">&#x27;AbortError&#x27;</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Request aborted&#x27;</span>);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// 处理其他错误</span><br>      &#125;<br>    &#125;<br>  &#125;;<br>  <br>  <span class="hljs-title function_">fetchData</span>();<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> controller.<span class="hljs-title function_">abort</span>();<br>&#125;, [url]);<br><br><span class="hljs-comment">// React Query 自动垃圾回收</span><br><span class="hljs-keyword">const</span> queryClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryClient</span>(&#123;<br>  <span class="hljs-attr">defaultOptions</span>: &#123;<br>    <span class="hljs-attr">queries</span>: &#123;<br>      <span class="hljs-attr">gcTime</span>: <span class="hljs-number">10</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span> <span class="hljs-comment">// 10分钟后清理缓存</span><br>    &#125;<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="性能优化实践"><a href="#性能优化实践" class="headerlink" title="性能优化实践"></a>性能优化实践</h3><p><strong>请求合并与批处理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// GraphQL 请求合并</span><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">GET_USERS</span> = gql`<span class="language-graphql"></span><br><span class="language-graphql">  <span class="hljs-keyword">query</span> GetUsers<span class="hljs-punctuation">(</span><span class="hljs-variable">$ids</span>: <span class="hljs-punctuation">[</span>ID<span class="hljs-punctuation">!</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">!</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">&#123;</span></span><br><span class="language-graphql">    users<span class="hljs-punctuation">(</span><span class="hljs-symbol">ids</span><span class="hljs-punctuation">:</span> <span class="hljs-variable">$ids</span>) <span class="hljs-punctuation">&#123;</span></span><br><span class="language-graphql">      id</span><br><span class="language-graphql">      name</span><br><span class="language-graphql">      email</span><br><span class="language-graphql">    <span class="hljs-punctuation">&#125;</span></span><br><span class="language-graphql">  <span class="hljs-punctuation">&#125;</span></span><br><span class="language-graphql">`</span>;<br><br><span class="hljs-comment">// REST API 批处理中间件</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/api/batch&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> requests = req.<span class="hljs-property">body</span>;<br>  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(requests.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">&#123; url, method, body &#125;</span>) =&gt;</span> <br>    <span class="hljs-title function_">handleRequest</span>(url, method, body)<br>  )).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> res.<span class="hljs-title function_">json</span>(results));<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>数据预取策略</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// React Router v6.4+ 数据预取</span><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createBrowserRouter</span>([<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/user/:id&quot;</span>,<br>    <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserProfile</span> /&gt;</span></span>,<br>    <span class="hljs-attr">loader</span>: <span class="hljs-title function_">async</span> (&#123; params &#125;) =&gt; &#123;<br>      <span class="hljs-keyword">return</span> queryClient.<span class="hljs-title function_">fetchQuery</span>(<br>        [<span class="hljs-string">&#x27;user&#x27;</span>, params.<span class="hljs-property">id</span>],<br>        <span class="hljs-function">() =&gt;</span> api.<span class="hljs-title function_">get</span>(<span class="hljs-string">`/users/<span class="hljs-subst">$&#123;params.id&#125;</span>`</span>)<br>      );<br>    &#125;<br>  &#125;<br>]);<br><br><span class="hljs-comment">// 用户悬停预取</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> </span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/user/123&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">onMouseEnter</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> queryClient.prefetchQuery(</span><br><span class="language-xml">    [&#x27;user&#x27;, 123],</span><br><span class="language-xml">    () =&gt; api.get(&#x27;/users/123&#x27;)</span><br><span class="language-xml">  )&#125;</span><br><span class="language-xml">&gt;</span><br><span class="language-xml">  用户资料</span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p><strong>离线数据策略</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 使用 IndexedDB 缓存数据</span><br><span class="hljs-keyword">const</span> &#123; data &#125; = <span class="hljs-title function_">useSWR</span>(<span class="hljs-string">&#x27;/api/data&#x27;</span>, fetcher, &#123;<br>  <span class="hljs-attr">onSuccess</span>: <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// 保存到 IndexedDB</span><br>    idb.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;cachedData&#x27;</span>, data);<br>  &#125;,<br>  <span class="hljs-attr">fallbackData</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">// 从 IndexedDB 获取缓存</span><br>    <span class="hljs-keyword">return</span> idb.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;cachedData&#x27;</span>);<br>  &#125;<br>&#125;);<br><br><span class="hljs-comment">// React Query 离线恢复</span><br><span class="hljs-keyword">const</span> queryClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryClient</span>(&#123;<br>  <span class="hljs-attr">defaultOptions</span>: &#123;<br>    <span class="hljs-attr">queries</span>: &#123;<br>      <span class="hljs-attr">networkMode</span>: <span class="hljs-string">&#x27;offlineFirst&#x27;</span>,<br>      <span class="hljs-attr">cacheTime</span>: <span class="hljs-title class_">Infinity</span> <span class="hljs-comment">// 持久化缓存</span><br>    &#125;<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="总结-6"><a href="#总结-6" class="headerlink" title="总结"></a>总结</h3><ul>
<li>基础方案选择：<ul>
<li>简单场景：优先使用 fetch</li>
<li>企业应用：推荐 axios 作为 HTTP 客户端</li>
</ul>
</li>
<li>现代数据管理：<ul>
<li>复杂应用：选择 React Query（功能全面）</li>
<li>轻量项目：选择 SWR（快速集成）</li>
</ul>
</li>
<li>关键能力：<ul>
<li>智能缓存管理</li>
<li>自动请求重试</li>
<li>乐观更新实现</li>
<li>分页&#x2F;无限加载</li>
</ul>
</li>
<li>性能优化：<ul>
<li>请求批处理</li>
<li>数据预取</li>
<li>离线缓存策略</li>
<li>虚拟列表渲染</li>
</ul>
</li>
<li>面试重点：<ul>
<li>请求竞态解决方案</li>
<li>缓存策略设计</li>
<li>错误处理与重试机制</li>
<li>大型数据分页优化</li>
</ul>
</li>
</ul>
<h2 id="6-5-SSR-与-Next-js-基础"><a href="#6-5-SSR-与-Next-js-基础" class="headerlink" title="6.5 SSR 与 Next.js 基础"></a>6.5 SSR 与 Next.js 基础</h2><h3 id="SSR-核心概念"><a href="#SSR-核心概念" class="headerlink" title="SSR 核心概念"></a>SSR 核心概念</h3><p><strong>渲染模式对比</strong></p>
<table>
<thead>
<tr>
<th align="left">渲染方式</th>
<th align="left">特点</th>
<th align="left">SEO</th>
<th align="left">首屏时间</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">客户端渲染 (CSR)</td>
<td align="left">浏览器下载 JS 后渲染</td>
<td align="left">差</td>
<td align="left">慢</td>
<td align="left">后台系统、Dashboard</td>
</tr>
<tr>
<td align="left">服务器端渲染 (SSR)</td>
<td align="left">服务器生成完整 HTML</td>
<td align="left">优</td>
<td align="left">快</td>
<td align="left">内容网站、电商</td>
</tr>
<tr>
<td align="left">静态站点生成 (SSG)</td>
<td align="left">构建时生成 HTML</td>
<td align="left">优</td>
<td align="left">极快</td>
<td align="left">博客、文档站</td>
</tr>
<tr>
<td align="left">增量静态再生 (ISR)</td>
<td align="left">按需重新生成页面</td>
<td align="left">优</td>
<td align="left">快</td>
<td align="left">动态内容站点</td>
</tr>
</tbody></table>
<p><strong>SSR 核心优势</strong></p>
<ul>
<li>SEO 优化：搜索引擎可直接抓取完整 HTML 内容</li>
<li>性能提升：减少首屏内容可见时间（FCP）</li>
<li>社交分享优化：社交媒体爬虫获取完整页面内容</li>
<li>低端设备支持：服务器处理渲染工作，降低客户端压力</li>
</ul>
<h3 id="Next-js-核心架构"><a href="#Next-js-核心架构" class="headerlink" title="Next.js 核心架构"></a>Next.js 核心架构</h3><p><strong>Next.js 核心特性</strong></p>
<pre class="mermaid">graph TD
    A[Next.js] --> B[路由系统]
    A --> C[渲染策略]
    A --> D[数据获取]
    A --> E[API 路由]
    A --> F[优化功能]
    
    B --> B1[文件系统路由]
    B --> B2[动态路由]
    B --> B3[嵌套路由]
    
    C --> C1[SSG 静态生成]
    C --> C2[SSR 服务器渲染]
    C --> C3[ISR 增量再生]
    
    D --> D1[getStaticProps]
    D --> D2[getServerSideProps]
    D --> D3[getStaticPaths]
    
    E --> E1[无服务器 API]
    E --> E2[中间件支持]
    
    F --> F1[Image 优化]
    F --> F2[字体优化]
    F --> F3[脚本优化]</pre>

<p><strong>文件系统路由</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">pages/<br>├── index.js          <span class="hljs-comment"># / 根路由</span><br>├── about.js          <span class="hljs-comment"># /about</span><br>├── blog/<br>│   ├── index.js      <span class="hljs-comment"># /blog</span><br>│   ├── [slug].js     <span class="hljs-comment"># /blog/:slug 动态路由</span><br>│   └── categories/<br>│       └── [<span class="hljs-built_in">id</span>].js   <span class="hljs-comment"># /blog/categories/:id 嵌套路由</span><br>└── api/<br>    └── user.js       <span class="hljs-comment"># /api/user API 路由</span><br></code></pre></td></tr></table></figure>

<h3 id="数据获取策略"><a href="#数据获取策略" class="headerlink" title="数据获取策略"></a>数据获取策略</h3><p><strong>静态生成 (SSG)</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 页面组件</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Blog</span>(<span class="hljs-params">&#123; posts &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">      &#123;posts.map(post =&gt; (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;post.id&#125;</span>&gt;</span>&#123;post.title&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">      ))&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 构建时获取数据</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getStaticProps</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;https://api.example.com/posts&#x27;</span>);<br>  <span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();<br>  <br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">props</span>: &#123; posts &#125;,<br>    <span class="hljs-attr">revalidate</span>: <span class="hljs-number">60</span> <span class="hljs-comment">// 启用 ISR，60秒后重新生成</span><br>  &#125;;<br>&#125;<br><br><span class="hljs-comment">// 动态路由路径生成</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getStaticPaths</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;https://api.example.com/posts&#x27;</span>);<br>  <span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();<br>  <br>  <span class="hljs-keyword">const</span> paths = posts.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">post</span> =&gt;</span> (&#123;<br>    <span class="hljs-attr">params</span>: &#123; <span class="hljs-attr">slug</span>: post.<span class="hljs-property">slug</span> &#125;<br>  &#125;));<br>  <br>  <span class="hljs-keyword">return</span> &#123;<br>    paths,<br>    <span class="hljs-attr">fallback</span>: <span class="hljs-string">&#x27;blocking&#x27;</span> <span class="hljs-comment">// 处理未预生成的路径</span><br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>服务器端渲染 (SSR)</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params">&#123; user &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;user.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;user.bio&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// 每次请求时获取数据</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getServerSideProps</span>(<span class="hljs-params">context</span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; req, res, params, query &#125; = context;<br>  <br>  <span class="hljs-comment">// 基于 cookie 认证</span><br>  <span class="hljs-keyword">const</span> token = req.<span class="hljs-property">cookies</span>.<span class="hljs-property">authToken</span>;<br>  <br>  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://api.example.com/users/<span class="hljs-subst">$&#123;params.id&#125;</span>`</span>, &#123;<br>    <span class="hljs-attr">headers</span>: &#123; <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">$&#123;token&#125;</span>`</span> &#125;<br>  &#125;);<br>  <br>  <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">redirect</span>: &#123;<br>        <span class="hljs-attr">destination</span>: <span class="hljs-string">&#x27;/login&#x27;</span>,<br>        <span class="hljs-attr">permanent</span>: <span class="hljs-literal">false</span><br>      &#125;<br>    &#125;;<br>  &#125;<br>  <br>  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();<br>  <br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">props</span>: &#123; user &#125;<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="高级渲染策略"><a href="#高级渲染策略" class="headerlink" title="高级渲染策略"></a>高级渲染策略</h3><p><strong>增量静态再生 (ISR)</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getStaticProps</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;https://api.example.com/products&#x27;</span>);<br>  <span class="hljs-keyword">const</span> products = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();<br>  <br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">props</span>: &#123; products &#125;,<br>    <span class="hljs-attr">revalidate</span>: <span class="hljs-number">30</span>, <span class="hljs-comment">// 最多每30秒重新生成一次</span><br>  &#125;;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getStaticPaths</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">paths</span>: [<br>      &#123; <span class="hljs-attr">params</span>: &#123; <span class="hljs-attr">category</span>: <span class="hljs-string">&#x27;electronics&#x27;</span> &#125; &#125;<br>    ],<br>    <span class="hljs-attr">fallback</span>: <span class="hljs-string">&#x27;blocking&#x27;</span> <span class="hljs-comment">// 其他类别按需生成</span><br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>按需再验证 (On-demand Revalidation)</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// pages/api/revalidate.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handler</span>(<span class="hljs-params">req, res</span>) &#123;<br>  <span class="hljs-comment">// 检查密钥</span><br>  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">query</span>.<span class="hljs-property">secret</span> !== process.<span class="hljs-property">env</span>.<span class="hljs-property">REVALIDATE_SECRET</span>) &#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;Invalid token&#x27;</span> &#125;);<br>  &#125;<br>  <br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">// 重新验证特定路径</span><br>    <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">revalidate</span>(<span class="hljs-string">&#x27;/blog/&#x27;</span> + req.<span class="hljs-property">query</span>.<span class="hljs-property">slug</span>);<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">revalidated</span>: <span class="hljs-literal">true</span> &#125;);<br>  &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Error revalidating&#x27;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 内容更新后调用</span><br><span class="hljs-comment">// POST /api/revalidate?secret=&lt;token&gt;&amp;slug=new-post</span><br></code></pre></td></tr></table></figure>

<h3 id="Next-js-高级特性"><a href="#Next-js-高级特性" class="headerlink" title="Next.js 高级特性"></a>Next.js 高级特性</h3><p><strong>中间件</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// middleware.js</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">NextResponse</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;next/server&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">middleware</span>(<span class="hljs-params">request</span>) &#123;<br>  <span class="hljs-comment">// 重定向旧路径</span><br>  <span class="hljs-keyword">if</span> (request.<span class="hljs-property">nextUrl</span>.<span class="hljs-property">pathname</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;/old-blog&#x27;</span>)) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">redirect</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;/blog&#x27;</span>, request.<span class="hljs-property">url</span>));<br>  &#125;<br>  <br>  <span class="hljs-comment">// 路径重写</span><br>  <span class="hljs-keyword">if</span> (request.<span class="hljs-property">nextUrl</span>.<span class="hljs-property">pathname</span> === <span class="hljs-string">&#x27;/dashboard&#x27;</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">rewrite</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;/internal-dashboard&#x27;</span>, request.<span class="hljs-property">url</span>));<br>  &#125;<br>  <br>  <span class="hljs-comment">// 身份验证检查</span><br>  <span class="hljs-keyword">const</span> token = request.<span class="hljs-property">cookies</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;authToken&#x27;</span>);<br>  <span class="hljs-keyword">if</span> (!token &amp;&amp; request.<span class="hljs-property">nextUrl</span>.<span class="hljs-property">pathname</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;/protected&#x27;</span>)) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">redirect</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">&#x27;/login&#x27;</span>, request.<span class="hljs-property">url</span>));<br>  &#125;<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">next</span>();<br>&#125;<br><br><span class="hljs-comment">// 配置匹配路径</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = &#123;<br>  <span class="hljs-attr">matcher</span>: [<span class="hljs-string">&#x27;/dashboard/:path*&#x27;</span>, <span class="hljs-string">&#x27;/protected/:path*&#x27;</span>, <span class="hljs-string">&#x27;/old-blog/:path*&#x27;</span>]<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>图像优化</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Image</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;next/image&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductImage</span>(<span class="hljs-params">&#123; src, alt &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Image</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;src&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">alt</span>=<span class="hljs-string">&#123;alt&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">width</span>=<span class="hljs-string">&#123;800&#125;</span>  // <span class="hljs-attr">最大显示宽度</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">height</span>=<span class="hljs-string">&#123;600&#125;</span> // <span class="hljs-attr">最大显示高度</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;blur&quot;</span> // <span class="hljs-attr">加载占位符</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">blurDataURL</span>=<span class="hljs-string">&quot;data:image/svg+xml;base64,...&quot;</span> // <span class="hljs-attr">低质量占位图</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">quality</span>=<span class="hljs-string">&#123;85&#125;</span> // <span class="hljs-attr">图像质量</span> (<span class="hljs-attr">1-100</span>)</span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">priority</span> // <span class="hljs-attr">关键图像优先加载</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">sizes</span>=<span class="hljs-string">&quot;(max-width: 768px) 100vw, 50vw&quot;</span> // <span class="hljs-attr">响应式尺寸</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>API 路由</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// pages/api/user/[id].js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handler</span>(<span class="hljs-params">req, res</span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; id &#125; = req.<span class="hljs-property">query</span>;<br>  <br>  <span class="hljs-keyword">switch</span> (req.<span class="hljs-property">method</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;GET&#x27;</span>:<br>      <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> db.<span class="hljs-property">user</span>.<span class="hljs-title function_">findUnique</span>(&#123; <span class="hljs-attr">where</span>: &#123; id &#125; &#125;);<br>      <span class="hljs-keyword">if</span> (!user) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;User not found&#x27;</span> &#125;);<br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">json</span>(user);<br>    <br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;PUT&#x27;</span>:<br>      <span class="hljs-keyword">const</span> updatedUser = <span class="hljs-keyword">await</span> db.<span class="hljs-property">user</span>.<span class="hljs-title function_">update</span>(&#123;<br>        <span class="hljs-attr">where</span>: &#123; id &#125;,<br>        <span class="hljs-attr">data</span>: req.<span class="hljs-property">body</span><br>      &#125;);<br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">json</span>(updatedUser);<br>    <br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;DELETE&#x27;</span>:<br>      <span class="hljs-keyword">await</span> db.<span class="hljs-property">user</span>.<span class="hljs-title function_">delete</span>(&#123; <span class="hljs-attr">where</span>: &#123; id &#125; &#125;);<br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">204</span>).<span class="hljs-title function_">end</span>();<br>    <br>    <span class="hljs-attr">default</span>:<br>      res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&#x27;Allow&#x27;</span>, [<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;PUT&#x27;</span>, <span class="hljs-string">&#x27;DELETE&#x27;</span>]);<br>      <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">405</span>).<span class="hljs-title function_">end</span>(<span class="hljs-string">`Method <span class="hljs-subst">$&#123;req.method&#125;</span> Not Allowed`</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="性能优化实践-1"><a href="#性能优化实践-1" class="headerlink" title="性能优化实践"></a>性能优化实践</h3><p><strong>代码分割与动态导入</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> dynamic <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;next/dynamic&#x27;</span>;<br><br><span class="hljs-comment">// 动态加载重组件（禁用 SSR）</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">HeavyChart</span> = <span class="hljs-title function_">dynamic</span>(<br>  <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;../components/HeavyChart&#x27;</span>),<br>  &#123; <span class="hljs-attr">ssr</span>: <span class="hljs-literal">false</span> &#125;<br>);<br><br><span class="hljs-comment">// 带加载状态</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">MapComponent</span> = <span class="hljs-title function_">dynamic</span>(<br>  <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;../components/Map&#x27;</span>),<br>  &#123; <br>    <span class="hljs-attr">loading</span>: <span class="hljs-function">() =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Loading map...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,<br>    <span class="hljs-attr">ssr</span>: <span class="hljs-literal">false</span><br>  &#125;<br>);<br><br><span class="hljs-comment">// 预加载关键组件</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;../components/CriticalComponent&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">module</span> =&gt;</span> &#123;<br>    <span class="hljs-comment">// 组件已加载</span><br>  &#125;);<br>&#125;, []);<br></code></pre></td></tr></table></figure>

<p><strong>字体优化</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// _document.js</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Document</span>, &#123; <span class="hljs-title class_">Html</span>, <span class="hljs-title class_">Head</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;next/document&#x27;</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDocument</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Document</span> &#123;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Html</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Head</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">link</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;preload&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/fonts/Inter.woff2&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">as</span>=<span class="hljs-string">&quot;font&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;font/woff2&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">crossOrigin</span>=<span class="hljs-string">&quot;anonymous&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Head</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Main</span> /&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">NextScript</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Html</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 全局 CSS 中使用</span><br>@font-face &#123;<br>  font-<span class="hljs-attr">family</span>: <span class="hljs-string">&#x27;Inter&#x27;</span>;<br>  <span class="hljs-attr">src</span>: <span class="hljs-title function_">url</span>(<span class="hljs-string">&#x27;/fonts/Inter.woff2&#x27;</span>) <span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;woff2&#x27;</span>);<br>  font-<span class="hljs-attr">weight</span>: <span class="hljs-number">100</span> <span class="hljs-number">900</span>;<br>  font-<span class="hljs-attr">display</span>: swap;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>分析工具集成</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// next.config.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">experimental</span>: &#123;<br>    <span class="hljs-attr">instrumentationHook</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>&#125;;<br><br><span class="hljs-comment">// instrumentation.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">register</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span>) &#123;<br>    <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@vercel/analytics&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">&#123; inject &#125;</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">inject</span>();<br>    &#125;);<br>    <br>    <span class="hljs-keyword">const</span> &#123; init &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@sentry/nextjs&#x27;</span>);<br>    <span class="hljs-title function_">init</span>(&#123;<br>      <span class="hljs-attr">dsn</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">SENTRY_DSN</span>,<br>      <span class="hljs-attr">tracesSampleRate</span>: <span class="hljs-number">0.1</span>,<br>    &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="面试高频问题"><a href="#面试高频问题" class="headerlink" title="面试高频问题"></a>面试高频问题</h3><p><strong>Q：SSR 与 CSR 如何选择？</strong></p>
<ul>
<li>选择 SSR 当：<ul>
<li>SEO 是关键需求（内容型网站）</li>
<li>首屏性能至关重要</li>
<li>社交媒体分享需要正确预览</li>
</ul>
</li>
<li>选择 CSR 当：<ul>
<li>应用是认证后使用（后台系统）</li>
<li>高度交互式应用（如 Figma）</li>
<li>对服务器成本敏感</li>
</ul>
</li>
</ul>
<p><strong>Q：getStaticProps vs getServerSideProps</strong></p>
<p>对比：</p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">getStaticProps</th>
<th align="left">getServerSideProps</th>
</tr>
</thead>
<tbody><tr>
<td align="left">运行时机</td>
<td align="left">构建时</td>
<td align="left">每次请求时</td>
</tr>
<tr>
<td align="left">数据新鲜度</td>
<td align="left">静态（可重新验证）</td>
<td align="left">实时动态</td>
</tr>
<tr>
<td align="left">性能</td>
<td align="left">极快（CDN 缓存）</td>
<td align="left">较慢（服务器处理）</td>
</tr>
<tr>
<td align="left">SEO</td>
<td align="left">优</td>
<td align="left">优</td>
</tr>
<tr>
<td align="left">使用场景</td>
<td align="left">博客、产品目录</td>
<td align="left">个性化页面、仪表盘</td>
</tr>
</tbody></table>
<p><strong>Q：如何处理 SSR 中的身份认证？</strong></p>
<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 使用 getServerSideProps 传递用户数据</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getServerSideProps</span>(<span class="hljs-params">context</span>) &#123;<br>  <span class="hljs-keyword">const</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getSession</span>(context);<br>  <br>  <span class="hljs-keyword">if</span> (!session) &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">redirect</span>: &#123; <span class="hljs-attr">destination</span>: <span class="hljs-string">&#x27;/login&#x27;</span>, <span class="hljs-attr">permanent</span>: <span class="hljs-literal">false</span> &#125;<br>    &#125;;<br>  &#125;<br>  <br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">props</span>: &#123; <span class="hljs-attr">user</span>: session.<span class="hljs-property">user</span> &#125;<br>  &#125;;<br>&#125;<br><br><span class="hljs-comment">// 客户端使用共享状态</span><br><span class="hljs-keyword">import</span> &#123; useSession &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;next-auth/react&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; <span class="hljs-attr">data</span>: session &#125; = <span class="hljs-title function_">useSession</span>();<br>  <br>  <span class="hljs-keyword">if</span> (session) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Welcome &#123;session.user.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;<br>  &#125;<br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Please sign in<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Q：如何优化大型 Next.js 应用性能？</strong></p>
<p>优化策略：</p>
<ul>
<li>代码分割：使用动态导入拆分代码</li>
<li>图像优化：使用 Next Image 组件</li>
<li>CDN 缓存：配置静态资源和 ISR 页面缓存</li>
<li>数据库优化：使用缓存层（Redis&#x2F;Memcached）</li>
<li>减少 Bundle 大小：分析并优化依赖</li>
<li>服务端缓存：对 SSR 结果进行短期缓存</li>
<li>边缘计算：使用 Edge Functions 处理请求</li>
</ul>
<h3 id="总结-7"><a href="#总结-7" class="headerlink" title="总结"></a>总结</h3><ul>
<li>SSR 核心价值：<ul>
<li>提升 SEO 和首屏性能</li>
<li>改善社交分享体验</li>
<li>支持低端设备用户</li>
</ul>
</li>
<li>Next.js 核心能力：<ul>
<li>文件系统路由</li>
<li>混合渲染策略（SSG&#x2F;SSR&#x2F;ISR）</li>
<li>内置图像优化</li>
<li>API 路由支持</li>
</ul>
</li>
<li>关键数据获取方法：<ul>
<li>getStaticProps：构建时获取数据</li>
<li>getServerSideProps：请求时获取数据</li>
<li>getStaticPaths：定义动态路由</li>
</ul>
</li>
<li>高级特性：<ul>
<li>中间件：请求处理管道</li>
<li>按需重新验证：内容更新后刷新</li>
<li>分析工具：性能监控</li>
</ul>
</li>
<li>面试重点：<ul>
<li>渲染策略选择依据</li>
<li>身份认证实现方案</li>
<li>性能优化手段</li>
<li>部署架构设计</li>
</ul>
</li>
</ul>
<h1 id="第七章：React-工程化与优化"><a href="#第七章：React-工程化与优化" class="headerlink" title="第七章：React 工程化与优化"></a>第七章：React 工程化与优化</h1><h2 id="7-1-组件设计模式（复合组件、受控组件模式）"><a href="#7-1-组件设计模式（复合组件、受控组件模式）" class="headerlink" title="7.1 组件设计模式（复合组件、受控组件模式）"></a>7.1 组件设计模式（复合组件、受控组件模式）</h2><h2 id="7-2-样式方案（CSS-Modules、Styled-Components、Tailwind-CSS）"><a href="#7-2-样式方案（CSS-Modules、Styled-Components、Tailwind-CSS）" class="headerlink" title="7.2 样式方案（CSS Modules、Styled Components、Tailwind CSS）"></a>7.2 样式方案（CSS Modules、Styled Components、Tailwind CSS）</h2><h2 id="7-3-测试（Jest-React-Testing-Library）"><a href="#7-3-测试（Jest-React-Testing-Library）" class="headerlink" title="7.3 测试（Jest + React Testing Library）"></a>7.3 测试（Jest + React Testing Library）</h2><h2 id="7-4-性能优化（React-Profiler、减少重渲染）"><a href="#7-4-性能优化（React-Profiler、减少重渲染）" class="headerlink" title="7.4 性能优化（React Profiler、减少重渲染）"></a>7.4 性能优化（React Profiler、减少重渲染）</h2><h2 id="7-5-构建工具（Webpack-配置、Vite-优化）"><a href="#7-5-构建工具（Webpack-配置、Vite-优化）" class="headerlink" title="7.5 构建工具（Webpack 配置、Vite 优化）"></a>7.5 构建工具（Webpack 配置、Vite 优化）</h2><h1 id="第八章：React-18-新特性与未来趋势"><a href="#第八章：React-18-新特性与未来趋势" class="headerlink" title="第八章：React 18 新特性与未来趋势"></a>第八章：React 18 新特性与未来趋势</h1><h2 id="8-1-Concurrent-Mode（并发渲染）"><a href="#8-1-Concurrent-Mode（并发渲染）" class="headerlink" title="8.1 Concurrent Mode（并发渲染）"></a>8.1 Concurrent Mode（并发渲染）</h2><h2 id="8-2-自动批处理（Automatic-Batching）"><a href="#8-2-自动批处理（Automatic-Batching）" class="headerlink" title="8.2 自动批处理（Automatic Batching）"></a>8.2 自动批处理（Automatic Batching）</h2><h2 id="8-3-Transition-API（startTransition）"><a href="#8-3-Transition-API（startTransition）" class="headerlink" title="8.3 Transition API（startTransition）"></a>8.3 Transition API（startTransition）</h2><h2 id="8-4-Server-Components（服务端组件）"><a href="#8-4-Server-Components（服务端组件）" class="headerlink" title="8.4 Server Components（服务端组件）"></a>8.4 Server Components（服务端组件）</h2><h2 id="8-5-React-生态趋势（RSC、React-Native）"><a href="#8-5-React-生态趋势（RSC、React-Native）" class="headerlink" title="8.5 React 生态趋势（RSC、React Native）"></a>8.5 React 生态趋势（RSC、React Native）</h2>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/React/" class="category-chain-item">React</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/React/" class="print-no-link">#React</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>React 知识体系专题学习</div>
      <div>https://tianfei92.github.io/2025/06/23/React Study Notes/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Ariel</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年6月23日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/06/29/Performance%20Optimization/" title="前端性能优化知识专题学习">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">前端性能优化知识专题学习</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/06/22/CSS%20Study%20Notes/" title="CSS 专题知识学习">
                        <span class="hidden-mobile">CSS 专题知识学习</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  



  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
