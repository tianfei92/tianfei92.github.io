

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Ariel">
  <meta name="keywords" content="">
  
    <meta name="description" content="第一章：JavaScript 对象基础1.1 对象的概念与创建方式基本概念 JavaScript 对象是键值对的集合，是 JavaScript 的核心数据类型。对象可以看作是无序的属性集合，每个属性都有一个名称（键）和一个值。 对象的特点有以下几点：  动态性：随时可添加&#x2F;删除属性 引用类型：对象是通过引用访问的复合值 原型继承：每个对象都有原型链 属性特性：对象的属性可以拥有可读、可写">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaScript 原型&#x2F;原型链专题知识学习">
<meta property="og:url" content="https://tianfei92.github.io/2025/06/21/JavaScript%20Prototype/index.html">
<meta property="og:site_name" content="Ariel&#39;s Blog">
<meta property="og:description" content="第一章：JavaScript 对象基础1.1 对象的概念与创建方式基本概念 JavaScript 对象是键值对的集合，是 JavaScript 的核心数据类型。对象可以看作是无序的属性集合，每个属性都有一个名称（键）和一个值。 对象的特点有以下几点：  动态性：随时可添加&#x2F;删除属性 引用类型：对象是通过引用访问的复合值 原型继承：每个对象都有原型链 属性特性：对象的属性可以拥有可读、可写">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-06-21T04:08:07.000Z">
<meta property="article:modified_time" content="2025-06-24T08:57:20.434Z">
<meta property="article:author" content="Ariel">
<meta property="article:tag" content="JavaScript">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>JavaScript 原型/原型链专题知识学习 - Ariel&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"tianfei92.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Ariel</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="JavaScript 原型/原型链专题知识学习"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-06-21 12:08" pubdate>
          2025年6月21日 中午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          9.7k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          81 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">JavaScript 原型/原型链专题知识学习</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="第一章：JavaScript-对象基础"><a href="#第一章：JavaScript-对象基础" class="headerlink" title="第一章：JavaScript 对象基础"></a>第一章：JavaScript 对象基础</h1><h2 id="1-1-对象的概念与创建方式"><a href="#1-1-对象的概念与创建方式" class="headerlink" title="1.1 对象的概念与创建方式"></a>1.1 对象的概念与创建方式</h2><p><strong>基本概念</strong></p>
<p>JavaScript 对象是键值对的集合，是 JavaScript 的核心数据类型。对象可以看作是无序的属性集合，每个属性都有一个名称（键）和一个值。</p>
<p>对象的特点有以下几点：</p>
<ul>
<li>动态性：随时可添加&#x2F;删除属性</li>
<li>引用类型：对象是通过引用访问的复合值</li>
<li>原型继承：每个对象都有原型链</li>
<li>属性特性：对象的属性可以拥有可读、可写、可枚举、可配置等特性</li>
</ul>
<span id="more"></span>

<p><strong>创建方式</strong></p>
<p>（1）对象字面量</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> person = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;张三&#x27;</span>,<br>  <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>,<br>  <span class="hljs-title function_">greet</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`你好，我是<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.name&#125;</span>`</span>);<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>（2）new Object()构造函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> car = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>car.<span class="hljs-property">brand</span> = <span class="hljs-string">&#x27;Toyota&#x27;</span>;<br>car.<span class="hljs-property">model</span> = <span class="hljs-string">&#x27;Camry&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>（3）构造函数方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name, age</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, I&#x27;m <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.name&#125;</span>`</span>);<br>  &#125;;<br>&#125;<br><br><span class="hljs-keyword">const</span> person1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;李四&#x27;</span>, <span class="hljs-number">25</span>);<br></code></pre></td></tr></table></figure>

<p>（4）Object.create()方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> prototypeObj = &#123;<br>  <span class="hljs-title function_">greet</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Hello!&#x27;</span>);<br>  &#125;<br>&#125;;<br><br><span class="hljs-keyword">const</span> myObj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(prototypeObj);<br>myObj.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;王五&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>（5）ES6 class 语法糖</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>  &#125;<br>  <br>  <span class="hljs-title function_">speak</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.name&#125;</span> makes a noise.`</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>(<span class="hljs-string">&#x27;Dog&#x27;</span>);<br></code></pre></td></tr></table></figure>

<h2 id="1-2-属性的访问与操作"><a href="#1-2-属性的访问与操作" class="headerlink" title="1.2 属性的访问与操作"></a>1.2 属性的访问与操作</h2><p><strong>访问属性</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 点表示法</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">name</span>);<br><br><span class="hljs-comment">// 方括号表示法</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person[<span class="hljs-string">&#x27;age&#x27;</span>]);<br></code></pre></td></tr></table></figure>

<p><strong>属性操作</strong></p>
<p>（1）添加&#x2F;删除属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">person.<span class="hljs-property">job</span> = <span class="hljs-string">&#x27;Developer&#x27;</span>;<br>person[<span class="hljs-string">&#x27;hobby&#x27;</span>] = <span class="hljs-string">&#x27;Reading&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>（2）删除属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">delete</span> person.<span class="hljs-property">age</span>;<br></code></pre></td></tr></table></figure>

<p>（3）检查属性是否存在</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;name&#x27;</span> <span class="hljs-keyword">in</span> person); <span class="hljs-comment">// true</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">&#x27;name&#x27;</span>)); <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>

<h2 id="1-3-对象与原始类型的区别"><a href="#1-3-对象与原始类型的区别" class="headerlink" title="1.3 对象与原始类型的区别"></a>1.3 对象与原始类型的区别</h2><ul>
<li>存储与访问机制：原始类型存储在栈内存中，对象类型存储在堆内存中，变量保存其引用地址</li>
<li>可变性差异：原始类型不可变，对象类型可变</li>
<li>比较行为：原始类型对比值，对象类型对比引用</li>
<li>方法与属性：原始类型不能添加属性和方法，对象类型可以自由添加&#x2F;修改</li>
</ul>
<h1 id="第二章：初识原型（Prototype）"><a href="#第二章：初识原型（Prototype）" class="headerlink" title="第二章：初识原型（Prototype）"></a>第二章：初识原型（Prototype）</h1><h2 id="2-1-什么是原型？"><a href="#2-1-什么是原型？" class="headerlink" title="2.1 什么是原型？"></a>2.1 什么是原型？</h2><p>原型（Prototype）是 JavaScript 实现继承的核心机制。每个 JavaScript 对象都有一个内置的 [[Prototype]] 属性（可通过 <code>__proto__</code> 访问），指向它的原型对象</p>
<h2 id="2-2-prototype-属性的作用"><a href="#2-2-prototype-属性的作用" class="headerlink" title="2.2 prototype 属性的作用"></a>2.2 <code>prototype</code> 属性的作用</h2><p>prototype 是 JavaScript 中函数对象特有的属性，它的核心作用是为基于该构造函数创建的实例提供共享的属性和方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>&#125;<br><br><span class="hljs-comment">// 添加到prototype的方法会被所有实例共享</span><br><span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHi</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, I&#x27;m <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.name&#125;</span>`</span>);<br>&#125;;<br><br><span class="hljs-keyword">const</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;Alice&#x27;</span>);<br>p1.<span class="hljs-title function_">sayHi</span>(); <span class="hljs-comment">// Hi, I&#x27;m Alice</span><br></code></pre></td></tr></table></figure>

<h2 id="2-3-默认原型：Object-prototype"><a href="#2-3-默认原型：Object-prototype" class="headerlink" title="2.3 默认原型：Object.prototype"></a>2.3 默认原型：<code>Object.prototype</code></h2><p>Object.prototype 是 JavaScript 中所有对象的终极原型，是原型链的顶端（终点是 null）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> obj = &#123;&#125;;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span>); <span class="hljs-comment">// null</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Foo</span>(<span class="hljs-params"></span>) &#123;&#125;<br><span class="hljs-keyword">const</span> f = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fool</span>()<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(f.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>) <span class="hljs-comment">// undefined</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(f.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>) <span class="hljs-comment">// true</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>

<p>它包含所有对象继承的基本方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 常见方法</span><br>.<span class="hljs-title function_">toString</span>()<br>.<span class="hljs-title function_">valueOf</span>()<br>.<span class="hljs-title function_">hasOwnProperty</span>()<br>.<span class="hljs-title function_">isPrototypeOf</span>()<br></code></pre></td></tr></table></figure>

<p>默认继承关系如下：</p>
<pre class="mermaid">graph LR
    A[你的对象] --> B[Object.prototype]
    C[数组] --> D[Array.prototype] --> B
    E[函数] --> F[Function.prototype] --> B
    B --> G[null]</pre>

<h2 id="2-4-通过原型共享属性和方法"><a href="#2-4-通过原型共享属性和方法" class="headerlink" title="2.4 通过原型共享属性和方法"></a>2.4 通过原型共享属性和方法</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name; <span class="hljs-comment">// 实例属性（不共享）</span><br>&#125;<br><br><span class="hljs-comment">// 添加到prototype的方法会被所有实例共享</span><br><span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, I&#x27;m <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.name&#125;</span>`</span>);<br>&#125;;<br><br><span class="hljs-keyword">const</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;Alice&#x27;</span>);<br><span class="hljs-keyword">const</span> p2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;Bob&#x27;</span>);<br><br>p1.<span class="hljs-property">sayHello</span> === p2.<span class="hljs-property">sayHello</span> <span class="hljs-comment">// true（共享同一方法）</span><br></code></pre></td></tr></table></figure>

<h1 id="第三章：构造函数与实例"><a href="#第三章：构造函数与实例" class="headerlink" title="第三章：构造函数与实例"></a>第三章：构造函数与实例</h1><h2 id="3-1-构造函数的作用与定义"><a href="#3-1-构造函数的作用与定义" class="headerlink" title="3.1 构造函数的作用与定义"></a>3.1 构造函数的作用与定义</h2><p><strong>作用</strong></p>
<ol>
<li>创建对象模版：定义一类对象的共同属性和方法</li>
<li>初始化对象状态：为新对象设置初始属性值</li>
<li>实现原型继承：通过 prototype 共享属性和方法</li>
<li>类型标识：通过 instanceof 识别对象类型</li>
</ol>
<p><strong>定义方式</strong></p>
<p>（1）传统定义方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name, age</span>) &#123;<br>  <span class="hljs-comment">// 实例属性</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name; <br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;<br>  <br>  <span class="hljs-comment">// 不推荐：每个实例都会创建新函数</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">sayHi</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, I&#x27;m <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.name&#125;</span>`</span>);<br>  &#125;;<br>&#125;<br><br><span class="hljs-comment">// 推荐：共享方法</span><br><span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">introduce</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`I&#x27;m <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.name&#125;</span>, <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.age&#125;</span> years old`</span>);<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>（2）class 语法糖</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, age</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;<br>  &#125;<br>  <br>  <span class="hljs-comment">// 自动添加到prototype</span><br>  <span class="hljs-title function_">introduce</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`I&#x27;m <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.name&#125;</span>, <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.age&#125;</span> years old`</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>构造函数具有以下特征：</p>
<ol>
<li>命名约定：首字母大写（如 Person）</li>
<li>必须以 <code>new</code> 调用：否则 <code>this</code> 指向全局对象（严格模式下会报错）</li>
<li>隐式返回：自动返回新对象（除非手动返回非原始值）</li>
</ol>
<h2 id="3-2-new-操作符的执行过程"><a href="#3-2-new-操作符的执行过程" class="headerlink" title="3.2 new 操作符的执行过程"></a>3.2 <code>new</code> 操作符的执行过程</h2><p>当使用 new 调用构造函数时，JavaScript 引擎会完成以下操作：</p>
<ol>
<li>隐式创建新对象：创建一个新的空对象</li>
<li>设置原型链接：将该对象的 <code>[[Prototype]]</code> 属性（即 <code>__proto__</code>）链接到构造函数的 prototype 属性</li>
<li>绑定 this：将新对象绑定到构造函数内部的 this 上下文</li>
<li>自动返回：<ul>
<li>如果构造函数没有显式 return 语句，自动返回新创建的对象</li>
<li>如果 return 非对象类型，仍返回新对象（忽略 return）</li>
<li>如果 return 对象类型，则返回该对象（覆盖默认行为）</li>
</ul>
</li>
</ol>
<p><strong>代码示例</strong></p>
<p>（1）无 return 语句</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>  <span class="hljs-comment">// 无 return 语句</span><br>&#125;<br><br><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;Alice&#x27;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p); <span class="hljs-comment">// Person &#123; name: &quot;Alice&quot; &#125;（返回新对象）</span><br></code></pre></td></tr></table></figure>

<p>（2）return 非对象（原始值）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Car</span>(<span class="hljs-params">model</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span> = model;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">123</span>; <span class="hljs-comment">// 原始值被忽略</span><br>&#125;<br><br><span class="hljs-keyword">const</span> c = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(<span class="hljs-string">&#x27;Tesla&#x27;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(c); <span class="hljs-comment">// Car &#123; model: &quot;Tesla&quot; &#125;（仍返回新对象）</span><br></code></pre></td></tr></table></figure>

<p>（3）return 对象类型（覆盖默认行为）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Dog</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-string">&quot;Default&quot;</span>;<br>  <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Override&quot;</span> &#125;; <span class="hljs-comment">// 返回这个对象</span><br>&#125;<br><br><span class="hljs-keyword">const</span> d = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(d); <span class="hljs-comment">// &#123; name: &quot;Override&quot; &#125;（不是 Dog 实例）</span><br></code></pre></td></tr></table></figure>

<p><strong>关键注意事项</strong></p>
<p>（1）忘记 new 的后果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> p = <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;Alice&#x27;</span>); <span class="hljs-comment">// 没有 new</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p); <span class="hljs-comment">// undefined（this 会指向全局对象/报错）</span><br></code></pre></td></tr></table></figure>

<p>（2）防御性编程</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">User</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-comment">// 确保构造函数被正确使用</span><br>  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">new</span>.<span class="hljs-property">target</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(name); <span class="hljs-comment">// 自动补 new</span><br>  &#125;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-3-实例的-proto-与构造函数的-prototype"><a href="#3-3-实例的-proto-与构造函数的-prototype" class="headerlink" title="3.3 实例的 __proto__ 与构造函数的 prototype"></a>3.3 实例的 <code>__proto__</code> 与构造函数的 <code>prototype</code></h2><p><strong>核心概念对比</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">prototype</th>
<th align="left"><code>__proto__</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">归属</td>
<td align="left">函数对象特有</td>
<td align="left">所有对象都有</td>
</tr>
<tr>
<td align="left">作用</td>
<td align="left">构造函数创建实例时的原型模板</td>
<td align="left">对象实际继承的原型对象</td>
</tr>
<tr>
<td align="left">访问方式</td>
<td align="left">Constructor.prototype</td>
<td align="left">Object.getPrototypeOf(obj) 或 <code>obj.__proto__</code></td>
</tr>
<tr>
<td align="left">默认值</td>
<td align="left">自动创建包含 constructor 属性的对象</td>
<td align="left">取决于对象创建方式</td>
</tr>
<tr>
<td align="left">标准程度</td>
<td align="left">ES标准属性</td>
<td align="left">非标准，已由Object.getPrototypeOf()取代</td>
</tr>
</tbody></table>
<p><strong>两者关系图解</strong></p>
<pre class="mermaid">graph LR
    A[构造函数 Constructor] -->|prototype 属性| B[原型对象 Prototype]
    C[实例 instance] -->|"__proto__" 链接| B
    B -->|constructor 属性| A
    B -->|"__proto__"| D[Object.prototype]
    D -->|"__proto__"| E[null]</pre>

<h2 id="3-4-constructor-属性的意义"><a href="#3-4-constructor-属性的意义" class="headerlink" title="3.4 constructor 属性的意义"></a>3.4 <code>constructor</code> 属性的意义</h2><p>constructor 是原型对象上的一个重要属性，它指向创建当前对象的构造函数。</p>
<p><strong>基本特性</strong></p>
<p>（1）默认存在于所有函数对象的 prototype 上</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params"></span>) &#123;&#125;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>

<p>（2）实例通过原型链访问</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// true（通过原型链访问）</span><br></code></pre></td></tr></table></figure>

<p><strong>核心作用</strong></p>
<p>（1）标识对象来源，提供追踪对象是由哪个构造函数创建的路径</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> arr = [];<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Array</span>); <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>

<p>（2）实现构造函数复用，可以通过 constructor 创建新实例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Car</span>(<span class="hljs-params">make</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">make</span> = make;<br>&#125;<br><br><span class="hljs-keyword">const</span> toyota = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(<span class="hljs-string">&#x27;Toyota&#x27;</span>);<br><span class="hljs-keyword">const</span> honda = <span class="hljs-keyword">new</span> toyota.<span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-string">&#x27;Honda&#x27;</span></span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(honda.<span class="hljs-property">make</span>); <span class="hljs-comment">// &quot;Honda&quot;</span><br></code></pre></td></tr></table></figure>

<p>（3）类型检查的补充</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkType</span>(<span class="hljs-params">obj</span>) &#123;<br>  <span class="hljs-keyword">return</span> obj.<span class="hljs-property">constructor</span>.<span class="hljs-property">name</span>;<br>&#125;<br><span class="hljs-title function_">checkType</span>([]); <span class="hljs-comment">// &quot;Array&quot;</span><br></code></pre></td></tr></table></figure>

<h1 id="第四章：原型链（Prototype-Chain）"><a href="#第四章：原型链（Prototype-Chain）" class="headerlink" title="第四章：原型链（Prototype Chain）"></a>第四章：原型链（Prototype Chain）</h1><h2 id="4-1-原型链的形成机制"><a href="#4-1-原型链的形成机制" class="headerlink" title="4.1 原型链的形成机制"></a>4.1 原型链的形成机制</h2><p>原型链由对象的 <code>__proto__</code> 链接串联而成，形成一条访问属性和方法的查找路径</p>
<p><strong>原型链核心组件</strong></p>
<ol>
<li>实例对象：包含基本数据和 <code>__proto__</code> 链接</li>
<li>原型对象：包含共享属性和方法</li>
<li>链式结构：通过 <code>__proto__</code> 逐级链接形成，终点是 null</li>
</ol>
<p><strong>具体形成过程</strong></p>
<p>（1）构造函数创建时的默认设置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>&#125;<br><br><span class="hljs-comment">// 自动创建的 prototype 对象</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);<br><span class="hljs-comment">/* &#123;</span><br><span class="hljs-comment"> *   constructor: Person,</span><br><span class="hljs-comment"> *   __proto__: Object.prototype</span><br><span class="hljs-comment"> * &#125;</span><br><span class="hljs-comment"> */</span><br></code></pre></td></tr></table></figure>

<p>(2)实例创建时的原型链建立（<code>new</code> 操作符执行过程）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;Alice&#x27;</span>);<br><br><span class="hljs-comment">// 实例的原型指向构造函数的prototype</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(p) === <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);             <span class="hljs-comment">// true</span><br><br><span class="hljs-comment">// 原型对象的constructor指回构造函数</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Person</span>);      <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>

<p><strong>图解</strong></p>
<pre class="mermaid">graph LR
    A[实例] -->|__proto__| B[构造函数的prototype]
    B -->|__proto__| C[Object.prototype]
    C -->|__proto__| D[null]</pre>

<h2 id="4-2-属性查找规则：从实例到原型链顶端"><a href="#4-2-属性查找规则：从实例到原型链顶端" class="headerlink" title="4.2 属性查找规则：从实例到原型链顶端"></a>4.2 属性查找规则：从实例到原型链顶端</h2><p><strong>基本查找流程</strong></p>
<p>当查找对象属性&#x2F;方法时，JavaScript 引擎会按照以下顺序进行查找</p>
<ol>
<li>检查实例自身属性：首先在实例对象自身属性中查找，可使用 <code>hasOwnProperty()</code> 验证属性是否为自有</li>
<li>沿原型链向上查找：如果实例自身没有该属性，则访问 <code>__proto__</code>，重复此过程直到找到属性或到达原型链终点</li>
<li>终止条件：找到属性立即返回，或到达 null（原型链中断）时返回 undefined</li>
</ol>
<p><strong>图解查找流程</strong></p>
<pre class="mermaid">graph TD
    A[访问 obj.property] --> B{obj有自有属性?}
    B -->|是| C[返回该属性值]
    B -->|否| D[获取 obj.__proto__]
    D --> E{proto为null?}
    E -->|是| F[返回undefined]
    E -->|否| G[在proto对象上查找property]
    G --> H{找到属性?}
    H -->|是| I[返回属性值]
    H -->|否| D</pre>

<p><strong>示例代码说明</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name; <span class="hljs-comment">// 自有属性</span><br>&#125;<br><br><span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHi</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">// 原型属性</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.name&#125;</span>`</span>);<br>&#125;;<br><br><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;Alice&#x27;</span>);<br><br><span class="hljs-comment">// 查找过程演示：</span><br>p.<span class="hljs-property">name</span>;    <span class="hljs-comment">// 1. 找到自有属性 → &quot;Alice&quot;</span><br>p.<span class="hljs-title function_">sayHi</span>(); <span class="hljs-comment">// 2. 自有无 → Person.prototype找到 → 执行方法</span><br>p.<span class="hljs-property">age</span>;     <span class="hljs-comment">// 3. 自有无 → Person.prototype无 → Object.prototype无 → null → undefined</span><br></code></pre></td></tr></table></figure>

<h2 id="4-3-原型链的终点：Object-prototype-和-null"><a href="#4-3-原型链的终点：Object-prototype-和-null" class="headerlink" title="4.3 原型链的终点：Object.prototype 和 null"></a>4.3 原型链的终点：<code>Object.prototype</code> 和 <code>null</code></h2><p>JavaScript 的原型链最终会指向两个特殊的终点：</p>
<ol>
<li>Object.prototype：所有常规对象的最终原型对象</li>
<li>null：原型链的真正终点，表示“无原型”</li>
</ol>
<p><strong>Object.prototype 的作用</strong></p>
<p>（1）提供基础对象方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 所有对象继承的方法举例</span><br><span class="hljs-keyword">const</span> obj = &#123;&#125;;<br>obj.<span class="hljs-title function_">toString</span>();      <span class="hljs-comment">// 继承自Object.prototype</span><br>obj.<span class="hljs-title function_">hasOwnProperty</span>(); <span class="hljs-comment">// 继承自Object.prototype</span><br>obj.<span class="hljs-title function_">valueOf</span>();       <span class="hljs-comment">// 继承自Object.prototype</span><br></code></pre></td></tr></table></figure>

<p>（2）原型链的枢纽站：基本所有原型链都会经过 Object.prototype（Object.create(null)创建的纯净对象除外）</p>
<p>（3）内置方法的存储库</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);<br><span class="hljs-comment">/* 包含：</span><br><span class="hljs-comment"> * - constructor: Object()</span><br><span class="hljs-comment"> * - toString()</span><br><span class="hljs-comment"> * - valueOf()</span><br><span class="hljs-comment"> * - hasOwnProperty()</span><br><span class="hljs-comment"> * - isPrototypeOf()</span><br><span class="hljs-comment"> * - ...</span><br><span class="hljs-comment"> */</span><br></code></pre></td></tr></table></figure>

<p><strong>null 的意义</strong></p>
<p>（1）原型链的终止标识</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)); <span class="hljs-comment">// null</span><br></code></pre></td></tr></table></figure>

<p>（2）设计目的：表示“无原型”的最终状态，防止原型链查找进入无限循环</p>
<p>（3）特殊对象的对比</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> normalObj = &#123;&#125;;<br><span class="hljs-keyword">const</span> bareObj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;toString&#x27;</span> <span class="hljs-keyword">in</span> normalObj); <span class="hljs-comment">// true</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;toString&#x27;</span> <span class="hljs-keyword">in</span> bareObj);   <span class="hljs-comment">// false</span><br></code></pre></td></tr></table></figure>

<h2 id="4-4-原型链-vs-作用域链"><a href="#4-4-原型链-vs-作用域链" class="headerlink" title="4.4 原型链 vs 作用域链"></a>4.4 原型链 vs 作用域链</h2><p><strong>作用域链简述</strong></p>
<p>作用域链是 JavaScript 中实现变量查找的机制，每个函数执行时都会创建一个上下文，其中包含一个作用域链。作用域链由当前函数的活动对象和所有外层函数的变量对象组成，当查找变量时，JavaScript 引擎会从当前执行作用域开始查找，当前作用域未找到时会沿作用域链向上查找，直到找到变量或达到全局作用域返回 undefined</p>
<p><strong>两者对比</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">原型链</th>
<th align="left">作用域链</th>
</tr>
</thead>
<tbody><tr>
<td align="left">目的</td>
<td align="left">实现对象间的属性&#x2F;方法的共享和继承</td>
<td align="left">实现变量的查找和访问</td>
</tr>
<tr>
<td align="left">组成</td>
<td align="left">对象的 <code>__proto__</code>链接形成</td>
<td align="left">函数执行上下文中的变量对象链</td>
</tr>
<tr>
<td align="left">查找方向</td>
<td align="left">从实例对象往原型对象方向查找</td>
<td align="left">从内层函数往外层函数方向查找</td>
</tr>
<tr>
<td align="left">触发时机</td>
<td align="left">访问对象属性时</td>
<td align="left">访问变量时</td>
</tr>
<tr>
<td align="left">终点</td>
<td align="left">null</td>
<td align="left">全局执行上下文（window&#x2F;global）</td>
</tr>
<tr>
<td align="left">创建方式</td>
<td align="left">new、Object.create()或 <code>__proto_</code></td>
<td align="left">通过函数定义和调用</td>
</tr>
</tbody></table>
<p><strong>代码示例</strong></p>
<p>（1）原型链查找</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>&#125;<br><br><span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, I&#x27;m <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.name&#125;</span>`</span>);<br>&#125;;<br><br><span class="hljs-keyword">const</span> john = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;John&#x27;</span>);<br><br><span class="hljs-comment">// 原型链查找过程:</span><br><span class="hljs-comment">// 1. john 自身有 name 属性</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(john.<span class="hljs-property">name</span>); <span class="hljs-comment">// 直接找到</span><br><br><span class="hljs-comment">// 2. john 自身没有 sayHello 方法，查找原型链</span><br>john.<span class="hljs-title function_">sayHello</span>(); <span class="hljs-comment">// 在 Person.prototype 上找到</span><br><br><span class="hljs-comment">// 3. toString 方法查找</span><br><span class="hljs-comment">// john -&gt; Person.prototype -&gt; Object.prototype -&gt; null</span><br>john.<span class="hljs-title function_">toString</span>(); <span class="hljs-comment">// 最终在 Object.prototype 上找到</span><br></code></pre></td></tr></table></figure>

<p>（2）作用域链查找</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> globalVar = <span class="hljs-string">&#x27;global&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">outer</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> outerVar = <span class="hljs-string">&#x27;outer&#x27;</span>;<br>  <br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">inner</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> innerVar = <span class="hljs-string">&#x27;inner&#x27;</span>;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(innerVar);    <span class="hljs-comment">// 当前作用域找到</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(outerVar);    <span class="hljs-comment">// 外层作用域找到</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(globalVar);   <span class="hljs-comment">// 全局作用域找到</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(notDefined);  <span class="hljs-comment">// 报错，所有作用域都找不到</span><br>  &#125;<br>  <br>  <span class="hljs-title function_">inner</span>();<br>&#125;<br><br><span class="hljs-title function_">outer</span>();<br></code></pre></td></tr></table></figure>

<h1 id="第五章：继承与原型链"><a href="#第五章：继承与原型链" class="headerlink" title="第五章：继承与原型链"></a>第五章：继承与原型链</h1><h2 id="5-1-基于原型的继承实现（Object-create）"><a href="#5-1-基于原型的继承实现（Object-create）" class="headerlink" title="5.1 基于原型的继承实现（Object.create）"></a>5.1 基于原型的继承实现（Object.create）</h2><p><strong>代码实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> animal = &#123;<br>  <span class="hljs-attr">init</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>  &#125;,<br>  <span class="hljs-attr">getName</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>;<br>  &#125;<br>&#125;;<br><br><span class="hljs-keyword">const</span> dog = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(animal);<br>dog.<span class="hljs-property">bark</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Woof!&#x27;</span>;<br>&#125;;<br><br><span class="hljs-keyword">const</span> myDog = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(dog);<br>myDog.<span class="hljs-title function_">init</span>(<span class="hljs-string">&#x27;Buddy&#x27;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myDog.<span class="hljs-title function_">getName</span>()); <span class="hljs-comment">// &quot;Buddy&quot;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myDog.<span class="hljs-title function_">bark</span>());    <span class="hljs-comment">// &quot;Woof!&quot;</span><br></code></pre></td></tr></table></figure>

<p><strong>特点</strong></p>
<ul>
<li>更纯粹的原型继承，不需要构造函数</li>
<li>适合简单对象继承场景</li>
<li>无法实现私有属性和方法</li>
</ul>
<h2 id="5-2-组合继承（构造函数-原型链）"><a href="#5-2-组合继承（构造函数-原型链）" class="headerlink" title="5.2 组合继承（构造函数 + 原型链）"></a>5.2 组合继承（构造函数 + 原型链）</h2><p><strong>代码实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 父类</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">colors</span> = [<span class="hljs-string">&#x27;black&#x27;</span>, <span class="hljs-string">&#x27;white&#x27;</span>];<br>&#125;<br><br><span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">getName</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>;<br>&#125;;<br><br><span class="hljs-comment">// 子类</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Dog</span>(<span class="hljs-params">name, age</span>) &#123;<br>  <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name); <span class="hljs-comment">// 调用父类构造函数，继承实例属性</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;<br>&#125;<br><br><span class="hljs-comment">// 设置原型链继承</span><br><span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);<br><span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Dog</span>; <span class="hljs-comment">// 修复构造函数指向</span><br><br><span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">bark</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Woof!&#x27;</span>;<br>&#125;;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> dog1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-string">&#x27;Buddy&#x27;</span>, <span class="hljs-number">2</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog1.<span class="hljs-title function_">getName</span>()); <span class="hljs-comment">// &quot;Buddy&quot;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog1.<span class="hljs-title function_">bark</span>());   <span class="hljs-comment">// &quot;Woof!&quot;</span><br></code></pre></td></tr></table></figure>

<p><strong>关键点分析</strong></p>
<ul>
<li>Animal.call(this, name) 实现实例属性的继承（类似其他语言的 super()）</li>
<li>Object.create(Animal.prototype) 创建以父类原型为原型的新对象，避免直接赋值导致原型污染</li>
<li>修复 constructor 属性保证对象类型正确识别</li>
</ul>
<h2 id="5-3-寄生组合继承（优化方案）"><a href="#5-3-寄生组合继承（优化方案）" class="headerlink" title="5.3 寄生组合继承（优化方案）"></a>5.3 寄生组合继承（优化方案）</h2><p><strong>代码实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">inheritPrototype</span>(<span class="hljs-params">child, parent</span>) &#123;<br>  <span class="hljs-keyword">const</span> prototype = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(parent.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);<br>  prototype.<span class="hljs-property">constructor</span> = child;<br>  child.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = prototype;<br>&#125;<br><br><span class="hljs-comment">// 父类</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>&#125;<br><br><span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayName</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);<br>&#125;;<br><br><span class="hljs-comment">// 子类</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Dog</span>(<span class="hljs-params">name, breed</span>) &#123;<br>  <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name);<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">breed</span> = breed;<br>&#125;<br><br><span class="hljs-comment">// 继承</span><br><span class="hljs-title function_">inheritPrototype</span>(<span class="hljs-title class_">Dog</span>, <span class="hljs-title class_">Animal</span>);<br><br><span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">bark</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Woof!&#x27;</span>);<br>&#125;;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> myDog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-string">&#x27;Max&#x27;</span>, <span class="hljs-string">&#x27;Labrador&#x27;</span>);<br>myDog.<span class="hljs-title function_">sayName</span>(); <span class="hljs-comment">// &quot;Max&quot;</span><br>myDog.<span class="hljs-title function_">bark</span>();    <span class="hljs-comment">// &quot;Woof!&quot;</span><br></code></pre></td></tr></table></figure>

<p><strong>优势</strong></p>
<ul>
<li>只调用一次父类构造函数</li>
<li>原型链保持不变</li>
<li>能够正常使用 instanceof 和 isPrototypeOf</li>
</ul>
<h2 id="5-4-ES6-class-语法与原型链的关系"><a href="#5-4-ES6-class-语法与原型链的关系" class="headerlink" title="5.4 ES6 class 语法与原型链的关系"></a>5.4 ES6 <code>class</code> 语法与原型链的关系</h2><p><strong>代码实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>  &#125;<br>  <br>  <span class="hljs-title function_">getName</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, breed</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(name); <span class="hljs-comment">// 调用父类构造函数</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">breed</span> = breed;<br>  &#125;<br>  <br>  <span class="hljs-title function_">bark</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Woof!&#x27;</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> myDog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-string">&#x27;Buddy&#x27;</span>, <span class="hljs-string">&#x27;Golden Retriever&#x27;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myDog.<span class="hljs-title function_">getName</span>()); <span class="hljs-comment">// &quot;Buddy&quot;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myDog.<span class="hljs-title function_">bark</span>());    <span class="hljs-comment">// &quot;Woof!&quot;</span><br></code></pre></td></tr></table></figure>

<p><strong>注意</strong></p>
<ul>
<li>这本质上是语法糖，底层仍然是基于原型的继承</li>
<li>extends 关键字自动设置了原型链</li>
<li>super() 必须在使用 this 之前调用</li>
</ul>
<h1 id="第六章：原型相关方法与操作"><a href="#第六章：原型相关方法与操作" class="headerlink" title="第六章：原型相关方法与操作"></a>第六章：原型相关方法与操作</h1><h2 id="6-1-Object-create-与纯净对象"><a href="#6-1-Object-create-与纯净对象" class="headerlink" title="6.1 Object.create() 与纯净对象"></a>6.1 <code>Object.create()</code> 与纯净对象</h2><p>Object.create 是 JavaScript 中创建新对象的方法，它允许你明确指定新对象的原型</p>
<p><strong>基本语法</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(proto[, propertiesObject])<br></code></pre></td></tr></table></figure>

<ul>
<li>proto：新创建对象的原型对象（必须为对象或 null）</li>
<li>propertiesObject（可选）：属性描述符集合（同 Object.defineProperties() 的第二个参数）</li>
</ul>
<p><strong>纯净对象</strong></p>
<p>纯净对象是指没有原型链（<code>__proto__</code>为 null）的对象，创建方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> pureObject = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></figure>

<p>其特点有：</p>
<ul>
<li>无原型，防止污染</li>
<li>无任何默认属性和方法</li>
<li>属性查找更快，只需查找自身属性</li>
<li>更安全的属性存储</li>
</ul>
<h2 id="6-2-Object-getPrototypeOf-和-Object-setPrototypeOf"><a href="#6-2-Object-getPrototypeOf-和-Object-setPrototypeOf" class="headerlink" title="6.2 Object.getPrototypeOf() 和 Object.setPrototypeOf()"></a>6.2 <code>Object.getPrototypeOf()</code> 和 <code>Object.setPrototypeOf()</code></h2><p><strong>基本概念</strong></p>
<ul>
<li>Object.getPrototypeOf() 方法用于获取指定对象的原型（即内部 [[Prototype]] 属性的值）</li>
<li>Object.setPrototypeOf() 方法设置一个指定对象的原型（即内部 [[Prototype]] 属性）到另一个对象或 null。</li>
</ul>
<p><strong>语法和参数</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj)<br><span class="hljs-comment">// obj：要获取其原型的对象，注意，如果参数不是对象，会强制转为对象</span><br><br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(obj, prototype)<br><span class="hljs-comment">// obj：要设置其原型的对象</span><br><span class="hljs-comment">// prototype：该对象的新原型（必须为对象或 null）</span><br></code></pre></td></tr></table></figure>

<p><strong>返回值</strong></p>
<ul>
<li>Object.getPrototypeOf()：返回给定对象的原型（可能是对象或 null）</li>
<li>Object.setPrototypeOf()：返回设置新原型后的对象</li>
</ul>
<h2 id="6-3-instanceof-的原理与局限性"><a href="#6-3-instanceof-的原理与局限性" class="headerlink" title="6.3 instanceof 的原理与局限性"></a>6.3 <code>instanceof</code> 的原理与局限性</h2><p>instanceof 是 JavaScript 中用于检查对象原型链的操作符，其核心功能是检查构造函数的 prototype 属性是否出现在对象的原型链上</p>
<p><strong>语法</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">object <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Constructor</span><br></code></pre></td></tr></table></figure>

<p><strong>内部实现机制</strong></p>
<p>instanceof 的底层行为可以用以下伪代码表示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">instanceOf</span>(<span class="hljs-params">obj, Constructor</span>) &#123;<br>  <span class="hljs-comment">// 获取对象的原型</span><br>  <span class="hljs-keyword">let</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj);<br>  <br>  <span class="hljs-comment">// 获取构造函数的 prototype 对象</span><br>  <span class="hljs-keyword">const</span> prototype = <span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;<br>  <br>  <span class="hljs-comment">// 沿着原型链向上查找</span><br>  <span class="hljs-keyword">while</span> (proto !== <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">if</span> (proto === prototype) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(proto);<br>  &#125;<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>实际示例分析</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params"></span>) &#123;&#125;<br><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>

<p>其执行过程为：</p>
<ol>
<li>获取 <code>p.__proto__</code>（指向 Person.prototype）</li>
<li>比较 Person.prototype 和 Person.prototype -&gt; 匹配成功</li>
</ol>
<p><strong>主要局限性</strong></p>
<p>（1）跨执行环境问题（iframe&#x2F;window）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">&lt;!-- 主页面 --&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params"></span>) &#123;&#125;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();</span></span><br><span class="language-javascript"><span class="language-xml">  </span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-comment">// 创建iframe并获取其Array构造函数</span></span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-keyword">const</span> iframe = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;iframe&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(iframe);</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-keyword">const</span> <span class="hljs-title class_">IframeArray</span> = iframe.<span class="hljs-property">contentWindow</span>.<span class="hljs-property">Array</span>;</span></span><br><span class="language-javascript"><span class="language-xml">  </span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// true</span></span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([] <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">IframeArray</span>); <span class="hljs-comment">// false</span></span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>原因：不同执行环境有其各自独立的全局对象和构造函数</p>
<p>（2）原始类型检测不可靠</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;hello&#x27;</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">String</span>); <span class="hljs-comment">// false</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">123</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Number</span>);    <span class="hljs-comment">// false</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-literal">true</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Boolean</span>);  <span class="hljs-comment">// false</span><br></code></pre></td></tr></table></figure>

<p>原因：原始类型不是对象，除非用包装对象</p>
<p>（3）构造函数 prototype 被修改</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params"></span>) &#123;&#125;<br><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br><br><span class="hljs-comment">// 修改原型后</span><br><span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = &#123;&#125;;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// false</span><br></code></pre></td></tr></table></figure>

<p>（4）对象原型被手动修改</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">A</span>(<span class="hljs-params"></span>) &#123;&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">B</span>(<span class="hljs-params"></span>) &#123;&#125;<br><span class="hljs-keyword">const</span> obj = <span class="hljs-keyword">new</span> <span class="hljs-title function_">A</span>();<br><br><span class="hljs-comment">// 修改原型链</span><br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(obj, B.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj <span class="hljs-keyword">instanceof</span> A); <span class="hljs-comment">// false</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj <span class="hljs-keyword">instanceof</span> B); <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>

<p>（5）对纯净对象无效</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> pureObj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(pureObj <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span>); <span class="hljs-comment">// false</span><br></code></pre></td></tr></table></figure>

<h2 id="6-4-hasOwnProperty-与-in-操作符的区别"><a href="#6-4-hasOwnProperty-与-in-操作符的区别" class="headerlink" title="6.4 hasOwnProperty 与 in 操作符的区别"></a>6.4 <code>hasOwnProperty</code> 与 <code>in</code> 操作符的区别</h2><p><strong>核心区别</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">hasOwnProperty</th>
<th align="left">in 操作符</th>
</tr>
</thead>
<tbody><tr>
<td align="left">检测范围</td>
<td align="left">仅对象自身属性</td>
<td align="left">自身属性 + 原型链属性</td>
</tr>
<tr>
<td align="left">继承方法</td>
<td align="left">来自 Object.prototype</td>
<td align="left">JavaScript 语言操作符</td>
</tr>
<tr>
<td align="left">对纯净对象</td>
<td align="left">需要外部调用（Object.prototype.hasOwnProperty.call）</td>
<td align="left">可直接使用</td>
</tr>
<tr>
<td align="left">ES6+替代方案</td>
<td align="left">Object.hasOwn()</td>
<td align="left">Reflect.has()</td>
</tr>
</tbody></table>
<p><strong>深度解析</strong></p>
<p>（1）hasOwnProperty 实现原理（伪代码）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-params">obj, prop</span>) &#123;<br>  <span class="hljs-comment">// 获取对象的所有自有属性</span><br>  <span class="hljs-keyword">const</span> ownKeys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertyNames</span>(obj).<span class="hljs-title function_">concat</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertySymbols</span>(obj));<br>  <span class="hljs-keyword">return</span> ownKeys.<span class="hljs-title function_">includes</span>(prop);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>（2）in 操作符实现原理（伪代码）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">inOperator</span>(<span class="hljs-params">obj, prop</span>) &#123;<br>  <span class="hljs-keyword">while</span> (obj !== <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertyDescriptor</span>(obj, prop)) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    obj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>关键差异对比</strong></p>
<p>（1）原型链处理差异</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params"></span>) &#123;&#125;<br><span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;Proto&#x27;</span>;<br><br><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>p.<span class="hljs-property">age</span> = <span class="hljs-number">30</span>;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">&#x27;name&#x27;</span>)); <span class="hljs-comment">// false</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;name&#x27;</span> <span class="hljs-keyword">in</span> p);             <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>

<p>（2）属性描述符影响</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> parent = &#123;&#125;;<br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(parent, <span class="hljs-string">&#x27;secret&#x27;</span>, &#123;<br>  <span class="hljs-attr">value</span>: <span class="hljs-number">123</span>,<br>  <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span><br>&#125;);<br><br><span class="hljs-keyword">const</span> child = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(parent);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">&#x27;secret&#x27;</span>)); <span class="hljs-comment">// false ❗️(正确，非自有属性)</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;secret&#x27;</span> <span class="hljs-keyword">in</span> child);             <span class="hljs-comment">// true ❗️(能检测到继承属性)</span><br></code></pre></td></tr></table></figure>

<h1 id="第七章：高级原型应用"><a href="#第七章：高级原型应用" class="headerlink" title="第七章：高级原型应用"></a>第七章：高级原型应用</h1><h2 id="7-1-原型污染与安全问题"><a href="#7-1-原型污染与安全问题" class="headerlink" title="7.1 原型污染与安全问题"></a>7.1 原型污染与安全问题</h2><p><strong>基本概念</strong></p>
<p>原型污染是指攻击者通过某种方式修改 JavaScript 对象的原型（通常是 Object.prototype），从而影响所有基于该原型的对象行为的安全漏洞</p>
<p><strong>污染原理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 正常对象</span><br><span class="hljs-keyword">const</span> obj = &#123; <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> &#125;;<br><br><span class="hljs-comment">// 污染原型</span><br><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">isAdmin</span> = <span class="hljs-literal">true</span>;<br><br><span class="hljs-comment">// 所有对象现在都有isAdmin属性</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">isAdmin</span>); <span class="hljs-comment">// true</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(&#123;&#125;.<span class="hljs-property">isAdmin</span>); <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>

<p><strong>常见的污染途径</strong></p>
<p>（1）不安全的对象合并</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">target, source</span>) &#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> source) &#123;<br>    target[key] = source[key]; <span class="hljs-comment">// 可能覆盖原型属性</span><br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> maliciousPayload = &#123;<br>  <span class="hljs-attr">__proto__</span>: &#123; <span class="hljs-attr">isAdmin</span>: <span class="hljs-literal">true</span> &#125;,<br>  <span class="hljs-attr">constructor</span>: &#123; <span class="hljs-attr">prototype</span>: &#123; <span class="hljs-attr">isAdmin</span>: <span class="hljs-literal">true</span> &#125; &#125;<br>&#125;;<br><br><span class="hljs-title function_">merge</span>(&#123;&#125;, maliciousPayload);<br></code></pre></td></tr></table></figure>

<p>（2）不安全的 JSON 解析</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> maliciousJSON = <span class="hljs-string">&#x27;&#123;&quot;__proto__&quot;:&#123;&quot;isAdmin&quot;:true&#125;&#125;&#x27;</span>;<br><span class="hljs-keyword">const</span> obj = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(maliciousJSON); <span class="hljs-comment">// 在某些引擎中会污染原型</span><br></code></pre></td></tr></table></figure>

<p>（3）路径赋值操作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setValue</span>(<span class="hljs-params">obj, path, value</span>) &#123;<br>  <span class="hljs-keyword">const</span> parts = path.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>);<br>  <span class="hljs-keyword">let</span> current = obj;<br>  <br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; parts.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i++) &#123;<br>    <span class="hljs-keyword">if</span> (!current[parts[i]]) &#123;<br>      current[parts[i]] = &#123;&#125;;<br>    &#125;<br>    current = current[parts[i]];<br>  &#125;<br>  <br>  current[parts[parts.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]] = value;<br>&#125;<br><br><span class="hljs-comment">// 攻击者可以传入恶意路径</span><br><span class="hljs-title function_">setValue</span>(&#123;&#125;, <span class="hljs-string">&#x27;__proto__.isAdmin&#x27;</span>, <span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure>

<p><strong>安全影响分析</strong></p>
<p>（1）权限提升</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 假设系统检查权限的方式</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkPermission</span>(<span class="hljs-params">user</span>) &#123;<br>  <span class="hljs-keyword">if</span> (user.<span class="hljs-property">isAdmin</span>) &#123;<br>    <span class="hljs-title function_">grantAdminAccess</span>();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 污染后所有用户都变成管理员</span><br><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">isAdmin</span> = <span class="hljs-literal">true</span>;<br><span class="hljs-title function_">checkPermission</span>(&#123;&#125;); <span class="hljs-comment">// 获得管理员权限</span><br></code></pre></td></tr></table></figure>

<p>（2）XSS 攻击增强</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 污染toString方法</span><br><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;script&gt;maliciousCode()&lt;/script&gt;&#x27;</span>;<br>&#125;;<br><br><span class="hljs-comment">// 当系统调用toString时</span><br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHTML</span> = someObject.<span class="hljs-title function_">toString</span>(); <span class="hljs-comment">// 执行恶意代码</span><br></code></pre></td></tr></table></figure>

<p>（3）服务端漏洞</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 假设Express中有这样的代码</span><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/user&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">query</span>.<span class="hljs-property">isAdmin</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">sensitiveData</span>();<br>  &#125;<br>&#125;);<br><br><span class="hljs-comment">// 攻击者可以发送污染请求</span><br><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/user?__proto__.isAdmin=true&#x27;</span>);<br></code></pre></td></tr></table></figure>

<h2 id="7-2-如何防御原型污染？"><a href="#7-2-如何防御原型污染？" class="headerlink" title="7.2 如何防御原型污染？"></a>7.2 如何防御原型污染？</h2><p>（1）使用 Object.create(null)创建纯净对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> safeObj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);<br>safeObj.<span class="hljs-property">a</span> = <span class="hljs-number">1</span>;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(safeObj.<span class="hljs-property">hasOwnProperty</span>); <span class="hljs-comment">// undefined</span><br></code></pre></td></tr></table></figure>

<p>（2）安全的对象合并</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">safeMerge</span>(<span class="hljs-params">target, source</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(&#123;&#125;, target, source);<br>  <span class="hljs-comment">// 或使用展开运算符</span><br>  <span class="hljs-comment">// return &#123; ...target, ...source &#125;;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>（3）原型属性检查</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">setValue</span>(<span class="hljs-params">obj, path, value</span>) &#123;<br>  <span class="hljs-keyword">const</span> parts = path.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>);<br>  <span class="hljs-keyword">let</span> current = obj;<br>  <br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; parts.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i++) &#123;<br>    <span class="hljs-keyword">if</span> (parts[i] === <span class="hljs-string">&#x27;__proto__&#x27;</span> || parts[i] === <span class="hljs-string">&#x27;constructor&#x27;</span>) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Prototype pollution attempt&#x27;</span>);<br>    &#125;<br>    <span class="hljs-comment">// ...其余逻辑</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>（4）使用 Map 代替 Object</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> safeMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();<br>safeMap.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;key&#x27;</span>, <span class="hljs-string">&#x27;value&#x27;</span>);<br><span class="hljs-comment">// 无法通过原型链污染</span><br></code></pre></td></tr></table></figure>

<p>（5）冻结原型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);<br><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">isAdmin</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 在严格模式下会报错</span><br></code></pre></td></tr></table></figure>

<h2 id="7-3-使用-WeakMap-替代原型扩展"><a href="#7-3-使用-WeakMap-替代原型扩展" class="headerlink" title="7.3 使用 WeakMap 替代原型扩展"></a>7.3 使用 <code>WeakMap</code> 替代原型扩展</h2><p><strong>传统原型扩展存在的问题</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 向原型添加方法</span><br><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">last</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];<br>&#125;;<br><br><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-title function_">last</span>()); <span class="hljs-comment">// 3</span><br></code></pre></td></tr></table></figure>

<p>（1）全局污染：影响所有同类对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> []) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key); <span class="hljs-comment">// 会输出 &quot;last&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>（2）命名冲突</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">last</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;A&#x27;</span> &#125;;<br><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">last</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;B&#x27;</span> &#125;; <span class="hljs-comment">// 被覆盖</span><br></code></pre></td></tr></table></figure>

<p>（3）安全风险</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 恶意代码可能修改原生方法</span><br><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">map</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">/* 恶意操作 */</span> &#125;;<br></code></pre></td></tr></table></figure>

<p><strong>替代方案</strong></p>
<p>（1）私有数据存储模式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> privateData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) &#123;<br>    privateData.<span class="hljs-title function_">set</span>(<span class="hljs-variable language_">this</span>, &#123; name &#125;);<br>  &#125;<br>  <br>  <span class="hljs-title function_">getName</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> privateData.<span class="hljs-title function_">get</span>(<span class="hljs-variable language_">this</span>).<span class="hljs-property">name</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;Alice&#x27;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-title function_">getName</span>()); <span class="hljs-comment">// &quot;Alice&quot;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">name</span>);      <span class="hljs-comment">// undefined</span><br></code></pre></td></tr></table></figure>

<p>（2）方法扩展替代方案</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> arrayExtensions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">extendArray</span>(<span class="hljs-params">arr</span>) &#123;<br>  <span class="hljs-keyword">if</span> (!arrayExtensions.<span class="hljs-title function_">has</span>(arr)) &#123;<br>    arrayExtensions.<span class="hljs-title function_">set</span>(arr, &#123;<br>      <span class="hljs-attr">last</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];<br>      &#125;<br>    &#125;);<br>    <br>    <span class="hljs-comment">// 将方法绑定到实例</span><br>    arr.<span class="hljs-property">last</span> = arrayExtensions.<span class="hljs-title function_">get</span>(arr).<span class="hljs-property">last</span>.<span class="hljs-title function_">bind</span>(arr);<br>  &#125;<br>  <span class="hljs-keyword">return</span> arr;<br>&#125;<br><br><span class="hljs-keyword">const</span> myArr = <span class="hljs-title function_">extendArray</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myArr.<span class="hljs-title function_">last</span>()); <span class="hljs-comment">// 3</span><br><br><span class="hljs-comment">// 不影响其他数组</span><br><span class="hljs-keyword">const</span> normalArr = [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>];<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(normalArr.<span class="hljs-property">last</span>); <span class="hljs-comment">// undefined</span><br></code></pre></td></tr></table></figure>

<p>（3）元数据关联模式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> metadata = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">addMetadata</span>(<span class="hljs-params">obj, data</span>) &#123;<br>  metadata.<span class="hljs-title function_">set</span>(obj, data);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getMetadata</span>(<span class="hljs-params">obj</span>) &#123;<br>  <span class="hljs-keyword">return</span> metadata.<span class="hljs-title function_">get</span>(obj);<br>&#125;<br><br><span class="hljs-keyword">const</span> obj = &#123;&#125;;<br><span class="hljs-title function_">addMetadata</span>(obj, &#123; <span class="hljs-attr">created</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() &#125;);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getMetadata</span>(obj)); <span class="hljs-comment">// &#123; created: 162... &#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="7-4-性能优化：减少原型链深度"><a href="#7-4-性能优化：减少原型链深度" class="headerlink" title="7.4 性能优化：减少原型链深度"></a>7.4 性能优化：减少原型链深度</h2><p><strong>原型链深度对性能的影响机制</strong></p>
<ul>
<li>属性查找：每级原型链增加 10% ～ 20% 的查找时间（V8 引擎数据）</li>
<li>缓存失效：现代 JavaScript 引擎的隐藏类优化会被过深原型链破坏</li>
<li>内存占用：每级原型链需要额外的内存存储引用</li>
</ul>
<p><strong>测试原型链深度的影响</strong></p>
<p>基准测试用例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 创建不同深度的原型链</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createChain</span>(<span class="hljs-params">depth</span>) &#123;<br>  <span class="hljs-keyword">let</span> current = &#123;&#125;;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; depth; i++) &#123;<br>    <span class="hljs-keyword">const</span> newObj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(current);<br>    newObj[<span class="hljs-string">`prop<span class="hljs-subst">$&#123;i&#125;</span>`</span>] = i;<br>    current = newObj;<br>  &#125;<br>  <span class="hljs-keyword">return</span> current;<br>&#125;<br><br><span class="hljs-comment">// 测试属性访问速度</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">testAccess</span>(<span class="hljs-params">obj, prop</span>) &#123;<br>  <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++) &#123;<br>    obj[prop];<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start;<br>&#125;<br><br><span class="hljs-keyword">const</span> depths = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>];<br>depths.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">depth</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> obj = <span class="hljs-title function_">createChain</span>(depth);<br>  <span class="hljs-keyword">const</span> time = <span class="hljs-title function_">testAccess</span>(obj, <span class="hljs-string">`prop<span class="hljs-subst">$&#123;depth-<span class="hljs-number">1</span>&#125;</span>`</span>);<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Depth <span class="hljs-subst">$&#123;depth&#125;</span>: <span class="hljs-subst">$&#123;time.toFixed(<span class="hljs-number">2</span>)&#125;</span>ms`</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>测试结果（Chrome 137.0.7151.120（正式版本） (x86_64)）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title class_">Depth</span> <span class="hljs-number">1</span>: <span class="hljs-number">3.</span>00ms<br><span class="hljs-title class_">Depth</span> <span class="hljs-number">3</span>: <span class="hljs-number">11.</span>00ms<br><span class="hljs-title class_">Depth</span> <span class="hljs-number">5</span>: <span class="hljs-number">12.</span>00ms<br><span class="hljs-title class_">Depth</span> <span class="hljs-number">10</span>: <span class="hljs-number">10.</span>00ms<br></code></pre></td></tr></table></figure>

<p><strong>优化策略</strong></p>
<p>（1）扁平化继承结构</p>
<p>优化前（传统深继承）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123; <span class="hljs-title function_">methodA</span>(<span class="hljs-params"></span>) &#123;&#125; &#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">A</span> &#123; <span class="hljs-title function_">methodB</span>(<span class="hljs-params"></span>) &#123;&#125; &#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">B</span> &#123; <span class="hljs-title function_">methodC</span>(<span class="hljs-params"></span>) &#123;&#125; &#125;<br><span class="hljs-comment">// 原型链：C → B → A → Object</span><br></code></pre></td></tr></table></figure>

<p>优化后（组合+扁平）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">methods</span> = &#123;<br>      ...<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./methodA&#x27;</span>),<br>      ...<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./methodB&#x27;</span>),<br>      ...<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./methodC&#x27;</span>)<br>    &#125;;<br>  &#125;<br>  <br>  <span class="hljs-title function_">methodA</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">methods</span>.<span class="hljs-property">methodA</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>); &#125;<br>  <span class="hljs-title function_">methodB</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">methods</span>.<span class="hljs-property">methodB</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>); &#125;<br>  <span class="hljs-title function_">methodC</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">methods</span>.<span class="hljs-property">methodC</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>); &#125;<br>&#125;<br><span class="hljs-comment">// 原型链：Base → Object</span><br></code></pre></td></tr></table></figure>

<p>（2）方法直接挂载实例</p>
<p>优化前：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = heavyData;<br>  &#125;<br>  <br>  <span class="hljs-title function_">process</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">/* 频繁调用的方法 */</span> &#125;<br>&#125;<br><span class="hljs-comment">// 方法在原型上，每次访问需要查链</span><br></code></pre></td></tr></table></figure>

<p>优化后：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = heavyData;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">process</span> = <span class="hljs-function">() =&gt;</span> &#123; <span class="hljs-comment">/* 直接绑定到实例 */</span> &#125;;<br>  &#125;<br>&#125;<br><span class="hljs-comment">// 首次创建成本稍高，但访问更快</span><br></code></pre></td></tr></table></figure>

<p>（3）使用对象组合替代继承</p>
<p>优化前：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123; <span class="hljs-comment">/* 基础方法 */</span> &#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Admin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">User</span> &#123; <span class="hljs-comment">/* 特权方法 */</span> &#125;<br><span class="hljs-comment">// 原型链深度：2</span><br></code></pre></td></tr></table></figure>

<p>优化后：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> userMethods = &#123; <span class="hljs-comment">/* 基础方法 */</span> &#125;;<br><span class="hljs-keyword">const</span> adminMethods = &#123; <span class="hljs-comment">/* 特权方法 */</span> &#125;;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createAdmin</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(&#123;&#125;, userMethods, adminMethods);<br>&#125;<br><span class="hljs-comment">// 原型链深度：0</span><br></code></pre></td></tr></table></figure>

<p>（4）选择性缓存高频访问方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HeavyUsedClass</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// 缓存高频方法引用</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">frequentMethod</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">frequentMethod</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);<br>  &#125;<br>  <br>  <span class="hljs-title function_">frequentMethod</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">/* ... */</span> &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HeavyUsedClass</span>();<br><span class="hljs-comment">// 后续调用直接使用 instance.frequentMethod() 不需要查原型链</span><br></code></pre></td></tr></table></figure>

<h1 id="第八章：内置对象的原型结构"><a href="#第八章：内置对象的原型结构" class="headerlink" title="第八章：内置对象的原型结构"></a>第八章：内置对象的原型结构</h1><h2 id="8-1-数组的原型链：Array-prototype"><a href="#8-1-数组的原型链：Array-prototype" class="headerlink" title="8.1 数组的原型链：Array.prototype"></a>8.1 数组的原型链：<code>Array.prototype</code></h2><p>JavaScript 中数组的原型链遵循以下层次结构</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">[实际数组实例] <br>→ Array.prototype <br>  → Object.prototype<br>    → null<br></code></pre></td></tr></table></figure>

<p><strong>Array.prototype 层详解 - 核心方法分类</strong></p>
<table>
<thead>
<tr>
<th align="left">方法类型</th>
<th align="left">示例方法</th>
<th align="left">ES版本</th>
</tr>
</thead>
<tbody><tr>
<td align="left">修改器方法</td>
<td align="left">push(), pop(), splice(), sort()</td>
<td align="left">ES1</td>
</tr>
<tr>
<td align="left">访问方法</td>
<td align="left">concat(), slice(), join()</td>
<td align="left">ES1</td>
</tr>
<tr>
<td align="left">迭代方法</td>
<td align="left">forEach(), map(), filter()</td>
<td align="left">ES5</td>
</tr>
<tr>
<td align="left">查找方法</td>
<td align="left">find(), findIndex(), includes()</td>
<td align="left">ES6+</td>
</tr>
<tr>
<td align="left">转换方法</td>
<td align="left">toString(), toLocaleString()</td>
<td align="left">ES1</td>
</tr>
</tbody></table>
<h2 id="8-2-函数的原型链：Function-prototype"><a href="#8-2-函数的原型链：Function-prototype" class="headerlink" title="8.2 函数的原型链：Function.prototype"></a>8.2 函数的原型链：<code>Function.prototype</code></h2><p><strong>函数原型链层次结构</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">[函数实例]<br>→ Function.prototype<br>  → Object.prototype<br>    → null<br></code></pre></td></tr></table></figure>

<p><strong>Function.prototype 层详解 - 核心方法分类</strong></p>
<table>
<thead>
<tr>
<th align="left">方法名</th>
<th align="left">作用描述</th>
<th align="left">返回类型</th>
</tr>
</thead>
<tbody><tr>
<td align="left">apply()</td>
<td align="left">指定this值并以数组形式传参</td>
<td align="left">函数返回值</td>
</tr>
<tr>
<td align="left">call()</td>
<td align="left">指定this值并逐个传参</td>
<td align="left">函数返回值</td>
</tr>
<tr>
<td align="left">bind()</td>
<td align="left">创建绑定this的新函数</td>
<td align="left">函数</td>
</tr>
<tr>
<td align="left">toString()</td>
<td align="left">返回函数源码字符串</td>
<td align="left">字符串</td>
</tr>
</tbody></table>
<p><strong>特殊行为</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// Function.prototype 本身是一个函数</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// &quot;function&quot;</span><br><br><span class="hljs-comment">// 但无法正常调用</span><br><span class="hljs-keyword">try</span> &#123;<br>  <span class="hljs-title class_">Function</span>.<span class="hljs-title function_">prototype</span>();<br>&#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e); <span class="hljs-comment">// TypeError: Function.prototype requires &#x27;this&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="8-3-包装类型（String-Number-Boolean）的原型"><a href="#8-3-包装类型（String-Number-Boolean）的原型" class="headerlink" title="8.3 包装类型（String&#x2F;Number&#x2F;Boolean）的原型"></a>8.3 包装类型（String&#x2F;Number&#x2F;Boolean）的原型</h2><p>JavaScript 中的基本类型（string&#x2F;number&#x2F;boolean）在被当成对象使用时，会被自动转换为对应的包装对象，这些包装对象拥有各自的原型链结构</p>
<p><strong>String 包装类型</strong></p>
<p>原型链结构如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">[String实例]<br>→ String.prototype<br>  → Object.prototype<br>    → null<br></code></pre></td></tr></table></figure>

<p>String.prototype 的核心方法有：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 字符串操作方法</span><br><span class="hljs-string">&#x27;abc&#x27;</span>.<span class="hljs-title function_">concat</span>(<span class="hljs-string">&#x27;def&#x27;</span>)      <span class="hljs-comment">// &#x27;abcdef&#x27;</span><br><span class="hljs-string">&#x27;hello&#x27;</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)      <span class="hljs-comment">// &#x27;el&#x27;</span><br><span class="hljs-string">&#x27;ABC&#x27;</span>.<span class="hljs-title function_">toLowerCase</span>()      <span class="hljs-comment">// &#x27;abc&#x27;</span><br><br><span class="hljs-comment">// ES6+ 新增方法</span><br><span class="hljs-string">&#x27;  abc  &#x27;</span>.<span class="hljs-title function_">trim</span>()         <span class="hljs-comment">// &#x27;abc&#x27;</span><br><span class="hljs-string">&#x27;hello&#x27;</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;he&#x27;</span>) <span class="hljs-comment">// true</span><br><span class="hljs-string">&#x27;abc&#x27;</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">2</span>)          <span class="hljs-comment">// &#x27;abcabc&#x27;</span><br><br><span class="hljs-comment">// 迭代方法</span><br><span class="hljs-string">&#x27;😊&#x27;</span>.<span class="hljs-title function_">codePointAt</span>(<span class="hljs-number">0</span>)      <span class="hljs-comment">// 128522</span><br></code></pre></td></tr></table></figure>

<p><strong>Number 包装类型</strong></p>
<p>原型链结构如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">[Number实例]<br>→ Number.prototype<br>  → Object.prototype<br>    → null<br></code></pre></td></tr></table></figure>

<p>Number.prototype 核心方法:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 转换方法</span><br>(<span class="hljs-number">123.456</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>)    <span class="hljs-comment">// &#x27;123.46&#x27;</span><br>(<span class="hljs-number">255</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)      <span class="hljs-comment">// &#x27;ff&#x27;</span><br><br><span class="hljs-comment">// ES6+ 新增方法</span><br><span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isInteger</span>(<span class="hljs-number">5.0</span>)   <span class="hljs-comment">// true</span><br>(<span class="hljs-number">1000</span>).<span class="hljs-title function_">toExponential</span>()  <span class="hljs-comment">// &#x27;1e+3&#x27;</span><br><br><span class="hljs-comment">// 数值格式化</span><br>(<span class="hljs-number">123456.789</span>).<span class="hljs-title function_">toLocaleString</span>(<span class="hljs-string">&#x27;de-DE&#x27;</span>) <span class="hljs-comment">// &#x27;123.456,789&#x27;</span><br></code></pre></td></tr></table></figure>

<p><strong>Boolean 包装类型</strong></p>
<p>原型链结构：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">[Boolean实例]<br>→ Boolean.prototype<br>  → Object.prototype<br>    → null<br></code></pre></td></tr></table></figure>

<p>Boolean.prototype 方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 基本方法</span><br><span class="hljs-literal">true</span>.<span class="hljs-title function_">toString</span>()         <span class="hljs-comment">// &#x27;true&#x27;</span><br><span class="hljs-literal">false</span>.<span class="hljs-title function_">valueOf</span>()         <span class="hljs-comment">// false</span><br><br><span class="hljs-comment">// 注意：Boolean包装对象的方法较少</span><br></code></pre></td></tr></table></figure>

<p><strong>自动装箱与拆箱机制</strong></p>
<p>（1）自动装箱</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 原始值访问属性时自动创建包装对象</span><br><span class="hljs-keyword">const</span> str = <span class="hljs-string">&#x27;hello&#x27;</span>;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-property">length</span>); <span class="hljs-comment">// 5 (临时创建String对象)</span><br><br><span class="hljs-comment">// 等价于</span><br><span class="hljs-keyword">const</span> temp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(str);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(temp.<span class="hljs-property">length</span>);<br>temp = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 使用后立即销毁</span><br></code></pre></td></tr></table></figure>

<p>（2）手动装箱与拆箱</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 手动创建包装对象</span><br><span class="hljs-keyword">const</span> strObj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&#x27;hello&#x27;</span>);<br><span class="hljs-keyword">const</span> numObj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Number</span>(<span class="hljs-number">123</span>);<br><span class="hljs-keyword">const</span> boolObj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Boolean</span>(<span class="hljs-literal">true</span>);<br><br><span class="hljs-comment">// 拆箱操作</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(strObj.<span class="hljs-title function_">valueOf</span>()); <span class="hljs-comment">// &#x27;hello&#x27;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numObj + <span class="hljs-number">1</span>);      <span class="hljs-comment">// 124 (自动调用valueOf)</span><br></code></pre></td></tr></table></figure>

<p><strong>原始值与包装对象的区别</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">typeof</span> <span class="hljs-string">&#x27;hello&#x27;</span>           <span class="hljs-comment">// &#x27;string&#x27;</span><br><span class="hljs-keyword">typeof</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&#x27;hello&#x27;</span>) <span class="hljs-comment">// &#x27;object&#x27;</span><br><br><span class="hljs-string">&#x27;hello&#x27;</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">String</span>   <span class="hljs-comment">// false</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&#x27;hello&#x27;</span>) <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">String</span> <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>

<p><strong>valueOf() 的重要性</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> numObj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Number</span>(<span class="hljs-number">42</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numObj === <span class="hljs-number">42</span>);       <span class="hljs-comment">// false</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numObj.<span class="hljs-title function_">valueOf</span>() === <span class="hljs-number">42</span>); <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>

<h2 id="8-4-修改内置原型的风险与最佳实践"><a href="#8-4-修改内置原型的风险与最佳实践" class="headerlink" title="8.4 修改内置原型的风险与最佳实践"></a>8.4 修改内置原型的风险与最佳实践</h2><p><strong>主要风险</strong></p>
<p>（1）全局污染</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 默认添加的属性是可枚举的</span><br><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">customMethod</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;&#125;;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> []) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key); <span class="hljs-comment">// 会输出 &quot;customMethod&quot; (污染for-in循环)</span><br>&#125;<br><br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// 包含自定义方法</span><br></code></pre></td></tr></table></figure>

<p>（2）命名冲突和覆盖风险</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 不同库可能修改同一原型</span><br><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">find</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">/* A库的实现 */</span> &#125;;<br><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">find</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">/* B库的实现 */</span> &#125;; <span class="hljs-comment">// 后者覆盖前者</span><br><br><span class="hljs-comment">// 未来ECMAScript标准可能引入同名方法</span><br><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">includes</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">/* 自定义实现 */</span> &#125;;<br><span class="hljs-comment">// 当ES2016引入标准includes方法时产生冲突</span><br></code></pre></td></tr></table></figure>

<p>（3）性能影响</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 修改原型会破坏引擎优化</span><br><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">newMethod</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;&#125;;<br><br><span class="hljs-comment">// V8引擎的隐藏类机制受影响</span><br><span class="hljs-keyword">const</span> obj = &#123;&#125;;<br>obj.<span class="hljs-title function_">newMethod</span>(); <span class="hljs-comment">// 触发隐藏类转换，降低性能</span><br></code></pre></td></tr></table></figure>

<p>（4）安全漏洞</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 污染toString方法</span><br><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;script&gt;maliciousCode()&lt;/script&gt;&#x27;</span>;<br>&#125;;<br><br><span class="hljs-comment">// 当系统调用toString时</span><br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHTML</span> = someObject.<span class="hljs-title function_">toString</span>(); <span class="hljs-comment">// 执行恶意代码</span><br></code></pre></td></tr></table></figure>

<p>（5）预期外行为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 修改基础对象原型会影响所有对象</span><br><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">isEmpty</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(<span class="hljs-variable language_">this</span>).<span class="hljs-property">length</span> === <span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-comment">// 意外影响第三方代码</span><br><span class="hljs-keyword">const</span> set = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();<br>set.<span class="hljs-title function_">isEmpty</span>(); <span class="hljs-comment">// 抛出TypeError（Set没有keys方法）</span><br></code></pre></td></tr></table></figure>

<p><strong>最佳实践</strong></p>
<p>（1）安全扩展模式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 使用Object.defineProperty控制属性特性</span><br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, <span class="hljs-string">&#x27;safeMethod&#x27;</span>, &#123;<br>  <span class="hljs-attr">value</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">/* 实现 */</span> &#125;,<br>  <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>,      <span class="hljs-comment">// 允许后续修改</span><br>  <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,   <span class="hljs-comment">// 不会出现在for-in循环</span><br>  <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>   <span class="hljs-comment">// 允许后续删除</span><br>&#125;);<br><br><span class="hljs-comment">// 检查方法是否已存在</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">safeMethod</span>) &#123;<br>  <span class="hljs-comment">// 安全添加</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>（2）使用 Symbol 作为键</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 创建唯一Symbol键</span><br><span class="hljs-keyword">const</span> arrayUniqueMethod = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">&#x27;arrayUniqueMethod&#x27;</span>);<br><br><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>[arrayUniqueMethod] = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(<span class="hljs-variable language_">this</span>)];<br>&#125;;<br><br>[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>][arrayUniqueMethod](); <span class="hljs-comment">// [1,2,3]</span><br></code></pre></td></tr></table></figure>

<p>（3）模块化扩展模式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 不修改原型，提供工具函数</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ArrayUtils</span> = &#123;<br>  <span class="hljs-attr">unique</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">arr</span>) &#123;<br>    <span class="hljs-keyword">return</span> [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(arr)];<br>  &#125;,<br>  <span class="hljs-attr">shuffle</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">arr</span>) &#123; <span class="hljs-comment">/* ... */</span> &#125;<br>&#125;;<br><br><span class="hljs-comment">// 使用方式</span><br><span class="hljs-title class_">ArrayUtils</span>.<span class="hljs-title function_">unique</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]);<br></code></pre></td></tr></table></figure>

<p>（4）子类化替代方案</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeArray</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Array</span> &#123;<br>  <span class="hljs-title function_">unique</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(<span class="hljs-variable language_">this</span>)];<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SafeArray</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>);<br>arr.<span class="hljs-title function_">unique</span>(); <span class="hljs-comment">// [1,2,3]</span><br></code></pre></td></tr></table></figure>

<p>（5）使用 Proxy 封装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createEnhancedArray</span>(<span class="hljs-params">arr</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(arr, &#123;<br>    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, prop</span>) &#123;<br>      <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">&#x27;unique&#x27;</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(target)];<br>      &#125;<br>      <span class="hljs-keyword">return</span> target[prop];<br>    &#125;<br>  &#125;);<br>&#125;<br><br><span class="hljs-keyword">const</span> arr = <span class="hljs-title function_">createEnhancedArray</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]);<br>arr.<span class="hljs-title function_">unique</span>(); <span class="hljs-comment">// [1,2,3]</span><br></code></pre></td></tr></table></figure>

<p><strong>决策流程</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs text">是否需要修改内置原型？<br>├─ 是 → <br>│  ├─ 是否为标准Polyfill？ → 使用Object.defineProperty规范实现<br>│  ├─ 是否为项目特有需求？ → 考虑子类化或工具函数<br>│  └─ 是否影响第三方代码？ → 全面测试兼容性<br>└─ 否 → <br>   ├─ 使用工具函数/模块<br>   ├─ 使用现代语法特性<br>   └─ 考虑函数组合模式<br></code></pre></td></tr></table></figure>

<p><strong>总结建议</strong></p>
<ol>
<li>基本原则：永远不要修改 Object.prototype；避免修改其他内置原型，除非绝对必要；</li>
<li>必须修改时要有安全措施</li>
<li>长期维护考量：记录所有内置原型修改；为自定义方法&#x2F;属性添加前缀（比如<code>_myLibUnique</code>）；定期检查与最新 ECMAScript 标准的兼容性</li>
<li>团队协作规范：代码 review 中严格检查原型修改；使用 ESLint 规则限制；项目文档中明确记录扩展方法</li>
</ol>
<h1 id="第九章：现代-JavaScript-中的原型"><a href="#第九章：现代-JavaScript-中的原型" class="headerlink" title="第九章：现代 JavaScript 中的原型"></a>第九章：现代 JavaScript 中的原型</h1><h2 id="9-1-ES6-class-语法糖的本质"><a href="#9-1-ES6-class-语法糖的本质" class="headerlink" title="9.1 ES6 class 语法糖的本质"></a>9.1 ES6 <code>class</code> 语法糖的本质</h2><p>class 语法并非 ES6 全新引入的面向对象的继承模型，而是 JavaScript 现有的原型继承的语法糖</p>
<p><strong>结构对比</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ES5构造函数写法</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>&#125;<br><br><span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Hello, &#x27;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);<br>&#125;;<br><br><span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;Alice&#x27;</span>);<br><br><span class="hljs-comment">// ES6 class 写法</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>  &#125;<br><br>  <span class="hljs-title function_">sayHello</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.name&#125;</span>`</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;Alice&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p><strong>Babel 转译后的代码</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-meta">&quot;use strict&quot;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">_classCallCheck</span>(<span class="hljs-params">instance, Constructor</span>) &#123;<br>  <span class="hljs-keyword">if</span> (!(instance <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Constructor</span>)) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">&quot;Cannot call a class as a function&quot;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">_defineProperties</span>(<span class="hljs-params">target, props</span>) &#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; props.<span class="hljs-property">length</span>; i++) &#123;<br>    <span class="hljs-keyword">var</span> descriptor = props[i];<br>    descriptor.<span class="hljs-property">enumerable</span> = descriptor.<span class="hljs-property">enumerable</span> || <span class="hljs-literal">false</span>;<br>    descriptor.<span class="hljs-property">configurable</span> = <span class="hljs-literal">true</span>;<br>    descriptor.<span class="hljs-property">writable</span> = <span class="hljs-literal">true</span>;<br>    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(target, descriptor.<span class="hljs-property">key</span>, descriptor);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">_createClass</span>(<span class="hljs-params">Constructor, protoProps, staticProps</span>) &#123;<br>  <span class="hljs-keyword">if</span> (protoProps) <span class="hljs-title function_">_defineProperties</span>(<span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, protoProps);<br>  <span class="hljs-keyword">if</span> (staticProps) <span class="hljs-title function_">_defineProperties</span>(<span class="hljs-title class_">Constructor</span>, staticProps);<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Constructor</span>;<br>&#125;<br><br><span class="hljs-keyword">var</span> <span class="hljs-title class_">Person</span> = <span class="hljs-comment">/*#__PURE__*/</span><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) &#123;<br>    <span class="hljs-title function_">_classCallCheck</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-title class_">Person</span>);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>  &#125;<br><br>  <span class="hljs-title function_">_createClass</span>(<span class="hljs-title class_">Person</span>, [&#123;<br>    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;sayHello&quot;</span>,<br>    <span class="hljs-attr">value</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">sayHello</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Hello, &quot;</span>.<span class="hljs-title function_">concat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>));<br>    &#125;<br>  &#125;]);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Person</span>;<br>&#125;();<br></code></pre></td></tr></table></figure>

<p><strong>核心特性解析</strong></p>
<p>（1）构造函数对应关系</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Foo</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">bar</span> = <span class="hljs-string">&#x27;baz&#x27;</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 等价于</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Foo</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">bar</span> = <span class="hljs-string">&#x27;baz&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>（2）方法定义本质</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Foo</span> &#123;<br>  <span class="hljs-title function_">method</span>(<span class="hljs-params"></span>) &#123;&#125;<br>&#125;<br><br><span class="hljs-comment">// 等价于</span><br><span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">method</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;&#125;;<br></code></pre></td></tr></table></figure>

<p>（3）静态成员实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Foo</span> &#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">staticMethod</span>(<span class="hljs-params"></span>) &#123;&#125;<br>&#125;<br><br><span class="hljs-comment">// 等价于</span><br><span class="hljs-title class_">Foo</span>.<span class="hljs-property">staticMethod</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;&#125;;<br></code></pre></td></tr></table></figure>

<p>（4）继承机制原理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Parent</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">super</span>();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 近似等价于</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title class_">Parent</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>);<br>&#125;<br><br><span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);<br><span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Child</span>;<br></code></pre></td></tr></table></figure>

<p><strong>本质特性</strong></p>
<ul>
<li>原型继承的语法糖：没有引入新继承模型</li>
<li>更严格的语法：强制使用 new，默认严格模式</li>
<li>更清晰的封装：明确区分构造函数、方法和静态成员</li>
<li>更好的可读性：类似传统OOP语言的语法结构</li>
<li>不可枚举的方法：避免 for-in 循环污染</li>
</ul>
<h2 id="9-2-super-关键字的原型链逻辑"><a href="#9-2-super-关键字的原型链逻辑" class="headerlink" title="9.2 super 关键字的原型链逻辑"></a>9.2 <code>super</code> 关键字的原型链逻辑</h2><p>super 是 ES6 class 中用于访问父类内容的关键字</p>
<p><strong>两种调用方式</strong></p>
<p>（1）作为函数调用（仅在构造函数中）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Parent</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, age</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(name); <span class="hljs-comment">// 调用父类构造函数</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>原型链逻辑如下：</p>
<ol>
<li>创建 Child 实例时，先调用 super() 相当于 Parent.call(this)</li>
<li>确保 this 先被父类初始化</li>
<li>建立正确的原型链关系：<code>ChildInstance.__proto__</code> → <code>Child.prototype.__proto__</code> → <code>Parent.prototype</code></li>
</ol>
<p>（2）作为对象引用（在方法中）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> &#123;<br>  <span class="hljs-title function_">sayHello</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello from Parent&#x27;</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Parent</span> &#123;<br>  <span class="hljs-title function_">sayHello</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">sayHello</span>() + <span class="hljs-string">&#x27; and Child&#x27;</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>原型链逻辑如下：</p>
<ol>
<li>super 指向父类原型：super &#x3D; Object.getPrototypeOf(Child.prototype)</li>
<li>方法调用时 this 仍指向当前实例</li>
<li>相当于 Parent.prototype.sayHello.call(this)</li>
</ol>
<p><strong>原型链查找机制</strong></p>
<p>（1）方法中的 super 查找路径</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123; <span class="hljs-title function_">method</span>(<span class="hljs-params"></span>) &#123;&#125; &#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">A</span> &#123; <span class="hljs-title function_">method</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">method</span>(); &#125; &#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">B</span> &#123; <span class="hljs-title function_">method</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">method</span>(); &#125; &#125;<br><br><span class="hljs-keyword">const</span> c = <span class="hljs-keyword">new</span> <span class="hljs-title function_">C</span>();<br>c.<span class="hljs-title function_">method</span>();<br></code></pre></td></tr></table></figure>

<p>其查找过程如下：</p>
<ol>
<li>C.prototype.method 中的 super → B.prototype</li>
<li>B.prototype.method 中的 super → A.prototype</li>
<li>最终调用 A.prototype.method</li>
</ol>
<p>（2）静态方法中的 super</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> &#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">staticMethod</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Parent static&#x27;</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Parent</span> &#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">staticMethod</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">staticMethod</span>() + <span class="hljs-string">&#x27; + Child static&#x27;</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>其查找逻辑：</p>
<ol>
<li>super 指向父类本身：super &#x3D; Object.getPrototypeOf(Child)</li>
<li>相当于 Parent.staticMethod.call(this)</li>
</ol>
<p><strong>底层实现原理</strong></p>
<p>（1）Babel 转译后的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Parent</span> &#123;<br>  <span class="hljs-title function_">method</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">parentMethod</span>();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 转译为</span><br><span class="hljs-keyword">var</span> <span class="hljs-title class_">Child</span> = (<span class="hljs-keyword">function</span>(<span class="hljs-params">_Parent</span>) &#123;<br>  <span class="hljs-title function_">_inherits</span>(<span class="hljs-title class_">Child</span>, _Parent);<br>  <br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">_classCallCheck</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-title class_">Child</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">_possibleConstructorReturn</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-title function_">_getPrototypeOf</span>(<span class="hljs-title class_">Child</span>).<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>));<br>  &#125;<br><br>  <span class="hljs-title function_">_createClass</span>(<span class="hljs-title class_">Child</span>, [&#123;<br>    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;method&quot;</span>,<br>    <span class="hljs-attr">value</span>: <span class="hljs-keyword">function</span> <span class="hljs-title function_">method</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title function_">_get</span>(<span class="hljs-title function_">_getPrototypeOf</span>(<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>), <span class="hljs-string">&quot;parentMethod&quot;</span>, <span class="hljs-variable language_">this</span>).<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>);<br>    &#125;<br>  &#125;]);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Child</span>;<br>&#125;)(<span class="hljs-title class_">Parent</span>);<br></code></pre></td></tr></table></figure>

<p>（2）关键帮助函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">_getPrototypeOf</span>(<span class="hljs-params">o</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(o);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">_get</span>(<span class="hljs-params">target, property, receiver</span>) &#123;<br>  <span class="hljs-comment">// 模拟 super 属性查找</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Reflect</span> !== <span class="hljs-string">&quot;undefined&quot;</span> &amp;&amp; <span class="hljs-title class_">Reflect</span>.<span class="hljs-property">get</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, property, receiver || <span class="hljs-variable language_">this</span>);<br>  &#125;<br>  <span class="hljs-keyword">var</span> base = <span class="hljs-title function_">_getPrototypeOf</span>(target);<br>  <span class="hljs-keyword">if</span> (!base) <span class="hljs-keyword">return</span>;<br>  <span class="hljs-keyword">var</span> desc = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertyDescriptor</span>(base, property);<br>  <span class="hljs-keyword">if</span> (desc.<span class="hljs-property">get</span>) &#123;<br>    <span class="hljs-keyword">return</span> desc.<span class="hljs-property">get</span>.<span class="hljs-title function_">call</span>(receiver || <span class="hljs-variable language_">this</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> base[property];<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="9-3-静态方法与原型的关系"><a href="#9-3-静态方法与原型的关系" class="headerlink" title="9.3 静态方法与原型的关系"></a>9.3 静态方法与原型的关系</h2><p>静态方法是 JavaScript 类中直接绑定到构造函数本身而非原型上的方法</p>
<p><strong>核心概念对比</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">静态方法</th>
<th align="left">原型方法</th>
</tr>
</thead>
<tbody><tr>
<td align="left">存储位置</td>
<td align="left">构造函数本身</td>
<td align="left">构造函数的 prototype 对象</td>
</tr>
<tr>
<td align="left">调用方式</td>
<td align="left">通过类名调用（ClassName.method()）</td>
<td align="left">通过实例调用（instance.method()）</td>
</tr>
<tr>
<td align="left">this 指向</td>
<td align="left">类构造函数</td>
<td align="left">实例对象</td>
</tr>
<tr>
<td align="left">继承行为</td>
<td align="left">可被子类继承</td>
<td align="left">实例可访问</td>
</tr>
<tr>
<td align="left">使用场景</td>
<td align="left">工具方法&#x2F;工厂方法</td>
<td align="left">实例相关操作</td>
</tr>
</tbody></table>
<p><strong>内存结构与原型链分析</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> &#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">staticMethod</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Static&#x27;</span>);<br>  &#125;<br>  <br>  <span class="hljs-title function_">prototypeMethod</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Prototype&#x27;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 内存结构等价于：</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyClass</span>(<span class="hljs-params"></span>) &#123;&#125;<br><br><span class="hljs-comment">// 静态方法（直接挂载构造函数）</span><br><span class="hljs-title class_">MyClass</span>.<span class="hljs-property">staticMethod</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Static&#x27;</span>);<br>&#125;;<br><br><span class="hljs-comment">// 原型方法</span><br><span class="hljs-title class_">MyClass</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">prototypeMethod</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Prototype&#x27;</span>);<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>底层实现（Babel 转译）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 静态方法继承的实现</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">_inherits</span>(<span class="hljs-params">subClass, superClass</span>) &#123;<br>  <span class="hljs-comment">// 设置原型继承</span><br>  subClass.<span class="hljs-property">__proto__</span> = superClass;<br>  <br>  <span class="hljs-comment">// 复制静态方法</span><br>  <span class="hljs-keyword">if</span> (superClass) &#123;<br>    <span class="hljs-title class_">Object</span>.<span class="hljs-property">setPrototypeOf</span> <br>      ? <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(subClass, superClass)<br>      : subClass.<span class="hljs-property">__proto__</span> = superClass;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="9-4-符号属性（Symbol）对原型的影响"><a href="#9-4-符号属性（Symbol）对原型的影响" class="headerlink" title="9.4 符号属性（Symbol）对原型的影响"></a>9.4 符号属性（Symbol）对原型的影响</h2><p><strong>Symbol 在原型系统中的行为</strong></p>
<p>（1）原型上的 Symbol 属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> customMethod = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">&#x27;custom&#x27;</span>);<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> &#123;<br>  [customMethod]() &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Symbol method called&#x27;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyClass</span>();<br>instance[customMethod](); <span class="hljs-comment">// &quot;Symbol method called&quot;</span><br><br><span class="hljs-comment">// 检查原型链</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(customMethod <span class="hljs-keyword">in</span> <span class="hljs-title class_">MyClass</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(instance.<span class="hljs-title function_">hasOwnProperty</span>(customMethod)); <span class="hljs-comment">// false</span><br></code></pre></td></tr></table></figure>

<p>（2）内置 Symbol 与原型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomIterable</span> &#123;<br>  *[<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]() &#123;<br>    <span class="hljs-keyword">yield</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">yield</span> <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">yield</span> <span class="hljs-number">3</span>;<br>  &#125;<br>&#125;<br><br>[...<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomIterable</span>()]; <span class="hljs-comment">// [1, 2, 3]</span><br></code></pre></td></tr></table></figure>

<p><strong>Symbol 对原型系统的特殊影响</strong></p>
<p>（1）避免属性名冲突</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 不同库安全扩展原型</span><br><span class="hljs-keyword">const</span> lib1Method = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">&#x27;lib1&#x27;</span>);<br><span class="hljs-keyword">const</span> lib2Method = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">&#x27;lib2&#x27;</span>);<br><br><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>[lib1Method] = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">/* Lib1实现 */</span> &#125;;<br><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>[lib2Method] = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">/* Lib2实现 */</span> &#125;;<br><br><span class="hljs-comment">// 互不干扰</span><br>[][lib1Method]();<br>[][lib2Method]();<br></code></pre></td></tr></table></figure>

<p>（2）隐藏原型方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> internalLogic = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">&#x27;internal&#x27;</span>);<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SecureAPI</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">publicData</span> = <span class="hljs-string">&#x27;safe&#x27;</span>;<br>  &#125;<br>  <br>  [internalLogic]() &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;内部处理逻辑&#x27;</span>);<br>  &#125;<br>  <br>  <span class="hljs-title function_">publicMethod</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>[internalLogic]();<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">publicData</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> api = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecureAPI</span>();<br>api.<span class="hljs-title function_">publicMethod</span>(); <span class="hljs-comment">// 正常工作</span><br>api[internalLogic](); <span class="hljs-comment">// 报错：除非能获取Symbol引用</span><br></code></pre></td></tr></table></figure>

<p>（3）不可枚举性对原型遍历的影响</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>[<span class="hljs-title class_">Symbol</span>(<span class="hljs-string">&#x27;test&#x27;</span>)] = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;&#125;;<br><br><span class="hljs-comment">// 不影响常规遍历</span><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> []) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key); <span class="hljs-comment">// 无输出（无枚举属性）</span><br>&#125;<br><br><span class="hljs-comment">// 也不影响Object.keys</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)); <span class="hljs-comment">// 不包含Symbol属性</span><br></code></pre></td></tr></table></figure>

<p><strong>内置 Symbol 与原型行为定制</strong></p>
<p>（1）Symbol.hasInstance</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MySpecialArray</span> &#123;<br>  <span class="hljs-keyword">static</span> [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">hasInstance</span>](instance) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(instance);<br>  &#125;<br>&#125;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([] <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MySpecialArray</span>); <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>

<p>（2）Symbol.species</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyArray</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Array</span> &#123;<br>  <span class="hljs-keyword">static</span> get [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">species</span>]() &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>; <span class="hljs-comment">// 控制衍生对象的构造函数</span><br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> myArr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyArray</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>);<br><span class="hljs-keyword">const</span> mapped = myArr.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x*<span class="hljs-number">2</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mapped <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyArray</span>); <span class="hljs-comment">// false</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mapped <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>); <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>

<p>（3）Symbol.toStringTag</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCollection</span> &#123;<br>  get [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">toStringTag</span>]() &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;MyCollection&#x27;</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCollection</span>().<span class="hljs-title function_">toString</span>()); <br><span class="hljs-comment">// &quot;[object MyCollection]&quot;</span><br></code></pre></td></tr></table></figure>

<p><strong>Symbol 属性的继承</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> parentSymbol = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">&#x27;parent&#x27;</span>);<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> &#123;<br>  [parentSymbol]() &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Parent symbol method&#x27;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Parent</span> &#123;&#125;<br><br><span class="hljs-keyword">const</span> child = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>();<br>child[parentSymbol](); <span class="hljs-comment">// &quot;Parent symbol method&quot;</span><br><br><span class="hljs-comment">// 检查继承关系</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<br>  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertySymbols</span>(<span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>).<span class="hljs-title function_">includes</span>(parentSymbol)<br>); <span class="hljs-comment">// true</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<br>  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertySymbols</span>(<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>).<span class="hljs-title function_">includes</span>(parentSymbol)<br>); <span class="hljs-comment">// false（继承而非自有）</span><br></code></pre></td></tr></table></figure>

<h1 id="第十章：实战与面试题解析"><a href="#第十章：实战与面试题解析" class="headerlink" title="第十章：实战与面试题解析"></a>第十章：实战与面试题解析</h1><h2 id="10-1-手写-new-操作符实现"><a href="#10-1-手写-new-操作符实现" class="headerlink" title="10.1 手写 new 操作符实现"></a>10.1 手写 <code>new</code> 操作符实现</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">myNew</span>(<span class="hljs-params">Constructor, ...args</span>) &#123;<br>  <span class="hljs-comment">// 验证输入</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Constructor</span> !== <span class="hljs-string">&#x27;function&#x27;</span>) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">&#x27;First argument must be a function&#x27;</span>);<br>  &#125;<br>  <br>  <span class="hljs-comment">// 创建新对象并设置原型</span><br>  <span class="hljs-keyword">const</span> obj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);<br>  <br>  <span class="hljs-comment">// 执行构造函数</span><br>  <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Constructor</span>.<span class="hljs-title function_">apply</span>(obj, args);<br>  <br>  <span class="hljs-comment">// 处理返回值</span><br>  <span class="hljs-keyword">return</span> (result &amp;&amp; (<span class="hljs-keyword">typeof</span> result === <span class="hljs-string">&#x27;object&#x27;</span> || <span class="hljs-keyword">typeof</span> result === <span class="hljs-string">&#x27;function&#x27;</span>))<br>    ? result <br>    : obj;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="10-2-手写-Object-create"><a href="#10-2-手写-Object-create" class="headerlink" title="10.2 手写 Object.create"></a>10.2 手写 <code>Object.create</code></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">myObjectCreate</span>(<span class="hljs-params">proto</span>) &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> proto !== <span class="hljs-string">&#x27;object&#x27;</span> &amp;&amp; <span class="hljs-keyword">typeof</span> proto !== <span class="hljs-string">&#x27;function&#x27;</span> &amp;&amp; proto !== <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">&#x27;Object prototype may only be an Object or null&#x27;</span>);<br>  &#125;<br>  <br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">F</span>(<span class="hljs-params"></span>) &#123;&#125;<br>  F.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = proto;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">F</span>();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>使用示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> parent = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Parent&#x27;</span> &#125;;<br><span class="hljs-keyword">const</span> child = <span class="hljs-title function_">myObjectCreate</span>(parent);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-property">name</span>); <span class="hljs-comment">// &#x27;Parent&#x27;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(child) === parent); <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>

<h2 id="10-3-如何实现一个完美的深拷贝（处理原型链）"><a href="#10-3-如何实现一个完美的深拷贝（处理原型链）" class="headerlink" title="10.3 如何实现一个完美的深拷贝（处理原型链）"></a>10.3 如何实现一个完美的深拷贝（处理原型链）</h2><p><strong>完整代码</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">deepClone</span>(<span class="hljs-params">source, map = <span class="hljs-keyword">new</span> <span class="hljs-built_in">WeakMap</span>()</span>) &#123;<br>  <span class="hljs-comment">// 处理基本类型和函数</span><br>  <span class="hljs-keyword">if</span> (source === <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> source !== <span class="hljs-string">&#x27;object&#x27;</span>) &#123;<br>    <span class="hljs-keyword">return</span> source;<br>  &#125;<br><br>  <span class="hljs-comment">// 处理循环引用</span><br>  <span class="hljs-keyword">if</span> (map.<span class="hljs-title function_">has</span>(source)) &#123;<br>    <span class="hljs-keyword">return</span> map.<span class="hljs-title function_">get</span>(source);<br>  &#125;<br><br>  <span class="hljs-comment">// 获取原型</span><br>  <span class="hljs-keyword">const</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(source);<br>  <br>  <span class="hljs-comment">// 处理特殊对象类型</span><br>  <span class="hljs-keyword">if</span> (source <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(source);<br>  &#125;<br>  <br>  <span class="hljs-keyword">if</span> (source <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">RegExp</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(source);<br>  &#125;<br>  <br>  <span class="hljs-keyword">if</span> (source <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Map</span>) &#123;<br>    <span class="hljs-keyword">const</span> cloneMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();<br>    map.<span class="hljs-title function_">set</span>(source, cloneMap);<br>    source.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">value, key</span>) =&gt;</span> &#123;<br>      cloneMap.<span class="hljs-title function_">set</span>(<span class="hljs-title function_">deepClone</span>(key, map), <span class="hljs-title function_">deepClone</span>(value, map));<br>    &#125;);<br>    <span class="hljs-keyword">return</span> cloneMap;<br>  &#125;<br>  <br>  <span class="hljs-keyword">if</span> (source <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Set</span>) &#123;<br>    <span class="hljs-keyword">const</span> cloneSet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();<br>    map.<span class="hljs-title function_">set</span>(source, cloneSet);<br>    source.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> &#123;<br>      cloneSet.<span class="hljs-title function_">add</span>(<span class="hljs-title function_">deepClone</span>(value, map));<br>    &#125;);<br>    <span class="hljs-keyword">return</span> cloneSet;<br>  &#125;<br>  <br>  <span class="hljs-keyword">if</span> (source <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ArrayBuffer</span>) &#123;<br>    <span class="hljs-keyword">return</span> source.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  <br>  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">ArrayBuffer</span>.<span class="hljs-title function_">isView</span>(source)) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> source.<span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span><br><span class="hljs-params">      source.buffer.slice(<span class="hljs-number">0</span>),</span><br><span class="hljs-params">      source.byteOffset,</span><br><span class="hljs-params">      source.byteLength</span><br><span class="hljs-params">    </span>);<br>  &#125;<br><br>  <span class="hljs-comment">// 创建目标对象并保留原型链</span><br>  <span class="hljs-keyword">let</span> target;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(source)) &#123;<br>    target = <span class="hljs-keyword">new</span> proto.<span class="hljs-title function_">constructor</span>(<span class="hljs-params">source.length</span>);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    target = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(proto);<br>  &#125;<br>  <br>  <span class="hljs-comment">// 记录已拷贝对象</span><br>  map.<span class="hljs-title function_">set</span>(source, target);<br><br>  <span class="hljs-comment">// 处理Symbol属性</span><br>  <span class="hljs-keyword">const</span> symbolKeys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertySymbols</span>(source);<br>  <span class="hljs-keyword">const</span> allKeys = [...<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(source), ...symbolKeys];<br>  <br>  <span class="hljs-comment">// 递归拷贝所有属性</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">of</span> allKeys) &#123;<br>    <span class="hljs-comment">// 跳过原型属性</span><br>    <span class="hljs-keyword">if</span> (!source.<span class="hljs-title function_">hasOwnProperty</span>(key)) <span class="hljs-keyword">continue</span>;<br>    <br>    <span class="hljs-comment">// 处理属性描述符</span><br>    <span class="hljs-keyword">const</span> descriptor = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertyDescriptor</span>(source, key);<br>    <span class="hljs-keyword">if</span> (descriptor &amp;&amp; !descriptor.<span class="hljs-property">enumerable</span>) <span class="hljs-keyword">continue</span>;<br>    <br>    target[key] = <span class="hljs-title function_">deepClone</span>(source[key], map);<br>  &#125;<br>  <br>  <span class="hljs-keyword">return</span> target;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>使用示例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 测试原型链保持</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>&#125;<br><span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">greet</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`Hello, <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.name&#125;</span>`</span>;<br>&#125;;<br><br><span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;Alice&#x27;</span>);<br><span class="hljs-keyword">const</span> clonedPerson = <span class="hljs-title function_">deepClone</span>(person);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-title function_">greet</span>()); <span class="hljs-comment">// &quot;Hello, Alice&quot;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(clonedPerson.<span class="hljs-title function_">greet</span>()); <span class="hljs-comment">// &quot;Hello, Alice&quot;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(clonedPerson) === <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span><br><br><span class="hljs-comment">// 测试循环引用</span><br><span class="hljs-keyword">const</span> obj = &#123; <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> &#125;;<br>obj.<span class="hljs-property">self</span> = obj;<br><span class="hljs-keyword">const</span> clonedObj = <span class="hljs-title function_">deepClone</span>(obj);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(clonedObj.<span class="hljs-property">self</span> === clonedObj); <span class="hljs-comment">// true</span><br><br><span class="hljs-comment">// 测试特殊对象</span><br><span class="hljs-keyword">const</span> map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-string">&#x27;key&#x27;</span>, <span class="hljs-string">&#x27;value&#x27;</span>]]);<br><span class="hljs-keyword">const</span> clonedMap = <span class="hljs-title function_">deepClone</span>(map);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(clonedMap.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;key&#x27;</span>)); <span class="hljs-comment">// &#x27;value&#x27;</span><br><br><span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br><span class="hljs-keyword">const</span> clonedDate = <span class="hljs-title function_">deepClone</span>(date);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(clonedDate.<span class="hljs-title function_">getTime</span>() === date.<span class="hljs-title function_">getTime</span>()); <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>

<p><strong>关键特性</strong></p>
<ul>
<li>原型链保留：<ul>
<li>使用 Object.create(proto) 创建对象</li>
<li>保持原型链不变</li>
</ul>
</li>
<li>循环引用处理：<ul>
<li>使用 WeakMap 跟踪已拷贝对象</li>
<li>避免无限递归</li>
</ul>
</li>
<li>全面类型支持：<ul>
<li>基本类型</li>
<li>对象&#x2F;数组</li>
<li>函数（直接引用）</li>
<li>Date&#x2F;RegExp</li>
<li>Map&#x2F;Set</li>
<li>ArrayBuffer&#x2F;TypedArray</li>
<li>Symbol 属性</li>
</ul>
</li>
<li>属性描述符处理：<ul>
<li>跳过不可枚举属性</li>
<li>保留属性特性</li>
</ul>
</li>
<li>性能优化：<ul>
<li>使用 WeakMap 避免内存泄漏</li>
<li>最小化属性遍历</li>
</ul>
</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/JavaScript/" class="category-chain-item">JavaScript</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/JavaScript/" class="print-no-link">#JavaScript</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>JavaScript 原型/原型链专题知识学习</div>
      <div>https://tianfei92.github.io/2025/06/21/JavaScript Prototype/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Ariel</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年6月21日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/06/22/CSS%20Study%20Notes/" title="CSS 专题知识学习">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">CSS 专题知识学习</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/06/20/Network%20Study%20Notes/" title="网络知识专题学习">
                        <span class="hidden-mobile">网络知识专题学习</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  



  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
