

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Ariel">
  <meta name="keywords" content="">
  
    <meta name="description" content="一、TypeScript 基础与核心概念1.1 类型系统深入1.1.1 基本类型与类型推断机制基本类型（Primitive Types）    类型 描述 示例    string 字符串类型 let name: string &#x3D; “Alice”   number 数值类型（含整数&#x2F;浮点数） let age: number &#x3D; 30   boolean 布尔类型 le">
<meta property="og:type" content="article">
<meta property="og:title" content="TypeScript 专题知识学习">
<meta property="og:url" content="https://tianfei92.github.io/2025/07/09/TypeScript%20Study%20Notes/index.html">
<meta property="og:site_name" content="Ariel&#39;s Blog">
<meta property="og:description" content="一、TypeScript 基础与核心概念1.1 类型系统深入1.1.1 基本类型与类型推断机制基本类型（Primitive Types）    类型 描述 示例    string 字符串类型 let name: string &#x3D; “Alice”   number 数值类型（含整数&#x2F;浮点数） let age: number &#x3D; 30   boolean 布尔类型 le">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-07-09T09:15:51.000Z">
<meta property="article:modified_time" content="2025-07-08T03:02:13.895Z">
<meta property="article:author" content="Ariel">
<meta property="article:tag" content="TypeScript">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>TypeScript 专题知识学习 - Ariel&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"tianfei92.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Ariel</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="TypeScript 专题知识学习"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-07-09 17:15" pubdate>
          2025年7月9日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          29k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          244 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">TypeScript 专题知识学习</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="一、TypeScript-基础与核心概念"><a href="#一、TypeScript-基础与核心概念" class="headerlink" title="一、TypeScript 基础与核心概念"></a>一、TypeScript 基础与核心概念</h1><h2 id="1-1-类型系统深入"><a href="#1-1-类型系统深入" class="headerlink" title="1.1 类型系统深入"></a>1.1 类型系统深入</h2><h3 id="1-1-1-基本类型与类型推断机制"><a href="#1-1-1-基本类型与类型推断机制" class="headerlink" title="1.1.1 基本类型与类型推断机制"></a>1.1.1 基本类型与类型推断机制</h3><p><strong>基本类型（Primitive Types）</strong></p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">描述</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">string</td>
<td align="left">字符串类型</td>
<td align="left">let name: string &#x3D; “Alice”</td>
</tr>
<tr>
<td align="left">number</td>
<td align="left">数值类型（含整数&#x2F;浮点数）</td>
<td align="left">let age: number &#x3D; 30</td>
</tr>
<tr>
<td align="left">boolean</td>
<td align="left">布尔类型</td>
<td align="left">let isDone: boolean &#x3D; true</td>
</tr>
<tr>
<td align="left">null</td>
<td align="left">空值（需开启 strictNullChecks）</td>
<td align="left">let n: null &#x3D; null</td>
</tr>
<tr>
<td align="left">undefined	未定义值</td>
<td align="left">let u: undefined &#x3D; undefined</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">symbol</td>
<td align="left">唯一标识符（ES6）</td>
<td align="left">const sym: symbol &#x3D; Symbol()</td>
</tr>
<tr>
<td align="left">bigint</td>
<td align="left">大整数（ES2020）</td>
<td align="left">let big: bigint &#x3D; 100n</td>
</tr>
<tr>
<td align="left">void</td>
<td align="left">无返回值（函数）</td>
<td align="left">function warn(): void { console.log() }</td>
</tr>
</tbody></table>
<span id="more"></span>

<p><strong>类型推断机制（Type Inference）</strong></p>
<p>(1) 变量初始化推断</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">let</span> a = <span class="hljs-number">10</span>;          <span class="hljs-comment">// 推断为 number</span><br><span class="hljs-keyword">const</span> b = <span class="hljs-string">&quot;text&quot;</span>;    <span class="hljs-comment">// 推断为 &quot;text&quot;（字面量类型）</span><br><span class="hljs-keyword">const</span> c = &#123; <span class="hljs-attr">x</span>: <span class="hljs-number">1</span> &#125;;  <span class="hljs-comment">// 推断为 &#123; x: number &#125;</span><br></code></pre></td></tr></table></figure>

<p>(2) 函数返回值推断</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params"><span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span></span>) &#123;<br>  <span class="hljs-keyword">return</span> x + y;      <span class="hljs-comment">// 自动推断返回 number</span><br>&#125;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">fn</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-literal">true</span>; <span class="hljs-comment">// 推断返回 boolean</span><br></code></pre></td></tr></table></figure>

<p>(3) 上下文推断（Contextual Typing）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 回调函数参数根据上下文推断类型</span><br>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>].<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> v * <span class="hljs-number">2</span>);       <span class="hljs-comment">// v 推断为 number</span><br><br><span class="hljs-comment">// 事件处理函数参数推断</span><br><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">clientX</span>);         <span class="hljs-comment">// e 推断为 MouseEvent</span><br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>特殊推断场景</strong></p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">推断行为</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">未初始化变量</td>
<td align="left">推断为 any（非严格模式）</td>
<td align="left">let x; → x: any</td>
</tr>
<tr>
<td align="left">联合类型初始化</td>
<td align="left">推断所有可能类型的联合</td>
<td align="left">let arr &#x3D; [0, “a”] → <code>(number	string)[]</code></td>
</tr>
<tr>
<td align="left">const 常量断言</td>
<td align="left">推断为字面量类型</td>
<td align="left">const size &#x3D; 100 as const → 100</td>
</tr>
</tbody></table>
<p><strong>类型推断与显示注解对比</strong></p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">推荐方式</th>
<th align="left">原因</th>
</tr>
</thead>
<tbody><tr>
<td align="left">函数参数</td>
<td align="left">显示注解</td>
<td align="left">避免 any 传播风险</td>
</tr>
<tr>
<td align="left">复杂对象字面量</td>
<td align="left">显示注解或接口</td>
<td align="left">确保结构符合预期</td>
</tr>
<tr>
<td align="left">简单变量初始化</td>
<td align="left">依赖类型推断</td>
<td align="left">减少冗余代码</td>
</tr>
<tr>
<td align="left">函数返回值</td>
<td align="left">依赖类型推断</td>
<td align="left">保持与实现同步（除公开API文档外）</td>
</tr>
</tbody></table>
<h3 id="1-1-2-字面量类型与联合类型实战"><a href="#1-1-2-字面量类型与联合类型实战" class="headerlink" title="1.1.2 字面量类型与联合类型实战"></a>1.1.2 字面量类型与联合类型实战</h3><p><strong>字面量类型（Literal Types）</strong></p>
<p>核心概念：将值作为类型使用，限制变量只能取特定值。</p>
<table>
<thead>
<tr>
<th align="left">分类</th>
<th align="left">语法示例</th>
<th align="left">类型表示</th>
</tr>
</thead>
<tbody><tr>
<td align="left">字符串字面量</td>
<td align="left">let dir: “UP” &#x3D; “UP”</td>
<td align="left">“UP”</td>
</tr>
<tr>
<td align="left">数字字面量</td>
<td align="left">let size: 100 &#x3D; 100</td>
<td align="left">100</td>
</tr>
<tr>
<td align="left">布尔字面量</td>
<td align="left">let flag: true &#x3D; true</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">模板字面量</td>
<td align="left">type T &#x3D; prefix_${string}&#96;&#96;</td>
<td align="left">模式匹配类型</td>
</tr>
</tbody></table>
<p>工程价值：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 替代枚举（更轻量）</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">HttpMethod</span> = <span class="hljs-string">&quot;GET&quot;</span> | <span class="hljs-string">&quot;POST&quot;</span> | <span class="hljs-string">&quot;PUT&quot;</span> | <span class="hljs-string">&quot;DELETE&quot;</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params"><span class="hljs-attr">method</span>: <span class="hljs-title class_">HttpMethod</span></span>) &#123;...&#125;<br><br><span class="hljs-title function_">fetchData</span>(<span class="hljs-string">&quot;GET&quot;</span>);  <span class="hljs-comment">// ✅</span><br><span class="hljs-title function_">fetchData</span>(<span class="hljs-string">&quot;COPY&quot;</span>); <span class="hljs-comment">// 🚫 编译错误：非允许值</span><br></code></pre></td></tr></table></figure>

<p><strong>联合类型（Union Types）</strong></p>
<p>核心概念：组合多个类型，表示值可以是其中任意一种类型。</p>
<p>语法与特性：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-variable constant_">ID</span> = <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>;         <span class="hljs-comment">// 基础联合</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Status</span> = <span class="hljs-string">&quot;idle&quot;</span> | <span class="hljs-string">&quot;loading&quot;</span>;  <span class="hljs-comment">// 字面量联合</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Shape</span> = <span class="hljs-title class_">Circle</span> | <span class="hljs-title class_">Square</span>;      <span class="hljs-comment">// 对象联合</span><br><br><span class="hljs-comment">// 联合类型特性：</span><br><span class="hljs-keyword">let</span> <span class="hljs-attr">id</span>: <span class="hljs-variable constant_">ID</span> = <span class="hljs-string">&quot;abc123&quot;</span>; <span class="hljs-comment">// ✅ 允许字符串</span><br>id = <span class="hljs-number">100</span>;              <span class="hljs-comment">// ✅ 允许数字</span><br>id = <span class="hljs-literal">true</span>;             <span class="hljs-comment">// 🚫 不允许布尔值</span><br></code></pre></td></tr></table></figure>

<p><strong>类型收窄实战（Type Narrowing）</strong></p>
<p>核心方法：在代码分支中缩小联合类型范围</p>
<table>
<thead>
<tr>
<th align="left">技术</th>
<th align="left">示例</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">typeof 守卫</td>
<td align="left"><code>if (typeof val === &quot;string&quot;) &#123; val.toUpperCase() &#125;</code></td>
<td align="left">基本类型联合</td>
</tr>
<tr>
<td align="left">instanceof 守卫</td>
<td align="left"><code>if (err instanceof Error) &#123; console.log(err.message) &#125;</code></td>
<td align="left">类实例联合</td>
</tr>
<tr>
<td align="left">相等性检查</td>
<td align="left"><code>if (status === &quot;loading&quot;) &#123; showSpinner() &#125;</code></td>
<td align="left">字面量联合</td>
</tr>
<tr>
<td align="left">自定义守卫</td>
<td align="left"><code>function isFish(pet: Fish Bird): pet is Fish &#123; return &quot;swim&quot; in pet &#125;</code></td>
<td align="left">复杂对象联合</td>
</tr>
<tr>
<td align="left">可辨识联合</td>
<td align="left">通过共同字段区分类型（见下例）</td>
<td align="left">对象联合（设计模式）</td>
</tr>
</tbody></table>
<p>可辨识联合实战：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// Step 1: 定义具有kind字段的联合类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Shape</span> = <br>  | &#123; <span class="hljs-attr">kind</span>: <span class="hljs-string">&quot;circle&quot;</span>; <span class="hljs-attr">radius</span>: <span class="hljs-built_in">number</span> &#125; <br>  | &#123; <span class="hljs-attr">kind</span>: <span class="hljs-string">&quot;square&quot;</span>; <span class="hljs-attr">size</span>: <span class="hljs-built_in">number</span> &#125;;<br><br><span class="hljs-comment">// Step 2: 使用kind字段收窄类型</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getArea</span>(<span class="hljs-params"><span class="hljs-attr">shape</span>: <span class="hljs-title class_">Shape</span></span>) &#123;<br>  <span class="hljs-keyword">switch</span> (shape.<span class="hljs-property">kind</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;circle&quot;</span>:<br>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * shape.<span class="hljs-property">radius</span> ** <span class="hljs-number">2</span>;  <span class="hljs-comment">// 此分支shape被收窄为圆形</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;square&quot;</span>:<br>      <span class="hljs-keyword">return</span> shape.<span class="hljs-property">size</span> ** <span class="hljs-number">2</span>;              <span class="hljs-comment">// 此分支shape被收窄为方形</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>工程最佳实践</strong></p>
<p>(1) 避免过度使用字面量联合</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 不推荐：直接使用字面量</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">setColor</span>(<span class="hljs-params"><span class="hljs-attr">color</span>: <span class="hljs-string">&quot;red&quot;</span> | <span class="hljs-string">&quot;green&quot;</span> | <span class="hljs-string">&quot;blue&quot;</span></span>) &#123;...&#125;<br><br><span class="hljs-comment">// 推荐：使用命名类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">PrimaryColor</span> = <span class="hljs-string">&quot;red&quot;</span> | <span class="hljs-string">&quot;green&quot;</span> | <span class="hljs-string">&quot;blue&quot;</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">setColor</span>(<span class="hljs-params"><span class="hljs-attr">color</span>: <span class="hljs-title class_">PrimaryColor</span></span>) &#123;...&#125;<br></code></pre></td></tr></table></figure>

<p>(2) 联合类型与函数重载配合</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 根据参数类型返回不同结果</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">padLeft</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">padding</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">string</span> &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> padding === <span class="hljs-string">&quot;number&quot;</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot; &quot;</span>.<span class="hljs-title function_">repeat</span>(padding) + value;  <span class="hljs-comment">// 数字处理</span><br>  &#125;<br>  <span class="hljs-keyword">return</span> padding + value;                <span class="hljs-comment">// 字符串处理</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-1-3-any-unknown-never-的区别与应用场景"><a href="#1-1-3-any-unknown-never-的区别与应用场景" class="headerlink" title="1.1.3 any&#x2F;unknown&#x2F;never 的区别与应用场景"></a>1.1.3 any&#x2F;unknown&#x2F;never 的区别与应用场景</h3><p><strong>核心类型对比</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">any</th>
<th align="left">unknown</th>
<th align="left">never</th>
</tr>
</thead>
<tbody><tr>
<td align="left">类型安全性</td>
<td align="left">❌ 完全禁用类型检查</td>
<td align="left">✅ 安全容器（需显式类型断言）</td>
<td align="left">✅ 表示不可能存在的值</td>
</tr>
<tr>
<td align="left">可赋值给</td>
<td align="left">任意类型</td>
<td align="left">仅 any 和 unknown</td>
<td align="left">任意类型（底部类型）</td>
</tr>
<tr>
<td align="left">可接受赋值</td>
<td align="left">任意类型</td>
<td align="left">任意类型</td>
<td align="left">不可赋值（除 never 本身）</td>
</tr>
<tr>
<td align="left">操作自由度</td>
<td align="left">直接访问属性&#x2F;方法</td>
<td align="left">必须先断言具体类型	无法实例化</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>any 类型详解</strong></p>
<p>设计目的：用于兼容 JavaScript 无类型代码或第三方库缺失类型声明。</p>
<p>典型场景：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 场景1：迁移遗留JS代码</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">legacyData</span>: <span class="hljs-built_in">any</span> = <span class="hljs-title function_">getUntypedData</span>();<br>legacyData.<span class="hljs-title function_">invalidMethod</span>(); <span class="hljs-comment">// 编译通过，运行时可能报错</span><br><br><span class="hljs-comment">// 场景2：动态属性访问</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">obj</span>: <span class="hljs-built_in">any</span> = &#123;&#125;;<br>obj.<span class="hljs-property">arbitraryProperty</span> = <span class="hljs-number">123</span>; <span class="hljs-comment">// 允许任意属性赋值</span><br></code></pre></td></tr></table></figure>

<p>风险警示：使用 any 会破坏类型系统的安全性，应通过 tsconfig.json 开启 noImplicitAny 严格检查。</p>
<p><strong>unknown 类型详解</strong></p>
<p>设计目的：提供类型安全的顶层容器，替代 any 处理不确定类型。</p>
<p>标准使用模式：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 1. 接收不确定类型值</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">userInput</span>: <span class="hljs-built_in">unknown</span> = <span class="hljs-title function_">fetchUserInput</span>();<br><br><span class="hljs-comment">// 2. 使用时显式断言</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> userInput === <span class="hljs-string">&quot;string&quot;</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(userInput.<span class="hljs-title function_">toUpperCase</span>()); <span class="hljs-comment">// 收窄为string</span><br>&#125;<br><br><span class="hljs-comment">// 3. 或使用类型断言</span><br><span class="hljs-keyword">const</span> parsed = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(jsonString) <span class="hljs-keyword">as</span> <span class="hljs-built_in">unknown</span>; <span class="hljs-comment">// 安全容器</span><br></code></pre></td></tr></table></figure>

<p>工程实践：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 安全反序列化函数</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">safeParse</span>(<span class="hljs-params"><span class="hljs-attr">json</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">unknown</span> &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(json);<br>  &#125; <span class="hljs-keyword">catch</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;<br>  &#125;<br>&#125;<br><span class="hljs-keyword">const</span> data = <span class="hljs-title function_">safeParse</span>(<span class="hljs-string">&#x27;&#123;&quot;name&quot;:&quot;Alice&quot;&#125;&#x27;</span>);<br><span class="hljs-keyword">if</span> (data &amp;&amp; <span class="hljs-keyword">typeof</span> data === <span class="hljs-string">&quot;object&quot;</span> &amp;&amp; <span class="hljs-string">&quot;name&quot;</span> <span class="hljs-keyword">in</span> data) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-property">name</span>); <span class="hljs-comment">// 通过类型守卫安全访问</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>never 类型详解</strong></p>
<p>设计目的：表示永远不会发生的值或不可达的代码分支。</p>
<p>核心应用场景：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 场景1：抛出异常的函数</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">error</span>(<span class="hljs-params"><span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">never</span> &#123;<br>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(message);<br>&#125;<br><br><span class="hljs-comment">// 场景2：死循环函数</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">infiniteLoop</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">never</span> &#123;<br>  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;&#125;<br>&#125;<br><br><span class="hljs-comment">// 场景3：穷尽检查（Exhaustiveness checking）</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Shape</span> = <span class="hljs-string">&quot;circle&quot;</span> | <span class="hljs-string">&quot;square&quot;</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getArea</span>(<span class="hljs-params"><span class="hljs-attr">shape</span>: <span class="hljs-title class_">Shape</span></span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">switch</span> (shape) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;circle&quot;</span>: <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * r**<span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;square&quot;</span>: <span class="hljs-keyword">return</span> s**<span class="hljs-number">2</span>;<br>    <span class="hljs-attr">default</span>: <br>      <span class="hljs-keyword">const</span> <span class="hljs-attr">_exhaustiveCheck</span>: <span class="hljs-built_in">never</span> = shape; <span class="hljs-comment">// 若新增shape类型会报错</span><br>      <span class="hljs-keyword">return</span> _exhaustiveCheck;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>类型系统特性：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// never 是任意类型的子类型</span><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">n</span>: <span class="hljs-built_in">never</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span> = n; <span class="hljs-comment">// ✅ 编译通过</span><br><br><span class="hljs-comment">// 空数组类型推断</span><br><span class="hljs-keyword">const</span> emptyArray = []; <span class="hljs-comment">// 推断为 never[]</span><br></code></pre></td></tr></table></figure>

<p><strong>工程选择指南</strong></p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">推荐类型</th>
<th align="left">原因</th>
</tr>
</thead>
<tbody><tr>
<td align="left">第三方JS库迁移</td>
<td align="left">any</td>
<td align="left">快速过渡期方案</td>
</tr>
<tr>
<td align="left">API响应解析</td>
<td align="left">unknown</td>
<td align="left">安全处理动态数据结构</td>
</tr>
<tr>
<td align="left">错误处理函数</td>
<td align="left">never</td>
<td align="left">明确表示函数不会正常返回</td>
</tr>
<tr>
<td align="left">类型守卫中不可达分支</td>
<td align="left">never</td>
<td align="left">触发穷尽检查</td>
</tr>
<tr>
<td align="left">泛型编程中的空集合</td>
<td align="left">never</td>
<td align="left">表示不可能存在的类型（如 keyof never &#x3D; never）</td>
</tr>
</tbody></table>
<h3 id="1-1-4-类型断言与类型守卫实现原理"><a href="#1-1-4-类型断言与类型守卫实现原理" class="headerlink" title="1.1.4 类型断言与类型守卫实现原理"></a>1.1.4 类型断言与类型守卫实现原理</h3><p><strong>类型断言（Type Assertions）</strong></p>
<p>本质：开发者向编译器提供更具体的类型信息（不改变运行时值）</p>
<p>两种语法形式：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 尖括号语法（JSX中不可用）</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">strLength</span>: <span class="hljs-built_in">number</span> = (&lt;<span class="hljs-built_in">string</span>&gt;someValue).<span class="hljs-property">length</span>;<br><br><span class="hljs-comment">// as 语法（推荐）</span><br><span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;app&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLDivElement</span>;<br></code></pre></td></tr></table></figure>

<p>使用场景：</p>
<p>(1) DOM 元素类型细化</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> input = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;input[type=&quot;text&quot;]&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;<br>input.<span class="hljs-property">value</span> = <span class="hljs-string">&#x27;new value&#x27;</span>; <span class="hljs-comment">// 安全访问value属性</span><br></code></pre></td></tr></table></figure>

<p>(2) 联合类型收窄</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">padLeft</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">padding</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>) &#123;<br>  <span class="hljs-keyword">if</span> ((padding <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>) &gt; <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// 断言为number</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot; &quot;</span>.<span class="hljs-title function_">repeat</span>(padding <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>) + value;<br>  &#125;<br>  <span class="hljs-keyword">return</span> (padding <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>) + value;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(3) 处理any类型</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> <span class="hljs-attr">unknownData</span>: <span class="hljs-built_in">any</span> = <span class="hljs-title function_">fetchData</span>();<br><span class="hljs-keyword">const</span> validData = unknownData <span class="hljs-keyword">as</span> <span class="hljs-title class_">UserData</span>; <span class="hljs-comment">// 断言为具体类型</span><br></code></pre></td></tr></table></figure>

<p>注意事项：</p>
<ul>
<li>断言必须满足”结构兼容”（如不能将 string 断言为 number）</li>
<li>双重断言规避限制（慎用）：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> str = <span class="hljs-string">&#x27;hello&#x27;</span>;<br><span class="hljs-keyword">const</span> num = str <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 绕过类型检查</span><br></code></pre></td></tr></table></figure>

<p><strong>类型守卫（Type Guards）</strong></p>
<p>原理：通过运行时检查触发编译时类型收窄</p>
<p>内置守卫机制：</p>
<table>
<thead>
<tr>
<th align="left">类型守卫</th>
<th align="left">语法示例</th>
<th align="left">收窄效果</th>
</tr>
</thead>
<tbody><tr>
<td align="left">typeof</td>
<td align="left">typeof val &#x3D;&#x3D;&#x3D; “string”</td>
<td align="left">基本类型 → 具体类型</td>
</tr>
<tr>
<td align="left">instanceof</td>
<td align="left">obj instanceof Date</td>
<td align="left">类实例 → 具体类</td>
</tr>
<tr>
<td align="left">in 操作符</td>
<td align="left">“prop” in obj</td>
<td align="left">对象 → 包含该属性类型</td>
</tr>
<tr>
<td align="left">字面量相等检查</td>
<td align="left">status &#x3D;&#x3D;&#x3D; “success”</td>
<td align="left">联合 → 具体字面量类型</td>
</tr>
</tbody></table>
<p>示例：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">printValue</span>(<span class="hljs-params"><span class="hljs-attr">val</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>) &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> val === <span class="hljs-string">&quot;string&quot;</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(val.<span class="hljs-title function_">toUpperCase</span>()); <span class="hljs-comment">// val收窄为string</span><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(val.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>)); <span class="hljs-comment">// val收窄为number</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>自定义类型守卫</strong></p>
<p>实现原理：返回类型谓词（arg is T）</p>
<p>标准模式：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">isString</span>(<span class="hljs-params"><span class="hljs-attr">val</span>: <span class="hljs-built_in">unknown</span></span>): val is <span class="hljs-built_in">string</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> val === <span class="hljs-string">&quot;string&quot;</span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">process</span>(<span class="hljs-params"><span class="hljs-attr">input</span>: <span class="hljs-built_in">unknown</span></span>) &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isString</span>(input)) &#123;<br>    input.<span class="hljs-title function_">trim</span>(); <span class="hljs-comment">// input被收窄为string</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>复杂对象守卫实战：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Cat</span> &#123; <span class="hljs-title function_">meow</span>(): <span class="hljs-built_in">void</span> &#125;<br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Dog</span> &#123; <span class="hljs-title function_">bark</span>(): <span class="hljs-built_in">void</span> &#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">isCat</span>(<span class="hljs-params"><span class="hljs-attr">animal</span>: <span class="hljs-title class_">Cat</span> | <span class="hljs-title class_">Dog</span></span>): animal is <span class="hljs-title class_">Cat</span> &#123;<br>  <span class="hljs-keyword">return</span> (animal <span class="hljs-keyword">as</span> <span class="hljs-title class_">Cat</span>).<span class="hljs-property">meow</span> !== <span class="hljs-literal">undefined</span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleAnimal</span>(<span class="hljs-params"><span class="hljs-attr">animal</span>: <span class="hljs-title class_">Cat</span> | <span class="hljs-title class_">Dog</span></span>) &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isCat</span>(animal)) &#123;<br>    animal.<span class="hljs-title function_">meow</span>(); <span class="hljs-comment">// 收窄为Cat</span><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    animal.<span class="hljs-title function_">bark</span>(); <span class="hljs-comment">// 收窄为Dog</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>可辨识联合（Discriminated Unions）</strong></p>
<p>特殊类型守卫：通过共同字段自动收窄</p>
<p>实现原理：</p>
<ul>
<li>定义具有相同判别字段的联合类型</li>
<li>通过判别字段值收窄类型</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">NetworkState</span> =<br>  | &#123; <span class="hljs-attr">state</span>: <span class="hljs-string">&quot;loading&quot;</span> &#125;<br>  | &#123; <span class="hljs-attr">state</span>: <span class="hljs-string">&quot;success&quot;</span>, <span class="hljs-attr">response</span>: <span class="hljs-built_in">string</span> &#125;<br>  | &#123; <span class="hljs-attr">state</span>: <span class="hljs-string">&quot;error&quot;</span>, <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> &#125;;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">logState</span>(<span class="hljs-params"><span class="hljs-attr">state</span>: <span class="hljs-title class_">NetworkState</span></span>) &#123;<br>  <span class="hljs-keyword">switch</span> (state.<span class="hljs-property">state</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;loading&quot;</span>:<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Loading...&quot;</span>); <span class="hljs-comment">// state: &#123; state: &quot;loading&quot; &#125;</span><br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;success&quot;</span>:<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(state.<span class="hljs-property">response</span>); <span class="hljs-comment">// state: &#123; state: &quot;success&quot;, response: string &#125;</span><br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;error&quot;</span>:<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(state.<span class="hljs-property">message</span>); <span class="hljs-comment">// state: &#123; state: &quot;error&quot;, message: string &#125;</span><br>      <span class="hljs-keyword">break</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>工程实践要点</strong></p>
<ol>
<li>优先使用类型守卫：比类型断言更安全（运行时验证）</li>
<li>避免过度断言：过度使用 as 会弱化类型检查</li>
<li>守卫函数复用：提取复杂判断逻辑为可复用守卫</li>
<li>可辨识联合设计：适合管理复杂状态机类型</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 状态机类型守卫示例</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">State</span> = &#123; <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;idle&#x27;</span> &#125; | &#123; <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;fetching&#x27;</span>; <span class="hljs-attr">startTime</span>: <span class="hljs-built_in">number</span> &#125;;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleState</span>(<span class="hljs-params"><span class="hljs-attr">state</span>: <span class="hljs-title class_">State</span></span>) &#123;<br>  <span class="hljs-keyword">if</span> (state.<span class="hljs-property">status</span> === <span class="hljs-string">&#x27;fetching&#x27;</span>) &#123;<br>    <span class="hljs-keyword">const</span> duration = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - state.<span class="hljs-property">startTime</span>; <span class="hljs-comment">// 安全访问startTime</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-1-5-结构化类型系统与鸭子类型"><a href="#1-1-5-结构化类型系统与鸭子类型" class="headerlink" title="1.1.5 结构化类型系统与鸭子类型"></a>1.1.5 结构化类型系统与鸭子类型</h3><p><strong>核心概念解析</strong></p>
<table>
<thead>
<tr>
<th align="left">术语</th>
<th align="left">定义</th>
<th align="left">对比模型</th>
</tr>
</thead>
<tbody><tr>
<td align="left">结构化类型系统</td>
<td align="left">类型兼容性基于类型的结构属性（而非名称）</td>
<td align="left">TypeScript, Go</td>
</tr>
<tr>
<td align="left">名义类型系统</td>
<td align="left">类型兼容性基于类型声明名称（需显式继承）</td>
<td align="left">Java, C#</td>
</tr>
<tr>
<td align="left">鸭子类型</td>
<td align="left">“如果它走起来像鸭子、叫起来像鸭子，那么它就是鸭子”（关注行为而非具体类型）</td>
<td align="left">动态语言哲学</td>
</tr>
</tbody></table>
<p><strong>结构化类型系统原理</strong></p>
<p>基本规则：</p>
<ul>
<li>类型 A 兼容类型 B 当且仅当 A 拥有 B 的所有必需成员（成员名和类型匹配）</li>
</ul>
<p>示例：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Vector2D</span> &#123;<br>  <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>;<br>  <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-comment">// 类无需显式实现接口（结构匹配即可）</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Point2D</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>, <span class="hljs-keyword">public</span> <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span></span>) &#123;&#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">v</span>: <span class="hljs-title class_">Vector2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Point2D</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// ✅ 兼容</span><br></code></pre></td></tr></table></figure>

<p>属性检查规则：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Person</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-comment">// 直接赋值字面量时触发严格检查</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">p</span>: <span class="hljs-title class_">Person</span> = &#123; <br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span>,<br>  <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>,<br>  <span class="hljs-attr">gender</span>: <span class="hljs-string">&quot;female&quot;</span>  <span class="hljs-comment">// 🚫 错误！多余属性</span><br>&#125;;<br><br><span class="hljs-comment">// 通过中间变量赋值（绕过额外属性检查）</span><br><span class="hljs-keyword">const</span> obj = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>, <span class="hljs-attr">gender</span>: <span class="hljs-string">&quot;male&quot;</span> &#125;;<br><span class="hljs-keyword">const</span> <span class="hljs-attr">p2</span>: <span class="hljs-title class_">Person</span> = obj; <span class="hljs-comment">// ✅ 兼容（结构满足核心属性）</span><br></code></pre></td></tr></table></figure>

<p><strong>鸭子类型实战场景</strong></p>
<p>场景1：函数参数兼容</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Loggable</span> &#123;<br>  <span class="hljs-attr">log</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsoleLogger</span> &#123;<br>  <span class="hljs-title function_">log</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Logging...&quot;</span>) &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FileLogger</span> &#123;<br>  <span class="hljs-title function_">log</span>(<span class="hljs-params"></span>) &#123; fs.<span class="hljs-title function_">writeFile</span>(<span class="hljs-string">&quot;log.txt&quot;</span>, <span class="hljs-string">&quot;...&quot;</span>) &#125;<br>&#125;<br><br><span class="hljs-comment">// 接受任何具有log方法的对象</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">logOutput</span>(<span class="hljs-params"><span class="hljs-attr">logger</span>: <span class="hljs-title class_">Loggable</span></span>) &#123;<br>  logger.<span class="hljs-title function_">log</span>();<br>&#125;<br><br><span class="hljs-title function_">logOutput</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleLogger</span>()); <span class="hljs-comment">// ✅</span><br><span class="hljs-title function_">logOutput</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileLogger</span>());    <span class="hljs-comment">// ✅</span><br></code></pre></td></tr></table></figure>

<p>场景2：API响应处理</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiResponse</span> &#123;<br>  <span class="hljs-attr">data</span>: <span class="hljs-built_in">unknown</span>;<br>  <span class="hljs-attr">status</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-comment">// 无需强制转换，只要结构匹配</span><br><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchAPI</span>();<br><span class="hljs-title function_">processResponse</span>(response); <br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">processResponse</span>(<span class="hljs-params"><span class="hljs-attr">res</span>: <span class="hljs-title class_">ApiResponse</span></span>) &#123;<br>  <span class="hljs-keyword">if</span> (res.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) &#123;<br>    <span class="hljs-title function_">parseData</span>(res.<span class="hljs-property">data</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>结构化类型的边界控制</strong></p>
<p>(1) 精确类型控制（避免意外匹配）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 使用独特标识防止结构误匹配</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> &#123;<br>  <span class="hljs-attr">_type</span>: <span class="hljs-string">&quot;user&quot;</span>; <span class="hljs-comment">// 唯一标识</span><br>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;<br>&#125;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Admin</span> &#123;<br>  <span class="hljs-attr">_type</span>: <span class="hljs-string">&quot;admin&quot;</span>; <span class="hljs-comment">// 唯一标识</span><br>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">privileges</span>: <span class="hljs-built_in">string</span>[];<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleEntity</span>(<span class="hljs-params"><span class="hljs-attr">entity</span>: <span class="hljs-title class_">User</span> | <span class="hljs-title class_">Admin</span></span>) &#123;<br>  <span class="hljs-keyword">if</span> (entity.<span class="hljs-property">_type</span> === <span class="hljs-string">&quot;user&quot;</span>) &#123;<br>    <span class="hljs-comment">// 安全收窄到User类型</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) 可选属性与未知属性处理</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>;<br>  <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>;<br>  <span class="hljs-attr">debug</span>?: <span class="hljs-built_in">boolean</span>; <span class="hljs-comment">// 可选属性</span><br>  [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">any</span>; <span class="hljs-comment">// 允许未知属性</span><br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">Config</span> = &#123;<br>  <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-number">200</span>,<br>  <span class="hljs-attr">color</span>: <span class="hljs-string">&quot;blue&quot;</span> <span class="hljs-comment">// ✅ 允许额外属性（因索引签名存在）</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>与名义类型系统的互操作</strong></p>
<p>模拟名义类型（通过交叉类型）：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 创建名义类型标记</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">UserID</span> = <span class="hljs-built_in">string</span> &amp; &#123; <span class="hljs-attr">__brand</span>: <span class="hljs-string">&quot;UserID&quot;</span> &#125;;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">OrderID</span> = <span class="hljs-built_in">string</span> &amp; &#123; <span class="hljs-attr">__brand</span>: <span class="hljs-string">&quot;OrderID&quot;</span> &#125;;<br><br><span class="hljs-comment">// 类型创建函数</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createUserID</span>(<span class="hljs-params"><span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">UserID</span> &#123;<br>  <span class="hljs-keyword">return</span> id <span class="hljs-keyword">as</span> <span class="hljs-title class_">UserID</span>;<br>&#125;<br><br><span class="hljs-comment">// 使用示例</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">userId</span>: <span class="hljs-title class_">UserID</span> = <span class="hljs-title function_">createUserID</span>(<span class="hljs-string">&quot;user-123&quot;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-attr">orderId</span>: <span class="hljs-title class_">OrderID</span> = <span class="hljs-string">&quot;order-456&quot;</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">OrderID</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getUser</span>(<span class="hljs-params"><span class="hljs-attr">id</span>: <span class="hljs-title class_">UserID</span></span>) &#123;...&#125;<br><br><span class="hljs-title function_">getUser</span>(userId); <span class="hljs-comment">// ✅</span><br><span class="hljs-title function_">getUser</span>(orderId); <span class="hljs-comment">// 🚫 编译错误：类型不兼容</span><br></code></pre></td></tr></table></figure>

<p><strong>工程实践要点</strong></p>
<ol>
<li>优先使用接口而非类：接口更符合结构化类型哲学（轻量级契约）</li>
<li>避免过度匹配问题：通过最小化接口属性减少意外兼容</li>
<li>利用类型推导优势：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 自动推导返回类型符合结构</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createPoint</span>(<span class="hljs-params"><span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span></span>) &#123;<br>  <span class="hljs-keyword">return</span> &#123; x, y, <span class="hljs-attr">z</span>: <span class="hljs-number">0</span> &#125;; <span class="hljs-comment">// 自动兼容 Vector2D</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>鸭子类型测试策略：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 运行时验证对象是否满足结构</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">isVector2D</span>(<span class="hljs-params"><span class="hljs-attr">obj</span>: <span class="hljs-built_in">any</span></span>): obj is <span class="hljs-title class_">Vector2D</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;x&quot;</span> <span class="hljs-keyword">in</span> obj &amp;&amp; <span class="hljs-string">&quot;y&quot;</span> <span class="hljs-keyword">in</span> obj;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="1-2-接口与面向对象"><a href="#1-2-接口与面向对象" class="headerlink" title="1.2 接口与面向对象"></a>1.2 接口与面向对象</h2><h3 id="1-2-1-接口高级特性（可选属性、只读属性、索引签名）"><a href="#1-2-1-接口高级特性（可选属性、只读属性、索引签名）" class="headerlink" title="1.2.1 接口高级特性（可选属性、只读属性、索引签名）"></a>1.2.1 接口高级特性（可选属性、只读属性、索引签名）</h3><p><strong>可选属性（Optional Properties）</strong></p>
<p>语法：在属性名后添加 ?</p>
<p>作用：允许对象缺少该属性</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserProfile</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">age</span>?: <span class="hljs-built_in">number</span>;  <span class="hljs-comment">// 可选属性</span><br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">user1</span>: <span class="hljs-title class_">UserProfile</span> = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span> &#125;;          <span class="hljs-comment">// ✅ age 可省略</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">user2</span>: <span class="hljs-title class_">UserProfile</span> = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> &#125;;  <span class="hljs-comment">// ✅</span><br></code></pre></td></tr></table></figure>

<p>运行时检查：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;age&quot;</span> <span class="hljs-keyword">in</span> user1) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user1.<span class="hljs-property">age</span>.<span class="hljs-title function_">toFixed</span>()); <span class="hljs-comment">// 安全访问</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>只读属性（Readonly Properties）</strong></p>
<p>语法：使用 readonly 修饰符</p>
<p>作用：初始化后禁止修改</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> &#123;<br>  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">apiKey</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">endpoint</span>: <span class="hljs-built_in">string</span>;<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">Config</span> = &#123;<br>  <span class="hljs-attr">apiKey</span>: <span class="hljs-string">&quot;abc123&quot;</span>,<br>  <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&quot;/api&quot;</span><br>&#125;;<br><br>config.<span class="hljs-property">endpoint</span> = <span class="hljs-string">&quot;/new&quot;</span>; <span class="hljs-comment">// ✅ 允许修改</span><br>config.<span class="hljs-property">apiKey</span> = <span class="hljs-string">&quot;xyz&quot;</span>;    <span class="hljs-comment">// 🚫 编译错误：只读属性</span><br></code></pre></td></tr></table></figure>

<p>特殊场景 - 只读数组：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ImmutableData</span> &#123;<br>  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">tags</span>: <span class="hljs-built_in">string</span>[];<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">ImmutableData</span> = &#123; <span class="hljs-attr">tags</span>: [<span class="hljs-string">&quot;frontend&quot;</span>, <span class="hljs-string">&quot;react&quot;</span>] &#125;;<br>data.<span class="hljs-property">tags</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">&quot;typescript&quot;</span>); <span class="hljs-comment">// ✅ 允许（数组引用未变）</span><br>data.<span class="hljs-property">tags</span> = [<span class="hljs-string">&quot;new&quot;</span>];         <span class="hljs-comment">// 🚫 禁止重新赋值</span><br></code></pre></td></tr></table></figure>

<p><strong>索引签名（Index Signatures）</strong></p>
<p>语法：[key: KeyType]: ValueType</p>
<p>作用：定义动态属性名</p>
<p>基础用法：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">StringMap</span> &#123;<br>  [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 允许任意字符串属性名</span><br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">scores</span>: <span class="hljs-title class_">StringMap</span> = &#123;<br>  <span class="hljs-attr">math</span>: <span class="hljs-number">95</span>,<br>  <span class="hljs-attr">science</span>: <span class="hljs-number">90</span><br>&#125;;<br>scores[<span class="hljs-string">&quot;english&quot;</span>] = <span class="hljs-number">88</span>; <span class="hljs-comment">// ✅ 动态添加</span><br></code></pre></td></tr></table></figure>

<p>混合使用（固定属性 + 索引签名）：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">HybridInterface</span> &#123;<br>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;          <span class="hljs-comment">// 固定属性</span><br>  [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">any</span>;  <span class="hljs-comment">// 动态属性</span><br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">HybridInterface</span> = &#123;<br>  <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;123&quot;</span>,<br>  <span class="hljs-attr">tempData</span>: &#123; <span class="hljs-comment">/*...*/</span> &#125;, <span class="hljs-comment">// ✅ 动态属性</span><br>  <span class="hljs-attr">count</span>: <span class="hljs-number">10</span>             <span class="hljs-comment">// ✅</span><br>&#125;;<br>obj.<span class="hljs-property">id</span> = <span class="hljs-string">&quot;456&quot;</span>;         <span class="hljs-comment">// ✅ 固定属性可修改</span><br></code></pre></td></tr></table></figure>

<p>索引类型限制：</p>
<table>
<thead>
<tr>
<th align="left">索引类型</th>
<th align="left">示例</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">string</td>
<td align="left">[key: string]: T</td>
<td align="left">支持所有字符串键</td>
</tr>
<tr>
<td align="left">number</td>
<td align="left">[index: number]: T</td>
<td align="left">数组式访问（实际键仍为字符串）</td>
</tr>
<tr>
<td align="left">symbol</td>
<td align="left">[sym: symbol]: T</td>
<td align="left">ES6 Symbol 键</td>
</tr>
<tr>
<td align="left">模板字面量</td>
<td align="left">[key: test_${string}]: T</td>
<td align="left">TS 4.4+ 模式匹配</td>
</tr>
</tbody></table>
<p><strong>高级组合应用</strong></p>
<p>场景：配置对象</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">version</span>: <span class="hljs-built_in">string</span>;   <span class="hljs-comment">// 只读版本号</span><br>  <span class="hljs-attr">env</span>?: <span class="hljs-string">&quot;dev&quot;</span> | <span class="hljs-string">&quot;prod&quot;</span>;       <span class="hljs-comment">// 可选环境</span><br>  [<span class="hljs-attr">option</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">unknown</span>;  <span class="hljs-comment">// 其他动态配置</span><br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">AppConfig</span> = &#123;<br>  <span class="hljs-attr">version</span>: <span class="hljs-string">&quot;1.0.0&quot;</span>,<br>  <span class="hljs-attr">debug</span>: <span class="hljs-literal">true</span>,       <span class="hljs-comment">// ✅ 动态属性</span><br>  <span class="hljs-attr">maxRetries</span>: <span class="hljs-number">3</span>      <span class="hljs-comment">// ✅</span><br>&#125;;<br><br>config.<span class="hljs-property">version</span> = <span class="hljs-string">&quot;2.0&quot;</span>; <span class="hljs-comment">// 🚫 禁止修改只读属性</span><br></code></pre></td></tr></table></figure>

<p>索引签名类型约束：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 要求所有属性值类型兼容</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ConsistentValues</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;      <span class="hljs-comment">// ✅ 兼容 string | number</span><br>  [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-comment">// 错误示例（类型冲突）</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Invalid</span> &#123;<br>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">boolean</span>;       <span class="hljs-comment">// 🚫 与索引签名类型不兼容</span><br>  [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>工程实践要点</strong></p>
<ol>
<li>优先显式声明重要属性：避免过度依赖索引签名</li>
<li>只读属性用于不变数据：如配置ID、版本号等</li>
<li>可选属性替代空值：比 property: null 更语义化</li>
<li>索引签名边界控制：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 精确控制动态属性类型</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">SafeDynamic</span> &#123;<br>  [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>; <span class="hljs-comment">// 必须显式检查</span><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getValue</span>(<span class="hljs-params"><span class="hljs-attr">obj</span>: <span class="hljs-title class_">SafeDynamic</span>, <span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span></span>) &#123;<br>  <span class="hljs-keyword">const</span> value = obj[key];<br>  <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">undefined</span>) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Missing property&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> value; <span class="hljs-comment">// 此时类型收窄为 string</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-2-类继承体系与访问修饰符"><a href="#1-2-2-类继承体系与访问修饰符" class="headerlink" title="1.2.2 类继承体系与访问修饰符"></a>1.2.2 类继承体系与访问修饰符</h3><p><strong>访问修饰符（Access Modifiers）</strong></p>
<p>控制类成员的可访问性：</p>
<table>
<thead>
<tr>
<th align="left">修饰符</th>
<th align="left">类内部</th>
<th align="left">子类</th>
<th align="left">类实例</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">public</td>
<td align="left">✅</td>
<td align="left">✅</td>
<td align="left">✅</td>
<td align="left">默认修饰符（可省略）</td>
</tr>
<tr>
<td align="left">protected</td>
<td align="left">✅</td>
<td align="left">✅</td>
<td align="left">❌</td>
<td align="left">仅类内部和子类访问</td>
</tr>
<tr>
<td align="left">private</td>
<td align="left">✅</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">仅类内部访问</td>
</tr>
<tr>
<td align="left">#field</td>
<td align="left">✅</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">ES2022 私有字段（运行时私有）</td>
</tr>
</tbody></table>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;          <span class="hljs-comment">// 公共属性（默认）</span><br>  <span class="hljs-keyword">protected</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;         <span class="hljs-comment">// 受保护属性</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">secret</span>: <span class="hljs-built_in">string</span>;       <span class="hljs-comment">// 私有属性</span><br>  #<span class="hljs-attr">internalCode</span>: <span class="hljs-built_in">number</span>;        <span class="hljs-comment">// ES私有字段（TypeScript 3.8+）</span><br><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = <span class="hljs-string">&quot;P1001&quot;</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">secret</span> = <span class="hljs-string">&quot;confidential&quot;</span>;<br>    <span class="hljs-variable language_">this</span>.#internalCode = <span class="hljs-number">12345</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Person</span> &#123;<br>  <span class="hljs-title function_">viewDetails</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);    <span class="hljs-comment">// ✅ 公共属性</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>);      <span class="hljs-comment">// ✅ 受保护属性（子类可访问）</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">secret</span>);  <span class="hljs-comment">// 🚫 错误！私有属性不可访问</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.#internalCode); <span class="hljs-comment">// 🚫 错误！ES私有字段不可访问</span><br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> emp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-string">&quot;Alice&quot;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(emp.<span class="hljs-property">name</span>);        <span class="hljs-comment">// ✅</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(emp.<span class="hljs-property">id</span>);          <span class="hljs-comment">// 🚫 错误！受保护属性</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(emp.<span class="hljs-property">secret</span>);      <span class="hljs-comment">// 🚫 错误！私有属性</span><br></code></pre></td></tr></table></figure>

<p><strong>类继承体系</strong></p>
<p>(1) 基本继承语法：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> &#123;<br>  <span class="hljs-title function_">move</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Moving...&quot;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> &#123;<br>  <span class="hljs-title function_">bark</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Woof!&quot;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();<br>dog.<span class="hljs-title function_">move</span>(); <span class="hljs-comment">// ✅ 继承自Animal</span><br>dog.<span class="hljs-title function_">bark</span>(); <span class="hljs-comment">// ✅ 自身方法</span><br></code></pre></td></tr></table></figure>

<p>(2) 构造函数继承：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vehicle</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> <span class="hljs-attr">type</span>: <span class="hljs-built_in">string</span></span>) &#123;&#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Vehicle</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-attr">type</span>: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">public</span> <span class="hljs-attr">brand</span>: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-variable language_">super</span>(<span class="hljs-keyword">type</span>); <span class="hljs-comment">// 必须调用super</span><br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> myCar = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(<span class="hljs-string">&quot;Sedan&quot;</span>, <span class="hljs-string">&quot;Toyota&quot;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myCar.<span class="hljs-property">type</span>);  <span class="hljs-comment">// &quot;Sedan&quot;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myCar.<span class="hljs-property">brand</span>); <span class="hljs-comment">// &quot;Toyota&quot;</span><br></code></pre></td></tr></table></figure>

<p><strong>方法重写（Override）</strong></p>
<p>规则：</p>
<ul>
<li>使用 override 关键字（TS 4.3+）</li>
<li>子类方法必须兼容父类方法签名</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br>  <span class="hljs-title function_">greet</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Hello!&quot;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Base</span> &#123;<br>  <span class="hljs-keyword">override</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params"><span class="hljs-attr">name</span>?: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-keyword">if</span> (name) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, <span class="hljs-subst">$&#123;name&#125;</span>!`</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">greet</span>(); <span class="hljs-comment">// 调用父类方法</span><br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> d = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Derived</span>();<br>d.<span class="hljs-title function_">greet</span>();       <span class="hljs-comment">// &quot;Hello!&quot; (调用父类方法)</span><br>d.<span class="hljs-title function_">greet</span>(<span class="hljs-string">&quot;Alice&quot;</span>);<span class="hljs-comment">// &quot;Hello, Alice!&quot;</span><br></code></pre></td></tr></table></figure>

<p>错误重写示例：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">InvalidDerived</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Base</span> &#123;<br>  <span class="hljs-keyword">override</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params"><span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span></span>) &#123; <br>    <span class="hljs-comment">// 🚫 错误！缺少可选参数的无参调用方式</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>访问器修饰符（Getter&#x2F;Setter）</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Temperature</span> &#123;<br>  <span class="hljs-keyword">private</span> _celsius = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-comment">// 带访问修饰符的getter/setter</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">get</span> <span class="hljs-title function_">celsius</span>(): <span class="hljs-built_in">number</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_celsius</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">set</span> <span class="hljs-title function_">celsius</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span></span>) &#123;<br>    <span class="hljs-keyword">if</span> (value &lt; -<span class="hljs-number">273.15</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Invalid temperature&quot;</span>);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_celsius</span> = value;<br>  &#125;<br><br>  <span class="hljs-comment">// 只读属性（无setter）</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">get</span> <span class="hljs-title function_">fahrenheit</span>(): <span class="hljs-built_in">number</span> &#123;<br>    <span class="hljs-keyword">return</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_celsius</span> * <span class="hljs-number">9</span>) / <span class="hljs-number">5</span> + <span class="hljs-number">32</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> temp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Temperature</span>();<br>temp.<span class="hljs-property">celsius</span> = <span class="hljs-number">25</span>;      <span class="hljs-comment">// ✅ 调用setter</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(temp.<span class="hljs-property">fahrenheit</span>); <span class="hljs-comment">// 77 ✅ 调用getter</span><br>temp.<span class="hljs-property">fahrenheit</span> = <span class="hljs-number">100</span>;  <span class="hljs-comment">// 🚫 错误！无setter</span><br></code></pre></td></tr></table></figure>

<p><strong>静态成员（Static Members）</strong></p>
<p>特性：</p>
<ol>
<li>通过类名直接访问</li>
<li>不可通过实例访问</li>
<li>可继承</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Database</span> &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">instance</span>: <span class="hljs-title class_">Database</span>;<br>  <br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">getInstance</span>(): <span class="hljs-title class_">Database</span> &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Database</span>.<span class="hljs-property">instance</span>) &#123;<br>      <span class="hljs-title class_">Database</span>.<span class="hljs-property">instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Database</span>.<span class="hljs-property">instance</span>;<br>  &#125;<br>  <br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> version = <span class="hljs-string">&quot;1.0&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">// 访问静态成员</span><br><span class="hljs-keyword">const</span> db = <span class="hljs-title class_">Database</span>.<span class="hljs-title function_">getInstance</span>();<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Database</span>.<span class="hljs-property">version</span>); <span class="hljs-comment">// &quot;1.0&quot;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDB</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Database</span> &#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">logVersion</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;DB Version:&quot;</span>, <span class="hljs-variable language_">super</span>.<span class="hljs-property">version</span>); <span class="hljs-comment">// 访问父类静态属性</span><br>  &#125;<br>&#125;<br><br><span class="hljs-title class_">MyDB</span>.<span class="hljs-title function_">logVersion</span>(); <span class="hljs-comment">// &quot;DB Version: 1.0&quot;</span><br></code></pre></td></tr></table></figure>

<p><strong>工程实践要点</strong></p>
<ol>
<li>最小化公开接口：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeContainer</span> &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">internalData</span>: <span class="hljs-built_in">string</span>[] = [];<br>  <br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">addItem</span>(<span class="hljs-params"><span class="hljs-attr">item</span>: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validate</span>(item);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">internalData</span>.<span class="hljs-title function_">push</span>(item);<br>  &#125;<br>  <br>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">validate</span>(<span class="hljs-params"><span class="hljs-attr">item</span>: <span class="hljs-built_in">string</span></span>) &#123; ... &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>使用protected扩展点：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PluginBase</span> &#123;<br>  <span class="hljs-keyword">protected</span> <span class="hljs-title function_">coreLogic</span>(<span class="hljs-params"></span>) &#123; ... &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPlugin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">PluginBase</span> &#123;<br>  <span class="hljs-title function_">run</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">coreLogic</span>(); <span class="hljs-comment">// 子类可访问</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>避免过度继承（组合优于继承）：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 使用组合替代深层继承</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Engine</span> &#123; ... &#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Wheels</span> &#123; ... &#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> &#123;<br>  <span class="hljs-keyword">private</span> engine = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Engine</span>();<br>  <span class="hljs-keyword">private</span> wheels = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Wheels</span>();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-3-抽象类与接口实现规范"><a href="#1-2-3-抽象类与接口实现规范" class="headerlink" title="1.2.3 抽象类与接口实现规范"></a>1.2.3 抽象类与接口实现规范</h3><p><strong>抽象类（Abstract Classes）</strong></p>
<p>核心特性：</p>
<ol>
<li>不能直接实例化</li>
<li>包含抽象方法（无实现）</li>
<li>可包含具体实现方法</li>
<li>通过 extends 继承</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> &#123;<br>  <span class="hljs-comment">// 抽象属性（必须被子类实现）</span><br>  <span class="hljs-keyword">abstract</span> <span class="hljs-attr">habitat</span>: <span class="hljs-built_in">string</span>;<br>  <br>  <span class="hljs-comment">// 抽象方法（无实现）</span><br>  <span class="hljs-keyword">abstract</span> <span class="hljs-title function_">makeSound</span>(): <span class="hljs-built_in">void</span>;<br>  <br>  <span class="hljs-comment">// 具体方法</span><br>  <span class="hljs-title function_">move</span>(): <span class="hljs-built_in">void</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Moving...&quot;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bird</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> &#123;<br>  habitat = <span class="hljs-string">&quot;sky&quot;</span>;  <span class="hljs-comment">// 实现抽象属性</span><br>  <br>  <span class="hljs-comment">// 实现抽象方法</span><br>  <span class="hljs-title function_">makeSound</span>(): <span class="hljs-built_in">void</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Chirp!&quot;</span>);<br>  &#125;<br>  <br>  <span class="hljs-comment">// 扩展新方法</span><br>  <span class="hljs-title function_">fly</span>(): <span class="hljs-built_in">void</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Flying&quot;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> bird = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bird</span>();<br>bird.<span class="hljs-title function_">makeSound</span>(); <span class="hljs-comment">// &quot;Chirp!&quot;</span><br>bird.<span class="hljs-title function_">move</span>();      <span class="hljs-comment">// &quot;Moving...&quot;</span><br>bird.<span class="hljs-title function_">fly</span>();       <span class="hljs-comment">// &quot;Flying&quot;</span><br><br><span class="hljs-keyword">const</span> animal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>(); <span class="hljs-comment">// 🚫 错误！抽象类不能实例化</span><br></code></pre></td></tr></table></figure>

<p><strong>接口实现（Interface Implementation）</strong></p>
<p>核心特性：</p>
<ol>
<li>使用 implements 关键字</li>
<li>必须实现所有接口成员</li>
<li>类可同时实现多个接口</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Loggable</span> &#123;<br>  <span class="hljs-title function_">log</span>(<span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Serializable</span> &#123;<br>  <span class="hljs-title function_">serialize</span>(): <span class="hljs-built_in">string</span>;<br>&#125;<br><br><span class="hljs-comment">// 实现多个接口</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Logger</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Loggable</span>, <span class="hljs-title class_">Serializable</span> &#123;<br>  <span class="hljs-title function_">log</span>(<span class="hljs-params"><span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[LOG] <span class="hljs-subst">$&#123;message&#125;</span>`</span>);<br>  &#125;<br>  <br>  <span class="hljs-title function_">serialize</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>抽象类 vs 接口</strong></p>
<p>| 特性 | 抽象类 | 接口 |<br>| 实例化 | ❌ 不能直接实例化 | ❌ 不能实例化 |<br>| 方法实现 | ✅ 可包含具体实现方法 | ❌ 只能声明方法签名 |<br>| 成员类型 | 可包含字段&#x2F;构造器&#x2F;访问器等 | 只能包含方法和抽象属性 |<br>| 继承机制 | 单继承（extends） | 多实现（implements） |<br>| 访问修饰符 | ✅ 支持 | ❌ 所有成员默认为 public |<br>| 版本兼容 | 修改可能破坏子类 | 新增成员不影响现有实现 |</p>
<p><strong>混合使用模式</strong></p>
<p>场景：抽象类实现部分接口</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Shape</span> &#123;<br>  <span class="hljs-title function_">area</span>(): <span class="hljs-built_in">number</span>;<br>  <span class="hljs-title function_">perimeter</span>(): <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Polygon</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Shape</span> &#123;<br>  <span class="hljs-comment">// 实现部分接口方法</span><br>  <span class="hljs-keyword">abstract</span> <span class="hljs-title function_">area</span>(): <span class="hljs-built_in">number</span>;  <span class="hljs-comment">// 仍需子类实现</span><br>  <br>  <span class="hljs-comment">// 提供默认实现</span><br>  <span class="hljs-title function_">perimeter</span>(): <span class="hljs-built_in">number</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getSides</span>().<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, side</span>) =&gt;</span> sum + side, <span class="hljs-number">0</span>);<br>  &#125;<br>  <br>  <span class="hljs-comment">// 抽象方法（非接口要求）</span><br>  <span class="hljs-keyword">abstract</span> <span class="hljs-title function_">getSides</span>(): <span class="hljs-built_in">number</span>[];<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Polygon</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>, <span class="hljs-keyword">private</span> <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span></span>) &#123;<br>    <span class="hljs-variable language_">super</span>();<br>  &#125;<br>  <br>  <span class="hljs-title function_">area</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span>;<br>  &#125;<br>  <br>  <span class="hljs-title function_">getSides</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> [<span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span>];<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>实现规范与最佳实践</strong></p>
<ol>
<li>接口隔离原则：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 拆分大接口</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Printer</span> &#123;<br>  <span class="hljs-title function_">print</span>(<span class="hljs-attr">document</span>: <span class="hljs-title class_">Document</span>): <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Scanner</span> &#123;<br>  <span class="hljs-title function_">scan</span>(): <span class="hljs-title class_">Document</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AllInOnePrinter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Printer</span>, <span class="hljs-title class_">Scanner</span> &#123;<br>  <span class="hljs-comment">// 分别实现小接口</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>抽象类作为模板：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataProcessor</span> &#123;<br>  <span class="hljs-comment">// 模板方法（固定流程）</span><br>  <span class="hljs-title function_">process</span>(<span class="hljs-params"><span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validate</span>(data);<br>    <span class="hljs-keyword">const</span> cleaned = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clean</span>(data);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">transform</span>(cleaned);<br>  &#125;<br>  <br>  <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-title function_">clean</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">string</span>;<br>  <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-title function_">transform</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">unknown</span>;<br>  <br>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">validate</span>(<span class="hljs-params"><span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-keyword">if</span> (!data) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Invalid data&quot;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>接口扩展抽象类：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Component</span> &#123;<br>  <span class="hljs-keyword">abstract</span> <span class="hljs-title function_">render</span>(): <span class="hljs-title class_">HTMLElement</span>;<br>&#125;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Stateful</span> &#123;<br>  <span class="hljs-title function_">setState</span>(<span class="hljs-attr">state</span>: <span class="hljs-built_in">object</span>): <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Button</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Stateful</span> &#123;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-keyword">return</span> <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;button&quot;</span>); &#125;<br>  <span class="hljs-title function_">setState</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">/*...*/</span> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>避免空实现（违反接口契约）：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 反模式：空实现</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">EmptyLogger</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Loggable</span> &#123;<br>  <span class="hljs-title function_">log</span>(<span class="hljs-params"></span>) &#123;&#125; <span class="hljs-comment">// 🚫 违反接口语义</span><br>&#125;<br><br><span class="hljs-comment">// 正确：抛出明确错误</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NotImplementedLogger</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Loggable</span> &#123;<br>  <span class="hljs-title function_">log</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Method not implemented&quot;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>类型检查要点</strong></p>
<ol>
<li>实现兼容性：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ClockInterface</span> &#123;<br>  <span class="hljs-attr">currentTime</span>: <span class="hljs-title class_">Date</span>;<br>  <span class="hljs-title function_">setTime</span>(<span class="hljs-attr">d</span>: <span class="hljs-title class_">Date</span>): <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Clock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ClockInterface</span> &#123;<br>  <span class="hljs-attr">currentTime</span>: <span class="hljs-title class_">Date</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br>  <br>  <span class="hljs-comment">// ✅ 参数类型兼容（Date → Date）</span><br>  <span class="hljs-title function_">setTime</span>(<span class="hljs-params"><span class="hljs-attr">d</span>: <span class="hljs-title class_">Date</span></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTime</span> = d;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>可选接口成员：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> &#123;<br>  <span class="hljs-attr">required</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">optional</span>?: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 可选属性</span><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Config</span> &#123;<br>  required = <span class="hljs-string">&quot;default&quot;</span>;<br>  <span class="hljs-comment">// 无需实现 optional</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>只读接口属性：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ImmutablePoint</span> &#123;<br>  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>;<br>  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ImmutablePoint</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>, <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span></span>) &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-4-类静态成员与构造签名"><a href="#1-2-4-类静态成员与构造签名" class="headerlink" title="1.2.4 类静态成员与构造签名"></a>1.2.4 类静态成员与构造签名</h3><p><strong>静态成员（Static Members）</strong></p>
<p>核心特性：</p>
<ol>
<li>使用 static 关键字声明</li>
<li>通过类名直接访问（而非实例）</li>
<li>不可访问实例成员</li>
<li>可继承（子类可通过 super 或类名访问）</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MathUtils</span> &#123;<br>  <span class="hljs-comment">// 静态属性</span><br>  <span class="hljs-keyword">static</span> <span class="hljs-variable constant_">PI</span> = <span class="hljs-number">3.14159</span>;<br>  <br>  <span class="hljs-comment">// 静态方法</span><br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">calculateCircleArea</span>(<span class="hljs-attr">radius</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">number</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">PI</span> * radius * radius; <span class="hljs-comment">// 注意：this指向类本身</span><br>  &#125;<br>  <br>  <span class="hljs-comment">// 错误示例：访问实例成员</span><br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">invalidMethod</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>); <span class="hljs-comment">// 🚫 错误！无法访问实例属性</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 访问静态成员</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">MathUtils</span>.<span class="hljs-property">PI</span>); <span class="hljs-comment">// 3.14159</span><br><span class="hljs-keyword">const</span> area = <span class="hljs-title class_">MathUtils</span>.<span class="hljs-title function_">calculateCircleArea</span>(<span class="hljs-number">5</span>); <span class="hljs-comment">// 78.53975</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AdvancedMath</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">MathUtils</span> &#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">logPI</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;PI value:&quot;</span>, <span class="hljs-variable language_">super</span>.<span class="hljs-property">PI</span>); <span class="hljs-comment">// 通过super访问</span><br>    <span class="hljs-comment">// 或 console.log(MathUtils.PI);</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>静态块（Static Blocks）</strong></p>
<p>TS 4.4+ 特性：用于初始化复杂静态属性</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigLoader</span> &#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;;<br>  <br>  <span class="hljs-keyword">static</span> &#123;<br>    <span class="hljs-comment">// 执行复杂初始化</span><br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&quot;config.json&quot;</span>, <span class="hljs-string">&quot;utf8&quot;</span>));<br>    &#125; <span class="hljs-keyword">catch</span> &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span> = &#123; <span class="hljs-attr">default</span>: <span class="hljs-string">&quot;value&quot;</span> &#125;;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>构造签名（Constructor Signatures）</strong></p>
<p>核心概念：描述类的构造函数类型</p>
<p>基本语法：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 构造签名表示法</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ClockConstructor</span> &#123;<br>  <span class="hljs-title function_">new</span> (<span class="hljs-attr">hour</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">minute</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">ClockInterface</span>;<br>&#125;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ClockInterface</span> &#123;<br>  <span class="hljs-title function_">tick</span>(): <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-comment">// 实现构造签名</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DigitalClock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ClockInterface</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-attr">h</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">m</span>: <span class="hljs-built_in">number</span></span>) &#123;&#125; <span class="hljs-comment">// 实现构造函数</span><br>  <span class="hljs-title function_">tick</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;beep beep&quot;</span>); &#125;<br>&#125;<br><br><span class="hljs-comment">// 工厂函数使用构造签名</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createClock</span>(<span class="hljs-params"></span><br><span class="hljs-params">  <span class="hljs-attr">ctor</span>: <span class="hljs-title class_">ClockConstructor</span>,</span><br><span class="hljs-params">  <span class="hljs-attr">hour</span>: <span class="hljs-built_in">number</span>,</span><br><span class="hljs-params">  <span class="hljs-attr">minute</span>: <span class="hljs-built_in">number</span></span><br><span class="hljs-params"></span>): <span class="hljs-title class_">ClockInterface</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">ctor</span>(hour, minute);<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> digital = <span class="hljs-title function_">createClock</span>(<span class="hljs-title class_">DigitalClock</span>, <span class="hljs-number">12</span>, <span class="hljs-number">30</span>);<br>digital.<span class="hljs-title function_">tick</span>(); <span class="hljs-comment">// &quot;beep beep&quot;</span><br></code></pre></td></tr></table></figure>

<p><strong>静态成员与构造签名实战</strong></p>
<p>场景1：单例模式</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">instance</span>: <span class="hljs-title class_">AppConfig</span>;<br>  <br>  <span class="hljs-comment">// 私有构造器防止外部实例化</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> <span class="hljs-attr">env</span>: <span class="hljs-built_in">string</span></span>) &#123;&#125;<br>  <br>  <span class="hljs-comment">// 静态访问点</span><br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getInstance</span>(): <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">AppConfig</span>.<span class="hljs-property">instance</span>) &#123;<br>      <span class="hljs-title class_">AppConfig</span>.<span class="hljs-property">instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppConfig</span>(<span class="hljs-string">&quot;production&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">AppConfig</span>.<span class="hljs-property">instance</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> config = <span class="hljs-title class_">AppConfig</span>.<span class="hljs-title function_">getInstance</span>();<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(config.<span class="hljs-property">env</span>); <span class="hljs-comment">// &quot;production&quot;</span><br></code></pre></td></tr></table></figure>

<p>场景2：类注册系统</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 构造签名定义</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">PluginConstructor</span> &#123;<br>  <span class="hljs-title function_">new</span> (): <span class="hljs-title class_">Plugin</span>;<br>  <span class="hljs-attr">pluginName</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 静态属性要求</span><br>&#125;<br><br><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Plugin</span> &#123;<br>  <span class="hljs-keyword">abstract</span> <span class="hljs-title function_">run</span>(): <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-comment">// 注册表</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PluginRegistry</span> &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">plugins</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">PluginConstructor</span>&gt; = &#123;&#125;;<br>  <br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">register</span>(<span class="hljs-params"><span class="hljs-attr">ctor</span>: <span class="hljs-title class_">PluginConstructor</span></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span>[ctor.<span class="hljs-property">pluginName</span>] = ctor;<br>  &#125;<br>  <br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">create</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Plugin</span> | <span class="hljs-literal">null</span> &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-title class_">Ctor</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span>[name];<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Ctor</span> ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ctor</span>() : <span class="hljs-literal">null</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 插件实现</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggerPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Plugin</span> &#123;<br>  <span class="hljs-keyword">static</span> pluginName = <span class="hljs-string">&quot;Logger&quot;</span>; <span class="hljs-comment">// 满足静态属性要求</span><br>  <span class="hljs-title function_">run</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Logging...&quot;</span>); &#125;<br>&#125;<br><br><span class="hljs-comment">// 注册并使用</span><br><span class="hljs-title class_">PluginRegistry</span>.<span class="hljs-title function_">register</span>(<span class="hljs-title class_">LoggerPlugin</span>);<br><span class="hljs-keyword">const</span> plugin = <span class="hljs-title class_">PluginRegistry</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">&quot;Logger&quot;</span>);<br>plugin?.<span class="hljs-title function_">run</span>(); <span class="hljs-comment">// &quot;Logging...&quot;</span><br></code></pre></td></tr></table></figure>

<p><strong>高级构造签名模式</strong></p>
<ol>
<li>泛型构造签名</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Factory</span>&lt;T&gt; &#123;<br>  <span class="hljs-title function_">new</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]): T;<br>&#125;<br><br><span class="hljs-keyword">function</span> createInstance&lt;T&gt;(<span class="hljs-title class_">Clazz</span>: <span class="hljs-title class_">Factory</span>&lt;T&gt;, ...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]): T &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Clazz</span>(...args);<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span></span>) &#123;&#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> p = <span class="hljs-title function_">createInstance</span>(<span class="hljs-title class_">Product</span>, <span class="hljs-string">&quot;P1001&quot;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p.<span class="hljs-property">id</span>); <span class="hljs-comment">// &quot;P1001&quot;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>构造函数类型别名</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 构造函数类型定义</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">StringInitializable</span> = &#123;<br>  <span class="hljs-title function_">new</span> (<span class="hljs-attr">s</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">object</span>;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringWrapper</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span></span>) &#123;&#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">wrapString</span>(<span class="hljs-params"><span class="hljs-attr">ctor</span>: <span class="hljs-title class_">StringInitializable</span>, <span class="hljs-attr">s</span>: <span class="hljs-built_in">string</span></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">ctor</span>(s);<br>&#125;<br><br><span class="hljs-keyword">const</span> wrapped = <span class="hljs-title function_">wrapString</span>(<span class="hljs-title class_">StringWrapper</span>, <span class="hljs-string">&quot;test&quot;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>((wrapped <span class="hljs-keyword">as</span> <span class="hljs-title class_">StringWrapper</span>).<span class="hljs-property">value</span>); <span class="hljs-comment">// &quot;test&quot;</span><br></code></pre></td></tr></table></figure>

<p><strong>工程实践要点</strong></p>
<ol>
<li>避免过度使用静态成员：静态成员本质是全局状态，不利于测试和扩展</li>
<li>构造签名用于依赖注入：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 依赖注入容器</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Container</span> &#123;<br>  <span class="hljs-keyword">private</span> instances = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();<br>  <br>  register&lt;T&gt;(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">ctor</span>: <span class="hljs-title function_">new</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; T) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">instances</span>.<span class="hljs-title function_">set</span>(key, <span class="hljs-keyword">new</span> <span class="hljs-title function_">ctor</span>());<br>  &#125;<br>  <br>  resolve&lt;T&gt;(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>): T &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">instances</span>.<span class="hljs-title function_">get</span>(key);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> container = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Container</span>();<br>container.<span class="hljs-title function_">register</span>(<span class="hljs-string">&quot;logger&quot;</span>, <span class="hljs-title class_">ConsoleLogger</span>);<br><span class="hljs-keyword">const</span> logger = container.<span class="hljs-property">resolve</span>&lt;<span class="hljs-title class_">ConsoleLogger</span>&gt;(<span class="hljs-string">&quot;logger&quot;</span>);<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>静态成员类型安全：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Validator</span> &#123;<br>  <span class="hljs-keyword">static</span> patterns = &#123;<br>    <span class="hljs-attr">email</span>: <span class="hljs-regexp">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>,<br>    <span class="hljs-attr">phone</span>: <span class="hljs-regexp">/^\d&#123;10&#125;$/</span><br>  &#125;;<br>  <br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">validate</span>(<span class="hljs-params"><span class="hljs-attr">type</span>: keyof <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Validator</span>.patterns, <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">patterns</span>[<span class="hljs-keyword">type</span>].<span class="hljs-title function_">test</span>(value);<br>  &#125;<br>&#125;<br><br><span class="hljs-title class_">Validator</span>.<span class="hljs-title function_">validate</span>(<span class="hljs-string">&quot;email&quot;</span>, <span class="hljs-string">&quot;test@example.com&quot;</span>); <span class="hljs-comment">// ✅</span><br><span class="hljs-title class_">Validator</span>.<span class="hljs-title function_">validate</span>(<span class="hljs-string">&quot;postal&quot;</span>, <span class="hljs-string">&quot;12345&quot;</span>); <span class="hljs-comment">// 🚫 错误！无此类型</span><br></code></pre></td></tr></table></figure>

<ol start="4">
<li>构造签名约束：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 要求构造函数具有特定静态属性</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">PluginCtor</span> &#123;<br>  <span class="hljs-title function_">new</span> (): <span class="hljs-title class_">Plugin</span>;<br>  <span class="hljs-attr">version</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">dependencies</span>?: <span class="hljs-built_in">string</span>[];<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">loadPlugin</span>(<span class="hljs-params"><span class="hljs-attr">ctor</span>: <span class="hljs-title class_">PluginCtor</span></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Loading <span class="hljs-subst">$&#123;ctor.name&#125;</span> v<span class="hljs-subst">$&#123;ctor.version&#125;</span>`</span>);<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="1-3-函数与泛型编程"><a href="#1-3-函数与泛型编程" class="headerlink" title="1.3 函数与泛型编程"></a>1.3 函数与泛型编程</h2><h3 id="1-3-1-函数类型定义与上下文推断"><a href="#1-3-1-函数类型定义与上下文推断" class="headerlink" title="1.3.1 函数类型定义与上下文推断"></a>1.3.1 函数类型定义与上下文推断</h3><p><strong>函数类型定义方式</strong></p>
<ol>
<li>函数声明式</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 完整类型注解</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params"><span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">return</span> x + y;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>函数表达式</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 变量类型注解</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">multiply</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">x, y</span>) &#123;<br>  <span class="hljs-keyword">return</span> x * y;<br>&#125;;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>箭头函数</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 类型注解在变量上</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">divide</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">dividend</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">divisor</span>: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span> = <br>  <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a / b;<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>对象方法</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> calculator = &#123;<br>  <span class="hljs-attr">sum</span>: (<span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">number</span> =&gt;</span> x + y,<br>  <span class="hljs-title function_">subtract</span>(<span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">number</span> &#123;<br>    <span class="hljs-keyword">return</span> x - y;<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>函数类型签名详解</strong></p>
<p>基本结构：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">AddFunction</span> = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;<br></code></pre></td></tr></table></figure>

<p>可选参数：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">GreetFunction</span> = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">prefix</span>?: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">string</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">greet</span>: <span class="hljs-title class_">GreetFunction</span> = <span class="hljs-function">(<span class="hljs-params">n, p</span>) =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;p || <span class="hljs-string">&quot;Hello&quot;</span>&#125;</span> <span class="hljs-subst">$&#123;n&#125;</span>`</span>;<br><span class="hljs-title function_">greet</span>(<span class="hljs-string">&quot;Alice&quot;</span>); <span class="hljs-comment">// ✅ 允许省略可选参数</span><br></code></pre></td></tr></table></figure>

<p>默认参数：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">CreateUser</span> = <span class="hljs-function">(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-function">  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, </span></span><br><span class="hljs-params"><span class="hljs-function">  <span class="hljs-attr">role</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">&quot;user&quot;</span> <span class="hljs-comment">// 默认值</span></span></span><br><span class="hljs-params"><span class="hljs-function"></span>) =&gt;</span> <span class="hljs-built_in">void</span>;<br></code></pre></td></tr></table></figure>

<p>剩余参数：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">SumFunction</span> = <span class="hljs-function">(<span class="hljs-params">...<span class="hljs-attr">numbers</span>: <span class="hljs-built_in">number</span>[]</span>) =&gt;</span> <span class="hljs-built_in">number</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">sum</span>: <span class="hljs-title class_">SumFunction</span> = <span class="hljs-function">(<span class="hljs-params">...nums</span>) =&gt;</span> nums.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>);<br><span class="hljs-title function_">sum</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// 6</span><br></code></pre></td></tr></table></figure>

<p><strong>上下文类型推断（Contextual Typing）</strong></p>
<p>核心原理：TypeScript 根据函数被使用的位置自动推断参数类型</p>
<p>典型场景：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 场景1：回调函数参数推断</span><br>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>].<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num * <span class="hljs-number">2</span>); <span class="hljs-comment">// num 推断为 number</span><br><br><span class="hljs-comment">// 场景2：事件处理函数</span><br><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(event.<span class="hljs-property">clientX</span>); <span class="hljs-comment">// event 推断为 MouseEvent</span><br>&#125;);<br><br><span class="hljs-comment">// 场景3：函数作为参数传递</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">runCallback</span>(<span class="hljs-params"><span class="hljs-attr">cb</span>: (value: <span class="hljs-built_in">string</span>) =&gt; <span class="hljs-built_in">void</span></span>) &#123;<br>  <span class="hljs-title function_">cb</span>(<span class="hljs-string">&quot;test&quot;</span>);<br>&#125;<br><br><span class="hljs-title function_">runCallback</span>(<span class="hljs-function"><span class="hljs-params">str</span> =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str.<span class="hljs-title function_">toUpperCase</span>()); <span class="hljs-comment">// str 推断为 string</span><br>&#125;);<br></code></pre></td></tr></table></figure>

<p>显式覆盖上下文类型：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 使用类型断言覆盖推断</span><br><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;keydown&quot;</span>, <span class="hljs-function">(<span class="hljs-params">event <span class="hljs-keyword">as</span> <span class="hljs-title class_">KeyboardEvent</span></span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(event.<span class="hljs-property">key</span>); <span class="hljs-comment">// 强制指定为 KeyboardEvent</span><br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>函数类型兼容性</strong></p>
<p>参数兼容规则：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Handler</span> = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;<br><br><span class="hljs-comment">// ✅ 兼容：参数类型更具体</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">h1</span>: <span class="hljs-title class_">Handler</span> = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>) =&gt;</span> &#123;&#125;;<br><span class="hljs-comment">// ✅ 兼容：参数数量更少</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">h2</span>: <span class="hljs-title class_">Handler</span> = <span class="hljs-function">() =&gt;</span> &#123;&#125;;<br><span class="hljs-comment">// 🚫 不兼容：参数类型冲突</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">h3</span>: <span class="hljs-title class_">Handler</span> = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span></span>) =&gt;</span> &#123;&#125;; <span class="hljs-comment">// 错误！</span><br><br><span class="hljs-comment">// 返回值兼容规则</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Factory</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">string</span>;<br><span class="hljs-comment">// ✅ 兼容：返回值更具体</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">f1</span>: <span class="hljs-title class_">Factory</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-string">&quot;hello&quot;</span>;<br><span class="hljs-comment">// 🚫 不兼容：返回值类型冲突</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">f2</span>: <span class="hljs-title class_">Factory</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-number">123</span>; <span class="hljs-comment">// 错误！</span><br></code></pre></td></tr></table></figure>

<p>对象方法兼容：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Component</span> &#123;<br>  <span class="hljs-attr">onEvent</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-comment">// ✅ 兼容：参数数量更少</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">comp</span>: <span class="hljs-title class_">Component</span> = &#123;<br>  <span class="hljs-attr">onEvent</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Event fired&quot;</span>)<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>void 返回类型的特殊行为</strong></p>
<p>关键特性：允许返回任意值（但返回值会被忽略）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">VoidFunc</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;<br><br><span class="hljs-comment">// 合法实现（虽然返回了值）</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">fn</span>: <span class="hljs-title class_">VoidFunc</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-string">&quot;hello&quot;</span>;<br><br><span class="hljs-comment">// 使用场景</span><br><span class="hljs-keyword">const</span> strings = [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>];<br><span class="hljs-keyword">const</span> <span class="hljs-attr">results</span>: <span class="hljs-built_in">void</span>[] = strings.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(s)); <span class="hljs-comment">// 允许返回void</span><br></code></pre></td></tr></table></figure>

<p>与undefined的区别：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 必须显式返回undefined</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">StrictVoid</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-literal">undefined</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-attr">strictFn</span>: <span class="hljs-title class_">StrictVoid</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-literal">undefined</span>; <span class="hljs-comment">// ✅</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">invalidFn</span>: <span class="hljs-title class_">StrictVoid</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-string">&quot;test&quot;</span>;   <span class="hljs-comment">// 🚫 错误</span><br></code></pre></td></tr></table></figure>

<p><strong>工程实践要点</strong></p>
<ol>
<li>优先使用上下文推断：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 推荐：让TS自动推断</span><br>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>].<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num * <span class="hljs-number">2</span>);<br><br><span class="hljs-comment">// 不推荐：冗余注解</span><br>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>].<span class="hljs-title function_">map</span>((<span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">number</span> =&gt;</span> num * <span class="hljs-number">2</span>);<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>回调函数参数命名约定：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 使用描述性参数名增强可读性</span><br><span class="hljs-title function_">fetchUser</span>(<span class="hljs-function"><span class="hljs-params">userId</span> =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(userId); <span class="hljs-comment">// 比 `id` 更明确</span><br>&#125;);<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>避免any污染函数链：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 危险：any类型传播</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">dangerous</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">input</span>: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">number</span> = <span class="hljs-function"><span class="hljs-params">input</span> =&gt;</span> input.<span class="hljs-property">length</span>;<br><br><span class="hljs-comment">// 安全：明确类型约束</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">safe</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> <span class="hljs-built_in">number</span> = <span class="hljs-function"><span class="hljs-params">input</span> =&gt;</span> input.<span class="hljs-property">length</span>;<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>函数重载优先于联合参数：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 不推荐：联合类型参数</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">padLeft</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">padding</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">string</span> &#123;<br>  <span class="hljs-comment">/*...*/</span><br>&#125;<br><br><span class="hljs-comment">// 推荐：函数重载（下一节内容）</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">padLeft</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">padding</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">padLeft</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">padding</span>: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">string</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">padLeft</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">padding</span>: <span class="hljs-built_in">any</span></span>): <span class="hljs-built_in">string</span> &#123;<br>  <span class="hljs-comment">/*...*/</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>函数类型高级技巧</strong></p>
<p>函数属性扩展：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">SearchFunction</span> &#123;<br>  (<span class="hljs-attr">source</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">subString</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">boolean</span>;<br>  <span class="hljs-comment">// 附加属性</span><br>  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>;<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">mySearch</span>: <span class="hljs-title class_">SearchFunction</span> = <span class="hljs-function">(<span class="hljs-params">src, sub</span>) =&gt;</span> src.<span class="hljs-title function_">includes</span>(sub);<br>mySearch.<span class="hljs-property">description</span> = <span class="hljs-string">&quot;String search function&quot;</span>;<br></code></pre></td></tr></table></figure>

<p>构造签名函数：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ClockConstructor</span> &#123;<br>  <span class="hljs-title function_">new</span> (<span class="hljs-attr">hour</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">minute</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">ClockInterface</span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createClock</span>(<span class="hljs-params"><span class="hljs-attr">ctor</span>: <span class="hljs-title class_">ClockConstructor</span>, <span class="hljs-attr">h</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">m</span>: <span class="hljs-built_in">number</span></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">ctor</span>(h, m);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-2-函数重载的工程实践"><a href="#1-3-2-函数重载的工程实践" class="headerlink" title="1.3.2 函数重载的工程实践"></a>1.3.2 函数重载的工程实践</h3><p><strong>函数重载基础概念</strong></p>
<p>核心目的：为同一函数提供多个类型签名，处理不同参数组合或返回类型</p>
<p>基本结构：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 重载签名（类型声明）</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">parseInput</span>(<span class="hljs-params"><span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">number</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">parseInput</span>(<span class="hljs-params"><span class="hljs-attr">input</span>: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">string</span>;<br><br><span class="hljs-comment">// 实现签名（实际函数体）</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">parseInput</span>(<span class="hljs-params"><span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> input === <span class="hljs-string">&quot;string&quot;</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseInt</span>(input, <span class="hljs-number">10</span>); <span class="hljs-comment">// 返回 number</span><br>  &#125;<br>  <span class="hljs-keyword">return</span> input.<span class="hljs-title function_">toString</span>(); <span class="hljs-comment">// 返回 string</span><br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> num = <span class="hljs-title function_">parseInput</span>(<span class="hljs-string">&quot;123&quot;</span>); <span class="hljs-comment">// number</span><br><span class="hljs-keyword">const</span> str = <span class="hljs-title function_">parseInput</span>(<span class="hljs-number">123</span>);   <span class="hljs-comment">// string</span><br></code></pre></td></tr></table></figure>

<p><strong>重载规则与特性</strong></p>
<ol>
<li>优先级规则：<ul>
<li>从上到下匹配第一个符合的重载签名</li>
<li>实现签名不可直接调用（对外不可见）</li>
</ul>
</li>
<li>参数类型兼容：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 正确：实现签名必须兼容所有重载</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span>;    <span class="hljs-comment">// ✅</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">void</span>; <span class="hljs-comment">// ✅</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">b</span>?: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">void</span> &#123;&#125; <span class="hljs-comment">// ✅</span><br><br><span class="hljs-comment">// 错误：实现签名不兼容重载</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">void</span>;    <span class="hljs-comment">// 🚫</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span> &#123;&#125;  <span class="hljs-comment">// 错误：缺少number参数处理</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>返回值类型约束：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 返回值必须覆盖所有重载</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getValue</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">string</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getValue</span>(<span class="hljs-params"><span class="hljs-attr">format</span>: <span class="hljs-built_in">boolean</span></span>): <span class="hljs-built_in">number</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getValue</span>(<span class="hljs-params"><span class="hljs-attr">format</span>?: <span class="hljs-built_in">boolean</span></span>): <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">return</span> format ? <span class="hljs-number">123</span> : <span class="hljs-string">&quot;abc&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>工程实践模式</strong></p>
<p>模式1：参数类型转换</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 字符串和日期互转</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">convert</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Date</span>;       <span class="hljs-comment">// string → Date</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">convert</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-title class_">Date</span></span>): <span class="hljs-built_in">string</span>;       <span class="hljs-comment">// Date → string</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">convert</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span> | <span class="hljs-title class_">Date</span></span>): <span class="hljs-title class_">Date</span> | <span class="hljs-built_in">string</span> &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">&quot;string&quot;</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(value);<br>  &#125;<br>  <span class="hljs-keyword">return</span> value.<span class="hljs-title function_">toISOString</span>();<br>&#125;<br><br><span class="hljs-keyword">const</span> date = <span class="hljs-title function_">convert</span>(<span class="hljs-string">&quot;2023-01-01&quot;</span>);  <span class="hljs-comment">// Date</span><br><span class="hljs-keyword">const</span> str = <span class="hljs-title function_">convert</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());     <span class="hljs-comment">// string</span><br></code></pre></td></tr></table></figure>

<p>模式2：配置对象重载</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 简单模式</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">SimpleConfig</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;<br>&#125;<br><br><span class="hljs-comment">// 高级模式</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">AdvancedConfig</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">debug</span>: <span class="hljs-built_in">boolean</span>;<br>  <span class="hljs-attr">retries</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"><span class="hljs-attr">config</span>: <span class="hljs-title class_">SimpleConfig</span></span>): <span class="hljs-built_in">void</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"><span class="hljs-attr">config</span>: <span class="hljs-title class_">AdvancedConfig</span></span>): <span class="hljs-built_in">void</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"><span class="hljs-attr">config</span>: <span class="hljs-title class_">SimpleConfig</span> | <span class="hljs-title class_">AdvancedConfig</span></span>): <span class="hljs-built_in">void</span> &#123;<br>  <span class="hljs-comment">// 公共初始化逻辑</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Initializing <span class="hljs-subst">$&#123;config.name&#125;</span>`</span>);<br>  <br>  <span class="hljs-comment">// 类型守卫处理高级配置</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;debug&quot;</span> <span class="hljs-keyword">in</span> config) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Debug mode:&quot;</span>, config.<span class="hljs-property">debug</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>模式3：DOM 操作重载</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getElement</span>(<span class="hljs-params"><span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">HTMLElement</span> | <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">function</span> getElement&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HTMLElement</span>&gt;(<span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">type</span>: <span class="hljs-title function_">new</span>() =&gt; T): T | <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getElement</span>(<span class="hljs-params"><span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">type</span>?: <span class="hljs-keyword">new</span>() =&gt; <span class="hljs-title class_">HTMLElement</span></span>): <span class="hljs-title class_">HTMLElement</span> | <span class="hljs-literal">null</span> &#123;<br>  <span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(id);<br>  <span class="hljs-keyword">if</span> (el &amp;&amp; <span class="hljs-keyword">type</span> &amp;&amp; !(el <span class="hljs-keyword">instanceof</span> <span class="hljs-keyword">type</span>)) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Element type mismatch`</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> el;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> div = <span class="hljs-title function_">getElement</span>(<span class="hljs-string">&quot;header&quot;</span>, <span class="hljs-title class_">HTMLDivElement</span>); <span class="hljs-comment">// HTMLDivElement | null</span><br><span class="hljs-keyword">const</span> generic = <span class="hljs-title function_">getElement</span>(<span class="hljs-string">&quot;content&quot;</span>);            <span class="hljs-comment">// HTMLElement | null</span><br></code></pre></td></tr></table></figure>

<p><strong>联合类型 vs 函数重载</strong></p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">推荐方案</th>
<th align="left">原因</th>
</tr>
</thead>
<tbody><tr>
<td align="left">参数类型决定返回值类型</td>
<td align="left">函数重载</td>
<td align="left">提供精确的返回类型</td>
</tr>
<tr>
<td align="left">参数数量变化</td>
<td align="left">函数重载</td>
<td align="left">明确不同参数组合</td>
</tr>
<tr>
<td align="left">参数类型相同但处理逻辑不同</td>
<td align="left">联合类型 + 类型守卫</td>
<td align="left">避免重载签名膨胀</td>
</tr>
<tr>
<td align="left">复杂配置对象</td>
<td align="left">函数重载</td>
<td align="left">区分不同配置结构</td>
</tr>
<tr>
<td align="left">简单类型变换</td>
<td align="left">联合类型</td>
<td align="left">减少样板代码</td>
</tr>
</tbody></table>
<p>联合类型示例（适合简单场景）：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 使用联合类型替代重载</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">padLeft</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">padding</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">string</span> &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> padding === <span class="hljs-string">&quot;number&quot;</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot; &quot;</span>.<span class="hljs-title function_">repeat</span>(padding) + value;<br>  &#125;<br>  <span class="hljs-keyword">return</span> padding + value;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>最佳实践指南</strong></p>
<ol>
<li>控制重载数量：<ul>
<li>建议不超过 5 个重载签名</li>
<li>过多重载会导致类型系统负担增加</li>
</ul>
</li>
<li>公共前置处理：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">processData</span>(<span class="hljs-params"><span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">ResultA</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">processData</span>(<span class="hljs-params"><span class="hljs-attr">data</span>: <span class="hljs-title class_">Buffer</span></span>): <span class="hljs-title class_">ResultB</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">processData</span>(<span class="hljs-params"><span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span> | <span class="hljs-title class_">Buffer</span></span>): <span class="hljs-title class_">ResultA</span> | <span class="hljs-title class_">ResultB</span> &#123;<br>  <span class="hljs-comment">// 公共验证逻辑</span><br>  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Empty data&quot;</span>);<br>  <br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> data === <span class="hljs-string">&quot;string&quot;</span>) &#123;<br>    <span class="hljs-comment">/* 特定处理 */</span><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">/* 特定处理 */</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>使用类型参数减少重载：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 使用泛型替代多个重载</span><br><span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">arg</span>: T): T &#123;<br>  <span class="hljs-keyword">return</span> arg;<br>&#125;<br><br><span class="hljs-comment">// 比以下重载更简洁：</span><br><span class="hljs-comment">// function identity(arg: string): string;</span><br><span class="hljs-comment">// function identity(arg: number): number;</span><br><span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></figure>

<ol start="4">
<li>文档注释规范：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建用户</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">name</span> - 用户名</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> 用户ID</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params"><span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 创建用户（带配置）</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">options</span> - 用户配置</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span> 用户ID</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params"><span class="hljs-attr">options</span>: <span class="hljs-title class_">UserOptions</span></span>): <span class="hljs-built_in">string</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params"><span class="hljs-attr">param</span>: <span class="hljs-built_in">string</span> | <span class="hljs-title class_">UserOptions</span></span>): <span class="hljs-built_in">string</span> &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>常见错误与解决方案</strong></p>
<p>错误1：忽略实现签名兼容性</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 错误实现</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>?: <span class="hljs-built_in">string</span></span>) &#123;&#125; <span class="hljs-comment">// ✅ 正确</span><br><br><span class="hljs-comment">// 正确：添加必要的参数检查</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>?: <span class="hljs-built_in">string</span></span>) &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> a === <span class="hljs-string">&quot;number&quot;</span> &amp;&amp; b === <span class="hljs-literal">undefined</span>) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Missing second argument&quot;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>错误2：返回值类型不完整</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 错误：缺少boolean返回类型</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">string</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"><span class="hljs-attr">flag</span>: <span class="hljs-built_in">boolean</span></span>): <span class="hljs-built_in">number</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"><span class="hljs-attr">flag</span>?: <span class="hljs-built_in">boolean</span></span>): <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> &#123; <br>  <span class="hljs-keyword">return</span> flag ? <span class="hljs-number">123</span> : <span class="hljs-string">&quot;abc&quot;</span>; <br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> result = <span class="hljs-title function_">test</span>(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// number ✅</span><br><span class="hljs-keyword">const</span> result2 = <span class="hljs-title function_">test</span>();     <span class="hljs-comment">// string ✅</span><br><span class="hljs-keyword">const</span> result3 = <span class="hljs-title function_">test</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// 🚫 错误！未声明返回boolean</span><br></code></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 修正：添加完整重载</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">string</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"><span class="hljs-attr">flag</span>: <span class="hljs-literal">true</span></span>): <span class="hljs-built_in">number</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"><span class="hljs-attr">flag</span>: <span class="hljs-literal">false</span></span>): <span class="hljs-built_in">string</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"><span class="hljs-attr">flag</span>?: <span class="hljs-built_in">boolean</span></span>): <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">return</span> flag ? <span class="hljs-number">123</span> : <span class="hljs-string">&quot;abc&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>高级工程案例</strong></p>
<p>API 请求重载：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 简单GET请求</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">request</span>(<span class="hljs-params"><span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Response</span>&gt;;<br><br><span class="hljs-comment">// 带参数的GET请求</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">request</span>(<span class="hljs-params"><span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Response</span>&gt;;<br><br><span class="hljs-comment">// POST请求</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">request</span>(<span class="hljs-params"><span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>, <span class="hljs-attr">body</span>: <span class="hljs-built_in">object</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Response</span>&gt;;<br><br><span class="hljs-comment">// 实现</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">request</span>(<span class="hljs-params"></span><br><span class="hljs-params">  <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>,</span><br><span class="hljs-params">  <span class="hljs-attr">paramsOrMethod</span>?: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; | <span class="hljs-string">&quot;POST&quot;</span>,</span><br><span class="hljs-params">  <span class="hljs-attr">body</span>?: <span class="hljs-built_in">object</span></span><br><span class="hljs-params"></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Response</span>&gt; &#123;<br>  <span class="hljs-keyword">if</span> (paramsOrMethod === <span class="hljs-literal">undefined</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(url);<br>  &#125;<br>  <br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> paramsOrMethod === <span class="hljs-string">&quot;object&quot;</span>) &#123;<br>    <span class="hljs-keyword">const</span> query = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(paramsOrMethod).<span class="hljs-title function_">toString</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;url&#125;</span>?<span class="hljs-subst">$&#123;query&#125;</span>`</span>);<br>  &#125;<br>  <br>  <span class="hljs-keyword">if</span> (paramsOrMethod === <span class="hljs-string">&quot;POST&quot;</span> &amp;&amp; body) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(url, &#123;<br>      <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>,<br>      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(body)<br>    &#125;);<br>  &#125;<br>  <br>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Invalid arguments&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-3-泛型约束与默认类型"><a href="#1-3-3-泛型约束与默认类型" class="headerlink" title="1.3.3 泛型约束与默认类型"></a>1.3.3 泛型约束与默认类型</h3><p><strong>泛型约束（Generic Constraints）</strong></p>
<p>核心目的：限制泛型参数必须满足特定条件</p>
<p>基础语法：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> identity&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ConstraintType</span>&gt;(<span class="hljs-attr">arg</span>: T): T &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>基本约束示例：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Lengthwise</span> &#123;<br>  <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-comment">// T 必须包含 length 属性</span><br><span class="hljs-keyword">function</span> logLength&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Lengthwise</span>&gt;(<span class="hljs-attr">arg</span>: T): T &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arg.<span class="hljs-property">length</span>);<br>  <span class="hljs-keyword">return</span> arg;<br>&#125;<br><br><span class="hljs-title function_">logLength</span>(<span class="hljs-string">&quot;hello&quot;</span>); <span class="hljs-comment">// ✅ 字符串有 length</span><br><span class="hljs-title function_">logLength</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]); <span class="hljs-comment">// ✅ 数组有 length</span><br><span class="hljs-title function_">logLength</span>(<span class="hljs-number">100</span>); <span class="hljs-comment">// 🚫 错误！数字没有 length</span><br></code></pre></td></tr></table></figure>

<p><strong>多约束条件</strong></p>
<p>使用 &amp; 运算符：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Printable</span> &#123;<br>  <span class="hljs-title function_">print</span>(): <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Loggable</span> &#123;<br>  <span class="hljs-title function_">log</span>(): <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-comment">// T 必须同时满足 Printable 和 Loggable</span><br><span class="hljs-keyword">function</span> processItem&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Printable</span> &amp; <span class="hljs-title class_">Loggable</span>&gt;(<span class="hljs-attr">item</span>: T) &#123;<br>  item.<span class="hljs-title function_">print</span>();<br>  item.<span class="hljs-title function_">log</span>();<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Document</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Printable</span>, <span class="hljs-title class_">Loggable</span> &#123;<br>  <span class="hljs-title function_">print</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Printing document&quot;</span>); &#125;<br>  <span class="hljs-title function_">log</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Logging document&quot;</span>); &#125;<br>&#125;<br><br><span class="hljs-title function_">processItem</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>()); <span class="hljs-comment">// ✅</span><br></code></pre></td></tr></table></figure>

<p><strong>类型参数约束</strong></p>
<p>约束泛型参数之间的关系：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 确保 K 是 T 的键名</span><br><span class="hljs-keyword">function</span> getProperty&lt;T, K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">obj</span>: T, <span class="hljs-attr">key</span>: K) &#123;<br>  <span class="hljs-keyword">return</span> obj[key];<br>&#125;<br><br><span class="hljs-keyword">const</span> person = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> &#125;;<br><span class="hljs-title function_">getProperty</span>(person, <span class="hljs-string">&quot;name&quot;</span>); <span class="hljs-comment">// ✅</span><br><span class="hljs-title function_">getProperty</span>(person, <span class="hljs-string">&quot;email&quot;</span>); <span class="hljs-comment">// 🚫 错误！不存在该属性</span><br></code></pre></td></tr></table></figure>

<p>构造函数约束：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 要求泛型 T 必须可构造</span><br><span class="hljs-keyword">function</span> createInstance&lt;T <span class="hljs-keyword">extends</span> &#123; <span class="hljs-title function_">new</span> (): <span class="hljs-title class_">InstanceType</span> &#125;&gt;(<span class="hljs-attr">ctor</span>: T) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">ctor</span>();<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> &#123;&#125;<br><span class="hljs-keyword">const</span> instance = <span class="hljs-title function_">createInstance</span>(<span class="hljs-title class_">MyClass</span>); <span class="hljs-comment">// ✅</span><br></code></pre></td></tr></table></figure>

<p><strong>泛型默认类型（Default Types）</strong></p>
<p>核心目的：为泛型参数提供默认值，简化使用</p>
<p>基本语法：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiResponse</span>&lt;T = <span class="hljs-built_in">any</span>&gt; &#123;<br>  <span class="hljs-attr">data</span>: T;<br>  <span class="hljs-attr">status</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-comment">// 使用默认类型</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">response</span>: <span class="hljs-title class_">ApiResponse</span> = &#123; <br>  <span class="hljs-attr">data</span>: <span class="hljs-string">&quot;untyped data&quot;</span>, <span class="hljs-comment">// any 类型</span><br>  <span class="hljs-attr">status</span>: <span class="hljs-number">200</span><br>&#125;;<br><br><span class="hljs-comment">// 显式指定类型</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">userResponse</span>: <span class="hljs-title class_">ApiResponse</span>&lt;<span class="hljs-title class_">User</span>&gt; = &#123;<br>  <span class="hljs-attr">data</span>: &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span> &#125;,<br>  <span class="hljs-attr">status</span>: <span class="hljs-number">200</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>约束与默认类型组合</strong></p>
<p>复杂场景应用：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 1. 约束 + 默认类型</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaginatedResult</span>&lt;T = <span class="hljs-built_in">object</span>&gt; &#123;<br>  <span class="hljs-attr">items</span>: T[];<br>  <span class="hljs-attr">total</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-comment">// 2. 函数中使用</span><br><span class="hljs-keyword">function</span> fetchData&lt;T <span class="hljs-keyword">extends</span> &#123; <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> &#125; = &#123; <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> &#125;&gt;(<br>  <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span><br>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">PaginatedResult</span>&lt;T&gt;&gt; &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br><br><span class="hljs-comment">// 使用默认约束</span><br><span class="hljs-title function_">fetchData</span>(<span class="hljs-string">&quot;/users&quot;</span>); <span class="hljs-comment">// Promise&lt;PaginatedResult&lt;&#123; id: string &#125;&gt;&gt;</span><br><br><span class="hljs-comment">// 指定具体类型</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Product</span> &#123;<br>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">price</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br>fetchData&lt;<span class="hljs-title class_">Product</span>&gt;(<span class="hljs-string">&quot;/products&quot;</span>); <span class="hljs-comment">// Promise&lt;PaginatedResult&lt;Product&gt;&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>工程实践模式</strong></p>
<p>模式1：部分属性要求</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 要求对象至少包含特定属性</span><br><span class="hljs-keyword">function</span> updateRecord&lt;T <span class="hljs-keyword">extends</span> &#123; <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> &#125;&gt;(<span class="hljs-attr">record</span>: T) &#123;<br>  db.<span class="hljs-title function_">save</span>(record.<span class="hljs-property">id</span>, record);<br>&#125;<br><br><span class="hljs-comment">// 允许额外属性</span><br><span class="hljs-title function_">updateRecord</span>(&#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> &#125;); <span class="hljs-comment">// ✅</span><br></code></pre></td></tr></table></figure>

<p>模式2：工厂函数约束</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 要求类构造函数</span><br><span class="hljs-keyword">function</span> create&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title function_">new</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">any</span>&gt;(<br>  <span class="hljs-title class_">Ctor</span>: T,<br>  ...<span class="hljs-attr">args</span>: <span class="hljs-title class_">ConstructorParameters</span>&lt;T&gt;<br>): <span class="hljs-title class_">InstanceType</span>&lt;T&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ctor</span>(...args);<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span></span>) &#123;&#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> w = <span class="hljs-title function_">create</span>(<span class="hljs-title class_">Widget</span>, <span class="hljs-string">&quot;MyWidget&quot;</span>); <span class="hljs-comment">// Widget 实例</span><br></code></pre></td></tr></table></figure>

<p>模式3：API 响应标准化</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiResponse</span>&lt;T = <span class="hljs-built_in">unknown</span>, E = <span class="hljs-title class_">Error</span>&gt; &#123;<br>  <span class="hljs-attr">success</span>: <span class="hljs-built_in">boolean</span>;<br>  <span class="hljs-attr">data</span>?: T;<br>  <span class="hljs-attr">error</span>?: E;<br>  <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> createResponse&lt;T&gt;(<span class="hljs-attr">data</span>: T): <span class="hljs-title class_">ApiResponse</span>&lt;T&gt; &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,<br>    data,<br>    <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()<br>  &#125;;<br>&#125;<br><br><span class="hljs-keyword">const</span> userResponse = <span class="hljs-title function_">createResponse</span>(&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span> &#125;); <span class="hljs-comment">// ApiResponse&lt;&#123; name: string &#125;&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>最佳实践指南</strong></p>
<ol>
<li>避免过度约束：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 过度约束：限制为特定类型</span><br><span class="hljs-keyword">function</span> process&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>&gt;(<span class="hljs-attr">input</span>: T): T &#123; ... &#125;<br><br><span class="hljs-comment">// 推荐：更灵活的约束</span><br><span class="hljs-keyword">function</span> process&lt;T&gt;(<span class="hljs-attr">input</span>: T): T &#123; ... &#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>合理使用默认类型：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 为常用类型提供默认值</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Formatter</span>&lt;T = <span class="hljs-built_in">string</span>&gt; = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">input</span>: T</span>) =&gt;</span> <span class="hljs-built_in">string</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">dateFormatter</span>: <span class="hljs-title class_">Formatter</span>&lt;<span class="hljs-title class_">Date</span>&gt; = <span class="hljs-function"><span class="hljs-params">date</span> =&gt;</span> date.<span class="hljs-title function_">toISOString</span>();<br><span class="hljs-keyword">const</span> <span class="hljs-attr">defaultFormatter</span>: <span class="hljs-title class_">Formatter</span> = <span class="hljs-function"><span class="hljs-params">str</span> =&gt;</span> str.<span class="hljs-title function_">toUpperCase</span>(); <span class="hljs-comment">// 默认 string</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>约束文档化：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 合并两个对象</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@template</span> <span class="hljs-variable">T</span> - 第一个对象的类型</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@template</span> <span class="hljs-variable">U</span> - 第二个对象的类型（必须与T兼容）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">function</span> merge&lt;T, U <span class="hljs-keyword">extends</span> T&gt;(<span class="hljs-attr">obj1</span>: T, <span class="hljs-attr">obj2</span>: U): T &amp; U &#123;<br>  <span class="hljs-keyword">return</span> &#123; ...obj1, ...obj2 &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>类型参数命名约定：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 推荐：使用有意义的类型参数名</span><br><span class="hljs-keyword">function</span> getValue&lt;<span class="hljs-title class_">TObject</span>, <span class="hljs-title class_">TKey</span> <span class="hljs-keyword">extends</span> keyof <span class="hljs-title class_">TObject</span>&gt;(<br>  <span class="hljs-attr">obj</span>: <span class="hljs-title class_">TObject</span>, <br>  <span class="hljs-attr">key</span>: <span class="hljs-title class_">TKey</span><br>): <span class="hljs-title class_">TObject</span>[<span class="hljs-title class_">TKey</span>] &#123;<br>  <span class="hljs-keyword">return</span> obj[key];<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>复杂约束案例</strong></p>
<p>递归约束：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 树节点结构约束</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">TreeNode</span> &#123;<br>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">children</span>?: <span class="hljs-title class_">TreeNode</span>[];<br>&#125;<br><br><span class="hljs-keyword">function</span> walkTree&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">TreeNode</span>&gt;(<span class="hljs-attr">node</span>: T) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(node.<span class="hljs-property">id</span>);<br>  node.<span class="hljs-property">children</span>?.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> <span class="hljs-title function_">walkTree</span>(child));<br>&#125;<br><br><span class="hljs-keyword">const</span> tree = &#123;<br>  <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;root&quot;</span>,<br>  <span class="hljs-attr">children</span>: [<br>    &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;child1&quot;</span> &#125;,<br>    &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;child2&quot;</span>, <span class="hljs-attr">children</span>: [&#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;grandchild&quot;</span> &#125;] &#125;<br>  ]<br>&#125;;<br><span class="hljs-title function_">walkTree</span>(tree); <span class="hljs-comment">// ✅</span><br></code></pre></td></tr></table></figure>

<p>条件类型约束：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 确保泛型是函数类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ReturnTypeOrNever</span>&lt;T&gt; = T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; infer R ? R : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-keyword">function</span> getReturnType&lt;T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">any</span>&gt;(<br>  <span class="hljs-attr">fn</span>: T<br>): <span class="hljs-title class_">ReturnTypeOrNever</span>&lt;T&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">fn</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">ReturnTypeOrNever</span>&lt;T&gt;;<br>&#125;<br><br><span class="hljs-keyword">const</span> str = <span class="hljs-title function_">getReturnType</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-string">&quot;hello&quot;</span>); <span class="hljs-comment">// string</span><br><span class="hljs-keyword">const</span> num = <span class="hljs-title function_">getReturnType</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-number">123</span>); <span class="hljs-comment">// number</span><br></code></pre></td></tr></table></figure>

<p><strong>常见错误解决方案</strong></p>
<p>错误：约束不满足</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> getSize&lt;T <span class="hljs-keyword">extends</span> &#123; <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span> &#125;&gt;(<span class="hljs-attr">obj</span>: T): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">return</span> obj.<span class="hljs-property">length</span>;<br>&#125;<br><br><span class="hljs-title function_">getSize</span>(&#123; <span class="hljs-attr">size</span>: <span class="hljs-number">10</span> &#125;); <span class="hljs-comment">// 🚫 错误：缺少 length 属性</span><br></code></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 方法1：提供正确类型</span><br><span class="hljs-title function_">getSize</span>(&#123; <span class="hljs-attr">length</span>: <span class="hljs-number">10</span> &#125;);<br><br><span class="hljs-comment">// 方法2：扩展约束</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Sizeable</span> &#123;<br>  <span class="hljs-attr">length</span>?: <span class="hljs-built_in">number</span>;<br>  <span class="hljs-attr">size</span>?: <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> getSize&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Sizeable</span>&gt;(<span class="hljs-attr">obj</span>: T): <span class="hljs-built_in">number</span> &#123;<br>  <span class="hljs-keyword">return</span> obj.<span class="hljs-property">length</span> ?? obj.<span class="hljs-property">size</span> ?? <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>错误：默认类型与约束冲突</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> = <span class="hljs-built_in">number</span>&gt; &#123; <span class="hljs-comment">// 🚫 错误！默认类型必须满足约束</span><br>  <span class="hljs-attr">value</span>: T;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 约束和默认类型需兼容</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> = <span class="hljs-built_in">number</span>&gt; &#123;<br>  <span class="hljs-attr">value</span>: T;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-4-泛型在接口-类中的高级应用"><a href="#1-3-4-泛型在接口-类中的高级应用" class="headerlink" title="1.3.4 泛型在接口&#x2F;类中的高级应用"></a>1.3.4 泛型在接口&#x2F;类中的高级应用</h3><p><strong>泛型接口（Generic Interfaces）</strong></p>
<p>基础模式：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 简单泛型接口</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">KeyValuePair</span>&lt;K, V&gt; &#123;<br>  <span class="hljs-attr">key</span>: K;<br>  <span class="hljs-attr">value</span>: V;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">stringPair</span>: <span class="hljs-title class_">KeyValuePair</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = &#123;<br>  <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;name&quot;</span>,<br>  <span class="hljs-attr">value</span>: <span class="hljs-string">&quot;Alice&quot;</span><br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">numberPair</span>: <span class="hljs-title class_">KeyValuePair</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">boolean</span>&gt; = &#123;<br>  <span class="hljs-attr">key</span>: <span class="hljs-number">1</span>,<br>  <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p>函数签名泛型：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 带调用签名的泛型接口</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Transformer</span>&lt;T, U&gt; &#123;<br>  (<span class="hljs-attr">input</span>: T): U;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">toUpperCase</span>: <span class="hljs-title class_">Transformer</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = <br>  <span class="hljs-function"><span class="hljs-params">str</span> =&gt;</span> str.<span class="hljs-title function_">toUpperCase</span>();<br>  <br><span class="hljs-keyword">const</span> <span class="hljs-attr">toNumber</span>: <span class="hljs-title class_">Transformer</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; = <br>  <span class="hljs-function"><span class="hljs-params">str</span> =&gt;</span> <span class="hljs-built_in">parseFloat</span>(str);<br></code></pre></td></tr></table></figure>

<p><strong>泛型类（Generic Classes）</strong></p>
<p>基本结构：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Box</span>&lt;T&gt; &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">content</span>: T;<br>  <br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-attr">initialValue</span>: T</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span> = initialValue;<br>  &#125;<br>  <br>  <span class="hljs-title function_">getValue</span>(): T &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span>;<br>  &#125;<br>  <br>  <span class="hljs-title function_">setValue</span>(<span class="hljs-attr">newValue</span>: T): <span class="hljs-built_in">void</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span> = newValue;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> stringBox = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Box</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">&quot;Initial&quot;</span>);<br>stringBox.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">&quot;New value&quot;</span>);<br><br><span class="hljs-keyword">const</span> numberBox = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Box</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">100</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numberBox.<span class="hljs-title function_">getValue</span>() * <span class="hljs-number">2</span>); <span class="hljs-comment">// 200</span><br></code></pre></td></tr></table></figure>

<p>静态成员限制：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Factory</span>&lt;T&gt; &#123;<br>  <span class="hljs-comment">// 🚫 错误！静态成员不能引用类型参数</span><br>  <span class="hljs-keyword">static</span> <span class="hljs-attr">default</span>: T;<br>  <br>  <span class="hljs-comment">// ✅ 正确：静态成员使用独立泛型</span><br>  <span class="hljs-keyword">static</span> create&lt;U&gt;(<span class="hljs-attr">value</span>: U): <span class="hljs-title class_">Factory</span>&lt;U&gt; &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Factory</span>(value);<br>  &#125;<br>  <br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-attr">value</span>: T</span>) &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>泛型约束的高级应用</strong></p>
<p>类型参数约束：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 确保类型T有id属性</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Identifiable</span> &#123;<br>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Repository</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Identifiable</span>&gt; &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-attr">items</span>: T[] = [];<br>  <br>  <span class="hljs-title function_">add</span>(<span class="hljs-params"><span class="hljs-attr">item</span>: T</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">push</span>(item);<br>  &#125;<br>  <br>  <span class="hljs-title function_">findById</span>(<span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>): T | <span class="hljs-literal">undefined</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> === id);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Identifiable</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">public</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span></span>) &#123;&#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> userRepo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Repository</span>&lt;<span class="hljs-title class_">User</span>&gt;();<br>userRepo.<span class="hljs-title function_">add</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;Alice&quot;</span>));<br><span class="hljs-keyword">const</span> user = userRepo.<span class="hljs-title function_">findById</span>(<span class="hljs-string">&quot;1&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>构造函数约束：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 要求泛型T必须是类类型</span><br><span class="hljs-keyword">function</span> createInstance&lt;T&gt;(<span class="hljs-attr">ctor</span>: <span class="hljs-title function_">new</span> () =&gt; T): T &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">ctor</span>();<br>&#125;<br><br><span class="hljs-comment">// 高级：带参数构造函数</span><br><span class="hljs-keyword">function</span> createWithParams&lt;T&gt;(<br>  <span class="hljs-attr">ctor</span>: <span class="hljs-title function_">new</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; T,<br>  ...<span class="hljs-attr">args</span>: <span class="hljs-title class_">ConstructorParameters</span>&lt;<span class="hljs-keyword">typeof</span> ctor&gt;<br>): T &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">ctor</span>(...args);<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>, <span class="hljs-keyword">public</span> <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span></span>) &#123;&#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> p = <span class="hljs-title function_">createWithParams</span>(<span class="hljs-title class_">Point</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// Point &#123; x: 1, y: 2 &#125;</span><br></code></pre></td></tr></table></figure>

<p><strong>接口与类的组合模式</strong></p>
<p>模式1：工厂接口</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Factory</span>&lt;T&gt; &#123;<br>  <span class="hljs-title function_">create</span>(): T;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CarFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Factory</span>&lt;<span class="hljs-title class_">Car</span>&gt; &#123;<br>  <span class="hljs-title function_">create</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>();<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BikeFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Factory</span>&lt;<span class="hljs-title class_">Bike</span>&gt; &#123;<br>  <span class="hljs-title function_">create</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bike</span>();<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> assembleProduct&lt;T&gt;(<span class="hljs-attr">factory</span>: <span class="hljs-title class_">Factory</span>&lt;T&gt;): T &#123;<br>  <span class="hljs-keyword">return</span> factory.<span class="hljs-title function_">create</span>();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>模式2：策略模式</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaymentStrategy</span>&lt;T&gt; &#123;<br>  <span class="hljs-title function_">processPayment</span>(<span class="hljs-attr">amount</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">context</span>: T): <span class="hljs-built_in">boolean</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CreditCardStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentStrategy</span>&lt;<span class="hljs-title class_">CreditCardInfo</span>&gt; &#123;<br>  <span class="hljs-title function_">processPayment</span>(<span class="hljs-params"><span class="hljs-attr">amount</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">card</span>: <span class="hljs-title class_">CreditCardInfo</span></span>) &#123;<br>    <span class="hljs-comment">// 信用卡支付逻辑</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PayPalStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentStrategy</span>&lt;<span class="hljs-title class_">PayPalAccount</span>&gt; &#123;<br>  <span class="hljs-title function_">processPayment</span>(<span class="hljs-params"><span class="hljs-attr">amount</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">account</span>: <span class="hljs-title class_">PayPalAccount</span></span>) &#123;<br>    <span class="hljs-comment">// PayPal支付逻辑</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> processOrder&lt;T&gt;(<br>  <span class="hljs-attr">amount</span>: <span class="hljs-built_in">number</span>,<br>  <span class="hljs-attr">strategy</span>: <span class="hljs-title class_">PaymentStrategy</span>&lt;T&gt;,<br>  <span class="hljs-attr">context</span>: T<br>) &#123;<br>  <span class="hljs-keyword">return</span> strategy.<span class="hljs-title function_">processPayment</span>(amount, context);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>类型推导与默认值</strong></p>
<p>类型参数默认值：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 接口默认类型</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaginatedResponse</span>&lt;T = <span class="hljs-built_in">any</span>&gt; &#123;<br>  <span class="hljs-attr">data</span>: T[];<br>  <span class="hljs-attr">page</span>: <span class="hljs-built_in">number</span>;<br>  <span class="hljs-attr">totalPages</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-comment">// 类默认类型</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Cache</span>&lt;T = <span class="hljs-built_in">string</span>&gt; &#123;<br>  <span class="hljs-keyword">private</span> map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, T&gt;();<br>  <br>  <span class="hljs-title function_">set</span>(<span class="hljs-params"><span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">value</span>: T</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">set</span>(key, value);<br>  &#125;<br>  <br>  <span class="hljs-title function_">get</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>): T | <span class="hljs-literal">undefined</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">get</span>(key);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用默认类型</span><br><span class="hljs-keyword">const</span> stringCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cache</span>(); <span class="hljs-comment">// Cache&lt;string&gt;</span><br>stringCache.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;Alice&quot;</span>);<br><br><span class="hljs-keyword">const</span> anyCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cache</span>&lt;<span class="hljs-built_in">any</span>&gt;();<br>anyCache.<span class="hljs-title function_">set</span>(<span class="hljs-string">&quot;user&quot;</span>, &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Bob&quot;</span> &#125;);<br></code></pre></td></tr></table></figure>

<p>上下文类型推导：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 根据实现自动推导类型参数</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringContainer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Container</span>&lt;<span class="hljs-built_in">string</span>&gt; &#123;<br>  <span class="hljs-title function_">add</span>(<span class="hljs-params"><span class="hljs-attr">item</span>: <span class="hljs-built_in">string</span></span>) &#123; <span class="hljs-comment">/*...*/</span> &#125;<br>&#125;<br><br><span class="hljs-comment">// 显式指定类型参数</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NumberContainer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Container</span>&lt;<span class="hljs-built_in">number</span>&gt; &#123;<br>  <span class="hljs-title function_">add</span>(<span class="hljs-params"><span class="hljs-attr">item</span>: <span class="hljs-built_in">number</span></span>) &#123; <span class="hljs-comment">/*...*/</span> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>高级工程案例</strong></p>
<p>案例1：API 客户端封装</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiClient</span>&lt;T&gt; &#123;<br>  <span class="hljs-title function_">fetchData</span>(<span class="hljs-attr">endpoint</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;T&gt;;<br>  <span class="hljs-title function_">postData</span>(<span class="hljs-attr">endpoint</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: <span class="hljs-title class_">Partial</span>&lt;T&gt;): <span class="hljs-title class_">Promise</span>&lt;T&gt;;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">JsonApiClient</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApiClient</span>&lt;T&gt; &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-attr">baseUrl</span>: <span class="hljs-built_in">string</span></span>) &#123;&#125;<br>  <br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-attr">endpoint</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.baseUrl&#125;</span>/<span class="hljs-subst">$&#123;endpoint&#125;</span>`</span>);<br>    <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">json</span>();<br>  &#125;<br>  <br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">postData</span>(<span class="hljs-attr">endpoint</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: <span class="hljs-title class_">Partial</span>&lt;T&gt;): <span class="hljs-title class_">Promise</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.baseUrl&#125;</span>/<span class="hljs-subst">$&#123;endpoint&#125;</span>`</span>, &#123;<br>      <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)<br>    &#125;);<br>    <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">json</span>();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> &#123;<br>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;<br>&#125;<br><br><span class="hljs-keyword">const</span> userClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonApiClient</span>&lt;<span class="hljs-title class_">User</span>&gt;(<span class="hljs-string">&quot;https://api.example.com/users&quot;</span>);<br><span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> userClient.<span class="hljs-title function_">fetchData</span>(<span class="hljs-string">&quot;123&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>案例2：状态管理</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">State</span>&lt;T&gt; &#123;<br>  <span class="hljs-attr">current</span>: T;<br>  <span class="hljs-attr">history</span>: T[];<br>  <span class="hljs-title function_">update</span>(<span class="hljs-attr">newState</span>: T): <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HistoryState</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">State</span>&lt;T&gt; &#123;<br>  <span class="hljs-attr">history</span>: T[] = [];<br>  <br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> <span class="hljs-attr">current</span>: T</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">push</span>(current);<br>  &#125;<br>  <br>  <span class="hljs-title function_">update</span>(<span class="hljs-params"><span class="hljs-attr">newState</span>: T</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">current</span> = newState;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">push</span>(newState);<br>  &#125;<br>  <br>  <span class="hljs-title function_">getHistory</span>(): T[] &#123;<br>    <span class="hljs-keyword">return</span> [...<span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>];<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> counterState = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HistoryState</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">0</span>);<br>counterState.<span class="hljs-title function_">update</span>(<span class="hljs-number">1</span>);<br>counterState.<span class="hljs-title function_">update</span>(<span class="hljs-number">2</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(counterState.<span class="hljs-title function_">getHistory</span>()); <span class="hljs-comment">// [0, 1, 2]</span><br></code></pre></td></tr></table></figure>

<p><strong>最佳实践指南</strong></p>
<ol>
<li>避免过度泛型化：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 不推荐：不必要的泛型</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Printer</span>&lt;T&gt; &#123;<br>  <span class="hljs-title function_">print</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: T</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 推荐：直接使用具体类型</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsolePrinter</span> &#123;<br>  <span class="hljs-title function_">print</span>(<span class="hljs-params"><span class="hljs-attr">value</span>: <span class="hljs-built_in">any</span></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>提供有意义的类型参数名：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 推荐</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Repository</span>&lt;<span class="hljs-title class_">EntityType</span>&gt; &#123;<br>  <span class="hljs-title function_">save</span>(<span class="hljs-attr">entity</span>: <span class="hljs-title class_">EntityType</span>): <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-comment">// 不推荐</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Repository</span>&lt;T&gt; &#123;<br>  <span class="hljs-title function_">save</span>(<span class="hljs-attr">e</span>: T): <span class="hljs-built_in">void</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>默认类型用于通用场景：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 通用缓存默认存储对象</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Cache</span>&lt;T = <span class="hljs-built_in">object</span>&gt; &#123;<br>  <span class="hljs-keyword">private</span> storage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, T&gt;();<br>  <span class="hljs-comment">// ...</span><br>&#125;<br><br><span class="hljs-comment">// 使用默认类型</span><br><span class="hljs-keyword">const</span> objectCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cache</span>();<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>约束文档化：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 排序服务</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@template</span> <span class="hljs-variable">T</span> - 排序元素的类型</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@template</span> <span class="hljs-variable">K</span> - 排序依据的键名（必须是T的键）</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Sorter</span>&lt;T, K <span class="hljs-keyword">extends</span> keyof T&gt; &#123;<br>  <span class="hljs-title function_">sort</span>(<span class="hljs-params"><span class="hljs-attr">items</span>: T[], <span class="hljs-attr">key</span>: K</span>) &#123;<br>    <span class="hljs-keyword">return</span> items.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> <br>      a[key] &gt; b[key] ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span><br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="5">
<li>类与接口协同：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 定义泛型接口</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Processor</span>&lt;T&gt; &#123;<br>  <span class="hljs-title function_">process</span>(<span class="hljs-attr">input</span>: T): <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-comment">// 实现具体处理器</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NumberProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Processor</span>&lt;<span class="hljs-built_in">number</span>&gt; &#123;<br>  <span class="hljs-title function_">process</span>(<span class="hljs-params"><span class="hljs-attr">input</span>: <span class="hljs-built_in">number</span></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(input * <span class="hljs-number">2</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 创建处理器工厂</span><br><span class="hljs-keyword">const</span> processors = &#123;<br>  <span class="hljs-attr">number</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">NumberProcessor</span>()<br>&#125;;<br><br><span class="hljs-keyword">function</span> processData&lt;T&gt;(<span class="hljs-attr">type</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: T) &#123;<br>  <span class="hljs-keyword">if</span> (processors[<span class="hljs-keyword">type</span>]) &#123;<br>    (processors[<span class="hljs-keyword">type</span>] <span class="hljs-keyword">as</span> <span class="hljs-title class_">Processor</span>&lt;T&gt;).<span class="hljs-title function_">process</span>(data);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>常见问题解决方案</strong></p>
<p>问题：泛型类实例方法类型丢失</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Wrapper</span>&lt;T&gt; &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-attr">value</span>: T</span>) &#123;&#125;<br>  <br>  <span class="hljs-title function_">getValue</span>(): T &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 类型信息丢失</span><br><span class="hljs-keyword">const</span> wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Wrapper</span>(<span class="hljs-number">42</span>);<br><span class="hljs-keyword">const</span> value = wrapper.<span class="hljs-title function_">getValue</span>(); <span class="hljs-comment">// value 类型为 number ✅</span><br></code></pre></td></tr></table></figure>

<p>解决方案：使用成员变量保存类型</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeSafeWrapper</span>&lt;T&gt; &#123;<br>  <span class="hljs-comment">// 显式保存类型引用</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> valueType!: T;<br>  <br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-attr">value</span>: T</span>) &#123;&#125;<br>  <br>  <span class="hljs-title function_">getValue</span>(): T &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> safeWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeSafeWrapper</span>(<span class="hljs-string">&quot;text&quot;</span>);<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ValueType</span> = <span class="hljs-keyword">typeof</span> safeWrapper.<span class="hljs-property">valueType</span>; <span class="hljs-comment">// string</span><br></code></pre></td></tr></table></figure>

<p>问题：泛型接口实现冲突</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Adder</span>&lt;T&gt; &#123;<br>  <span class="hljs-title function_">add</span>(<span class="hljs-attr">a</span>: T, <span class="hljs-attr">b</span>: T): T;<br>&#125;<br><br><span class="hljs-comment">// 错误：必须为所有类型参数提供实现</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NumberAdder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Adder</span> &#123;<br>  <span class="hljs-title function_">add</span>(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span></span>) &#123; <span class="hljs-keyword">return</span> a + b; &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 正确：指定具体类型</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NumberAdder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Adder</span>&lt;<span class="hljs-built_in">number</span>&gt; &#123;<br>  <span class="hljs-title function_">add</span>(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span></span>) &#123; <span class="hljs-keyword">return</span> a + b; &#125;<br>&#125;<br><br><span class="hljs-comment">// 或使用泛型类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericAdder</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Adder</span>&lt;T&gt; &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-attr">zeroValue</span>: T</span>) &#123;&#125;<br>  <br>  <span class="hljs-title function_">add</span>(<span class="hljs-attr">a</span>: T, <span class="hljs-attr">b</span>: T): T &#123;<br>    <span class="hljs-comment">// 实际实现需依赖具体类型</span><br>    <span class="hljs-keyword">return</span> a; <span class="hljs-comment">// 简化示例</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="1-4-模块系统"><a href="#1-4-模块系统" class="headerlink" title="1.4 模块系统"></a>1.4 模块系统</h2><h3 id="1-4-1-ES-Module-与-CommonJS-互操作"><a href="#1-4-1-ES-Module-与-CommonJS-互操作" class="headerlink" title="1.4.1 ES Module 与 CommonJS 互操作"></a>1.4.1 ES Module 与 CommonJS 互操作</h3><p><strong>基本互操作模式</strong></p>
<table>
<thead>
<tr>
<th align="left">导入方向</th>
<th align="left">语法示例</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ES → CommonJS</td>
<td align="left"><code>import fs from &#39;fs&#39;;</code><br><code>import &#123; readFile &#125; from &#39;fs&#39;;</code></td>
<td align="left">默认导入或具名导入</td>
</tr>
<tr>
<td align="left">CommonJS → ES</td>
<td align="left"><code>const esModule = require(&#39;./es-module&#39;);</code></td>
<td align="left">通过require加载</td>
</tr>
<tr>
<td align="left">CommonJS → ES (解构)</td>
<td align="left"><code>const &#123; namedExport &#125; = require(&#39;./es-module&#39;);</code></td>
<td align="left">解构ES模块的具名导出</td>
</tr>
</tbody></table>
<p><strong>ESM 导入 CommonJS 模块</strong></p>
<ol>
<li>默认导入：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 导入整个CommonJS模块</span><br><span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;express&#x27;</span>;<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>具名导入：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 导入特定属性（需模块支持）</span><br><span class="hljs-keyword">import</span> &#123; readFile &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;fs&#x27;</span>;<br><span class="hljs-title function_">readFile</span>(<span class="hljs-string">&#x27;file.txt&#x27;</span>, <span class="hljs-string">&#x27;utf8&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;&#125;);<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>动态导入：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 异步加载CommonJS模块</span><br><span class="hljs-keyword">const</span> util = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;util&#x27;</span>);<br>util.<span class="hljs-title function_">promisify</span>(<span class="hljs-built_in">setTimeout</span>)(<span class="hljs-number">1000</span>);<br></code></pre></td></tr></table></figure>

<p>类型声明要求：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 类型声明文件需支持两种导出格式</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;cjs-module&#x27;</span> &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">_default</span>: <span class="hljs-built_in">any</span>;<br>  <span class="hljs-keyword">export</span> = _default;  <span class="hljs-comment">// CommonJS导出</span><br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> _default; <span class="hljs-comment">// ES默认导出</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>CommonJS 导入 ESM 模块</strong></p>
<ol>
<li>默认导入：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// CommonJS 环境</span><br><span class="hljs-keyword">const</span> esModule = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./es-module&#x27;</span>).<span class="hljs-property">default</span>; <span class="hljs-comment">// 必须访问.default</span><br>esModule.<span class="hljs-title function_">someMethod</span>();<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>具名导入：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 解构具名导出</span><br><span class="hljs-keyword">const</span> &#123; namedExport &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./es-module&#x27;</span>);<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>异步加载：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 在支持top-level await的环境</span><br><span class="hljs-keyword">const</span> &#123; <span class="hljs-attr">default</span>: esModule &#125; = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./es-module&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p><strong>互操作中的类型处理</strong></p>
<ol>
<li>CommonJS 模块类型声明：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 标准声明</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;cjs-module&#x27;</span> &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">someFunction</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">void</span>;<br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">someValue</span>: <span class="hljs-built_in">number</span>;<br>  <br>  <span class="hljs-keyword">export</span> = &#123; <br>    someFunction,<br>    someValue<br>  &#125;;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">import</span> cjs <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;cjs-module&#x27;</span>;<br>cjs.<span class="hljs-title function_">someFunction</span>();<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>ES 模块类型声明：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// ES模块声明</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;es-module&#x27;</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">namedExport</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">void</span>;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">defaultExport</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-comment">// CommonJS使用</span><br><span class="hljs-keyword">const</span> esm = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;es-module&#x27;</span>);<br>esm.<span class="hljs-title function_">default</span>(); <span class="hljs-comment">// 访问默认导出</span><br>esm.<span class="hljs-title function_">namedExport</span>(); <span class="hljs-comment">// 访问具名导出</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>兼容类型声明：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 同时支持两种导入方式</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;dual-module&#x27;</span> &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">defaultExport</span>: <span class="hljs-built_in">any</span>;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> defaultExport; <span class="hljs-comment">// ES默认导出</span><br>  <span class="hljs-keyword">export</span> = defaultExport;       <span class="hljs-comment">// CommonJS导出</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>互操作陷阱与解决方案</strong></p>
<p>陷阱1：默认导出混淆</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// CommonJS模块</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;&#125;; <span class="hljs-comment">// 导出函数</span><br><br><span class="hljs-comment">// ES模块导入</span><br><span class="hljs-keyword">import</span> cjsFunc <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;cjs-module&#x27;</span>; <span class="hljs-comment">// ✅ 正确</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> cjsFunc &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;cjs-module&#x27;</span>; <span class="hljs-comment">// ✅ 正确</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> cjsModule <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;cjs-module&#x27;</span>; <br>cjsModule.<span class="hljs-title function_">default</span>(); <span class="hljs-comment">// ✅ 正确</span><br></code></pre></td></tr></table></figure>

<p>陷阱2：__esModule 标志</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// Babel/TS编译的ESM模块会添加</span><br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-built_in">exports</span>, <span class="hljs-string">&quot;__esModule&quot;</span>, &#123; <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> &#125;);<br><br><span class="hljs-comment">// 互操作意义：标记模块为ESM转换而来</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">module</span>.<span class="hljs-property">__esModule</span>) &#123;<br>  <span class="hljs-comment">// 按ESM规范处理</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>陷阱3：动态导入差异</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// ES模块</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> value = <span class="hljs-number">42</span>;<br><br><span class="hljs-comment">// CommonJS导入</span><br><span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./es-module&#x27;</span>).<span class="hljs-property">value</span>; <span class="hljs-comment">// ❌ 可能未定义</span><br><span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./es-module&#x27;</span>).<span class="hljs-property">default</span>.<span class="hljs-property">value</span>; <span class="hljs-comment">// ✅ 正确</span><br></code></pre></td></tr></table></figure>

<p><strong>工程最佳实践</strong></p>
<ol>
<li>统一模块格式：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// tsconfig.json</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;module&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ESNext&quot;</span><span class="hljs-punctuation">,</span>       <span class="hljs-comment">// 输出ESM</span><br>    <span class="hljs-attr">&quot;moduleResolution&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Node&quot;</span> <span class="hljs-comment">// 支持Node解析规则</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>条件导出（package.json）：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;exports&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;import&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./dist/esm/index.js&quot;</span><span class="hljs-punctuation">,</span>   <span class="hljs-comment">// ESM入口</span><br>    <span class="hljs-attr">&quot;require&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./dist/cjs/index.js&quot;</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// CommonJS入口</span><br>    <span class="hljs-attr">&quot;default&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./dist/cjs/index.js&quot;</span>   <span class="hljs-comment">// 回退</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>双格式发布：</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">my-package/<br>├── dist/<br>│   ├── esm/        // ES模块版本<br>│   │   └── index.js<br>│   └── cjs/        // CommonJS版本<br>│       └── index.js<br>├── package.json<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>互操作封装层：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// cjs-compat.ts - CommonJS封装层</span><br><span class="hljs-keyword">import</span> esModule <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./es-module&#x27;</span>;<br><span class="hljs-keyword">export</span> = esModule; <span class="hljs-comment">// 转换为CommonJS导出</span><br></code></pre></td></tr></table></figure>

<p><strong>TypeScript 编译选项</strong></p>
<table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">值</th>
<th align="left">互操作影响</th>
</tr>
</thead>
<tbody><tr>
<td align="left">esModuleInterop</td>
<td align="left">true (推荐)</td>
<td align="left">生成兼容代码，允许默认导入CommonJS模块</td>
</tr>
<tr>
<td align="left">allowSyntheticDefaultImports</td>
<td align="left">true</td>
<td align="left">允许类型系统中的默认导入</td>
</tr>
<tr>
<td align="left">module</td>
<td align="left">CommonJS&#x2F;Node16</td>
<td align="left">控制输出模块格式</td>
</tr>
<tr>
<td align="left">moduleResolution</td>
<td align="left">Node16 (推荐)</td>
<td align="left">支持package.json的exports和imports字段</td>
</tr>
</tbody></table>
<p>esModuleInterop 工作原理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 开启前</span><br><span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);<br><span class="hljs-built_in">exports</span>.<span class="hljs-property">default</span> = fs;<br><br><span class="hljs-comment">// 开启后</span><br><span class="hljs-keyword">var</span> __importDefault = (<span class="hljs-variable language_">this</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">__importDefault</span>) || <span class="hljs-keyword">function</span> (<span class="hljs-params">mod</span>) &#123;<br>    <span class="hljs-keyword">return</span> (mod &amp;&amp; mod.<span class="hljs-property">__esModule</span>) ? mod : &#123; <span class="hljs-string">&quot;default&quot;</span>: mod &#125;;<br>&#125;;<br><span class="hljs-keyword">var</span> fs_1 = <span class="hljs-title function_">__importDefault</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>));<br><span class="hljs-built_in">exports</span>.<span class="hljs-property">default</span> = fs_1.<span class="hljs-property">default</span>;<br></code></pre></td></tr></table></figure>

<p><strong>Node.js 环境互操作</strong></p>
<ol>
<li>.mjs 与 .cjs 扩展名：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// ES模块 (module.mjs)</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">hello</span>(<span class="hljs-params"></span>) &#123;&#125;<br><br><span class="hljs-comment">// CommonJS导入 (script.cjs)</span><br><span class="hljs-keyword">const</span> &#123; hello &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./module.mjs&#x27;</span>); <span class="hljs-comment">// ❌ Node不允许</span><br><span class="hljs-keyword">const</span> esm = <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./module.mjs&#x27;</span>); <span class="hljs-comment">// ✅ 必须使用动态导入</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>package.json type 字段：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;module&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 所有.js文件视为ES模块</span><br>  <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;commonjs&quot;</span> <span class="hljs-comment">// 默认值</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>文件扩展名规则：</li>
</ol>
<table>
<thead>
<tr>
<th align="left">文件扩展名</th>
<th align="left">模块类型</th>
<th align="left">导入方式</th>
</tr>
</thead>
<tbody><tr>
<td align="left">.js</td>
<td align="left">由type字段决定</td>
<td align="left">根据type字段处理</td>
</tr>
<tr>
<td align="left">.mjs</td>
<td align="left">ES模块</td>
<td align="left">只能import导入</td>
</tr>
<tr>
<td align="left">.cjs</td>
<td align="left">CommonJS</td>
<td align="left">只能require导入</td>
</tr>
</tbody></table>
<p><strong>浏览器环境互操作</strong></p>
<ol>
<li>脚本类型声明：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html">&lt;!-- 加载ES模块 --&gt;<br>&lt;script type=&quot;module&quot; src=&quot;app.js&quot;&gt;&lt;/script&gt;<br><br>&lt;!-- 加载CommonJS模块（需打包转换） --&gt;<br>&lt;script src=&quot;cjs-bundle.js&quot;&gt;&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>动态导入兼容：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 浏览器中的动态导入</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">module</span> === <span class="hljs-string">&#x27;object&#x27;</span>) &#123;<br>  <span class="hljs-comment">// Node环境</span><br>  <span class="hljs-keyword">const</span> mod = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./cjs-module&#x27;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-comment">// 浏览器环境</span><br>  <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./es-module.js&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">mod</span> =&gt;</span> &#123;&#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>互操作类型安全策略</strong></p>
<ol>
<li>模块扩充声明：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 扩充CommonJS模块类型</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;fs&#x27;</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">customMethod</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;fs&#x27;</span>;<br>fs.<span class="hljs-title function_">customMethod</span>(); <span class="hljs-comment">// ✅ 类型安全</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>条件类型处理：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 区分模块类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ModuleType</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> &#123; <span class="hljs-attr">__esModule</span>: <span class="hljs-literal">true</span> &#125; ? <br>  &#123; <span class="hljs-attr">default</span>: infer U &#125; : T;<br><br><span class="hljs-keyword">function</span> importCompat&lt;T&gt;(<span class="hljs-attr">module</span>: T): <span class="hljs-title class_">ModuleType</span>&lt;T&gt; &#123;<br>  <span class="hljs-comment">// 实现互操作转换</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>运行时类型守卫：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 检测ES模块</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">isESModule</span>(<span class="hljs-params"><span class="hljs-attr">module</span>: <span class="hljs-built_in">any</span></span>): <span class="hljs-variable language_">module</span> is &#123; <span class="hljs-attr">default</span>: <span class="hljs-built_in">any</span> &#125; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">module</span>.<span class="hljs-property">__esModule</span> || <br>    (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Symbol</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span> &amp;&amp; <br>     <span class="hljs-title class_">Symbol</span>.<span class="hljs-property">toStringTag</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">module</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-4-2-命名空间与现代模块对比"><a href="#1-4-2-命名空间与现代模块对比" class="headerlink" title="1.4.2 命名空间与现代模块对比"></a>1.4.2 命名空间与现代模块对比</h3><p><strong>命名空间（Namespaces）</strong></p>
<p>核心概念：TypeScript 早期提供的逻辑分组机制，用于组织全局作用域代码</p>
<p>基本语法：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 定义命名空间</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">MyUtils</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params"><span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(message);<br>  &#125;<br>  <br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Math</span> &#123;<br>    <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PI</span> = <span class="hljs-number">3.14</span>;<br>    <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">circleArea</span>(<span class="hljs-params"><span class="hljs-attr">r</span>: <span class="hljs-built_in">number</span></span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">PI</span> * r * r;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-title class_">MyUtils</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Hello&quot;</span>);<br><span class="hljs-keyword">const</span> area = <span class="hljs-title class_">MyUtils</span>.<span class="hljs-property">Math</span>.<span class="hljs-title function_">circleArea</span>(<span class="hljs-number">5</span>);<br></code></pre></td></tr></table></figure>

<p>编译结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 转换为闭包形式</span><br><span class="hljs-keyword">var</span> <span class="hljs-title class_">MyUtils</span>;<br>(<span class="hljs-keyword">function</span> (<span class="hljs-params">MyUtils</span>) &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">message</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(message);<br>  &#125;<br>  <span class="hljs-title class_">MyUtils</span>.<span class="hljs-property">log</span> = log;<br>  <br>  <span class="hljs-keyword">let</span> <span class="hljs-title class_">Math</span>;<br>  (<span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-built_in">Math</span></span>) &#123;<br>    <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> = <span class="hljs-number">3.14</span>;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">circleArea</span>(<span class="hljs-params">r</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * r * r;<br>    &#125;<br>    <span class="hljs-title class_">Math</span>.<span class="hljs-property">circleArea</span> = circleArea;<br>  &#125;)(<span class="hljs-title class_">Math</span> = <span class="hljs-title class_">MyUtils</span>.<span class="hljs-property">Math</span> || (<span class="hljs-title class_">MyUtils</span>.<span class="hljs-property">Math</span> = &#123;&#125;));<br>&#125;)(<span class="hljs-title class_">MyUtils</span> || (<span class="hljs-title class_">MyUtils</span> = &#123;&#125;));<br></code></pre></td></tr></table></figure>

<p><strong>现代模块（ES Modules）</strong></p>
<p>核心概念：ES6 标准引入的文件级作用域隔离机制</p>
<p>基本语法：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// math.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PI</span> = <span class="hljs-number">3.14</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">circleArea</span>(<span class="hljs-params"><span class="hljs-attr">r</span>: <span class="hljs-built_in">number</span></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">PI</span> * r * r;<br>&#125;<br><br><span class="hljs-comment">// logger.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params"><span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(message);<br>&#125;<br><br><span class="hljs-comment">// app.ts</span><br><span class="hljs-keyword">import</span> &#123; log &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./logger&#x27;</span>;<br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">MathUtils</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./math&#x27;</span>;<br><br><span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Calculating area&quot;</span>);<br><span class="hljs-keyword">const</span> area = <span class="hljs-title class_">MathUtils</span>.<span class="hljs-title function_">circleArea</span>(<span class="hljs-number">5</span>);<br></code></pre></td></tr></table></figure>

<p><strong>核心差异对比</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">命名空间</th>
<th align="left">现代模块</th>
</tr>
</thead>
<tbody><tr>
<td align="left">作用域</td>
<td align="left">全局&#x2F;文件内</td>
<td align="left">文件级作用域</td>
</tr>
<tr>
<td align="left">依赖管理</td>
<td align="left">手动排序<code>&lt;script&gt;</code>标签</td>
<td align="left">自动依赖解析（import&#x2F;export）</td>
</tr>
<tr>
<td align="left">代码组织</td>
<td align="left">逻辑分组</td>
<td align="left">物理文件分组</td>
</tr>
<tr>
<td align="left">代码分割</td>
<td align="left">不支持</td>
<td align="left">原生支持（动态导入）</td>
</tr>
<tr>
<td align="left">摇树优化</td>
<td align="left">不支持</td>
<td align="left">原生支持（Tree Shaking）</td>
</tr>
<tr>
<td align="left">运行时性能</td>
<td align="left">所有代码立即加载</td>
<td align="left">按需加载</td>
</tr>
<tr>
<td align="left">类型声明</td>
<td align="left">通过&#x2F;&#x2F;&#x2F; <code>&lt;reference&gt;</code>指令</td>
<td align="left">自动解析.d.ts文件</td>
</tr>
<tr>
<td align="left">全局污染</td>
<td align="left">可能污染全局命名空间</td>
<td align="left">无全局污染</td>
</tr>
</tbody></table>
<p><strong>使用场景指南</strong></p>
<p>命名空间适用场景：</p>
<ol>
<li>浏览器环境下的旧项目维护</li>
<li>需要全局可访问的库类型声明（如window.myLib）</li>
<li>将大型库拆分为多个文件但仍需共享作用域</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 多文件命名空间</span><br><span class="hljs-comment">// Validation.ts</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Validation</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Validator</span> &#123;<br>    <span class="hljs-title function_">isValid</span>(<span class="hljs-attr">s</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">boolean</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// LettersOnlyValidator.ts</span><br><span class="hljs-comment">/// &lt;reference path=&quot;Validation.ts&quot; /&gt;</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Validation</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LettersOnlyValidator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Validator</span> &#123;<br>    <span class="hljs-title function_">isValid</span>(<span class="hljs-params"><span class="hljs-attr">s</span>: <span class="hljs-built_in">string</span></span>) &#123; <span class="hljs-comment">/*...*/</span> &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>现代模块适用场景：</p>
<ol>
<li>新项目开发</li>
<li>需要代码分割的应用</li>
<li>组件化架构（React&#x2F;Vue）</li>
<li>Node.js 服务端应用</li>
<li>需要 Tree Shaking 优化的库</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 现代模块化组件</span><br><span class="hljs-comment">// Button.tsx</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params">&#123; text &#125;: &#123; text: <span class="hljs-built_in">string</span> &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>&#123;text&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-comment">// App.tsx</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Button</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Button&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">text</span>=<span class="hljs-string">&quot;Click&quot;</span> /&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>混合使用模式</strong></p>
<p>场景：模块扩展命名空间</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// shapes.ts - 命名空间定义</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Shapes</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> &#123; <span class="hljs-comment">/*...*/</span> &#125;<br>&#125;<br><br><span class="hljs-comment">// extensions.ts - 模块扩展命名空间</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;./shapes&#x27;</span>; <span class="hljs-comment">// 确保命名空间存在</span><br><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">global</span> &#123;<br>  <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Shapes</span> &#123;<br>    <span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Triangle</span> &#123; <span class="hljs-comment">/*...*/</span> &#125; <span class="hljs-comment">// 扩展命名空间</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> triangle = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shapes</span>.<span class="hljs-title class_">Triangle</span>();<br></code></pre></td></tr></table></figure>

<p>场景：命名空间封装模块类型</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 为第三方模块声明全局类型</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">global</span> &#123;<br>  <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">JSX</span> &#123;<br>    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IntrinsicElements</span> &#123;<br>      <span class="hljs-attr">customElement</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">DetailedHTMLProps</span>&lt;<br>        <span class="hljs-title class_">React</span>.<span class="hljs-property">HTMLAttributes</span>&lt;<span class="hljs-title class_">HTMLElement</span>&gt;,<br>        <span class="hljs-title class_">HTMLElement</span><br>      &gt;;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>工程迁移策略</strong></p>
<p>步骤1：命名空间转模块</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 原命名空间代码</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Utilities</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">/*...*/</span> &#125;<br>&#125;<br><br><span class="hljs-comment">// 转换为模块</span><br><span class="hljs-comment">// utilities.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">/*...*/</span> &#125;<br></code></pre></td></tr></table></figure>

<p>步骤2：处理全局依赖</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 原全局依赖</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">App</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = &#123; <span class="hljs-attr">debug</span>: <span class="hljs-literal">true</span> &#125;;<br>&#125;<br><br><span class="hljs-comment">// 转换为单例模块</span><br><span class="hljs-comment">// config.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = &#123; <span class="hljs-attr">debug</span>: <span class="hljs-literal">true</span> &#125;;<br><br><span class="hljs-comment">// 使用处改为导入</span><br><span class="hljs-keyword">import</span> &#123; config &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./config&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>步骤3：处理多文件命名空间</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 原多文件命名空间</span><br><span class="hljs-comment">/// &lt;reference path=&quot;validation.ts&quot; /&gt;</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Validation</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmailValidator</span> &#123; <span class="hljs-comment">/*...*/</span> &#125;<br>&#125;<br><br><span class="hljs-comment">// 转换为模块</span><br><span class="hljs-comment">// EmailValidator.ts</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Validator</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./validation&#x27;</span>; <span class="hljs-comment">// 转换为模块</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmailValidator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Validator</span> &#123; <span class="hljs-comment">/*...*/</span> &#125;<br></code></pre></td></tr></table></figure>

<p><strong>最佳实践指南</strong></p>
<ol>
<li>新项目强制使用模块：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// tsconfig.json</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;module&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ESNext&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;moduleResolution&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;NodeNext&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>旧项目渐进迁移：<ul>
<li>新文件使用模块语法</li>
<li>旧文件保持命名空间</li>
<li>使用export as namespace提供全局访问</li>
</ul>
</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// legacy.d.ts</span><br><span class="hljs-keyword">export</span> = <span class="hljs-title class_">MyLib</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">myLib</span>;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>避免全局扩展污染：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 不推荐：污染全局命名空间</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">global</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Window</span> &#123;<br>    <span class="hljs-attr">myGlobalVar</span>: <span class="hljs-built_in">any</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 推荐：模块封装</span><br><span class="hljs-comment">// my-module.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">window</span>.<span class="hljs-property">myGlobalVar</span> = &#123; <span class="hljs-comment">/*...*/</span> &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>类型声明策略：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 现代模块类型声明</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;modern-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">calculate</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-comment">// 命名空间类型声明</span><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">LegacyLib</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">version</span>: <span class="hljs-built_in">string</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>常见问题解决方案</strong></p>
<p>问题：全局类型冲突</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// file1.ts</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">MyApp</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> version = <span class="hljs-string">&quot;1.0&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">// file2.ts</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">MyApp</span> &#123; <span class="hljs-comment">// ❌ 可能与其他文件合并</span><br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params"></span>) &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 转换为模块化</span><br><span class="hljs-comment">// version.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> version = <span class="hljs-string">&quot;1.0&quot;</span>;<br><br><span class="hljs-comment">// logger.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params"></span>) &#123;&#125;<br></code></pre></td></tr></table></figure>

<p>问题：第三方库全局扩展</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 扩展jQuery</span><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">JQuery</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Static</span> &#123;<br>    <span class="hljs-title function_">newPlugin</span>(): <span class="hljs-built_in">void</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 现代方案：模块增强</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;jquery&#x27;</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">JQueryStatic</span> &#123;<br>    <span class="hljs-title function_">newPlugin</span>(): <span class="hljs-built_in">void</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>问题：循环依赖</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 命名空间中的循环引用</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">A</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> b = B.<span class="hljs-property">value</span>; <span class="hljs-comment">// ❌ B尚未定义</span><br>&#125;<br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title class_">B</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> value = <span class="hljs-number">10</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>模块化解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// a.ts</span><br><span class="hljs-keyword">import</span> &#123; value &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./b&#x27;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> b = value;<br><br><span class="hljs-comment">// b.ts</span><br><span class="hljs-keyword">import</span> &#123; b &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./a&#x27;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> value = b + <span class="hljs-number">10</span>; <span class="hljs-comment">// ❌ 循环依赖</span><br><br><span class="hljs-comment">// 重构：提取公共逻辑</span><br><span class="hljs-comment">// constants.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BASE_VALUE</span> = <span class="hljs-number">5</span>;<br><br><span class="hljs-comment">// a.ts</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-variable constant_">BASE_VALUE</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./constants&#x27;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> a = <span class="hljs-variable constant_">BASE_VALUE</span> * <span class="hljs-number">2</span>;<br><br><span class="hljs-comment">// b.ts</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-variable constant_">BASE_VALUE</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./constants&#x27;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> b = <span class="hljs-variable constant_">BASE_VALUE</span> * <span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure>

<h3 id="1-4-3-模块解析策略与路径映射"><a href="#1-4-3-模块解析策略与路径映射" class="headerlink" title="1.4.3 模块解析策略与路径映射"></a>1.4.3 模块解析策略与路径映射</h3><p><strong>模块解析策略</strong></p>
<p>TypeScript 支持两种模块解析策略：</p>
<table>
<thead>
<tr>
<th align="left">策略</th>
<th align="left">触发条件</th>
<th align="left">解析逻辑</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Classic</td>
<td align="left">“moduleResolution”: “Classic”</td>
<td align="left">1. 相对路径：.&#x2F;module → .&#x2F;module.ts<br>2. 非相对路径：module → .&#x2F;module.ts → ..&#x2F;module.ts</td>
<td align="left">TS 1.6 前旧项目</td>
</tr>
<tr>
<td align="left">Node</td>
<td align="left">“moduleResolution”: “Node”<br>(默认值)</td>
<td align="left">遵循 Node.js 解析规则：<br>1. 检查文件<br>2. 检查目录<br>3. 检查 package.json<br>4. 检查 @types	现代</td>
<td align="left">Node.js&#x2F;Web 项目</td>
</tr>
</tbody></table>
<p>Node 策略解析流程：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; helper &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;my-utils&#x27;</span>;<br><span class="hljs-comment">// 解析步骤：</span><br><span class="hljs-comment">// 1. 检查文件: node_modules/my-utils.ts</span><br><span class="hljs-comment">// 2. 检查文件: node_modules/my-utils.tsx</span><br><span class="hljs-comment">// 3. 检查文件: node_modules/my-utils.d.ts</span><br><span class="hljs-comment">// 4. 检查目录: node_modules/my-utils/package.json (main/types 字段)</span><br><span class="hljs-comment">// 5. 检查目录: node_modules/my-utils/index.ts</span><br><span class="hljs-comment">// 6. 检查上级 node_modules: ../node_modules/my-utils</span><br></code></pre></td></tr></table></figure>

<p><strong>路径映射（Path Mapping）</strong></p>
<p>核心目的：简化模块导入路径，避免相对路径嵌套</p>
<p>配置方式 (tsconfig.json)：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;baseUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./src&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;paths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;@components/*&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;components/*&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;@utils&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;utils/index&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;shared/*&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;../shared/*&quot;</span><span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>映射规则解析：</p>
<table>
<thead>
<tr>
<th align="left">映射配置</th>
<th align="left">导入语句</th>
<th align="left">解析路径</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>&quot;@components/*&quot;</code><br><code>[&quot;components/*&quot;]</code></td>
<td align="left"><code>import Button from &#39;@components/Button&#39;</code></td>
<td align="left"><code>./src/components/Button.ts</code></td>
</tr>
<tr>
<td align="left"><code>&quot;@utils&quot;</code><br><code>[&quot;utils/index&quot;]</code></td>
<td align="left"><code>import &#123; log &#125; from &#39;@utils&#39;</code></td>
<td align="left"><code>./src/utils/index.ts</code></td>
</tr>
<tr>
<td align="left"><code>&quot;shared/*&quot;</code><br><code>[&quot;../shared/*&quot;]</code></td>
<td align="left"><code>import config from &#39;shared/config&#39;</code></td>
<td align="left"><code>../shared/config.ts</code></td>
</tr>
</tbody></table>
<p><strong>路径映射类型声明</strong></p>
<p>场景：为路径映射提供类型支持</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// src/global.d.ts</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;@components/*&#x27;</span> &#123;<br>  <span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ComponentType</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">component</span>: <span class="hljs-title class_">ComponentType</span>;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> component;<br>&#125;<br><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;@utils&#x27;</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params"><span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span>;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">version</span>: <span class="hljs-built_in">string</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>工程最佳实践</strong></p>
<ol>
<li>基础路径配置：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;baseUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;src&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 所有非绝对路径相对src解析</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-comment">// 使用</span><br>import utils from &#x27;utils&#x27;; <span class="hljs-comment">// 解析为 src/utils.ts</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>多路径映射模式：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;paths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-comment">// 多路径回退</span><br>    <span class="hljs-attr">&quot;@services/*&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-string">&quot;services/v2/*&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 优先尝试v2</span><br>      <span class="hljs-string">&quot;services/v1/*&quot;</span>  <span class="hljs-comment">// 回退到v1</span><br>    <span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>通配符扩展：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;paths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;@assets/*&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;assets/*&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;assets/images/*&quot;</span><span class="hljs-punctuation">]</span> <span class="hljs-comment">// 多目录映射</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ol start="4">
<li>绝对路径映射：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;baseUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;.&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;paths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;src/*&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;src/*&quot;</span><span class="hljs-punctuation">]</span> <span class="hljs-comment">// 允许 import from &#x27;src/components&#x27;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p><strong>路径映射与打包器集成</strong></p>
<p>Webpack 配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// webpack.config.js</span><br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">resolve</span>: &#123;<br>    <span class="hljs-attr">alias</span>: &#123;<br>      <span class="hljs-string">&#x27;@components&#x27;</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;src/components&#x27;</span>),<br>      <span class="hljs-string">&#x27;@utils&#x27;</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;src/utils&#x27;</span>)<br>    &#125;<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>Vite 配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// vite.config.ts</span><br><span class="hljs-keyword">import</span> &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span>;<br><span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;path&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">resolve</span>: &#123;<br>    <span class="hljs-attr">alias</span>: &#123;<br>      <span class="hljs-string">&#x27;@&#x27;</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;./src&#x27;</span>),<br>    &#125;<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>常见问题解决方案</strong></p>
<p>问题1：路径映射在运行时失效</p>
<p>原因：TypeScript 只处理编译时路径，运行时需打包器支持</p>
<p>解决方案：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 安装路径转换工具</span><br>npm install tsconfig-paths --save-dev<br><br><span class="hljs-comment"># 运行时加载</span><br>node -r tsconfig-paths/register app.ts<br></code></pre></td></tr></table></figure>

<p>问题2：循环依赖警告</p>
<p>场景：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">src/<br>  components/<br>    Button.ts  // import &#123; theme &#125; from &#x27;@utils&#x27;<br>  utils/<br>    index.ts   // import &#123; Button &#125; from &#x27;@components&#x27;<br></code></pre></td></tr></table></figure>

<p>解决方案：</p>
<ol>
<li>重构提取公共模块</li>
<li>使用依赖注入</li>
<li>动态导入打破循环</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// utils/index.ts</span><br><span class="hljs-keyword">let</span> <span class="hljs-title class_">Button</span>: <span class="hljs-built_in">any</span>;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Button</span>) &#123;<br>    <span class="hljs-title class_">Button</span> = (<span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@components/Button&#x27;</span>)).<span class="hljs-property">default</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Button</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>问题3：声明文件缺失</p>
<p>解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 为路径映射创建声明文件</span><br><span class="hljs-comment">// src/path-mappings.d.ts</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;@components/*&#x27;</span> &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">component</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">ComponentType</span>;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> component;<br>&#125;<br><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;@utils&#x27;</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">formatDate</span>(<span class="hljs-params"><span class="hljs-attr">date</span>: <span class="hljs-title class_">Date</span></span>): <span class="hljs-built_in">string</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>高级路径映射技术</strong></p>
<ol>
<li>条件路径映射：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;paths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-string">&quot;config/production&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 生产环境</span><br>      <span class="hljs-string">&quot;config/development&quot;</span> <span class="hljs-comment">// 开发环境</span><br>    <span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>多项目共享映射：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// 基座项目 tsconfig.base.json</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;paths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;@shared/*&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;../shared/*&quot;</span><span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-comment">// 子项目 tsconfig.json</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;extends&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;../tsconfig.base.json&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;baseUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;src&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>路径映射重定向：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;paths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;old-module&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;new-module&quot;</span><span class="hljs-punctuation">]</span> <span class="hljs-comment">// 重定向旧路径</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p><strong>路径映射规范指南</strong></p>
<ol>
<li>统一前缀约定：</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">@app/      // 应用核心代码<br>@lib/      // 公共库<br>@assets/   // 静态资源<br>@test/     // 测试工具<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>禁止深层相对路径：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 禁用</span><br><span class="hljs-keyword">import</span> util <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../utils&#x27;</span>;<br><br><span class="hljs-comment">// 启用</span><br><span class="hljs-keyword">import</span> util <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@core/utils&#x27;</span>;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>映射路径长度限制：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// 优先使用短路径</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;paths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;@c&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;components&quot;</span><span class="hljs-punctuation">]</span> <span class="hljs-comment">// 不推荐：过于简短</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ol start="4">
<li>文档化映射规则：</li>
</ol>
<p>路径映射规范：</p>
<table>
<thead>
<tr>
<th align="left">映射路径</th>
<th align="left">实际路径</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">@components&#x2F;*</td>
<td align="left">src&#x2F;components&#x2F;*</td>
<td align="left">全局组件</td>
</tr>
<tr>
<td align="left">@utils</td>
<td align="left">src&#x2F;utils&#x2F;index.ts</td>
<td align="left">工具函数入口</td>
</tr>
</tbody></table>
<h3 id="1-4-4-动态导入与代码分割类型安全"><a href="#1-4-4-动态导入与代码分割类型安全" class="headerlink" title="1.4.4 动态导入与代码分割类型安全"></a>1.4.4 动态导入与代码分割类型安全</h3><p><strong>动态导入基础语法</strong></p>
<p>核心语法：import() 函数返回 Promise，在模块加载完成后解析为模块对象</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 基本用法</span><br><span class="hljs-keyword">const</span> modulePromise = <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./module&#x27;</span>);<br><br><span class="hljs-comment">// 带路径变量</span><br><span class="hljs-keyword">const</span> moduleName = <span class="hljs-string">&#x27;utils&#x27;</span>;<br><span class="hljs-keyword">const</span> utilsModule = <span class="hljs-keyword">import</span>(<span class="hljs-string">`./<span class="hljs-subst">$&#123;moduleName&#125;</span>`</span>);<br></code></pre></td></tr></table></figure>

<p>类型安全处理：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MathModule</span> &#123;<br>  <span class="hljs-attr">add</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;<br>  <span class="hljs-attr">PI</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-keyword">const</span> mathModule = <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./math&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">Promise</span>&lt;&#123; <span class="hljs-attr">default</span>: <span class="hljs-title class_">MathModule</span> &#125;&gt;;<br><br>mathModule.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">mod</span> =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mod.<span class="hljs-property">default</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)); <span class="hljs-comment">// 类型安全访问</span><br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>代码分割类型声明</strong></p>
<ol>
<li>模块声明文件：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// math.module.d.ts</span><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">mathModule</span>: &#123;<br>  <span class="hljs-attr">add</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;<br>  <span class="hljs-attr">PI</span>: <span class="hljs-built_in">number</span>;<br>&#125;;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> mathModule;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>动态模块类型：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 使用泛型定义返回类型</span><br><span class="hljs-keyword">function</span> dynamicImport&lt;T&gt;(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;T&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">import</span>(path) <span class="hljs-keyword">as</span> <span class="hljs-title class_">Promise</span>&lt;T&gt;;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br>dynamicImport&lt;&#123; <span class="hljs-attr">default</span>: <span class="hljs-title class_">MathModule</span> &#125;&gt;(<span class="hljs-string">&#x27;./math&#x27;</span>)<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">&#123; <span class="hljs-keyword">default</span>: math &#125;</span>) =&gt;</span> math.<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>));<br></code></pre></td></tr></table></figure>

<p><strong>React 动态组件类型安全</strong></p>
<ol>
<li>React.lazy 基础用法：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">LazyComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./HeavyComponent&#x27;</span>));<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">React.Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>&#125;&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">LazyComponent</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">React.Suspense</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>带属性的组件类型：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// HeavyComponent.tsx</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Props</span> &#123;<br>  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">HeavyComponent</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">Props</span>&gt; = <span class="hljs-function">(<span class="hljs-params">&#123; title, count &#125;</span>) =&gt;</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;title&#125;: &#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>);<br><br><span class="hljs-comment">// 动态导入</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">LazyComponent</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <br>  <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./HeavyComponent&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">mod</span> =&gt;</span> (&#123;<br>    <span class="hljs-attr">default</span>: mod.<span class="hljs-property">HeavyComponent</span><br>  &#125;))<br>);<br><br><span class="hljs-comment">// 使用（保留属性类型检查）</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">LazyComponent</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Items&quot;</span> <span class="hljs-attr">count</span>=<span class="hljs-string">&#123;5&#125;</span> /&gt;</span></span><br></code></pre></td></tr></table></figure>

<p><strong>Vue 异步组件类型</strong></p>
<ol>
<li>defineAsyncComponent：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; defineAsyncComponent &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncComponent</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span> <br>  <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./AsyncComponent.vue&#x27;</span>)<br>);<br><br><span class="hljs-comment">// 使用</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">AsyncComponent</span> <span class="hljs-attr">:count</span>=<span class="hljs-string">&quot;5&quot;</span> /&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>类型推断组件属性：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 声明组件类型</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">AsyncComponentProps</span> &#123;<br>  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncComponent</span> = <span class="hljs-title function_">defineAsyncComponent</span>(&#123;<br>  <span class="hljs-attr">loader</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./AsyncComponent.vue&#x27;</span>),<br>  <span class="hljs-attr">loadingComponent</span>: <span class="hljs-title class_">LoadingSpinner</span>,<br>  <span class="hljs-attr">delay</span>: <span class="hljs-number">200</span>,<br>&#125;) <span class="hljs-keyword">as</span> <span class="hljs-title class_">DefineComponent</span>&lt;<span class="hljs-title class_">AsyncComponentProps</span>&gt;;<br></code></pre></td></tr></table></figure>

<p><strong>代码分割模式</strong></p>
<ol>
<li>路由级分割：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// React Router v6</span><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createBrowserRouter</span>([<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/dashboard&#x27;</span>,<br>    <span class="hljs-attr">element</span>: (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">React.Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">Spinner</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">        &#123;import(&#x27;./Dashboard&#x27;)&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">React.Suspense</span>&gt;</span></span><br>    )<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/reports&#x27;</span>,<br>    <span class="hljs-attr">lazy</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./Reports&#x27;</span>) <span class="hljs-comment">// 自动处理Suspense</span><br>  &#125;<br>]);<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>功能级分割：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 按需加载工具库</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">processData</span>(<span class="hljs-params"><span class="hljs-attr">data</span>: <span class="hljs-built_in">any</span>[]</span>) &#123;<br>  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1000</span>) &#123;<br>    <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./heavy-utils&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">&#123; sortBigData &#125;</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">sortBigData</span>(data);<br>    &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>条件分割：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 根据设备加载不同模块</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">loadEditor</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isMobileDevice</span>()) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./mobile-editor&#x27;</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./desktop-editor&#x27;</span>);<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>类型安全策略</strong></p>
<ol>
<li>动态导入泛型封装：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// safeImport.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> safeImport&lt;T&gt;(<span class="hljs-attr">modulePath</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;T&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackChunkName: &quot;[request]&quot; */</span> modulePath) <span class="hljs-keyword">as</span> <span class="hljs-title class_">Promise</span>&lt;T&gt;;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ChartModule</span> &#123;<br>  <span class="hljs-attr">renderChart</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">data</span>: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;<br>&#125;<br><br>safeImport&lt;<span class="hljs-title class_">ChartModule</span>&gt;(<span class="hljs-string">&#x27;./charting-lib&#x27;</span>)<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">chart</span> =&gt;</span> chart.<span class="hljs-title function_">renderChart</span>(data));<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>模块类型验证：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 运行时类型验证</span><br><span class="hljs-keyword">import</span> &#123; is &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;typescript-is&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">loadModule</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> mod = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./plugin&#x27;</span>);<br>  <br>  <span class="hljs-keyword">if</span> (!is&lt;<span class="hljs-title class_">PluginInterface</span>&gt;(mod)) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Invalid plugin interface&#x27;</span>);<br>  &#125;<br>  <br>  <span class="hljs-keyword">return</span> mod;<br>&#125;;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>类型断言辅助：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 创建类型断言函数</span><br><span class="hljs-keyword">function</span> assertModule&lt;T&gt;(<span class="hljs-attr">module</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">key</span>: keyof T): asserts <span class="hljs-variable language_">module</span> is T &#123;<br>  <span class="hljs-keyword">if</span> (!(key <span class="hljs-keyword">in</span> <span class="hljs-variable language_">module</span>)) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Module missing required export: <span class="hljs-subst">$&#123;<span class="hljs-built_in">String</span>(key)&#125;</span>`</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> mod = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./validator&#x27;</span>);<br>assertModule&lt;&#123; <span class="hljs-attr">validate</span>: <span class="hljs-title class_">Function</span> &#125;&gt;(mod, <span class="hljs-string">&#x27;validate&#x27;</span>);<br>mod.<span class="hljs-title function_">validate</span>(input); <span class="hljs-comment">// 安全调用</span><br></code></pre></td></tr></table></figure>

<p><strong>Webpack 魔法注释</strong></p>
<ol>
<li>基础注释：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 命名代码块</span><br><span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackChunkName: &quot;math&quot; */</span> <span class="hljs-string">&#x27;./math&#x27;</span>);<br><br><span class="hljs-comment">// 预获取</span><br><span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackPrefetch: true */</span> <span class="hljs-string">&#x27;./prefetch-module&#x27;</span>);<br><br><span class="hljs-comment">// 预加载</span><br><span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackPreload: true */</span> <span class="hljs-string">&#x27;./critical-module&#x27;</span>);<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>组合使用：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 生产环境启用预取</span><br><span class="hljs-keyword">const</span> isProd = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span>;<br><span class="hljs-keyword">const</span> comments = isProd ? <span class="hljs-string">&#x27;webpackPrefetch: true&#x27;</span> : <span class="hljs-string">&#x27;&#x27;</span>;<br><br><span class="hljs-keyword">const</span> mod = <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackChunkName: &quot;utils&quot;, $&#123;comments&#125; */</span> <span class="hljs-string">&#x27;./utils&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p><strong>最佳实践指南</strong></p>
<ol>
<li>代码分割策略：</li>
</ol>
<table>
<thead>
<tr>
<th align="left">分割粒度</th>
<th align="left">适合场景</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">路由级</td>
<td align="left">SPA应用</td>
<td align="left"><code>lazy(() =&gt; import(&#39;./page&#39;))</code></td>
</tr>
<tr>
<td align="left">组件级</td>
<td align="left">大型组件&#x2F;三方组件</td>
<td align="left"><code>const Heavy = lazy(() =&gt; import(...))</code></td>
</tr>
<tr>
<td align="left">库级</td>
<td align="left">第三方大体积库</td>
<td align="left"><code>import(&#39;lodash/debounce&#39;)</code></td>
</tr>
<tr>
<td align="left">功能级</td>
<td align="left">非首屏关键功能</td>
<td align="left">点击后加载编辑器模块</td>
</tr>
</tbody></table>
<ol start="2">
<li>加载状态管理：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 自定义加载状态</span><br><span class="hljs-keyword">function</span> useLazyModule&lt;T&gt;(<span class="hljs-attr">loader</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;T&gt;) &#123;<br>  <span class="hljs-keyword">const</span> [<span class="hljs-variable language_">module</span>, setModule] = useState&lt;T | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br>  <span class="hljs-keyword">const</span> [error, setError] = useState&lt;<span class="hljs-title class_">Error</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);<br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">loader</span>()<br>      .<span class="hljs-title function_">then</span>(setModule)<br>      .<span class="hljs-title function_">catch</span>(setError)<br>      .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>));<br>  &#125;, []);<br><br>  <span class="hljs-keyword">return</span> &#123; <span class="hljs-variable language_">module</span>, loading, error &#125;;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> &#123; <span class="hljs-attr">module</span>: math, loading &#125; = <span class="hljs-title function_">useLazyModule</span>(<span class="hljs-function">() =&gt;</span> <br>  <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./math&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> m.<span class="hljs-property">default</span>)<br>);<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>错误边界处理：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// React 错误边界</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LazyErrorBoundary</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  state = &#123; <span class="hljs-attr">hasError</span>: <span class="hljs-literal">false</span> &#125;;<br>  <br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getDerivedStateFromError</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">hasError</span>: <span class="hljs-literal">true</span> &#125;;<br>  &#125;<br>  <br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">hasError</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">FallbackUI</span> /&gt;</span></span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">children</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br>&lt;<span class="hljs-title class_">LazyErrorBoundary</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">React.Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">Spinner</span> /&gt;</span>&#125;&gt;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">LazyComponent</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">React.Suspense</span>&gt;</span></span><br>&lt;/<span class="hljs-title class_">LazyErrorBoundary</span>&gt;<br></code></pre></td></tr></table></figure>

<p><strong>性能优化技巧</strong></p>
<ol>
<li>预加载关键模块：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 首屏渲染后预加载</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./next-page&#x27;</span>).<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>);<br>&#125;, []);<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>批量加载策略：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 同时加载多个模块</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">loadDashboardModules</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<br>  <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./chart&#x27;</span>),<br>  <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./stats&#x27;</span>),<br>  <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./recent-activity&#x27;</span>)<br>]);<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-title function_">loadDashboardModules</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">[chart, stats, activity]</span>) =&gt;</span> &#123;<br>  chart.<span class="hljs-title function_">render</span>();<br>  stats.<span class="hljs-title function_">update</span>();<br>&#125;);<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>请求合并：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 使用Webpack魔法注释合并请求</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getEditor</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackMode: &quot;lazy-once&quot; */</span> <span class="hljs-string">&#x27;./editor&#x27;</span>);<br><br><span class="hljs-comment">// 不同地方调用只加载一次</span><br>button1.<span class="hljs-property">onclick</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">getEditor</span>().<span class="hljs-title function_">then</span>(...);<br>button2.<span class="hljs-property">onclick</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">getEditor</span>().<span class="hljs-title function_">then</span>(...);<br></code></pre></td></tr></table></figure>

<p><strong>类型安全陷阱与解决方案</strong></p>
<p>陷阱1：模块类型漂移</p>
<p>现象：模块更新后类型不匹配</p>
<p>解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 版本化类型声明</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;./chart&#x27;</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ChartV2</span> &#123;<br>    <span class="hljs-title function_">newMethod</span>(): <span class="hljs-built_in">void</span>;<br>  &#125;<br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">chart</span>: <span class="hljs-title class_">ChartV2</span>;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> chart;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>陷阱2：动态路径类型丢失</p>
<p>解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 路径映射类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ModulePaths</span> = <br>  | <span class="hljs-string">&#x27;./math&#x27;</span> <br>  | <span class="hljs-string">&#x27;./chart&#x27;</span> <br>  | <span class="hljs-string">&#x27;./utils&#x27;</span>;<br><br><span class="hljs-keyword">function</span> loadModule&lt;T&gt;(<span class="hljs-attr">path</span>: <span class="hljs-title class_">ModulePaths</span>): <span class="hljs-title class_">Promise</span>&lt;T&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">import</span>(path) <span class="hljs-keyword">as</span> <span class="hljs-title class_">Promise</span>&lt;T&gt;;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>陷阱3：CJS&#x2F;ESM 互操作问题</p>
<p>解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 统一封装</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadCompatModule</span>(<span class="hljs-params"><span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span></span>) &#123;<br>  <span class="hljs-keyword">const</span> mod = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(path);<br>  <span class="hljs-keyword">return</span> mod.<span class="hljs-property">default</span> || mod;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="二、高级类型系统"><a href="#二、高级类型系统" class="headerlink" title="二、高级类型系统"></a>二、高级类型系统</h1><h2 id="2-1-工具类型原理"><a href="#2-1-工具类型原理" class="headerlink" title="2.1 工具类型原理"></a>2.1 工具类型原理</h2><h3 id="2-1-1-内置工具类型源码解析"><a href="#2-1-1-内置工具类型源码解析" class="headerlink" title="2.1.1 内置工具类型源码解析"></a>2.1.1 内置工具类型源码解析</h3><p>TypeScript 内置工具类型通过条件类型和映射类型实现</p>
<p><strong>基础工具类型</strong></p>
<ol>
<li><code>Partial&lt;T&gt;</code>：将类型 T 的所有属性变为可选</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Partial</span>&lt;T&gt; = &#123;<br>  [P <span class="hljs-keyword">in</span> keyof T]?: T[P];<br>&#125;;<br></code></pre></td></tr></table></figure>

<ul>
<li>实现原理：映射类型 + ? 修饰符</li>
<li>示例：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">PartialUser</span> = <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">User</span>&gt;; <span class="hljs-comment">// &#123; name?: string; age?: number &#125;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li><code>Required&lt;T&gt;</code>：将类型 T 的所有属性变为必填</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Required</span>&lt;T&gt; = &#123;<br>  [P <span class="hljs-keyword">in</span> keyof T]-?: T[P];<br>&#125;;<br></code></pre></td></tr></table></figure>

<ul>
<li>实现原理：映射类型 + -? 移除可选修饰符</li>
<li>示例：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">RequiredUser</span> = <span class="hljs-title class_">Required</span>&lt;<span class="hljs-title class_">PartialUser</span>&gt;; <span class="hljs-comment">// &#123; name: string; age: number &#125;</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li><code>Readonly&lt;T&gt;</code>：将类型 T 的所有属性变为只读</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Readonly</span>&lt;T&gt; = &#123;<br>  <span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: T[P];<br>&#125;;<br></code></pre></td></tr></table></figure>

<ul>
<li>实现原理：映射类型 + readonly 修饰符</li>
<li>示例：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ReadonlyUser</span> = <span class="hljs-title class_">Readonly</span>&lt;<span class="hljs-title class_">User</span>&gt;; <span class="hljs-comment">// &#123; readonly name: string; readonly age: number &#125;</span><br></code></pre></td></tr></table></figure>

<p><strong>结构操作工具类型</strong></p>
<ol>
<li><code>Pick&lt;T, K extends keyof T&gt;</code>: 从类型 T 中选取指定属性 K</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Pick</span>&lt;T, K <span class="hljs-keyword">extends</span> keyof T&gt; = &#123;<br>  [P <span class="hljs-keyword">in</span> K]: T[P];<br>&#125;;<br></code></pre></td></tr></table></figure>

<ul>
<li>实现原理：映射类型 + 键名约束</li>
<li>示例：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">NameOnly</span> = <span class="hljs-title class_">Pick</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-string">&#x27;name&#x27;</span>&gt;; <span class="hljs-comment">// &#123; name: string &#125;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li><code>Omit&lt;T, K extends keyof any&gt;</code>: 从类型 T 中排除指定属性 K</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Omit</span>&lt;T, K <span class="hljs-keyword">extends</span> keyof <span class="hljs-built_in">any</span>&gt; = <span class="hljs-title class_">Pick</span>&lt;T, <span class="hljs-title class_">Exclude</span>&lt;keyof T, K&gt;&gt;;<br></code></pre></td></tr></table></figure>

<ul>
<li>实现原理：组合 Pick 和 Exclude</li>
<li>源码依赖：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Exclude</span>&lt;T, U&gt; = T <span class="hljs-keyword">extends</span> U ? <span class="hljs-built_in">never</span> : T;<br></code></pre></td></tr></table></figure>

<ul>
<li>示例：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">WithoutAge</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-string">&#x27;age&#x27;</span>&gt;; <span class="hljs-comment">// &#123; name: string &#125;</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li><code>Record&lt;K extends keyof any, T&gt;</code>: 创建键为 K、值为 T 的类型</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Record</span>&lt;K <span class="hljs-keyword">extends</span> keyof <span class="hljs-built_in">any</span>, T&gt; = &#123;<br>  [P <span class="hljs-keyword">in</span> K]: T;<br>&#125;;<br></code></pre></td></tr></table></figure>

<ul>
<li>实现原理：动态键映射</li>
<li>示例：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">UserMap</span> = <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">User</span>&gt;; <span class="hljs-comment">// &#123; [key: string]: User &#125;</span><br></code></pre></td></tr></table></figure>

<p><strong>类型操作工具类型</strong></p>
<ol>
<li><code>Exclude&lt;T, U&gt;</code>: 从 T 中排除可分配给 U 的类型</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Exclude</span>&lt;T, U&gt; = T <span class="hljs-keyword">extends</span> U ? <span class="hljs-built_in">never</span> : T;<br></code></pre></td></tr></table></figure>

<ul>
<li>实现原理：条件类型 + never</li>
<li>示例：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T0</span> = <span class="hljs-title class_">Exclude</span>&lt;<span class="hljs-string">&quot;a&quot;</span> | <span class="hljs-string">&quot;b&quot;</span> | <span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>&gt;; <span class="hljs-comment">// &quot;b&quot; | &quot;c&quot;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li><code>Extract&lt;T, U&gt;</code>: 从 T 中提取可分配给 U 的类型</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Extract</span>&lt;T, U&gt; = T <span class="hljs-keyword">extends</span> U ? T : <span class="hljs-built_in">never</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>实现原理：条件类型反向操作</li>
<li>示例：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T1</span> = <span class="hljs-title class_">Extract</span>&lt;<span class="hljs-string">&quot;a&quot;</span> | <span class="hljs-string">&quot;b&quot;</span> | <span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-string">&quot;a&quot;</span> | <span class="hljs-string">&quot;f&quot;</span>&gt;; <span class="hljs-comment">// &quot;a&quot;</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li><code>NonNullable&lt;T&gt;</code>: 从 T 中排除 null 和 undefined</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">NonNullable</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span> ? <span class="hljs-built_in">never</span> : T;<br></code></pre></td></tr></table></figure>

<ul>
<li>实现原理：条件类型过滤</li>
<li>示例：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T2</span> = <span class="hljs-title class_">NonNullable</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span>&gt;; <span class="hljs-comment">// string</span><br></code></pre></td></tr></table></figure>

<p><strong>函数操作工具类型</strong></p>
<ol>
<li><code>Parameters&lt;T extends (...args: any) =&gt; any&gt;</code>: 获取函数参数类型元组</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Parameters</span>&lt;T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">any</span>&gt; = <br>  T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: infer P) =&gt; <span class="hljs-built_in">any</span> ? P : <span class="hljs-built_in">never</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>实现原理：infer 推导参数类型</li>
<li>示例：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">FnParams</span> = <span class="hljs-title class_">Parameters</span>&lt;<span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>&gt;; <span class="hljs-comment">// [string, number]</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li><code>ReturnType&lt;T extends (...args: any) =&gt; any&gt;</code>: 获取函数返回值类型</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ReturnType</span>&lt;T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">any</span>&gt; = <br>  T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; infer R ? R : <span class="hljs-built_in">any</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>实现原理：infer 推导返回类型</li>
<li>示例：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">FnReturn</span> = <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">boolean</span>&gt;; <span class="hljs-comment">// boolean</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li><code>ConstructorParameters&lt;T extends new (...args: any) =&gt; any&gt;</code>: 获取构造函数参数类型元组</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ConstructorParameters</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title function_">new</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">any</span>&gt; = <br>  T <span class="hljs-keyword">extends</span> <span class="hljs-title function_">new</span> (...<span class="hljs-attr">args</span>: infer P) =&gt; <span class="hljs-built_in">any</span> ? P : <span class="hljs-built_in">never</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>实现原理：infer 推导构造函数参数</li>
<li>示例：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span></span>) &#123;&#125;<br>&#125;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Params</span> = <span class="hljs-title class_">ConstructorParameters</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Person</span>&gt;; <span class="hljs-comment">// [string, number]</span><br></code></pre></td></tr></table></figure>

<p><strong>高级工具类型</strong></p>
<ol>
<li><code>ThisParameterType&lt;T&gt;</code>: 提取函数的 this 参数类型</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ThisParameterType</span>&lt;T&gt; = <br>  T <span class="hljs-title function_">extends</span> (<span class="hljs-attr">this</span>: infer U, ...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; <span class="hljs-built_in">any</span> ? U : <span class="hljs-built_in">unknown</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>实现原理：infer 捕获 this 类型</li>
<li>示例：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"><span class="hljs-attr">this</span>: <span class="hljs-title class_">Window</span></span>) &#123;&#125;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ThisType</span> = <span class="hljs-title class_">ThisParameterType</span>&lt;<span class="hljs-keyword">typeof</span> fn&gt;; <span class="hljs-comment">// Window</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li><code>OmitThisParameter&lt;T&gt;</code>: 移除函数的 this 参数类型</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">OmitThisParameter</span>&lt;T&gt; = <br>  <span class="hljs-built_in">unknown</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ThisParameterType</span>&lt;T&gt; ? T : <br>  T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: infer A) =&gt; infer R ? <span class="hljs-function">(<span class="hljs-params">...<span class="hljs-attr">args</span>: A</span>) =&gt;</span> R : T;<br></code></pre></td></tr></table></figure>

<ul>
<li>实现原理：组合 ThisParameterType + 参数推导</li>
<li>示例：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">WithoutThis</span> = <span class="hljs-title class_">OmitThisParameter</span>&lt;<span class="hljs-keyword">typeof</span> fn&gt;; <span class="hljs-comment">// () =&gt; void</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li><code>Awaited&lt;T&gt;</code>: 递归解包 Promise 类型</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Awaited</span>&lt;T&gt; =<br>    T <span class="hljs-keyword">extends</span> <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span> ? T : <span class="hljs-comment">// 特殊处理 null/undefined</span><br>    T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> &amp; &#123; <span class="hljs-title function_">then</span>(<span class="hljs-attr">onfulfilled</span>: infer F): <span class="hljs-built_in">any</span> &#125; ? <span class="hljs-comment">// 检查 thenable 对象</span><br>        F <span class="hljs-title function_">extends</span> (<span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">value</span>: infer V, ...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">any</span>) ? <br>            <span class="hljs-title class_">Awaited</span>&lt;V&gt; : <span class="hljs-comment">// 递归解包</span><br>        <span class="hljs-built_in">never</span> : <br>    T; <span class="hljs-comment">// 非 Promise 类型直接返回</span><br></code></pre></td></tr></table></figure>

<ul>
<li>实现原理：条件类型递归 + thenable 检测</li>
<li>示例：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T3</span> = <span class="hljs-title class_">Awaited</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;&gt;; <span class="hljs-comment">// string</span><br></code></pre></td></tr></table></figure>

<p><strong>源码设计模式分析</strong></p>
<ol>
<li>分布式条件类型</li>
</ol>
<p>当泛型参数为联合类型时，条件类型会分布式应用：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// Exclude 中的分布式特性</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Exclude</span>&lt;T, U&gt; = T <span class="hljs-keyword">extends</span> U ? <span class="hljs-built_in">never</span> : T;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">Exclude</span>&lt;<span class="hljs-string">&#x27;a&#x27;</span> | <span class="hljs-string">&#x27;b&#x27;</span> | <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span> | <span class="hljs-string">&#x27;b&#x27;</span>&gt;; <span class="hljs-comment">// &#x27;c&#x27;</span><br><br><span class="hljs-comment">// 等价于：</span><br>(<span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">&#x27;a&#x27;</span> | <span class="hljs-string">&#x27;b&#x27;</span> ? <span class="hljs-built_in">never</span> : <span class="hljs-string">&#x27;a&#x27;</span>) |<br>(<span class="hljs-string">&#x27;b&#x27;</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">&#x27;a&#x27;</span> | <span class="hljs-string">&#x27;b&#x27;</span> ? <span class="hljs-built_in">never</span> : <span class="hljs-string">&#x27;b&#x27;</span>) |<br>(<span class="hljs-string">&#x27;c&#x27;</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">&#x27;a&#x27;</span> | <span class="hljs-string">&#x27;b&#x27;</span> ? <span class="hljs-built_in">never</span> : <span class="hljs-string">&#x27;c&#x27;</span>)<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>类型递归模式</li>
</ol>
<p>处理嵌套结构的关键技术：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 内置工具类型中的递归</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">DeepReadonly</span>&lt;T&gt; = &#123;<br>  <span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: T[P] <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> <br>    ? <span class="hljs-title class_">DeepReadonly</span>&lt;T[P]&gt; <br>    : T[P];<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>类型推断优先级</li>
</ol>
<p>infer 关键字的工作机制：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 协变位置（返回值）推断</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">GetReturnType</span>&lt;T&gt; = T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; infer R ? R : <span class="hljs-built_in">any</span>;<br><br><span class="hljs-comment">// 逆变位置（参数）推断</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">GetFirstArg</span>&lt;T&gt; = T <span class="hljs-title function_">extends</span> (<span class="hljs-attr">arg</span>: infer A, ...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; <span class="hljs-built_in">any</span> ? A : <span class="hljs-built_in">never</span>;<br></code></pre></td></tr></table></figure>

<p><strong>工程实践要点</strong></p>
<ol>
<li>避免过度嵌套：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 危险：深层嵌套可能导致类型实例化过深错误</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">DeepNested</span> = <span class="hljs-title class_">Awaited</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;&gt;&gt;;<br><br><span class="hljs-comment">// 解决方案：设置递归深度限制</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">SafeAwaited</span>&lt;T, <span class="hljs-title class_">Depth</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">number</span> = <span class="hljs-number">5</span>&gt; = <br>  <span class="hljs-title class_">Depth</span> <span class="hljs-keyword">extends</span> <span class="hljs-number">0</span> ? T :<br>  T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer U&gt; ? <span class="hljs-title class_">SafeAwaited</span>&lt;U, [-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>][<span class="hljs-title class_">Depth</span>]&gt; : T;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>性能敏感场景优化：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 使用内置工具类型替代自定义复杂类型</span><br><span class="hljs-comment">// 不推荐：</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">MyPartial</span>&lt;T&gt; = &#123; [P <span class="hljs-keyword">in</span> keyof T]?: T[P] &#125;;<br><br><span class="hljs-comment">// 推荐：直接使用 Partial</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>类型安全检查：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 确保工具类型安全</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">SafeExtract</span>&lt;T, U&gt; = [T] <span class="hljs-keyword">extends</span> [U] ? T : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 防止分布式行为</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">DistributiveCheck</span>&lt;T&gt; = [T] <span class="hljs-keyword">extends</span> [<span class="hljs-built_in">never</span>] ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>源码调试技巧：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 使用类型打印调试</span><br><span class="hljs-keyword">type</span> _Debug&lt;T&gt; = T <span class="hljs-keyword">extends</span> infer U ? U : <span class="hljs-built_in">never</span>;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Reveal</span>&lt;T&gt; = &#123; [P <span class="hljs-keyword">in</span> keyof T]: T[P] &#125; &amp; &#123;&#125;;<br><br><span class="hljs-comment">// 查看实际类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">DebugView</span> = <span class="hljs-title class_">Reveal</span>&lt;<span class="hljs-title class_">SomeComplexType</span>&gt;;<br></code></pre></td></tr></table></figure>

<p><strong>内置工具类型关系图</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs text">基础操作<br>├─ Partial<br>├─ Required<br>├─ Readonly<br>│<br>结构操作<br>├─ Pick<br>├─ Omit → 依赖 Exclude<br>├─ Record<br>│<br>集合操作<br>├─ Exclude<br>├─ Extract<br>├─ NonNullable<br>│<br>函数操作<br>├─ Parameters<br>├─ ReturnType<br>├─ ConstructorParameters<br>├─ ThisParameterType<br>└─ OmitThisParameter<br></code></pre></td></tr></table></figure>

<h3 id="2-1-2-类型映射修饰符（-）原理"><a href="#2-1-2-类型映射修饰符（-）原理" class="headerlink" title="2.1.2 类型映射修饰符（+&#x2F;-）原理"></a>2.1.2 类型映射修饰符（+&#x2F;-）原理</h3><p><strong>修饰符基础概念</strong></p>
<p>类型映射修饰符用于控制属性修饰符（? 和 readonly）的添加或移除：</p>
<table>
<thead>
<tr>
<th align="left">修饰符</th>
<th align="left">作用</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">+</td>
<td align="left">添加修饰符（默认行为）</td>
<td align="left"><code>&#123; +readonly [P in K]: T &#125;</code></td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">移除修饰符</td>
<td align="left"><code>&#123; -? [P in K]: T &#125;</code></td>
</tr>
</tbody></table>
<p><strong>核心语法解析</strong></p>
<ol>
<li>添加修饰符（显式+）：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 显式添加只读属性</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">AddReadonly</span>&lt;T&gt; = &#123;<br>  +<span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: T[P];<br>&#125;;<br><br><span class="hljs-comment">// 显式添加可选属性</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">AddOptional</span>&lt;T&gt; = &#123;<br>  [P <span class="hljs-keyword">in</span> keyof T]+?: T[P];<br>&#125;;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>移除修饰符（-）：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 移除只读属性</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">RemoveReadonly</span>&lt;T&gt; = &#123;<br>  -<span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: T[P];<br>&#125;;<br><br><span class="hljs-comment">// 移除可选属性</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">RemoveOptional</span>&lt;T&gt; = &#123;<br>  [P <span class="hljs-keyword">in</span> keyof T]-?: T[P];<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>实现原理分析</strong></p>
<ol>
<li>修饰符的编译转换：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 源码：</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Mutable</span>&lt;T&gt; = &#123;<br>  -<span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: T[P];<br>&#125;;<br><br><span class="hljs-comment">// 编译后等价于：</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Mutable</span>&lt;T&gt; = &#123;<br>  [P <span class="hljs-keyword">in</span> keyof T]: T[P];<br>&#125;;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>类型系统内部处理：<ul>
<li><code>+</code> 操作：添加属性描述符标志</li>
<li><code>-</code> 操作：清除属性描述符标志</li>
<li>映射过程本质是创建新属性描述符</li>
</ul>
</li>
</ol>
<p><strong>内置工具类型应用</strong></p>
<ol>
<li><code>Required&lt;T&gt;</code> 实现：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Required</span>&lt;T&gt; = &#123;<br>  [P <span class="hljs-keyword">in</span> keyof T]-?: T[P];<br>&#125;;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li><code>Readonly&lt;T&gt;</code> 实现：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Readonly</span>&lt;T&gt; = &#123;<br>  +<span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: T[P];<br>&#125;;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li><code>Mutable&lt;T&gt;</code>（非内置但常用）：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Mutable</span>&lt;T&gt; = &#123;<br>  -<span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: T[P];<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>组合修饰符技巧</strong></p>
<ol>
<li>同时添加&#x2F;移除多个修饰符：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 创建可变且必填的类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">MutableRequired</span>&lt;T&gt; = &#123;<br>  -<span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]-?: T[P];<br>&#125;;<br><br><span class="hljs-comment">// 等价于：</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">MutableRequired</span>&lt;T&gt; = <span class="hljs-title class_">Mutable</span>&lt;<span class="hljs-title class_">Required</span>&lt;T&gt;&gt;;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>条件修饰符：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 仅对函数属性添加只读</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ReadonlyMethods</span>&lt;T&gt; = &#123;<br>  <span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: T[P] <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Function</span> ? T[P] : <span class="hljs-built_in">never</span>;<br>&#125; &amp; &#123;<br>  [P <span class="hljs-keyword">in</span> keyof T <span class="hljs-keyword">as</span> T[P] <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Function</span> ? <span class="hljs-built_in">never</span> : P]: T[P];<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>工程实践指南</strong></p>
<ol>
<li>不可变状态管理：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 创建深度只读状态</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ImmutableState</span>&lt;T&gt; = &#123;<br>  +<span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: <span class="hljs-title class_">ImmutableState</span>&lt;T[P]&gt;;<br>&#125;;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">AppState</span> &#123;<br>  <span class="hljs-attr">user</span>: &#123; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> &#125;;<br>  <span class="hljs-attr">settings</span>: &#123; <span class="hljs-attr">darkMode</span>: <span class="hljs-built_in">boolean</span> &#125;;<br>&#125;<br><span class="hljs-keyword">const</span> <span class="hljs-attr">state</span>: <span class="hljs-title class_">ImmutableState</span>&lt;<span class="hljs-title class_">AppState</span>&gt; = &#123;<br>  <span class="hljs-attr">user</span>: &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span> &#125;,<br>  <span class="hljs-attr">settings</span>: &#123; <span class="hljs-attr">darkMode</span>: <span class="hljs-literal">true</span> &#125;<br>&#125;;<br>state.<span class="hljs-property">user</span>.<span class="hljs-property">name</span> = <span class="hljs-string">&quot;Bob&quot;</span>; <span class="hljs-comment">// 🚫 编译错误</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>API 响应处理：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 移除API响应中的可选属性</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ConcreteResponse</span>&lt;T&gt; = &#123;<br>  [P <span class="hljs-keyword">in</span> keyof T]-?: T[P];<br>&#125;;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiResponse</span> &#123;<br>  <span class="hljs-attr">data</span>?: <span class="hljs-built_in">unknown</span>;<br>  <span class="hljs-attr">error</span>?: <span class="hljs-built_in">string</span>;<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleResponse</span>(<span class="hljs-params"><span class="hljs-attr">res</span>: <span class="hljs-title class_">ConcreteResponse</span>&lt;<span class="hljs-title class_">ApiResponse</span>&gt;</span>) &#123;<br>  <span class="hljs-comment">// res.data 和 res.error 一定存在</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>安全补丁策略：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 创建部分更新类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">SafePatch</span>&lt;T&gt; = <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">Mutable</span>&lt;T&gt;&gt; &amp; &#123;<br>  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 保持ID只读</span><br>&#125;;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Product</span> &#123;<br>  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">price</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><span class="hljs-keyword">const</span> <span class="hljs-attr">update</span>: <span class="hljs-title class_">SafePatch</span>&lt;<span class="hljs-title class_">Product</span>&gt; = &#123;<br>  <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;p1&quot;</span>, <span class="hljs-comment">// ✅ 允许（但实际不能修改）</span><br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;New Name&quot;</span> <span class="hljs-comment">// ✅</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>性能优化技巧</strong></p>
<ol>
<li>避免深度递归：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 限制递归深度</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">DeepReadonly</span>&lt;T, <span class="hljs-title class_">Depth</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">number</span> = <span class="hljs-number">3</span>&gt; = <br>  <span class="hljs-title class_">Depth</span> <span class="hljs-keyword">extends</span> <span class="hljs-number">0</span> ? T : <br>  T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> ? &#123;<br>    <span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: <span class="hljs-title class_">DeepReadonly</span>&lt;T[P], [-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>][<span class="hljs-title class_">Depth</span>]&gt;;<br>  &#125; : T;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>条件短路优化：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">OptimizedMutable</span>&lt;T&gt; = <br>  T <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">any</span>[] ? <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">OptimizedMutable</span>&lt;T[<span class="hljs-built_in">number</span>]&gt;&gt; :<br>  T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> ? &#123; -<span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: <span class="hljs-title class_">OptimizedMutable</span>&lt;T[P]&gt; &#125; :<br>  T;<br></code></pre></td></tr></table></figure>

<p><strong>编译原理透视</strong></p>
<ol>
<li>修饰符的 AST 表示：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// TypeScript AST 节点示例</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MappingModifier</span> &#123;<br>  +?: <span class="hljs-built_in">boolean</span>; <span class="hljs-comment">// 添加修饰符</span><br>  -?: <span class="hljs-built_in">boolean</span>; <span class="hljs-comment">// 移除修饰符</span><br>  <span class="hljs-attr">readonly</span>?: <span class="hljs-string">&quot;+&quot;</span> | <span class="hljs-string">&quot;-&quot;</span> | <span class="hljs-literal">null</span>;<br>  <span class="hljs-attr">optional</span>?: <span class="hljs-string">&quot;+&quot;</span> | <span class="hljs-string">&quot;-&quot;</span> | <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>类型实例化流程：</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">1. 解析映射语法<br>2. 获取源类型属性描述符<br>3. 应用修饰符操作（+/-）<br>4. 创建新属性描述符<br>5. 组合为新对象类型<br></code></pre></td></tr></table></figure>

<p><strong>常见问题解决方案</strong></p>
<p>问题：修饰符对方法无效</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br>  <span class="hljs-keyword">readonly</span> <span class="hljs-title function_">method</span>(<span class="hljs-params"></span>) &#123;&#125; <span class="hljs-comment">// 方法本质是只读的</span><br>&#125;<br><span class="hljs-keyword">type</span> T = <span class="hljs-title class_">Mutable</span>&lt;<span class="hljs-title class_">Test</span>&gt;; <span class="hljs-comment">// 仍然只读</span><br></code></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">MutableMethods</span>&lt;T&gt; = &#123;<br>  -<span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: T[P];<br>&#125; &amp; &#123;<br>  [P <span class="hljs-keyword">in</span> keyof T]: T[P] <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Function</span> ? <span class="hljs-function">(<span class="hljs-params">...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> <span class="hljs-built_in">any</span> : T[P];<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>问题：修饰符与交叉类型冲突</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> A = &#123; <span class="hljs-keyword">readonly</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> &#125;;<br><span class="hljs-keyword">type</span> B = &#123; <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> &#125;;<br><span class="hljs-keyword">type</span> C = A &amp; B; <span class="hljs-comment">// id 变为 string（只读被覆盖）</span><br></code></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">EnforceReadonly</span>&lt;T&gt; = &#123;<br>  <span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: T[P];<br>&#125;;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">SafeMerge</span>&lt;A, B&gt; = <span class="hljs-title class_">EnforceReadonly</span>&lt;A&gt; &amp; <span class="hljs-title class_">EnforceReadonly</span>&lt;B&gt;;<br></code></pre></td></tr></table></figure>

<p>问题：数组和元组处理</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 元组可变化</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">MutableTuple</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">any</span>[]&gt; = &#123;<br>  -<span class="hljs-keyword">readonly</span> [K <span class="hljs-keyword">in</span> keyof T]: T[K];<br>&#125;;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">MutableTuple</span>&lt;<span class="hljs-keyword">readonly</span> [<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>]&gt; = [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-number">1</span>];<br>arr[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;b&quot;</span>; <span class="hljs-comment">// ✅</span><br></code></pre></td></tr></table></figure>

<p><strong>修饰符与内置工具类型关系</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs text">映射修饰符体系<br>├─ 添加操作 (+)<br>│  ├─ +readonly → Readonly&lt;T&gt;<br>│  └─ +? → Partial&lt;T&gt;<br>│<br>└─ 移除操作 (-)<br>   ├─ -readonly → Mutable&lt;T&gt;<br>   └─ -? → Required&lt;T&gt;<br></code></pre></td></tr></table></figure>

<h3 id="2-1-3-条件类型分布式特性"><a href="#2-1-3-条件类型分布式特性" class="headerlink" title="2.1.3 条件类型分布式特性"></a>2.1.3 条件类型分布式特性</h3><p><strong>分布式条件类型核心概念</strong></p>
<p>触发条件：当条件类型作用于裸类型参数（naked type parameter）的联合类型时，会触发分布式行为</p>
<p>基本模式：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript">T <span class="hljs-keyword">extends</span> U ? X : Y<br></code></pre></td></tr></table></figure>

<ul>
<li>T 是裸类型参数（未包裹在数组、元组或函数中）</li>
<li>T 是联合类型 A | B | C</li>
<li>结果等价于 (A extends U ? X : Y) | (B extends U ? X : Y) | (C extends U ? X : Y)</li>
</ul>
<p><strong>分布式行为解析</strong></p>
<ol>
<li>基础示例：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">StringOrNumber</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? <span class="hljs-string">&quot;string&quot;</span> : <span class="hljs-string">&quot;number&quot;</span>;<br><br><span class="hljs-comment">// 分布式计算</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">StringOrNumber</span>&lt;<span class="hljs-string">&quot;a&quot;</span> | <span class="hljs-number">1</span>&gt;; <br><span class="hljs-comment">// 等价于：</span><br><span class="hljs-comment">// (&quot;a&quot; extends string ? &quot;string&quot; : &quot;number&quot;) |</span><br><span class="hljs-comment">// (1 extends string ? &quot;string&quot; : &quot;number&quot;)</span><br><span class="hljs-comment">// → &quot;string&quot; | &quot;number&quot;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>非分布式对比：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 包裹类型参数（非裸类型）</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Wrapped</span>&lt;T&gt; = [T] <span class="hljs-keyword">extends</span> [<span class="hljs-built_in">string</span>] ? <span class="hljs-string">&quot;string&quot;</span> : <span class="hljs-string">&quot;number&quot;</span>;<br><br><span class="hljs-comment">// 非分布式计算</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Result2</span> = <span class="hljs-title class_">Wrapped</span>&lt;<span class="hljs-string">&quot;a&quot;</span> | <span class="hljs-number">1</span>&gt;;<br><span class="hljs-comment">// 等价于：</span><br><span class="hljs-comment">// [&quot;a&quot; | 1] extends [string] ? &quot;string&quot; : &quot;number&quot;</span><br><span class="hljs-comment">// → &quot;number&quot;（因为 [&quot;a&quot; | 1] 不继承 [string]）</span><br></code></pre></td></tr></table></figure>

<p><strong>分布式规则详解</strong></p>
<ol>
<li>空联合类型处理：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Test</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">Test</span>&lt;<span class="hljs-built_in">never</span>&gt;; <span class="hljs-comment">// never（空联合类型返回never）</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>联合类型包含never：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Test</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">Test</span>&lt;<span class="hljs-string">&quot;a&quot;</span> | <span class="hljs-built_in">never</span>&gt;; <span class="hljs-comment">// true（never被忽略）</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>联合类型优先级：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Test</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span> ? T : <span class="hljs-built_in">never</span>;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">Test</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// string | number</span><br></code></pre></td></tr></table></figure>

<p><strong>内置工具类型应用</strong></p>
<ol>
<li><code>Exclude&lt;T, U&gt;</code>：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Exclude</span>&lt;T, U&gt; = T <span class="hljs-keyword">extends</span> U ? <span class="hljs-built_in">never</span> : T;<br><br><span class="hljs-comment">// 分布式计算</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">Exclude</span>&lt;<span class="hljs-string">&quot;a&quot;</span> | <span class="hljs-string">&quot;b&quot;</span> | <span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-string">&quot;a&quot;</span> | <span class="hljs-string">&quot;b&quot;</span>&gt;;<br><span class="hljs-comment">// → (&quot;a&quot; extends &quot;a&quot;|&quot;b&quot; ? never : &quot;a&quot;) |</span><br><span class="hljs-comment">//   (&quot;b&quot; extends &quot;a&quot;|&quot;b&quot; ? never : &quot;b&quot;) |</span><br><span class="hljs-comment">//   (&quot;c&quot; extends &quot;a&quot;|&quot;b&quot; ? never : &quot;c&quot;)</span><br><span class="hljs-comment">// → never | never | &quot;c&quot; → &quot;c&quot;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li><code>Extract&lt;T, U&gt;</code>：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Extract</span>&lt;T, U&gt; = T <span class="hljs-keyword">extends</span> U ? T : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 分布式计算</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">Extract</span>&lt;<span class="hljs-string">&quot;a&quot;</span> | <span class="hljs-string">&quot;b&quot;</span> | <span class="hljs-number">1</span>, <span class="hljs-built_in">string</span>&gt;;<br><span class="hljs-comment">// → (&quot;a&quot; extends string ? &quot;a&quot; : never) |</span><br><span class="hljs-comment">//   (&quot;b&quot; extends string ? &quot;b&quot; : never) |</span><br><span class="hljs-comment">//   (1 extends string ? 1 : never)</span><br><span class="hljs-comment">// → &quot;a&quot; | &quot;b&quot; | never → &quot;a&quot; | &quot;b&quot;</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li><code>NonNullable&lt;T&gt;</code>：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">NonNullable</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span> ? <span class="hljs-built_in">never</span> : T;<br><br><span class="hljs-comment">// 分布式计算</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">NonNullable</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span>&gt;;<br><span class="hljs-comment">// → (string extends null|undefined ? never : string) |</span><br><span class="hljs-comment">//   (null extends null|undefined ? never : null) |</span><br><span class="hljs-comment">//   (undefined extends null|undefined ? never : undefined)</span><br><span class="hljs-comment">// → string | never | never → string</span><br></code></pre></td></tr></table></figure>

<p><strong>避免分布式行为</strong></p>
<ol>
<li>包裹类型参数：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 方法1：元组包裹</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">NoDistribute</span>&lt;T&gt; = [T] <span class="hljs-keyword">extends</span> [<span class="hljs-built_in">string</span>] ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;<br><br><span class="hljs-comment">// 方法2：数组包裹</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">NoDistribute2</span>&lt;T&gt; = T[] <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>[] ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;<br><br><span class="hljs-comment">// 方法3：函数包裹</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">NoDistribute3</span>&lt;T&gt; = (<span class="hljs-function">() =&gt;</span> T) <span class="hljs-title function_">extends</span> () =&gt; <span class="hljs-built_in">string</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>特殊类型约束：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 使用never约束</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">IsNever</span>&lt;T&gt; = [T] <span class="hljs-keyword">extends</span> [<span class="hljs-built_in">never</span>] ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;<br><br><span class="hljs-comment">// 使用any约束</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">IsAny</span>&lt;T&gt; = <span class="hljs-number">0</span> <span class="hljs-title function_">extends</span> (<span class="hljs-number">1</span> &amp; T) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;<br></code></pre></td></tr></table></figure>

<p><strong>高级应用场景</strong></p>
<ol>
<li>联合类型过滤：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 过滤出函数类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">FilterFunctions</span>&lt;T&gt; = T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; <span class="hljs-built_in">any</span> ? T : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Functions</span> = <span class="hljs-title class_">FilterFunctions</span>&lt;<span class="hljs-built_in">string</span> | (<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>) | <span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// () =&gt; void</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>类型差异检测：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 检测类型差异</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Diff</span>&lt;T, U&gt; = T <span class="hljs-keyword">extends</span> U ? <span class="hljs-built_in">never</span> : T;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">MissingProps</span> = <span class="hljs-title class_">Diff</span>&lt;<span class="hljs-string">&quot;name&quot;</span> | <span class="hljs-string">&quot;age&quot;</span>, keyof <span class="hljs-title class_">User</span>&gt;; <span class="hljs-comment">// User中缺失的属性</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>递归类型操作：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 联合类型转元组（简化版）</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">UnionToTuple</span>&lt;T&gt; = <br>  T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span> ? <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">arg</span>: T</span>) =&gt;</span> <span class="hljs-built_in">void</span> : <span class="hljs-built_in">never</span> <span class="hljs-title function_">extends</span> (<span class="hljs-attr">arg</span>: infer U) =&gt; <span class="hljs-built_in">void</span> ? U : <span class="hljs-built_in">never</span>;<br></code></pre></td></tr></table></figure>

<p><strong>分布式与映射类型结合</strong></p>
<ol>
<li>分布式键名重映射：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">AddPrefix</span>&lt;T&gt; = &#123;<br>  [K <span class="hljs-keyword">in</span> keyof T <span class="hljs-keyword">as</span> K <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? <span class="hljs-string">`data_<span class="hljs-subst">$&#123;K&#125;</span>`</span> : <span class="hljs-built_in">never</span>]: T[K]<br>&#125;;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Props</span> &#123; <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span>; &#125;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">PrefixedProps</span> = <span class="hljs-title class_">AddPrefix</span>&lt;<span class="hljs-title class_">Props</span>&gt;;<br><span class="hljs-comment">// &#123; data_id: string; data_value: number &#125;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>条件键名过滤：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 仅保留字符串键</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">StringKeys</span>&lt;T&gt; = &#123;<br>  [K <span class="hljs-keyword">in</span> keyof T]: K <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? K : <span class="hljs-built_in">never</span><br>&#125;[keyof T];<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Keys</span> = <span class="hljs-title class_">StringKeys</span>&lt;&#123; <span class="hljs-number">1</span>: <span class="hljs-built_in">number</span>; <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-built_in">string</span> &#125;&gt;; <span class="hljs-comment">// &quot;name&quot;</span><br></code></pre></td></tr></table></figure>

<p><strong>编译原理透视</strong></p>
<ol>
<li>分布式处理流程：</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">1. 解析条件类型：T extends U ? X : Y<br>2. 检查T是否为裸类型参数的联合类型<br>3. 若是，对联合类型每个成员进行独立计算<br>4. 将计算结果组合为新联合类型<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>类型实例化优化：<ul>
<li>TS编译器对分布式条件类型进行缓存优化</li>
<li>相同类型参数的计算结果会被复用</li>
<li>避免重复计算提升性能</li>
</ul>
</li>
</ol>
<p><strong>工程实践指南</strong></p>
<ol>
<li>明确设计意图：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 需要分发时</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Distributed</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span> ? T[] : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 不需要分发时</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">NonDistributed</span>&lt;T&gt; = [T] <span class="hljs-keyword">extends</span> [<span class="hljs-built_in">any</span>] ? T[] : <span class="hljs-built_in">never</span>;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>文档注释规范：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 提取数组元素类型（分发模式）</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@template</span> <span class="hljs-variable">T</span> - 联合类型数组</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@example</span> </span><br><span class="hljs-comment"> * type Element = ElementType&lt;Array&lt;string&gt; | Array&lt;number&gt;&gt;; // string | number</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ElementType</span>&lt;T&gt; = T <span class="hljs-title function_">extends</span> (infer U)[] ? U : <span class="hljs-built_in">never</span>;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>性能监控策略：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 复杂类型性能测试</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">StressTest</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span> <br>  ? <span class="hljs-string">`prefix_<span class="hljs-subst">$&#123;T &amp; <span class="hljs-built_in">string</span>&#125;</span>_suffix`</span> <br>  : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 测量实例化时间</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">&quot;type instantiation&quot;</span>);<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">StressTest</span>&lt;<span class="hljs-string">&quot;a&quot;</span> | <span class="hljs-string">&quot;b&quot;</span> | ...&gt;; <span class="hljs-comment">// 100+ 项</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">&quot;type instantiation&quot;</span>);<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>错误处理模式：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 安全分发类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">SafeDistribute</span>&lt;T, <span class="hljs-title class_">Fallback</span> = <span class="hljs-built_in">never</span>&gt; = <br>  [T] <span class="hljs-keyword">extends</span> [<span class="hljs-built_in">never</span>] ? <span class="hljs-title class_">Fallback</span> :<br>  T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span> ? <span class="hljs-comment">/* 分发逻辑 */</span> : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">SafeDistribute</span>&lt;<span class="hljs-built_in">never</span>, <span class="hljs-string">&quot;empty&quot;</span>&gt;; <span class="hljs-comment">// &quot;empty&quot;</span><br></code></pre></td></tr></table></figure>

<p><strong>分布式特性与内置工具</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs text">分布式条件类型应用体系<br>├─ 集合操作<br>│  ├─ Exclude（差集）<br>│  ├─ Extract（交集）<br>│  └─ NonNullable（过滤）<br>│<br>├─ 函数操作<br>│  ├─ Parameters<br>│  └─ ReturnType<br>│<br>└─ 高级工具<br>   ├─ UnionToIntersection<br>   └─ UnionToTuple<br></code></pre></td></tr></table></figure>

<h3 id="2-1-4-infer-关键字与类型提取"><a href="#2-1-4-infer-关键字与类型提取" class="headerlink" title="2.1.4 infer 关键字与类型提取"></a>2.1.4 infer 关键字与类型提取</h3><p><strong>infer 基础概念</strong></p>
<p>核心功能：在条件类型中声明泛型类型变量，用于推导和捕获类型信息</p>
<p>基本语法：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript">T <span class="hljs-keyword">extends</span> infer U ? U : <span class="hljs-built_in">never</span><br></code></pre></td></tr></table></figure>

<ul>
<li>infer U 声明一个类型变量 U</li>
<li>U 的类型由 TypeScript 根据上下文推导</li>
</ul>
<p>位置约束：</p>
<ul>
<li>只能在条件类型的 extends 子句中使用</li>
<li>只能出现在协变位置（返回值、属性值等）</li>
</ul>
<p><strong>基础提取模式</strong></p>
<ol>
<li>提取函数返回类型：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ReturnType</span>&lt;T&gt; = <br>  T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; infer R ? R : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">FnReturn</span> = <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// number</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>提取函数参数类型：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">FirstParam</span>&lt;T&gt; = <br>  T <span class="hljs-title function_">extends</span> (<span class="hljs-attr">first</span>: infer P, ...<span class="hljs-attr">rest</span>: <span class="hljs-built_in">any</span>[]) =&gt; <span class="hljs-built_in">any</span> ? P : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Param</span> = <span class="hljs-title class_">FirstParam</span>&lt;<span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>&gt;; <span class="hljs-comment">// string</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>提取数组元素类型：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ArrayElement</span>&lt;T&gt; = <br>  T <span class="hljs-title function_">extends</span> (infer U)[] ? U : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Element</span> = <span class="hljs-title class_">ArrayElement</span>&lt;<span class="hljs-built_in">string</span>[]&gt;; <span class="hljs-comment">// string</span><br></code></pre></td></tr></table></figure>

<p><strong>高级提取技术</strong></p>
<ol>
<li>递归类型解包：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 解包嵌套Promise</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Awaited</span>&lt;T&gt; = <br>  T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer U&gt; ? <span class="hljs-title class_">Awaited</span>&lt;U&gt; : T;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">Awaited</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;&gt;; <span class="hljs-comment">// string</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>多个 infer 变量：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 提取函数参数元组</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Params</span>&lt;T&gt; = <br>  T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: infer P) =&gt; <span class="hljs-built_in">any</span> ? P : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">FnParams</span> = <span class="hljs-title class_">Params</span>&lt;<span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>&gt;; <span class="hljs-comment">// [string, number]</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>逆变位置提取：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 提取函数this类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ThisType</span>&lt;T&gt; = <br>  T <span class="hljs-title function_">extends</span> (<span class="hljs-attr">this</span>: infer U, ...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; <span class="hljs-built_in">any</span> ? U : <span class="hljs-built_in">unknown</span>;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"><span class="hljs-attr">this</span>: <span class="hljs-title class_">Window</span></span>) &#123;&#125;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Context</span> = <span class="hljs-title class_">ThisType</span>&lt;<span class="hljs-keyword">typeof</span> fn&gt;; <span class="hljs-comment">// Window</span><br></code></pre></td></tr></table></figure>

<p><strong>模式匹配技术</strong></p>
<ol>
<li>字符串模板提取：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 提取模板字符串变量</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ExtractVariable</span>&lt;T&gt; = <br>  T <span class="hljs-keyword">extends</span> <span class="hljs-string">`user_<span class="hljs-subst">$&#123;infer Id&#125;</span>`</span> ? <span class="hljs-title class_">Id</span> : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">UserId</span> = <span class="hljs-title class_">ExtractVariable</span>&lt;<span class="hljs-string">&quot;user_123&quot;</span>&gt;; <span class="hljs-comment">// &quot;123&quot;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>对象键值提取：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 提取特定键的值类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ValueOfKey</span>&lt;T, K <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>&gt; = <br>  T <span class="hljs-keyword">extends</span> &#123; [key <span class="hljs-keyword">in</span> K]: infer V &#125; ? V : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">NameType</span> = <span class="hljs-title class_">ValueOfKey</span>&lt;&#123; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> &#125;, <span class="hljs-string">&quot;name&quot;</span>&gt;; <span class="hljs-comment">// string</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>条件分支提取：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 提取满足条件的子类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ExtractByType</span>&lt;T, U&gt; = <br>  T <span class="hljs-keyword">extends</span> U ? T : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Strings</span> = <span class="hljs-title class_">ExtractByType</span>&lt;<span class="hljs-string">&quot;a&quot;</span> | <span class="hljs-number">1</span> | <span class="hljs-literal">true</span>, <span class="hljs-built_in">string</span>&gt;; <span class="hljs-comment">// &quot;a&quot;</span><br></code></pre></td></tr></table></figure>

<p><strong>内置工具类型解析</strong></p>
<ol>
<li><code>Parameters&lt;T&gt;</code> 实现：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Parameters</span>&lt;T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">any</span>&gt; = <br>  T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: infer P) =&gt; <span class="hljs-built_in">any</span> ? P : <span class="hljs-built_in">never</span>;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li><code>ReturnType&lt;T&gt;</code> 实现：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ReturnType</span>&lt;T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">any</span>&gt; = <br>  T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; infer R ? R : <span class="hljs-built_in">any</span>;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li><code>ConstructorParameters&lt;T&gt;</code> 实现：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ConstructorParameters</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title function_">new</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">any</span>&gt; = <br>  T <span class="hljs-keyword">extends</span> <span class="hljs-title function_">new</span> (...<span class="hljs-attr">args</span>: infer P) =&gt; <span class="hljs-built_in">any</span> ? P : <span class="hljs-built_in">never</span>;<br></code></pre></td></tr></table></figure>

<p><strong>工程应用模式</strong></p>
<ol>
<li>组件 Props 提取：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 提取React组件Props类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ComponentProps</span>&lt;T&gt; = <br>  T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ComponentType</span>&lt;infer P&gt; ? P : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">MyComponent</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;&#123; <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> &#125;&gt; = <span class="hljs-function">() =&gt;</span> <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Props</span> = <span class="hljs-title class_">ComponentProps</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">MyComponent</span>&gt;; <span class="hljs-comment">// &#123; id: string &#125;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>API 响应处理：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 提取API响应中的data字段</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ApiResponse</span>&lt;T&gt; = &#123;<br>  <span class="hljs-attr">data</span>: T;<br>  <span class="hljs-attr">status</span>: <span class="hljs-built_in">number</span>;<br>&#125;;<br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ResponseData</span>&lt;T&gt; = <br>  T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ApiResponse</span>&lt;infer D&gt; ? D : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">UserData</span> = <span class="hljs-title class_">ResponseData</span>&lt;<span class="hljs-title class_">ApiResponse</span>&lt;&#123; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> &#125;&gt;&gt;; <span class="hljs-comment">// &#123; name: string &#125;</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>路由参数提取：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 提取动态路由参数</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">RouteParams</span>&lt;T&gt; = <br>  T <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">string</span>&#125;</span>/:<span class="hljs-subst">$&#123;infer Param&#125;</span>/<span class="hljs-subst">$&#123;<span class="hljs-built_in">string</span>&#125;</span>`</span> <br>    ? <span class="hljs-title class_">Param</span> | <span class="hljs-title class_">RouteParams</span>&lt;T&gt; <br>    : T <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">string</span>&#125;</span>/:<span class="hljs-subst">$&#123;infer Param&#125;</span>`</span> <br>      ? <span class="hljs-title class_">Param</span> <br>      : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Params</span> = <span class="hljs-title class_">RouteParams</span>&lt;<span class="hljs-string">&quot;/user/:id/profile/:section&quot;</span>&gt;; <span class="hljs-comment">// &quot;id&quot; | &quot;section&quot;</span><br></code></pre></td></tr></table></figure>

<p><strong>编译原理透视</strong></p>
<ol>
<li>infer 实现机制：<ul>
<li>类型系统实现模式匹配</li>
<li>在类型关系求解时绑定类型变量</li>
<li>基于约束的类型变量实例化</li>
</ul>
</li>
<li>类型推导过程：</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">1. 匹配条件类型结构<br>2. 提取候选类型<br>3. 绑定 infer 变量<br>4. 验证类型约束<br>5. 实例化结果类型<br></code></pre></td></tr></table></figure>

<p><strong>最佳实践指南</strong></p>
<ol>
<li>类型变量命名规范：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 推荐：描述性命名</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ExtractReturn</span>&lt;T&gt; = <br>  T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; infer <span class="hljs-title class_">ReturnType</span> ? <span class="hljs-title class_">ReturnType</span> : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 避免：单字母命名</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Bad</span>&lt;T&gt; = T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">a</span>: <span class="hljs-built_in">any</span>) =&gt; infer R ? R : <span class="hljs-built_in">never</span>;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>错误处理模式：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 安全提取模式</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">SafeExtract</span>&lt;T, <span class="hljs-title class_">Fallback</span> = <span class="hljs-built_in">never</span>&gt; = <br>  T <span class="hljs-keyword">extends</span> &#123; [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: infer V &#125; ? V : <span class="hljs-title class_">Fallback</span>;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Value</span> = <span class="hljs-title class_">SafeExtract</span>&lt;<span class="hljs-built_in">string</span>&gt;; <span class="hljs-comment">// never</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>复杂类型分解：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 分解复杂提取逻辑</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Step1</span>&lt;T&gt; = <span class="hljs-comment">/* ... */</span>;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Step2</span>&lt;T&gt; = <span class="hljs-title class_">Step1</span>&lt;T&gt; <span class="hljs-keyword">extends</span> infer U ? <span class="hljs-comment">/* ... */</span> : <span class="hljs-built_in">never</span>;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Final</span>&lt;T&gt; = <span class="hljs-title class_">Step2</span>&lt;T&gt; <span class="hljs-keyword">extends</span> infer V ? <span class="hljs-comment">/* ... */</span> : <span class="hljs-built_in">never</span>;<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>类型测试策略：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 使用类型断言验证</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Assert</span>&lt;T, <span class="hljs-title class_">Expected</span>&gt; = <br>  T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Expected</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;<br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Test1</span> = <span class="hljs-title class_">Assert</span>&lt;<span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">string</span>&gt;, <span class="hljs-built_in">string</span>&gt;; <span class="hljs-comment">// true</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Test2</span> = <span class="hljs-title class_">Assert</span>&lt;<span class="hljs-title class_">FirstParam</span>&lt;<span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>&gt;, <span class="hljs-built_in">string</span>&gt;; <span class="hljs-comment">// false</span><br></code></pre></td></tr></table></figure>

<p><strong>infer 类型关系图</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs text">infer 应用体系<br>├─ 基础提取<br>│  ├─ 函数返回值 → ReturnType<br>│  ├─ 函数参数 → Parameters<br>│  └─ 数组元素 → ArrayElement<br>│<br>├─ 模式匹配<br>│  ├─ 字符串模板 → ExtractVariable<br>│  ├─ 对象结构 → ValueOfKey<br>│  └─ 条件分支 → ExtractByType<br>│<br>└─ 高级体操<br>   ├─ 元组转换 → MapTuple<br>   ├─ 柯里化 → Curry<br>   └─ 递归展开 → Expand<br></code></pre></td></tr></table></figure>

<h2 id="2-2-类型体操实战"><a href="#2-2-类型体操实战" class="headerlink" title="2.2 类型体操实战"></a>2.2 类型体操实战</h2><h3 id="2-2-1-函数柯里化类型定义"><a href="#2-2-1-函数柯里化类型定义" class="headerlink" title="2.2.1 函数柯里化类型定义"></a>2.2.1 函数柯里化类型定义</h3><p><strong>柯里化核心概念</strong></p>
<ul>
<li>柯里化（Currying）：将多参数函数转化为一系列单参数函数的过程</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 原始函数</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">c</span>: <span class="hljs-built_in">number</span></span>) =&gt; a + b + c;<br><br><span class="hljs-comment">// 柯里化后</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">curriedAdd</span> = (<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span></span>) =&gt; <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">c</span>: <span class="hljs-built_in">number</span></span>) =&gt;</span> a + b + c;<br></code></pre></td></tr></table></figure>

<ul>
<li>类型挑战：<ul>
<li>动态推导剩余参数类型</li>
<li>处理参数数量不确定的情况</li>
<li>保持返回函数的链式调用类型安全</li>
</ul>
</li>
</ul>
<p><strong>基础柯里化类型实现</strong></p>
<p>场景1：固定参数长度的柯里化</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Curry1</span>&lt;T&gt; = T <span class="hljs-title function_">extends</span> (<span class="hljs-attr">a</span>: infer A) =&gt; infer R ? <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">a</span>: A</span>) =&gt;</span> R : <span class="hljs-built_in">never</span>;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Curry2</span>&lt;T&gt; = T <span class="hljs-title function_">extends</span> (<span class="hljs-attr">a</span>: infer A, <span class="hljs-attr">b</span>: infer B) =&gt; infer R <br>  ? <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">a</span>: A</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">b</span>: B</span>) =&gt;</span> R <br>  : <span class="hljs-built_in">never</span>;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Curry3</span>&lt;T&gt; = T <span class="hljs-title function_">extends</span> (<span class="hljs-attr">a</span>: infer A, <span class="hljs-attr">b</span>: infer B, <span class="hljs-attr">c</span>: infer C) =&gt; infer R <br>  ? <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">a</span>: A</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">b</span>: B</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">c</span>: C</span>) =&gt;</span> R <br>  : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 使用示例</span><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> curry&lt;T&gt;(<span class="hljs-attr">fn</span>: T): <br>  T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">any</span> ? <span class="hljs-title class_">Curry3</span>&lt;T&gt; : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-keyword">const</span> curriedAdd = <span class="hljs-title function_">curry</span>(add); <span class="hljs-comment">// 类型: (a: number) =&gt; (b: number) =&gt; (c: number) =&gt; number</span><br></code></pre></td></tr></table></figure>

<p>场景2：动态参数长度的柯里化</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Curry</span>&lt;F&gt; = F <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: infer <span class="hljs-title class_">Args</span>) =&gt; infer <span class="hljs-title class_">Return</span><br>  ? <span class="hljs-title class_">Args</span> <span class="hljs-keyword">extends</span> [infer <span class="hljs-title class_">First</span>, ...infer <span class="hljs-title class_">Rest</span>]<br>    ? <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">arg</span>: <span class="hljs-title class_">First</span></span>) =&gt;</span> <span class="hljs-title class_">Curry</span>&lt;<span class="hljs-function">(<span class="hljs-params">...<span class="hljs-attr">args</span>: <span class="hljs-title class_">Rest</span></span>) =&gt;</span> <span class="hljs-title class_">Return</span>&gt;<br>    : <span class="hljs-title class_">Return</span> <span class="hljs-comment">// 终止条件：无剩余参数</span><br>  : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 使用示例</span><br><span class="hljs-keyword">const</span> dynamicCurry = &lt;F <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">any</span>&gt;(<span class="hljs-attr">fn</span>: F): <span class="hljs-title class_">Curry</span>&lt;F&gt; =&gt; &#123;<br>  <span class="hljs-comment">// 实现略...</span><br>&#125;;<br><br><span class="hljs-keyword">const</span> curried = <span class="hljs-title function_">dynamicCurry</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">c</span>: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> &#123;&#125;);<br><span class="hljs-comment">// 类型: (arg: string) =&gt; (arg: number) =&gt; (arg: boolean) =&gt; void</span><br></code></pre></td></tr></table></figure>

<p><strong>高级柯里化类型技巧</strong></p>
<p>技巧1：支持部分应用（Partial Application）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">PartialCurry</span>&lt;F&gt; = F <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: infer <span class="hljs-title class_">Args</span>) =&gt; infer R<br>  ? &lt;P <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">Args</span>&gt;&gt;<span class="hljs-function">(<span class="hljs-params">...<span class="hljs-attr">args</span>: P</span>) =&gt;</span> <br>      <span class="hljs-title class_">Args</span> <span class="hljs-keyword">extends</span> [...<span class="hljs-title class_">SameLength</span>&lt;P&gt;, ...infer <span class="hljs-title class_">Rest</span>] <br>        ? <span class="hljs-title class_">Rest</span> <span class="hljs-keyword">extends</span> [] <br>          ? R <br>          : <span class="hljs-title class_">PartialCurry</span>&lt;<span class="hljs-function">(<span class="hljs-params">...<span class="hljs-attr">args</span>: <span class="hljs-title class_">Rest</span></span>) =&gt;</span> R&gt;<br>        : <span class="hljs-built_in">never</span><br>  : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 使用示例</span><br><span class="hljs-keyword">const</span> partialAdd = <span class="hljs-title function_">dynamicCurry</span>(add);<br><span class="hljs-keyword">const</span> add10 = <span class="hljs-title function_">partialAdd</span>(<span class="hljs-number">10</span>); <span class="hljs-comment">// 类型: (b: number) =&gt; (c: number) =&gt; number</span><br></code></pre></td></tr></table></figure>

<p>技巧2：占位符支持（Placeholder）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> _ = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">&#x27;placeholder&#x27;</span>);<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Placeholder</span> = <span class="hljs-keyword">typeof</span> _;<br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">CurryWithPlaceholder</span>&lt;F, <span class="hljs-title class_">Original</span> = F&gt; = <br>  F <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: infer <span class="hljs-title class_">Args</span>) =&gt; infer R<br>    ? &lt;P <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CurryArgs</span>&lt;<span class="hljs-title class_">Args</span>&gt;&gt;<span class="hljs-function">(<span class="hljs-params">...<span class="hljs-attr">args</span>: P</span>) =&gt;</span> <br>        <span class="hljs-title class_">IsComplete</span>&lt;P, <span class="hljs-title class_">Args</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-literal">true</span> <br>          ? R <br>          : <span class="hljs-title class_">CurryWithPlaceholder</span>&lt;<span class="hljs-function">(<span class="hljs-params">...<span class="hljs-attr">args</span>: <span class="hljs-title class_">Remaining</span>&lt;P, <span class="hljs-title class_">Args</span>&gt;</span>) =&gt;</span> R, <span class="hljs-title class_">Original</span>&gt;<br>    : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 完整实现需定义辅助类型：</span><br><span class="hljs-comment">// - CurryArgs：处理占位符的参数类型</span><br><span class="hljs-comment">// - Remaining：计算剩余参数</span><br><span class="hljs-comment">// - IsComplete：检查参数是否完整</span><br></code></pre></td></tr></table></figure>

<p><strong>工程实践与边界处理</strong></p>
<p>边界情况处理方案：</p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">解决方案</th>
</tr>
</thead>
<tbody><tr>
<td align="left">空参数调用</td>
<td align="left">返回原始函数</td>
</tr>
<tr>
<td align="left">参数数量超过原函数</td>
<td align="left">编译时报错</td>
</tr>
<tr>
<td align="left">混合类型参数</td>
<td align="left">使用泛型约束保持类型安全</td>
</tr>
<tr>
<td align="left">可选参数处理</td>
<td align="left">使用条件类型判断参数是否必须</td>
</tr>
</tbody></table>
<p>性能优化：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 避免深层递归（限制参数最大数量）</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">MaxParams</span> = <span class="hljs-number">8</span>; <span class="hljs-comment">// 根据实际需求设定</span><br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">SafeCurry</span>&lt;F, <span class="hljs-title class_">Depth</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>&gt; = <br>  <span class="hljs-title class_">Depth</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MaxParams</span> <br>    ? F <span class="hljs-comment">// 达到深度限制时终止</span><br>    : F <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: infer <span class="hljs-title class_">Args</span>) =&gt; infer R<br>      ? <span class="hljs-title class_">Args</span> <span class="hljs-keyword">extends</span> [infer <span class="hljs-title class_">First</span>, ...infer <span class="hljs-title class_">Rest</span>]<br>        ? <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">arg</span>: <span class="hljs-title class_">First</span></span>) =&gt;</span> <span class="hljs-title class_">SafeCurry</span>&lt;<span class="hljs-function">(<span class="hljs-params">...<span class="hljs-attr">args</span>: <span class="hljs-title class_">Rest</span></span>) =&gt;</span> R, <span class="hljs-title class_">Add</span>&lt;<span class="hljs-title class_">Depth</span>, <span class="hljs-number">1</span>&gt;&gt;<br>        : R<br>      : <span class="hljs-built_in">never</span>;<br></code></pre></td></tr></table></figure>

<p><strong>面试级考点</strong></p>
<ul>
<li>类型递归深度限制：TypeScript 默认递归深度限制（约50层）</li>
<li>条件类型分发机制：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 联合类型在条件类型中的分发行为</span><br><span class="hljs-keyword">type</span> T = [<span class="hljs-built_in">string</span>] | [<span class="hljs-built_in">number</span>] <span class="hljs-keyword">extends</span> [infer A] ? A : <span class="hljs-built_in">never</span>;<br><span class="hljs-comment">// 结果: string | number</span><br></code></pre></td></tr></table></figure>

<ul>
<li>参数逆变问题：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> curry&lt;P <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[], R&gt;(<span class="hljs-attr">fn</span>: <span class="hljs-function">(<span class="hljs-params">...<span class="hljs-attr">args</span>: P</span>) =&gt;</span> R): <br>  &lt;A <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Partial</span>&lt;P&gt;&gt;<span class="hljs-function">(<span class="hljs-params">...<span class="hljs-attr">args</span>: A</span>) =&gt;</span> <span class="hljs-built_in">unknown</span>; <span class="hljs-comment">// 需要处理逆变</span><br></code></pre></td></tr></table></figure>

<ul>
<li>实际应用场景：<ul>
<li>Redux 的 connect 函数</li>
<li>React 的高阶组件</li>
<li>配置化表单验证链</li>
</ul>
</li>
</ul>
<h3 id="2-2-2-Promise-链式调用类型推导"><a href="#2-2-2-Promise-链式调用类型推导" class="headerlink" title="2.2.2 Promise 链式调用类型推导"></a>2.2.2 Promise 链式调用类型推导</h3><p><strong>核心类型挑战</strong></p>
<table>
<thead>
<tr>
<th align="left">问题</th>
<th align="left">类型表现</th>
<th align="left">解决方案</th>
</tr>
</thead>
<tbody><tr>
<td align="left">初始值类型丢失</td>
<td align="left"><code>Promise.resolve(42).then(v =&gt; v) → v: unknown</code></td>
<td align="left">泛型捕获初始类型</td>
</tr>
<tr>
<td align="left">链式返回值类型推导</td>
<td align="left"><code>.then(x =&gt; x.toFixed())</code> → 推导失败</td>
<td align="left">条件类型 + 函数返回值推断</td>
</tr>
<tr>
<td align="left">错误类型传递中断</td>
<td align="left"><code>.catch(e =&gt; e.message)</code> → e: any</td>
<td align="left">泛型约束错误类型</td>
</tr>
<tr>
<td align="left">同步&#x2F;异步混合链</td>
<td align="left"><code>Promise.resolve().then(() =&gt; 42)</code> → 类型断裂</td>
<td align="left">递归解包 Promise 嵌套</td>
</tr>
</tbody></table>
<p><strong>基础链式调用类型实现</strong></p>
<p>场景1：基础 Promise 类型定义</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyPromise</span>&lt;T&gt; &#123;<br>  then&lt;U&gt;(<br>    <span class="hljs-attr">onFulfilled</span>?: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">value</span>: T</span>) =&gt;</span> U | <span class="hljs-title class_">PromiseLike</span>&lt;U&gt;<br>  ): <span class="hljs-title class_">MyPromise</span>&lt;U&gt;;<br>  <br>  <span class="hljs-keyword">catch</span>&lt;U&gt;(<br>    <span class="hljs-attr">onRejected</span>?: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">reason</span>: <span class="hljs-built_in">any</span></span>) =&gt;</span> U | <span class="hljs-title class_">PromiseLike</span>&lt;U&gt;<br>  ): <span class="hljs-title class_">MyPromise</span>&lt;T | U&gt;;<br>&#125;<br><br><span class="hljs-comment">// 使用示例</span><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> createPromise&lt;T&gt;(<span class="hljs-attr">executor</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">resolve</span>: (value: T) =&gt; <span class="hljs-built_in">void</span></span>) =&gt;</span> <span class="hljs-title class_">MyPromise</span>&lt;T&gt;;<br></code></pre></td></tr></table></figure>

<p>场景2：链式返回值类型推导</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">UnwrapPromise</span>&lt;T&gt; = <br>  T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer U&gt; ? <span class="hljs-title class_">UnwrapPromise</span>&lt;U&gt; : T;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyPromise</span>&lt;T&gt; &#123;<br>  then&lt;U&gt;(<br>    <span class="hljs-attr">onFulfilled</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">value</span>: T</span>) =&gt;</span> U<br>  ): <span class="hljs-title class_">MyPromise</span>&lt;<span class="hljs-title class_">UnwrapPromise</span>&lt;U&gt;&gt;;<br>&#125;<br><br><span class="hljs-comment">// 测试</span><br><span class="hljs-keyword">const</span> chain = <span class="hljs-title function_">createPromise</span>(<span class="hljs-number">42</span>)<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> v.<span class="hljs-title function_">toFixed</span>())    <span class="hljs-comment">// v: number → string</span><br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> <span class="hljs-built_in">parseInt</span>(s));   <span class="hljs-comment">// s: string → number</span><br></code></pre></td></tr></table></figure>

<p><strong>高级链式类型技巧</strong></p>
<p>技巧1：自动解包嵌套 Promise</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">UnwrapPromise</span>&lt;T&gt; = <br>  T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer U&gt; ? <span class="hljs-title class_">UnwrapPromise</span>&lt;U&gt; : <br>  T <span class="hljs-title function_">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-title class_">Promise</span>&lt;infer V&gt; ? <span class="hljs-title class_">UnwrapPromise</span>&lt;V&gt; : <br>  T;<br><br><span class="hljs-comment">// 处理多层嵌套</span><br><span class="hljs-keyword">const</span> nested = <span class="hljs-title function_">createPromise</span>(<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">42</span>)));<br><span class="hljs-comment">// 类型: MyPromise&lt;number&gt; 而非 MyPromise&lt;Promise&lt;Promise&lt;number&gt;&gt;&gt;</span><br></code></pre></td></tr></table></figure>

<p>技巧2：错误类型约束</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyPromise</span>&lt;T, E = <span class="hljs-title class_">Error</span>&gt; &#123;<br>  <span class="hljs-keyword">catch</span>&lt;U&gt;(<br>    <span class="hljs-attr">onRejected</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">reason</span>: E</span>) =&gt;</span> U<br>  ): <span class="hljs-title class_">MyPromise</span>&lt;T | <span class="hljs-title class_">UnwrapPromise</span>&lt;U&gt;, E&gt;;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br>createPromise&lt;<span class="hljs-built_in">number</span>, <span class="hljs-title class_">RangeError</span>&gt;(...)<br>  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> e.<span class="hljs-property">message</span>)  <span class="hljs-comment">// e: RangeError → string</span><br></code></pre></td></tr></table></figure>

<p>技巧3：静态方法类型化</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPromise</span> &#123;<br>  <span class="hljs-keyword">static</span> resolve&lt;T&gt;(<span class="hljs-attr">value</span>: T): <span class="hljs-title class_">MyPromise</span>&lt;<span class="hljs-title class_">UnwrapPromise</span>&lt;T&gt;&gt;;<br>  <span class="hljs-keyword">static</span> all&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[]&gt;(<span class="hljs-attr">values</span>: [...T]): <span class="hljs-title class_">MyPromise</span>&lt;&#123;<br>    [K <span class="hljs-keyword">in</span> keyof T]: <span class="hljs-title class_">UnwrapPromise</span>&lt;T[K]&gt;<br>  &#125;&gt;;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>边界情况处理</strong></p>
<p>场景1：空 then 处理</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyPromise</span>&lt;T&gt; &#123;<br>  <span class="hljs-title function_">then</span>(): <span class="hljs-title class_">MyPromise</span>&lt;T&gt;;  <span class="hljs-comment">// 透传当前类型</span><br>  then&lt;U&gt;(<span class="hljs-attr">onFulfilled</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">onRejected</span>?: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">reason</span>: <span class="hljs-built_in">any</span></span>) =&gt;</span> U): <span class="hljs-title class_">MyPromise</span>&lt;T | U&gt;;<br>&#125;<br><br><span class="hljs-comment">// 示例</span><br><span class="hljs-title function_">createPromise</span>(<span class="hljs-number">42</span>)<br>  .<span class="hljs-title function_">then</span>()                <span class="hljs-comment">// 类型仍为 MyPromise&lt;number&gt;</span><br>  .<span class="hljs-title function_">then</span>(<span class="hljs-literal">null</span>, <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;&#125;);  <span class="hljs-comment">// 跳过成功回调</span><br></code></pre></td></tr></table></figure>

<p>场景2：混合同步&#x2F;异步返回值</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">AsyncValue</span>&lt;T&gt; = T | <span class="hljs-title class_">PromiseLike</span>&lt;T&gt;;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">UnwrapAsync</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PromiseLike</span>&lt;infer U&gt; ? U : T;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyPromise</span>&lt;T&gt; &#123;<br>  then&lt;U&gt;(<br>    <span class="hljs-attr">onFulfilled</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">value</span>: T</span>) =&gt;</span> <span class="hljs-title class_">AsyncValue</span>&lt;U&gt;<br>  ): <span class="hljs-title class_">MyPromise</span>&lt;<span class="hljs-title class_">UnwrapAsync</span>&lt;U&gt;&gt;;<br>&#125;<br><br><span class="hljs-comment">// 处理同步返回值</span><br><span class="hljs-title function_">createPromise</span>(<span class="hljs-number">42</span>)<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> v * <span class="hljs-number">2</span>)      <span class="hljs-comment">// 同步返回 number → MyPromise&lt;number&gt;</span><br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">String</span>(v))); <span class="hljs-comment">// 异步返回 → MyPromise&lt;string&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>工程实践与面试考点</strong></p>
<p>Promise 组合模式：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 1. race 类型实现</span><br><span class="hljs-keyword">static</span> race&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[]&gt;(<span class="hljs-attr">values</span>: T): <span class="hljs-title class_">MyPromise</span>&lt;<span class="hljs-title class_">UnwrapPromise</span>&lt;T[<span class="hljs-built_in">number</span>]&gt;&gt;;<br><br><span class="hljs-comment">// 2. 顺序执行链</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">tasks</span>: (<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">number</span>&gt;)[] = [...];<br>tasks.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">chain, task</span>) =&gt;</span> <br>  chain.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">task</span>()), <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()<br>);<br></code></pre></td></tr></table></figure>

<p>性能优化：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 避免深层递归类型 (设置最大解包深度)</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">UnwrapPromiseDeep</span>&lt;T, <span class="hljs-title class_">Depth</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">number</span> = <span class="hljs-number">5</span>&gt; = <br>  <span class="hljs-title class_">Depth</span> <span class="hljs-keyword">extends</span> <span class="hljs-number">0</span> ? T :<br>  T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer U&gt; <br>    ? <span class="hljs-title class_">UnwrapPromiseDeep</span>&lt;U, <span class="hljs-title class_">Subtract</span>&lt;<span class="hljs-title class_">Depth</span>, <span class="hljs-number">1</span>&gt;&gt; <br>    : T;<br></code></pre></td></tr></table></figure>

<p>终极挑战：实现 async&#x2F;await 类型推导</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 模拟 async 函数返回类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">AsyncFunction</span>&lt;T&gt; = <span class="hljs-function">(<span class="hljs-params">...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> <span class="hljs-title class_">MyPromise</span>&lt;T&gt;;<br><br><span class="hljs-comment">// 模拟 await 类型推导</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Awaited</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MyPromise</span>&lt;infer U&gt; ? <span class="hljs-title class_">Awaited</span>&lt;U&gt; : T;<br><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> runAsync&lt;F <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AsyncFunction</span>&lt;<span class="hljs-built_in">any</span>&gt;&gt;(<span class="hljs-attr">fn</span>: F): <br>  <span class="hljs-title class_">ReturnType</span>&lt;F&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">MyPromise</span>&lt;infer R&gt; ? R : <span class="hljs-built_in">never</span>;<br></code></pre></td></tr></table></figure>

<p>面试问题示例：</p>
<p>Q：为什么 <code>Promise&lt;Promise&lt;number&gt;&gt;</code> 会自动扁平化为 <code>Promise&lt;number&gt;</code>？</p>
<p>A：由 then 方法的类型定义决定：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Promise</span>&lt;T&gt; &#123;<br>  then&lt;<span class="hljs-title class_">TResult</span>&gt;(<br>    <span class="hljs-attr">onfulfilled</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">value</span>: T</span>) =&gt;</span> <span class="hljs-title class_">TResult</span> | <span class="hljs-title class_">PromiseLike</span>&lt;<span class="hljs-title class_">TResult</span>&gt;<br>  ): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">TResult</span>&gt;;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>当 T 本身是 <code>Promise&lt;U&gt;</code> 时，value: T 实际接收 <code>Promise&lt;U&gt;</code>，但返回 <code>TResult | PromiseLike&lt;TResult&gt;</code> 会被再次包装为 <code>Promise&lt;TResult&gt;</code>，形成递归解包效果。</p>
<h3 id="2-2-3-Redux-reducer-类型安全实现"><a href="#2-2-3-Redux-reducer-类型安全实现" class="headerlink" title="2.2.3 Redux reducer 类型安全实现"></a>2.2.3 Redux reducer 类型安全实现</h3><p><strong>核心类型架构</strong></p>
<p>Redux 类型四要素：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 1. 状态类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">State</span> = &#123;<br>  <span class="hljs-attr">counter</span>: <span class="hljs-built_in">number</span>;<br>  <span class="hljs-attr">todos</span>: &#123; <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span> &#125;[];<br>&#125;;<br><br><span class="hljs-comment">// 2. Action 类型（联合类型）</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Action</span> = <br>  | &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;INCREMENT&#x27;</span>; <span class="hljs-attr">payload</span>: <span class="hljs-built_in">number</span> &#125;<br>  | &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;ADD_TODO&#x27;</span>; <span class="hljs-attr">payload</span>: <span class="hljs-built_in">string</span> &#125;<br>  | &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;TOGGLE_TODO&#x27;</span>; <span class="hljs-attr">payload</span>: <span class="hljs-built_in">string</span> &#125;;<br><br><span class="hljs-comment">// 3. Reducer 函数签名</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Reducer</span>&lt;S&gt; = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">state</span>: S, <span class="hljs-attr">action</span>: <span class="hljs-title class_">Action</span></span>) =&gt;</span> S;<br><br><span class="hljs-comment">// 4. Dispatch 类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Dispatch</span> = <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">action</span>: <span class="hljs-title class_">Action</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;<br></code></pre></td></tr></table></figure>

<p><strong>类型安全 reducer 实现</strong></p>
<p>基础实现：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> <span class="hljs-attr">reducer</span>: <span class="hljs-title class_">Reducer</span>&lt;<span class="hljs-title class_">State</span>&gt; = <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;INCREMENT&#x27;</span>:<br>      <span class="hljs-comment">// ✅ 自动推断 payload 为 number</span><br>      <span class="hljs-keyword">return</span> &#123; ...state, <span class="hljs-attr">counter</span>: state.<span class="hljs-property">counter</span> + action.<span class="hljs-property">payload</span> &#125;;<br>    <br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;ADD_TODO&#x27;</span>:<br>      <span class="hljs-comment">// ✅ 自动推断 payload 为 string</span><br>      <span class="hljs-keyword">const</span> newTodo = &#123; <br>        <span class="hljs-attr">id</span>: <span class="hljs-title function_">nanoid</span>(), <br>        <span class="hljs-attr">text</span>: action.<span class="hljs-property">payload</span>, <br>        <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span> <br>      &#125;;<br>      <span class="hljs-keyword">return</span> &#123; ...state, <span class="hljs-attr">todos</span>: [...state.<span class="hljs-property">todos</span>, newTodo] &#125;;<br>    <br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;TOGGLE_TODO&#x27;</span>:<br>      <span class="hljs-comment">// ✅ 自动推断 payload 为 string</span><br>      <span class="hljs-keyword">return</span> &#123;<br>        ...state,<br>        <span class="hljs-attr">todos</span>: state.<span class="hljs-property">todos</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> <br>          todo.<span class="hljs-property">id</span> === action.<span class="hljs-property">payload</span> <br>            ? &#123; ...todo, <span class="hljs-attr">completed</span>: !todo.<span class="hljs-property">completed</span> &#125; <br>            : todo<br>        )<br>      &#125;;<br>    <br>    <span class="hljs-attr">default</span>:<br>      <span class="hljs-comment">// ❌ 捕获未处理 action</span><br>      <span class="hljs-keyword">const</span> <span class="hljs-attr">_exhaustiveCheck</span>: <span class="hljs-built_in">never</span> = action;<br>      <span class="hljs-keyword">return</span> state;<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>高级模式：类型生成器</strong></p>
<p>自动创建类型安全 action：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// Action 创建函数工厂</span><br><span class="hljs-keyword">function</span> createAction&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>, P&gt;(<span class="hljs-attr">type</span>: T) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">payload</span>: P</span>) =&gt;</span> (&#123; <span class="hljs-keyword">type</span>, payload &#125;);<br>&#125;<br><br><span class="hljs-comment">// 使用示例</span><br><span class="hljs-keyword">const</span> increment = <span class="hljs-title function_">createAction</span>(<span class="hljs-string">&#x27;INCREMENT&#x27;</span>, <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">amount</span>: <span class="hljs-built_in">number</span></span>) =&gt;</span> amount);<br><span class="hljs-keyword">const</span> addTodo = <span class="hljs-title function_">createAction</span>(<span class="hljs-string">&#x27;ADD_TODO&#x27;</span>, <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span></span>) =&gt;</span> text);<br><br><span class="hljs-comment">// 自动生成 Action 类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Actions</span> = <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-keyword">typeof</span> increment&gt; | <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-keyword">typeof</span> addTodo&gt;;<br></code></pre></td></tr></table></figure>

<p>类型安全 reducer 生成器：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ActionMap</span> = &#123;<br>  <span class="hljs-attr">INCREMENT</span>: <span class="hljs-built_in">number</span>;<br>  <span class="hljs-attr">ADD_TODO</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">TOGGLE_TODO</span>: <span class="hljs-built_in">string</span>;<br>&#125;;<br><br><span class="hljs-keyword">function</span> createReducer&lt;S, A <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;&gt;(<br>  <span class="hljs-attr">initialState</span>: S,<br>  <span class="hljs-attr">handlers</span>: &#123;<br>    [K <span class="hljs-keyword">in</span> keyof A]: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">state</span>: S, <span class="hljs-attr">payload</span>: A[K]</span>) =&gt;</span> S<br>  &#125;<br>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">state</span>: S = initialState, <span class="hljs-attr">action</span>: &#123; </span></span><br><span class="hljs-params"><span class="hljs-function">    [K <span class="hljs-keyword">in</span> keyof A]: &#123; <span class="hljs-keyword">type</span>: K; payload: A[K] &#125; </span></span><br><span class="hljs-params"><span class="hljs-function">  &#125;[keyof A]</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (handlers[action.<span class="hljs-property">type</span>]) &#123;<br>      <span class="hljs-keyword">return</span> handlers[action.<span class="hljs-property">type</span>](state, action.<span class="hljs-property">payload</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> state;<br>  &#125;;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> reducer = createReducer&lt;<span class="hljs-title class_">State</span>, <span class="hljs-title class_">ActionMap</span>&gt;(initialState, &#123;<br>  <span class="hljs-attr">INCREMENT</span>: <span class="hljs-function">(<span class="hljs-params">state, payload</span>) =&gt;</span> (&#123; ...state, <span class="hljs-attr">counter</span>: state.<span class="hljs-property">counter</span> + payload &#125;),<br>  <span class="hljs-attr">ADD_TODO</span>: <span class="hljs-function">(<span class="hljs-params">state, text</span>) =&gt;</span> (&#123; ...state, <span class="hljs-attr">todos</span>: [...state.<span class="hljs-property">todos</span>, &#123; <span class="hljs-attr">id</span>: <span class="hljs-title function_">nanoid</span>(), text &#125;] &#125;)<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>Redux Toolkit 集成</strong></p>
<p>现代 Redux 类型安全实践：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; createSlice, <span class="hljs-title class_">PayloadAction</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@reduxjs/toolkit&#x27;</span>;<br><br><span class="hljs-keyword">const</span> todosSlice = <span class="hljs-title function_">createSlice</span>(&#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;todos&#x27;</span>,<br>  <span class="hljs-attr">initialState</span>: [] <span class="hljs-keyword">as</span> <span class="hljs-title class_">Todo</span>[],<br>  <span class="hljs-attr">reducers</span>: &#123;<br>    <span class="hljs-attr">addTodo</span>: &#123;<br>      <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">state, <span class="hljs-attr">action</span>: <span class="hljs-title class_">PayloadAction</span>&lt;<span class="hljs-title class_">Todo</span>&gt;</span>) =&gt;</span> &#123;<br>        state.<span class="hljs-title function_">push</span>(action.<span class="hljs-property">payload</span>);<br>      &#125;,<br>      <span class="hljs-attr">prepare</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span></span>) =&gt;</span> (&#123;<br>        <span class="hljs-attr">payload</span>: &#123; <span class="hljs-attr">id</span>: <span class="hljs-title function_">nanoid</span>(), text, <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span> &#125;<br>      &#125;)<br>    &#125;,<br>    <span class="hljs-attr">toggleTodo</span>: <span class="hljs-function">(<span class="hljs-params">state, <span class="hljs-attr">action</span>: <span class="hljs-title class_">PayloadAction</span>&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> todo = state.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">id</span> === action.<span class="hljs-property">payload</span>);<br>      <span class="hljs-keyword">if</span> (todo) todo.<span class="hljs-property">completed</span> = !todo.<span class="hljs-property">completed</span>;<br>    &#125;<br>  &#125;<br>&#125;);<br><br><span class="hljs-comment">// 自动生成 Action 类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">TodosAction</span> = <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-keyword">typeof</span> todosSlice.<span class="hljs-property">actions</span>.<span class="hljs-property">addTodo</span>&gt; <br>  | <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-keyword">typeof</span> todosSlice.<span class="hljs-property">actions</span>.<span class="hljs-property">toggleTodo</span>&gt;;<br></code></pre></td></tr></table></figure>

<p><strong>复杂场景处理</strong></p>
<p>异步 Action 类型：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ThunkAction</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;redux-thunk&#x27;</span>;<br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">AppThunk</span>&lt;<span class="hljs-title class_">ReturnType</span> = <span class="hljs-built_in">void</span>&gt; = <span class="hljs-title class_">ThunkAction</span>&lt;<br>  <span class="hljs-title class_">ReturnType</span>,<br>  <span class="hljs-title class_">State</span>,<br>  <span class="hljs-built_in">unknown</span>,<br>  <span class="hljs-title class_">Action</span><br>&gt;;<br><br><span class="hljs-keyword">const</span> fetchTodos = (): <span class="hljs-function"><span class="hljs-params">AppThunk</span> =&gt;</span> <span class="hljs-keyword">async</span> dispatch =&gt; &#123;<br>  <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;FETCH_TODOS_REQUEST&#x27;</span> &#125;);<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">const</span> todos = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">getTodos</span>();<br>    <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;FETCH_TODOS_SUCCESS&#x27;</span>, <span class="hljs-attr">payload</span>: todos &#125;);<br>  &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;FETCH_TODOS_FAILURE&#x27;</span>, <span class="hljs-attr">payload</span>: error.<span class="hljs-property">message</span> &#125;);<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>Reducer 组合类型：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">CombinedState</span> = &#123;<br>  <span class="hljs-attr">todos</span>: <span class="hljs-title class_">TodoState</span>;<br>  <span class="hljs-attr">user</span>: <span class="hljs-title class_">UserState</span>;<br>&#125;;<br><br><span class="hljs-comment">// 类型安全的 combineReducers</span><br><span class="hljs-keyword">function</span> combineTypedReducers&lt;M&gt;(<span class="hljs-attr">reducers</span>: M): <span class="hljs-title class_">Reducer</span>&lt;&#123;<br>  [K <span class="hljs-keyword">in</span> keyof M]: M[K] <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Reducer</span>&lt;infer S&gt; ? S : <span class="hljs-built_in">never</span><br>&#125;&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">state, action</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> newState = &#123;&#125; <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> reducers) &#123;<br>      newState[key] = reducers[key](state?.[key], action);<br>    &#125;<br>    <span class="hljs-keyword">return</span> newState;<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>边界处理与优化</strong></p>
<table>
<thead>
<tr>
<th align="left">边界情况</th>
<th align="left">解决方案</th>
</tr>
</thead>
<tbody><tr>
<td align="left">空 action 处理</td>
<td align="left">使用 never 类型进行穷尽检查</td>
</tr>
<tr>
<td align="left">嵌套状态更新</td>
<td align="left">使用 Immer 库进行可变写法</td>
</tr>
<tr>
<td align="left">历史状态类型</td>
<td align="left">添加 undoable reducer 类型扩展</td>
</tr>
<tr>
<td align="left">动态 reducer 注册</td>
<td align="left">类型安全的 injectReducer 模式</td>
</tr>
</tbody></table>
<p>性能优化：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 1. 避免深层嵌套状态</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">State</span> = &#123;<br>  <span class="hljs-comment">// ❌ 避免</span><br>  <span class="hljs-attr">deep</span>: &#123; <span class="hljs-attr">a</span>: &#123; <span class="hljs-attr">b</span>: &#123; <span class="hljs-attr">c</span>: <span class="hljs-built_in">number</span> &#125; &#125; &#125;;<br>  <span class="hljs-comment">// ✅ 推荐</span><br>  <span class="hljs-attr">flat</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">FlatItem</span>&gt;;<br>&#125;;<br><br><span class="hljs-comment">// 2. 使用 Reselect 记忆化选择器</span><br><span class="hljs-keyword">import</span> &#123; createSelector &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;reselect&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">selectTodos</span> = (<span class="hljs-params"><span class="hljs-attr">state</span>: <span class="hljs-title class_">State</span></span>) =&gt; state.<span class="hljs-property">todos</span>;<br><span class="hljs-keyword">const</span> selectCompletedTodos = <span class="hljs-title function_">createSelector</span>(<br>  [selectTodos],<br>  <span class="hljs-function"><span class="hljs-params">todos</span> =&gt;</span> todos.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">completed</span>)<br>);<br></code></pre></td></tr></table></figure>

<p><strong>面试级考点</strong></p>
<ol>
<li>类型收窄原理：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 利用可辨识联合（discriminated union）</span><br><span class="hljs-keyword">if</span> (action.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;INCREMENT&#x27;</span>) &#123;<br>  <span class="hljs-comment">// 此处 action 自动收窄为 &#123; type: &#x27;INCREMENT&#x27;; payload: number &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>类型安全与性能平衡：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// ❌ 过度泛化</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Action</span>&lt;T = <span class="hljs-built_in">any</span>&gt; = &#123; <span class="hljs-attr">type</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">payload</span>: T &#125;;<br><br><span class="hljs-comment">// ✅ 精确控制</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">StrictAction</span> = &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;A&#x27;</span>; <span class="hljs-attr">payload</span>: <span class="hljs-built_in">number</span> &#125; | &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;B&#x27;</span>; <span class="hljs-attr">payload</span>: <span class="hljs-built_in">string</span> &#125;;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>Redux 中间件类型：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MiddlewareAPI</span>&lt;D <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Dispatch</span>, S&gt; &#123;<br>  <span class="hljs-attr">dispatch</span>: D;<br>  <span class="hljs-title function_">getState</span>(): S;<br>&#125;<br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Middleware</span> = &lt;S&gt;<span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">api</span>: <span class="hljs-title class_">MiddlewareAPI</span>&lt;<span class="hljs-title class_">Dispatch</span>, S&gt;</span>) =&gt;</span> <br>  <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">next</span>: <span class="hljs-title class_">Dispatch</span></span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">action</span>: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">any</span>;<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>时间旅行调试类型：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">TimeTravelState</span> = &#123;<br>  <span class="hljs-attr">past</span>: <span class="hljs-title class_">State</span>[];<br>  <span class="hljs-attr">present</span>: <span class="hljs-title class_">State</span>;<br>  <span class="hljs-attr">future</span>: <span class="hljs-title class_">State</span>[];<br>&#125;;<br></code></pre></td></tr></table></figure>

<ol start="5">
<li>终极挑战：实现类型安全的 Redux-Observable</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Epic</span> = <span class="hljs-function">(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-function">  <span class="hljs-attr">action$</span>: <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-title class_">Action</span>&gt;,</span></span><br><span class="hljs-params"><span class="hljs-function">  <span class="hljs-attr">state$</span>: <span class="hljs-title class_">StateObservable</span>&lt;<span class="hljs-title class_">State</span>&gt;</span></span><br><span class="hljs-params"><span class="hljs-function"></span>) =&gt;</span> <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-title class_">Action</span>&gt;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">fetchEpic</span>: <span class="hljs-title class_">Epic</span> = <span class="hljs-function">(<span class="hljs-params">action$, state$</span>) =&gt;</span> <br>  action$.<span class="hljs-title function_">pipe</span>(<br>    <span class="hljs-title function_">ofType</span>(<span class="hljs-string">&#x27;FETCH_REQUEST&#x27;</span>),<br>    <span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">action</span> =&gt;</span> <br>      <span class="hljs-title function_">from</span>(api.<span class="hljs-title function_">fetchData</span>(action.<span class="hljs-property">payload</span>)).<span class="hljs-title function_">pipe</span>(<br>        <span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> (&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;FETCH_SUCCESS&#x27;</span>, <span class="hljs-attr">payload</span>: response &#125;)),<br>        <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-title function_">of</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;FETCH_ERROR&#x27;</span>, <span class="hljs-attr">payload</span>: error &#125;))<br>    )<br>  );<br></code></pre></td></tr></table></figure>

<h3 id="2-2-4-路由参数自动类型推导"><a href="#2-2-4-路由参数自动类型推导" class="headerlink" title="2.2.4 路由参数自动类型推导"></a>2.2.4 路由参数自动类型推导</h3><p><strong>核心挑战</strong></p>
<ol>
<li>路径解析：将字符串路径（如 &#x2F;user&#x2F;:id&#x2F;posts&#x2F;:postId）转换为类型结构</li>
<li>参数提取：识别动态段（:param）和可选段（?）</li>
<li>类型转换：将参数名映射为对象键（{ id: string; postId: string }）</li>
<li>嵌套路由：支持多层路由参数合并</li>
</ol>
<p><strong>基础路径参数推导</strong></p>
<p>场景1：提取单一路径参数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ExtractParam</span>&lt;<span class="hljs-title class_">Path</span>&gt; = <br>  <span class="hljs-title class_">Path</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">string</span>&#125;</span>:<span class="hljs-subst">$&#123;infer Param&#125;</span>/<span class="hljs-subst">$&#123;infer Rest&#125;</span>`</span><br>    ? <span class="hljs-title class_">Param</span> | <span class="hljs-title class_">ExtractParam</span>&lt;<span class="hljs-title class_">Rest</span>&gt;<br>    : <span class="hljs-title class_">Path</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">string</span>&#125;</span>:<span class="hljs-subst">$&#123;infer Param&#125;</span>`</span><br>      ? <span class="hljs-title class_">Param</span><br>      : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Test1</span> = <span class="hljs-title class_">ExtractParam</span>&lt;<span class="hljs-string">&#x27;/user/:id&#x27;</span>&gt;;  <span class="hljs-comment">// &quot;id&quot;</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Test2</span> = <span class="hljs-title class_">ExtractParam</span>&lt;<span class="hljs-string">&#x27;/post/:postId/comment/:commentId&#x27;</span>&gt;;  <span class="hljs-comment">// &quot;postId&quot; | &quot;commentId&quot;</span><br></code></pre></td></tr></table></figure>

<p>场景2：转换为参数对象类型</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">PathParams</span>&lt;<span class="hljs-title class_">Path</span>&gt; = &#123;<br>  [K <span class="hljs-keyword">in</span> <span class="hljs-title class_">ExtractParam</span>&lt;<span class="hljs-title class_">Path</span>&gt;]: <span class="hljs-built_in">string</span>;<br>&#125;;<br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Params1</span> = <span class="hljs-title class_">PathParams</span>&lt;<span class="hljs-string">&#x27;/user/:id&#x27;</span>&gt;;  <span class="hljs-comment">// &#123; id: string &#125;</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Params2</span> = <span class="hljs-title class_">PathParams</span>&lt;<span class="hljs-string">&#x27;/category/:categoryId/product/:productId&#x27;</span>&gt;; <br><span class="hljs-comment">// &#123; categoryId: string; productId: string &#125;</span><br></code></pre></td></tr></table></figure>

<p><strong>高级路由特性实现</strong></p>
<p>特性1：可选参数（?）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ExtractOptionalParam</span>&lt;<span class="hljs-title class_">Path</span>&gt; =<br>  <span class="hljs-title class_">Path</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">string</span>&#125;</span>:<span class="hljs-subst">$&#123;infer Param&#125;</span>?/<span class="hljs-subst">$&#123;infer Rest&#125;</span>`</span><br>    ? <span class="hljs-title class_">Param</span> | <span class="hljs-title class_">ExtractOptionalParam</span>&lt;<span class="hljs-title class_">Rest</span>&gt;<br>    : <span class="hljs-title class_">Path</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">string</span>&#125;</span>:<span class="hljs-subst">$&#123;infer Param&#125;</span>?`</span><br>      ? <span class="hljs-title class_">Param</span><br>      : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">PathParams</span>&lt;<span class="hljs-title class_">Path</span>&gt; = &#123;<br>  [K <span class="hljs-keyword">in</span> <span class="hljs-title class_">ExtractParam</span>&lt;<span class="hljs-title class_">Path</span>&gt;]: <span class="hljs-built_in">string</span>;<br>&#125; &amp; &#123;<br>  [K <span class="hljs-keyword">in</span> <span class="hljs-title class_">ExtractOptionalParam</span>&lt;<span class="hljs-title class_">Path</span>&gt;]?: <span class="hljs-built_in">string</span>;<br>&#125;;<br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Params3</span> = <span class="hljs-title class_">PathParams</span>&lt;<span class="hljs-string">&#x27;/search/:query?&#x27;</span>&gt;;  <span class="hljs-comment">// &#123; query?: string &#125;</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Params4</span> = <span class="hljs-title class_">PathParams</span>&lt;<span class="hljs-string">&#x27;/user/:id/profile/:tab?&#x27;</span>&gt;; <br><span class="hljs-comment">// &#123; id: string; tab?: string &#125;</span><br></code></pre></td></tr></table></figure>

<p>特性2：通配符匹配（*）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ExtractWildcard</span>&lt;<span class="hljs-title class_">Path</span>&gt; =<br>  <span class="hljs-title class_">Path</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">string</span>&#125;</span>*<span class="hljs-subst">$&#123;infer Rest&#125;</span>`</span><br>    ? <span class="hljs-string">&#x27;wildcard&#x27;</span> | <span class="hljs-title class_">ExtractWildcard</span>&lt;<span class="hljs-title class_">Rest</span>&gt;<br>    : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">PathParams</span>&lt;<span class="hljs-title class_">Path</span>&gt; = &#123;<br>  [K <span class="hljs-keyword">in</span> <span class="hljs-title class_">ExtractParam</span>&lt;<span class="hljs-title class_">Path</span>&gt;]: <span class="hljs-built_in">string</span>;<br>&#125; &amp; &#123;<br>  [K <span class="hljs-keyword">in</span> <span class="hljs-title class_">ExtractOptionalParam</span>&lt;<span class="hljs-title class_">Path</span>&gt;]?: <span class="hljs-built_in">string</span>;<br>&#125; &amp; &#123;<br>  [K <span class="hljs-keyword">in</span> <span class="hljs-title class_">ExtractWildcard</span>&lt;<span class="hljs-title class_">Path</span>&gt;]: <span class="hljs-built_in">string</span>[];<br>&#125;;<br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Params5</span> = <span class="hljs-title class_">PathParams</span>&lt;<span class="hljs-string">&#x27;/files/*&#x27;</span>&gt;;  <span class="hljs-comment">// &#123; wildcard: string[] &#125;</span><br></code></pre></td></tr></table></figure>

<p>特性3：正则约束参数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ExtractConstrainedParam</span>&lt;<span class="hljs-title class_">Path</span>&gt; =<br>  <span class="hljs-title class_">Path</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">string</span>&#125;</span>:<span class="hljs-subst">$&#123;infer Param&#125;</span>(<span class="hljs-subst">$&#123;infer Regex&#125;</span>)/<span class="hljs-subst">$&#123;infer Rest&#125;</span>`</span><br>    ? &#123; <span class="hljs-attr">param</span>: <span class="hljs-title class_">Param</span>; <span class="hljs-attr">regex</span>: <span class="hljs-title class_">Regex</span> &#125; | <span class="hljs-title class_">ExtractConstrainedParam</span>&lt;<span class="hljs-title class_">Rest</span>&gt;<br>    : <span class="hljs-title class_">Path</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">string</span>&#125;</span>:<span class="hljs-subst">$&#123;infer Param&#125;</span>(<span class="hljs-subst">$&#123;infer Regex&#125;</span>)`</span><br>      ? &#123; <span class="hljs-attr">param</span>: <span class="hljs-title class_">Param</span>; <span class="hljs-attr">regex</span>: <span class="hljs-title class_">Regex</span> &#125;<br>      : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">MapRegexToType</span>&lt;R&gt; = <br>  R <span class="hljs-keyword">extends</span> <span class="hljs-string">&#x27;\\d+&#x27;</span> ? <span class="hljs-built_in">number</span> :<br>  R <span class="hljs-keyword">extends</span> <span class="hljs-string">&#x27;\\w+&#x27;</span> ? <span class="hljs-built_in">string</span> :<br>  <span class="hljs-built_in">string</span>;  <span class="hljs-comment">// 默认回退</span><br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">PathParams</span>&lt;<span class="hljs-title class_">Path</span>&gt; = &#123;<br>  [K <span class="hljs-keyword">in</span> <span class="hljs-title class_">ExtractParam</span>&lt;<span class="hljs-title class_">Path</span>&gt;]: <span class="hljs-built_in">string</span>;<br>&#125; &amp; &#123;<br>  [K <span class="hljs-keyword">in</span> <span class="hljs-title class_">ExtractOptionalParam</span>&lt;<span class="hljs-title class_">Path</span>&gt;]?: <span class="hljs-built_in">string</span>;<br>&#125; &amp; &#123;<br>  [K <span class="hljs-keyword">in</span> <span class="hljs-title class_">ExtractWildcard</span>&lt;<span class="hljs-title class_">Path</span>&gt;]: <span class="hljs-built_in">string</span>[];<br>&#125; &amp; &#123;<br>  [P <span class="hljs-keyword">in</span> <span class="hljs-title class_">ExtractConstrainedParam</span>&lt;<span class="hljs-title class_">Path</span>&gt; <span class="hljs-keyword">as</span> P[<span class="hljs-string">&#x27;param&#x27;</span>]]: <br>    <span class="hljs-title class_">MapRegexToType</span>&lt;P[<span class="hljs-string">&#x27;regex&#x27;</span>]&gt;;<br>&#125;;<br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Params6</span> = <span class="hljs-title class_">PathParams</span>&lt;<span class="hljs-string">&#x27;/user/:id(\\d+)&#x27;</span>&gt;;  <span class="hljs-comment">// &#123; id: number &#125;</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Params7</span> = <span class="hljs-title class_">PathParams</span>&lt;<span class="hljs-string">&#x27;/post/:slug(\\w+)&#x27;</span>&gt;; <span class="hljs-comment">// &#123; slug: string &#125;</span><br></code></pre></td></tr></table></figure>

<p><strong>React Router 集成实践</strong></p>
<p>类型安全路由组件：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; useParams &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;<br><br><span class="hljs-comment">// 创建类型安全版本</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> useTypedParams&lt;<span class="hljs-title class_">Path</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>&gt;() &#123;<br>  <span class="hljs-keyword">type</span> <span class="hljs-title class_">Params</span> = <span class="hljs-title class_">PathParams</span>&lt;<span class="hljs-title class_">Path</span>&gt;;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useParams</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">Params</span>&gt;; <span class="hljs-comment">// 可能未匹配所有参数</span><br>&#125;<br><br><span class="hljs-comment">// 在组件中使用</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">UserProfile</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> params = useTypedParams&lt;<span class="hljs-string">&#x27;/user/:id/:tab?&#x27;</span>&gt;(); <br>  <span class="hljs-comment">// params: &#123; id?: string; tab?: string &#125;</span><br>  <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>User ID: &#123;params.id || &#x27;Unknown&#x27;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>类型安全路由配置：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">RouteConfig</span>&lt;<span class="hljs-title class_">Path</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>&gt; = &#123;<br>  <span class="hljs-attr">path</span>: <span class="hljs-title class_">Path</span>;<br>  <span class="hljs-attr">element</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span>;<br>  <span class="hljs-attr">children</span>?: <span class="hljs-title class_">RouteConfig</span>&lt;<span class="hljs-built_in">any</span>&gt;[];<br>&#125;;<br><br><span class="hljs-keyword">function</span> createRoute&lt;<span class="hljs-title class_">Path</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>&gt;(<span class="hljs-attr">config</span>: <span class="hljs-title class_">RouteConfig</span>&lt;<span class="hljs-title class_">Path</span>&gt;) &#123;<br>  <span class="hljs-keyword">return</span> config;<br>&#125;<br><br><span class="hljs-keyword">const</span> routes = <span class="hljs-title function_">createRoute</span>(&#123;<br>  <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/user/:id&#x27;</span>,<br>  <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserPage</span> /&gt;</span></span>,<br>  <span class="hljs-attr">children</span>: [<br>    &#123; <br>      <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;posts/:postId&#x27;</span>,  <span class="hljs-comment">// 完整路径: /user/:id/posts/:postId</span><br>      <span class="hljs-attr">element</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">PostPage</span> /&gt;</span></span><br>    &#125;<br>  ]<br>&#125;);<br><br><span class="hljs-comment">// 自动推导参数类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">UserPageParams</span> = <span class="hljs-title class_">PathParams</span>&lt;<span class="hljs-keyword">typeof</span> routes.<span class="hljs-property">path</span>&gt;;          <span class="hljs-comment">// &#123; id: string &#125;</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">PostPageParams</span> = <span class="hljs-title class_">PathParams</span>&lt;<span class="hljs-keyword">typeof</span> routes.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>].<span class="hljs-property">path</span>&gt;; <br><span class="hljs-comment">// &#123; id: string; postId: string &#125; (包含父级参数)</span><br></code></pre></td></tr></table></figure>

<p><strong>边界处理与优化</strong></p>
<p>递归深度控制：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ExtractParam</span>&lt;<span class="hljs-title class_">Path</span>, <span class="hljs-title class_">Depth</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">number</span> = <span class="hljs-number">5</span>&gt; = <br>  <span class="hljs-title class_">Depth</span> <span class="hljs-keyword">extends</span> <span class="hljs-number">0</span> ? <span class="hljs-built_in">never</span> :<br>  <span class="hljs-title class_">Path</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">string</span>&#125;</span>:<span class="hljs-subst">$&#123;infer Param&#125;</span>/<span class="hljs-subst">$&#123;infer Rest&#125;</span>`</span><br>    ? <span class="hljs-title class_">Param</span> | <span class="hljs-title class_">ExtractParam</span>&lt;<span class="hljs-title class_">Rest</span>, <span class="hljs-title class_">Subtract</span>&lt;<span class="hljs-title class_">Depth</span>, <span class="hljs-number">1</span>&gt;&gt;<br>    : <span class="hljs-title class_">Path</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">string</span>&#125;</span>:<span class="hljs-subst">$&#123;infer Param&#125;</span>`</span><br>      ? <span class="hljs-title class_">Param</span><br>      : <span class="hljs-built_in">never</span>;<br></code></pre></td></tr></table></figure>

<p>路径冲突检测：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">DetectConflict</span>&lt;<span class="hljs-title class_">Path</span>&gt; = <br>  <span class="hljs-title class_">ExtractParam</span>&lt;<span class="hljs-title class_">Path</span>&gt; <span class="hljs-keyword">extends</span> infer P<br>    ? P <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span><br>      ? &#123; [K <span class="hljs-keyword">in</span> P]: K &#125; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;P, P&gt;<br>        ? <span class="hljs-title class_">Path</span>  <span class="hljs-comment">// 无冲突</span><br>        : <span class="hljs-built_in">never</span> <span class="hljs-comment">// 存在重复参数</span><br>      : <span class="hljs-built_in">never</span><br>    : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 使用示例</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">SafePath</span> = <span class="hljs-title class_">DetectConflict</span>&lt;<span class="hljs-string">&#x27;/user/:id/posts/:id&#x27;</span>&gt;;  <span class="hljs-comment">// never (检测到重复id)</span><br></code></pre></td></tr></table></figure>

<p><strong>面试级考点</strong></p>
<ol>
<li>模板字面量类型操作：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">SplitPath</span>&lt;P&gt; = P <span class="hljs-keyword">extends</span> <span class="hljs-string">`/<span class="hljs-subst">$&#123;infer Part&#125;</span>/<span class="hljs-subst">$&#123;infer Rest&#125;</span>`</span> <br>  ? [<span class="hljs-title class_">Part</span>, ...<span class="hljs-title class_">SplitPath</span>&lt;<span class="hljs-string">`/<span class="hljs-subst">$&#123;Rest&#125;</span>`</span>&gt;] <br>  : P <span class="hljs-keyword">extends</span> <span class="hljs-string">`/<span class="hljs-subst">$&#123;infer Part&#125;</span>`</span> <br>    ? [<span class="hljs-title class_">Part</span>] <br>    : [];<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>类型递归限制：TS 4.5+ 支持尾递归优化</li>
<li>React Router v6 类型实现：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 官方ParamKey类型定义</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ParamKey</span>&lt;<span class="hljs-title class_">TPath</span>&gt; = <span class="hljs-title class_">TPath</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;infer _&#125;</span>:<span class="hljs-subst">$&#123;infer Param&#125;</span>/<span class="hljs-subst">$&#123;infer Rest&#125;</span>`</span><br>  ? <span class="hljs-title class_">Param</span> | <span class="hljs-title class_">ParamKey</span>&lt;<span class="hljs-title class_">Rest</span>&gt;<br>  : <span class="hljs-title class_">TPath</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;infer _&#125;</span>:<span class="hljs-subst">$&#123;infer Param&#125;</span>`</span><br>    ? <span class="hljs-title class_">Param</span><br>    : <span class="hljs-built_in">never</span>;<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>Vue Router 对比：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// Vue Router的RouteRecordRaw类型</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">RouteRecordRaw</span> &#123;<br>  <span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">component</span>: <span class="hljs-title class_">Component</span>;<br>  <span class="hljs-attr">children</span>?: <span class="hljs-title class_">RouteRecordRaw</span>[];<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="5">
<li>终极挑战：实现Next.js文件路由类型</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">NextPageParams</span>&lt;<span class="hljs-title class_">Path</span>&gt; = <br>  <span class="hljs-title class_">Path</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">`pages/<span class="hljs-subst">$&#123;infer Route&#125;</span>.tsx`</span> <br>    ? <span class="hljs-title class_">PathParams</span>&lt;<span class="hljs-title class_">Route</span>&gt;<br>    : <span class="hljs-built_in">never</span>;<br><br><span class="hljs-comment">// 文件路径: pages/user/[id]/[tab].tsx</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Params</span> = <span class="hljs-title class_">NextPageParams</span>&lt;<span class="hljs-string">&#x27;pages/user/[id]/[tab].tsx&#x27;</span>&gt;; <br><span class="hljs-comment">// &#123; id: string; tab: string &#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="2-3-模板字面量类型"><a href="#2-3-模板字面量类型" class="headerlink" title="2.3 模板字面量类型"></a>2.3 模板字面量类型</h2><h3 id="2-3-1-字符串模板类型操作"><a href="#2-3-1-字符串模板类型操作" class="headerlink" title="2.3.1 字符串模板类型操作"></a>2.3.1 字符串模板类型操作</h3><h3 id="2-3-2-Uppercase-Lowercase-类型转换"><a href="#2-3-2-Uppercase-Lowercase-类型转换" class="headerlink" title="2.3.2 Uppercase&#x2F;Lowercase 类型转换"></a>2.3.2 Uppercase&#x2F;Lowercase 类型转换</h3><h3 id="2-3-3-路由路径模式匹配"><a href="#2-3-3-路由路径模式匹配" class="headerlink" title="2.3.3 路由路径模式匹配"></a>2.3.3 路由路径模式匹配</h3><h3 id="2-3-4-国际化键名自动补全"><a href="#2-3-4-国际化键名自动补全" class="headerlink" title="2.3.4 国际化键名自动补全"></a>2.3.4 国际化键名自动补全</h3><h2 id="2-4-类型编程优化"><a href="#2-4-类型编程优化" class="headerlink" title="2.4 类型编程优化"></a>2.4 类型编程优化</h2><h3 id="2-4-1-类型递归与尾递归优化"><a href="#2-4-1-类型递归与尾递归优化" class="headerlink" title="2.4.1 类型递归与尾递归优化"></a>2.4.1 类型递归与尾递归优化</h3><h3 id="2-4-2-类型实例化深度控制"><a href="#2-4-2-类型实例化深度控制" class="headerlink" title="2.4.2 类型实例化深度控制"></a>2.4.2 类型实例化深度控制</h3><h3 id="2-4-3-条件类型短路技巧"><a href="#2-4-3-条件类型短路技巧" class="headerlink" title="2.4.3 条件类型短路技巧"></a>2.4.3 条件类型短路技巧</h3><h3 id="2-4-4-类型性能分析工具"><a href="#2-4-4-类型性能分析工具" class="headerlink" title="2.4.4 类型性能分析工具"></a>2.4.4 类型性能分析工具</h3><h1 id="三、工程化实践"><a href="#三、工程化实践" class="headerlink" title="三、工程化实践"></a>三、工程化实践</h1><h2 id="3-1-TSConfig-深度配置"><a href="#3-1-TSConfig-深度配置" class="headerlink" title="3.1 TSConfig 深度配置"></a>3.1 TSConfig 深度配置</h2><h3 id="3-1-1-严格模式全家桶配置"><a href="#3-1-1-严格模式全家桶配置" class="headerlink" title="3.1.1 严格模式全家桶配置"></a>3.1.1 严格模式全家桶配置</h3><p><strong>严格模式核心配置</strong></p>
<p>启用所有严格检查：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;strict&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>此配置等价于同时启用以下所有子选项（TypeScript 2.3+）。</p>
<p><strong>严格模式子选项详解</strong></p>
<table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">默认值</th>
<th align="left">作用</th>
<th align="left">推荐值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">strict</td>
<td align="left">false</td>
<td align="left">所有严格检查的总开关</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">noImplicitAny</td>
<td align="left">false</td>
<td align="left">禁止隐式 any 类型</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">noImplicitThis</td>
<td align="left">false</td>
<td align="left">禁止隐式 any 类型的 this</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">strictNullChecks</td>
<td align="left">false</td>
<td align="left">严格的 null&#x2F;undefined 检查</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">strictFunctionTypes</td>
<td align="left">false</td>
<td align="left">严格的函数类型检查（逆变参数）</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">strictBindCallApply</td>
<td align="left">false</td>
<td align="left">严格的 bind&#x2F;call&#x2F;apply 方法检查</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">strictPropertyInitialization</td>
<td align="left">false</td>
<td align="left">严格的类属性初始化检查（需配合 strictNullChecks）</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">alwaysStrict</td>
<td align="left">false</td>
<td align="left">以严格模式解析代码，并在每个文件顶部添加 “use strict”</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">useUnknownInCatchVariables</td>
<td align="left">false</td>
<td align="left">catch 子句变量默认为 unknown 类型（TS 4.4+）</td>
<td align="left">true</td>
</tr>
</tbody></table>
<p><strong>配置详解与工程实践</strong></p>
<ol>
<li>noImplicitAny</li>
</ol>
<p>问题代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">message</span>) &#123; <span class="hljs-comment">// 🚫 参数隐式 any</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(message);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params"><span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span></span>) &#123; <span class="hljs-comment">// ✅ 显式声明类型</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(message);<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>strictNullChecks</li>
</ol>
<p>问题代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;app&quot;</span>);<br>element.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">&quot;Hello&quot;</span>; <span class="hljs-comment">// 🚫 可能为 null</span><br></code></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;app&quot;</span>);<br><span class="hljs-keyword">if</span> (element) &#123; <span class="hljs-comment">// ✅ 安全检查</span><br>  element.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">&quot;Hello&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>strictPropertyInitialization</li>
</ol>
<p>问题代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 🚫 未初始化</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>  name!: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// ✅ 明确赋值断言</span><br>  <span class="hljs-comment">// 或</span><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span></span>) &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>useUnknownInCatchVariables</li>
</ol>
<p>问题代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">try</span> &#123; <span class="hljs-comment">/* ... */</span> &#125; <br><span class="hljs-keyword">catch</span> (err) &#123; <span class="hljs-comment">// any 类型</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err.<span class="hljs-property">message</span>); <span class="hljs-comment">// 🚫 可能不存在</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">try</span> &#123; <span class="hljs-comment">/* ... */</span> &#125; <br><span class="hljs-keyword">catch</span> (<span class="hljs-attr">err</span>: <span class="hljs-built_in">unknown</span>) &#123; <span class="hljs-comment">// ✅ TS 4.4+</span><br>  <span class="hljs-keyword">if</span> (err <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err.<span class="hljs-property">message</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>四、严格模式配置策略</p>
<ol>
<li>渐进启用策略：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;strict&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;noImplicitAny&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span> <span class="hljs-comment">// 临时关闭最严格的规则</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>文件级覆盖：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// @ts-nocheck  // 禁用整个文件检查</span><br><span class="hljs-comment">// @ts-ignore   // 禁用下一行检查</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">legacyCode</span>(<span class="hljs-params"></span>) &#123; <br>  <span class="hljs-comment">// @ts-expect-error // 预期错误（TS 3.9+）</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span> = <span class="hljs-string">&quot;string&quot;</span>; <br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>目录差异化配置：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// 根目录 tsconfig.json</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;extends&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./tsconfig.base.json&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;references&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./src&quot;</span> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>        <span class="hljs-comment">// 应用严格模式</span><br>    <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./legacy&quot;</span> <span class="hljs-punctuation">&#125;</span>      <span class="hljs-comment">// 非严格模式</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-comment">// legacy/tsconfig.json</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;extends&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;../tsconfig.base.json&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;strict&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p><strong>性能与严格模式</strong></p>
<ol>
<li>编译速度影响：</li>
</ol>
<table>
<thead>
<tr>
<th align="left">严格选项</th>
<th align="left">性能影响</th>
<th align="left">缓解措施</th>
</tr>
</thead>
<tbody><tr>
<td align="left">strictNullChecks</td>
<td align="left">中</td>
<td align="left">项目引用隔离修改范围</td>
</tr>
<tr>
<td align="left">noImplicitAny</td>
<td align="left">高</td>
<td align="left">渐进启用 + @ts-ignore 临时方案</td>
</tr>
<tr>
<td align="left">strictFunctionTypes</td>
<td align="left">低</td>
<td align="left">无需特别处理</td>
</tr>
</tbody></table>
<ol start="2">
<li>内存占用优化：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;strict&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;incremental&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 增量编译</span><br>    <span class="hljs-attr">&quot;tsBuildInfoFile&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./buildcache/.tsbuildinfo&quot;</span> <span class="hljs-comment">// 缓存位置</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p><strong>严格模式错误处理</strong></p>
<ol>
<li>常见错误类型：</li>
</ol>
<p>| 错误代码 | 含义 | 解决方案 |<br>| TS7006 | 参数隐式 any | 添加类型注解 |<br>| TS2532 | 对象可能为 undefined | 添加空值检查 |<br>| TS2564 | 属性未初始化 | 构造函数初始化或明确赋值断言 |<br>| TS2345 | 参数类型不匹配 | 修正参数类型或使用类型断言 |</p>
<ol start="2">
<li>错误自动修复：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// .vscode/settings.json</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;typescript.tsserver.experimental.enableProjectDiagnostics&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;editor.codeActionsOnSave&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;source.fixAll.ts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p><strong>企业级配置模板</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// tsconfig.strict.json</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;strict&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;noFallthroughCasesInSwitch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;noUnusedLocals&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;noUnusedParameters&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;noImplicitReturns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;forceConsistentCasingInFileNames&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;esModuleInterop&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;skipLibCheck&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;incremental&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;composite&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<h3 id="3-1-2-模块解析策略实战"><a href="#3-1-2-模块解析策略实战" class="headerlink" title="3.1.2 模块解析策略实战"></a>3.1.2 模块解析策略实战</h3><p><strong>模块解析策略概述</strong></p>
<p>TypeScript 支持两种模块解析策略：</p>
<table>
<thead>
<tr>
<th align="left">策略</th>
<th align="left">触发条件</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Classic</td>
<td align="left">“moduleResolution”: “Classic”</td>
<td align="left">TypeScript 1.6 前旧项目</td>
</tr>
<tr>
<td align="left">Node</td>
<td align="left">“moduleResolution”: “Node”</td>
<td align="left">现代项目（默认值）</td>
</tr>
<tr>
<td align="left">Node16&#x2F;NodeNext</td>
<td align="left">“moduleResolution”: “Node16”</td>
<td align="left">Node.js 16+ 和 ESM 项目</td>
</tr>
</tbody></table>
<p><strong>Node 解析策略详解</strong></p>
<p>解析流程（import { x } from ‘module’）：</p>
<ol>
<li>检查当前目录的 node_modules&#x2F;module.ts&#x2F;module.tsx&#x2F;module.d.ts</li>
<li>检查 node_modules&#x2F;module&#x2F;package.json 的 types 或 main 字段</li>
<li>检查 node_modules&#x2F;module&#x2F;index.ts&#x2F;index.d.ts</li>
<li>递归检查父目录的 node_modules（..&#x2F;node_modules&#x2F;module）</li>
</ol>
<p>文件扩展名解析顺序：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript">[<br>  <span class="hljs-string">&quot;.ts&quot;</span>, <span class="hljs-string">&quot;.tsx&quot;</span>, <span class="hljs-string">&quot;.d.ts&quot;</span>,         <span class="hljs-comment">// TypeScript 文件</span><br>  <span class="hljs-string">&quot;.js&quot;</span>, <span class="hljs-string">&quot;.jsx&quot;</span>, <span class="hljs-string">&quot;.cjs&quot;</span>, <span class="hljs-string">&quot;.mjs&quot;</span>,  <span class="hljs-comment">// JavaScript 文件</span><br>  <span class="hljs-string">&quot;.json&quot;</span>                         <span class="hljs-comment">// JSON 文件</span><br>]<br></code></pre></td></tr></table></figure>

<p><strong>Node16&#x2F;NodeNext 策略</strong></p>
<p>ESM 专属特性：</p>
<ol>
<li>支持 package.json 的 exports 和 imports 字段</li>
<li>严格区分 .js (CommonJS) 和 .mjs (ESM) 文件</li>
<li>支持 type: “module” 声明</li>
</ol>
<p>exports 字段优先级：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;exports&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;.&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;import&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./dist/esm/index.js&quot;</span><span class="hljs-punctuation">,</span>   <span class="hljs-comment">// ESM 入口</span><br>      <span class="hljs-attr">&quot;require&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./dist/cjs/index.js&quot;</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// CommonJS 入口</span><br>      <span class="hljs-attr">&quot;types&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./types/index.d.ts&quot;</span>      <span class="hljs-comment">// 类型声明</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;./feature&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./dist/feature.js&quot;</span>     <span class="hljs-comment">// 子路径导出</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p><strong>实战配置示例</strong></p>
<p>基础配置：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// tsconfig.json</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;module&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ESNext&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;moduleResolution&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Node16&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;baseUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./src&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;paths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;@components/*&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;components/*&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;@utils&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;utils/index&quot;</span><span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>多环境配置：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;moduleResolution&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Node16&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;paths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;config&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-string">&quot;config/prod&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 生产环境</span><br>        <span class="hljs-string">&quot;config/dev&quot;</span>   <span class="hljs-comment">// 开发环境</span><br>      <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p><strong>路径映射实战</strong></p>
<ol>
<li>别名配置：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;baseUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;.&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;paths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;@app/*&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;src/*&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;shared/*&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;../shared/*&quot;</span><span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>多路径回退：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;paths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;legacy-utils&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-string">&quot;src/utils/v2&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 优先使用 v2</span><br>      <span class="hljs-string">&quot;src/utils/v1&quot;</span>  <span class="hljs-comment">// 回退到 v1</span><br>    <span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>通配符扩展：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;paths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;@assets/*&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-string">&quot;assets/*&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;public/images/*&quot;</span><br>    <span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p><strong>常见问题解决方案</strong></p>
<p>问题1：路径映射运行时失效</p>
<p>解决方案：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 安装运行时解析器</span><br>npm install tsconfig-paths --save-dev<br><br><span class="hljs-comment"># Node.js 启动命令</span><br>node -r tsconfig-paths/register app.ts<br></code></pre></td></tr></table></figure>

<p>问题2：循环依赖解析失败</p>
<p>重构方案：</p>
<pre class="mermaid">graph LR
    A[ModuleA] -->|import| B[ModuleB]
    B -->|import| C[ModuleC]
    C -->|import| A[ModuleA]
    
    subgraph 重构后
    D[Common] --> E[ModuleA]
    D[Common] --> F[ModuleB]
    D[Common] --> G[ModuleC]
    end</pre>

<p>问题3：动态导入类型丢失</p>
<p>类型安全方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 动态导入类型封装</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> safeImport&lt;T&gt;(<span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;T&gt; &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(path);<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">module</span> <span class="hljs-keyword">as</span> T;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ChartModule</span> &#123;<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">data</span>: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-keyword">const</span> chart = <span class="hljs-keyword">await</span> safeImport&lt;<span class="hljs-title class_">ChartModule</span>&gt;(<span class="hljs-string">&quot;./chart&quot;</span>);<br>chart.<span class="hljs-title function_">render</span>(data);<br></code></pre></td></tr></table></figure>

<p><strong>构建工具集成</strong></p>
<ol>
<li>Webpack 配置：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// webpack.config.js</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">TsconfigPathsPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;tsconfig-paths-webpack-plugin&#x27;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">resolve</span>: &#123;<br>    <span class="hljs-attr">plugins</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">TsconfigPathsPlugin</span>()],<br>    <span class="hljs-attr">extensions</span>: [<span class="hljs-string">&#x27;.ts&#x27;</span>, <span class="hljs-string">&#x27;.tsx&#x27;</span>, <span class="hljs-string">&#x27;.js&#x27;</span>]<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>Vite 配置：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// vite.config.ts</span><br><span class="hljs-keyword">import</span> &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite&#x27;</span>;<br><span class="hljs-keyword">import</span> tsconfigPaths <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vite-tsconfig-paths&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">tsconfigPaths</span>()]<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="3-1-3-声明文件生成配置"><a href="#3-1-3-声明文件生成配置" class="headerlink" title="3.1.3 声明文件生成配置"></a>3.1.3 声明文件生成配置</h3><h3 id="3-1-4-编译器缓存策略"><a href="#3-1-4-编译器缓存策略" class="headerlink" title="3.1.4 编译器缓存策略"></a>3.1.4 编译器缓存策略</h3><h2 id="3-2-声明文件-d-ts"><a href="#3-2-声明文件-d-ts" class="headerlink" title="3.2 声明文件(.d.ts)"></a>3.2 声明文件(.d.ts)</h2><h3 id="3-2-1-第三方库类型扩展技巧"><a href="#3-2-1-第三方库类型扩展技巧" class="headerlink" title="3.2.1 第三方库类型扩展技巧"></a>3.2.1 第三方库类型扩展技巧</h3><p><strong>声明文件扩展基础</strong></p>
<p>核心方法：使用 declare module 语法扩展第三方库类型</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// global.d.ts</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;第三方库名&#x27;</span> &#123;<br>  <span class="hljs-comment">// 扩展内容</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>常见扩展场景</strong></p>
<ol>
<li>添加缺失类型：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;untyped-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">calculate</span>(<span class="hljs-params"><span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span>;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">version</span>: <span class="hljs-built_in">string</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>扩展现有接口：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;react&#x27;</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">HTMLAttributes</span>&lt;T&gt; &#123;<br>    <span class="hljs-comment">// 添加自定义属性</span><br>    <span class="hljs-attr">customAttr</span>?: <span class="hljs-built_in">string</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br>&lt;div customAttr=<span class="hljs-string">&quot;value&quot;</span> /&gt;; <span class="hljs-comment">// ✅ 类型安全</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>覆盖错误类型：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;flawed-lib&#x27;</span> &#123;<br>  <span class="hljs-comment">// 修正错误返回类型</span><br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params"></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Data</span>&gt;; <span class="hljs-comment">// 原声明为 any</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>模块合并策略</strong></p>
<ol>
<li>接口合并：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 原始声明</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> &#123;<br>  <span class="hljs-attr">timeout</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-comment">// 扩展声明</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;configurable-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> &#123;<br>    <span class="hljs-attr">retries</span>?: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 添加可选属性</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>函数重载扩展：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 原始函数</span><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params"><span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span>;<br><br><span class="hljs-comment">// 扩展重载</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;logger-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params"><span class="hljs-attr">data</span>: <span class="hljs-built_in">object</span></span>): <span class="hljs-built_in">void</span>; <span class="hljs-comment">// 添加对象支持</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>命名空间合并：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 原始命名空间</span><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Analytics</span> &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">track</span>(<span class="hljs-params"><span class="hljs-attr">event</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-comment">// 扩展命名空间</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;analytics-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Analytics</span> &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">identify</span>(<span class="hljs-params"><span class="hljs-attr">userId</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span>; <span class="hljs-comment">// 添加新方法</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>类型扩展最佳实践</strong></p>
<ol>
<li>模块化扩展文件：</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">src/<br>  types/<br>    extensions/<br>      react.d.ts      # React扩展<br>      lodash.d.ts     # Lodash扩展<br>      global.d.ts     # 全局扩展<br>  tsconfig.json<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>条件扩展模式：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 根据环境变量扩展</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Env</span> = <span class="hljs-string">&#x27;development&#x27;</span> | <span class="hljs-string">&#x27;production&#x27;</span>;<br><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;configurable-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> &#123;<br>    <span class="hljs-attr">debug</span>?: <span class="hljs-title class_">Env</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">&#x27;development&#x27;</span> ? <span class="hljs-built_in">boolean</span> : <span class="hljs-built_in">never</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>类型安全增强：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 添加严格类型约束</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;flexible-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params"><span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">unknown</span>;<br>  <span class="hljs-keyword">function</span> parse&lt;T&gt;(<span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span>): T; <span class="hljs-comment">// 泛型版本</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>高级扩展技巧</strong></p>
<ol>
<li>模板字面量类型扩展：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;router-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">type</span> <span class="hljs-title class_">DynamicRoute</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>&gt; = <br>    T <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">string</span>&#125;</span>:<span class="hljs-subst">$&#123;infer Param&#125;</span><span class="hljs-subst">$&#123;<span class="hljs-built_in">string</span>&#125;</span>`</span> ? <span class="hljs-title class_">Param</span> : <span class="hljs-built_in">never</span>;<br>  <br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Router</span> &#123;<br>    <span class="hljs-title function_">get</span>(<span class="hljs-attr">route</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span>;<br>    <span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">DynamicRoute</span>&lt;keyof <span class="hljs-variable language_">this</span>.<span class="hljs-property">routes</span>&gt;, <span class="hljs-built_in">string</span>&gt;;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>泛型约束增强：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;storage-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Storage</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;&gt; &#123;<br>    get&lt;K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">key</span>: K): T[K];<br>    set&lt;K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">key</span>: K, <span class="hljs-attr">value</span>: T[K]): <span class="hljs-built_in">void</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>类型谓词扩展：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;validator-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Validators</span> &#123;<br>    <span class="hljs-attr">isEmail</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">input</span>: <span class="hljs-built_in">unknown</span></span>) =&gt;</span> input is <span class="hljs-built_in">string</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>常见问题解决方案</strong></p>
<p>问题1：模块扩展冲突</p>
<p>解决方案：使用唯一标识符</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 原始库</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;ui-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ButtonProps</span> &#123;<br>    <span class="hljs-attr">variant</span>: <span class="hljs-string">&#x27;primary&#x27;</span> | <span class="hljs-string">&#x27;secondary&#x27;</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 扩展（避免直接修改）</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;ui-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ButtonProps</span> &#123;<br>    <span class="hljs-attr">__extendedVariant</span>?: <span class="hljs-string">&#x27;tertiary&#x27;</span>; <span class="hljs-comment">// 使用特殊前缀</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>问题2：全局污染</p>
<p>解决方案：封装扩展</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 安全扩展方案</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ExtendedLib</span> = <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;base-lib&#x27;</span>) &amp; &#123;<br>  <span class="hljs-attr">newMethod</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;<br>&#125;;<br><br><span class="hljs-keyword">const</span> lib = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;base-lib&#x27;</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">ExtendedLib</span>;<br>lib.<span class="hljs-title function_">newMethod</span>(); <span class="hljs-comment">// 安全访问</span><br></code></pre></td></tr></table></figure>

<p>问题3：类型覆盖丢失</p>
<p>解决方案：版本化扩展</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 根据库版本动态扩展</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">LibVersion</span> = <span class="hljs-string">&#x27;1.x&#x27;</span> | <span class="hljs-string">&#x27;2.x&#x27;</span>;<br><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">global</span> &#123;<br>  <span class="hljs-keyword">var</span> <span class="hljs-attr">__libVersion</span>: <span class="hljs-title class_">LibVersion</span>;<br>&#125;<br><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;versioned-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> &#123;<br>    [__libVersion <span class="hljs-keyword">extends</span> <span class="hljs-string">&#x27;2.x&#x27;</span> ? <span class="hljs-string">&#x27;newFeature&#x27;</span> : <span class="hljs-built_in">never</span>]: <span class="hljs-built_in">boolean</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>React 生态扩展</strong></p>
<ol>
<li>组件属性扩展：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;react-table&#x27;</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ColumnInstance</span>&lt;D <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> = &#123;&#125;&gt; &#123;<br>    <span class="hljs-attr">align</span>?: <span class="hljs-string">&#x27;left&#x27;</span> | <span class="hljs-string">&#x27;center&#x27;</span> | <span class="hljs-string">&#x27;right&#x27;</span>; <span class="hljs-comment">// 添加对齐属性</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>Hooks 返回值扩展：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;react-query&#x27;</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">QueryResult</span>&lt;T&gt; &#123;<br>    <span class="hljs-attr">customMeta</span>?: &#123; <span class="hljs-attr">timestamp</span>: <span class="hljs-built_in">number</span> &#125;; <span class="hljs-comment">// 添加元数据</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>Context 类型增强：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ThemeContext</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;theme-provider&#x27;</span>;<br><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;theme-provider&#x27;</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Theme</span> &#123;<br>    <span class="hljs-attr">customColor</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 扩展主题对象</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ThemeContext</span>);<br>theme.<span class="hljs-property">customColor</span>; <span class="hljs-comment">// ✅ 类型安全</span><br></code></pre></td></tr></table></figure>

<p><strong>扩展测试策略</strong></p>
<ol>
<li>类型测试：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 验证扩展是否生效</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Test</span> = <span class="hljs-title class_">Expect</span>&lt;<br>  <span class="hljs-comment">// 检查扩展属性是否存在</span><br>  <span class="hljs-string">&#x27;customAttr&#x27;</span> <span class="hljs-keyword">extends</span> keyof <span class="hljs-title class_">React</span>.<span class="hljs-property">HTMLAttributes</span>&lt;<span class="hljs-built_in">any</span>&gt; ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span><br>&gt;;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>运行时验证：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 确保扩展与运行时兼容</span><br><span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;newMethod&#x27;</span> <span class="hljs-keyword">in</span> lib) &#123;<br>  lib.<span class="hljs-title function_">newMethod</span>();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;Library extension not available&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>工程化建议</strong></p>
<ol>
<li>扩展文档化：</li>
</ol>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section">## UI 库扩展说明</span><br><br><span class="hljs-section">### 新增属性</span><br>| 属性名        | 类型   | 说明               |<br>|---------------|--------|--------------------|<br>| customAttr    | string | 自定义HTML属性     |<br>| <span class="hljs-strong">__extendedVariant | &#x27;tertiary&#x27; | 特殊按钮类型    |</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>版本管理策略：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// package.json</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;@types/custom-lib-extension&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.0.0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;peerDependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;target-lib&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^2.0.0&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>扩展发布流程：</li>
</ol>
<pre class="mermaid">graph LR
    A[创建扩展声明] --> B[本地测试验证]
    B --> C[发布到内部npm]
    C --> D[项目安装使用]</pre>

<p><strong>扩展安全指南</strong></p>
<ol>
<li>避免全局污染：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 错误：全局扩展基础类型</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Array</span>&lt;T&gt; &#123;<br>  <span class="hljs-title function_">customMethod</span>(): <span class="hljs-built_in">void</span>;<br>&#125;<br><br><span class="hljs-comment">// 正确：模块化扩展</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;array-extension&#x27;</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Array</span>&lt;T&gt; &#123;<br>    <span class="hljs-title function_">safeCustomMethod</span>(): <span class="hljs-built_in">void</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>防御性类型检查：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 安全扩展函数</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;utils-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params"><span class="hljs-attr">input</span>: <span class="hljs-built_in">unknown</span></span>): <span class="hljs-built_in">unknown</span>;<br>  <span class="hljs-keyword">function</span> parse&lt;T&gt;(<span class="hljs-attr">input</span>: T): T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? <span class="hljs-title class_">Data</span> : <span class="hljs-built_in">never</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>兼容性处理：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 处理不同版本的库</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;multi-version-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CoreAPI</span> &#123;<br>    <span class="hljs-title function_">commonMethod</span>(): <span class="hljs-built_in">void</span>;<br>  &#125;<br>  <br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> V1API <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CoreAPI</span> &#123;<br>    <span class="hljs-title function_">v1Method</span>(): <span class="hljs-built_in">void</span>;<br>  &#125;<br>  <br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> V2API <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CoreAPI</span> &#123;<br>    <span class="hljs-title function_">v2Method</span>(): <span class="hljs-built_in">void</span>;<br>  &#125;<br>  <br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">api</span>: <span class="hljs-variable constant_">V1API</span> | <span class="hljs-variable constant_">V2API</span>;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> api;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>扩展参考表</strong></p>
<table>
<thead>
<tr>
<th align="left">扩展类型</th>
<th align="left">适用场景</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">接口属性扩展</td>
<td align="left">添加新属性&#x2F;方法</td>
<td align="left"><code>interface &#123; newProp: type &#125;</code></td>
</tr>
<tr>
<td align="left">函数重载扩展</td>
<td align="left">支持新参数类型</td>
<td align="left"><code>function log(data: object)</code></td>
</tr>
<tr>
<td align="left">泛型约束增强</td>
<td align="left">增加类型参数约束</td>
<td align="left"><code>Storage&lt;T extends object&gt;</code></td>
</tr>
<tr>
<td align="left">条件类型扩展</td>
<td align="left">根据环境动态扩展</td>
<td align="left"><code>debug?: Env extends &#39;dev&#39;</code></td>
</tr>
<tr>
<td align="left">模板字面量扩展</td>
<td align="left">路由参数&#x2F;国际化键名</td>
<td align="left"><code>DynamicRoute&lt;path&gt;</code></td>
</tr>
<tr>
<td align="left">类型谓词扩展</td>
<td align="left">自定义类型守卫</td>
<td align="left"><code>isEmail(input): input is string</code></td>
</tr>
</tbody></table>
<h3 id="3-2-2-模块声明合并策略"><a href="#3-2-2-模块声明合并策略" class="headerlink" title="3.2.2 模块声明合并策略"></a>3.2.2 模块声明合并策略</h3><p><strong>声明合并基础概念</strong></p>
<p>核心机制：TypeScript 允许将多个同名的声明合并为单一类型定义</p>
<p>合并类型：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;<br>&#125;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> &#123;<br>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-comment">// 合并结果</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span>,<br>  <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>  <span class="hljs-comment">// ✅ 合并属性</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>模块声明合并策略</strong></p>
<ol>
<li>接口合并：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// module.d.ts</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;my-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> &#123;<br>    <span class="hljs-attr">timeout</span>: <span class="hljs-built_in">number</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// user-extension.d.ts</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;my-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> &#123;<br>    <span class="hljs-attr">retries</span>?: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 添加新属性</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 合并结果</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;my-lib&#x27;</span>).<span class="hljs-property">Config</span> = &#123;<br>  <span class="hljs-attr">timeout</span>: <span class="hljs-number">1000</span>,<br>  <span class="hljs-attr">retries</span>: <span class="hljs-number">3</span>  <span class="hljs-comment">// ✅</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>函数合并：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 原始声明</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;utils&#x27;</span> &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params"><span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">any</span>;<br>&#125;<br><br><span class="hljs-comment">// 扩展声明</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;utils&#x27;</span> &#123;<br>  <span class="hljs-keyword">function</span> parse&lt;T&gt;(<span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span>): T; <span class="hljs-comment">// 泛型版本</span><br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">const</span> data = parse&lt;&#123; <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> &#125;&gt;(<span class="hljs-string">&#x27;&#123;&quot;id&quot;:&quot;123&quot;&#125;&#x27;</span>); <span class="hljs-comment">// ✅ 类型安全</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>命名空间合并：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 原始命名空间</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;analytics&#x27;</span> &#123;<br>  <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Tracking</span> &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">pageview</span>(<span class="hljs-params"><span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 扩展命名空间</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;analytics&#x27;</span> &#123;<br>  <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Tracking</span> &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">event</span>(<span class="hljs-params"><span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">object</span></span>): <span class="hljs-built_in">void</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-title class_">Tracking</span>.<span class="hljs-title function_">event</span>(<span class="hljs-string">&quot;click&quot;</span>, &#123; <span class="hljs-attr">button</span>: <span class="hljs-string">&quot;submit&quot;</span> &#125;); <span class="hljs-comment">// ✅</span><br></code></pre></td></tr></table></figure>

<p><strong>合并优先级规则</strong></p>
<table>
<thead>
<tr>
<th align="left">声明类型</th>
<th align="left">合并优先级</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">接口属性</td>
<td align="left">顺序无关，同名属性必须兼容</td>
<td align="left"><code>interface A &#123; x: number &#125;</code><br><code>interface A &#123; x: string &#125;</code> → 错误</td>
</tr>
<tr>
<td align="left">函数重载</td>
<td align="left">后声明优先</td>
<td align="left">最后声明的签名最先匹配</td>
</tr>
<tr>
<td align="left">命名空间</td>
<td align="left">按声明顺序合并</td>
<td align="left">后声明的成员覆盖先前的</td>
</tr>
<tr>
<td align="left">类与接口</td>
<td align="left">接口声明优先</td>
<td align="left">类实现必须满足所有接口声明</td>
</tr>
</tbody></table>
<p><strong>模块合并最佳实践</strong></p>
<ol>
<li>分层声明结构：</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">types/<br>  ├── lib/<br>  │   ├── base.d.ts      // 基础声明<br>  │   └── extensions/    // 扩展声明<br>  │       ├── v1.d.ts<br>  │       └── v2.d.ts<br>  └── global.d.ts        // 全局合并<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>版本化合并策略：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 条件合并</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">LibVersion</span> = <span class="hljs-string">&#x27;v1&#x27;</span> | <span class="hljs-string">&#x27;v2&#x27;</span>;<br><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;versioned-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Api</span> &#123;<br>    <span class="hljs-title function_">commonMethod</span>(): <span class="hljs-built_in">void</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;versioned-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Api</span> &#123;<br>    [<span class="hljs-title class_">LibVersion</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">&#x27;v2&#x27;</span> ? <span class="hljs-string">&#x27;newMethod&#x27;</span> : <span class="hljs-built_in">never</span>]?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>安全覆盖模式：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;sensitive-lib&#x27;</span> &#123;<br>  <span class="hljs-keyword">interface</span> __OriginalConfig &#123;<br>    <span class="hljs-comment">// 保留原始定义</span><br>    <span class="hljs-attr">originalProp</span>: <span class="hljs-built_in">string</span>;<br>  &#125;<br>  <br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> <span class="hljs-keyword">extends</span> __OriginalConfig &#123;<br>    <span class="hljs-comment">// 安全扩展</span><br>    <span class="hljs-attr">customProp</span>?: <span class="hljs-built_in">number</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>React 组件合并案例</strong></p>
<ol>
<li>组件属性合并：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 原始组件声明</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;react-ui&#x27;</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ButtonProps</span> &#123;<br>    <span class="hljs-attr">variant</span>: <span class="hljs-string">&#x27;primary&#x27;</span> | <span class="hljs-string">&#x27;secondary&#x27;</span>;<br>  &#125;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params"><span class="hljs-attr">props</span>: <span class="hljs-title class_">ButtonProps</span></span>): <span class="hljs-variable constant_">JSX</span>.<span class="hljs-property">Element</span>;<br>&#125;<br><br><span class="hljs-comment">// 扩展属性</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;react-ui&#x27;</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ButtonProps</span> &#123;<br>    <span class="hljs-attr">size</span>?: <span class="hljs-string">&#x27;sm&#x27;</span> | <span class="hljs-string">&#x27;md&#x27;</span> | <span class="hljs-string">&#x27;lg&#x27;</span>; <span class="hljs-comment">// 添加新属性</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br>&lt;<span class="hljs-title class_">Button</span> variant=<span class="hljs-string">&quot;primary&quot;</span> size=<span class="hljs-string">&quot;md&quot;</span> /&gt;; <span class="hljs-comment">// ✅</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>Hooks 返回值合并：</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 原始Hook</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;react-hooks&#x27;</span> &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">useData</span>(<span class="hljs-params"></span>): &#123; <span class="hljs-attr">loading</span>: <span class="hljs-built_in">boolean</span>; <span class="hljs-attr">data</span>: <span class="hljs-built_in">any</span> &#125;;<br>&#125;<br><br><span class="hljs-comment">// 扩展返回值</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;react-hooks&#x27;</span> &#123;<br>  <span class="hljs-keyword">function</span> useData&lt;T&gt;(): &#123; <span class="hljs-attr">loading</span>: <span class="hljs-built_in">boolean</span>; <span class="hljs-attr">data</span>: T | <span class="hljs-literal">null</span>; <span class="hljs-attr">error</span>?: <span class="hljs-title class_">Error</span> &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>合并冲突解决方案</strong></p>
<p>冲突类型 1：属性类型不兼容</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 声明1</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> &#123;<br>  <span class="hljs-attr">logLevel</span>: <span class="hljs-built_in">string</span>;<br>&#125;<br><br><span class="hljs-comment">// 声明2</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> &#123;<br>  <span class="hljs-attr">logLevel</span>: <span class="hljs-string">&#x27;debug&#x27;</span> | <span class="hljs-string">&#x27;info&#x27;</span>; <span class="hljs-comment">// 🚫 类型冲突</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 方法1：使用联合类型</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> &#123;<br>  <span class="hljs-attr">logLevel</span>: <span class="hljs-built_in">string</span> | <span class="hljs-string">&#x27;debug&#x27;</span> | <span class="hljs-string">&#x27;info&#x27;</span>;<br>&#125;<br><br><span class="hljs-comment">// 方法2：版本化声明</span><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">__configVersion</span>: <span class="hljs-string">&#x27;v1&#x27;</span> | <span class="hljs-string">&#x27;v2&#x27;</span>;<br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> &#123;<br>  <span class="hljs-attr">logLevel</span>: __configVersion <span class="hljs-keyword">extends</span> <span class="hljs-string">&#x27;v2&#x27;</span> ? <span class="hljs-string">&#x27;debug&#x27;</span> | <span class="hljs-string">&#x27;info&#x27;</span> : <span class="hljs-built_in">string</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>冲突类型 2：函数重载歧义</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params"><span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">any</span>;<br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params"><span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">object</span>; <span class="hljs-comment">// 🚫 相同参数类型</span><br></code></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 明确重载顺序</span><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params"><span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">any</span>;<br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params"><span class="hljs-attr">input</span>: <span class="hljs-built_in">object</span></span>): <span class="hljs-built_in">object</span>; <span class="hljs-comment">// ✅ 不同参数类型</span><br></code></pre></td></tr></table></figure>

<p><strong>声明合并参考表</strong></p>
<table>
<thead>
<tr>
<th align="left">合并场景</th>
<th align="left">推荐策略</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">接口属性扩展</td>
<td align="left">直接添加新属性</td>
<td align="left"><code>interface &#123; newProp: type &#125;</code></td>
</tr>
<tr>
<td align="left">函数重载扩展</td>
<td align="left">添加不同参数类型的重载</td>
<td align="left"><code>function parse(data: object)</code></td>
</tr>
<tr>
<td align="left">泛型约束增强</td>
<td align="left">使用条件类型继承</td>
<td align="left"><code>Store&lt;T extends object&gt;</code></td>
</tr>
<tr>
<td align="left">跨模块类型合并</td>
<td align="left">使用类型查询和组合</td>
<td align="left"><code>type Full = LibA.Type &amp; LibB.Type</code></td>
</tr>
<tr>
<td align="left">版本差异化合并</td>
<td align="left">条件类型 + 环境变量</td>
<td align="left"><code>__version extends &#39;v2&#39; ? ...</code></td>
</tr>
<tr>
<td align="left">第三方库补丁</td>
<td align="left">模块声明合并 + 防御性检查</td>
<td align="left"><code>declare module &#39;lib&#39; &#123; ... &#125;</code></td>
</tr>
</tbody></table>
<h3 id="3-2-3-全局变量类型定义"><a href="#3-2-3-全局变量类型定义" class="headerlink" title="3.2.3 全局变量类型定义"></a>3.2.3 全局变量类型定义</h3><p><strong>核心概念</strong></p>
<p>全局变量：在模块系统外可直接访问的变量（如 window 对象属性、CDN 引入的库）</p>
<p>定义目标：</p>
<ul>
<li>为非模块化脚本提供类型支持</li>
<li>扩展全局命名空间（如 window、global）</li>
<li>避免 Cannot find name ‘xxx’ 类型错误</li>
</ul>
<p><strong>代码示例</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// ⭐ 场景1：声明全局变量 (声明文件.d.ts)</span><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">VERSION</span>: <span class="hljs-built_in">string</span>;  <span class="hljs-comment">// 编译时注入的版本号</span><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">trackEvent</span>(<span class="hljs-params"><span class="hljs-attr">eventName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">payload</span>: <span class="hljs-built_in">object</span></span>): <span class="hljs-built_in">void</span>;  <span class="hljs-comment">// 全局埋点函数</span><br><br><span class="hljs-comment">// ⭐ 场景2：扩展全局对象 (如 Window 接口)</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Window</span> &#123;<br>  <span class="hljs-attr">_env</span>: &#123;<br>    <span class="hljs-attr">API_HOST</span>: <span class="hljs-built_in">string</span>;<br>    <span class="hljs-attr">DEBUG_MODE</span>: <span class="hljs-built_in">boolean</span>;<br>  &#125;;<br>  <span class="hljs-attr">ga</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">command</span>: <span class="hljs-built_in">string</span>, ...<span class="hljs-attr">args</span>: <span class="hljs-built_in">unknown</span>[]</span>) =&gt;</span> <span class="hljs-built_in">void</span>;  <span class="hljs-comment">// Google Analytics</span><br>&#125;<br><br><span class="hljs-comment">// ⭐ 场景3：模块化环境中的全局声明 (使用 declare global)</span><br><span class="hljs-keyword">export</span> &#123;&#125;;  <span class="hljs-comment">// 确保文件是模块环境</span><br><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">global</span> &#123;<br>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Array</span>&lt;T&gt; &#123;<br>    <span class="hljs-title function_">findLast</span>(<span class="hljs-attr">predicate</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">value</span>: T</span>) =&gt;</span> <span class="hljs-built_in">boolean</span>): T | <span class="hljs-literal">undefined</span>;  <span class="hljs-comment">// 扩展原生Array</span><br>  &#125;<br>  <br>  <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">NodeJS</span> &#123;<br>    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProcessEnv</span> &#123;<br>      <span class="hljs-attr">NODE_ENV</span>: <span class="hljs-string">&#x27;development&#x27;</span> | <span class="hljs-string">&#x27;production&#x27;</span>;<br>      <span class="hljs-attr">SSR_ENABLED</span>: <span class="hljs-built_in">boolean</span>;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>工程实践与陷阱</strong></p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">解决方案</th>
<th align="left">注意事项</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CDN 引入的库</td>
<td align="left"><code>declare const jQuery: any;</code></td>
<td align="left">优先安装 @types 包</td>
</tr>
<tr>
<td align="left">注入的运行时变量</td>
<td align="left"><code>declare const __INITIAL_STATE__: AppState;</code></td>
<td align="left">需与构建脚本配合注入</td>
</tr>
<tr>
<td align="left">扩展浏览器原生对象</td>
<td align="left">通过 interface 合并声明</td>
<td align="left">避免覆盖标准类型定义</td>
</tr>
<tr>
<td align="left">多环境全局变量</td>
<td align="left">使用 .d.ts + 条件类型</td>
<td align="left">区分 process.env 和 import.meta.env</td>
</tr>
</tbody></table>
<p>典型错误案例：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// ❌ 错误：直接覆盖Window类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Window</span> = <span class="hljs-title class_">CustomWindow</span>;  <br><br><span class="hljs-comment">// ✅ 正确：通过接口合并</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Window</span> &#123;<br>  <span class="hljs-attr">customProp</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>面试级考点</strong></p>
<ul>
<li>类型合并机制：接口声明合并 vs 命名空间合并</li>
<li>模块化影响：<ul>
<li>全局声明必须放在 .d.ts 文件或使用 declare global</li>
<li>包含 import&#x2F;export 的文件会被视为模块</li>
</ul>
</li>
<li>类型可见性规则：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// types.d.ts</span><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GlobalType</span> &#123; <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span> &#125;  <span class="hljs-comment">// 全局可见</span><br><br><span class="hljs-comment">// utils.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">declare</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">LocalType</span> &#123;&#125;  <span class="hljs-comment">// 仅模块内可见</span><br></code></pre></td></tr></table></figure>

<ul>
<li>与 window as any 的取舍：优先声明具体类型保证安全</li>
</ul>
<h3 id="3-2-4-复杂类型声明最佳实践"><a href="#3-2-4-复杂类型声明最佳实践" class="headerlink" title="3.2.4 复杂类型声明最佳实践"></a>3.2.4 复杂类型声明最佳实践</h3><p><strong>核心设计原则</strong></p>
<table>
<thead>
<tr>
<th align="left">原则</th>
<th align="left">说明</th>
<th align="left">反模式案例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">精确性</td>
<td align="left">类型应严格匹配运行时行为</td>
<td align="left">用 any 代替具体结构</td>
</tr>
<tr>
<td align="left">可读性</td>
<td align="left">通过类型别名分层抽象</td>
<td align="left">嵌套超过三层的匿名类型</td>
</tr>
<tr>
<td align="left">兼容性</td>
<td align="left">考虑旧版 TypeScript 的解析能力</td>
<td align="left">使用 TS 4.1+ 特性但未降级</td>
</tr>
<tr>
<td align="left">可扩展性</td>
<td align="left">预留扩展点（如索引签名）</td>
<td align="left">完全封闭的类型定义</td>
</tr>
</tbody></table>
<p><strong>复杂类型声明模式</strong></p>
<p>场景1：深度嵌套结构（如 API 响应）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 使用接口分层 + 类型别名组合</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserProfile</span> &#123;<br>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;<br>  <span class="hljs-attr">contacts</span>: &#123;<br>    <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;<br>    <span class="hljs-attr">social</span>?: &#123; <span class="hljs-comment">// 可选嵌套</span><br>      <span class="hljs-attr">wechat</span>: <span class="hljs-built_in">string</span>;<br>      <span class="hljs-attr">alipay</span>: <span class="hljs-built_in">string</span>;<br>    &#125;;<br>  &#125;;<br>&#125;<br><br><span class="hljs-comment">// 提取公共结构</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Pagination</span>&lt;T&gt; = &#123;<br>  <span class="hljs-attr">current_page</span>: <span class="hljs-built_in">number</span>;<br>  <span class="hljs-attr">data</span>: T[];<br>&#125;;<br><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUserList</span>(<span class="hljs-params"></span>): <span class="hljs-title class_">Pagination</span>&lt;<span class="hljs-title class_">UserProfile</span>&gt;;<br></code></pre></td></tr></table></figure>

<p>场景2：动态键名对象（如国际化字典）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 模板字面量类型 + 索引签名</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Locale</span> = <span class="hljs-string">&#x27;zh-CN&#x27;</span> | <span class="hljs-string">&#x27;en-US&#x27;</span>;<br><span class="hljs-keyword">type</span> I18nKeys = <span class="hljs-string">`button.<span class="hljs-subst">$&#123;<span class="hljs-string">&#x27;submit&#x27;</span> | <span class="hljs-string">&#x27;cancel&#x27;</span>&#125;</span>`</span> | <span class="hljs-string">`title.<span class="hljs-subst">$&#123;<span class="hljs-string">&#x27;home&#x27;</span> | <span class="hljs-string">&#x27;about&#x27;</span>&#125;</span>`</span>;<br><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">i18n</span>: &#123;<br>  [key <span class="hljs-keyword">in</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;Locale&#125;</span>/<span class="hljs-subst">$&#123;I18nKeys&#125;</span>`</span>]: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 如 &quot;zh-CN/button.submit&quot;</span><br>&#125; &amp; &#123;<br>  <span class="hljs-title function_">get</span>(<span class="hljs-attr">key</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;Locale&#125;</span>/<span class="hljs-subst">$&#123;I18nKeys&#125;</span>`</span>, <span class="hljs-attr">vars</span>?: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;): <span class="hljs-built_in">string</span>;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>场景3：函数重载类型（如 SDK 方法）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 使用联合类型 + 条件类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">SDKOptions</span> = <br>  | &#123; <span class="hljs-attr">mode</span>: <span class="hljs-string">&#x27;sync&#x27;</span>; <span class="hljs-attr">timeout</span>: <span class="hljs-built_in">number</span> &#125;<br>  | &#123; <span class="hljs-attr">mode</span>: <span class="hljs-string">&#x27;async&#x27;</span>; <span class="hljs-attr">callback</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">res</span>: <span class="hljs-title class_">Response</span></span>) =&gt;</span> <span class="hljs-built_in">void</span> &#125;;<br><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">invokeAPI</span>(<span class="hljs-params"></span><br><span class="hljs-params">  <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;/user&#x27;</span>,</span><br><span class="hljs-params">  <span class="hljs-attr">options</span>?: <span class="hljs-title class_">SDKOptions</span></span><br><span class="hljs-params"></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">User</span>&gt; | <span class="hljs-title class_">User</span>;<br></code></pre></td></tr></table></figure>

<p><strong>进阶技巧与陷阱规避</strong></p>
<p>技巧1：类型递归深度控制</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// ✅ 安全递归：限制深度</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">MaxDepth</span>&lt;T, D <span class="hljs-keyword">extends</span> <span class="hljs-built_in">number</span> = <span class="hljs-number">3</span>&gt; = <br>  D <span class="hljs-keyword">extends</span> <span class="hljs-number">0</span> ? <span class="hljs-built_in">never</span> : <br>  T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> ? &#123;<br>    [K <span class="hljs-keyword">in</span> keyof T]: <span class="hljs-title class_">MaxDepth</span>&lt;T[K], <span class="hljs-title class_">Subtract</span>&lt;D, <span class="hljs-number">1</span>&gt;&gt;<br>  &#125; : T;<br><br><span class="hljs-comment">// ❌ 危险：无限递归</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">InfiniteRecursion</span>&lt;T&gt; = &#123;<br>  <span class="hljs-attr">value</span>: T;<br>  <span class="hljs-attr">children</span>: <span class="hljs-title class_">InfiniteRecursion</span>&lt;T&gt;[]; <span class="hljs-comment">// 可能引发类型实例化过深错误</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p>技巧2：防御性类型设计</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 防范不完整数据</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">SafeAccess</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> ? &#123;<br>  [K <span class="hljs-keyword">in</span> keyof T]-?: <span class="hljs-title class_">SafeAccess</span>&lt;T[K]&gt;; <span class="hljs-comment">// 移除可选修饰符</span><br>&#125; : T;<br><br><span class="hljs-comment">// 使用 never 阻断非法路径</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ValidateRoute</span>&lt;<span class="hljs-title class_">Path</span>&gt; = <br>  <span class="hljs-title class_">Path</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">`/user/<span class="hljs-subst">$&#123;infer Id&#125;</span>`</span> <br>    ? <span class="hljs-title class_">Id</span> <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">number</span>&#125;</span>`</span> <br>      ? <span class="hljs-title class_">Path</span> <br>      : <span class="hljs-built_in">never</span> <br>    : <span class="hljs-built_in">never</span>;<br></code></pre></td></tr></table></figure>

<p><strong>工程化实践</strong></p>
<p>策略1：类型测试（使用 tsd 等工具）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 测试类型是否符合预期</span><br><span class="hljs-keyword">import</span> &#123; expectType &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;tsd&#x27;</span>;<br><br>expectType&lt;&#123; <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span> &#125;&gt;(<span class="hljs-title function_">fetchUserList</span>().<span class="hljs-property">data</span>[<span class="hljs-number">0</span>]);<br></code></pre></td></tr></table></figure>

<p>策略2：声明文件组织规范</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs text">types/<br>├── global.d.ts         # 全局声明<br>├── libs/               # 第三方库扩展<br>│   └── vue-extend.d.ts<br>├── modules/            # 业务模块<br>│   └── user-api.d.ts<br>└── utils/              # 工具类型<br>    └── pagination.d.ts<br></code></pre></td></tr></table></figure>

<p>策略3：版本兼容处理</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 条件编译支持多版本</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&quot;some-lib&quot;</span> &#123;<br>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> &#123;<br>    <span class="hljs-comment">// @ts-ignore-next-line 兼容旧版本类型缺失</span><br>    <span class="hljs-attr">newFeature</span>?: <span class="hljs-built_in">boolean</span>; <br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>面试级考点</strong></p>
<ul>
<li>类型实例化深度限制：默认 50 层（通过 tsc –typeDepth 调整）</li>
<li>声明合并优先级：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">interface</span> A &#123; <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span> &#125;<br><span class="hljs-keyword">interface</span> A &#123; <span class="hljs-attr">x</span>: <span class="hljs-built_in">string</span> &#125;  <span class="hljs-comment">// ❌ 后续声明必须兼容前序声明</span><br></code></pre></td></tr></table></figure>

<ul>
<li>类型性能优化：</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// ✅ 高效：使用映射类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ReadonlyDeep</span>&lt;T&gt; = &#123; <span class="hljs-keyword">readonly</span> [K <span class="hljs-keyword">in</span> keyof T]: <span class="hljs-title class_">ReadonlyDeep</span>&lt;T[K]&gt; &#125;<br><br><span class="hljs-comment">// ❌ 低效：递归条件类型</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">SlowType</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> ? <span class="hljs-title class_">SlowType</span>&lt;T[keyof T]&gt; : T<br></code></pre></td></tr></table></figure>

<ul>
<li>d.ts 与 ts 文件差异：.d.ts 不包含实现，仅类型声明</li>
<li>实战案例：为 WebSocket 消息协议声明类型安全解析器</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">MessageProtocol</span> = &#123;<br>  <span class="hljs-attr">login</span>: &#123; <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">password</span>: <span class="hljs-built_in">string</span> &#125;;<br>  <span class="hljs-attr">joinRoom</span>: &#123; <span class="hljs-attr">roomId</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span> &#125;;<br>  <span class="hljs-comment">// 使用模板类型自动生成事件名约束</span><br>  [E <span class="hljs-keyword">in</span> <span class="hljs-string">`sys/<span class="hljs-subst">$&#123;<span class="hljs-string">&#x27;alert&#x27;</span> | <span class="hljs-string">&#x27;error&#x27;</span>&#125;</span>`</span>]: &#123; <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span> &#125;;<br>&#125;;<br><br><span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> handleMessage&lt;K <span class="hljs-keyword">extends</span> keyof <span class="hljs-title class_">MessageProtocol</span>&gt;(<br>  <span class="hljs-attr">type</span>: K,<br>  <span class="hljs-attr">handler</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-attr">payload</span>: <span class="hljs-title class_">MessageProtocol</span>[K]</span>) =&gt;</span> <span class="hljs-built_in">void</span><br>): <span class="hljs-built_in">void</span>;<br></code></pre></td></tr></table></figure>

<h2 id="3-3-代码质量保障"><a href="#3-3-代码质量保障" class="headerlink" title="3.3 代码质量保障"></a>3.3 代码质量保障</h2><h3 id="3-3-1-ESLint-类型规则配置"><a href="#3-3-1-ESLint-类型规则配置" class="headerlink" title="3.3.1 ESLint 类型规则配置"></a>3.3.1 ESLint 类型规则配置</h3><h3 id="3-3-2-单元测试类型检查方案"><a href="#3-3-2-单元测试类型检查方案" class="headerlink" title="3.3.2 单元测试类型检查方案"></a>3.3.2 单元测试类型检查方案</h3><h3 id="3-3-3-自定义类型规则开发"><a href="#3-3-3-自定义类型规则开发" class="headerlink" title="3.3.3 自定义类型规则开发"></a>3.3.3 自定义类型规则开发</h3><h3 id="3-3-4-CI-CD-中的类型检查"><a href="#3-3-4-CI-CD-中的类型检查" class="headerlink" title="3.3.4 CI&#x2F;CD 中的类型检查"></a>3.3.4 CI&#x2F;CD 中的类型检查</h3><h2 id="3-4-构建优化"><a href="#3-4-构建优化" class="headerlink" title="3.4 构建优化"></a>3.4 构建优化</h2><h3 id="3-4-1-Webpack-构建缓存配置"><a href="#3-4-1-Webpack-构建缓存配置" class="headerlink" title="3.4.1 Webpack 构建缓存配置"></a>3.4.1 Webpack 构建缓存配置</h3><h3 id="3-4-2-Babel-与-tsc-编译对比"><a href="#3-4-2-Babel-与-tsc-编译对比" class="headerlink" title="3.4.2 Babel 与 tsc 编译对比"></a>3.4.2 Babel 与 tsc 编译对比</h3><h3 id="3-4-3-增量编译原理与实践"><a href="#3-4-3-增量编译原理与实践" class="headerlink" title="3.4.3 增量编译原理与实践"></a>3.4.3 增量编译原理与实践</h3><h3 id="3-4-4-Monorepo-类型管理策略"><a href="#3-4-4-Monorepo-类型管理策略" class="headerlink" title="3.4.4 Monorepo 类型管理策略"></a>3.4.4 Monorepo 类型管理策略</h3><h1 id="四、框架集成实践"><a href="#四、框架集成实践" class="headerlink" title="四、框架集成实践"></a>四、框架集成实践</h1><h2 id="4-1-React-生态集成"><a href="#4-1-React-生态集成" class="headerlink" title="4.1 React 生态集成"></a>4.1 React 生态集成</h2><h3 id="4-1-1-组件-Props-高级类型设计"><a href="#4-1-1-组件-Props-高级类型设计" class="headerlink" title="4.1.1 组件 Props 高级类型设计"></a>4.1.1 组件 Props 高级类型设计</h3><h3 id="4-1-2-Hooks-泛型类型定义"><a href="#4-1-2-Hooks-泛型类型定义" class="headerlink" title="4.1.2 Hooks 泛型类型定义"></a>4.1.2 Hooks 泛型类型定义</h3><h3 id="4-1-3-Redux-Toolkit-类型安全"><a href="#4-1-3-Redux-Toolkit-类型安全" class="headerlink" title="4.1.3 Redux Toolkit 类型安全"></a>4.1.3 Redux Toolkit 类型安全</h3><h3 id="4-1-4-React-Router-类型守卫"><a href="#4-1-4-React-Router-类型守卫" class="headerlink" title="4.1.4 React Router 类型守卫"></a>4.1.4 React Router 类型守卫</h3><h2 id="4-2-Vue-3-类型系统"><a href="#4-2-Vue-3-类型系统" class="headerlink" title="4.2 Vue 3 类型系统"></a>4.2 Vue 3 类型系统</h2><h3 id="4-2-1-Composition-API-类型推导"><a href="#4-2-1-Composition-API-类型推导" class="headerlink" title="4.2.1 Composition API 类型推导"></a>4.2.1 Composition API 类型推导</h3><h3 id="4-2-2-组件泛型-Props-实现"><a href="#4-2-2-组件泛型-Props-实现" class="headerlink" title="4.2.2 组件泛型 Props 实现"></a>4.2.2 组件泛型 Props 实现</h3><h3 id="4-2-3-Pinia-状态管理类型安全"><a href="#4-2-3-Pinia-状态管理类型安全" class="headerlink" title="4.2.3 Pinia 状态管理类型安全"></a>4.2.3 Pinia 状态管理类型安全</h3><h3 id="4-2-4-Volar-类型增强实践"><a href="#4-2-4-Volar-类型增强实践" class="headerlink" title="4.2.4 Volar 类型增强实践"></a>4.2.4 Volar 类型增强实践</h3><h2 id="4-3-Node-js-后端开发"><a href="#4-3-Node-js-后端开发" class="headerlink" title="4.3 Node.js 后端开发"></a>4.3 Node.js 后端开发</h2><h3 id="4-3-1-Express-Koa-中间件类型"><a href="#4-3-1-Express-Koa-中间件类型" class="headerlink" title="4.3.1 Express&#x2F;Koa 中间件类型"></a>4.3.1 Express&#x2F;Koa 中间件类型</h3><h3 id="4-3-2-ORM-框架类型安全查询"><a href="#4-3-2-ORM-框架类型安全查询" class="headerlink" title="4.3.2 ORM 框架类型安全查询"></a>4.3.2 ORM 框架类型安全查询</h3><h3 id="4-3-3-RPC-通信类型契约"><a href="#4-3-3-RPC-通信类型契约" class="headerlink" title="4.3.3 RPC 通信类型契约"></a>4.3.3 RPC 通信类型契约</h3><h3 id="4-3-4-分布式事务类型保障"><a href="#4-3-4-分布式事务类型保障" class="headerlink" title="4.3.4 分布式事务类型保障"></a>4.3.4 分布式事务类型保障</h3><h1 id="五、性能优化"><a href="#五、性能优化" class="headerlink" title="五、性能优化"></a>五、性能优化</h1><h2 id="5-1-编译性能优化"><a href="#5-1-编译性能优化" class="headerlink" title="5.1 编译性能优化"></a>5.1 编译性能优化</h2><h3 id="5-1-1-项目引用-Project-References"><a href="#5-1-1-项目引用-Project-References" class="headerlink" title="5.1.1 项目引用(Project References)"></a>5.1.1 项目引用(Project References)</h3><h3 id="5-1-2-增量编译原理剖析"><a href="#5-1-2-增量编译原理剖析" class="headerlink" title="5.1.2 增量编译原理剖析"></a>5.1.2 增量编译原理剖析</h3><h3 id="5-1-3-分布式编译方案"><a href="#5-1-3-分布式编译方案" class="headerlink" title="5.1.3 分布式编译方案"></a>5.1.3 分布式编译方案</h3><h3 id="5-1-4-编译器缓存策略"><a href="#5-1-4-编译器缓存策略" class="headerlink" title="5.1.4 编译器缓存策略"></a>5.1.4 编译器缓存策略</h3><h2 id="5-2-类型性能优化"><a href="#5-2-类型性能优化" class="headerlink" title="5.2 类型性能优化"></a>5.2 类型性能优化</h2><h3 id="5-2-1-避免过度类型实例化"><a href="#5-2-1-避免过度类型实例化" class="headerlink" title="5.2.1 避免过度类型实例化"></a>5.2.1 避免过度类型实例化</h3><h3 id="5-2-2-条件类型短路技巧"><a href="#5-2-2-条件类型短路技巧" class="headerlink" title="5.2.2 条件类型短路技巧"></a>5.2.2 条件类型短路技巧</h3><h3 id="5-2-3-类型缓存策略实现"><a href="#5-2-3-类型缓存策略实现" class="headerlink" title="5.2.3 类型缓存策略实现"></a>5.2.3 类型缓存策略实现</h3><h3 id="5-2-4-类型复杂度分析"><a href="#5-2-4-类型复杂度分析" class="headerlink" title="5.2.4 类型复杂度分析"></a>5.2.4 类型复杂度分析</h3><h2 id="5-3-产物优化"><a href="#5-3-产物优化" class="headerlink" title="5.3 产物优化"></a>5.3 产物优化</h2><h3 id="5-3-1-Tree-Shaking-原理与实现"><a href="#5-3-1-Tree-Shaking-原理与实现" class="headerlink" title="5.3.1 Tree Shaking 原理与实现"></a>5.3.1 Tree Shaking 原理与实现</h3><h3 id="5-3-2-代码分割类型保障"><a href="#5-3-2-代码分割类型保障" class="headerlink" title="5.3.2 代码分割类型保障"></a>5.3.2 代码分割类型保障</h3><h3 id="5-3-3-运行时类型检查方案"><a href="#5-3-3-运行时类型检查方案" class="headerlink" title="5.3.3 运行时类型检查方案"></a>5.3.3 运行时类型检查方案</h3><h3 id="5-3-4-类型擦除与体积控制"><a href="#5-3-4-类型擦除与体积控制" class="headerlink" title="5.3.4 类型擦除与体积控制"></a>5.3.4 类型擦除与体积控制</h3><h1 id="六、综合能力"><a href="#六、综合能力" class="headerlink" title="六、综合能力"></a>六、综合能力</h1><h2 id="6-1-设计模式类型实现"><a href="#6-1-设计模式类型实现" class="headerlink" title="6.1 设计模式类型实现"></a>6.1 设计模式类型实现</h2><h3 id="6-1-1-装饰器元编程类型安全"><a href="#6-1-1-装饰器元编程类型安全" class="headerlink" title="6.1.1 装饰器元编程类型安全"></a>6.1.1 装饰器元编程类型安全</h3><h3 id="6-1-2-依赖注入类型推导"><a href="#6-1-2-依赖注入类型推导" class="headerlink" title="6.1.2 依赖注入类型推导"></a>6.1.2 依赖注入类型推导</h3><h3 id="6-1-3-策略模式类型映射"><a href="#6-1-3-策略模式类型映射" class="headerlink" title="6.1.3 策略模式类型映射"></a>6.1.3 策略模式类型映射</h3><h3 id="6-1-4-状态机类型实现"><a href="#6-1-4-状态机类型实现" class="headerlink" title="6.1.4 状态机类型实现"></a>6.1.4 状态机类型实现</h3><h2 id="6-2-调试与重构"><a href="#6-2-调试与重构" class="headerlink" title="6.2 调试与重构"></a>6.2 调试与重构</h2><h3 id="6-2-1-复杂类型错误追踪技巧"><a href="#6-2-1-复杂类型错误追踪技巧" class="headerlink" title="6.2.1 复杂类型错误追踪技巧"></a>6.2.1 复杂类型错误追踪技巧</h3><h3 id="6-2-2-声明文件调试方法论"><a href="#6-2-2-声明文件调试方法论" class="headerlink" title="6.2.2 声明文件调试方法论"></a>6.2.2 声明文件调试方法论</h3><h3 id="6-2-3-遗留系统渐进式迁移"><a href="#6-2-3-遗留系统渐进式迁移" class="headerlink" title="6.2.3 遗留系统渐进式迁移"></a>6.2.3 遗留系统渐进式迁移</h3><h3 id="6-2-4-类型安全的重构保障"><a href="#6-2-4-类型安全的重构保障" class="headerlink" title="6.2.4 类型安全的重构保障"></a>6.2.4 类型安全的重构保障</h3><h2 id="6-3-前沿架构"><a href="#6-3-前沿架构" class="headerlink" title="6.3 前沿架构"></a>6.3 前沿架构</h2><h3 id="6-3-1-微前端类型通信方案"><a href="#6-3-1-微前端类型通信方案" class="headerlink" title="6.3.1 微前端类型通信方案"></a>6.3.1 微前端类型通信方案</h3><h3 id="6-3-2-Serverless-函数类型安全"><a href="#6-3-2-Serverless-函数类型安全" class="headerlink" title="6.3.2 Serverless 函数类型安全"></a>6.3.2 Serverless 函数类型安全</h3><h3 id="6-3-3-WebAssembly-类型集成"><a href="#6-3-3-WebAssembly-类型集成" class="headerlink" title="6.3.3 WebAssembly 类型集成"></a>6.3.3 WebAssembly 类型集成</h3><h3 id="6-3-4-Web-Workers-类型通信"><a href="#6-3-4-Web-Workers-类型通信" class="headerlink" title="6.3.4 Web Workers 类型通信"></a>6.3.4 Web Workers 类型通信</h3><h2 id="6-4-面试专项"><a href="#6-4-面试专项" class="headerlink" title="6.4 面试专项"></a>6.4 面试专项</h2><h3 id="6-4-1-类型体操解题思路"><a href="#6-4-1-类型体操解题思路" class="headerlink" title="6.4.1 类型体操解题思路"></a>6.4.1 类型体操解题思路</h3><h3 id="6-4-2-编译原理相关问题"><a href="#6-4-2-编译原理相关问题" class="headerlink" title="6.4.2 编译原理相关问题"></a>6.4.2 编译原理相关问题</h3><h3 id="6-4-3-框架集成设计问题"><a href="#6-4-3-框架集成设计问题" class="headerlink" title="6.4.3 框架集成设计问题"></a>6.4.3 框架集成设计问题</h3><h3 id="6-4-4-性能优化指标分析"><a href="#6-4-4-性能优化指标分析" class="headerlink" title="6.4.4 性能优化指标分析"></a>6.4.4 性能优化指标分析</h3>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/TypeScript/" class="category-chain-item">TypeScript</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/TypeScript/" class="print-no-link">#TypeScript</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>TypeScript 专题知识学习</div>
      <div>https://tianfei92.github.io/2025/07/09/TypeScript Study Notes/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Ariel</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年7月9日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/07/12/Docker%20Study%20Notes/" title="Docker 专题知识学习">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Docker 专题知识学习</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/07/05/NodeJS%20Study%20Notes/" title="NodeJS 专题知识学习">
                        <span class="hidden-mobile">NodeJS 专题知识学习</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  



  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
