<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#000" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#000">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"tianfei92.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.23.2","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":false,"codeblock":{"theme":{"light":"atom-one-dark","dark":"atom-one-dark"},"prism":{"light":"prism-okaidia","dark":"prism-okaidia"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false,"highlight_theme":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="一、TypeScript 基础与核心概念1.1 类型系统深入1.1.1 基本类型与类型推断机制基本类型（Primitive Types）    类型 描述 示例    string 字符串类型 let name: string &#x3D; “Alice”   number 数值类型（含整数&#x2F;浮点数） let age: number &#x3D; 30   boolean 布尔类型 le">
<meta property="og:type" content="article">
<meta property="og:title" content="专题知识学习：TypeScript">
<meta property="og:url" content="https://tianfei92.github.io/2025/07/09/TypeScript%20Study%20Notes/index.html">
<meta property="og:site_name" content="Ariel&#39;s Blog">
<meta property="og:description" content="一、TypeScript 基础与核心概念1.1 类型系统深入1.1.1 基本类型与类型推断机制基本类型（Primitive Types）    类型 描述 示例    string 字符串类型 let name: string &#x3D; “Alice”   number 数值类型（含整数&#x2F;浮点数） let age: number &#x3D; 30   boolean 布尔类型 le">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-07-09T09:15:51.000Z">
<meta property="article:modified_time" content="2025-07-11T01:39:13.068Z">
<meta property="article:author" content="Ariel">
<meta property="article:tag" content="TypeScript">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://tianfei92.github.io/2025/07/09/TypeScript%20Study%20Notes/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://tianfei92.github.io/2025/07/09/TypeScript%20Study%20Notes/","path":"2025/07/09/TypeScript Study Notes/","title":"专题知识学习：TypeScript"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>专题知识学习：TypeScript | Ariel's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.7.0/mermaid.min.js","integrity":"sha256-4+IKDqhZ/sXjc8Wtl2/MsxI4e0s1KpEVdbEP7V/Lz8U="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Ariel's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">我本地没问题啊</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81TypeScript-%E5%9F%BA%E7%A1%80%E4%B8%8E%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-text">一、TypeScript 基础与核心概念</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E6%B7%B1%E5%85%A5"><span class="nav-text">1.1 类型系统深入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-1-%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E4%B8%8E%E7%B1%BB%E5%9E%8B%E6%8E%A8%E6%96%AD%E6%9C%BA%E5%88%B6"><span class="nav-text">1.1.1 基本类型与类型推断机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-2-%E5%AD%97%E9%9D%A2%E9%87%8F%E7%B1%BB%E5%9E%8B%E4%B8%8E%E8%81%94%E5%90%88%E7%B1%BB%E5%9E%8B%E5%AE%9E%E6%88%98"><span class="nav-text">1.1.2 字面量类型与联合类型实战</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-3-any-unknown-never-%E7%9A%84%E5%8C%BA%E5%88%AB%E4%B8%8E%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-text">1.1.3 any&#x2F;unknown&#x2F;never 的区别与应用场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-4-%E7%B1%BB%E5%9E%8B%E6%96%AD%E8%A8%80%E4%B8%8E%E7%B1%BB%E5%9E%8B%E5%AE%88%E5%8D%AB%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-text">1.1.4 类型断言与类型守卫实现原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-5-%E7%BB%93%E6%9E%84%E5%8C%96%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E4%B8%8E%E9%B8%AD%E5%AD%90%E7%B1%BB%E5%9E%8B"><span class="nav-text">1.1.5 结构化类型系统与鸭子类型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-%E6%8E%A5%E5%8F%A3%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1"><span class="nav-text">1.2 接口与面向对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-1-%E6%8E%A5%E5%8F%A3%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7%EF%BC%88%E5%8F%AF%E9%80%89%E5%B1%9E%E6%80%A7%E3%80%81%E5%8F%AA%E8%AF%BB%E5%B1%9E%E6%80%A7%E3%80%81%E7%B4%A2%E5%BC%95%E7%AD%BE%E5%90%8D%EF%BC%89"><span class="nav-text">1.2.1 接口高级特性（可选属性、只读属性、索引签名）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-2-%E7%B1%BB%E7%BB%A7%E6%89%BF%E4%BD%93%E7%B3%BB%E4%B8%8E%E8%AE%BF%E9%97%AE%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="nav-text">1.2.2 类继承体系与访问修饰符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-3-%E6%8A%BD%E8%B1%A1%E7%B1%BB%E4%B8%8E%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E8%A7%84%E8%8C%83"><span class="nav-text">1.2.3 抽象类与接口实现规范</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-4-%E7%B1%BB%E9%9D%99%E6%80%81%E6%88%90%E5%91%98%E4%B8%8E%E6%9E%84%E9%80%A0%E7%AD%BE%E5%90%8D"><span class="nav-text">1.2.4 类静态成员与构造签名</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E5%87%BD%E6%95%B0%E4%B8%8E%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B"><span class="nav-text">1.3 函数与泛型编程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-1-%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89%E4%B8%8E%E4%B8%8A%E4%B8%8B%E6%96%87%E6%8E%A8%E6%96%AD"><span class="nav-text">1.3.1 函数类型定义与上下文推断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-2-%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD%E7%9A%84%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5"><span class="nav-text">1.3.2 函数重载的工程实践</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-3-%E6%B3%9B%E5%9E%8B%E7%BA%A6%E6%9D%9F%E4%B8%8E%E9%BB%98%E8%AE%A4%E7%B1%BB%E5%9E%8B"><span class="nav-text">1.3.3 泛型约束与默认类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-4-%E6%B3%9B%E5%9E%8B%E5%9C%A8%E6%8E%A5%E5%8F%A3-%E7%B1%BB%E4%B8%AD%E7%9A%84%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8"><span class="nav-text">1.3.4 泛型在接口&#x2F;类中的高级应用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F"><span class="nav-text">1.4 模块系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-1-ES-Module-%E4%B8%8E-CommonJS-%E4%BA%92%E6%93%8D%E4%BD%9C"><span class="nav-text">1.4.1 ES Module 与 CommonJS 互操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-2-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%8E%E7%8E%B0%E4%BB%A3%E6%A8%A1%E5%9D%97%E5%AF%B9%E6%AF%94"><span class="nav-text">1.4.2 命名空间与现代模块对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-3-%E6%A8%A1%E5%9D%97%E8%A7%A3%E6%9E%90%E7%AD%96%E7%95%A5%E4%B8%8E%E8%B7%AF%E5%BE%84%E6%98%A0%E5%B0%84"><span class="nav-text">1.4.3 模块解析策略与路径映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-4-%E5%8A%A8%E6%80%81%E5%AF%BC%E5%85%A5%E4%B8%8E%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8"><span class="nav-text">1.4.4 动态导入与代码分割类型安全</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E9%AB%98%E7%BA%A7%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F"><span class="nav-text">二、高级类型系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%9E%8B%E5%8E%9F%E7%90%86"><span class="nav-text">2.1 工具类型原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-1-%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%9E%8B%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="nav-text">2.1.1 内置工具类型源码解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-2-%E7%B1%BB%E5%9E%8B%E6%98%A0%E5%B0%84%E4%BF%AE%E9%A5%B0%E7%AC%A6%EF%BC%88-%EF%BC%89%E5%8E%9F%E7%90%86"><span class="nav-text">2.1.2 类型映射修饰符（+&#x2F;-）原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-3-%E6%9D%A1%E4%BB%B6%E7%B1%BB%E5%9E%8B%E5%88%86%E5%B8%83%E5%BC%8F%E7%89%B9%E6%80%A7"><span class="nav-text">2.1.3 条件类型分布式特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-4-infer-%E5%85%B3%E9%94%AE%E5%AD%97%E4%B8%8E%E7%B1%BB%E5%9E%8B%E6%8F%90%E5%8F%96"><span class="nav-text">2.1.4 infer 关键字与类型提取</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E7%B1%BB%E5%9E%8B%E4%BD%93%E6%93%8D%E5%AE%9E%E6%88%98"><span class="nav-text">2.2 类型体操实战</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-%E5%87%BD%E6%95%B0%E6%9F%AF%E9%87%8C%E5%8C%96%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="nav-text">2.2.1 函数柯里化类型定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2-Promise-%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8%E7%B1%BB%E5%9E%8B%E6%8E%A8%E5%AF%BC"><span class="nav-text">2.2.2 Promise 链式调用类型推导</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-3-Redux-reducer-%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8%E5%AE%9E%E7%8E%B0"><span class="nav-text">2.2.3 Redux reducer 类型安全实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-4-%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0%E8%87%AA%E5%8A%A8%E7%B1%BB%E5%9E%8B%E6%8E%A8%E5%AF%BC"><span class="nav-text">2.2.4 路由参数自动类型推导</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-%E6%A8%A1%E6%9D%BF%E5%AD%97%E9%9D%A2%E9%87%8F%E7%B1%BB%E5%9E%8B"><span class="nav-text">2.3 模板字面量类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-1-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A8%A1%E6%9D%BF%E7%B1%BB%E5%9E%8B%E6%93%8D%E4%BD%9C"><span class="nav-text">2.3.1 字符串模板类型操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-2-Uppercase-Lowercase-%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="nav-text">2.3.2 Uppercase&#x2F;Lowercase 类型转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-3-%E8%B7%AF%E7%94%B1%E8%B7%AF%E5%BE%84%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D"><span class="nav-text">2.3.3 路由路径模式匹配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-4-%E5%9B%BD%E9%99%85%E5%8C%96%E9%94%AE%E5%90%8D%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8"><span class="nav-text">2.3.4 国际化键名自动补全</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-%E7%B1%BB%E5%9E%8B%E7%BC%96%E7%A8%8B%E4%BC%98%E5%8C%96"><span class="nav-text">2.4 类型编程优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-1-%E7%B1%BB%E5%9E%8B%E9%80%92%E5%BD%92%E4%B8%8E%E5%B0%BE%E9%80%92%E5%BD%92%E4%BC%98%E5%8C%96"><span class="nav-text">2.4.1 类型递归与尾递归优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-2-%E7%B1%BB%E5%9E%8B%E5%AE%9E%E4%BE%8B%E5%8C%96%E6%B7%B1%E5%BA%A6%E6%8E%A7%E5%88%B6"><span class="nav-text">2.4.2 类型实例化深度控制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-3-%E6%9D%A1%E4%BB%B6%E7%B1%BB%E5%9E%8B%E7%9F%AD%E8%B7%AF%E6%8A%80%E5%B7%A7"><span class="nav-text">2.4.3 条件类型短路技巧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-4-%E7%B1%BB%E5%9E%8B%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7"><span class="nav-text">2.4.4 类型性能分析工具</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%AE%9E%E8%B7%B5"><span class="nav-text">三、工程化实践</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-TSConfig-%E6%B7%B1%E5%BA%A6%E9%85%8D%E7%BD%AE"><span class="nav-text">3.1 TSConfig 深度配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-1-%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F%E5%85%A8%E5%AE%B6%E6%A1%B6%E9%85%8D%E7%BD%AE"><span class="nav-text">3.1.1 严格模式全家桶配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-2-%E6%A8%A1%E5%9D%97%E8%A7%A3%E6%9E%90%E7%AD%96%E7%95%A5%E5%AE%9E%E6%88%98"><span class="nav-text">3.1.2 模块解析策略实战</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-3-%E5%A3%B0%E6%98%8E%E6%96%87%E4%BB%B6%E7%94%9F%E6%88%90%E9%85%8D%E7%BD%AE"><span class="nav-text">3.1.3 声明文件生成配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-4-%E7%BC%96%E8%AF%91%E5%99%A8%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5"><span class="nav-text">3.1.4 编译器缓存策略</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E5%A3%B0%E6%98%8E%E6%96%87%E4%BB%B6-d-ts"><span class="nav-text">3.2 声明文件(.d.ts)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-1-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E7%B1%BB%E5%9E%8B%E6%89%A9%E5%B1%95%E6%8A%80%E5%B7%A7"><span class="nav-text">3.2.1 第三方库类型扩展技巧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-2-%E6%A8%A1%E5%9D%97%E5%A3%B0%E6%98%8E%E5%90%88%E5%B9%B6%E7%AD%96%E7%95%A5"><span class="nav-text">3.2.2 模块声明合并策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-3-%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="nav-text">3.2.3 全局变量类型定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-4-%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B%E5%A3%B0%E6%98%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-text">3.2.4 复杂类型声明最佳实践</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E4%BF%9D%E9%9A%9C"><span class="nav-text">3.3 代码质量保障</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-1-ESLint-%E7%B1%BB%E5%9E%8B%E8%A7%84%E5%88%99%E9%85%8D%E7%BD%AE"><span class="nav-text">3.3.1 ESLint 类型规则配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-2-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5%E6%96%B9%E6%A1%88"><span class="nav-text">3.3.2 单元测试类型检查方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E8%A7%84%E5%88%99%E5%BC%80%E5%8F%91"><span class="nav-text">3.3.3 自定义类型规则开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-4-CI-CD-%E4%B8%AD%E7%9A%84%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5"><span class="nav-text">3.3.4 CI&#x2F;CD 中的类型检查</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-%E6%9E%84%E5%BB%BA%E4%BC%98%E5%8C%96"><span class="nav-text">3.4 构建优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-1-Webpack-%E6%9E%84%E5%BB%BA%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE"><span class="nav-text">3.4.1 Webpack 构建缓存配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-2-Babel-%E4%B8%8E-tsc-%E7%BC%96%E8%AF%91%E5%AF%B9%E6%AF%94"><span class="nav-text">3.4.2 Babel 与 tsc 编译对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-3-%E5%A2%9E%E9%87%8F%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5"><span class="nav-text">3.4.3 增量编译原理与实践</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-4-Monorepo-%E7%B1%BB%E5%9E%8B%E7%AE%A1%E7%90%86%E7%AD%96%E7%95%A5"><span class="nav-text">3.4.4 Monorepo 类型管理策略</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E6%A1%86%E6%9E%B6%E9%9B%86%E6%88%90%E5%AE%9E%E8%B7%B5"><span class="nav-text">四、框架集成实践</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-React-%E7%94%9F%E6%80%81%E9%9B%86%E6%88%90"><span class="nav-text">4.1 React 生态集成</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-1-%E7%BB%84%E4%BB%B6-Props-%E9%AB%98%E7%BA%A7%E7%B1%BB%E5%9E%8B%E8%AE%BE%E8%AE%A1"><span class="nav-text">4.1.1 组件 Props 高级类型设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-2-Hooks-%E6%B3%9B%E5%9E%8B%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="nav-text">4.1.2 Hooks 泛型类型定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-3-Redux-Toolkit-%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8"><span class="nav-text">4.1.3 Redux Toolkit 类型安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-4-React-Router-%E7%B1%BB%E5%9E%8B%E5%AE%88%E5%8D%AB"><span class="nav-text">4.1.4 React Router 类型守卫</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-Vue-3-%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F"><span class="nav-text">4.2 Vue 3 类型系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-1-Composition-API-%E7%B1%BB%E5%9E%8B%E6%8E%A8%E5%AF%BC"><span class="nav-text">4.2.1 Composition API 类型推导</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-2-%E7%BB%84%E4%BB%B6%E6%B3%9B%E5%9E%8B-Props-%E5%AE%9E%E7%8E%B0"><span class="nav-text">4.2.2 组件泛型 Props 实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-3-Pinia-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8"><span class="nav-text">4.2.3 Pinia 状态管理类型安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-4-Volar-%E7%B1%BB%E5%9E%8B%E5%A2%9E%E5%BC%BA%E5%AE%9E%E8%B7%B5"><span class="nav-text">4.2.4 Volar 类型增强实践</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-Node-js-%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91"><span class="nav-text">4.3 Node.js 后端开发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-1-Express-Koa-%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%B1%BB%E5%9E%8B"><span class="nav-text">4.3.1 Express&#x2F;Koa 中间件类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-2-ORM-%E6%A1%86%E6%9E%B6%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8%E6%9F%A5%E8%AF%A2"><span class="nav-text">4.3.2 ORM 框架类型安全查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-3-RPC-%E9%80%9A%E4%BF%A1%E7%B1%BB%E5%9E%8B%E5%A5%91%E7%BA%A6"><span class="nav-text">4.3.3 RPC 通信类型契约</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-4-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%B1%BB%E5%9E%8B%E4%BF%9D%E9%9A%9C"><span class="nav-text">4.3.4 分布式事务类型保障</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-text">五、性能优化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-%E7%BC%96%E8%AF%91%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-text">5.1 编译性能优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-1-%E9%A1%B9%E7%9B%AE%E5%BC%95%E7%94%A8-Project-References"><span class="nav-text">5.1.1 项目引用(Project References)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-2-%E5%A2%9E%E9%87%8F%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90"><span class="nav-text">5.1.2 增量编译原理剖析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-3-%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%96%E8%AF%91%E6%96%B9%E6%A1%88"><span class="nav-text">5.1.3 分布式编译方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-4-%E7%BC%96%E8%AF%91%E5%99%A8%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5"><span class="nav-text">5.1.4 编译器缓存策略</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-%E7%B1%BB%E5%9E%8B%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-text">5.2 类型性能优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-1-%E9%81%BF%E5%85%8D%E8%BF%87%E5%BA%A6%E7%B1%BB%E5%9E%8B%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="nav-text">5.2.1 避免过度类型实例化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-2-%E6%9D%A1%E4%BB%B6%E7%B1%BB%E5%9E%8B%E7%9F%AD%E8%B7%AF%E6%8A%80%E5%B7%A7"><span class="nav-text">5.2.2 条件类型短路技巧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-3-%E7%B1%BB%E5%9E%8B%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5%E5%AE%9E%E7%8E%B0"><span class="nav-text">5.2.3 类型缓存策略实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-4-%E7%B1%BB%E5%9E%8B%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%88%86%E6%9E%90"><span class="nav-text">5.2.4 类型复杂度分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-%E4%BA%A7%E7%89%A9%E4%BC%98%E5%8C%96"><span class="nav-text">5.3 产物优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-1-Tree-Shaking-%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0"><span class="nav-text">5.3.1 Tree Shaking 原理与实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-2-%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2%E7%B1%BB%E5%9E%8B%E4%BF%9D%E9%9A%9C"><span class="nav-text">5.3.2 代码分割类型保障</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-3-%E8%BF%90%E8%A1%8C%E6%97%B6%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5%E6%96%B9%E6%A1%88"><span class="nav-text">5.3.3 运行时类型检查方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-4-%E7%B1%BB%E5%9E%8B%E6%93%A6%E9%99%A4%E4%B8%8E%E4%BD%93%E7%A7%AF%E6%8E%A7%E5%88%B6"><span class="nav-text">5.3.4 类型擦除与体积控制</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E7%BB%BC%E5%90%88%E8%83%BD%E5%8A%9B"><span class="nav-text">六、综合能力</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B1%BB%E5%9E%8B%E5%AE%9E%E7%8E%B0"><span class="nav-text">6.1 设计模式类型实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-1-%E8%A3%85%E9%A5%B0%E5%99%A8%E5%85%83%E7%BC%96%E7%A8%8B%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8"><span class="nav-text">6.1.1 装饰器元编程类型安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-2-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E7%B1%BB%E5%9E%8B%E6%8E%A8%E5%AF%BC"><span class="nav-text">6.1.2 依赖注入类型推导</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-3-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E7%B1%BB%E5%9E%8B%E6%98%A0%E5%B0%84"><span class="nav-text">6.1.3 策略模式类型映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-4-%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B1%BB%E5%9E%8B%E5%AE%9E%E7%8E%B0"><span class="nav-text">6.1.4 状态机类型实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-%E8%B0%83%E8%AF%95%E4%B8%8E%E9%87%8D%E6%9E%84"><span class="nav-text">6.2 调试与重构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-1-%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B%E9%94%99%E8%AF%AF%E8%BF%BD%E8%B8%AA%E6%8A%80%E5%B7%A7"><span class="nav-text">6.2.1 复杂类型错误追踪技巧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-2-%E5%A3%B0%E6%98%8E%E6%96%87%E4%BB%B6%E8%B0%83%E8%AF%95%E6%96%B9%E6%B3%95%E8%AE%BA"><span class="nav-text">6.2.2 声明文件调试方法论</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-3-%E9%81%97%E7%95%99%E7%B3%BB%E7%BB%9F%E6%B8%90%E8%BF%9B%E5%BC%8F%E8%BF%81%E7%A7%BB"><span class="nav-text">6.2.3 遗留系统渐进式迁移</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-4-%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8%E7%9A%84%E9%87%8D%E6%9E%84%E4%BF%9D%E9%9A%9C"><span class="nav-text">6.2.4 类型安全的重构保障</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-%E5%89%8D%E6%B2%BF%E6%9E%B6%E6%9E%84"><span class="nav-text">6.3 前沿架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-1-%E5%BE%AE%E5%89%8D%E7%AB%AF%E7%B1%BB%E5%9E%8B%E9%80%9A%E4%BF%A1%E6%96%B9%E6%A1%88"><span class="nav-text">6.3.1 微前端类型通信方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-2-Serverless-%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8"><span class="nav-text">6.3.2 Serverless 函数类型安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-3-WebAssembly-%E7%B1%BB%E5%9E%8B%E9%9B%86%E6%88%90"><span class="nav-text">6.3.3 WebAssembly 类型集成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-4-Web-Workers-%E7%B1%BB%E5%9E%8B%E9%80%9A%E4%BF%A1"><span class="nav-text">6.3.4 Web Workers 类型通信</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-4-%E9%9D%A2%E8%AF%95%E4%B8%93%E9%A1%B9"><span class="nav-text">6.4 面试专项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-1-%E7%B1%BB%E5%9E%8B%E4%BD%93%E6%93%8D%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF"><span class="nav-text">6.4.1 类型体操解题思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-2-%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98"><span class="nav-text">6.4.2 编译原理相关问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-3-%E6%A1%86%E6%9E%B6%E9%9B%86%E6%88%90%E8%AE%BE%E8%AE%A1%E9%97%AE%E9%A2%98"><span class="nav-text">6.4.3 框架集成设计问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-4-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%8C%87%E6%A0%87%E5%88%86%E6%9E%90"><span class="nav-text">6.4.4 性能优化指标分析</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ariel"
      src="/uploads/avatar.JPG">
  <p class="site-author-name" itemprop="name">Ariel</p>
  <div class="site-description" itemprop="description">神游在初见的午后</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/tianfei92" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tianfei92" rel="noopener me" target="_blank">GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:tian.fi@outlook.com" title="E-Mail → mailto:tian.fi@outlook.com" rel="noopener me" target="_blank">E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://juejin.cn/user/3913917124325127" title="Juejin → https:&#x2F;&#x2F;juejin.cn&#x2F;user&#x2F;3913917124325127" rel="noopener me" target="_blank">Juejin</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tianfei92.github.io/2025/07/09/TypeScript%20Study%20Notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.JPG">
      <meta itemprop="name" content="Ariel">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ariel's Blog">
      <meta itemprop="description" content="神游在初见的午后">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="专题知识学习：TypeScript | Ariel's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          专题知识学习：TypeScript
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-07-09 17:15:51" itemprop="dateCreated datePublished" datetime="2025-07-09T17:15:51+08:00">2025-07-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-07-11 09:39:13" itemprop="dateModified" datetime="2025-07-11T09:39:13+08:00">2025-07-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/TypeScript/" itemprop="url" rel="index"><span itemprop="name">TypeScript</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>26k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:36</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="一、TypeScript-基础与核心概念"><a href="#一、TypeScript-基础与核心概念" class="headerlink" title="一、TypeScript 基础与核心概念"></a>一、TypeScript 基础与核心概念</h1><h2 id="1-1-类型系统深入"><a href="#1-1-类型系统深入" class="headerlink" title="1.1 类型系统深入"></a>1.1 类型系统深入</h2><h3 id="1-1-1-基本类型与类型推断机制"><a href="#1-1-1-基本类型与类型推断机制" class="headerlink" title="1.1.1 基本类型与类型推断机制"></a>1.1.1 基本类型与类型推断机制</h3><p><strong>基本类型（Primitive Types）</strong></p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">描述</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">string</td>
<td align="left">字符串类型</td>
<td align="left">let name: string &#x3D; “Alice”</td>
</tr>
<tr>
<td align="left">number</td>
<td align="left">数值类型（含整数&#x2F;浮点数）</td>
<td align="left">let age: number &#x3D; 30</td>
</tr>
<tr>
<td align="left">boolean</td>
<td align="left">布尔类型</td>
<td align="left">let isDone: boolean &#x3D; true</td>
</tr>
<tr>
<td align="left">null</td>
<td align="left">空值（需开启 strictNullChecks）</td>
<td align="left">let n: null &#x3D; null</td>
</tr>
<tr>
<td align="left">undefined	未定义值</td>
<td align="left">let u: undefined &#x3D; undefined</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">symbol</td>
<td align="left">唯一标识符（ES6）</td>
<td align="left">const sym: symbol &#x3D; Symbol()</td>
</tr>
<tr>
<td align="left">bigint</td>
<td align="left">大整数（ES2020）</td>
<td align="left">let big: bigint &#x3D; 100n</td>
</tr>
<tr>
<td align="left">void</td>
<td align="left">无返回值（函数）</td>
<td align="left">function warn(): void { console.log() }</td>
</tr>
</tbody></table>
<span id="more"></span>

<p><strong>类型推断机制（Type Inference）</strong></p>
<p>(1) 变量初始化推断</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>          <span class="token comment">// 推断为 number</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token string">"text"</span><span class="token punctuation">;</span>    <span class="token comment">// 推断为 "text"（字面量类型）</span>
<span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token punctuation">&#123;</span> x<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token comment">// 推断为 &#123; x: number &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>(2) 函数返回值推断</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>      <span class="token comment">// 自动推断返回 number</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 推断返回 boolean</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>(3) 上下文推断（Contextual Typing）</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 回调函数参数根据上下文推断类型</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>v <span class="token operator">=></span> v <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// v 推断为 number</span>

<span class="token comment">// 事件处理函数参数推断</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> e <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// e 推断为 MouseEvent</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>特殊推断场景</strong></p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">推断行为</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">未初始化变量</td>
<td align="left">推断为 any（非严格模式）</td>
<td align="left">let x; → x: any</td>
</tr>
<tr>
<td align="left">联合类型初始化</td>
<td align="left">推断所有可能类型的联合</td>
<td align="left">let arr &#x3D; [0, “a”] → <code>(number	string)[]</code></td>
</tr>
<tr>
<td align="left">const 常量断言</td>
<td align="left">推断为字面量类型</td>
<td align="left">const size &#x3D; 100 as const → 100</td>
</tr>
</tbody></table>
<p><strong>类型推断与显示注解对比</strong></p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">推荐方式</th>
<th align="left">原因</th>
</tr>
</thead>
<tbody><tr>
<td align="left">函数参数</td>
<td align="left">显示注解</td>
<td align="left">避免 any 传播风险</td>
</tr>
<tr>
<td align="left">复杂对象字面量</td>
<td align="left">显示注解或接口</td>
<td align="left">确保结构符合预期</td>
</tr>
<tr>
<td align="left">简单变量初始化</td>
<td align="left">依赖类型推断</td>
<td align="left">减少冗余代码</td>
</tr>
<tr>
<td align="left">函数返回值</td>
<td align="left">依赖类型推断</td>
<td align="left">保持与实现同步（除公开API文档外）</td>
</tr>
</tbody></table>
<h3 id="1-1-2-字面量类型与联合类型实战"><a href="#1-1-2-字面量类型与联合类型实战" class="headerlink" title="1.1.2 字面量类型与联合类型实战"></a>1.1.2 字面量类型与联合类型实战</h3><p><strong>字面量类型（Literal Types）</strong></p>
<p>核心概念：将值作为类型使用，限制变量只能取特定值。</p>
<table>
<thead>
<tr>
<th align="left">分类</th>
<th align="left">语法示例</th>
<th align="left">类型表示</th>
</tr>
</thead>
<tbody><tr>
<td align="left">字符串字面量</td>
<td align="left">let dir: “UP” &#x3D; “UP”</td>
<td align="left">“UP”</td>
</tr>
<tr>
<td align="left">数字字面量</td>
<td align="left">let size: 100 &#x3D; 100</td>
<td align="left">100</td>
</tr>
<tr>
<td align="left">布尔字面量</td>
<td align="left">let flag: true &#x3D; true</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">模板字面量</td>
<td align="left">type T &#x3D; prefix_${string}&#96;&#96;</td>
<td align="left">模式匹配类型</td>
</tr>
</tbody></table>
<p>工程价值：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 替代枚举（更轻量）</span>
<span class="token keyword">type</span> <span class="token class-name">HttpMethod</span> <span class="token operator">=</span> <span class="token string">"GET"</span> <span class="token operator">|</span> <span class="token string">"POST"</span> <span class="token operator">|</span> <span class="token string">"PUT"</span> <span class="token operator">|</span> <span class="token string">"DELETE"</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span>method<span class="token operator">:</span> HttpMethod<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token punctuation">&#125;</span>

<span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ✅</span>
<span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token string">"COPY"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🚫 编译错误：非允许值</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>联合类型（Union Types）</strong></p>
<p>核心概念：组合多个类型，表示值可以是其中任意一种类型。</p>
<p>语法与特性：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">ID</span></span> <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">;</span>         <span class="token comment">// 基础联合</span>
<span class="token keyword">type</span> <span class="token class-name">Status</span> <span class="token operator">=</span> <span class="token string">"idle"</span> <span class="token operator">|</span> <span class="token string">"loading"</span><span class="token punctuation">;</span>  <span class="token comment">// 字面量联合</span>
<span class="token keyword">type</span> <span class="token class-name">Shape</span> <span class="token operator">=</span> Circle <span class="token operator">|</span> Square<span class="token punctuation">;</span>      <span class="token comment">// 对象联合</span>

<span class="token comment">// 联合类型特性：</span>
<span class="token keyword">let</span> id<span class="token operator">:</span> <span class="token constant">ID</span> <span class="token operator">=</span> <span class="token string">"abc123"</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 允许字符串</span>
id <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>              <span class="token comment">// ✅ 允许数字</span>
id <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>             <span class="token comment">// 🚫 不允许布尔值</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>类型收窄实战（Type Narrowing）</strong></p>
<p>核心方法：在代码分支中缩小联合类型范围</p>
<table>
<thead>
<tr>
<th align="left">技术</th>
<th align="left">示例</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">typeof 守卫</td>
<td align="left"><code>if (typeof val === &quot;string&quot;) &#123; val.toUpperCase() &#125;</code></td>
<td align="left">基本类型联合</td>
</tr>
<tr>
<td align="left">instanceof 守卫</td>
<td align="left"><code>if (err instanceof Error) &#123; console.log(err.message) &#125;</code></td>
<td align="left">类实例联合</td>
</tr>
<tr>
<td align="left">相等性检查</td>
<td align="left"><code>if (status === &quot;loading&quot;) &#123; showSpinner() &#125;</code></td>
<td align="left">字面量联合</td>
</tr>
<tr>
<td align="left">自定义守卫</td>
<td align="left"><code>function isFish(pet: Fish Bird): pet is Fish &#123; return &quot;swim&quot; in pet &#125;</code></td>
<td align="left">复杂对象联合</td>
</tr>
<tr>
<td align="left">可辨识联合</td>
<td align="left">通过共同字段区分类型（见下例）</td>
<td align="left">对象联合（设计模式）</td>
</tr>
</tbody></table>
<p>可辨识联合实战：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// Step 1: 定义具有kind字段的联合类型</span>
<span class="token keyword">type</span> <span class="token class-name">Shape</span> <span class="token operator">=</span> 
  <span class="token operator">|</span> <span class="token punctuation">&#123;</span> kind<span class="token operator">:</span> <span class="token string">"circle"</span><span class="token punctuation">;</span> radius<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span> 
  <span class="token operator">|</span> <span class="token punctuation">&#123;</span> kind<span class="token operator">:</span> <span class="token string">"square"</span><span class="token punctuation">;</span> size<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// Step 2: 使用kind字段收窄类型</span>
<span class="token keyword">function</span> <span class="token function">getArea</span><span class="token punctuation">(</span>shape<span class="token operator">:</span> Shape<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>shape<span class="token punctuation">.</span>kind<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">"circle"</span><span class="token operator">:</span>
      <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> shape<span class="token punctuation">.</span>radius <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">// 此分支shape被收窄为圆形</span>
    <span class="token keyword">case</span> <span class="token string">"square"</span><span class="token operator">:</span>
      <span class="token keyword">return</span> shape<span class="token punctuation">.</span>size <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">;</span>              <span class="token comment">// 此分支shape被收窄为方形</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程最佳实践</strong></p>
<p>(1) 避免过度使用字面量联合</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 不推荐：直接使用字面量</span>
<span class="token keyword">function</span> <span class="token function">setColor</span><span class="token punctuation">(</span>color<span class="token operator">:</span> <span class="token string">"red"</span> <span class="token operator">|</span> <span class="token string">"green"</span> <span class="token operator">|</span> <span class="token string">"blue"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token punctuation">&#125;</span>

<span class="token comment">// 推荐：使用命名类型</span>
<span class="token keyword">type</span> <span class="token class-name">PrimaryColor</span> <span class="token operator">=</span> <span class="token string">"red"</span> <span class="token operator">|</span> <span class="token string">"green"</span> <span class="token operator">|</span> <span class="token string">"blue"</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">setColor</span><span class="token punctuation">(</span>color<span class="token operator">:</span> PrimaryColor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(2) 联合类型与函数重载配合</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 根据参数类型返回不同结果</span>
<span class="token keyword">function</span> <span class="token function">padLeft</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> padding<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> padding <span class="token operator">===</span> <span class="token string">"number"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">" "</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span>padding<span class="token punctuation">)</span> <span class="token operator">+</span> value<span class="token punctuation">;</span>  <span class="token comment">// 数字处理</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> padding <span class="token operator">+</span> value<span class="token punctuation">;</span>                <span class="token comment">// 字符串处理</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-1-3-any-unknown-never-的区别与应用场景"><a href="#1-1-3-any-unknown-never-的区别与应用场景" class="headerlink" title="1.1.3 any&#x2F;unknown&#x2F;never 的区别与应用场景"></a>1.1.3 any&#x2F;unknown&#x2F;never 的区别与应用场景</h3><p><strong>核心类型对比</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">any</th>
<th align="left">unknown</th>
<th align="left">never</th>
</tr>
</thead>
<tbody><tr>
<td align="left">类型安全性</td>
<td align="left">❌ 完全禁用类型检查</td>
<td align="left">✅ 安全容器（需显式类型断言）</td>
<td align="left">✅ 表示不可能存在的值</td>
</tr>
<tr>
<td align="left">可赋值给</td>
<td align="left">任意类型</td>
<td align="left">仅 any 和 unknown</td>
<td align="left">任意类型（底部类型）</td>
</tr>
<tr>
<td align="left">可接受赋值</td>
<td align="left">任意类型</td>
<td align="left">任意类型</td>
<td align="left">不可赋值（除 never 本身）</td>
</tr>
<tr>
<td align="left">操作自由度</td>
<td align="left">直接访问属性&#x2F;方法</td>
<td align="left">必须先断言具体类型	无法实例化</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>any 类型详解</strong></p>
<p>设计目的：用于兼容 JavaScript 无类型代码或第三方库缺失类型声明。</p>
<p>典型场景：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 场景1：迁移遗留JS代码</span>
<span class="token keyword">const</span> legacyData<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token function">getUntypedData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
legacyData<span class="token punctuation">.</span><span class="token function">invalidMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 编译通过，运行时可能报错</span>

<span class="token comment">// 场景2：动态属性访问</span>
<span class="token keyword">const</span> obj<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>arbitraryProperty <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span> <span class="token comment">// 允许任意属性赋值</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>风险警示：使用 any 会破坏类型系统的安全性，应通过 tsconfig.json 开启 noImplicitAny 严格检查。</p>
<p><strong>unknown 类型详解</strong></p>
<p>设计目的：提供类型安全的顶层容器，替代 any 处理不确定类型。</p>
<p>标准使用模式：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 1. 接收不确定类型值</span>
<span class="token keyword">const</span> userInput<span class="token operator">:</span> <span class="token builtin">unknown</span> <span class="token operator">=</span> <span class="token function">fetchUserInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 使用时显式断言</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> userInput <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userInput<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 收窄为string</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 3. 或使用类型断言</span>
<span class="token keyword">const</span> parsed <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span> <span class="token comment">// 安全容器</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>工程实践：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 安全反序列化函数</span>
<span class="token keyword">function</span> <span class="token function">safeParse</span><span class="token punctuation">(</span>json<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">unknown</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">safeParse</span><span class="token punctuation">(</span><span class="token string">'&#123;"name":"Alice"&#125;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">"object"</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"name"</span> <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过类型守卫安全访问</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>never 类型详解</strong></p>
<p>设计目的：表示永远不会发生的值或不可达的代码分支。</p>
<p>核心应用场景：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 场景1：抛出异常的函数</span>
<span class="token keyword">function</span> <span class="token function">error</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">never</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 场景2：死循环函数</span>
<span class="token keyword">function</span> <span class="token function">infiniteLoop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">never</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 场景3：穷尽检查（Exhaustiveness checking）</span>
<span class="token keyword">type</span> <span class="token class-name">Shape</span> <span class="token operator">=</span> <span class="token string">"circle"</span> <span class="token operator">|</span> <span class="token string">"square"</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getArea</span><span class="token punctuation">(</span>shape<span class="token operator">:</span> Shape<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>shape<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">"circle"</span><span class="token operator">:</span> <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> r<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">"square"</span><span class="token operator">:</span> <span class="token keyword">return</span> s<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span> 
      <span class="token keyword">const</span> _exhaustiveCheck<span class="token operator">:</span> <span class="token builtin">never</span> <span class="token operator">=</span> shape<span class="token punctuation">;</span> <span class="token comment">// 若新增shape类型会报错</span>
      <span class="token keyword">return</span> _exhaustiveCheck<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>类型系统特性：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// never 是任意类型的子类型</span>
<span class="token keyword">declare</span> <span class="token keyword">const</span> n<span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> a<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> n<span class="token punctuation">;</span> <span class="token comment">// ✅ 编译通过</span>

<span class="token comment">// 空数组类型推断</span>
<span class="token keyword">const</span> emptyArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 推断为 never[]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程选择指南</strong></p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">推荐类型</th>
<th align="left">原因</th>
</tr>
</thead>
<tbody><tr>
<td align="left">第三方JS库迁移</td>
<td align="left">any</td>
<td align="left">快速过渡期方案</td>
</tr>
<tr>
<td align="left">API响应解析</td>
<td align="left">unknown</td>
<td align="left">安全处理动态数据结构</td>
</tr>
<tr>
<td align="left">错误处理函数</td>
<td align="left">never</td>
<td align="left">明确表示函数不会正常返回</td>
</tr>
<tr>
<td align="left">类型守卫中不可达分支</td>
<td align="left">never</td>
<td align="left">触发穷尽检查</td>
</tr>
<tr>
<td align="left">泛型编程中的空集合</td>
<td align="left">never</td>
<td align="left">表示不可能存在的类型（如 keyof never &#x3D; never）</td>
</tr>
</tbody></table>
<h3 id="1-1-4-类型断言与类型守卫实现原理"><a href="#1-1-4-类型断言与类型守卫实现原理" class="headerlink" title="1.1.4 类型断言与类型守卫实现原理"></a>1.1.4 类型断言与类型守卫实现原理</h3><p><strong>类型断言（Type Assertions）</strong></p>
<p>本质：开发者向编译器提供更具体的类型信息（不改变运行时值）</p>
<p>两种语法形式：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 尖括号语法（JSX中不可用）</span>
<span class="token keyword">const</span> strLength<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span>someValue<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token comment">// as 语法（推荐）</span>
<span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLDivElement<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用场景：</p>
<p>(1) DOM 元素类型细化</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input[type="text"]'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLInputElement<span class="token punctuation">;</span>
input<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'new value'</span><span class="token punctuation">;</span> <span class="token comment">// 安全访问value属性</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>(2) 联合类型收窄</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">padLeft</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> padding<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>padding <span class="token keyword">as</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 断言为number</span>
    <span class="token keyword">return</span> <span class="token string">" "</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span>padding <span class="token keyword">as</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">+</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>padding <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">+</span> value<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(3) 处理any类型</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> unknownData<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> validData <span class="token operator">=</span> unknownData <span class="token keyword">as</span> UserData<span class="token punctuation">;</span> <span class="token comment">// 断言为具体类型</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>注意事项：</p>
<ul>
<li>断言必须满足”结构兼容”（如不能将 string 断言为 number）</li>
<li>双重断言规避限制（慎用）：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> num <span class="token operator">=</span> str <span class="token keyword">as</span> <span class="token builtin">any</span> <span class="token keyword">as</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 绕过类型检查</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>类型守卫（Type Guards）</strong></p>
<p>原理：通过运行时检查触发编译时类型收窄</p>
<p>内置守卫机制：</p>
<table>
<thead>
<tr>
<th align="left">类型守卫</th>
<th align="left">语法示例</th>
<th align="left">收窄效果</th>
</tr>
</thead>
<tbody><tr>
<td align="left">typeof</td>
<td align="left">typeof val &#x3D;&#x3D;&#x3D; “string”</td>
<td align="left">基本类型 → 具体类型</td>
</tr>
<tr>
<td align="left">instanceof</td>
<td align="left">obj instanceof Date</td>
<td align="left">类实例 → 具体类</td>
</tr>
<tr>
<td align="left">in 操作符</td>
<td align="left">“prop” in obj</td>
<td align="left">对象 → 包含该属性类型</td>
</tr>
<tr>
<td align="left">字面量相等检查</td>
<td align="left">status &#x3D;&#x3D;&#x3D; “success”</td>
<td align="left">联合 → 具体字面量类型</td>
</tr>
</tbody></table>
<p>示例：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">printValue</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// val收窄为string</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// val收窄为number</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>自定义类型守卫</strong></p>
<p>实现原理：返回类型谓词（arg is T）</p>
<p>标准模式：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">isString</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> val <span class="token keyword">is</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isString</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    input<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// input被收窄为string</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>复杂对象守卫实战：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Cat</span> <span class="token punctuation">&#123;</span> <span class="token function">meow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#125;</span>
<span class="token keyword">interface</span> <span class="token class-name">Dog</span> <span class="token punctuation">&#123;</span> <span class="token function">bark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">isCat</span><span class="token punctuation">(</span>animal<span class="token operator">:</span> Cat <span class="token operator">|</span> Dog<span class="token punctuation">)</span><span class="token operator">:</span> animal <span class="token keyword">is</span> Cat <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>animal <span class="token keyword">as</span> Cat<span class="token punctuation">)</span><span class="token punctuation">.</span>meow <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">handleAnimal</span><span class="token punctuation">(</span>animal<span class="token operator">:</span> Cat <span class="token operator">|</span> Dog<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isCat</span><span class="token punctuation">(</span>animal<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    animal<span class="token punctuation">.</span><span class="token function">meow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 收窄为Cat</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    animal<span class="token punctuation">.</span><span class="token function">bark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 收窄为Dog</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>可辨识联合（Discriminated Unions）</strong></p>
<p>特殊类型守卫：通过共同字段自动收窄</p>
<p>实现原理：</p>
<ul>
<li>定义具有相同判别字段的联合类型</li>
<li>通过判别字段值收窄类型</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">NetworkState</span> <span class="token operator">=</span>
  <span class="token operator">|</span> <span class="token punctuation">&#123;</span> state<span class="token operator">:</span> <span class="token string">"loading"</span> <span class="token punctuation">&#125;</span>
  <span class="token operator">|</span> <span class="token punctuation">&#123;</span> state<span class="token operator">:</span> <span class="token string">"success"</span><span class="token punctuation">,</span> response<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span>
  <span class="token operator">|</span> <span class="token punctuation">&#123;</span> state<span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">logState</span><span class="token punctuation">(</span>state<span class="token operator">:</span> NetworkState<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">"loading"</span><span class="token operator">:</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Loading..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// state: &#123; state: "loading" &#125;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">"success"</span><span class="token operator">:</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// state: &#123; state: "success", response: string &#125;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">"error"</span><span class="token operator">:</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// state: &#123; state: "error", message: string &#125;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程实践要点</strong></p>
<ol>
<li>优先使用类型守卫：比类型断言更安全（运行时验证）</li>
<li>避免过度断言：过度使用 as 会弱化类型检查</li>
<li>守卫函数复用：提取复杂判断逻辑为可复用守卫</li>
<li>可辨识联合设计：适合管理复杂状态机类型</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 状态机类型守卫示例</span>
<span class="token keyword">type</span> <span class="token class-name">State</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> status<span class="token operator">:</span> <span class="token string">'idle'</span> <span class="token punctuation">&#125;</span> <span class="token operator">|</span> <span class="token punctuation">&#123;</span> status<span class="token operator">:</span> <span class="token string">'fetching'</span><span class="token punctuation">;</span> startTime<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleState</span><span class="token punctuation">(</span>state<span class="token operator">:</span> State<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'fetching'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> duration <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> state<span class="token punctuation">.</span>startTime<span class="token punctuation">;</span> <span class="token comment">// 安全访问startTime</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-1-5-结构化类型系统与鸭子类型"><a href="#1-1-5-结构化类型系统与鸭子类型" class="headerlink" title="1.1.5 结构化类型系统与鸭子类型"></a>1.1.5 结构化类型系统与鸭子类型</h3><p><strong>核心概念解析</strong></p>
<table>
<thead>
<tr>
<th align="left">术语</th>
<th align="left">定义</th>
<th align="left">对比模型</th>
</tr>
</thead>
<tbody><tr>
<td align="left">结构化类型系统</td>
<td align="left">类型兼容性基于类型的结构属性（而非名称）</td>
<td align="left">TypeScript, Go</td>
</tr>
<tr>
<td align="left">名义类型系统</td>
<td align="left">类型兼容性基于类型声明名称（需显式继承）</td>
<td align="left">Java, C#</td>
</tr>
<tr>
<td align="left">鸭子类型</td>
<td align="left">“如果它走起来像鸭子、叫起来像鸭子，那么它就是鸭子”（关注行为而非具体类型）</td>
<td align="left">动态语言哲学</td>
</tr>
</tbody></table>
<p><strong>结构化类型系统原理</strong></p>
<p>基本规则：</p>
<ul>
<li>类型 A 兼容类型 B 当且仅当 A 拥有 B 的所有必需成员（成员名和类型匹配）</li>
</ul>
<p>示例：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Vector2D</span> <span class="token punctuation">&#123;</span>
  x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 类无需显式实现接口（结构匹配即可）</span>
<span class="token keyword">class</span> <span class="token class-name">Point2D</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token keyword">public</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> v<span class="token operator">:</span> Vector2D <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point2D</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 兼容</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>属性检查规则：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 直接赋值字面量时触发严格检查</span>
<span class="token keyword">const</span> p<span class="token operator">:</span> Person <span class="token operator">=</span> <span class="token punctuation">&#123;</span> 
  name<span class="token operator">:</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
  gender<span class="token operator">:</span> <span class="token string">"female"</span>  <span class="token comment">// 🚫 错误！多余属性</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 通过中间变量赋值（绕过额外属性检查）</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span> gender<span class="token operator">:</span> <span class="token string">"male"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p2<span class="token operator">:</span> Person <span class="token operator">=</span> obj<span class="token punctuation">;</span> <span class="token comment">// ✅ 兼容（结构满足核心属性）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>鸭子类型实战场景</strong></p>
<p>场景1：函数参数兼容</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Loggable</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">log</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">ConsoleLogger</span> <span class="token punctuation">&#123;</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Logging..."</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">FileLogger</span> <span class="token punctuation">&#123;</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">"log.txt"</span><span class="token punctuation">,</span> <span class="token string">"..."</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 接受任何具有log方法的对象</span>
<span class="token keyword">function</span> <span class="token function">logOutput</span><span class="token punctuation">(</span>logger<span class="token operator">:</span> Loggable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">logOutput</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConsoleLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅</span>
<span class="token function">logOutput</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ✅</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>场景2：API响应处理</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">ApiResponse</span> <span class="token punctuation">&#123;</span>
  data<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span>
  status<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 无需强制转换，只要结构匹配</span>
<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchAPI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">processResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token keyword">function</span> <span class="token function">processResponse</span><span class="token punctuation">(</span>res<span class="token operator">:</span> ApiResponse<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">parseData</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>结构化类型的边界控制</strong></p>
<p>(1) 精确类型控制（避免意外匹配）</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 使用独特标识防止结构误匹配</span>
<span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>
  _type<span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">;</span> <span class="token comment">// 唯一标识</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">interface</span> <span class="token class-name">Admin</span> <span class="token punctuation">&#123;</span>
  _type<span class="token operator">:</span> <span class="token string">"admin"</span><span class="token punctuation">;</span> <span class="token comment">// 唯一标识</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  privileges<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">handleEntity</span><span class="token punctuation">(</span>entity<span class="token operator">:</span> User <span class="token operator">|</span> Admin<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>entity<span class="token punctuation">.</span>_type <span class="token operator">===</span> <span class="token string">"user"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 安全收窄到User类型</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(2) 可选属性与未知属性处理</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Config</span> <span class="token punctuation">&#123;</span>
  width<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  height<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  debug<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span> <span class="token comment">// 可选属性</span>
  <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span> <span class="token comment">// 允许未知属性</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> config<span class="token operator">:</span> Config <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  width<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  height<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  color<span class="token operator">:</span> <span class="token string">"blue"</span> <span class="token comment">// ✅ 允许额外属性（因索引签名存在）</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>与名义类型系统的互操作</strong></p>
<p>模拟名义类型（通过交叉类型）：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 创建名义类型标记</span>
<span class="token keyword">type</span> <span class="token class-name">UserID</span> <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span> __brand<span class="token operator">:</span> <span class="token string">"UserID"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">OrderID</span> <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span> __brand<span class="token operator">:</span> <span class="token string">"OrderID"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 类型创建函数</span>
<span class="token keyword">function</span> <span class="token function">createUserID</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> UserID <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> id <span class="token keyword">as</span> UserID<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> userId<span class="token operator">:</span> UserID <span class="token operator">=</span> <span class="token function">createUserID</span><span class="token punctuation">(</span><span class="token string">"user-123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> orderId<span class="token operator">:</span> OrderID <span class="token operator">=</span> <span class="token string">"order-456"</span> <span class="token keyword">as</span> OrderID<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span>id<span class="token operator">:</span> UserID<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token punctuation">&#125;</span>

<span class="token function">getUser</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅</span>
<span class="token function">getUser</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🚫 编译错误：类型不兼容</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程实践要点</strong></p>
<ol>
<li>优先使用接口而非类：接口更符合结构化类型哲学（轻量级契约）</li>
<li>避免过度匹配问题：通过最小化接口属性减少意外兼容</li>
<li>利用类型推导优势：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 自动推导返回类型符合结构</span>
<span class="token keyword">function</span> <span class="token function">createPoint</span><span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// 自动兼容 Vector2D</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>鸭子类型测试策略：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 运行时验证对象是否满足结构</span>
<span class="token keyword">function</span> <span class="token function">isVector2D</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> obj <span class="token keyword">is</span> Vector2D <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token string">"x"</span> <span class="token keyword">in</span> obj <span class="token operator">&amp;&amp;</span> <span class="token string">"y"</span> <span class="token keyword">in</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="1-2-接口与面向对象"><a href="#1-2-接口与面向对象" class="headerlink" title="1.2 接口与面向对象"></a>1.2 接口与面向对象</h2><h3 id="1-2-1-接口高级特性（可选属性、只读属性、索引签名）"><a href="#1-2-1-接口高级特性（可选属性、只读属性、索引签名）" class="headerlink" title="1.2.1 接口高级特性（可选属性、只读属性、索引签名）"></a>1.2.1 接口高级特性（可选属性、只读属性、索引签名）</h3><p><strong>可选属性（Optional Properties）</strong></p>
<p>语法：在属性名后添加 ?</p>
<p>作用：允许对象缺少该属性</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">UserProfile</span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>  <span class="token comment">// 可选属性</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> user1<span class="token operator">:</span> UserProfile <span class="token operator">=</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Alice"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>          <span class="token comment">// ✅ age 可省略</span>
<span class="token keyword">const</span> user2<span class="token operator">:</span> UserProfile <span class="token operator">=</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token comment">// ✅</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行时检查：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"age"</span> <span class="token keyword">in</span> user1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user1<span class="token punctuation">.</span>age<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 安全访问</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>只读属性（Readonly Properties）</strong></p>
<p>语法：使用 readonly 修饰符</p>
<p>作用：初始化后禁止修改</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Config</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">readonly</span> apiKey<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  endpoint<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> config<span class="token operator">:</span> Config <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  apiKey<span class="token operator">:</span> <span class="token string">"abc123"</span><span class="token punctuation">,</span>
  endpoint<span class="token operator">:</span> <span class="token string">"/api"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

config<span class="token punctuation">.</span>endpoint <span class="token operator">=</span> <span class="token string">"/new"</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 允许修改</span>
config<span class="token punctuation">.</span>apiKey <span class="token operator">=</span> <span class="token string">"xyz"</span><span class="token punctuation">;</span>    <span class="token comment">// 🚫 编译错误：只读属性</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>特殊场景 - 只读数组：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">ImmutableData</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">readonly</span> tags<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> data<span class="token operator">:</span> ImmutableData <span class="token operator">=</span> <span class="token punctuation">&#123;</span> tags<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"frontend"</span><span class="token punctuation">,</span> <span class="token string">"react"</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span>tags<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"typescript"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 允许（数组引用未变）</span>
data<span class="token punctuation">.</span>tags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"new"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>         <span class="token comment">// 🚫 禁止重新赋值</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>索引签名（Index Signatures）</strong></p>
<p>语法：[key: KeyType]: ValueType</p>
<p>作用：定义动态属性名</p>
<p>基础用法：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">StringMap</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 允许任意字符串属性名</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> scores<span class="token operator">:</span> StringMap <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  math<span class="token operator">:</span> <span class="token number">95</span><span class="token punctuation">,</span>
  science<span class="token operator">:</span> <span class="token number">90</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
scores<span class="token punctuation">[</span><span class="token string">"english"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">88</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 动态添加</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>混合使用（固定属性 + 索引签名）：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">HybridInterface</span> <span class="token punctuation">&#123;</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>          <span class="token comment">// 固定属性</span>
  <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>  <span class="token comment">// 动态属性</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> obj<span class="token operator">:</span> HybridInterface <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  id<span class="token operator">:</span> <span class="token string">"123"</span><span class="token punctuation">,</span>
  tempData<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">/*...*/</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// ✅ 动态属性</span>
  count<span class="token operator">:</span> <span class="token number">10</span>             <span class="token comment">// ✅</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">"456"</span><span class="token punctuation">;</span>         <span class="token comment">// ✅ 固定属性可修改</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>索引类型限制：</p>
<table>
<thead>
<tr>
<th align="left">索引类型</th>
<th align="left">示例</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">string</td>
<td align="left">[key: string]: T</td>
<td align="left">支持所有字符串键</td>
</tr>
<tr>
<td align="left">number</td>
<td align="left">[index: number]: T</td>
<td align="left">数组式访问（实际键仍为字符串）</td>
</tr>
<tr>
<td align="left">symbol</td>
<td align="left">[sym: symbol]: T</td>
<td align="left">ES6 Symbol 键</td>
</tr>
<tr>
<td align="left">模板字面量</td>
<td align="left">[key: test_${string}]: T</td>
<td align="left">TS 4.4+ 模式匹配</td>
</tr>
</tbody></table>
<p><strong>高级组合应用</strong></p>
<p>场景：配置对象</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">readonly</span> version<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>   <span class="token comment">// 只读版本号</span>
  env<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">"dev"</span> <span class="token operator">|</span> <span class="token string">"prod"</span><span class="token punctuation">;</span>       <span class="token comment">// 可选环境</span>
  <span class="token punctuation">[</span>option<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span>  <span class="token comment">// 其他动态配置</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> config<span class="token operator">:</span> AppConfig <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  version<span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  debug<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>       <span class="token comment">// ✅ 动态属性</span>
  maxRetries<span class="token operator">:</span> <span class="token number">3</span>      <span class="token comment">// ✅</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

config<span class="token punctuation">.</span>version <span class="token operator">=</span> <span class="token string">"2.0"</span><span class="token punctuation">;</span> <span class="token comment">// 🚫 禁止修改只读属性</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>索引签名类型约束：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 要求所有属性值类型兼容</span>
<span class="token keyword">interface</span> <span class="token class-name">ConsistentValues</span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>      <span class="token comment">// ✅ 兼容 string | number</span>
  <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 错误示例（类型冲突）</span>
<span class="token keyword">interface</span> <span class="token class-name">Invalid</span> <span class="token punctuation">&#123;</span>
  id<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>       <span class="token comment">// 🚫 与索引签名类型不兼容</span>
  <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程实践要点</strong></p>
<ol>
<li>优先显式声明重要属性：避免过度依赖索引签名</li>
<li>只读属性用于不变数据：如配置ID、版本号等</li>
<li>可选属性替代空值：比 property: null 更语义化</li>
<li>索引签名边界控制：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 精确控制动态属性类型</span>
<span class="token keyword">interface</span> <span class="token class-name">SafeDynamic</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// 必须显式检查</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">getValue</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> SafeDynamic<span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> value <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Missing property"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> value<span class="token punctuation">;</span> <span class="token comment">// 此时类型收窄为 string</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-2-2-类继承体系与访问修饰符"><a href="#1-2-2-类继承体系与访问修饰符" class="headerlink" title="1.2.2 类继承体系与访问修饰符"></a>1.2.2 类继承体系与访问修饰符</h3><p><strong>访问修饰符（Access Modifiers）</strong></p>
<p>控制类成员的可访问性：</p>
<table>
<thead>
<tr>
<th align="left">修饰符</th>
<th align="left">类内部</th>
<th align="left">子类</th>
<th align="left">类实例</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">public</td>
<td align="left">✅</td>
<td align="left">✅</td>
<td align="left">✅</td>
<td align="left">默认修饰符（可省略）</td>
</tr>
<tr>
<td align="left">protected</td>
<td align="left">✅</td>
<td align="left">✅</td>
<td align="left">❌</td>
<td align="left">仅类内部和子类访问</td>
</tr>
<tr>
<td align="left">private</td>
<td align="left">✅</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">仅类内部访问</td>
</tr>
<tr>
<td align="left">#field</td>
<td align="left">✅</td>
<td align="left">❌</td>
<td align="left">❌</td>
<td align="left">ES2022 私有字段（运行时私有）</td>
</tr>
</tbody></table>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">public</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>          <span class="token comment">// 公共属性（默认）</span>
  <span class="token keyword">protected</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>         <span class="token comment">// 受保护属性</span>
  <span class="token keyword">private</span> secret<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>       <span class="token comment">// 私有属性</span>
  #internalCode<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>        <span class="token comment">// ES私有字段（TypeScript 3.8+）</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">"P1001"</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>secret <span class="token operator">=</span> <span class="token string">"confidential"</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#internalCode <span class="token operator">=</span> <span class="token number">12345</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
  <span class="token function">viewDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ✅ 公共属性</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// ✅ 受保护属性（子类可访问）</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 🚫 错误！私有属性不可访问</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#internalCode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🚫 错误！ES私有字段不可访问</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> emp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>emp<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ✅</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>emp<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 🚫 错误！受保护属性</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>emp<span class="token punctuation">.</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 🚫 错误！私有属性</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>类继承体系</strong></p>
<p>(1) 基本继承语法：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>
  <span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Moving..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>
  <span class="token function">bark</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Woof!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> dog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dog<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 继承自Animal</span>
dog<span class="token punctuation">.</span><span class="token function">bark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 自身方法</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(2) 构造函数继承：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Vehicle</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> type<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token keyword">extends</span> <span class="token class-name">Vehicle</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>type<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token keyword">public</span> brand<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 必须调用super</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> myCar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token string">"Sedan"</span><span class="token punctuation">,</span> <span class="token string">"Toyota"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myCar<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// "Sedan"</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myCar<span class="token punctuation">.</span>brand<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "Toyota"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>方法重写（Override）</strong></p>
<p>规则：</p>
<ul>
<li>使用 override 关键字（TS 4.3+）</li>
<li>子类方法必须兼容父类方法签名</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">&#123;</span>
  <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Hello!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token keyword">extends</span> <span class="token class-name">Base</span> <span class="token punctuation">&#123;</span>
  override <span class="token function">greet</span><span class="token punctuation">(</span>name<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用父类方法</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Derived</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
d<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// "Hello!" (调用父类方法)</span>
d<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// "Hello, Alice!"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>错误重写示例：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">InvalidDerived</span> <span class="token keyword">extends</span> <span class="token class-name">Base</span> <span class="token punctuation">&#123;</span>
  override <span class="token function">greet</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
    <span class="token comment">// 🚫 错误！缺少可选参数的无参调用方式</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>访问器修饰符（Getter&#x2F;Setter）</strong></p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Temperature</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> _celsius <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token comment">// 带访问修饰符的getter/setter</span>
  <span class="token keyword">public</span> <span class="token keyword">get</span> <span class="token function">celsius</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_celsius<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">public</span> <span class="token keyword">set</span> <span class="token function">celsius</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">273.15</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Invalid temperature"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_celsius <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// 只读属性（无setter）</span>
  <span class="token keyword">public</span> <span class="token keyword">get</span> <span class="token function">fahrenheit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_celsius <span class="token operator">*</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> temp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Temperature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
temp<span class="token punctuation">.</span>celsius <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>      <span class="token comment">// ✅ 调用setter</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>temp<span class="token punctuation">.</span>fahrenheit<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 77 ✅ 调用getter</span>
temp<span class="token punctuation">.</span>fahrenheit <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>  <span class="token comment">// 🚫 错误！无setter</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>静态成员（Static Members）</strong></p>
<p>特性：</p>
<ol>
<li>通过类名直接访问</li>
<li>不可通过实例访问</li>
<li>可继承</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Database</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> instance<span class="token operator">:</span> Database<span class="token punctuation">;</span>
  
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Database <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Database<span class="token punctuation">.</span>instance<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      Database<span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> Database<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">public</span> <span class="token keyword">static</span> version <span class="token operator">=</span> <span class="token string">"1.0"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 访问静态成员</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> Database<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Database<span class="token punctuation">.</span>version<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "1.0"</span>

<span class="token keyword">class</span> <span class="token class-name">MyDB</span> <span class="token keyword">extends</span> <span class="token class-name">Database</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">static</span> <span class="token function">logVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"DB Version:"</span><span class="token punctuation">,</span> <span class="token keyword">super</span><span class="token punctuation">.</span>version<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 访问父类静态属性</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

MyDB<span class="token punctuation">.</span><span class="token function">logVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "DB Version: 1.0"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程实践要点</strong></p>
<ol>
<li>最小化公开接口：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">SafeContainer</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> internalData<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  <span class="token keyword">public</span> <span class="token function">addItem</span><span class="token punctuation">(</span>item<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>internalData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">private</span> <span class="token function">validate</span><span class="token punctuation">(</span>item<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>使用protected扩展点：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">PluginBase</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">protected</span> <span class="token function">coreLogic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">MyPlugin</span> <span class="token keyword">extends</span> <span class="token class-name">PluginBase</span> <span class="token punctuation">&#123;</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">coreLogic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 子类可访问</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>避免过度继承（组合优于继承）：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 使用组合替代深层继承</span>
<span class="token keyword">class</span> <span class="token class-name">Engine</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name">Wheels</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> engine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Engine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> wheels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Wheels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-2-3-抽象类与接口实现规范"><a href="#1-2-3-抽象类与接口实现规范" class="headerlink" title="1.2.3 抽象类与接口实现规范"></a>1.2.3 抽象类与接口实现规范</h3><p><strong>抽象类（Abstract Classes）</strong></p>
<p>核心特性：</p>
<ol>
<li>不能直接实例化</li>
<li>包含抽象方法（无实现）</li>
<li>可包含具体实现方法</li>
<li>通过 extends 继承</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 抽象属性（必须被子类实现）</span>
  <span class="token keyword">abstract</span> habitat<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 抽象方法（无实现）</span>
  <span class="token keyword">abstract</span> <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 具体方法</span>
  <span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Moving..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Bird</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>
  habitat <span class="token operator">=</span> <span class="token string">"sky"</span><span class="token punctuation">;</span>  <span class="token comment">// 实现抽象属性</span>
  
  <span class="token comment">// 实现抽象方法</span>
  <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Chirp!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token comment">// 扩展新方法</span>
  <span class="token function">fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Flying"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> bird <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bird</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bird<span class="token punctuation">.</span><span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "Chirp!"</span>
bird<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// "Moving..."</span>
bird<span class="token punctuation">.</span><span class="token function">fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// "Flying"</span>

<span class="token keyword">const</span> animal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🚫 错误！抽象类不能实例化</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>接口实现（Interface Implementation）</strong></p>
<p>核心特性：</p>
<ol>
<li>使用 implements 关键字</li>
<li>必须实现所有接口成员</li>
<li>类可同时实现多个接口</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Loggable</span> <span class="token punctuation">&#123;</span>
  <span class="token function">log</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">interface</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>
  <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 实现多个接口</span>
<span class="token keyword">class</span> <span class="token class-name">Logger</span> <span class="token keyword">implements</span> <span class="token class-name">Loggable</span><span class="token punctuation">,</span> Serializable <span class="token punctuation">&#123;</span>
  <span class="token function">log</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[LOG] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>message<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>抽象类 vs 接口</strong></p>
<p>| 特性 | 抽象类 | 接口 |<br>| 实例化 | ❌ 不能直接实例化 | ❌ 不能实例化 |<br>| 方法实现 | ✅ 可包含具体实现方法 | ❌ 只能声明方法签名 |<br>| 成员类型 | 可包含字段&#x2F;构造器&#x2F;访问器等 | 只能包含方法和抽象属性 |<br>| 继承机制 | 单继承（extends） | 多实现（implements） |<br>| 访问修饰符 | ✅ 支持 | ❌ 所有成员默认为 public |<br>| 版本兼容 | 修改可能破坏子类 | 新增成员不影响现有实现 |</p>
<p><strong>混合使用模式</strong></p>
<p>场景：抽象类实现部分接口</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Shape</span> <span class="token punctuation">&#123;</span>
  <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token function">perimeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Polygon</span> <span class="token keyword">implements</span> <span class="token class-name">Shape</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 实现部分接口方法</span>
  <span class="token keyword">abstract</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>  <span class="token comment">// 仍需子类实现</span>
  
  <span class="token comment">// 提供默认实现</span>
  <span class="token function">perimeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSides</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sum<span class="token punctuation">,</span> side<span class="token punctuation">)</span> <span class="token operator">=></span> sum <span class="token operator">+</span> side<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token comment">// 抽象方法（非接口要求）</span>
  <span class="token keyword">abstract</span> <span class="token function">getSides</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token keyword">extends</span> <span class="token class-name">Polygon</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> width<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token keyword">private</span> height<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">getSides</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>实现规范与最佳实践</strong></p>
<ol>
<li>接口隔离原则：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 拆分大接口</span>
<span class="token keyword">interface</span> <span class="token class-name">Printer</span> <span class="token punctuation">&#123;</span>
  <span class="token function">print</span><span class="token punctuation">(</span>document<span class="token operator">:</span> Document<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">interface</span> <span class="token class-name">Scanner</span> <span class="token punctuation">&#123;</span>
  <span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Document<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">AllInOnePrinter</span> <span class="token keyword">implements</span> <span class="token class-name">Printer</span><span class="token punctuation">,</span> Scanner <span class="token punctuation">&#123;</span>
  <span class="token comment">// 分别实现小接口</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>抽象类作为模板：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">DataProcessor</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 模板方法（固定流程）</span>
  <span class="token function">process</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> cleaned <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clean</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>cleaned<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token function">clean</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token function">transform</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span>
  
  <span class="token keyword">private</span> <span class="token function">validate</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Invalid data"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>接口扩展抽象类：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">abstract</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> HTMLElement<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">interface</span> <span class="token class-name">Stateful</span> <span class="token punctuation">&#123;</span>
  <span class="token function">setState</span><span class="token punctuation">(</span>state<span class="token operator">:</span> object<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token keyword">implements</span> <span class="token class-name">Stateful</span> <span class="token punctuation">&#123;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/*...*/</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>避免空实现（违反接口契约）：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 反模式：空实现</span>
<span class="token keyword">class</span> <span class="token class-name">EmptyLogger</span> <span class="token keyword">implements</span> <span class="token class-name">Loggable</span> <span class="token punctuation">&#123;</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// 🚫 违反接口语义</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 正确：抛出明确错误</span>
<span class="token keyword">class</span> <span class="token class-name">NotImplementedLogger</span> <span class="token keyword">implements</span> <span class="token class-name">Loggable</span> <span class="token punctuation">&#123;</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Method not implemented"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>类型检查要点</strong></p>
<ol>
<li>实现兼容性：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">ClockInterface</span> <span class="token punctuation">&#123;</span>
  currentTime<span class="token operator">:</span> Date<span class="token punctuation">;</span>
  <span class="token function">setTime</span><span class="token punctuation">(</span>d<span class="token operator">:</span> Date<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Clock</span> <span class="token keyword">implements</span> <span class="token class-name">ClockInterface</span> <span class="token punctuation">&#123;</span>
  currentTime<span class="token operator">:</span> Date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ✅ 参数类型兼容（Date → Date）</span>
  <span class="token function">setTime</span><span class="token punctuation">(</span>d<span class="token operator">:</span> Date<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>currentTime <span class="token operator">=</span> d<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>可选接口成员：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Config</span> <span class="token punctuation">&#123;</span>
  required<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  optional<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 可选属性</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token keyword">implements</span> <span class="token class-name">Config</span> <span class="token punctuation">&#123;</span>
  required <span class="token operator">=</span> <span class="token string">"default"</span><span class="token punctuation">;</span>
  <span class="token comment">// 无需实现 optional</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>只读接口属性：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">ImmutablePoint</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">readonly</span> x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword">readonly</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token keyword">implements</span> <span class="token class-name">ImmutablePoint</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> <span class="token keyword">readonly</span> x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token keyword">public</span> <span class="token keyword">readonly</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-2-4-类静态成员与构造签名"><a href="#1-2-4-类静态成员与构造签名" class="headerlink" title="1.2.4 类静态成员与构造签名"></a>1.2.4 类静态成员与构造签名</h3><p><strong>静态成员（Static Members）</strong></p>
<p>核心特性：</p>
<ol>
<li>使用 static 关键字声明</li>
<li>通过类名直接访问（而非实例）</li>
<li>不可访问实例成员</li>
<li>可继承（子类可通过 super 或类名访问）</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">MathUtils</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 静态属性</span>
  <span class="token keyword">static</span> <span class="token constant">PI</span> <span class="token operator">=</span> <span class="token number">3.14159</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 静态方法</span>
  <span class="token keyword">static</span> <span class="token function">calculateCircleArea</span><span class="token punctuation">(</span>radius<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> radius <span class="token operator">*</span> radius<span class="token punctuation">;</span> <span class="token comment">// 注意：this指向类本身</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token comment">// 错误示例：访问实例成员</span>
  <span class="token keyword">static</span> <span class="token function">invalidMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🚫 错误！无法访问实例属性</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 访问静态成员</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>MathUtils<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3.14159</span>
<span class="token keyword">const</span> area <span class="token operator">=</span> MathUtils<span class="token punctuation">.</span><span class="token function">calculateCircleArea</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 78.53975</span>

<span class="token keyword">class</span> <span class="token class-name">AdvancedMath</span> <span class="token keyword">extends</span> <span class="token class-name">MathUtils</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">static</span> <span class="token function">logPI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"PI value:"</span><span class="token punctuation">,</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过super访问</span>
    <span class="token comment">// 或 console.log(MathUtils.PI);</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>静态块（Static Blocks）</strong></p>
<p>TS 4.4+ 特性：用于初始化复杂静态属性</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">ConfigLoader</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">static</span> config<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">;</span>
  
  <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 执行复杂初始化</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>config <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">"config.json"</span><span class="token punctuation">,</span> <span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>config <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">"value"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>构造签名（Constructor Signatures）</strong></p>
<p>核心概念：描述类的构造函数类型</p>
<p>基本语法：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 构造签名表示法</span>
<span class="token keyword">interface</span> <span class="token class-name">ClockConstructor</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">new</span> <span class="token punctuation">(</span>hour<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> minute<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> ClockInterface<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">interface</span> <span class="token class-name">ClockInterface</span> <span class="token punctuation">&#123;</span>
  <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 实现构造签名</span>
<span class="token keyword">class</span> <span class="token class-name">DigitalClock</span> <span class="token keyword">implements</span> <span class="token class-name">ClockInterface</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>h<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// 实现构造函数</span>
  <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"beep beep"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 工厂函数使用构造签名</span>
<span class="token keyword">function</span> <span class="token function">createClock</span><span class="token punctuation">(</span>
  ctor<span class="token operator">:</span> ClockConstructor<span class="token punctuation">,</span>
  hour<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  minute<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">)</span><span class="token operator">:</span> ClockInterface <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ctor</span><span class="token punctuation">(</span>hour<span class="token punctuation">,</span> minute<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> digital <span class="token operator">=</span> <span class="token function">createClock</span><span class="token punctuation">(</span>DigitalClock<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
digital<span class="token punctuation">.</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "beep beep"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>静态成员与构造签名实战</strong></p>
<p>场景1：单例模式</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> instance<span class="token operator">:</span> AppConfig<span class="token punctuation">;</span>
  
  <span class="token comment">// 私有构造器防止外部实例化</span>
  <span class="token keyword">private</span> <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> env<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  
  <span class="token comment">// 静态访问点</span>
  <span class="token keyword">static</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> AppConfig <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>AppConfig<span class="token punctuation">.</span>instance<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      AppConfig<span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AppConfig</span><span class="token punctuation">(</span><span class="token string">"production"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> AppConfig<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> AppConfig<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "production"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>场景2：类注册系统</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 构造签名定义</span>
<span class="token keyword">interface</span> <span class="token class-name">PluginConstructor</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Plugin<span class="token punctuation">;</span>
  pluginName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 静态属性要求</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Plugin</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">abstract</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 注册表</span>
<span class="token keyword">class</span> <span class="token class-name">PluginRegistry</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> plugins<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> PluginConstructor<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">static</span> <span class="token function">register</span><span class="token punctuation">(</span>ctor<span class="token operator">:</span> PluginConstructor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>plugins<span class="token punctuation">[</span>ctor<span class="token punctuation">.</span>pluginName<span class="token punctuation">]</span> <span class="token operator">=</span> ctor<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">static</span> <span class="token function">create</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Plugin <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> Ctor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Ctor <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">Ctor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 插件实现</span>
<span class="token keyword">class</span> <span class="token class-name">LoggerPlugin</span> <span class="token keyword">implements</span> <span class="token class-name">Plugin</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">static</span> pluginName <span class="token operator">=</span> <span class="token string">"Logger"</span><span class="token punctuation">;</span> <span class="token comment">// 满足静态属性要求</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Logging..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 注册并使用</span>
PluginRegistry<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>LoggerPlugin<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> plugin <span class="token operator">=</span> PluginRegistry<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"Logger"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
plugin<span class="token operator">?.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "Logging..."</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>高级构造签名模式</strong></p>
<ol>
<li>泛型构造签名</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Factory<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">createInstance</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>Clazz<span class="token operator">:</span> Factory<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Clazz</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token function">createInstance</span><span class="token punctuation">(</span>Product<span class="token punctuation">,</span> <span class="token string">"P1001"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "P1001"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>构造函数类型别名</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 构造函数类型定义</span>
<span class="token keyword">type</span> <span class="token class-name">StringInitializable</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">new</span> <span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> object<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">StringWrapper</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">wrapString</span><span class="token punctuation">(</span>ctor<span class="token operator">:</span> StringInitializable<span class="token punctuation">,</span> s<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ctor</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> wrapped <span class="token operator">=</span> <span class="token function">wrapString</span><span class="token punctuation">(</span>StringWrapper<span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span>wrapped <span class="token keyword">as</span> StringWrapper<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "test"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程实践要点</strong></p>
<ol>
<li>避免过度使用静态成员：静态成员本质是全局状态，不利于测试和扩展</li>
<li>构造签名用于依赖注入：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 依赖注入容器</span>
<span class="token keyword">class</span> <span class="token class-name">Container</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> instances <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token generic-function"><span class="token function">register</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> ctor<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>instances<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ctor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token generic-function"><span class="token function">resolve</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instances<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
container<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">"logger"</span><span class="token punctuation">,</span> ConsoleLogger<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> logger <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">resolve</span><span class="token generic class-name"><span class="token operator">&lt;</span>ConsoleLogger<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">"logger"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>静态成员类型安全：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Validator</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">static</span> patterns <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    email<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[^\s@]+@[^\s@]+\.[^\s@]+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    phone<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\d&#123;10&#125;$</span><span class="token regex-delimiter">/</span></span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">static</span> <span class="token function">validate</span><span class="token punctuation">(</span>type<span class="token operator">:</span> <span class="token keyword">keyof</span> <span class="token keyword">typeof</span> Validator<span class="token punctuation">.</span>patterns<span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>patterns<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

Validator<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">,</span> <span class="token string">"test@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅</span>
Validator<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token string">"postal"</span><span class="token punctuation">,</span> <span class="token string">"12345"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🚫 错误！无此类型</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>构造签名约束：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 要求构造函数具有特定静态属性</span>
<span class="token keyword">interface</span> <span class="token class-name">PluginCtor</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Plugin<span class="token punctuation">;</span>
  version<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  dependencies<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">loadPlugin</span><span class="token punctuation">(</span>ctor<span class="token operator">:</span> PluginCtor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Loading </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>ctor<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> v</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>ctor<span class="token punctuation">.</span>version<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="1-3-函数与泛型编程"><a href="#1-3-函数与泛型编程" class="headerlink" title="1.3 函数与泛型编程"></a>1.3 函数与泛型编程</h2><h3 id="1-3-1-函数类型定义与上下文推断"><a href="#1-3-1-函数类型定义与上下文推断" class="headerlink" title="1.3.1 函数类型定义与上下文推断"></a>1.3.1 函数类型定义与上下文推断</h3><p><strong>函数类型定义方式</strong></p>
<ol>
<li>函数声明式</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 完整类型注解</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>函数表达式</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 变量类型注解</span>
<span class="token keyword">const</span> <span class="token function-variable function">multiply</span><span class="token operator">:</span> <span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function-variable function">number</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> x <span class="token operator">*</span> y<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>箭头函数</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 类型注解在变量上</span>
<span class="token keyword">const</span> <span class="token function-variable function">divide</span><span class="token operator">:</span> <span class="token punctuation">(</span>dividend<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> divisor<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function-variable function">number</span> <span class="token operator">=</span> 
  <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">/</span> b<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>对象方法</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> calculator <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  sum<span class="token operator">:</span> <span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=></span> x <span class="token operator">+</span> y<span class="token punctuation">,</span>
  <span class="token function">subtract</span><span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> x <span class="token operator">-</span> y<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>函数类型签名详解</strong></p>
<p>基本结构：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">AddFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">number</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>可选参数：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">GreetFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> prefix<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">string</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> greet<span class="token operator">:</span> <span class="token function-variable function">GreetFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span>n<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>p <span class="token operator">||</span> <span class="token string">"Hello"</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>n<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token function">greet</span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 允许省略可选参数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>默认参数：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">CreateUser</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> 
  role<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"user"</span> <span class="token comment">// 默认值</span>
<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>剩余参数：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">SumFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">...</span>numbers<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">number</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sum<span class="token operator">:</span> <span class="token function-variable function">SumFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">...</span>nums<span class="token punctuation">)</span> <span class="token operator">=></span> nums<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">+</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>上下文类型推断（Contextual Typing）</strong></p>
<p>核心原理：TypeScript 根据函数被使用的位置自动推断参数类型</p>
<p>典型场景：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 场景1：回调函数参数推断</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>num <span class="token operator">=></span> num <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// num 推断为 number</span>

<span class="token comment">// 场景2：事件处理函数</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> event <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>clientX<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// event 推断为 MouseEvent</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 场景3：函数作为参数传递</span>
<span class="token keyword">function</span> <span class="token function">runCallback</span><span class="token punctuation">(</span><span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">cb</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">runCallback</span><span class="token punctuation">(</span>str <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// str 推断为 string</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显式覆盖上下文类型：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 使用类型断言覆盖推断</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"keydown"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event <span class="token keyword">as</span> KeyboardEvent<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 强制指定为 KeyboardEvent</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>函数类型兼容性</strong></p>
<p>参数兼容规则：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>

<span class="token comment">// ✅ 兼容：参数类型更具体</span>
<span class="token keyword">const</span> h1<span class="token operator">:</span> <span class="token function-variable function">Handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// ✅ 兼容：参数数量更少</span>
<span class="token keyword">const</span> h2<span class="token operator">:</span> <span class="token function-variable function">Handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// 🚫 不兼容：参数类型冲突</span>
<span class="token keyword">const</span> h3<span class="token operator">:</span> <span class="token function-variable function">Handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// 错误！</span>

<span class="token comment">// 返回值兼容规则</span>
<span class="token keyword">type</span> <span class="token class-name">Factory</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token comment">// ✅ 兼容：返回值更具体</span>
<span class="token keyword">const</span> f1<span class="token operator">:</span> <span class="token function-variable function">Factory</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"hello"</span><span class="token punctuation">;</span>
<span class="token comment">// 🚫 不兼容：返回值类型冲突</span>
<span class="token keyword">const</span> f2<span class="token operator">:</span> <span class="token function-variable function">Factory</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">123</span><span class="token punctuation">;</span> <span class="token comment">// 错误！</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>对象方法兼容：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">onEvent</span><span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// ✅ 兼容：参数数量更少</span>
<span class="token keyword">const</span> comp<span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">onEvent</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Event fired"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>void 返回类型的特殊行为</strong></p>
<p>关键特性：允许返回任意值（但返回值会被忽略）</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">VoidFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>

<span class="token comment">// 合法实现（虽然返回了值）</span>
<span class="token keyword">const</span> fn<span class="token operator">:</span> <span class="token function-variable function">VoidFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"hello"</span><span class="token punctuation">;</span>

<span class="token comment">// 使用场景</span>
<span class="token keyword">const</span> strings <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> results<span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">=></span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 允许返回void</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>与undefined的区别：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 必须显式返回undefined</span>
<span class="token keyword">type</span> <span class="token class-name">StrictVoid</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> strictFn<span class="token operator">:</span> <span class="token function-variable function">StrictVoid</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// ✅</span>
<span class="token keyword">const</span> invalidFn<span class="token operator">:</span> <span class="token function-variable function">StrictVoid</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"test"</span><span class="token punctuation">;</span>   <span class="token comment">// 🚫 错误</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程实践要点</strong></p>
<ol>
<li>优先使用上下文推断：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 推荐：让TS自动推断</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>num <span class="token operator">=></span> num <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 不推荐：冗余注解</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>num<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=></span> num <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>回调函数参数命名约定：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 使用描述性参数名增强可读性</span>
<span class="token function">fetchUser</span><span class="token punctuation">(</span>userId <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 比 `id` 更明确</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>避免any污染函数链：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 危险：any类型传播</span>
<span class="token keyword">const</span> <span class="token function-variable function">dangerous</span><span class="token operator">:</span> <span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function-variable function">number</span> <span class="token operator">=</span> input <span class="token operator">=></span> input<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token comment">// 安全：明确类型约束</span>
<span class="token keyword">const</span> <span class="token function-variable function">safe</span><span class="token operator">:</span> <span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function-variable function">number</span> <span class="token operator">=</span> input <span class="token operator">=></span> input<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>函数重载优先于联合参数：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 不推荐：联合类型参数</span>
<span class="token keyword">function</span> <span class="token function">padLeft</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> padding<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">/*...*/</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 推荐：函数重载（下一节内容）</span>
<span class="token keyword">function</span> <span class="token function">padLeft</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> padding<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">padLeft</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> padding<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">padLeft</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> padding<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">/*...*/</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>函数类型高级技巧</strong></p>
<p>函数属性扩展：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">SearchFunction</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">(</span>source<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> subString<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token comment">// 附加属性</span>
  description<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> mySearch<span class="token operator">:</span> <span class="token function-variable function">SearchFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span>src<span class="token punctuation">,</span> sub<span class="token punctuation">)</span> <span class="token operator">=></span> src<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
mySearch<span class="token punctuation">.</span>description <span class="token operator">=</span> <span class="token string">"String search function"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>构造签名函数：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">ClockConstructor</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">new</span> <span class="token punctuation">(</span>hour<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> minute<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> ClockInterface<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">createClock</span><span class="token punctuation">(</span>ctor<span class="token operator">:</span> ClockConstructor<span class="token punctuation">,</span> h<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ctor</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-3-2-函数重载的工程实践"><a href="#1-3-2-函数重载的工程实践" class="headerlink" title="1.3.2 函数重载的工程实践"></a>1.3.2 函数重载的工程实践</h3><p><strong>函数重载基础概念</strong></p>
<p>核心目的：为同一函数提供多个类型签名，处理不同参数组合或返回类型</p>
<p>基本结构：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 重载签名（类型声明）</span>
<span class="token keyword">function</span> <span class="token function">parseInput</span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">parseInput</span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

<span class="token comment">// 实现签名（实际函数体）</span>
<span class="token keyword">function</span> <span class="token function">parseInput</span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> input <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回 number</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> input<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回 string</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token function">parseInput</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// number</span>
<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token function">parseInput</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>重载规则与特性</strong></p>
<ol>
<li>优先级规则：<ul>
<li>从上到下匹配第一个符合的重载签名</li>
<li>实现签名不可直接调用（对外不可见）</li>
</ul>
</li>
<li>参数类型兼容：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 正确：实现签名必须兼容所有重载</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>    <span class="token comment">// ✅</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span> <span class="token comment">// ✅</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> b<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// ✅</span>

<span class="token comment">// 错误：实现签名不兼容重载</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>    <span class="token comment">// 🚫</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token comment">// 错误：缺少number参数处理</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>返回值类型约束：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 返回值必须覆盖所有重载</span>
<span class="token keyword">function</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getValue</span><span class="token punctuation">(</span>format<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getValue</span><span class="token punctuation">(</span>format<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> format <span class="token operator">?</span> <span class="token number">123</span> <span class="token operator">:</span> <span class="token string">"abc"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程实践模式</strong></p>
<p>模式1：参数类型转换</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 字符串和日期互转</span>
<span class="token keyword">function</span> <span class="token function">convert</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Date<span class="token punctuation">;</span>       <span class="token comment">// string → Date</span>
<span class="token keyword">function</span> <span class="token function">convert</span><span class="token punctuation">(</span>value<span class="token operator">:</span> Date<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>       <span class="token comment">// Date → string</span>
<span class="token keyword">function</span> <span class="token function">convert</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> Date<span class="token punctuation">)</span><span class="token operator">:</span> Date <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token function">convert</span><span class="token punctuation">(</span><span class="token string">"2023-01-01"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Date</span>
<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token function">convert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>模式2：配置对象重载</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 简单模式</span>
<span class="token keyword">interface</span> <span class="token class-name">SimpleConfig</span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 高级模式</span>
<span class="token keyword">interface</span> <span class="token class-name">AdvancedConfig</span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  debug<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  retries<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span>config<span class="token operator">:</span> SimpleConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span>config<span class="token operator">:</span> AdvancedConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span>config<span class="token operator">:</span> SimpleConfig <span class="token operator">|</span> AdvancedConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 公共初始化逻辑</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Initializing </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>config<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 类型守卫处理高级配置</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"debug"</span> <span class="token keyword">in</span> config<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Debug mode:"</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>debug<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>模式3：DOM 操作重载</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">getElement</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> HTMLElement <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">getElement</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> HTMLElement<span class="token operator">></span></span></span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> type<span class="token operator">:</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getElement</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> type<span class="token operator">?</span><span class="token operator">:</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> HTMLElement<span class="token punctuation">)</span><span class="token operator">:</span> HTMLElement <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>el <span class="token operator">&amp;&amp;</span> type <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>el <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token keyword">type</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Element type mismatch</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> el<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> div <span class="token operator">=</span> <span class="token function">getElement</span><span class="token punctuation">(</span><span class="token string">"header"</span><span class="token punctuation">,</span> HTMLDivElement<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// HTMLDivElement | null</span>
<span class="token keyword">const</span> generic <span class="token operator">=</span> <span class="token function">getElement</span><span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// HTMLElement | null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>联合类型 vs 函数重载</strong></p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">推荐方案</th>
<th align="left">原因</th>
</tr>
</thead>
<tbody><tr>
<td align="left">参数类型决定返回值类型</td>
<td align="left">函数重载</td>
<td align="left">提供精确的返回类型</td>
</tr>
<tr>
<td align="left">参数数量变化</td>
<td align="left">函数重载</td>
<td align="left">明确不同参数组合</td>
</tr>
<tr>
<td align="left">参数类型相同但处理逻辑不同</td>
<td align="left">联合类型 + 类型守卫</td>
<td align="left">避免重载签名膨胀</td>
</tr>
<tr>
<td align="left">复杂配置对象</td>
<td align="left">函数重载</td>
<td align="left">区分不同配置结构</td>
</tr>
<tr>
<td align="left">简单类型变换</td>
<td align="left">联合类型</td>
<td align="left">减少样板代码</td>
</tr>
</tbody></table>
<p>联合类型示例（适合简单场景）：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 使用联合类型替代重载</span>
<span class="token keyword">function</span> <span class="token function">padLeft</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> padding<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> padding <span class="token operator">===</span> <span class="token string">"number"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">" "</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span>padding<span class="token punctuation">)</span> <span class="token operator">+</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> padding <span class="token operator">+</span> value<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>最佳实践指南</strong></p>
<ol>
<li>控制重载数量：<ul>
<li>建议不超过 5 个重载签名</li>
<li>过多重载会导致类型系统负担增加</li>
</ul>
</li>
<li>公共前置处理：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">processData</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> ResultA<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">processData</span><span class="token punctuation">(</span>data<span class="token operator">:</span> Buffer<span class="token punctuation">)</span><span class="token operator">:</span> ResultB<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">processData</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> Buffer<span class="token punctuation">)</span><span class="token operator">:</span> ResultA <span class="token operator">|</span> ResultB <span class="token punctuation">&#123;</span>
  <span class="token comment">// 公共验证逻辑</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Empty data"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/* 特定处理 */</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/* 特定处理 */</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>使用类型参数减少重载：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 使用泛型替代多个重载</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">identity</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> arg<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 比以下重载更简洁：</span>
<span class="token comment">// function identity(arg: string): string;</span>
<span class="token comment">// function identity(arg: number): number;</span>
<span class="token comment">// ...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>文档注释规范：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">/**
 * 创建用户
 * @param name - 用户名
 * @returns 用户ID
 */</span>
<span class="token keyword">function</span> <span class="token function">createUser</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 创建用户（带配置）
 * @param options - 用户配置
 * @returns 用户ID
 */</span>
<span class="token keyword">function</span> <span class="token function">createUser</span><span class="token punctuation">(</span>options<span class="token operator">:</span> UserOptions<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createUser</span><span class="token punctuation">(</span>param<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> UserOptions<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>常见错误与解决方案</strong></p>
<p>错误1：忽略实现签名兼容性</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 错误实现</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// ✅ 正确</span>

<span class="token comment">// 正确：添加必要的参数检查</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> a <span class="token operator">===</span> <span class="token string">"number"</span> <span class="token operator">&amp;&amp;</span> b <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Missing second argument"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>错误2：返回值类型不完整</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 错误：缺少boolean返回类型</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span>flag<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span>flag<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span> 
  <span class="token keyword">return</span> flag <span class="token operator">?</span> <span class="token number">123</span> <span class="token operator">:</span> <span class="token string">"abc"</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// number ✅</span>
<span class="token keyword">const</span> result2 <span class="token operator">=</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// string ✅</span>
<span class="token keyword">const</span> result3 <span class="token operator">=</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🚫 错误！未声明返回boolean</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 修正：添加完整重载</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span>flag<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span>flag<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span>flag<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> flag <span class="token operator">?</span> <span class="token number">123</span> <span class="token operator">:</span> <span class="token string">"abc"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>高级工程案例</strong></p>
<p>API 请求重载：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 简单GET请求</span>
<span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Response<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token comment">// 带参数的GET请求</span>
<span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> params<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Response<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token comment">// POST请求</span>
<span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> method<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span> body<span class="token operator">:</span> object<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Response<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token comment">// 实现</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span>
  url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  paramsOrMethod<span class="token operator">?</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
  body<span class="token operator">?</span><span class="token operator">:</span> object
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Response<span class="token operator">></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>paramsOrMethod <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> paramsOrMethod <span class="token operator">===</span> <span class="token string">"object"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>paramsOrMethod<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>url<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>query<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>paramsOrMethod <span class="token operator">===</span> <span class="token string">"POST"</span> <span class="token operator">&amp;&amp;</span> body<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      method<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
      body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Invalid arguments"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-3-3-泛型约束与默认类型"><a href="#1-3-3-泛型约束与默认类型" class="headerlink" title="1.3.3 泛型约束与默认类型"></a>1.3.3 泛型约束与默认类型</h3><p><strong>泛型约束（Generic Constraints）</strong></p>
<p>核心目的：限制泛型参数必须满足特定条件</p>
<p>基础语法：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">identity</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> ConstraintType<span class="token operator">></span></span></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>基本约束示例：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Lengthwise</span> <span class="token punctuation">&#123;</span>
  length<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// T 必须包含 length 属性</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">logLength</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> Lengthwise<span class="token operator">></span></span></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> arg<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">logLength</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 字符串有 length</span>
<span class="token function">logLength</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 数组有 length</span>
<span class="token function">logLength</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🚫 错误！数字没有 length</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>多约束条件</strong></p>
<p>使用 &amp; 运算符：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Printable</span> <span class="token punctuation">&#123;</span>
  <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">interface</span> <span class="token class-name">Loggable</span> <span class="token punctuation">&#123;</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// T 必须同时满足 Printable 和 Loggable</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">processItem</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> Printable <span class="token operator">&amp;</span> Loggable<span class="token operator">></span></span></span><span class="token punctuation">(</span>item<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  item<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  item<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Document</span> <span class="token keyword">implements</span> <span class="token class-name">Printable</span><span class="token punctuation">,</span> Loggable <span class="token punctuation">&#123;</span>
  <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Printing document"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Logging document"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">processItem</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>类型参数约束</strong></p>
<p>约束泛型参数之间的关系：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 确保 K 是 T 的键名</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">getProperty</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token function">getProperty</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅</span>
<span class="token function">getProperty</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token string">"email"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🚫 错误！不存在该属性</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>构造函数约束：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 要求泛型 T 必须可构造</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">createInstance</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">&#123;</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> InstanceType <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>ctor<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ctor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token function">createInstance</span><span class="token punctuation">(</span>MyClass<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>泛型默认类型（Default Types）</strong></p>
<p>核心目的：为泛型参数提供默认值，简化使用</p>
<p>基本语法：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">ApiResponse<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  data<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  status<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用默认类型</span>
<span class="token keyword">const</span> response<span class="token operator">:</span> ApiResponse <span class="token operator">=</span> <span class="token punctuation">&#123;</span> 
  data<span class="token operator">:</span> <span class="token string">"untyped data"</span><span class="token punctuation">,</span> <span class="token comment">// any 类型</span>
  status<span class="token operator">:</span> <span class="token number">200</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 显式指定类型</span>
<span class="token keyword">const</span> userResponse<span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span>User<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  data<span class="token operator">:</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Alice"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  status<span class="token operator">:</span> <span class="token number">200</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>约束与默认类型组合</strong></p>
<p>复杂场景应用：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 1. 约束 + 默认类型</span>
<span class="token keyword">interface</span> <span class="token class-name">PaginatedResult<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> object<span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  items<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  total<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 2. 函数中使用</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">fetchData</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
  url<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>PaginatedResult<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用默认约束</span>
<span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise&lt;PaginatedResult&lt;&#123; id: string &#125;>></span>

<span class="token comment">// 指定具体类型</span>
<span class="token keyword">interface</span> <span class="token class-name">Product</span> <span class="token punctuation">&#123;</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  price<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token generic-function"><span class="token function">fetchData</span><span class="token generic class-name"><span class="token operator">&lt;</span>Product<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">"/products"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise&lt;PaginatedResult&lt;Product>></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程实践模式</strong></p>
<p>模式1：部分属性要求</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 要求对象至少包含特定属性</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">updateRecord</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>record<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  db<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span>id<span class="token punctuation">,</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 允许额外属性</span>
<span class="token function">updateRecord</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>模式2：工厂函数约束</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 要求类构造函数</span>
<span class="token keyword">function</span> create<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">new</span></span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">(</span>
  Ctor<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>args<span class="token operator">:</span> ConstructorParameters<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token operator">:</span> InstanceType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Ctor</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> w <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span>Widget<span class="token punctuation">,</span> <span class="token string">"MyWidget"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Widget 实例</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>模式3：API 响应标准化</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">ApiResponse<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span> <span class="token constant">E</span> <span class="token operator">=</span> Error<span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  success<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  data<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  error<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">E</span><span class="token punctuation">;</span>
  timestamp<span class="token operator">:</span> Date<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">createResponse</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> ApiResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    data<span class="token punctuation">,</span>
    timestamp<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> userResponse <span class="token operator">=</span> <span class="token function">createResponse</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Alice"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ApiResponse&lt;&#123; name: string &#125;></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>最佳实践指南</strong></p>
<ol>
<li>避免过度约束：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 过度约束：限制为特定类型</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">process</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span>

<span class="token comment">// 推荐：更灵活的约束</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">process</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>合理使用默认类型：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 为常用类型提供默认值</span>
<span class="token keyword">type</span> <span class="token class-name">Formatter<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">string</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">string</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> dateFormatter<span class="token operator">:</span> Formatter<span class="token operator">&lt;</span>Date<span class="token operator">></span> <span class="token operator">=</span> date <span class="token operator">=></span> date<span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> defaultFormatter<span class="token operator">:</span> <span class="token function-variable function">Formatter</span> <span class="token operator">=</span> str <span class="token operator">=></span> str<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 默认 string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>约束文档化：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">/**
 * 合并两个对象
 * @template T - 第一个对象的类型
 * @template U - 第二个对象的类型（必须与T兼容）
 */</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">merge</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span> <span class="token keyword">extends</span> <span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>obj1<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> obj2<span class="token operator">:</span> <span class="token constant">U</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">&amp;</span> <span class="token constant">U</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>obj1<span class="token punctuation">,</span> <span class="token operator">...</span>obj2 <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>类型参数命名约定：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 推荐：使用有意义的类型参数名</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">getValue</span><span class="token generic class-name"><span class="token operator">&lt;</span>TObject<span class="token punctuation">,</span> TKey <span class="token keyword">extends</span> <span class="token keyword">keyof</span> TObject<span class="token operator">></span></span></span><span class="token punctuation">(</span>
  obj<span class="token operator">:</span> TObject<span class="token punctuation">,</span> 
  key<span class="token operator">:</span> TKey
<span class="token punctuation">)</span><span class="token operator">:</span> TObject<span class="token punctuation">[</span>TKey<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>复杂约束案例</strong></p>
<p>递归约束：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 树节点结构约束</span>
<span class="token keyword">interface</span> <span class="token class-name">TreeNode</span> <span class="token punctuation">&#123;</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  children<span class="token operator">?</span><span class="token operator">:</span> TreeNode<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">walkTree</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> TreeNode<span class="token operator">></span></span></span><span class="token punctuation">(</span>node<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  node<span class="token punctuation">.</span>children<span class="token operator">?.</span><span class="token function">forEach</span><span class="token punctuation">(</span>child <span class="token operator">=></span> <span class="token function">walkTree</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> tree <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  id<span class="token operator">:</span> <span class="token string">"root"</span><span class="token punctuation">,</span>
  children<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token string">"child1"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token string">"child2"</span><span class="token punctuation">,</span> children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token string">"grandchild"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token function">walkTree</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>条件类型约束：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 确保泛型是函数类型</span>
<span class="token keyword">type</span> <span class="token class-name">ReturnTypeOrNever<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">infer</span> <span class="token constant">R</span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> getReturnType<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">(</span>
  fn<span class="token operator">:</span> <span class="token constant">T</span>
<span class="token punctuation">)</span><span class="token operator">:</span> ReturnTypeOrNever<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> ReturnTypeOrNever<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token function">getReturnType</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string</span>
<span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token function">getReturnType</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// number</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>常见错误解决方案</strong></p>
<p>错误：约束不满足</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">getSize</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">&#123;</span> length<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> obj<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> size<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🚫 错误：缺少 length 属性</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 方法1：提供正确类型</span>
<span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> length<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 方法2：扩展约束</span>
<span class="token keyword">interface</span> <span class="token class-name">Sizeable</span> <span class="token punctuation">&#123;</span>
  length<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  size<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">getSize</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> Sizeable<span class="token operator">></span></span></span><span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> obj<span class="token punctuation">.</span>length <span class="token operator">??</span> obj<span class="token punctuation">.</span>size <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>错误：默认类型与约束冲突</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Config<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token builtin">number</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span> <span class="token comment">// 🚫 错误！默认类型必须满足约束</span>
  value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 约束和默认类型需兼容</span>
<span class="token keyword">interface</span> <span class="token class-name">Config<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token builtin">number</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-3-4-泛型在接口-类中的高级应用"><a href="#1-3-4-泛型在接口-类中的高级应用" class="headerlink" title="1.3.4 泛型在接口&#x2F;类中的高级应用"></a>1.3.4 泛型在接口&#x2F;类中的高级应用</h3><p><strong>泛型接口（Generic Interfaces）</strong></p>
<p>基础模式：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 简单泛型接口</span>
<span class="token keyword">interface</span> <span class="token class-name">KeyValuePair<span class="token operator">&lt;</span><span class="token constant">K</span><span class="token punctuation">,</span> <span class="token constant">V</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  key<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">;</span>
  value<span class="token operator">:</span> <span class="token constant">V</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> stringPair<span class="token operator">:</span> KeyValuePair<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  key<span class="token operator">:</span> <span class="token string">"name"</span><span class="token punctuation">,</span>
  value<span class="token operator">:</span> <span class="token string">"Alice"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> numberPair<span class="token operator">:</span> KeyValuePair<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">boolean</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  key<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  value<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>函数签名泛型：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 带调用签名的泛型接口</span>
<span class="token keyword">interface</span> <span class="token class-name">Transformer<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">U</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> toUpperCase<span class="token operator">:</span> Transformer<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span> <span class="token operator">=</span> 
  str <span class="token operator">=></span> str<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token keyword">const</span> toNumber<span class="token operator">:</span> Transformer<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token operator">></span> <span class="token operator">=</span> 
  str <span class="token operator">=></span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>泛型类（Generic Classes）</strong></p>
<p>基本结构：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Box<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> content<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  
  <span class="token function">constructor</span><span class="token punctuation">(</span>initialValue<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> initialValue<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">setValue</span><span class="token punctuation">(</span>newValue<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> stringBox <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Box<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span><span class="token punctuation">(</span><span class="token string">"Initial"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stringBox<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">"New value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> numberBox <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Box<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span></span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numberBox<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 200</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>静态成员限制：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Factory<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 🚫 错误！静态成员不能引用类型参数</span>
  <span class="token keyword">static</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ✅ 正确：静态成员使用独立泛型</span>
  <span class="token keyword">static</span> <span class="token generic-function"><span class="token function">create</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">U</span><span class="token punctuation">)</span><span class="token operator">:</span> Factory<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Factory</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>泛型约束的高级应用</strong></p>
<p>类型参数约束：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 确保类型T有id属性</span>
<span class="token keyword">interface</span> <span class="token class-name">Identifiable</span> <span class="token punctuation">&#123;</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Repository<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> Identifiable<span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> items<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  <span class="token function">add</span><span class="token punctuation">(</span>item<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>item <span class="token operator">=></span> item<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Identifiable</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token keyword">public</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> userRepo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Repository<span class="token operator">&lt;</span>User<span class="token operator">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
userRepo<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"Alice"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> user <span class="token operator">=</span> userRepo<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>构造函数约束：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 要求泛型T必须是类类型</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">createInstance</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>ctor<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ctor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 高级：带参数构造函数</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">createWithParams</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
  ctor<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>args<span class="token operator">:</span> ConstructorParameters<span class="token operator">&lt;</span><span class="token keyword">typeof</span> ctor<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ctor</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token keyword">public</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token function">createWithParams</span><span class="token punctuation">(</span>Point<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Point &#123; x: 1, y: 2 &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>接口与类的组合模式</strong></p>
<p>模式1：工厂接口</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Factory<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">CarFactory</span> <span class="token keyword">implements</span> <span class="token class-name">Factory<span class="token operator">&lt;</span>Car<span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">BikeFactory</span> <span class="token keyword">implements</span> <span class="token class-name">Factory<span class="token operator">&lt;</span>Bike<span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Bike</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">assembleProduct</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>factory<span class="token operator">:</span> Factory<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> factory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>模式2：策略模式</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">PaymentStrategy<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">processPayment</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> context<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">CreditCardStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">PaymentStrategy<span class="token operator">&lt;</span>CreditCardInfo<span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">processPayment</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> card<span class="token operator">:</span> CreditCardInfo<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 信用卡支付逻辑</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">PayPalStrategy</span> <span class="token keyword">implements</span> <span class="token class-name">PaymentStrategy<span class="token operator">&lt;</span>PayPalAccount<span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">processPayment</span><span class="token punctuation">(</span>amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> account<span class="token operator">:</span> PayPalAccount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// PayPal支付逻辑</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">processOrder</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
  amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  strategy<span class="token operator">:</span> PaymentStrategy<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">,</span>
  context<span class="token operator">:</span> <span class="token constant">T</span>
<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> strategy<span class="token punctuation">.</span><span class="token function">processPayment</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>类型推导与默认值</strong></p>
<p>类型参数默认值：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 接口默认类型</span>
<span class="token keyword">interface</span> <span class="token class-name">PaginatedResponse<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  data<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  page<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  totalPages<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 类默认类型</span>
<span class="token keyword">class</span> <span class="token class-name">Cache<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">string</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">set</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">get</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用默认类型</span>
<span class="token keyword">const</span> stringCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Cache&lt;string></span>
stringCache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Alice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> anyCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cache<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
anyCache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Bob"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上下文类型推导：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 根据实现自动推导类型参数</span>
<span class="token keyword">class</span> <span class="token class-name">StringContainer</span> <span class="token keyword">implements</span> <span class="token class-name">Container<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">add</span><span class="token punctuation">(</span>item<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/*...*/</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 显式指定类型参数</span>
<span class="token keyword">class</span> <span class="token class-name">NumberContainer</span> <span class="token keyword">implements</span> <span class="token class-name">Container<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">add</span><span class="token punctuation">(</span>item<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/*...*/</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>高级工程案例</strong></p>
<p>案例1：API 客户端封装</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">ApiClient<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">fetchData</span><span class="token punctuation">(</span>endpoint<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token function">postData</span><span class="token punctuation">(</span>endpoint<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">:</span> Partial<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">JsonApiClient<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token keyword">implements</span> <span class="token class-name">ApiClient<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> baseUrl<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  
  <span class="token keyword">async</span> <span class="token function">fetchData</span><span class="token punctuation">(</span>endpoint<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>baseUrl<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>endpoint<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">async</span> <span class="token function">postData</span><span class="token punctuation">(</span>endpoint<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">:</span> Partial<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>baseUrl<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>endpoint<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
      body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> userClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonApiClient<span class="token operator">&lt;</span>User<span class="token operator">></span></span><span class="token punctuation">(</span><span class="token string">"https://api.example.com/users"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> userClient<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例2：状态管理</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">State<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  current<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  history<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">update</span><span class="token punctuation">(</span>newState<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">HistoryState<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token keyword">implements</span> <span class="token class-name">State<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  history<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> current<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">update</span><span class="token punctuation">(</span>newState<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> newState<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newState<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">getHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>history<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> counterState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HistoryState<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
counterState<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
counterState<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counterState<span class="token punctuation">.</span><span class="token function">getHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [0, 1, 2]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>最佳实践指南</strong></p>
<ol>
<li>避免过度泛型化：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 不推荐：不必要的泛型</span>
<span class="token keyword">class</span> <span class="token class-name">Printer<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">print</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 推荐：直接使用具体类型</span>
<span class="token keyword">class</span> <span class="token class-name">ConsolePrinter</span> <span class="token punctuation">&#123;</span>
  <span class="token function">print</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>提供有意义的类型参数名：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 推荐</span>
<span class="token keyword">interface</span> <span class="token class-name">Repository<span class="token operator">&lt;</span>EntityType<span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">save</span><span class="token punctuation">(</span>entity<span class="token operator">:</span> EntityType<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 不推荐</span>
<span class="token keyword">interface</span> <span class="token class-name">Repository<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">save</span><span class="token punctuation">(</span>e<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>默认类型用于通用场景：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 通用缓存默认存储对象</span>
<span class="token keyword">class</span> <span class="token class-name">Cache<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> object<span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> storage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用默认类型</span>
<span class="token keyword">const</span> objectCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>约束文档化：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">/**
 * 排序服务
 * @template T - 排序元素的类型
 * @template K - 排序依据的键名（必须是T的键）
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Sorter<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">sort</span><span class="token punctuation">(</span>items<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> items<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=></span> 
      a<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">></span> b<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="5">
<li>类与接口协同：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 定义泛型接口</span>
<span class="token keyword">interface</span> <span class="token class-name">Processor<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">process</span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 实现具体处理器</span>
<span class="token keyword">class</span> <span class="token class-name">NumberProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">Processor<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">process</span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>input <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 创建处理器工厂</span>
<span class="token keyword">const</span> processors <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">number</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">NumberProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">processData</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>type<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>processors<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">(</span>processors<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token keyword">as</span> Processor<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>常见问题解决方案</strong></p>
<p>问题：泛型类实例方法类型丢失</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Wrapper<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  
  <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 类型信息丢失</span>
<span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Wrapper</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> value <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// value 类型为 number ✅</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解决方案：使用成员变量保存类型</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">TypeSafeWrapper<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 显式保存类型引用</span>
  <span class="token keyword">public</span> <span class="token keyword">readonly</span> valueType<span class="token operator">!</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  
  <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> safeWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypeSafeWrapper</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">ValueType</span> <span class="token operator">=</span> <span class="token keyword">typeof</span> safeWrapper<span class="token punctuation">.</span>valueType<span class="token punctuation">;</span> <span class="token comment">// string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>问题：泛型接口实现冲突</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Adder<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 错误：必须为所有类型参数提供实现</span>
<span class="token keyword">class</span> <span class="token class-name">NumberAdder</span> <span class="token keyword">implements</span> <span class="token class-name">Adder</span> <span class="token punctuation">&#123;</span>
  <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 正确：指定具体类型</span>
<span class="token keyword">class</span> <span class="token class-name">NumberAdder</span> <span class="token keyword">implements</span> <span class="token class-name">Adder<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 或使用泛型类</span>
<span class="token keyword">class</span> <span class="token class-name">GenericAdder<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token keyword">implements</span> <span class="token class-name">Adder<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> zeroValue<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  
  <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 实际实现需依赖具体类型</span>
    <span class="token keyword">return</span> a<span class="token punctuation">;</span> <span class="token comment">// 简化示例</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="1-4-模块系统"><a href="#1-4-模块系统" class="headerlink" title="1.4 模块系统"></a>1.4 模块系统</h2><h3 id="1-4-1-ES-Module-与-CommonJS-互操作"><a href="#1-4-1-ES-Module-与-CommonJS-互操作" class="headerlink" title="1.4.1 ES Module 与 CommonJS 互操作"></a>1.4.1 ES Module 与 CommonJS 互操作</h3><p><strong>基本互操作模式</strong></p>
<table>
<thead>
<tr>
<th align="left">导入方向</th>
<th align="left">语法示例</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ES → CommonJS</td>
<td align="left"><code>import fs from &#39;fs&#39;;</code><br><code>import &#123; readFile &#125; from &#39;fs&#39;;</code></td>
<td align="left">默认导入或具名导入</td>
</tr>
<tr>
<td align="left">CommonJS → ES</td>
<td align="left"><code>const esModule = require(&#39;./es-module&#39;);</code></td>
<td align="left">通过require加载</td>
</tr>
<tr>
<td align="left">CommonJS → ES (解构)</td>
<td align="left"><code>const &#123; namedExport &#125; = require(&#39;./es-module&#39;);</code></td>
<td align="left">解构ES模块的具名导出</td>
</tr>
</tbody></table>
<p><strong>ESM 导入 CommonJS 模块</strong></p>
<ol>
<li>默认导入：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 导入整个CommonJS模块</span>
<span class="token keyword">import</span> express <span class="token keyword">from</span> <span class="token string">'express'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>具名导入：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 导入特定属性（需模块支持）</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> readFile <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>
<span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>动态导入：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 异步加载CommonJS模块</span>
<span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
util<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span>setTimeout<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>类型声明要求：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 类型声明文件需支持两种导出格式</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'cjs-module'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> _default<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token operator">=</span> _default<span class="token punctuation">;</span>  <span class="token comment">// CommonJS导出</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> _default<span class="token punctuation">;</span> <span class="token comment">// ES默认导出</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>CommonJS 导入 ESM 模块</strong></p>
<ol>
<li>默认导入：</li>
</ol>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// CommonJS 环境</span>
<span class="token keyword">const</span> esModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./es-module'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span> <span class="token comment">// 必须访问.default</span>
esModule<span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>具名导入：</li>
</ol>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 解构具名导出</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> namedExport <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./es-module'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol start="3">
<li>异步加载：</li>
</ol>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 在支持top-level await的环境</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token operator">:</span> esModule <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./es-module'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>互操作中的类型处理</strong></p>
<ol>
<li>CommonJS 模块类型声明：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 标准声明</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'cjs-module'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token function">someFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> someValue<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  
  <span class="token keyword">export</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> 
    someFunction<span class="token punctuation">,</span>
    someValue
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">import</span> cjs <span class="token keyword">from</span> <span class="token string">'cjs-module'</span><span class="token punctuation">;</span>
cjs<span class="token punctuation">.</span><span class="token function">someFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>ES 模块类型声明：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// ES模块声明</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'es-module'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">namedExport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">defaultExport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// CommonJS使用</span>
<span class="token keyword">const</span> esm <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'es-module'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
esm<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 访问默认导出</span>
esm<span class="token punctuation">.</span><span class="token function">namedExport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 访问具名导出</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>兼容类型声明：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 同时支持两种导入方式</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'dual-module'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> defaultExport<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> defaultExport<span class="token punctuation">;</span> <span class="token comment">// ES默认导出</span>
  <span class="token keyword">export</span> <span class="token operator">=</span> defaultExport<span class="token punctuation">;</span>       <span class="token comment">// CommonJS导出</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>互操作陷阱与解决方案</strong></p>
<p>陷阱1：默认导出混淆</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// CommonJS模块</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// 导出函数</span>

<span class="token comment">// ES模块导入</span>
<span class="token keyword">import</span> cjsFunc <span class="token keyword">from</span> <span class="token string">'cjs-module'</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 正确</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> <span class="token keyword">default</span> <span class="token keyword">as</span> cjsFunc <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'cjs-module'</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 正确</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> cjsModule <span class="token keyword">from</span> <span class="token string">'cjs-module'</span><span class="token punctuation">;</span> 
cjsModule<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 正确</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>陷阱2：__esModule 标志</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// Babel/TS编译的ESM模块会添加</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">"__esModule"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> value<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 互操作意义：标记模块为ESM转换而来</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>__esModule<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 按ESM规范处理</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>陷阱3：动态导入差异</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// ES模块</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>

<span class="token comment">// CommonJS导入</span>
<span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'./es-module'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// ❌ 可能未定义</span>
<span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'./es-module'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// ✅ 正确</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程最佳实践</strong></p>
<ol>
<li>统一模块格式：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token comment">// tsconfig.json</span>
<span class="token punctuation">&#123;</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"ESNext"</span><span class="token punctuation">,</span>       <span class="token comment">// 输出ESM</span>
    <span class="token property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"Node"</span> <span class="token comment">// 支持Node解析规则</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>条件导出（package.json）：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"exports"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"import"</span><span class="token operator">:</span> <span class="token string">"./dist/esm/index.js"</span><span class="token punctuation">,</span>   <span class="token comment">// ESM入口</span>
    <span class="token property">"require"</span><span class="token operator">:</span> <span class="token string">"./dist/cjs/index.js"</span><span class="token punctuation">,</span>  <span class="token comment">// CommonJS入口</span>
    <span class="token property">"default"</span><span class="token operator">:</span> <span class="token string">"./dist/cjs/index.js"</span>   <span class="token comment">// 回退</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>双格式发布：</li>
</ol>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">my-package/
├── dist/
│   ├── esm/        // ES模块版本
│   │   └── index.js
│   └── cjs/        // CommonJS版本
│       └── index.js
├── package.json<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>互操作封装层：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// cjs-compat.ts - CommonJS封装层</span>
<span class="token keyword">import</span> esModule <span class="token keyword">from</span> <span class="token string">'./es-module'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">=</span> esModule<span class="token punctuation">;</span> <span class="token comment">// 转换为CommonJS导出</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>TypeScript 编译选项</strong></p>
<table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">值</th>
<th align="left">互操作影响</th>
</tr>
</thead>
<tbody><tr>
<td align="left">esModuleInterop</td>
<td align="left">true (推荐)</td>
<td align="left">生成兼容代码，允许默认导入CommonJS模块</td>
</tr>
<tr>
<td align="left">allowSyntheticDefaultImports</td>
<td align="left">true</td>
<td align="left">允许类型系统中的默认导入</td>
</tr>
<tr>
<td align="left">module</td>
<td align="left">CommonJS&#x2F;Node16</td>
<td align="left">控制输出模块格式</td>
</tr>
<tr>
<td align="left">moduleResolution</td>
<td align="left">Node16 (推荐)</td>
<td align="left">支持package.json的exports和imports字段</td>
</tr>
</tbody></table>
<p>esModuleInterop 工作原理：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 开启前</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>default <span class="token operator">=</span> fs<span class="token punctuation">;</span>

<span class="token comment">// 开启后</span>
<span class="token keyword">var</span> __importDefault <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__importDefault<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">mod</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>mod <span class="token operator">&amp;&amp;</span> mod<span class="token punctuation">.</span>__esModule<span class="token punctuation">)</span> <span class="token operator">?</span> mod <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"default"</span><span class="token operator">:</span> mod <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fs_1 <span class="token operator">=</span> <span class="token function">__importDefault</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>default <span class="token operator">=</span> fs_1<span class="token punctuation">.</span>default<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Node.js 环境互操作</strong></p>
<ol>
<li>.mjs 与 .cjs 扩展名：</li>
</ol>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ES模块 (module.mjs)</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token comment">// CommonJS导入 (script.cjs)</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> hello <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./module.mjs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ❌ Node不允许</span>
<span class="token keyword">const</span> esm <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./module.mjs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 必须使用动态导入</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>package.json type 字段：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span> <span class="token comment">// 所有.js文件视为ES模块</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"commonjs"</span> <span class="token comment">// 默认值</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>文件扩展名规则：</li>
</ol>
<table>
<thead>
<tr>
<th align="left">文件扩展名</th>
<th align="left">模块类型</th>
<th align="left">导入方式</th>
</tr>
</thead>
<tbody><tr>
<td align="left">.js</td>
<td align="left">由type字段决定</td>
<td align="left">根据type字段处理</td>
</tr>
<tr>
<td align="left">.mjs</td>
<td align="left">ES模块</td>
<td align="left">只能import导入</td>
</tr>
<tr>
<td align="left">.cjs</td>
<td align="left">CommonJS</td>
<td align="left">只能require导入</td>
</tr>
</tbody></table>
<p><strong>浏览器环境互操作</strong></p>
<ol>
<li>脚本类型声明：</li>
</ol>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- 加载ES模块 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token comment">&lt;!-- 加载CommonJS模块（需打包转换） --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cjs-bundle.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>动态导入兼容：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 浏览器中的动态导入</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> module <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// Node环境</span>
  <span class="token keyword">const</span> mod <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'./cjs-module'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 浏览器环境</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./es-module.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>mod <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>互操作类型安全策略</strong></p>
<ol>
<li>模块扩充声明：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 扩充CommonJS模块类型</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'fs'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">customMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">customMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 类型安全</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>条件类型处理：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 区分模块类型</span>
<span class="token keyword">type</span> <span class="token class-name">ModuleType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">&#123;</span> __esModule<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span> <span class="token operator">?</span> 
  <span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">U</span> <span class="token punctuation">&#125;</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">importCompat</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>module<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> ModuleType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 实现互操作转换</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>运行时类型守卫：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 检测ES模块</span>
<span class="token keyword">function</span> <span class="token function">isESModule</span><span class="token punctuation">(</span>module<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">module</span> <span class="token keyword">is</span> <span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> module<span class="token punctuation">.</span>__esModule <span class="token operator">||</span> 
    <span class="token punctuation">(</span><span class="token keyword">typeof</span> Symbol <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> 
     Symbol<span class="token punctuation">.</span>toStringTag <span class="token keyword">in</span> module<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-4-2-命名空间与现代模块对比"><a href="#1-4-2-命名空间与现代模块对比" class="headerlink" title="1.4.2 命名空间与现代模块对比"></a>1.4.2 命名空间与现代模块对比</h3><p><strong>命名空间（Namespaces）</strong></p>
<p>核心概念：TypeScript 早期提供的逻辑分组机制，用于组织全局作用域代码</p>
<p>基本语法：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 定义命名空间</span>
<span class="token keyword">namespace</span> MyUtils <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">export</span> <span class="token keyword">namespace</span> Math <span class="token punctuation">&#123;</span>
    <span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">PI</span> <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span>
    <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">circleArea</span><span class="token punctuation">(</span>r<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token constant">PI</span> <span class="token operator">*</span> r <span class="token operator">*</span> r<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
MyUtils<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> area <span class="token operator">=</span> MyUtils<span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">circleArea</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译结果：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 转换为闭包形式</span>
<span class="token keyword">var</span> MyUtils<span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">MyUtils</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  MyUtils<span class="token punctuation">.</span>log <span class="token operator">=</span> log<span class="token punctuation">;</span>
  
  <span class="token keyword">let</span> Math<span class="token punctuation">;</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">Math</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">circleArea</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> r <span class="token operator">*</span> r<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    Math<span class="token punctuation">.</span>circleArea <span class="token operator">=</span> circleArea<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Math <span class="token operator">=</span> MyUtils<span class="token punctuation">.</span>Math <span class="token operator">||</span> <span class="token punctuation">(</span>MyUtils<span class="token punctuation">.</span>Math <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>MyUtils <span class="token operator">||</span> <span class="token punctuation">(</span>MyUtils <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>现代模块（ES Modules）</strong></p>
<p>核心概念：ES6 标准引入的文件级作用域隔离机制</p>
<p>基本语法：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// math.ts</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">PI</span> <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">circleArea</span><span class="token punctuation">(</span>r<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token constant">PI</span> <span class="token operator">*</span> r <span class="token operator">*</span> r<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// logger.ts</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// app.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> log <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./logger'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> MathUtils <span class="token keyword">from</span> <span class="token string">'./math'</span><span class="token punctuation">;</span>

<span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Calculating area"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> area <span class="token operator">=</span> MathUtils<span class="token punctuation">.</span><span class="token function">circleArea</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>核心差异对比</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">命名空间</th>
<th align="left">现代模块</th>
</tr>
</thead>
<tbody><tr>
<td align="left">作用域</td>
<td align="left">全局&#x2F;文件内</td>
<td align="left">文件级作用域</td>
</tr>
<tr>
<td align="left">依赖管理</td>
<td align="left">手动排序<code>&lt;script&gt;</code>标签</td>
<td align="left">自动依赖解析（import&#x2F;export）</td>
</tr>
<tr>
<td align="left">代码组织</td>
<td align="left">逻辑分组</td>
<td align="left">物理文件分组</td>
</tr>
<tr>
<td align="left">代码分割</td>
<td align="left">不支持</td>
<td align="left">原生支持（动态导入）</td>
</tr>
<tr>
<td align="left">摇树优化</td>
<td align="left">不支持</td>
<td align="left">原生支持（Tree Shaking）</td>
</tr>
<tr>
<td align="left">运行时性能</td>
<td align="left">所有代码立即加载</td>
<td align="left">按需加载</td>
</tr>
<tr>
<td align="left">类型声明</td>
<td align="left">通过&#x2F;&#x2F;&#x2F; <code>&lt;reference&gt;</code>指令</td>
<td align="left">自动解析.d.ts文件</td>
</tr>
<tr>
<td align="left">全局污染</td>
<td align="left">可能污染全局命名空间</td>
<td align="left">无全局污染</td>
</tr>
</tbody></table>
<p><strong>使用场景指南</strong></p>
<p>命名空间适用场景：</p>
<ol>
<li>浏览器环境下的旧项目维护</li>
<li>需要全局可访问的库类型声明（如window.myLib）</li>
<li>将大型库拆分为多个文件但仍需共享作用域</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 多文件命名空间</span>
<span class="token comment">// Validation.ts</span>
<span class="token keyword">namespace</span> Validation <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Validator</span> <span class="token punctuation">&#123;</span>
    <span class="token function">isValid</span><span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// LettersOnlyValidator.ts</span>
<span class="token comment">/// &lt;reference path="Validation.ts" /></span>
<span class="token keyword">namespace</span> Validation <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">LettersOnlyValidator</span> <span class="token keyword">implements</span> <span class="token class-name">Validator</span> <span class="token punctuation">&#123;</span>
    <span class="token function">isValid</span><span class="token punctuation">(</span>s<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/*...*/</span> <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>现代模块适用场景：</p>
<ol>
<li>新项目开发</li>
<li>需要代码分割的应用</li>
<li>组件化架构（React&#x2F;Vue）</li>
<li>Node.js 服务端应用</li>
<li>需要 Tree Shaking 优化的库</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 现代模块化组件</span>
<span class="token comment">// Button.tsx</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Button</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> text <span class="token punctuation">&#125;</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> text<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>button<span class="token operator">></span><span class="token punctuation">&#123;</span>text<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// App.tsx</span>
<span class="token keyword">import</span> Button <span class="token keyword">from</span> <span class="token string">'./Button'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Button text<span class="token operator">=</span><span class="token string">"Click"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>混合使用模式</strong></p>
<p>场景：模块扩展命名空间</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// shapes.ts - 命名空间定义</span>
<span class="token keyword">namespace</span> Shapes <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Circle</span> <span class="token punctuation">&#123;</span> <span class="token comment">/*...*/</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// extensions.ts - 模块扩展命名空间</span>
<span class="token keyword">import</span> <span class="token string">'./shapes'</span><span class="token punctuation">;</span> <span class="token comment">// 确保命名空间存在</span>

<span class="token keyword">declare</span> global <span class="token punctuation">&#123;</span>
  <span class="token keyword">namespace</span> Shapes <span class="token punctuation">&#123;</span>
    <span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Triangle</span> <span class="token punctuation">&#123;</span> <span class="token comment">/*...*/</span> <span class="token punctuation">&#125;</span> <span class="token comment">// 扩展命名空间</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> triangle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Shapes</span><span class="token punctuation">.</span><span class="token function">Triangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>场景：命名空间封装模块类型</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 为第三方模块声明全局类型</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> global <span class="token punctuation">&#123;</span>
  <span class="token keyword">namespace</span> <span class="token constant">JSX</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">interface</span> <span class="token class-name">IntrinsicElements</span> <span class="token punctuation">&#123;</span>
      customElement<span class="token operator">:</span> React<span class="token punctuation">.</span>DetailedHTMLProps<span class="token operator">&lt;</span>
        React<span class="token punctuation">.</span>HTMLAttributes<span class="token operator">&lt;</span>HTMLElement<span class="token operator">></span><span class="token punctuation">,</span>
        HTMLElement
      <span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程迁移策略</strong></p>
<p>步骤1：命名空间转模块</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 原命名空间代码</span>
<span class="token keyword">namespace</span> Utilities <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/*...*/</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 转换为模块</span>
<span class="token comment">// utilities.ts</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/*...*/</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>步骤2：处理全局依赖</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 原全局依赖</span>
<span class="token keyword">namespace</span> App <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">&#123;</span> debug<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 转换为单例模块</span>
<span class="token comment">// config.ts</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">&#123;</span> debug<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用处改为导入</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> config <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./config'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>步骤3：处理多文件命名空间</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 原多文件命名空间</span>
<span class="token comment">/// &lt;reference path="validation.ts" /></span>
<span class="token keyword">namespace</span> Validation <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">EmailValidator</span> <span class="token punctuation">&#123;</span> <span class="token comment">/*...*/</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 转换为模块</span>
<span class="token comment">// EmailValidator.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Validator <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./validation'</span><span class="token punctuation">;</span> <span class="token comment">// 转换为模块</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">EmailValidator</span> <span class="token keyword">implements</span> <span class="token class-name">Validator</span> <span class="token punctuation">&#123;</span> <span class="token comment">/*...*/</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>最佳实践指南</strong></p>
<ol>
<li>新项目强制使用模块：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token comment">// tsconfig.json</span>
<span class="token punctuation">&#123;</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"ESNext"</span><span class="token punctuation">,</span>
    <span class="token property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"NodeNext"</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>旧项目渐进迁移：<ul>
<li>新文件使用模块语法</li>
<li>旧文件保持命名空间</li>
<li>使用export as namespace提供全局访问</li>
</ul>
</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// legacy.d.ts</span>
<span class="token keyword">export</span> <span class="token operator">=</span> MyLib<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">as</span> <span class="token keyword">namespace</span> myLib<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>避免全局扩展污染：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 不推荐：污染全局命名空间</span>
<span class="token keyword">declare</span> global <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name">Window</span> <span class="token punctuation">&#123;</span>
    myGlobalVar<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 推荐：模块封装</span>
<span class="token comment">// my-module.ts</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  window<span class="token punctuation">.</span>myGlobalVar <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token comment">/*...*/</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>类型声明策略：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 现代模块类型声明</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'modern-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 命名空间类型声明</span>
<span class="token keyword">declare</span> <span class="token keyword">namespace</span> LegacyLib <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">const</span> version<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>常见问题解决方案</strong></p>
<p>问题：全局类型冲突</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// file1.ts</span>
<span class="token keyword">namespace</span> MyApp <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">const</span> version <span class="token operator">=</span> <span class="token string">"1.0"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// file2.ts</span>
<span class="token keyword">namespace</span> MyApp <span class="token punctuation">&#123;</span> <span class="token comment">// ❌ 可能与其他文件合并</span>
  <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 转换为模块化</span>
<span class="token comment">// version.ts</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> version <span class="token operator">=</span> <span class="token string">"1.0"</span><span class="token punctuation">;</span>

<span class="token comment">// logger.ts</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>问题：第三方库全局扩展</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 扩展jQuery</span>
<span class="token keyword">declare</span> <span class="token keyword">namespace</span> JQuery <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name">Static</span> <span class="token punctuation">&#123;</span>
    <span class="token function">newPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 现代方案：模块增强</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'jquery'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name">JQueryStatic</span> <span class="token punctuation">&#123;</span>
    <span class="token function">newPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>问题：循环依赖</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 命名空间中的循环引用</span>
<span class="token keyword">namespace</span> <span class="token constant">A</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token constant">B</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// ❌ B尚未定义</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">namespace</span> <span class="token constant">B</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>模块化解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// a.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> value <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./b'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> b <span class="token operator">=</span> value<span class="token punctuation">;</span>

<span class="token comment">// b.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> b <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./a'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> value <span class="token operator">=</span> b <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// ❌ 循环依赖</span>

<span class="token comment">// 重构：提取公共逻辑</span>
<span class="token comment">// constants.ts</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">BASE_VALUE</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token comment">// a.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> <span class="token constant">BASE_VALUE</span> <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./constants'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token constant">BASE_VALUE</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment">// b.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> <span class="token constant">BASE_VALUE</span> <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./constants'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token constant">BASE_VALUE</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-4-3-模块解析策略与路径映射"><a href="#1-4-3-模块解析策略与路径映射" class="headerlink" title="1.4.3 模块解析策略与路径映射"></a>1.4.3 模块解析策略与路径映射</h3><p><strong>模块解析策略</strong></p>
<p>TypeScript 支持两种模块解析策略：</p>
<table>
<thead>
<tr>
<th align="left">策略</th>
<th align="left">触发条件</th>
<th align="left">解析逻辑</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Classic</td>
<td align="left">“moduleResolution”: “Classic”</td>
<td align="left">1. 相对路径：.&#x2F;module → .&#x2F;module.ts<br>2. 非相对路径：module → .&#x2F;module.ts → ..&#x2F;module.ts</td>
<td align="left">TS 1.6 前旧项目</td>
</tr>
<tr>
<td align="left">Node</td>
<td align="left">“moduleResolution”: “Node”<br>(默认值)</td>
<td align="left">遵循 Node.js 解析规则：<br>1. 检查文件<br>2. 检查目录<br>3. 检查 package.json<br>4. 检查 @types	现代</td>
<td align="left">Node.js&#x2F;Web 项目</td>
</tr>
</tbody></table>
<p>Node 策略解析流程：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> helper <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'my-utils'</span><span class="token punctuation">;</span>
<span class="token comment">// 解析步骤：</span>
<span class="token comment">// 1. 检查文件: node_modules/my-utils.ts</span>
<span class="token comment">// 2. 检查文件: node_modules/my-utils.tsx</span>
<span class="token comment">// 3. 检查文件: node_modules/my-utils.d.ts</span>
<span class="token comment">// 4. 检查目录: node_modules/my-utils/package.json (main/types 字段)</span>
<span class="token comment">// 5. 检查目录: node_modules/my-utils/index.ts</span>
<span class="token comment">// 6. 检查上级 node_modules: ../node_modules/my-utils</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>路径映射（Path Mapping）</strong></p>
<p>核心目的：简化模块导入路径，避免相对路径嵌套</p>
<p>配置方式 (tsconfig.json)：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"./src"</span><span class="token punctuation">,</span>
    <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"@components/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"components/*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"@utils"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"utils/index"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"shared/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"../shared/*"</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>映射规则解析：</p>
<table>
<thead>
<tr>
<th align="left">映射配置</th>
<th align="left">导入语句</th>
<th align="left">解析路径</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>&quot;@components/*&quot;</code><br><code>[&quot;components/*&quot;]</code></td>
<td align="left"><code>import Button from &#39;@components/Button&#39;</code></td>
<td align="left"><code>./src/components/Button.ts</code></td>
</tr>
<tr>
<td align="left"><code>&quot;@utils&quot;</code><br><code>[&quot;utils/index&quot;]</code></td>
<td align="left"><code>import &#123; log &#125; from &#39;@utils&#39;</code></td>
<td align="left"><code>./src/utils/index.ts</code></td>
</tr>
<tr>
<td align="left"><code>&quot;shared/*&quot;</code><br><code>[&quot;../shared/*&quot;]</code></td>
<td align="left"><code>import config from &#39;shared/config&#39;</code></td>
<td align="left"><code>../shared/config.ts</code></td>
</tr>
</tbody></table>
<p><strong>路径映射类型声明</strong></p>
<p>场景：为路径映射提供类型支持</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// src/global.d.ts</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'@components/*'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ComponentType <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> component<span class="token operator">:</span> ComponentType<span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> component<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'@utils'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">const</span> version<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程最佳实践</strong></p>
<ol>
<li>基础路径配置：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"src"</span><span class="token punctuation">,</span> <span class="token comment">// 所有非绝对路径相对src解析</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
import utils from 'utils'; <span class="token comment">// 解析为 src/utils.ts</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>多路径映射模式：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 多路径回退</span>
    <span class="token property">"@services/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"services/v2/*"</span><span class="token punctuation">,</span> <span class="token comment">// 优先尝试v2</span>
      <span class="token string">"services/v1/*"</span>  <span class="token comment">// 回退到v1</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>通配符扩展：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"@assets/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"assets/*"</span><span class="token punctuation">,</span> <span class="token string">"assets/images/*"</span><span class="token punctuation">]</span> <span class="token comment">// 多目录映射</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>绝对路径映射：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"."</span><span class="token punctuation">,</span>
  <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"src/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src/*"</span><span class="token punctuation">]</span> <span class="token comment">// 允许 import from 'src/components'</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>路径映射与打包器集成</strong></p>
<p>Webpack 配置：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token string-property property">'@components'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/components'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string-property property">'@utils'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/utils'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Vite 配置：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// vite.config.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> defineConfig <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vite'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token string-property property">'@'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>常见问题解决方案</strong></p>
<p>问题1：路径映射在运行时失效</p>
<p>原因：TypeScript 只处理编译时路径，运行时需打包器支持</p>
<p>解决方案：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装路径转换工具</span>
<span class="token function">npm</span> <span class="token function">install</span> tsconfig-paths --save-dev

<span class="token comment"># 运行时加载</span>
<span class="token function">node</span> <span class="token parameter variable">-r</span> tsconfig-paths/register app.ts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>问题2：循环依赖警告</p>
<p>场景：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">src/
  components/
    Button.ts  // import &#123; theme &#125; from '@utils'
  utils/
    index.ts   // import &#123; Button &#125; from '@components'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解决方案：</p>
<ol>
<li>重构提取公共模块</li>
<li>使用依赖注入</li>
<li>动态导入打破循环</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// utils/index.ts</span>
<span class="token keyword">let</span> Button<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loadButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Button<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    Button <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@components/Button'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> Button<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>问题3：声明文件缺失</p>
<p>解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 为路径映射创建声明文件</span>
<span class="token comment">// src/path-mappings.d.ts</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'@components/*'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> component<span class="token operator">:</span> React<span class="token punctuation">.</span>ComponentType<span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> component<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'@utils'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">formatDate</span><span class="token punctuation">(</span>date<span class="token operator">:</span> Date<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>高级路径映射技术</strong></p>
<ol>
<li>条件路径映射：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"config"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"config/production"</span><span class="token punctuation">,</span> <span class="token comment">// 生产环境</span>
      <span class="token string">"config/development"</span> <span class="token comment">// 开发环境</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>多项目共享映射：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token comment">// 基座项目 tsconfig.base.json</span>
<span class="token punctuation">&#123;</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"@shared/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"../shared/*"</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 子项目 tsconfig.json</span>
<span class="token punctuation">&#123;</span>
  <span class="token property">"extends"</span><span class="token operator">:</span> <span class="token string">"../tsconfig.base.json"</span><span class="token punctuation">,</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"src"</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>路径映射重定向：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"old-module"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"new-module"</span><span class="token punctuation">]</span> <span class="token comment">// 重定向旧路径</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>路径映射规范指南</strong></p>
<ol>
<li>统一前缀约定：</li>
</ol>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">@app/      // 应用核心代码
@lib/      // 公共库
@assets/   // 静态资源
@test/     // 测试工具<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>禁止深层相对路径：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 禁用</span>
<span class="token keyword">import</span> util <span class="token keyword">from</span> <span class="token string">'../../../../utils'</span><span class="token punctuation">;</span>

<span class="token comment">// 启用</span>
<span class="token keyword">import</span> util <span class="token keyword">from</span> <span class="token string">'@core/utils'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>映射路径长度限制：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token comment">// 优先使用短路径</span>
<span class="token punctuation">&#123;</span>
  <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"@c"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"components"</span><span class="token punctuation">]</span> <span class="token comment">// 不推荐：过于简短</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>文档化映射规则：</li>
</ol>
<p>路径映射规范：</p>
<table>
<thead>
<tr>
<th align="left">映射路径</th>
<th align="left">实际路径</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">@components&#x2F;*</td>
<td align="left">src&#x2F;components&#x2F;*</td>
<td align="left">全局组件</td>
</tr>
<tr>
<td align="left">@utils</td>
<td align="left">src&#x2F;utils&#x2F;index.ts</td>
<td align="left">工具函数入口</td>
</tr>
</tbody></table>
<h3 id="1-4-4-动态导入与代码分割类型安全"><a href="#1-4-4-动态导入与代码分割类型安全" class="headerlink" title="1.4.4 动态导入与代码分割类型安全"></a>1.4.4 动态导入与代码分割类型安全</h3><p><strong>动态导入基础语法</strong></p>
<p>核心语法：import() 函数返回 Promise，在模块加载完成后解析为模块对象</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 基本用法</span>
<span class="token keyword">const</span> modulePromise <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./module'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 带路径变量</span>
<span class="token keyword">const</span> moduleName <span class="token operator">=</span> <span class="token string">'utils'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> utilsModule <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>moduleName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>类型安全处理：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">MathModule</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token constant">PI</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> mathModule <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./math'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token operator">:</span> MathModule <span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">;</span>

mathModule<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>mod <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mod<span class="token punctuation">.</span>default<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 类型安全访问</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>代码分割类型声明</strong></p>
<ol>
<li>模块声明文件：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// math.module.d.ts</span>
<span class="token keyword">declare</span> <span class="token keyword">const</span> mathModule<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token constant">PI</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> mathModule<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>动态模块类型：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 使用泛型定义返回类型</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">dynamicImport</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>path<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">import</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token generic-function"><span class="token function">dynamicImport</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token operator">:</span> MathModule <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'./math'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token operator">:</span> math <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>React 动态组件类型安全</strong></p>
<ol>
<li>React.lazy 基础用法：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> LazyComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./HeavyComponent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>React<span class="token punctuation">.</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>div<span class="token operator">></span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>LazyComponent <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>Suspense<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>带属性的组件类型：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// HeavyComponent.tsx</span>
<span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">&#123;</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> HeavyComponent<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> title<span class="token punctuation">,</span> count <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">&#123;</span>title<span class="token punctuation">&#125;</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 动态导入</span>
<span class="token keyword">const</span> LazyComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> 
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./HeavyComponent'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>mod <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">default</span><span class="token operator">:</span> mod<span class="token punctuation">.</span>HeavyComponent
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用（保留属性类型检查）</span>
<span class="token operator">&lt;</span>LazyComponent title<span class="token operator">=</span><span class="token string">"Items"</span> count<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">5</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Vue 异步组件类型</strong></p>
<ol>
<li>defineAsyncComponent：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> defineAsyncComponent <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> AsyncComponent <span class="token operator">=</span> <span class="token function">defineAsyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> 
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./AsyncComponent.vue'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
  <span class="token operator">&lt;</span>AsyncComponent <span class="token operator">:</span>count<span class="token operator">=</span><span class="token string">"5"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>类型推断组件属性：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 声明组件类型</span>
<span class="token keyword">interface</span> <span class="token class-name">AsyncComponentProps</span> <span class="token punctuation">&#123;</span>
  count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> AsyncComponent <span class="token operator">=</span> <span class="token function">defineAsyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token function-variable function">loader</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./AsyncComponent.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  loadingComponent<span class="token operator">:</span> LoadingSpinner<span class="token punctuation">,</span>
  delay<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> DefineComponent<span class="token operator">&lt;</span>AsyncComponentProps<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>代码分割模式</strong></p>
<ol>
<li>路由级分割：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// React Router v6</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createBrowserRouter</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span>
    path<span class="token operator">:</span> <span class="token string">'/dashboard'</span><span class="token punctuation">,</span>
    element<span class="token operator">:</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>React<span class="token punctuation">.</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>Spinner <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
        <span class="token punctuation">&#123;</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./Dashboard'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>Suspense<span class="token operator">></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    path<span class="token operator">:</span> <span class="token string">'/reports'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">lazy</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./Reports'</span><span class="token punctuation">)</span> <span class="token comment">// 自动处理Suspense</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>功能级分割：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 按需加载工具库</span>
<span class="token keyword">function</span> <span class="token function">processData</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./heavy-utils'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> sortBigData <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">sortBigData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>条件分割：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 根据设备加载不同模块</span>
<span class="token keyword">const</span> <span class="token function-variable function">loadEditor</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isMobileDevice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./mobile-editor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./desktop-editor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>类型安全策略</strong></p>
<ol>
<li>动态导入泛型封装：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// safeImport.ts</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">safeImport</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>modulePath<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: "[request]" */</span> modulePath<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">interface</span> <span class="token class-name">ChartModule</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">renderChart</span><span class="token operator">:</span> <span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token generic-function"><span class="token function">safeImport</span><span class="token generic class-name"><span class="token operator">&lt;</span>ChartModule<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'./charting-lib'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>chart <span class="token operator">=></span> chart<span class="token punctuation">.</span><span class="token function">renderChart</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>模块类型验证：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 运行时类型验证</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> <span class="token keyword">is</span> <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'typescript-is'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">loadModule</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> mod <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">is</span><span class="token operator">&lt;</span>PluginInterface<span class="token operator">></span><span class="token punctuation">(</span>mod<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Invalid plugin interface'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">return</span> mod<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>类型断言辅助：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 创建类型断言函数</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">assertModule</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>module<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">asserts</span> <span class="token keyword">module</span> <span class="token keyword">is</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> module<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Module missing required export: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">String</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> mod <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./validator'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token generic-function"><span class="token function">assertModule</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> validate<span class="token operator">:</span> <span class="token builtin">Function</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>mod<span class="token punctuation">,</span> <span class="token string">'validate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mod<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 安全调用</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Webpack 魔法注释</strong></p>
<ol>
<li>基础注释：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 命名代码块</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: "math" */</span> <span class="token string">'./math'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 预获取</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPrefetch: true */</span> <span class="token string">'./prefetch-module'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 预加载</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPreload: true */</span> <span class="token string">'./critical-module'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>组合使用：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 生产环境启用预取</span>
<span class="token keyword">const</span> isProd <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> comments <span class="token operator">=</span> isProd <span class="token operator">?</span> <span class="token string">'webpackPrefetch: true'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mod <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: "utils", $&#123;comments&#125; */</span> <span class="token string">'./utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>最佳实践指南</strong></p>
<ol>
<li>代码分割策略：</li>
</ol>
<table>
<thead>
<tr>
<th align="left">分割粒度</th>
<th align="left">适合场景</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">路由级</td>
<td align="left">SPA应用</td>
<td align="left"><code>lazy(() =&gt; import(&#39;./page&#39;))</code></td>
</tr>
<tr>
<td align="left">组件级</td>
<td align="left">大型组件&#x2F;三方组件</td>
<td align="left"><code>const Heavy = lazy(() =&gt; import(...))</code></td>
</tr>
<tr>
<td align="left">库级</td>
<td align="left">第三方大体积库</td>
<td align="left"><code>import(&#39;lodash/debounce&#39;)</code></td>
</tr>
<tr>
<td align="left">功能级</td>
<td align="left">非首屏关键功能</td>
<td align="left">点击后加载编辑器模块</td>
</tr>
</tbody></table>
<ol start="2">
<li>加载状态管理：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 自定义加载状态</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useLazyModule</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token function-variable function">loader</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>module<span class="token punctuation">,</span> setModule<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>loading<span class="token punctuation">,</span> setLoading<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>Error <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">loader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>setModule<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>setError<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> module<span class="token punctuation">,</span> loading<span class="token punctuation">,</span> error <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> module<span class="token operator">:</span> math<span class="token punctuation">,</span> loading <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useLazyModule</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> 
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./math'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>m <span class="token operator">=></span> m<span class="token punctuation">.</span>default<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>错误边界处理：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// React 错误边界</span>
<span class="token keyword">class</span> <span class="token class-name">LazyErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">&#123;</span>
  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> hasError<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  
  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> hasError<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>FallbackUI <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token operator">&lt;</span>LazyErrorBoundary<span class="token operator">></span>
  <span class="token operator">&lt;</span>React<span class="token punctuation">.</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>Spinner <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>LazyComponent <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>Suspense<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>LazyErrorBoundary<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>性能优化技巧</strong></p>
<ol>
<li>预加载关键模块：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 首屏渲染后预加载</span>
<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./next-page'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>批量加载策略：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 同时加载多个模块</span>
<span class="token keyword">const</span> <span class="token function-variable function">loadDashboardModules</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./chart'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./stats'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./recent-activity'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token function">loadDashboardModules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>chart<span class="token punctuation">,</span> stats<span class="token punctuation">,</span> activity<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  chart<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  stats<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>请求合并：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 使用Webpack魔法注释合并请求</span>
<span class="token keyword">const</span> <span class="token function-variable function">getEditor</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackMode: "lazy-once" */</span> <span class="token string">'./editor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 不同地方调用只加载一次</span>
button1<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">getEditor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
button2<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">getEditor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>类型安全陷阱与解决方案</strong></p>
<p>陷阱1：模块类型漂移</p>
<p>现象：模块更新后类型不匹配</p>
<p>解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 版本化类型声明</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'./chart'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ChartV2</span> <span class="token punctuation">&#123;</span>
    <span class="token function">newMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> chart<span class="token operator">:</span> ChartV2<span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> chart<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>陷阱2：动态路径类型丢失</p>
<p>解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 路径映射类型</span>
<span class="token keyword">type</span> <span class="token class-name">ModulePaths</span> <span class="token operator">=</span> 
  <span class="token operator">|</span> <span class="token string">'./math'</span> 
  <span class="token operator">|</span> <span class="token string">'./chart'</span> 
  <span class="token operator">|</span> <span class="token string">'./utils'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">loadModule</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>path<span class="token operator">:</span> ModulePaths<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">import</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>陷阱3：CJS&#x2F;ESM 互操作问题</p>
<p>解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 统一封装</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loadCompatModule</span><span class="token punctuation">(</span>path<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> mod <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> mod<span class="token punctuation">.</span>default <span class="token operator">||</span> mod<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="二、高级类型系统"><a href="#二、高级类型系统" class="headerlink" title="二、高级类型系统"></a>二、高级类型系统</h1><h2 id="2-1-工具类型原理"><a href="#2-1-工具类型原理" class="headerlink" title="2.1 工具类型原理"></a>2.1 工具类型原理</h2><h3 id="2-1-1-内置工具类型源码解析"><a href="#2-1-1-内置工具类型源码解析" class="headerlink" title="2.1.1 内置工具类型源码解析"></a>2.1.1 内置工具类型源码解析</h3><p>TypeScript 内置工具类型通过条件类型和映射类型实现</p>
<p><strong>基础工具类型</strong></p>
<ol>
<li><code>Partial&lt;T&gt;</code>：将类型 T 的所有属性变为可选</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Partial<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>实现原理：映射类型 + ? 修饰符</li>
<li>示例：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">type</span> <span class="token class-name">PartialUser</span> <span class="token operator">=</span> Partial<span class="token operator">&lt;</span>User<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// &#123; name?: string; age?: number &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li><code>Required&lt;T&gt;</code>：将类型 T 的所有属性变为必填</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Required<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>实现原理：映射类型 + -? 移除可选修饰符</li>
<li>示例：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">RequiredUser</span> <span class="token operator">=</span> Required<span class="token operator">&lt;</span>PartialUser<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// &#123; name: string; age: number &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="3">
<li><code>Readonly&lt;T&gt;</code>：将类型 T 的所有属性变为只读</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Readonly<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>实现原理：映射类型 + readonly 修饰符</li>
<li>示例：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ReadonlyUser</span> <span class="token operator">=</span> Readonly<span class="token operator">&lt;</span>User<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// &#123; readonly name: string; readonly age: number &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>结构操作工具类型</strong></p>
<ol>
<li><code>Pick&lt;T, K extends keyof T&gt;</code>: 从类型 T 中选取指定属性 K</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Pick<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>实现原理：映射类型 + 键名约束</li>
<li>示例：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">NameOnly</span> <span class="token operator">=</span> Pick<span class="token operator">&lt;</span>User<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// &#123; name: string &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li><code>Omit&lt;T, K extends keyof any&gt;</code>: 从类型 T 中排除指定属性 K</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Omit<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token builtin">any</span><span class="token operator">></span></span> <span class="token operator">=</span> Pick<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> Exclude<span class="token operator">&lt;</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">>></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>实现原理：组合 Pick 和 Exclude</li>
<li>源码依赖：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Exclude<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">U</span></span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>示例：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">WithoutAge</span> <span class="token operator">=</span> Omit<span class="token operator">&lt;</span>User<span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// &#123; name: string &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="3">
<li><code>Record&lt;K extends keyof any, T&gt;</code>: 创建键为 K、值为 T 的类型</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Record<span class="token operator">&lt;</span><span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>实现原理：动态键映射</li>
<li>示例：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">UserMap</span> <span class="token operator">=</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> User<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// &#123; [key: string]: User &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>类型操作工具类型</strong></p>
<ol>
<li><code>Exclude&lt;T, U&gt;</code>: 从 T 中排除可分配给 U 的类型</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Exclude<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">U</span></span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>实现原理：条件类型 + never</li>
<li>示例：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T0</span></span> <span class="token operator">=</span> Exclude<span class="token operator">&lt;</span><span class="token string">"a"</span> <span class="token operator">|</span> <span class="token string">"b"</span> <span class="token operator">|</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// "b" | "c"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li><code>Extract&lt;T, U&gt;</code>: 从 T 中提取可分配给 U 的类型</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Extract<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">U</span></span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>实现原理：条件类型反向操作</li>
<li>示例：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T1</span></span> <span class="token operator">=</span> Extract<span class="token operator">&lt;</span><span class="token string">"a"</span> <span class="token operator">|</span> <span class="token string">"b"</span> <span class="token operator">|</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"a"</span> <span class="token operator">|</span> <span class="token string">"f"</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// "a"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="3">
<li><code>NonNullable&lt;T&gt;</code>: 从 T 中排除 null 和 undefined</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">NonNullable<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">null</span></span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>实现原理：条件类型过滤</li>
<li>示例：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T2</span></span> <span class="token operator">=</span> NonNullable<span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// string</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>函数操作工具类型</strong></p>
<ol>
<li><code>Parameters&lt;T extends (...args: any) =&gt; any&gt;</code>: 获取函数参数类型元组</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Parameters<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span></span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">P</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">P</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>实现原理：infer 推导参数类型</li>
<li>示例：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">FnParams</span> <span class="token operator">=</span> Parameters<span class="token operator">&lt;</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// [string, number]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li><code>ReturnType&lt;T extends (...args: any) =&gt; any&gt;</code>: 获取函数返回值类型</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ReturnType<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span></span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">infer</span> <span class="token constant">R</span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>实现原理：infer 推导返回类型</li>
<li>示例：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">FnReturn</span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">boolean</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// boolean</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="3">
<li><code>ConstructorParameters&lt;T extends new (...args: any) =&gt; any&gt;</code>: 获取构造函数参数类型元组</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ConstructorParameters<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span></span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">new</span></span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">P</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">P</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>实现原理：infer 推导构造函数参数</li>
<li>示例：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">type</span> <span class="token class-name">Params</span> <span class="token operator">=</span> ConstructorParameters<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Person<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// [string, number]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>高级工具类型</strong></p>
<ol>
<li><code>ThisParameterType&lt;T&gt;</code>: 提取函数的 this 参数类型</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ThisParameterType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">U</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">U</span> <span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>实现原理：infer 捕获 this 类型</li>
<li>示例：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span> Window<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">type</span> <span class="token class-name">ThisType</span> <span class="token operator">=</span> ThisParameterType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> fn<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// Window</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol start="2">
<li><code>OmitThisParameter&lt;T&gt;</code>: 移除函数的 this 参数类型</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">OmitThisParameter<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token builtin">unknown</span> <span class="token keyword">extends</span> <span class="token class-name">ThisParameterType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">:</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">A</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">infer</span> <span class="token constant">R</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">R</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>实现原理：组合 ThisParameterType + 参数推导</li>
<li>示例：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">WithoutThis</span> <span class="token operator">=</span> OmitThisParameter<span class="token operator">&lt;</span><span class="token keyword">typeof</span> fn<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// () => void</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="3">
<li><code>Awaited&lt;T&gt;</code>: 递归解包 Promise 类型</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Awaited<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span>
    <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">null</span></span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">:</span> <span class="token comment">// 特殊处理 null/undefined</span>
    <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">object</span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span> <span class="token function">then</span><span class="token punctuation">(</span>onfulfilled<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">F</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">&#125;</span> <span class="token operator">?</span> <span class="token comment">// 检查 thenable 对象</span>
        <span class="token constant">F</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">V</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">?</span> 
            Awaited<span class="token operator">&lt;</span><span class="token constant">V</span><span class="token operator">></span> <span class="token operator">:</span> <span class="token comment">// 递归解包</span>
        <span class="token builtin">never</span> <span class="token operator">:</span> 
    <span class="token constant">T</span><span class="token punctuation">;</span> <span class="token comment">// 非 Promise 类型直接返回</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>实现原理：条件类型递归 + thenable 检测</li>
<li>示例：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T3</span></span> <span class="token operator">=</span> Awaited<span class="token operator">&lt;</span><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">>>></span><span class="token punctuation">;</span> <span class="token comment">// string</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>源码设计模式分析</strong></p>
<ol>
<li>分布式条件类型</li>
</ol>
<p>当泛型参数为联合类型时，条件类型会分布式应用：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// Exclude 中的分布式特性</span>
<span class="token keyword">type</span> <span class="token class-name">Exclude<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">U</span></span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Result</span> <span class="token operator">=</span> Exclude<span class="token operator">&lt;</span><span class="token string">'a'</span> <span class="token operator">|</span> <span class="token string">'b'</span> <span class="token operator">|</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'a'</span> <span class="token operator">|</span> <span class="token string">'b'</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// 'c'</span>

<span class="token comment">// 等价于：</span>
<span class="token punctuation">(</span><span class="token string">'a'</span> <span class="token keyword">extends</span> <span class="token string">'a'</span> <span class="token operator">|</span> <span class="token string">'b'</span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token operator">:</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token punctuation">(</span><span class="token string">'b'</span> <span class="token keyword">extends</span> <span class="token string">'a'</span> <span class="token operator">|</span> <span class="token string">'b'</span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token operator">:</span> <span class="token string">'b'</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token punctuation">(</span><span class="token string">'c'</span> <span class="token keyword">extends</span> <span class="token string">'a'</span> <span class="token operator">|</span> <span class="token string">'b'</span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token operator">:</span> <span class="token string">'c'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>类型递归模式</li>
</ol>
<p>处理嵌套结构的关键技术：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 内置工具类型中的递归</span>
<span class="token keyword">type</span> <span class="token class-name">DeepReadonly<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">object</span> 
    <span class="token operator">?</span> DeepReadonly<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token operator">></span> 
    <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>类型推断优先级</li>
</ol>
<p>infer 关键字的工作机制：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 协变位置（返回值）推断</span>
<span class="token keyword">type</span> <span class="token class-name">GetReturnType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">infer</span> <span class="token constant">R</span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>

<span class="token comment">// 逆变位置（参数）推断</span>
<span class="token keyword">type</span> <span class="token class-name">GetFirstArg<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">A</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">A</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程实践要点</strong></p>
<ol>
<li>避免过度嵌套：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 危险：深层嵌套可能导致类型实例化过深错误</span>
<span class="token keyword">type</span> <span class="token class-name">DeepNested</span> <span class="token operator">=</span> Awaited<span class="token operator">&lt;</span><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">>>></span><span class="token operator">></span><span class="token punctuation">;</span>

<span class="token comment">// 解决方案：设置递归深度限制</span>
<span class="token keyword">type</span> <span class="token class-name">SafeAwaited<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> Depth <span class="token keyword">extends</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  Depth <span class="token keyword">extends</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">:</span>
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">infer</span> <span class="token constant">U</span><span class="token operator">></span></span> <span class="token operator">?</span> SafeAwaited<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span>Depth<span class="token punctuation">]</span><span class="token operator">></span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>性能敏感场景优化：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 使用内置工具类型替代自定义复杂类型</span>
<span class="token comment">// 不推荐：</span>
<span class="token keyword">type</span> <span class="token class-name">MyPartial<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 推荐：直接使用 Partial</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>类型安全检查：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 确保工具类型安全</span>
<span class="token keyword">type</span> <span class="token class-name">SafeExtract<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token punctuation">[</span><span class="token constant">U</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 防止分布式行为</span>
<span class="token keyword">type</span> <span class="token class-name">DistributiveCheck<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token punctuation">[</span><span class="token builtin">never</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>源码调试技巧：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 使用类型打印调试</span>
<span class="token keyword">type</span> <span class="token class-name">_Debug<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">infer</span></span> <span class="token constant">U</span> <span class="token operator">?</span> <span class="token constant">U</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Reveal<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 查看实际类型</span>
<span class="token keyword">type</span> <span class="token class-name">DebugView</span> <span class="token operator">=</span> Reveal<span class="token operator">&lt;</span>SomeComplexType<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>内置工具类型关系图</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">基础操作
├─ Partial
├─ Required
├─ Readonly
│
结构操作
├─ Pick
├─ Omit → 依赖 Exclude
├─ Record
│
集合操作
├─ Exclude
├─ Extract
├─ NonNullable
│
函数操作
├─ Parameters
├─ ReturnType
├─ ConstructorParameters
├─ ThisParameterType
└─ OmitThisParameter<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-1-2-类型映射修饰符（-）原理"><a href="#2-1-2-类型映射修饰符（-）原理" class="headerlink" title="2.1.2 类型映射修饰符（+&#x2F;-）原理"></a>2.1.2 类型映射修饰符（+&#x2F;-）原理</h3><p><strong>修饰符基础概念</strong></p>
<p>类型映射修饰符用于控制属性修饰符（? 和 readonly）的添加或移除：</p>
<table>
<thead>
<tr>
<th align="left">修饰符</th>
<th align="left">作用</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">+</td>
<td align="left">添加修饰符（默认行为）</td>
<td align="left"><code>&#123; +readonly [P in K]: T &#125;</code></td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">移除修饰符</td>
<td align="left"><code>&#123; -? [P in K]: T &#125;</code></td>
</tr>
</tbody></table>
<p><strong>核心语法解析</strong></p>
<ol>
<li>添加修饰符（显式+）：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 显式添加只读属性</span>
<span class="token keyword">type</span> <span class="token class-name">AddReadonly<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token operator">+</span><span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 显式添加可选属性</span>
<span class="token keyword">type</span> <span class="token class-name">AddOptional<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>移除修饰符（-）：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 移除只读属性</span>
<span class="token keyword">type</span> <span class="token class-name">RemoveReadonly<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token operator">-</span><span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 移除可选属性</span>
<span class="token keyword">type</span> <span class="token class-name">RemoveOptional<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>实现原理分析</strong></p>
<ol>
<li>修饰符的编译转换：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 源码：</span>
<span class="token keyword">type</span> <span class="token class-name">Mutable<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token operator">-</span><span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 编译后等价于：</span>
<span class="token keyword">type</span> <span class="token class-name">Mutable<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>类型系统内部处理：<ul>
<li><code>+</code> 操作：添加属性描述符标志</li>
<li><code>-</code> 操作：清除属性描述符标志</li>
<li>映射过程本质是创建新属性描述符</li>
</ul>
</li>
</ol>
<p><strong>内置工具类型应用</strong></p>
<ol>
<li><code>Required&lt;T&gt;</code> 实现：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Required<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li><code>Readonly&lt;T&gt;</code> 实现：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Readonly<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token operator">+</span><span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li><code>Mutable&lt;T&gt;</code>（非内置但常用）：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Mutable<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token operator">-</span><span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>组合修饰符技巧</strong></p>
<ol>
<li>同时添加&#x2F;移除多个修饰符：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 创建可变且必填的类型</span>
<span class="token keyword">type</span> <span class="token class-name">MutableRequired<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token operator">-</span><span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 等价于：</span>
<span class="token keyword">type</span> <span class="token class-name">MutableRequired<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> Mutable<span class="token operator">&lt;</span>Required<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>条件修饰符：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 仅对函数属性添加只读</span>
<span class="token keyword">type</span> <span class="token class-name">ReadonlyMethods<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">Function</span></span> <span class="token operator">?</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span> <span class="token keyword">as</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">Function</span></span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token operator">:</span> <span class="token constant">P</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程实践指南</strong></p>
<ol>
<li>不可变状态管理：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 创建深度只读状态</span>
<span class="token keyword">type</span> <span class="token class-name">ImmutableState<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token operator">+</span><span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> ImmutableState<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">interface</span> <span class="token class-name">AppState</span> <span class="token punctuation">&#123;</span>
  user<span class="token operator">:</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  settings<span class="token operator">:</span> <span class="token punctuation">&#123;</span> darkMode<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> state<span class="token operator">:</span> ImmutableState<span class="token operator">&lt;</span>AppState<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  user<span class="token operator">:</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Alice"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  settings<span class="token operator">:</span> <span class="token punctuation">&#123;</span> darkMode<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"Bob"</span><span class="token punctuation">;</span> <span class="token comment">// 🚫 编译错误</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>API 响应处理：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 移除API响应中的可选属性</span>
<span class="token keyword">type</span> <span class="token class-name">ConcreteResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">interface</span> <span class="token class-name">ApiResponse</span> <span class="token punctuation">&#123;</span>
  data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span>
  error<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">handleResponse</span><span class="token punctuation">(</span>res<span class="token operator">:</span> ConcreteResponse<span class="token operator">&lt;</span>ApiResponse<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// res.data 和 res.error 一定存在</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>安全补丁策略：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 创建部分更新类型</span>
<span class="token keyword">type</span> <span class="token class-name">SafePatch<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> Partial<span class="token operator">&lt;</span>Mutable<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">readonly</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 保持ID只读</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">interface</span> <span class="token class-name">Product</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">readonly</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  price<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> update<span class="token operator">:</span> SafePatch<span class="token operator">&lt;</span>Product<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  id<span class="token operator">:</span> <span class="token string">"p1"</span><span class="token punctuation">,</span> <span class="token comment">// ✅ 允许（但实际不能修改）</span>
  name<span class="token operator">:</span> <span class="token string">"New Name"</span> <span class="token comment">// ✅</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>性能优化技巧</strong></p>
<ol>
<li>避免深度递归：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 限制递归深度</span>
<span class="token keyword">type</span> <span class="token class-name">DeepReadonly<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> Depth <span class="token keyword">extends</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  Depth <span class="token keyword">extends</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">:</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">object</span> <span class="token operator">?</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> DeepReadonly<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>Depth<span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>条件短路优化：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">OptimizedMutable<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">readonly</span></span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>OptimizedMutable<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">]</span><span class="token operator">>></span> <span class="token operator">:</span>
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">object</span> <span class="token operator">?</span> <span class="token punctuation">&#123;</span> <span class="token operator">-</span><span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> OptimizedMutable<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">&#125;</span> <span class="token operator">:</span>
  <span class="token constant">T</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>编译原理透视</strong></p>
<ol>
<li>修饰符的 AST 表示：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// TypeScript AST 节点示例</span>
<span class="token keyword">interface</span> <span class="token class-name">MappingModifier</span> <span class="token punctuation">&#123;</span>
  <span class="token operator">+</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span> <span class="token comment">// 添加修饰符</span>
  <span class="token operator">-</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span> <span class="token comment">// 移除修饰符</span>
  <span class="token keyword">readonly</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token string">"+"</span> <span class="token operator">|</span> <span class="token string">"-"</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  optional<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">"+"</span> <span class="token operator">|</span> <span class="token string">"-"</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>类型实例化流程：</li>
</ol>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">1. 解析映射语法
2. 获取源类型属性描述符
3. 应用修饰符操作（+/-）
4. 创建新属性描述符
5. 组合为新对象类型<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>常见问题解决方案</strong></p>
<p>问题：修饰符对方法无效</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">readonly</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// 方法本质是只读的</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T</span></span> <span class="token operator">=</span> Mutable<span class="token operator">&lt;</span>Test<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// 仍然只读</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">MutableMethods<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token operator">-</span><span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">Function</span></span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>问题：修饰符与交叉类型冲突</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">A</span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token keyword">readonly</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">B</span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">C</span></span> <span class="token operator">=</span> <span class="token constant">A</span> <span class="token operator">&amp;</span> <span class="token constant">B</span><span class="token punctuation">;</span> <span class="token comment">// id 变为 string（只读被覆盖）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">EnforceReadonly<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">SafeMerge<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token operator">></span></span> <span class="token operator">=</span> EnforceReadonly<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">></span> <span class="token operator">&amp;</span> EnforceReadonly<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>问题：数组和元组处理</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 元组可变化</span>
<span class="token keyword">type</span> <span class="token class-name">MutableTuple<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token keyword">readonly</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token operator">-</span><span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> arr<span class="token operator">:</span> MutableTuple<span class="token operator">&lt;</span><span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"b"</span><span class="token punctuation">;</span> <span class="token comment">// ✅</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>修饰符与内置工具类型关系</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">映射修饰符体系
├─ 添加操作 (+)
│  ├─ +readonly → Readonly&lt;T>
│  └─ +? → Partial&lt;T>
│
└─ 移除操作 (-)
   ├─ -readonly → Mutable&lt;T>
   └─ -? → Required&lt;T><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-1-3-条件类型分布式特性"><a href="#2-1-3-条件类型分布式特性" class="headerlink" title="2.1.3 条件类型分布式特性"></a>2.1.3 条件类型分布式特性</h3><p><strong>分布式条件类型核心概念</strong></p>
<p>触发条件：当条件类型作用于裸类型参数（naked type parameter）的联合类型时，会触发分布式行为</p>
<p>基本模式：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">U</span></span> <span class="token operator">?</span> <span class="token constant">X</span> <span class="token operator">:</span> <span class="token constant">Y</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>T 是裸类型参数（未包裹在数组、元组或函数中）</li>
<li>T 是联合类型 A | B | C</li>
<li>结果等价于 (A extends U ? X : Y) | (B extends U ? X : Y) | (C extends U ? X : Y)</li>
</ul>
<p><strong>分布式行为解析</strong></p>
<ol>
<li>基础示例：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">StringOrNumber<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">string</span></span> <span class="token operator">?</span> <span class="token string">"string"</span> <span class="token operator">:</span> <span class="token string">"number"</span><span class="token punctuation">;</span>

<span class="token comment">// 分布式计算</span>
<span class="token keyword">type</span> <span class="token class-name">Result</span> <span class="token operator">=</span> StringOrNumber<span class="token operator">&lt;</span><span class="token string">"a"</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token operator">></span><span class="token punctuation">;</span> 
<span class="token comment">// 等价于：</span>
<span class="token comment">// ("a" extends string ? "string" : "number") |</span>
<span class="token comment">// (1 extends string ? "string" : "number")</span>
<span class="token comment">// → "string" | "number"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>非分布式对比：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 包裹类型参数（非裸类型）</span>
<span class="token keyword">type</span> <span class="token class-name">Wrapped<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token string">"string"</span> <span class="token operator">:</span> <span class="token string">"number"</span><span class="token punctuation">;</span>

<span class="token comment">// 非分布式计算</span>
<span class="token keyword">type</span> <span class="token class-name">Result2</span> <span class="token operator">=</span> Wrapped<span class="token operator">&lt;</span><span class="token string">"a"</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token comment">// 等价于：</span>
<span class="token comment">// ["a" | 1] extends [string] ? "string" : "number"</span>
<span class="token comment">// → "number"（因为 ["a" | 1] 不继承 [string]）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>分布式规则详解</strong></p>
<ol>
<li>空联合类型处理：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Test<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">string</span></span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Result</span> <span class="token operator">=</span> Test<span class="token operator">&lt;</span><span class="token builtin">never</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// never（空联合类型返回never）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol start="2">
<li>联合类型包含never：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Test<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">string</span></span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Result</span> <span class="token operator">=</span> Test<span class="token operator">&lt;</span><span class="token string">"a"</span> <span class="token operator">|</span> <span class="token builtin">never</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// true（never被忽略）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol start="3">
<li>联合类型优先级：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Test<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">any</span></span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Result</span> <span class="token operator">=</span> Test<span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// string | number</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>内置工具类型应用</strong></p>
<ol>
<li><code>Exclude&lt;T, U&gt;</code>：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Exclude<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">U</span></span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>

<span class="token comment">// 分布式计算</span>
<span class="token keyword">type</span> <span class="token class-name">Result</span> <span class="token operator">=</span> Exclude<span class="token operator">&lt;</span><span class="token string">"a"</span> <span class="token operator">|</span> <span class="token string">"b"</span> <span class="token operator">|</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"a"</span> <span class="token operator">|</span> <span class="token string">"b"</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token comment">// → ("a" extends "a"|"b" ? never : "a") |</span>
<span class="token comment">//   ("b" extends "a"|"b" ? never : "b") |</span>
<span class="token comment">//   ("c" extends "a"|"b" ? never : "c")</span>
<span class="token comment">// → never | never | "c" → "c"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li><code>Extract&lt;T, U&gt;</code>：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Extract<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">U</span></span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 分布式计算</span>
<span class="token keyword">type</span> <span class="token class-name">Result</span> <span class="token operator">=</span> Extract<span class="token operator">&lt;</span><span class="token string">"a"</span> <span class="token operator">|</span> <span class="token string">"b"</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token comment">// → ("a" extends string ? "a" : never) |</span>
<span class="token comment">//   ("b" extends string ? "b" : never) |</span>
<span class="token comment">//   (1 extends string ? 1 : never)</span>
<span class="token comment">// → "a" | "b" | never → "a" | "b"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li><code>NonNullable&lt;T&gt;</code>：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">NonNullable<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">null</span></span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>

<span class="token comment">// 分布式计算</span>
<span class="token keyword">type</span> <span class="token class-name">Result</span> <span class="token operator">=</span> NonNullable<span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token comment">// → (string extends null|undefined ? never : string) |</span>
<span class="token comment">//   (null extends null|undefined ? never : null) |</span>
<span class="token comment">//   (undefined extends null|undefined ? never : undefined)</span>
<span class="token comment">// → string | never | never → string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>避免分布式行为</strong></p>
<ol>
<li>包裹类型参数：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 方法1：元组包裹</span>
<span class="token keyword">type</span> <span class="token class-name">NoDistribute<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token comment">// 方法2：数组包裹</span>
<span class="token keyword">type</span> <span class="token class-name">NoDistribute2<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">string</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token comment">// 方法3：函数包裹</span>
<span class="token keyword">type</span> <span class="token class-name">NoDistribute3<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">string</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>特殊类型约束：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 使用never约束</span>
<span class="token keyword">type</span> <span class="token class-name">IsNever<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token punctuation">[</span><span class="token builtin">never</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token comment">// 使用any约束</span>
<span class="token keyword">type</span> <span class="token class-name">IsAny<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&amp;</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>高级应用场景</strong></p>
<ol>
<li>联合类型过滤：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 过滤出函数类型</span>
<span class="token keyword">type</span> <span class="token class-name">FilterFunctions<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Functions</span> <span class="token operator">=</span> FilterFunctions<span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// () => void</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>类型差异检测：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 检测类型差异</span>
<span class="token keyword">type</span> <span class="token class-name">Diff<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">U</span></span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">type</span> <span class="token class-name">MissingProps</span> <span class="token operator">=</span> Diff<span class="token operator">&lt;</span><span class="token string">"name"</span> <span class="token operator">|</span> <span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token keyword">keyof</span> User<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// User中缺失的属性</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>递归类型操作：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 联合类型转元组（简化版）</span>
<span class="token keyword">type</span> <span class="token class-name">UnionToTuple<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">any</span></span> <span class="token operator">?</span> <span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span> <span class="token operator">:</span> <span class="token builtin">never</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">U</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span> <span class="token operator">?</span> <span class="token constant">U</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>分布式与映射类型结合</strong></p>
<ol>
<li>分布式键名重映射：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">AddPrefix<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span> <span class="token keyword">as</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">string</span></span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">data_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">K</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token keyword">type</span> <span class="token class-name">PrefixedProps</span> <span class="token operator">=</span> AddPrefix<span class="token operator">&lt;</span>Props<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token comment">// &#123; data_id: string; data_value: number &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>条件键名过滤：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 仅保留字符串键</span>
<span class="token keyword">type</span> <span class="token class-name">StringKeys<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">string</span></span> <span class="token operator">?</span> <span class="token constant">K</span> <span class="token operator">:</span> <span class="token builtin">never</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">type</span> <span class="token class-name">Keys</span> <span class="token operator">=</span> StringKeys<span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token string">"name"</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// "name"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>编译原理透视</strong></p>
<ol>
<li>分布式处理流程：</li>
</ol>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">1. 解析条件类型：T extends U ? X : Y
2. 检查T是否为裸类型参数的联合类型
3. 若是，对联合类型每个成员进行独立计算
4. 将计算结果组合为新联合类型<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>类型实例化优化：<ul>
<li>TS编译器对分布式条件类型进行缓存优化</li>
<li>相同类型参数的计算结果会被复用</li>
<li>避免重复计算提升性能</li>
</ul>
</li>
</ol>
<p><strong>工程实践指南</strong></p>
<ol>
<li>明确设计意图：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 需要分发时</span>
<span class="token keyword">type</span> <span class="token class-name">Distributed<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">any</span></span> <span class="token operator">?</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 不需要分发时</span>
<span class="token keyword">type</span> <span class="token class-name">NonDistributed<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token punctuation">[</span><span class="token builtin">any</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>文档注释规范：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">/**
 * 提取数组元素类型（分发模式）
 * @template T - 联合类型数组
 * @example 
 * type Element = ElementType&lt;Array&lt;string> | Array&lt;number>>; // string | number
 */</span>
<span class="token keyword">type</span> <span class="token class-name">ElementType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token keyword">infer</span> <span class="token constant">U</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token constant">U</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>性能监控策略：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 复杂类型性能测试</span>
<span class="token keyword">type</span> <span class="token class-name">StressTest<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">any</span></span> 
  <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">prefix_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">T</span> <span class="token operator">&amp;</span> string<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">_suffix</span><span class="token template-punctuation string">`</span></span> 
  <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 测量实例化时间</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">"type instantiation"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Result</span> <span class="token operator">=</span> StressTest<span class="token operator">&lt;</span><span class="token string">"a"</span> <span class="token operator">|</span> <span class="token string">"b"</span> <span class="token operator">|</span> <span class="token operator">...</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// 100+ 项</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">"type instantiation"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>错误处理模式：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 安全分发类型</span>
<span class="token keyword">type</span> <span class="token class-name">SafeDistribute<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> Fallback <span class="token operator">=</span> <span class="token builtin">never</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token punctuation">[</span><span class="token builtin">never</span><span class="token punctuation">]</span> <span class="token operator">?</span> Fallback <span class="token operator">:</span>
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">any</span></span> <span class="token operator">?</span> <span class="token comment">/* 分发逻辑 */</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">type</span> <span class="token class-name">Result</span> <span class="token operator">=</span> SafeDistribute<span class="token operator">&lt;</span><span class="token builtin">never</span><span class="token punctuation">,</span> <span class="token string">"empty"</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// "empty"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>分布式特性与内置工具</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">分布式条件类型应用体系
├─ 集合操作
│  ├─ Exclude（差集）
│  ├─ Extract（交集）
│  └─ NonNullable（过滤）
│
├─ 函数操作
│  ├─ Parameters
│  └─ ReturnType
│
└─ 高级工具
   ├─ UnionToIntersection
   └─ UnionToTuple<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-1-4-infer-关键字与类型提取"><a href="#2-1-4-infer-关键字与类型提取" class="headerlink" title="2.1.4 infer 关键字与类型提取"></a>2.1.4 infer 关键字与类型提取</h3><p><strong>infer 基础概念</strong></p>
<p>核心功能：在条件类型中声明泛型类型变量，用于推导和捕获类型信息</p>
<p>基本语法：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">infer</span></span> <span class="token constant">U</span> <span class="token operator">?</span> <span class="token constant">U</span> <span class="token operator">:</span> <span class="token builtin">never</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>infer U 声明一个类型变量 U</li>
<li>U 的类型由 TypeScript 根据上下文推导</li>
</ul>
<p>位置约束：</p>
<ul>
<li>只能在条件类型的 extends 子句中使用</li>
<li>只能出现在协变位置（返回值、属性值等）</li>
</ul>
<p><strong>基础提取模式</strong></p>
<ol>
<li>提取函数返回类型：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ReturnType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">infer</span> <span class="token constant">R</span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">type</span> <span class="token class-name">FnReturn</span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// number</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>提取函数参数类型：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">FirstParam<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span>first<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">P</span><span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">P</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">type</span> <span class="token class-name">Param</span> <span class="token operator">=</span> FirstParam<span class="token operator">&lt;</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>提取数组元素类型：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ArrayElement<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token keyword">infer</span> <span class="token constant">U</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token constant">U</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">type</span> <span class="token class-name">Element</span> <span class="token operator">=</span> ArrayElement<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>高级提取技术</strong></p>
<ol>
<li>递归类型解包：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 解包嵌套Promise</span>
<span class="token keyword">type</span> <span class="token class-name">Awaited<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">infer</span> <span class="token constant">U</span><span class="token operator">></span></span> <span class="token operator">?</span> Awaited<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">type</span> <span class="token class-name">Result</span> <span class="token operator">=</span> Awaited<span class="token operator">&lt;</span><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">>>></span><span class="token punctuation">;</span> <span class="token comment">// string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>多个 infer 变量：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 提取函数参数元组</span>
<span class="token keyword">type</span> <span class="token class-name">Params<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">P</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">P</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">type</span> <span class="token class-name">FnParams</span> <span class="token operator">=</span> Params<span class="token operator">&lt;</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// [string, number]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>逆变位置提取：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 提取函数this类型</span>
<span class="token keyword">type</span> <span class="token class-name">ThisType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">U</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">U</span> <span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span> Window<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">type</span> <span class="token class-name">Context</span> <span class="token operator">=</span> ThisType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> fn<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// Window</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>模式匹配技术</strong></p>
<ol>
<li>字符串模板提取：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 提取模板字符串变量</span>
<span class="token keyword">type</span> <span class="token class-name">ExtractVariable<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">user_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">?</span> Id <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">type</span> <span class="token class-name">UserId</span> <span class="token operator">=</span> ExtractVariable<span class="token operator">&lt;</span><span class="token string">"user_123"</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// "123"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>对象键值提取：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 提取特定键的值类型</span>
<span class="token keyword">type</span> <span class="token class-name">ValueOfKey<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token builtin">string</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span>key <span class="token keyword">in</span> <span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">V</span> <span class="token punctuation">&#125;</span> <span class="token operator">?</span> <span class="token constant">V</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">type</span> <span class="token class-name">NameType</span> <span class="token operator">=</span> ValueOfKey<span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> age<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>条件分支提取：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 提取满足条件的子类型</span>
<span class="token keyword">type</span> <span class="token class-name">ExtractByType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">U</span></span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">type</span> <span class="token class-name">Strings</span> <span class="token operator">=</span> ExtractByType<span class="token operator">&lt;</span><span class="token string">"a"</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// "a"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>内置工具类型解析</strong></p>
<ol>
<li><code>Parameters&lt;T&gt;</code> 实现：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Parameters<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span></span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">P</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">P</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol start="2">
<li><code>ReturnType&lt;T&gt;</code> 实现：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ReturnType<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span></span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">infer</span> <span class="token constant">R</span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol start="3">
<li><code>ConstructorParameters&lt;T&gt;</code> 实现：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ConstructorParameters<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span></span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">new</span></span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">P</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">P</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>工程应用模式</strong></p>
<ol>
<li>组件 Props 提取：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 提取React组件Props类型</span>
<span class="token keyword">type</span> <span class="token class-name">ComponentProps<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>ComponentType<span class="token operator">&lt;</span><span class="token keyword">infer</span> <span class="token constant">P</span><span class="token operator">></span> <span class="token operator">?</span> <span class="token constant">P</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> MyComponent<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> ComponentProps<span class="token operator">&lt;</span><span class="token keyword">typeof</span> MyComponent<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// &#123; id: string &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>API 响应处理：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 提取API响应中的data字段</span>
<span class="token keyword">type</span> <span class="token class-name">ApiResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  data<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  status<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">ResponseData<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">ApiResponse<span class="token operator">&lt;</span><span class="token keyword">infer</span> <span class="token constant">D</span><span class="token operator">></span></span> <span class="token operator">?</span> <span class="token constant">D</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">type</span> <span class="token class-name">UserData</span> <span class="token operator">=</span> ResponseData<span class="token operator">&lt;</span>ApiResponse<span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token operator">>></span><span class="token punctuation">;</span> <span class="token comment">// &#123; name: string &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>路由参数提取：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 提取动态路由参数</span>
<span class="token keyword">type</span> <span class="token class-name">RouteParams<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>string<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Param<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>string<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span> 
    <span class="token operator">?</span> Param <span class="token operator">|</span> RouteParams<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> 
    <span class="token operator">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>string<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Param<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span> 
      <span class="token operator">?</span> Param 
      <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">type</span> <span class="token class-name">Params</span> <span class="token operator">=</span> RouteParams<span class="token operator">&lt;</span><span class="token string">"/user/:id/profile/:section"</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// "id" | "section"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>编译原理透视</strong></p>
<ol>
<li>infer 实现机制：<ul>
<li>类型系统实现模式匹配</li>
<li>在类型关系求解时绑定类型变量</li>
<li>基于约束的类型变量实例化</li>
</ul>
</li>
<li>类型推导过程：</li>
</ol>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">1. 匹配条件类型结构
2. 提取候选类型
3. 绑定 infer 变量
4. 验证类型约束
5. 实例化结果类型<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>最佳实践指南</strong></p>
<ol>
<li>类型变量命名规范：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 推荐：描述性命名</span>
<span class="token keyword">type</span> <span class="token class-name">ExtractReturn<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">infer</span> ReturnType <span class="token operator">?</span> ReturnType <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 避免：单字母命名</span>
<span class="token keyword">type</span> <span class="token class-name">Bad<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>a<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">infer</span> <span class="token constant">R</span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>错误处理模式：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 安全提取模式</span>
<span class="token keyword">type</span> <span class="token class-name">SafeExtract<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> Fallback <span class="token operator">=</span> <span class="token builtin">never</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">V</span> <span class="token punctuation">&#125;</span> <span class="token operator">?</span> <span class="token constant">V</span> <span class="token operator">:</span> Fallback<span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">type</span> <span class="token class-name">Value</span> <span class="token operator">=</span> SafeExtract<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// never</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>复杂类型分解：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 分解复杂提取逻辑</span>
<span class="token keyword">type</span> <span class="token class-name">Step1<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token comment">/* ... */</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Step2<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> Step1<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">infer</span></span> <span class="token constant">U</span> <span class="token operator">?</span> <span class="token comment">/* ... */</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Final<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> Step2<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">infer</span></span> <span class="token constant">V</span> <span class="token operator">?</span> <span class="token comment">/* ... */</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>类型测试策略：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 使用类型断言验证</span>
<span class="token keyword">type</span> <span class="token class-name">Assert<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> Expected<span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Expected</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Test1</span> <span class="token operator">=</span> Assert<span class="token operator">&lt;</span>ReturnType<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token keyword">type</span> <span class="token class-name">Test2</span> <span class="token operator">=</span> Assert<span class="token operator">&lt;</span>FirstParam<span class="token operator">&lt;</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>infer 类型关系图</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">infer 应用体系
├─ 基础提取
│  ├─ 函数返回值 → ReturnType
│  ├─ 函数参数 → Parameters
│  └─ 数组元素 → ArrayElement
│
├─ 模式匹配
│  ├─ 字符串模板 → ExtractVariable
│  ├─ 对象结构 → ValueOfKey
│  └─ 条件分支 → ExtractByType
│
└─ 高级体操
   ├─ 元组转换 → MapTuple
   ├─ 柯里化 → Curry
   └─ 递归展开 → Expand<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2-2-类型体操实战"><a href="#2-2-类型体操实战" class="headerlink" title="2.2 类型体操实战"></a>2.2 类型体操实战</h2><h3 id="2-2-1-函数柯里化类型定义"><a href="#2-2-1-函数柯里化类型定义" class="headerlink" title="2.2.1 函数柯里化类型定义"></a>2.2.1 函数柯里化类型定义</h3><p><strong>柯里化核心概念</strong></p>
<ul>
<li>柯里化（Currying）：将多参数函数转化为一系列单参数函数的过程</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 原始函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">;</span>

<span class="token comment">// 柯里化后</span>
<span class="token keyword">const</span> <span class="token function-variable function">curriedAdd</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>c<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>类型挑战：<ul>
<li>动态推导剩余参数类型</li>
<li>处理参数数量不确定的情况</li>
<li>保持返回函数的链式调用类型安全</li>
</ul>
</li>
</ul>
<p><strong>基础柯里化类型实现</strong></p>
<p>场景1：固定参数长度的柯里化</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Curry1<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">A</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">infer</span> <span class="token constant">R</span> <span class="token operator">?</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">R</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Curry2<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">A</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">B</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">infer</span> <span class="token constant">R</span> 
  <span class="token operator">?</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>b<span class="token operator">:</span> <span class="token constant">B</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">R</span> 
  <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Curry3<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">A</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">B</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">C</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">infer</span> <span class="token constant">R</span> 
  <span class="token operator">?</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>b<span class="token operator">:</span> <span class="token constant">B</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>c<span class="token operator">:</span> <span class="token constant">C</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">R</span> 
  <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">curry</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>fn<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span> <span class="token operator">?</span> Curry3<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> curriedAdd <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 类型: (a: number) => (b: number) => (c: number) => number</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>场景2：动态参数长度的柯里化</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Curry<span class="token operator">&lt;</span><span class="token constant">F</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">F</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">infer</span> Return
  <span class="token operator">?</span> Args <span class="token keyword">extends</span> <span class="token punctuation">[</span><span class="token keyword">infer</span> First<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token keyword">infer</span> Rest<span class="token punctuation">]</span>
    <span class="token operator">?</span> <span class="token punctuation">(</span>arg<span class="token operator">:</span> First<span class="token punctuation">)</span> <span class="token operator">=></span> Curry<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> Rest<span class="token punctuation">)</span> <span class="token operator">=></span> Return<span class="token operator">></span>
    <span class="token operator">:</span> Return <span class="token comment">// 终止条件：无剩余参数</span>
  <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> dynamicCurry <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">F</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">(</span>fn<span class="token operator">:</span> <span class="token constant">F</span><span class="token punctuation">)</span><span class="token operator">:</span> Curry<span class="token operator">&lt;</span><span class="token constant">F</span><span class="token operator">></span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 实现略...</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> curried <span class="token operator">=</span> <span class="token function">dynamicCurry</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 类型: (arg: string) => (arg: number) => (arg: boolean) => void</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>高级柯里化类型技巧</strong></p>
<p>技巧1：支持部分应用（Partial Application）</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">PartialCurry<span class="token operator">&lt;</span><span class="token constant">F</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">F</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">infer</span> <span class="token constant">R</span>
  <span class="token operator">?</span> <span class="token operator">&lt;</span><span class="token constant">P</span> <span class="token keyword">extends</span> <span class="token class-name">Partial<span class="token operator">&lt;</span>Args<span class="token operator">></span></span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token constant">P</span><span class="token punctuation">)</span> <span class="token operator">=></span> 
      Args <span class="token keyword">extends</span> <span class="token punctuation">[</span><span class="token operator">...</span>SameLength<span class="token operator">&lt;</span><span class="token constant">P</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token keyword">infer</span> Rest<span class="token punctuation">]</span> 
        <span class="token operator">?</span> Rest <span class="token keyword">extends</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> 
          <span class="token operator">?</span> <span class="token constant">R</span> 
          <span class="token operator">:</span> PartialCurry<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> Rest<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">R</span><span class="token operator">></span>
        <span class="token operator">:</span> <span class="token builtin">never</span>
  <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> partialAdd <span class="token operator">=</span> <span class="token function">dynamicCurry</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> add10 <span class="token operator">=</span> <span class="token function">partialAdd</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 类型: (b: number) => (c: number) => number</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>技巧2：占位符支持（Placeholder）</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'placeholder'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Placeholder</span> <span class="token operator">=</span> <span class="token keyword">typeof</span> _<span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">CurryWithPlaceholder<span class="token operator">&lt;</span><span class="token constant">F</span><span class="token punctuation">,</span> Original <span class="token operator">=</span> <span class="token constant">F</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">F</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">infer</span> <span class="token constant">R</span>
    <span class="token operator">?</span> <span class="token operator">&lt;</span><span class="token constant">P</span> <span class="token keyword">extends</span> <span class="token class-name">CurryArgs<span class="token operator">&lt;</span>Args<span class="token operator">></span></span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token constant">P</span><span class="token punctuation">)</span> <span class="token operator">=></span> 
        IsComplete<span class="token operator">&lt;</span><span class="token constant">P</span><span class="token punctuation">,</span> Args<span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token boolean">true</span></span> 
          <span class="token operator">?</span> <span class="token constant">R</span> 
          <span class="token operator">:</span> CurryWithPlaceholder<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> Remaining<span class="token operator">&lt;</span><span class="token constant">P</span><span class="token punctuation">,</span> Args<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">R</span><span class="token punctuation">,</span> Original<span class="token operator">></span>
    <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 完整实现需定义辅助类型：</span>
<span class="token comment">// - CurryArgs：处理占位符的参数类型</span>
<span class="token comment">// - Remaining：计算剩余参数</span>
<span class="token comment">// - IsComplete：检查参数是否完整</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程实践与边界处理</strong></p>
<p>边界情况处理方案：</p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">解决方案</th>
</tr>
</thead>
<tbody><tr>
<td align="left">空参数调用</td>
<td align="left">返回原始函数</td>
</tr>
<tr>
<td align="left">参数数量超过原函数</td>
<td align="left">编译时报错</td>
</tr>
<tr>
<td align="left">混合类型参数</td>
<td align="left">使用泛型约束保持类型安全</td>
</tr>
<tr>
<td align="left">可选参数处理</td>
<td align="left">使用条件类型判断参数是否必须</td>
</tr>
</tbody></table>
<p>性能优化：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 避免深层递归（限制参数最大数量）</span>
<span class="token keyword">type</span> <span class="token class-name">MaxParams</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment">// 根据实际需求设定</span>

<span class="token keyword">type</span> <span class="token class-name">SafeCurry<span class="token operator">&lt;</span><span class="token constant">F</span><span class="token punctuation">,</span> Depth <span class="token keyword">extends</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  Depth <span class="token keyword">extends</span> <span class="token class-name">MaxParams</span> 
    <span class="token operator">?</span> <span class="token constant">F</span> <span class="token comment">// 达到深度限制时终止</span>
    <span class="token operator">:</span> <span class="token constant">F</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">infer</span> <span class="token constant">R</span>
      <span class="token operator">?</span> Args <span class="token keyword">extends</span> <span class="token punctuation">[</span><span class="token keyword">infer</span> First<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token keyword">infer</span> Rest<span class="token punctuation">]</span>
        <span class="token operator">?</span> <span class="token punctuation">(</span>arg<span class="token operator">:</span> First<span class="token punctuation">)</span> <span class="token operator">=></span> SafeCurry<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> Rest<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">R</span><span class="token punctuation">,</span> Add<span class="token operator">&lt;</span>Depth<span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">>></span>
        <span class="token operator">:</span> <span class="token constant">R</span>
      <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>面试级考点</strong></p>
<ul>
<li>类型递归深度限制：TypeScript 默认递归深度限制（约50层）</li>
<li>条件类型分发机制：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 联合类型在条件类型中的分发行为</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T</span></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token punctuation">[</span><span class="token keyword">infer</span> <span class="token constant">A</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token constant">A</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
<span class="token comment">// 结果: string | number</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>参数逆变问题：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">curry</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">P</span> <span class="token keyword">extends</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">R</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token constant">P</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">R</span><span class="token punctuation">)</span><span class="token operator">:</span> 
  <span class="token operator">&lt;</span><span class="token constant">A</span> <span class="token keyword">extends</span> <span class="token class-name">Partial<span class="token operator">&lt;</span><span class="token constant">P</span><span class="token operator">></span></span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">unknown</span><span class="token punctuation">;</span> <span class="token comment">// 需要处理逆变</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>实际应用场景：<ul>
<li>Redux 的 connect 函数</li>
<li>React 的高阶组件</li>
<li>配置化表单验证链</li>
</ul>
</li>
</ul>
<h3 id="2-2-2-Promise-链式调用类型推导"><a href="#2-2-2-Promise-链式调用类型推导" class="headerlink" title="2.2.2 Promise 链式调用类型推导"></a>2.2.2 Promise 链式调用类型推导</h3><p><strong>核心类型挑战</strong></p>
<table>
<thead>
<tr>
<th align="left">问题</th>
<th align="left">类型表现</th>
<th align="left">解决方案</th>
</tr>
</thead>
<tbody><tr>
<td align="left">初始值类型丢失</td>
<td align="left"><code>Promise.resolve(42).then(v =&gt; v) → v: unknown</code></td>
<td align="left">泛型捕获初始类型</td>
</tr>
<tr>
<td align="left">链式返回值类型推导</td>
<td align="left"><code>.then(x =&gt; x.toFixed())</code> → 推导失败</td>
<td align="left">条件类型 + 函数返回值推断</td>
</tr>
<tr>
<td align="left">错误类型传递中断</td>
<td align="left"><code>.catch(e =&gt; e.message)</code> → e: any</td>
<td align="left">泛型约束错误类型</td>
</tr>
<tr>
<td align="left">同步&#x2F;异步混合链</td>
<td align="left"><code>Promise.resolve().then(() =&gt; 42)</code> → 类型断裂</td>
<td align="left">递归解包 Promise 嵌套</td>
</tr>
</tbody></table>
<p><strong>基础链式调用类型实现</strong></p>
<p>场景1：基础 Promise 类型定义</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">MyPromise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token generic-function"><span class="token function">then</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
    onFulfilled<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">U</span> <span class="token operator">|</span> PromiseLike<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token operator">:</span> MyPromise<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span><span class="token punctuation">;</span>
  
  <span class="token generic-function"><span class="token function">catch</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
    onRejected<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>reason<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">U</span> <span class="token operator">|</span> PromiseLike<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token operator">:</span> MyPromise<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">|</span> <span class="token constant">U</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">createPromise</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token function-variable function">executor</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token function-variable function">resolve</span><span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=></span> MyPromise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>场景2：链式返回值类型推导</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">UnwrapPromise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">infer</span> <span class="token constant">U</span><span class="token operator">></span></span> <span class="token operator">?</span> UnwrapPromise<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">MyPromise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token generic-function"><span class="token function">then</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
    <span class="token function-variable function">onFulfilled</span><span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">U</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> MyPromise<span class="token operator">&lt;</span>UnwrapPromise<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">>></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 测试</span>
<span class="token keyword">const</span> chain <span class="token operator">=</span> <span class="token function">createPromise</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>v <span class="token operator">=></span> v<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// v: number → string</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>s <span class="token operator">=></span> <span class="token function">parseInt</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// s: string → number</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>高级链式类型技巧</strong></p>
<p>技巧1：自动解包嵌套 Promise</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">UnwrapPromise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">infer</span> <span class="token constant">U</span><span class="token operator">></span></span> <span class="token operator">?</span> UnwrapPromise<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span> <span class="token operator">:</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">infer</span> <span class="token constant">V</span><span class="token operator">></span> <span class="token operator">?</span> UnwrapPromise<span class="token operator">&lt;</span><span class="token constant">V</span><span class="token operator">></span> <span class="token operator">:</span> 
  <span class="token constant">T</span><span class="token punctuation">;</span>

<span class="token comment">// 处理多层嵌套</span>
<span class="token keyword">const</span> nested <span class="token operator">=</span> <span class="token function">createPromise</span><span class="token punctuation">(</span><span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 类型: MyPromise&lt;number> 而非 MyPromise&lt;Promise&lt;Promise&lt;number>>></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>技巧2：错误类型约束</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">MyPromise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">E</span> <span class="token operator">=</span> Error<span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token generic-function"><span class="token function">catch</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
    <span class="token function-variable function">onRejected</span><span class="token operator">:</span> <span class="token punctuation">(</span>reason<span class="token operator">:</span> <span class="token constant">E</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">U</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> MyPromise<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">|</span> UnwrapPromise<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token constant">E</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token generic-function"><span class="token function">createPromise</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token punctuation">,</span> RangeError<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>e <span class="token operator">=></span> e<span class="token punctuation">.</span>message<span class="token punctuation">)</span>  <span class="token comment">// e: RangeError → string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>技巧3：静态方法类型化</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">static</span> <span class="token generic-function"><span class="token function">resolve</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> MyPromise<span class="token operator">&lt;</span>UnwrapPromise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token generic-function"><span class="token function">all</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>values<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> MyPromise<span class="token operator">&lt;</span><span class="token punctuation">&#123;</span>
    <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> UnwrapPromise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">></span>
  <span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>边界情况处理</strong></p>
<p>场景1：空 then 处理</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">MyPromise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> MyPromise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>  <span class="token comment">// 透传当前类型</span>
  <span class="token generic-function"><span class="token function">then</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>onFulfilled<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> onRejected<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>reason<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">U</span><span class="token punctuation">)</span><span class="token operator">:</span> MyPromise<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">|</span> <span class="token constant">U</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 示例</span>
<span class="token function">createPromise</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">// 类型仍为 MyPromise&lt;number></span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> e <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 跳过成功回调</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>场景2：混合同步&#x2F;异步返回值</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">AsyncValue<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token operator">|</span> PromiseLike<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">UnwrapAsync<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">PromiseLike<span class="token operator">&lt;</span><span class="token keyword">infer</span> <span class="token constant">U</span><span class="token operator">></span></span> <span class="token operator">?</span> <span class="token constant">U</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">MyPromise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token generic-function"><span class="token function">then</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
    <span class="token function-variable function">onFulfilled</span><span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=></span> AsyncValue<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token operator">:</span> MyPromise<span class="token operator">&lt;</span>UnwrapAsync<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">>></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 处理同步返回值</span>
<span class="token function">createPromise</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>v <span class="token operator">=></span> v <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>      <span class="token comment">// 同步返回 number → MyPromise&lt;number></span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>v <span class="token operator">=></span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 异步返回 → MyPromise&lt;string></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程实践与面试考点</strong></p>
<p>Promise 组合模式：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 1. race 类型实现</span>
<span class="token keyword">static</span> <span class="token generic-function"><span class="token function">race</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>values<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> MyPromise<span class="token operator">&lt;</span>UnwrapPromise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">]</span><span class="token operator">>></span><span class="token punctuation">;</span>

<span class="token comment">// 2. 顺序执行链</span>
<span class="token keyword">const</span> tasks<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
tasks<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>chain<span class="token punctuation">,</span> task<span class="token punctuation">)</span> <span class="token operator">=></span> 
  chain<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>性能优化：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 避免深层递归类型 (设置最大解包深度)</span>
<span class="token keyword">type</span> <span class="token class-name">UnwrapPromiseDeep<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> Depth <span class="token keyword">extends</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  Depth <span class="token keyword">extends</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">:</span>
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">infer</span> <span class="token constant">U</span><span class="token operator">></span></span> 
    <span class="token operator">?</span> UnwrapPromiseDeep<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token punctuation">,</span> Subtract<span class="token operator">&lt;</span>Depth<span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">>></span> 
    <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>终极挑战：实现 async&#x2F;await 类型推导</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 模拟 async 函数返回类型</span>
<span class="token keyword">type</span> <span class="token class-name">AsyncFunction<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> MyPromise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>

<span class="token comment">// 模拟 await 类型推导</span>
<span class="token keyword">type</span> <span class="token class-name">Awaited<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">MyPromise<span class="token operator">&lt;</span><span class="token keyword">infer</span> <span class="token constant">U</span><span class="token operator">></span></span> <span class="token operator">?</span> Awaited<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">runAsync</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">F</span> <span class="token keyword">extends</span> AsyncFunction<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">>></span></span></span><span class="token punctuation">(</span>fn<span class="token operator">:</span> <span class="token constant">F</span><span class="token punctuation">)</span><span class="token operator">:</span> 
  ReturnType<span class="token operator">&lt;</span><span class="token constant">F</span><span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name">MyPromise<span class="token operator">&lt;</span><span class="token keyword">infer</span> <span class="token constant">R</span><span class="token operator">></span></span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>面试问题示例：</p>
<p>Q：为什么 <code>Promise&lt;Promise&lt;number&gt;&gt;</code> 会自动扁平化为 <code>Promise&lt;number&gt;</code>？</p>
<p>A：由 then 方法的类型定义决定：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name"><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token generic-function"><span class="token function">then</span><span class="token generic class-name"><span class="token operator">&lt;</span>TResult<span class="token operator">></span></span></span><span class="token punctuation">(</span>
    <span class="token function-variable function">onfulfilled</span><span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=></span> TResult <span class="token operator">|</span> PromiseLike<span class="token operator">&lt;</span>TResult<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>TResult<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>当 T 本身是 <code>Promise&lt;U&gt;</code> 时，value: T 实际接收 <code>Promise&lt;U&gt;</code>，但返回 <code>TResult | PromiseLike&lt;TResult&gt;</code> 会被再次包装为 <code>Promise&lt;TResult&gt;</code>，形成递归解包效果。</p>
<h3 id="2-2-3-Redux-reducer-类型安全实现"><a href="#2-2-3-Redux-reducer-类型安全实现" class="headerlink" title="2.2.3 Redux reducer 类型安全实现"></a>2.2.3 Redux reducer 类型安全实现</h3><p><strong>核心类型架构</strong></p>
<p>Redux 类型四要素：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 1. 状态类型</span>
<span class="token keyword">type</span> <span class="token class-name">State</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  counter<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  todos<span class="token operator">:</span> <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> completed<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">&#125;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 2. Action 类型（联合类型）</span>
<span class="token keyword">type</span> <span class="token class-name">Action</span> <span class="token operator">=</span> 
  <span class="token operator">|</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'INCREMENT'</span><span class="token punctuation">;</span> payload<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span>
  <span class="token operator">|</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'ADD_TODO'</span><span class="token punctuation">;</span> payload<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span>
  <span class="token operator">|</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'TOGGLE_TODO'</span><span class="token punctuation">;</span> payload<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 3. Reducer 函数签名</span>
<span class="token keyword">type</span> <span class="token class-name">Reducer<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token constant">S</span><span class="token punctuation">,</span> action<span class="token operator">:</span> Action<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">S</span><span class="token punctuation">;</span>

<span class="token comment">// 4. Dispatch 类型</span>
<span class="token keyword">type</span> <span class="token class-name">Dispatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span>action<span class="token operator">:</span> Action<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>类型安全 reducer 实现</strong></p>
<p>基础实现：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> reducer<span class="token operator">:</span> Reducer<span class="token operator">&lt;</span>State<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'INCREMENT'</span><span class="token operator">:</span>
      <span class="token comment">// ✅ 自动推断 payload 为 number</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> counter<span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">+</span> action<span class="token punctuation">.</span>payload <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token keyword">case</span> <span class="token string">'ADD_TODO'</span><span class="token operator">:</span>
      <span class="token comment">// ✅ 自动推断 payload 为 string</span>
      <span class="token keyword">const</span> newTodo <span class="token operator">=</span> <span class="token punctuation">&#123;</span> 
        id<span class="token operator">:</span> <span class="token function">nanoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
        text<span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">,</span> 
        completed<span class="token operator">:</span> <span class="token boolean">false</span> 
      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> todos<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">.</span>todos<span class="token punctuation">,</span> newTodo<span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token keyword">case</span> <span class="token string">'TOGGLE_TODO'</span><span class="token operator">:</span>
      <span class="token comment">// ✅ 自动推断 payload 为 string</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        todos<span class="token operator">:</span> state<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>todo <span class="token operator">=></span> 
          todo<span class="token punctuation">.</span>id <span class="token operator">===</span> action<span class="token punctuation">.</span>payload 
            <span class="token operator">?</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>todo<span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token operator">!</span>todo<span class="token punctuation">.</span>completed <span class="token punctuation">&#125;</span> 
            <span class="token operator">:</span> todo
        <span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token comment">// ❌ 捕获未处理 action</span>
      <span class="token keyword">const</span> _exhaustiveCheck<span class="token operator">:</span> <span class="token builtin">never</span> <span class="token operator">=</span> action<span class="token punctuation">;</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>高级模式：类型生成器</strong></p>
<p>自动创建类型安全 action：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// Action 创建函数工厂</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">createAction</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token constant">P</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>type<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>payload<span class="token operator">:</span> <span class="token constant">P</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token punctuation">,</span> payload <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">const</span> increment <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">'INCREMENT'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>amount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> addTodo <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">'ADD_TODO'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 自动生成 Action 类型</span>
<span class="token keyword">type</span> <span class="token class-name">Actions</span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> increment<span class="token operator">></span> <span class="token operator">|</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> addTodo<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>类型安全 reducer 生成器：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ActionMap</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token constant">INCREMENT</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token constant">ADD_TODO</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token constant">TOGGLE_TODO</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">createReducer</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span> <span class="token keyword">extends</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">>></span></span></span><span class="token punctuation">(</span>
  initialState<span class="token operator">:</span> <span class="token constant">S</span><span class="token punctuation">,</span>
  handlers<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">A</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token constant">S</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">S</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token constant">S</span> <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action<span class="token operator">:</span> <span class="token punctuation">&#123;</span> 
    <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">A</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">;</span> payload<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span> 
  <span class="token punctuation">&#125;</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">A</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>handlers<span class="token punctuation">[</span>action<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> handlers<span class="token punctuation">[</span>action<span class="token punctuation">.</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createReducer</span><span class="token generic class-name"><span class="token operator">&lt;</span>State<span class="token punctuation">,</span> ActionMap<span class="token operator">></span></span></span><span class="token punctuation">(</span>initialState<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">INCREMENT</span><span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> payload<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> counter<span class="token operator">:</span> state<span class="token punctuation">.</span>counter <span class="token operator">+</span> payload <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">ADD_TODO</span><span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> text<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> todos<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">.</span>todos<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token function">nanoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> text <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Redux Toolkit 集成</strong></p>
<p>现代 Redux 类型安全实践：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createSlice<span class="token punctuation">,</span> PayloadAction <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@reduxjs/toolkit'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> todosSlice <span class="token operator">=</span> <span class="token function">createSlice</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token string">'todos'</span><span class="token punctuation">,</span>
  initialState<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">as</span> Todo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  reducers<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    addTodo<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token function-variable function">reducer</span><span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token operator">:</span> PayloadAction<span class="token operator">&lt;</span>Todo<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        state<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token function-variable function">prepare</span><span class="token operator">:</span> <span class="token punctuation">(</span>text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        payload<span class="token operator">:</span> <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token function">nanoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> completed<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">toggleTodo</span><span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token operator">:</span> PayloadAction<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> todo <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>t <span class="token operator">=></span> t<span class="token punctuation">.</span>id <span class="token operator">===</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>todo<span class="token punctuation">)</span> todo<span class="token punctuation">.</span>completed <span class="token operator">=</span> <span class="token operator">!</span>todo<span class="token punctuation">.</span>completed<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 自动生成 Action 类型</span>
<span class="token keyword">type</span> <span class="token class-name">TodosAction</span> <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> todosSlice<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>addTodo<span class="token operator">></span> 
  <span class="token operator">|</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> todosSlice<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>toggleTodo<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>复杂场景处理</strong></p>
<p>异步 Action 类型：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ThunkAction <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">AppThunk<span class="token operator">&lt;</span>ReturnType <span class="token operator">=</span> <span class="token keyword">void</span><span class="token operator">></span></span> <span class="token operator">=</span> ThunkAction<span class="token operator">&lt;</span>
  ReturnType<span class="token punctuation">,</span>
  State<span class="token punctuation">,</span>
  <span class="token builtin">unknown</span><span class="token punctuation">,</span>
  Action
<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> fetchTodos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> AppThunk <span class="token operator">=></span> <span class="token keyword">async</span> dispatch <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'FETCH_TODOS_REQUEST'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'FETCH_TODOS_SUCCESS'</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> todos <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'FETCH_TODOS_FAILURE'</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> error<span class="token punctuation">.</span>message <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Reducer 组合类型：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">CombinedState</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  todos<span class="token operator">:</span> TodoState<span class="token punctuation">;</span>
  user<span class="token operator">:</span> UserState<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 类型安全的 combineReducers</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">combineTypedReducers</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">M</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>reducers<span class="token operator">:</span> <span class="token constant">M</span><span class="token punctuation">)</span><span class="token operator">:</span> Reducer<span class="token operator">&lt;</span><span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">M</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">M</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">Reducer<span class="token operator">&lt;</span><span class="token keyword">infer</span> <span class="token constant">S</span><span class="token operator">></span></span> <span class="token operator">?</span> <span class="token constant">S</span> <span class="token operator">:</span> <span class="token builtin">never</span>
<span class="token punctuation">&#125;</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> newState <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> reducers<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      newState<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> reducers<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span>state<span class="token operator">?.</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> newState<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>边界处理与优化</strong></p>
<table>
<thead>
<tr>
<th align="left">边界情况</th>
<th align="left">解决方案</th>
</tr>
</thead>
<tbody><tr>
<td align="left">空 action 处理</td>
<td align="left">使用 never 类型进行穷尽检查</td>
</tr>
<tr>
<td align="left">嵌套状态更新</td>
<td align="left">使用 Immer 库进行可变写法</td>
</tr>
<tr>
<td align="left">历史状态类型</td>
<td align="left">添加 undoable reducer 类型扩展</td>
</tr>
<tr>
<td align="left">动态 reducer 注册</td>
<td align="left">类型安全的 injectReducer 模式</td>
</tr>
</tbody></table>
<p>性能优化：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 1. 避免深层嵌套状态</span>
<span class="token keyword">type</span> <span class="token class-name">State</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ❌ 避免</span>
  deep<span class="token operator">:</span> <span class="token punctuation">&#123;</span> a<span class="token operator">:</span> <span class="token punctuation">&#123;</span> b<span class="token operator">:</span> <span class="token punctuation">&#123;</span> c<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token comment">// ✅ 推荐</span>
  flat<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> FlatItem<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 使用 Reselect 记忆化选择器</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createSelector <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'reselect'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">selectTodos</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> State<span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>todos<span class="token punctuation">;</span>
<span class="token keyword">const</span> selectCompletedTodos <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span>selectTodos<span class="token punctuation">]</span><span class="token punctuation">,</span>
  todos <span class="token operator">=></span> todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>t <span class="token operator">=></span> t<span class="token punctuation">.</span>completed<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>面试级考点</strong></p>
<ol>
<li>类型收窄原理：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 利用可辨识联合（discriminated union）</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'INCREMENT'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 此处 action 自动收窄为 &#123; type: 'INCREMENT'; payload: number &#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>类型安全与性能平衡：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// ❌ 过度泛化</span>
<span class="token keyword">type</span> <span class="token class-name">Action<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> payload<span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// ✅ 精确控制</span>
<span class="token keyword">type</span> <span class="token class-name">StrictAction</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'A'</span><span class="token punctuation">;</span> payload<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span> <span class="token operator">|</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'B'</span><span class="token punctuation">;</span> payload<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>Redux 中间件类型：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">MiddlewareAPI<span class="token operator">&lt;</span><span class="token constant">D</span> <span class="token keyword">extends</span> Dispatch<span class="token punctuation">,</span> <span class="token constant">S</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  dispatch<span class="token operator">:</span> <span class="token constant">D</span><span class="token punctuation">;</span>
  <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">S</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> <span class="token class-name">Middleware</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">S</span><span class="token operator">></span><span class="token punctuation">(</span>api<span class="token operator">:</span> MiddlewareAPI<span class="token operator">&lt;</span>Dispatch<span class="token punctuation">,</span> <span class="token constant">S</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=></span> 
  <span class="token punctuation">(</span>next<span class="token operator">:</span> Dispatch<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>action<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>时间旅行调试类型：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">TimeTravelState</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  past<span class="token operator">:</span> State<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  present<span class="token operator">:</span> State<span class="token punctuation">;</span>
  future<span class="token operator">:</span> State<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="5">
<li>终极挑战：实现类型安全的 Redux-Observable</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Epic</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  action$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>Action<span class="token operator">></span><span class="token punctuation">,</span>
  state$<span class="token operator">:</span> StateObservable<span class="token operator">&lt;</span>State<span class="token operator">></span>
<span class="token punctuation">)</span> <span class="token operator">=></span> Observable<span class="token operator">&lt;</span>Action<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> fetchEpic<span class="token operator">:</span> <span class="token function-variable function">Epic</span> <span class="token operator">=</span> <span class="token punctuation">(</span>action$<span class="token punctuation">,</span> state$<span class="token punctuation">)</span> <span class="token operator">=></span> 
  action$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">ofType</span><span class="token punctuation">(</span><span class="token string">'FETCH_REQUEST'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">switchMap</span><span class="token punctuation">(</span>action <span class="token operator">=></span> 
      <span class="token function">from</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">map</span><span class="token punctuation">(</span>response <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'FETCH_SUCCESS'</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> response <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">catchError</span><span class="token punctuation">(</span>error <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'FETCH_ERROR'</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> error <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-2-4-路由参数自动类型推导"><a href="#2-2-4-路由参数自动类型推导" class="headerlink" title="2.2.4 路由参数自动类型推导"></a>2.2.4 路由参数自动类型推导</h3><p><strong>核心挑战</strong></p>
<ol>
<li>路径解析：将字符串路径（如 &#x2F;user&#x2F;:id&#x2F;posts&#x2F;:postId）转换为类型结构</li>
<li>参数提取：识别动态段（:param）和可选段（?）</li>
<li>类型转换：将参数名映射为对象键（{ id: string; postId: string }）</li>
<li>嵌套路由：支持多层路由参数合并</li>
</ol>
<p><strong>基础路径参数推导</strong></p>
<p>场景1：提取单一路径参数</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ExtractParam<span class="token operator">&lt;</span>Path<span class="token operator">></span></span> <span class="token operator">=</span> 
  Path <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>string<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Param<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Rest<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token operator">?</span> Param <span class="token operator">|</span> ExtractParam<span class="token operator">&lt;</span>Rest<span class="token operator">></span>
    <span class="token operator">:</span> Path <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>string<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Param<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
      <span class="token operator">?</span> Param
      <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Test1</span> <span class="token operator">=</span> ExtractParam<span class="token operator">&lt;</span><span class="token string">'/user/:id'</span><span class="token operator">></span><span class="token punctuation">;</span>  <span class="token comment">// "id"</span>
<span class="token keyword">type</span> <span class="token class-name">Test2</span> <span class="token operator">=</span> ExtractParam<span class="token operator">&lt;</span><span class="token string">'/post/:postId/comment/:commentId'</span><span class="token operator">></span><span class="token punctuation">;</span>  <span class="token comment">// "postId" | "commentId"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>场景2：转换为参数对象类型</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">PathParams<span class="token operator">&lt;</span>Path<span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> ExtractParam<span class="token operator">&lt;</span>Path<span class="token operator">></span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Params1</span> <span class="token operator">=</span> PathParams<span class="token operator">&lt;</span><span class="token string">'/user/:id'</span><span class="token operator">></span><span class="token punctuation">;</span>  <span class="token comment">// &#123; id: string &#125;</span>
<span class="token keyword">type</span> <span class="token class-name">Params2</span> <span class="token operator">=</span> PathParams<span class="token operator">&lt;</span><span class="token string">'/category/:categoryId/product/:productId'</span><span class="token operator">></span><span class="token punctuation">;</span> 
<span class="token comment">// &#123; categoryId: string; productId: string &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>高级路由特性实现</strong></p>
<p>特性1：可选参数（?）</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ExtractOptionalParam<span class="token operator">&lt;</span>Path<span class="token operator">></span></span> <span class="token operator">=</span>
  Path <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>string<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Param<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">?/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Rest<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token operator">?</span> Param <span class="token operator">|</span> ExtractOptionalParam<span class="token operator">&lt;</span>Rest<span class="token operator">></span>
    <span class="token operator">:</span> Path <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>string<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Param<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">?</span><span class="token template-punctuation string">`</span></span>
      <span class="token operator">?</span> Param
      <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">PathParams<span class="token operator">&lt;</span>Path<span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> ExtractParam<span class="token operator">&lt;</span>Path<span class="token operator">></span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> ExtractOptionalParam<span class="token operator">&lt;</span>Path<span class="token operator">></span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Params3</span> <span class="token operator">=</span> PathParams<span class="token operator">&lt;</span><span class="token string">'/search/:query?'</span><span class="token operator">></span><span class="token punctuation">;</span>  <span class="token comment">// &#123; query?: string &#125;</span>
<span class="token keyword">type</span> <span class="token class-name">Params4</span> <span class="token operator">=</span> PathParams<span class="token operator">&lt;</span><span class="token string">'/user/:id/profile/:tab?'</span><span class="token operator">></span><span class="token punctuation">;</span> 
<span class="token comment">// &#123; id: string; tab?: string &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>特性2：通配符匹配（*）</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ExtractWildcard<span class="token operator">&lt;</span>Path<span class="token operator">></span></span> <span class="token operator">=</span>
  Path <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>string<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">*</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Rest<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token operator">?</span> <span class="token string">'wildcard'</span> <span class="token operator">|</span> ExtractWildcard<span class="token operator">&lt;</span>Rest<span class="token operator">></span>
    <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">PathParams<span class="token operator">&lt;</span>Path<span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> ExtractParam<span class="token operator">&lt;</span>Path<span class="token operator">></span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> ExtractOptionalParam<span class="token operator">&lt;</span>Path<span class="token operator">></span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> ExtractWildcard<span class="token operator">&lt;</span>Path<span class="token operator">></span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Params5</span> <span class="token operator">=</span> PathParams<span class="token operator">&lt;</span><span class="token string">'/files/*'</span><span class="token operator">></span><span class="token punctuation">;</span>  <span class="token comment">// &#123; wildcard: string[] &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>特性3：正则约束参数</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ExtractConstrainedParam<span class="token operator">&lt;</span>Path<span class="token operator">></span></span> <span class="token operator">=</span>
  Path <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>string<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Param<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Regex<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">)/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Rest<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token operator">?</span> <span class="token punctuation">&#123;</span> param<span class="token operator">:</span> Param<span class="token punctuation">;</span> regex<span class="token operator">:</span> Regex <span class="token punctuation">&#125;</span> <span class="token operator">|</span> ExtractConstrainedParam<span class="token operator">&lt;</span>Rest<span class="token operator">></span>
    <span class="token operator">:</span> Path <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>string<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Param<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Regex<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>
      <span class="token operator">?</span> <span class="token punctuation">&#123;</span> param<span class="token operator">:</span> Param<span class="token punctuation">;</span> regex<span class="token operator">:</span> Regex <span class="token punctuation">&#125;</span>
      <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">MapRegexToType<span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">R</span> <span class="token keyword">extends</span> <span class="token string">'\\d+'</span> <span class="token operator">?</span> <span class="token builtin">number</span> <span class="token operator">:</span>
  <span class="token constant">R</span> <span class="token keyword">extends</span> <span class="token string">'\\w+'</span> <span class="token operator">?</span> <span class="token builtin">string</span> <span class="token operator">:</span>
  <span class="token builtin">string</span><span class="token punctuation">;</span>  <span class="token comment">// 默认回退</span>

<span class="token keyword">type</span> <span class="token class-name">PathParams<span class="token operator">&lt;</span>Path<span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> ExtractParam<span class="token operator">&lt;</span>Path<span class="token operator">></span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> ExtractOptionalParam<span class="token operator">&lt;</span>Path<span class="token operator">></span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> ExtractWildcard<span class="token operator">&lt;</span>Path<span class="token operator">></span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> ExtractConstrainedParam<span class="token operator">&lt;</span>Path<span class="token operator">></span> <span class="token keyword">as</span> <span class="token constant">P</span><span class="token punctuation">[</span><span class="token string">'param'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> 
    MapRegexToType<span class="token operator">&lt;</span><span class="token constant">P</span><span class="token punctuation">[</span><span class="token string">'regex'</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Params6</span> <span class="token operator">=</span> PathParams<span class="token operator">&lt;</span><span class="token string">'/user/:id(\\d+)'</span><span class="token operator">></span><span class="token punctuation">;</span>  <span class="token comment">// &#123; id: number &#125;</span>
<span class="token keyword">type</span> <span class="token class-name">Params7</span> <span class="token operator">=</span> PathParams<span class="token operator">&lt;</span><span class="token string">'/post/:slug(\\w+)'</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// &#123; slug: string &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>React Router 集成实践</strong></p>
<p>类型安全路由组件：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useParams <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>

<span class="token comment">// 创建类型安全版本</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useTypedParams</span><span class="token generic class-name"><span class="token operator">&lt;</span>Path <span class="token keyword">extends</span> <span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">type</span> <span class="token class-name">Params</span> <span class="token operator">=</span> PathParams<span class="token operator">&lt;</span>Path<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">useParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Partial<span class="token operator">&lt;</span>Params<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// 可能未匹配所有参数</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 在组件中使用</span>
<span class="token keyword">const</span> <span class="token function-variable function">UserProfile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useTypedParams</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token string">'/user/:id/:tab?'</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token comment">// params: &#123; id?: string; tab?: string &#125;</span>
  
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>User <span class="token constant">ID</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>params<span class="token punctuation">.</span>id <span class="token operator">||</span> <span class="token string">'Unknown'</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>类型安全路由配置：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">RouteConfig<span class="token operator">&lt;</span>Path <span class="token keyword">extends</span> <span class="token builtin">string</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  path<span class="token operator">:</span> Path<span class="token punctuation">;</span>
  element<span class="token operator">:</span> React<span class="token punctuation">.</span>ReactNode<span class="token punctuation">;</span>
  children<span class="token operator">?</span><span class="token operator">:</span> RouteConfig<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">createRoute</span><span class="token generic class-name"><span class="token operator">&lt;</span>Path <span class="token keyword">extends</span> <span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>config<span class="token operator">:</span> RouteConfig<span class="token operator">&lt;</span>Path<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token function">createRoute</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  path<span class="token operator">:</span> <span class="token string">'/user/:id'</span><span class="token punctuation">,</span>
  element<span class="token operator">:</span> <span class="token operator">&lt;</span>UserPage <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
  children<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span> 
      path<span class="token operator">:</span> <span class="token string">'posts/:postId'</span><span class="token punctuation">,</span>  <span class="token comment">// 完整路径: /user/:id/posts/:postId</span>
      element<span class="token operator">:</span> <span class="token operator">&lt;</span>PostPage <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 自动推导参数类型</span>
<span class="token keyword">type</span> <span class="token class-name">UserPageParams</span> <span class="token operator">=</span> PathParams<span class="token operator">&lt;</span><span class="token keyword">typeof</span> routes<span class="token punctuation">.</span>path<span class="token operator">></span><span class="token punctuation">;</span>          <span class="token comment">// &#123; id: string &#125;</span>
<span class="token keyword">type</span> <span class="token class-name">PostPageParams</span> <span class="token operator">=</span> PathParams<span class="token operator">&lt;</span><span class="token keyword">typeof</span> routes<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>path<span class="token operator">></span><span class="token punctuation">;</span> 
<span class="token comment">// &#123; id: string; postId: string &#125; (包含父级参数)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>边界处理与优化</strong></p>
<p>递归深度控制：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ExtractParam<span class="token operator">&lt;</span>Path<span class="token punctuation">,</span> Depth <span class="token keyword">extends</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  Depth <span class="token keyword">extends</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token operator">:</span>
  Path <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>string<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Param<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Rest<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token operator">?</span> Param <span class="token operator">|</span> ExtractParam<span class="token operator">&lt;</span>Rest<span class="token punctuation">,</span> Subtract<span class="token operator">&lt;</span>Depth<span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">>></span>
    <span class="token operator">:</span> Path <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>string<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Param<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
      <span class="token operator">?</span> Param
      <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>路径冲突检测：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">DetectConflict<span class="token operator">&lt;</span>Path<span class="token operator">></span></span> <span class="token operator">=</span> 
  ExtractParam<span class="token operator">&lt;</span>Path<span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">infer</span></span> <span class="token constant">P</span>
    <span class="token operator">?</span> <span class="token constant">P</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">any</span></span>
      <span class="token operator">?</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token constant">P</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">K</span> <span class="token punctuation">&#125;</span> <span class="token keyword">extends</span> <span class="token class-name">Record<span class="token operator">&lt;</span><span class="token constant">P</span><span class="token punctuation">,</span> <span class="token constant">P</span><span class="token operator">></span></span>
        <span class="token operator">?</span> Path  <span class="token comment">// 无冲突</span>
        <span class="token operator">:</span> <span class="token builtin">never</span> <span class="token comment">// 存在重复参数</span>
      <span class="token operator">:</span> <span class="token builtin">never</span>
    <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 使用示例</span>
<span class="token keyword">type</span> <span class="token class-name">SafePath</span> <span class="token operator">=</span> DetectConflict<span class="token operator">&lt;</span><span class="token string">'/user/:id/posts/:id'</span><span class="token operator">></span><span class="token punctuation">;</span>  <span class="token comment">// never (检测到重复id)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>面试级考点</strong></p>
<ol>
<li>模板字面量类型操作：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">SplitPath<span class="token operator">&lt;</span><span class="token constant">P</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">P</span> <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Part<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Rest<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span> 
  <span class="token operator">?</span> <span class="token punctuation">[</span>Part<span class="token punctuation">,</span> <span class="token operator">...</span>SplitPath<span class="token operator">&lt;</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>Rest<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token operator">></span><span class="token punctuation">]</span> 
  <span class="token operator">:</span> <span class="token constant">P</span> <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Part<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span> 
    <span class="token operator">?</span> <span class="token punctuation">[</span>Part<span class="token punctuation">]</span> 
    <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>类型递归限制：TS 4.5+ 支持尾递归优化</li>
<li>React Router v6 类型实现：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 官方ParamKey类型定义</span>
<span class="token keyword">type</span> <span class="token class-name">ParamKey<span class="token operator">&lt;</span>TPath<span class="token operator">></span></span> <span class="token operator">=</span> TPath <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> _<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Param<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Rest<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token operator">?</span> Param <span class="token operator">|</span> ParamKey<span class="token operator">&lt;</span>Rest<span class="token operator">></span>
  <span class="token operator">:</span> TPath <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> _<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Param<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token operator">?</span> Param
    <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>Vue Router 对比：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// Vue Router的RouteRecordRaw类型</span>
<span class="token keyword">interface</span> <span class="token class-name">RouteRecordRaw</span> <span class="token punctuation">&#123;</span>
  path<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  component<span class="token operator">:</span> Component<span class="token punctuation">;</span>
  children<span class="token operator">?</span><span class="token operator">:</span> RouteRecordRaw<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="5">
<li>终极挑战：实现Next.js文件路由类型</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">NextPageParams<span class="token operator">&lt;</span>Path<span class="token operator">></span></span> <span class="token operator">=</span> 
  Path <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">pages/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Route<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">.tsx</span><span class="token template-punctuation string">`</span></span> 
    <span class="token operator">?</span> PathParams<span class="token operator">&lt;</span>Route<span class="token operator">></span>
    <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>

<span class="token comment">// 文件路径: pages/user/[id]/[tab].tsx</span>
<span class="token keyword">type</span> <span class="token class-name">Params</span> <span class="token operator">=</span> NextPageParams<span class="token operator">&lt;</span><span class="token string">'pages/user/[id]/[tab].tsx'</span><span class="token operator">></span><span class="token punctuation">;</span> 
<span class="token comment">// &#123; id: string; tab: string &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2-3-模板字面量类型"><a href="#2-3-模板字面量类型" class="headerlink" title="2.3 模板字面量类型"></a>2.3 模板字面量类型</h2><h3 id="2-3-1-字符串模板类型操作"><a href="#2-3-1-字符串模板类型操作" class="headerlink" title="2.3.1 字符串模板类型操作"></a>2.3.1 字符串模板类型操作</h3><h3 id="2-3-2-Uppercase-Lowercase-类型转换"><a href="#2-3-2-Uppercase-Lowercase-类型转换" class="headerlink" title="2.3.2 Uppercase&#x2F;Lowercase 类型转换"></a>2.3.2 Uppercase&#x2F;Lowercase 类型转换</h3><h3 id="2-3-3-路由路径模式匹配"><a href="#2-3-3-路由路径模式匹配" class="headerlink" title="2.3.3 路由路径模式匹配"></a>2.3.3 路由路径模式匹配</h3><h3 id="2-3-4-国际化键名自动补全"><a href="#2-3-4-国际化键名自动补全" class="headerlink" title="2.3.4 国际化键名自动补全"></a>2.3.4 国际化键名自动补全</h3><h2 id="2-4-类型编程优化"><a href="#2-4-类型编程优化" class="headerlink" title="2.4 类型编程优化"></a>2.4 类型编程优化</h2><h3 id="2-4-1-类型递归与尾递归优化"><a href="#2-4-1-类型递归与尾递归优化" class="headerlink" title="2.4.1 类型递归与尾递归优化"></a>2.4.1 类型递归与尾递归优化</h3><h3 id="2-4-2-类型实例化深度控制"><a href="#2-4-2-类型实例化深度控制" class="headerlink" title="2.4.2 类型实例化深度控制"></a>2.4.2 类型实例化深度控制</h3><h3 id="2-4-3-条件类型短路技巧"><a href="#2-4-3-条件类型短路技巧" class="headerlink" title="2.4.3 条件类型短路技巧"></a>2.4.3 条件类型短路技巧</h3><h3 id="2-4-4-类型性能分析工具"><a href="#2-4-4-类型性能分析工具" class="headerlink" title="2.4.4 类型性能分析工具"></a>2.4.4 类型性能分析工具</h3><h1 id="三、工程化实践"><a href="#三、工程化实践" class="headerlink" title="三、工程化实践"></a>三、工程化实践</h1><h2 id="3-1-TSConfig-深度配置"><a href="#3-1-TSConfig-深度配置" class="headerlink" title="3.1 TSConfig 深度配置"></a>3.1 TSConfig 深度配置</h2><h3 id="3-1-1-严格模式全家桶配置"><a href="#3-1-1-严格模式全家桶配置" class="headerlink" title="3.1.1 严格模式全家桶配置"></a>3.1.1 严格模式全家桶配置</h3><p><strong>严格模式核心配置</strong></p>
<p>启用所有严格检查：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此配置等价于同时启用以下所有子选项（TypeScript 2.3+）。</p>
<p><strong>严格模式子选项详解</strong></p>
<table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">默认值</th>
<th align="left">作用</th>
<th align="left">推荐值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">strict</td>
<td align="left">false</td>
<td align="left">所有严格检查的总开关</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">noImplicitAny</td>
<td align="left">false</td>
<td align="left">禁止隐式 any 类型</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">noImplicitThis</td>
<td align="left">false</td>
<td align="left">禁止隐式 any 类型的 this</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">strictNullChecks</td>
<td align="left">false</td>
<td align="left">严格的 null&#x2F;undefined 检查</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">strictFunctionTypes</td>
<td align="left">false</td>
<td align="left">严格的函数类型检查（逆变参数）</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">strictBindCallApply</td>
<td align="left">false</td>
<td align="left">严格的 bind&#x2F;call&#x2F;apply 方法检查</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">strictPropertyInitialization</td>
<td align="left">false</td>
<td align="left">严格的类属性初始化检查（需配合 strictNullChecks）</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">alwaysStrict</td>
<td align="left">false</td>
<td align="left">以严格模式解析代码，并在每个文件顶部添加 “use strict”</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">useUnknownInCatchVariables</td>
<td align="left">false</td>
<td align="left">catch 子句变量默认为 unknown 类型（TS 4.4+）</td>
<td align="left">true</td>
</tr>
</tbody></table>
<p><strong>配置详解与工程实践</strong></p>
<ol>
<li>noImplicitAny</li>
</ol>
<p>问题代码：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 🚫 参数隐式 any</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// ✅ 显式声明类型</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>strictNullChecks</li>
</ol>
<p>问题代码：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"app"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span> <span class="token comment">// 🚫 可能为 null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"app"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// ✅ 安全检查</span>
  element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>strictPropertyInitialization</li>
</ol>
<p>问题代码：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 🚫 未初始化</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 明确赋值断言</span>
  <span class="token comment">// 或</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>useUnknownInCatchVariables</li>
</ol>
<p>问题代码：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span> 
<span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// any 类型</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🚫 可能不存在</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span> 
<span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// ✅ TS 4.4+</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token keyword">instanceof</span> <span class="token class-name">Error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>四、严格模式配置策略</p>
<ol>
<li>渐进启用策略：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"noImplicitAny"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 临时关闭最严格的规则</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>文件级覆盖：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// @ts-nocheck  // 禁用整个文件检查</span>
<span class="token comment">// @ts-ignore   // 禁用下一行检查</span>

<span class="token keyword">function</span> <span class="token function">legacyCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
  <span class="token comment">// @ts-expect-error // 预期错误（TS 3.9+）</span>
  <span class="token keyword">const</span> x<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token string">"string"</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>目录差异化配置：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token comment">// 根目录 tsconfig.json</span>
<span class="token punctuation">&#123;</span>
  <span class="token property">"extends"</span><span class="token operator">:</span> <span class="token string">"./tsconfig.base.json"</span><span class="token punctuation">,</span>
  <span class="token property">"references"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span> <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"./src"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token comment">// 应用严格模式</span>
    <span class="token punctuation">&#123;</span> <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"./legacy"</span> <span class="token punctuation">&#125;</span>      <span class="token comment">// 非严格模式</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// legacy/tsconfig.json</span>
<span class="token punctuation">&#123;</span>
  <span class="token property">"extends"</span><span class="token operator">:</span> <span class="token string">"../tsconfig.base.json"</span><span class="token punctuation">,</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"strict"</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>性能与严格模式</strong></p>
<ol>
<li>编译速度影响：</li>
</ol>
<table>
<thead>
<tr>
<th align="left">严格选项</th>
<th align="left">性能影响</th>
<th align="left">缓解措施</th>
</tr>
</thead>
<tbody><tr>
<td align="left">strictNullChecks</td>
<td align="left">中</td>
<td align="left">项目引用隔离修改范围</td>
</tr>
<tr>
<td align="left">noImplicitAny</td>
<td align="left">高</td>
<td align="left">渐进启用 + @ts-ignore 临时方案</td>
</tr>
<tr>
<td align="left">strictFunctionTypes</td>
<td align="left">低</td>
<td align="left">无需特别处理</td>
</tr>
</tbody></table>
<ol start="2">
<li>内存占用优化：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"incremental"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 增量编译</span>
    <span class="token property">"tsBuildInfoFile"</span><span class="token operator">:</span> <span class="token string">"./buildcache/.tsbuildinfo"</span> <span class="token comment">// 缓存位置</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>严格模式错误处理</strong></p>
<ol>
<li>常见错误类型：</li>
</ol>
<table>
<thead>
<tr>
<th align="left">错误代码</th>
<th align="left">含义</th>
<th align="left">解决方案</th>
</tr>
</thead>
<tbody><tr>
<td align="left">TS7006</td>
<td align="left">参数隐式 any</td>
<td align="left">添加类型注解</td>
</tr>
<tr>
<td align="left">TS2532</td>
<td align="left">对象可能为 undefined</td>
<td align="left">添加空值检查</td>
</tr>
<tr>
<td align="left">TS2564</td>
<td align="left">属性未初始化</td>
<td align="left">构造函数初始化或明确赋值断言</td>
</tr>
<tr>
<td align="left">TS2345</td>
<td align="left">参数类型不匹配</td>
<td align="left">修正参数类型或使用类型断言</td>
</tr>
</tbody></table>
<ol start="2">
<li>错误自动修复：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token comment">// .vscode/settings.json</span>
<span class="token punctuation">&#123;</span>
  <span class="token property">"typescript.tsserver.experimental.enableProjectDiagnostics"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"editor.codeActionsOnSave"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"source.fixAll.ts"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>企业级配置模板</strong></p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token comment">// tsconfig.strict.json</span>
<span class="token punctuation">&#123;</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"noFallthroughCasesInSwitch"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"noUnusedLocals"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"noUnusedParameters"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"noImplicitReturns"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"forceConsistentCasingInFileNames"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"skipLibCheck"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"incremental"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"composite"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-1-2-模块解析策略实战"><a href="#3-1-2-模块解析策略实战" class="headerlink" title="3.1.2 模块解析策略实战"></a>3.1.2 模块解析策略实战</h3><p><strong>模块解析策略概述</strong></p>
<p>TypeScript 支持两种模块解析策略：</p>
<table>
<thead>
<tr>
<th align="left">策略</th>
<th align="left">触发条件</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Classic</td>
<td align="left">“moduleResolution”: “Classic”</td>
<td align="left">TypeScript 1.6 前旧项目</td>
</tr>
<tr>
<td align="left">Node</td>
<td align="left">“moduleResolution”: “Node”</td>
<td align="left">现代项目（默认值）</td>
</tr>
<tr>
<td align="left">Node16&#x2F;NodeNext</td>
<td align="left">“moduleResolution”: “Node16”</td>
<td align="left">Node.js 16+ 和 ESM 项目</td>
</tr>
</tbody></table>
<p><strong>Node 解析策略详解</strong></p>
<p>解析流程（import { x } from ‘module’）：</p>
<ol>
<li>检查当前目录的 node_modules&#x2F;module.ts&#x2F;module.tsx&#x2F;module.d.ts</li>
<li>检查 node_modules&#x2F;module&#x2F;package.json 的 types 或 main 字段</li>
<li>检查 node_modules&#x2F;module&#x2F;index.ts&#x2F;index.d.ts</li>
<li>递归检查父目录的 node_modules（..&#x2F;node_modules&#x2F;module）</li>
</ol>
<p>文件扩展名解析顺序：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token punctuation">[</span>
  <span class="token string">".ts"</span><span class="token punctuation">,</span> <span class="token string">".tsx"</span><span class="token punctuation">,</span> <span class="token string">".d.ts"</span><span class="token punctuation">,</span>         <span class="token comment">// TypeScript 文件</span>
  <span class="token string">".js"</span><span class="token punctuation">,</span> <span class="token string">".jsx"</span><span class="token punctuation">,</span> <span class="token string">".cjs"</span><span class="token punctuation">,</span> <span class="token string">".mjs"</span><span class="token punctuation">,</span>  <span class="token comment">// JavaScript 文件</span>
  <span class="token string">".json"</span>                         <span class="token comment">// JSON 文件</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Node16&#x2F;NodeNext 策略</strong></p>
<p>ESM 专属特性：</p>
<ol>
<li>支持 package.json 的 exports 和 imports 字段</li>
<li>严格区分 .js (CommonJS) 和 .mjs (ESM) 文件</li>
<li>支持 type: “module” 声明</li>
</ol>
<p>exports 字段优先级：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"exports"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"."</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"import"</span><span class="token operator">:</span> <span class="token string">"./dist/esm/index.js"</span><span class="token punctuation">,</span>   <span class="token comment">// ESM 入口</span>
      <span class="token property">"require"</span><span class="token operator">:</span> <span class="token string">"./dist/cjs/index.js"</span><span class="token punctuation">,</span>  <span class="token comment">// CommonJS 入口</span>
      <span class="token property">"types"</span><span class="token operator">:</span> <span class="token string">"./types/index.d.ts"</span>      <span class="token comment">// 类型声明</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"./feature"</span><span class="token operator">:</span> <span class="token string">"./dist/feature.js"</span>     <span class="token comment">// 子路径导出</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>实战配置示例</strong></p>
<p>基础配置：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token comment">// tsconfig.json</span>
<span class="token punctuation">&#123;</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"ESNext"</span><span class="token punctuation">,</span>
    <span class="token property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"Node16"</span><span class="token punctuation">,</span>
    <span class="token property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"./src"</span><span class="token punctuation">,</span>
    <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"@components/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"components/*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"@utils"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"utils/index"</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>多环境配置：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"Node16"</span><span class="token punctuation">,</span>
    <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"config"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"config/prod"</span><span class="token punctuation">,</span> <span class="token comment">// 生产环境</span>
        <span class="token string">"config/dev"</span>   <span class="token comment">// 开发环境</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>路径映射实战</strong></p>
<ol>
<li>别名配置：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"."</span><span class="token punctuation">,</span>
  <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"@app/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src/*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"shared/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"../shared/*"</span><span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>多路径回退：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"legacy-utils"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"src/utils/v2"</span><span class="token punctuation">,</span> <span class="token comment">// 优先使用 v2</span>
      <span class="token string">"src/utils/v1"</span>  <span class="token comment">// 回退到 v1</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>通配符扩展：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"@assets/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"assets/*"</span><span class="token punctuation">,</span>
      <span class="token string">"public/images/*"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>常见问题解决方案</strong></p>
<p>问题1：路径映射运行时失效</p>
<p>解决方案：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装运行时解析器</span>
<span class="token function">npm</span> <span class="token function">install</span> tsconfig-paths --save-dev

<span class="token comment"># Node.js 启动命令</span>
<span class="token function">node</span> <span class="token parameter variable">-r</span> tsconfig-paths/register app.ts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>问题2：循环依赖解析失败</p>
<p>重构方案：</p>
<pre><code class="mermaid">graph LR
    A[ModuleA] --&gt;|import| B[ModuleB]
    B --&gt;|import| C[ModuleC]
    C --&gt;|import| A[ModuleA]
    
    subgraph 重构后
    D[Common] --&gt; E[ModuleA]
    D[Common] --&gt; F[ModuleB]
    D[Common] --&gt; G[ModuleC]
    end</code></pre>

<p>问题3：动态导入类型丢失</p>
<p>类型安全方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 动态导入类型封装</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">safeImport</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>path<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">module</span> <span class="token keyword">as</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">interface</span> <span class="token class-name">ChartModule</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> chart <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token generic-function"><span class="token function">safeImport</span><span class="token generic class-name"><span class="token operator">&lt;</span>ChartModule<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">"./chart"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
chart<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>构建工具集成</strong></p>
<ol>
<li>Webpack 配置：</li>
</ol>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> TsconfigPathsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tsconfig-paths-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">TsconfigPathsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.ts'</span><span class="token punctuation">,</span> <span class="token string">'.tsx'</span><span class="token punctuation">,</span> <span class="token string">'.js'</span><span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>Vite 配置：</li>
</ol>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// vite.config.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> defineConfig <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vite'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> tsconfigPaths <span class="token keyword">from</span> <span class="token string">'vite-tsconfig-paths'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">tsconfigPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-1-3-声明文件生成配置"><a href="#3-1-3-声明文件生成配置" class="headerlink" title="3.1.3 声明文件生成配置"></a>3.1.3 声明文件生成配置</h3><h3 id="3-1-4-编译器缓存策略"><a href="#3-1-4-编译器缓存策略" class="headerlink" title="3.1.4 编译器缓存策略"></a>3.1.4 编译器缓存策略</h3><h2 id="3-2-声明文件-d-ts"><a href="#3-2-声明文件-d-ts" class="headerlink" title="3.2 声明文件(.d.ts)"></a>3.2 声明文件(.d.ts)</h2><h3 id="3-2-1-第三方库类型扩展技巧"><a href="#3-2-1-第三方库类型扩展技巧" class="headerlink" title="3.2.1 第三方库类型扩展技巧"></a>3.2.1 第三方库类型扩展技巧</h3><p><strong>声明文件扩展基础</strong></p>
<p>核心方法：使用 declare module 语法扩展第三方库类型</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// global.d.ts</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'第三方库名'</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 扩展内容</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>常见扩展场景</strong></p>
<ol>
<li>添加缺失类型：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'untyped-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">const</span> version<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>扩展现有接口：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'react'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name">HTMLAttributes<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 添加自定义属性</span>
    customAttr<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token operator">&lt;</span>div customAttr<span class="token operator">=</span><span class="token string">"value"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// ✅ 类型安全</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>覆盖错误类型：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'flawed-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 修正错误返回类型</span>
  <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Data<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// 原声明为 any</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>模块合并策略</strong></p>
<ol>
<li>接口合并：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 原始声明</span>
<span class="token keyword">interface</span> <span class="token class-name">Config</span> <span class="token punctuation">&#123;</span>
  timeout<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 扩展声明</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'configurable-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name">Config</span> <span class="token punctuation">&#123;</span>
    retries<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 添加可选属性</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>函数重载扩展：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 原始函数</span>
<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>

<span class="token comment">// 扩展重载</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'logger-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span>data<span class="token operator">:</span> object<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span> <span class="token comment">// 添加对象支持</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>命名空间合并：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 原始命名空间</span>
<span class="token keyword">declare</span> <span class="token keyword">namespace</span> Analytics <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token function">track</span><span class="token punctuation">(</span>event<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 扩展命名空间</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'analytics-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">namespace</span> Analytics <span class="token punctuation">&#123;</span>
    <span class="token keyword">function</span> <span class="token function">identify</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span> <span class="token comment">// 添加新方法</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>类型扩展最佳实践</strong></p>
<ol>
<li>模块化扩展文件：</li>
</ol>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">src/
  types/
    extensions/
      react.d.ts      # React扩展
      lodash.d.ts     # Lodash扩展
      global.d.ts     # 全局扩展
  tsconfig.json<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>条件扩展模式：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 根据环境变量扩展</span>
<span class="token keyword">type</span> <span class="token class-name">Env</span> <span class="token operator">=</span> <span class="token string">'development'</span> <span class="token operator">|</span> <span class="token string">'production'</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'configurable-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name">Config</span> <span class="token punctuation">&#123;</span>
    debug<span class="token operator">?</span><span class="token operator">:</span> Env <span class="token keyword">extends</span> <span class="token string">'development'</span> <span class="token operator">?</span> <span class="token builtin">boolean</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>类型安全增强：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 添加严格类型约束</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'flexible-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token function">parse</span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">parse</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span> <span class="token comment">// 泛型版本</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>高级扩展技巧</strong></p>
<ol>
<li>模板字面量类型扩展：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'router-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">type</span> <span class="token class-name">DynamicRoute<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token builtin">string</span><span class="token operator">></span></span> <span class="token operator">=</span> 
    <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>string<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Param<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>string<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">?</span> Param <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
  
  <span class="token keyword">interface</span> <span class="token class-name">Router</span> <span class="token punctuation">&#123;</span>
    <span class="token function">get</span><span class="token punctuation">(</span>route<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    params<span class="token operator">:</span> Record<span class="token operator">&lt;</span>DynamicRoute<span class="token operator">&lt;</span><span class="token keyword">keyof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routes<span class="token operator">></span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>泛型约束增强：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'storage-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name">Storage<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">>></span></span> <span class="token punctuation">&#123;</span>
    <span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token generic-function"><span class="token function">set</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>类型谓词扩展：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'validator-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name">Validators</span> <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">isEmail</span><span class="token operator">:</span> <span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span> <span class="token operator">=></span> input <span class="token keyword">is</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>常见问题解决方案</strong></p>
<p>问题1：模块扩展冲突</p>
<p>解决方案：使用唯一标识符</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 原始库</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'ui-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name">ButtonProps</span> <span class="token punctuation">&#123;</span>
    variant<span class="token operator">:</span> <span class="token string">'primary'</span> <span class="token operator">|</span> <span class="token string">'secondary'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 扩展（避免直接修改）</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'ui-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name">ButtonProps</span> <span class="token punctuation">&#123;</span>
    __extendedVariant<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">'tertiary'</span><span class="token punctuation">;</span> <span class="token comment">// 使用特殊前缀</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>问题2：全局污染</p>
<p>解决方案：封装扩展</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 安全扩展方案</span>
<span class="token keyword">type</span> <span class="token class-name">ExtendedLib</span> <span class="token operator">=</span> <span class="token keyword">typeof</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'base-lib'</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">newMethod</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> lib <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'base-lib'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> ExtendedLib<span class="token punctuation">;</span>
lib<span class="token punctuation">.</span><span class="token function">newMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 安全访问</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>问题3：类型覆盖丢失</p>
<p>解决方案：版本化扩展</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 根据库版本动态扩展</span>
<span class="token keyword">type</span> <span class="token class-name">LibVersion</span> <span class="token operator">=</span> <span class="token string">'1.x'</span> <span class="token operator">|</span> <span class="token string">'2.x'</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> global <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> __libVersion<span class="token operator">:</span> LibVersion<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'versioned-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name">Config</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">[</span>__libVersion <span class="token keyword">extends</span> <span class="token string">'2.x'</span> <span class="token operator">?</span> <span class="token string">'newFeature'</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>React 生态扩展</strong></p>
<ol>
<li>组件属性扩展：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'react-table'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ColumnInstance<span class="token operator">&lt;</span><span class="token constant">D</span> <span class="token keyword">extends</span> object <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
    align<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">'left'</span> <span class="token operator">|</span> <span class="token string">'center'</span> <span class="token operator">|</span> <span class="token string">'right'</span><span class="token punctuation">;</span> <span class="token comment">// 添加对齐属性</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>Hooks 返回值扩展：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'react-query'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name">QueryResult<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
    customMeta<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> timestamp<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// 添加元数据</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>Context 类型增强：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ThemeContext <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'theme-provider'</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'theme-provider'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name">Theme</span> <span class="token punctuation">&#123;</span>
    customColor<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 扩展主题对象</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ThemeContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
theme<span class="token punctuation">.</span>customColor<span class="token punctuation">;</span> <span class="token comment">// ✅ 类型安全</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>扩展测试策略</strong></p>
<ol>
<li>类型测试：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 验证扩展是否生效</span>
<span class="token keyword">type</span> <span class="token class-name">Test</span> <span class="token operator">=</span> Expect<span class="token operator">&lt;</span>
  <span class="token comment">// 检查扩展属性是否存在</span>
  <span class="token string">'customAttr'</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> React<span class="token punctuation">.</span>HTMLAttributes<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>运行时验证：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 确保扩展与运行时兼容</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'newMethod'</span> <span class="token keyword">in</span> lib<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  lib<span class="token punctuation">.</span><span class="token function">newMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Library extension not available'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程化建议</strong></p>
<ol>
<li>扩展文档化：</li>
</ol>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> UI 库扩展说明</span>

<span class="token title important"><span class="token punctuation">###</span> 新增属性</span>
<span class="token table"><span class="token table-header-row"><span class="token punctuation">|</span><span class="token table-header important"> 属性名        </span><span class="token punctuation">|</span><span class="token table-header important"> 类型   </span><span class="token punctuation">|</span><span class="token table-header important"> 说明               </span><span class="token punctuation">|</span>
</span><span class="token table-line"><span class="token punctuation">|</span><span class="token punctuation">---------------</span><span class="token punctuation">|</span><span class="token punctuation">--------</span><span class="token punctuation">|</span><span class="token punctuation">--------------------</span><span class="token punctuation">|</span>
</span><span class="token table-data-rows"><span class="token punctuation">|</span><span class="token table-data"> customAttr    </span><span class="token punctuation">|</span><span class="token table-data"> string </span><span class="token punctuation">|</span><span class="token table-data"> 自定义HTML属性     </span><span class="token punctuation">|</span>
<span class="token punctuation">|</span><span class="token table-data"> __extendedVariant </span><span class="token punctuation">|</span><span class="token table-data"> 'tertiary' </span><span class="token punctuation">|</span><span class="token table-data"> 特殊按钮类型    </span><span class="token punctuation">|</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>版本管理策略：</li>
</ol>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token comment">// package.json</span>
<span class="token punctuation">&#123;</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"@types/custom-lib-extension"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"peerDependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"target-lib"</span><span class="token operator">:</span> <span class="token string">"^2.0.0"</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>扩展发布流程：</li>
</ol>
<pre><code class="mermaid">graph LR
    A[创建扩展声明] --&gt; B[本地测试验证]
    B --&gt; C[发布到内部npm]
    C --&gt; D[项目安装使用]</code></pre>

<p><strong>扩展安全指南</strong></p>
<ol>
<li>避免全局污染：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 错误：全局扩展基础类型</span>
<span class="token keyword">interface</span> <span class="token class-name"><span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token function">customMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 正确：模块化扩展</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'array-extension'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name"><span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token function">safeCustomMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>防御性类型检查：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 安全扩展函数</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'utils-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token function">parse</span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">parse</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">string</span></span> <span class="token operator">?</span> Data <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>兼容性处理：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 处理不同版本的库</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'multi-version-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name">CoreAPI</span> <span class="token punctuation">&#123;</span>
    <span class="token function">commonMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token constant">V1API</span></span> <span class="token keyword">extends</span> <span class="token class-name">CoreAPI</span> <span class="token punctuation">&#123;</span>
    <span class="token function">v1Method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name"><span class="token constant">V2API</span></span> <span class="token keyword">extends</span> <span class="token class-name">CoreAPI</span> <span class="token punctuation">&#123;</span>
    <span class="token function">v2Method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">const</span> api<span class="token operator">:</span> <span class="token constant">V1API</span> <span class="token operator">|</span> <span class="token constant">V2API</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> api<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>扩展参考表</strong></p>
<table>
<thead>
<tr>
<th align="left">扩展类型</th>
<th align="left">适用场景</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">接口属性扩展</td>
<td align="left">添加新属性&#x2F;方法</td>
<td align="left"><code>interface &#123; newProp: type &#125;</code></td>
</tr>
<tr>
<td align="left">函数重载扩展</td>
<td align="left">支持新参数类型</td>
<td align="left"><code>function log(data: object)</code></td>
</tr>
<tr>
<td align="left">泛型约束增强</td>
<td align="left">增加类型参数约束</td>
<td align="left"><code>Storage&lt;T extends object&gt;</code></td>
</tr>
<tr>
<td align="left">条件类型扩展</td>
<td align="left">根据环境动态扩展</td>
<td align="left"><code>debug?: Env extends &#39;dev&#39;</code></td>
</tr>
<tr>
<td align="left">模板字面量扩展</td>
<td align="left">路由参数&#x2F;国际化键名</td>
<td align="left"><code>DynamicRoute&lt;path&gt;</code></td>
</tr>
<tr>
<td align="left">类型谓词扩展</td>
<td align="left">自定义类型守卫</td>
<td align="left"><code>isEmail(input): input is string</code></td>
</tr>
</tbody></table>
<h3 id="3-2-2-模块声明合并策略"><a href="#3-2-2-模块声明合并策略" class="headerlink" title="3.2.2 模块声明合并策略"></a>3.2.2 模块声明合并策略</h3><p><strong>声明合并基础概念</strong></p>
<p>核心机制：TypeScript 允许将多个同名的声明合并为单一类型定义</p>
<p>合并类型：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 合并结果</span>
<span class="token keyword">const</span> user<span class="token operator">:</span> User <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">30</span>  <span class="token comment">// ✅ 合并属性</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>模块声明合并策略</strong></p>
<ol>
<li>接口合并：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// module.d.ts</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'my-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name">Config</span> <span class="token punctuation">&#123;</span>
    timeout<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// user-extension.d.ts</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'my-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name">Config</span> <span class="token punctuation">&#123;</span>
    retries<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 添加新属性</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 合并结果</span>
<span class="token keyword">const</span> config<span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'my-lib'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Config <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  timeout<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  retries<span class="token operator">:</span> <span class="token number">3</span>  <span class="token comment">// ✅</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>函数合并：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 原始声明</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'utils'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token function">parse</span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 扩展声明</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'utils'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">parse</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span> <span class="token comment">// 泛型版本</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token generic-function"><span class="token function">parse</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'&#123;"id":"123"&#125;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 类型安全</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>命名空间合并：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 原始命名空间</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'analytics'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">namespace</span> Tracking <span class="token punctuation">&#123;</span>
    <span class="token keyword">function</span> <span class="token function">pageview</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 扩展命名空间</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'analytics'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">namespace</span> Tracking <span class="token punctuation">&#123;</span>
    <span class="token keyword">function</span> <span class="token function">event</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">:</span> object<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
Tracking<span class="token punctuation">.</span><span class="token function">event</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> button<span class="token operator">:</span> <span class="token string">"submit"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>合并优先级规则</strong></p>
<table>
<thead>
<tr>
<th align="left">声明类型</th>
<th align="left">合并优先级</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">接口属性</td>
<td align="left">顺序无关，同名属性必须兼容</td>
<td align="left"><code>interface A &#123; x: number &#125;</code><br><code>interface A &#123; x: string &#125;</code> → 错误</td>
</tr>
<tr>
<td align="left">函数重载</td>
<td align="left">后声明优先</td>
<td align="left">最后声明的签名最先匹配</td>
</tr>
<tr>
<td align="left">命名空间</td>
<td align="left">按声明顺序合并</td>
<td align="left">后声明的成员覆盖先前的</td>
</tr>
<tr>
<td align="left">类与接口</td>
<td align="left">接口声明优先</td>
<td align="left">类实现必须满足所有接口声明</td>
</tr>
</tbody></table>
<p><strong>模块合并最佳实践</strong></p>
<ol>
<li>分层声明结构：</li>
</ol>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">types/
  ├── lib/
  │   ├── base.d.ts      // 基础声明
  │   └── extensions/    // 扩展声明
  │       ├── v1.d.ts
  │       └── v2.d.ts
  └── global.d.ts        // 全局合并<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>版本化合并策略：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 条件合并</span>
<span class="token keyword">type</span> <span class="token class-name">LibVersion</span> <span class="token operator">=</span> <span class="token string">'v1'</span> <span class="token operator">|</span> <span class="token string">'v2'</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'versioned-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Api</span> <span class="token punctuation">&#123;</span>
    <span class="token function">commonMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'versioned-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Api</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">[</span>LibVersion <span class="token keyword">extends</span> <span class="token string">'v2'</span> <span class="token operator">?</span> <span class="token string">'newMethod'</span> <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li>安全覆盖模式：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'sensitive-lib'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name">__OriginalConfig</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 保留原始定义</span>
    originalProp<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">interface</span> <span class="token class-name">Config</span> <span class="token keyword">extends</span> <span class="token class-name">__OriginalConfig</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 安全扩展</span>
    customProp<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>React 组件合并案例</strong></p>
<ol>
<li>组件属性合并：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 原始组件声明</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'react-ui'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ButtonProps</span> <span class="token punctuation">&#123;</span>
    variant<span class="token operator">:</span> <span class="token string">'primary'</span> <span class="token operator">|</span> <span class="token string">'secondary'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">Button</span><span class="token punctuation">(</span>props<span class="token operator">:</span> ButtonProps<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">JSX</span><span class="token punctuation">.</span>Element<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 扩展属性</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'react-ui'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ButtonProps</span> <span class="token punctuation">&#123;</span>
    size<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">'sm'</span> <span class="token operator">|</span> <span class="token string">'md'</span> <span class="token operator">|</span> <span class="token string">'lg'</span><span class="token punctuation">;</span> <span class="token comment">// 添加新属性</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>
<span class="token operator">&lt;</span>Button variant<span class="token operator">=</span><span class="token string">"primary"</span> size<span class="token operator">=</span><span class="token string">"md"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// ✅</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>Hooks 返回值合并：</li>
</ol>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 原始Hook</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'react-hooks'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token function">useData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> loading<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span> data<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 扩展返回值</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'react-hooks'</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useData</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> loading<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span> data<span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span> error<span class="token operator">?</span><span class="token operator">:</span> Error <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>合并冲突解决方案</strong></p>
<p>冲突类型 1：属性类型不兼容</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 声明1</span>
<span class="token keyword">interface</span> <span class="token class-name">Config</span> <span class="token punctuation">&#123;</span>
  logLevel<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 声明2</span>
<span class="token keyword">interface</span> <span class="token class-name">Config</span> <span class="token punctuation">&#123;</span>
  logLevel<span class="token operator">:</span> <span class="token string">'debug'</span> <span class="token operator">|</span> <span class="token string">'info'</span><span class="token punctuation">;</span> <span class="token comment">// 🚫 类型冲突</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 方法1：使用联合类型</span>
<span class="token keyword">interface</span> <span class="token class-name">Config</span> <span class="token punctuation">&#123;</span>
  logLevel<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token string">'debug'</span> <span class="token operator">|</span> <span class="token string">'info'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 方法2：版本化声明</span>
<span class="token keyword">declare</span> <span class="token keyword">const</span> __configVersion<span class="token operator">:</span> <span class="token string">'v1'</span> <span class="token operator">|</span> <span class="token string">'v2'</span><span class="token punctuation">;</span>
<span class="token keyword">interface</span> <span class="token class-name">Config</span> <span class="token punctuation">&#123;</span>
  logLevel<span class="token operator">:</span> __configVersion <span class="token keyword">extends</span> <span class="token string">'v2'</span> <span class="token operator">?</span> <span class="token string">'debug'</span> <span class="token operator">|</span> <span class="token string">'info'</span> <span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>冲突类型 2：函数重载歧义</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">parse</span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">parse</span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> object<span class="token punctuation">;</span> <span class="token comment">// 🚫 相同参数类型</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>解决方案：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 明确重载顺序</span>
<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">parse</span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">parse</span><span class="token punctuation">(</span>input<span class="token operator">:</span> object<span class="token punctuation">)</span><span class="token operator">:</span> object<span class="token punctuation">;</span> <span class="token comment">// ✅ 不同参数类型</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>声明合并参考表</strong></p>
<table>
<thead>
<tr>
<th align="left">合并场景</th>
<th align="left">推荐策略</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">接口属性扩展</td>
<td align="left">直接添加新属性</td>
<td align="left"><code>interface &#123; newProp: type &#125;</code></td>
</tr>
<tr>
<td align="left">函数重载扩展</td>
<td align="left">添加不同参数类型的重载</td>
<td align="left"><code>function parse(data: object)</code></td>
</tr>
<tr>
<td align="left">泛型约束增强</td>
<td align="left">使用条件类型继承</td>
<td align="left"><code>Store&lt;T extends object&gt;</code></td>
</tr>
<tr>
<td align="left">跨模块类型合并</td>
<td align="left">使用类型查询和组合</td>
<td align="left"><code>type Full = LibA.Type &amp; LibB.Type</code></td>
</tr>
<tr>
<td align="left">版本差异化合并</td>
<td align="left">条件类型 + 环境变量</td>
<td align="left"><code>__version extends &#39;v2&#39; ? ...</code></td>
</tr>
<tr>
<td align="left">第三方库补丁</td>
<td align="left">模块声明合并 + 防御性检查</td>
<td align="left"><code>declare module &#39;lib&#39; &#123; ... &#125;</code></td>
</tr>
</tbody></table>
<h3 id="3-2-3-全局变量类型定义"><a href="#3-2-3-全局变量类型定义" class="headerlink" title="3.2.3 全局变量类型定义"></a>3.2.3 全局变量类型定义</h3><p><strong>核心概念</strong></p>
<p>全局变量：在模块系统外可直接访问的变量（如 window 对象属性、CDN 引入的库）</p>
<p>定义目标：</p>
<ul>
<li>为非模块化脚本提供类型支持</li>
<li>扩展全局命名空间（如 window、global）</li>
<li>避免 Cannot find name ‘xxx’ 类型错误</li>
</ul>
<p><strong>代码示例</strong></p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// ⭐ 场景1：声明全局变量 (声明文件.d.ts)</span>
<span class="token keyword">declare</span> <span class="token keyword">const</span> <span class="token constant">VERSION</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>  <span class="token comment">// 编译时注入的版本号</span>
<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">trackEvent</span><span class="token punctuation">(</span>eventName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> payload<span class="token operator">:</span> object<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>  <span class="token comment">// 全局埋点函数</span>

<span class="token comment">// ⭐ 场景2：扩展全局对象 (如 Window 接口)</span>
<span class="token keyword">interface</span> <span class="token class-name">Window</span> <span class="token punctuation">&#123;</span>
  _env<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token constant">API_HOST</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token constant">DEBUG_MODE</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token function-variable function">ga</span><span class="token operator">:</span> <span class="token punctuation">(</span>command<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>  <span class="token comment">// Google Analytics</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// ⭐ 场景3：模块化环境中的全局声明 (使用 declare global)</span>
<span class="token keyword">export</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token comment">// 确保文件是模块环境</span>

<span class="token keyword">declare</span> global <span class="token punctuation">&#123;</span>
  <span class="token keyword">interface</span> <span class="token class-name"><span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token function">findLast</span><span class="token punctuation">(</span><span class="token function-variable function">predicate</span><span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>  <span class="token comment">// 扩展原生Array</span>
  <span class="token punctuation">&#125;</span>
  
  <span class="token keyword">namespace</span> NodeJS <span class="token punctuation">&#123;</span>
    <span class="token keyword">interface</span> <span class="token class-name">ProcessEnv</span> <span class="token punctuation">&#123;</span>
      <span class="token constant">NODE_ENV</span><span class="token operator">:</span> <span class="token string">'development'</span> <span class="token operator">|</span> <span class="token string">'production'</span><span class="token punctuation">;</span>
      <span class="token constant">SSR_ENABLED</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程实践与陷阱</strong></p>
<table>
<thead>
<tr>
<th align="left">场景</th>
<th align="left">解决方案</th>
<th align="left">注意事项</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CDN 引入的库</td>
<td align="left"><code>declare const jQuery: any;</code></td>
<td align="left">优先安装 @types 包</td>
</tr>
<tr>
<td align="left">注入的运行时变量</td>
<td align="left"><code>declare const __INITIAL_STATE__: AppState;</code></td>
<td align="left">需与构建脚本配合注入</td>
</tr>
<tr>
<td align="left">扩展浏览器原生对象</td>
<td align="left">通过 interface 合并声明</td>
<td align="left">避免覆盖标准类型定义</td>
</tr>
<tr>
<td align="left">多环境全局变量</td>
<td align="left">使用 .d.ts + 条件类型</td>
<td align="left">区分 process.env 和 import.meta.env</td>
</tr>
</tbody></table>
<p>典型错误案例：</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// ❌ 错误：直接覆盖Window类型</span>
<span class="token keyword">type</span> <span class="token class-name">Window</span> <span class="token operator">=</span> CustomWindow<span class="token punctuation">;</span>  

<span class="token comment">// ✅ 正确：通过接口合并</span>
<span class="token keyword">interface</span> <span class="token class-name">Window</span> <span class="token punctuation">&#123;</span>
  customProp<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>面试级考点</strong></p>
<ul>
<li>类型合并机制：接口声明合并 vs 命名空间合并</li>
<li>模块化影响：<ul>
<li>全局声明必须放在 .d.ts 文件或使用 declare global</li>
<li>包含 import&#x2F;export 的文件会被视为模块</li>
</ul>
</li>
<li>类型可见性规则：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// types.d.ts</span>
<span class="token keyword">declare</span> <span class="token keyword">interface</span> <span class="token class-name">GlobalType</span> <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span>  <span class="token comment">// 全局可见</span>

<span class="token comment">// utils.ts</span>
<span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">interface</span> <span class="token class-name">LocalType</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token comment">// 仅模块内可见</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>与 window as any 的取舍：优先声明具体类型保证安全</li>
</ul>
<h3 id="3-2-4-复杂类型声明最佳实践"><a href="#3-2-4-复杂类型声明最佳实践" class="headerlink" title="3.2.4 复杂类型声明最佳实践"></a>3.2.4 复杂类型声明最佳实践</h3><p><strong>核心设计原则</strong></p>
<table>
<thead>
<tr>
<th align="left">原则</th>
<th align="left">说明</th>
<th align="left">反模式案例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">精确性</td>
<td align="left">类型应严格匹配运行时行为</td>
<td align="left">用 any 代替具体结构</td>
</tr>
<tr>
<td align="left">可读性</td>
<td align="left">通过类型别名分层抽象</td>
<td align="left">嵌套超过三层的匿名类型</td>
</tr>
<tr>
<td align="left">兼容性</td>
<td align="left">考虑旧版 TypeScript 的解析能力</td>
<td align="left">使用 TS 4.1+ 特性但未降级</td>
</tr>
<tr>
<td align="left">可扩展性</td>
<td align="left">预留扩展点（如索引签名）</td>
<td align="left">完全封闭的类型定义</td>
</tr>
</tbody></table>
<p><strong>复杂类型声明模式</strong></p>
<p>场景1：深度嵌套结构（如 API 响应）</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 使用接口分层 + 类型别名组合</span>
<span class="token keyword">interface</span> <span class="token class-name">UserProfile</span> <span class="token punctuation">&#123;</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  contacts<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    social<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 可选嵌套</span>
      wechat<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
      alipay<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 提取公共结构</span>
<span class="token keyword">type</span> <span class="token class-name">Pagination<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  current_page<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  data<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">fetchUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Pagination<span class="token operator">&lt;</span>UserProfile<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>场景2：动态键名对象（如国际化字典）</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 模板字面量类型 + 索引签名</span>
<span class="token keyword">type</span> <span class="token class-name">Locale</span> <span class="token operator">=</span> <span class="token string">'zh-CN'</span> <span class="token operator">|</span> <span class="token string">'en-US'</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">I18nKeys</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">button.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token string">'submit'</span> <span class="token operator">|</span> <span class="token string">'cancel'</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">|</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">title.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token string">'home'</span> <span class="token operator">|</span> <span class="token string">'about'</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">const</span> i18n<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span>key <span class="token keyword">in</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>Locale<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>I18nKeys<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 如 "zh-CN/button.submit"</span>
<span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span>
  <span class="token function">get</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>Locale<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>I18nKeys<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> vars<span class="token operator">?</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>场景3：函数重载类型（如 SDK 方法）</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 使用联合类型 + 条件类型</span>
<span class="token keyword">type</span> <span class="token class-name">SDKOptions</span> <span class="token operator">=</span> 
  <span class="token operator">|</span> <span class="token punctuation">&#123;</span> mode<span class="token operator">:</span> <span class="token string">'sync'</span><span class="token punctuation">;</span> timeout<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span>
  <span class="token operator">|</span> <span class="token punctuation">&#123;</span> mode<span class="token operator">:</span> <span class="token string">'async'</span><span class="token punctuation">;</span> <span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span>res<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">invokeAPI</span><span class="token punctuation">(</span>
  endpoint<span class="token operator">:</span> <span class="token string">'/user'</span><span class="token punctuation">,</span>
  options<span class="token operator">?</span><span class="token operator">:</span> SDKOptions
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>User<span class="token operator">></span> <span class="token operator">|</span> User<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>进阶技巧与陷阱规避</strong></p>
<p>技巧1：类型递归深度控制</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// ✅ 安全递归：限制深度</span>
<span class="token keyword">type</span> <span class="token class-name">MaxDepth<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">D</span> <span class="token keyword">extends</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token operator">></span></span> <span class="token operator">=</span> 
  <span class="token constant">D</span> <span class="token keyword">extends</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token operator">:</span> 
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">object</span> <span class="token operator">?</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> MaxDepth<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Subtract<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">>></span>
  <span class="token punctuation">&#125;</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>

<span class="token comment">// ❌ 危险：无限递归</span>
<span class="token keyword">type</span> <span class="token class-name">InfiniteRecursion<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  children<span class="token operator">:</span> InfiniteRecursion<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 可能引发类型实例化过深错误</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>技巧2：防御性类型设计</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 防范不完整数据</span>
<span class="token keyword">type</span> <span class="token class-name">SafeAccess<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">object</span> <span class="token operator">?</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">?</span><span class="token operator">:</span> SafeAccess<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// 移除可选修饰符</span>
<span class="token punctuation">&#125;</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>

<span class="token comment">// 使用 never 阻断非法路径</span>
<span class="token keyword">type</span> <span class="token class-name">ValidateRoute<span class="token operator">&lt;</span>Path<span class="token operator">></span></span> <span class="token operator">=</span> 
  Path <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/user/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">infer</span> Id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span> 
    <span class="token operator">?</span> Id <span class="token keyword">extends</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>number<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span> 
      <span class="token operator">?</span> Path 
      <span class="token operator">:</span> <span class="token builtin">never</span> 
    <span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>工程化实践</strong></p>
<p>策略1：类型测试（使用 tsd 等工具）</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 测试类型是否符合预期</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> expectType <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'tsd'</span><span class="token punctuation">;</span>

<span class="token generic-function"><span class="token function">expectType</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token function">fetchUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>策略2：声明文件组织规范</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">types/
├── global.d.ts         # 全局声明
├── libs/               # 第三方库扩展
│   └── vue-extend.d.ts
├── modules/            # 业务模块
│   └── user-api.d.ts
└── utils/              # 工具类型
    └── pagination.d.ts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>策略3：版本兼容处理</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 条件编译支持多版本</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">"some-lib"</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Config</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// @ts-ignore-next-line 兼容旧版本类型缺失</span>
    newFeature<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span> 
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>面试级考点</strong></p>
<ul>
<li>类型实例化深度限制：默认 50 层（通过 tsc –typeDepth 调整）</li>
<li>声明合并优先级：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name"><span class="token constant">A</span></span> <span class="token punctuation">&#123;</span> x<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span>
<span class="token keyword">interface</span> <span class="token class-name"><span class="token constant">A</span></span> <span class="token punctuation">&#123;</span> x<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span>  <span class="token comment">// ❌ 后续声明必须兼容前序声明</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>类型性能优化：</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// ✅ 高效：使用映射类型</span>
<span class="token keyword">type</span> <span class="token class-name">ReadonlyDeep<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> ReadonlyDeep<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">&#125;</span>

<span class="token comment">// ❌ 低效：递归条件类型</span>
<span class="token keyword">type</span> <span class="token class-name">SlowType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">object</span> <span class="token operator">?</span> SlowType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token operator">:</span> <span class="token constant">T</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>d.ts 与 ts 文件差异：.d.ts 不包含实现，仅类型声明</li>
<li>实战案例：为 WebSocket 消息协议声明类型安全解析器</li>
</ul>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">MessageProtocol</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  login<span class="token operator">:</span> <span class="token punctuation">&#123;</span> username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> password<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  joinRoom<span class="token operator">:</span> <span class="token punctuation">&#123;</span> roomId<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> timestamp<span class="token operator">:</span> Date <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token comment">// 使用模板类型自动生成事件名约束</span>
  <span class="token punctuation">[</span><span class="token constant">E</span> <span class="token keyword">in</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">sys/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token string">'alert'</span> <span class="token operator">|</span> <span class="token string">'error'</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> code<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">handleMessage</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> MessageProtocol<span class="token operator">></span></span></span><span class="token punctuation">(</span>
  type<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">,</span>
  <span class="token function-variable function">handler</span><span class="token operator">:</span> <span class="token punctuation">(</span>payload<span class="token operator">:</span> MessageProtocol<span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="3-3-代码质量保障"><a href="#3-3-代码质量保障" class="headerlink" title="3.3 代码质量保障"></a>3.3 代码质量保障</h2><h3 id="3-3-1-ESLint-类型规则配置"><a href="#3-3-1-ESLint-类型规则配置" class="headerlink" title="3.3.1 ESLint 类型规则配置"></a>3.3.1 ESLint 类型规则配置</h3><h3 id="3-3-2-单元测试类型检查方案"><a href="#3-3-2-单元测试类型检查方案" class="headerlink" title="3.3.2 单元测试类型检查方案"></a>3.3.2 单元测试类型检查方案</h3><h3 id="3-3-3-自定义类型规则开发"><a href="#3-3-3-自定义类型规则开发" class="headerlink" title="3.3.3 自定义类型规则开发"></a>3.3.3 自定义类型规则开发</h3><h3 id="3-3-4-CI-CD-中的类型检查"><a href="#3-3-4-CI-CD-中的类型检查" class="headerlink" title="3.3.4 CI&#x2F;CD 中的类型检查"></a>3.3.4 CI&#x2F;CD 中的类型检查</h3><h2 id="3-4-构建优化"><a href="#3-4-构建优化" class="headerlink" title="3.4 构建优化"></a>3.4 构建优化</h2><h3 id="3-4-1-Webpack-构建缓存配置"><a href="#3-4-1-Webpack-构建缓存配置" class="headerlink" title="3.4.1 Webpack 构建缓存配置"></a>3.4.1 Webpack 构建缓存配置</h3><h3 id="3-4-2-Babel-与-tsc-编译对比"><a href="#3-4-2-Babel-与-tsc-编译对比" class="headerlink" title="3.4.2 Babel 与 tsc 编译对比"></a>3.4.2 Babel 与 tsc 编译对比</h3><h3 id="3-4-3-增量编译原理与实践"><a href="#3-4-3-增量编译原理与实践" class="headerlink" title="3.4.3 增量编译原理与实践"></a>3.4.3 增量编译原理与实践</h3><h3 id="3-4-4-Monorepo-类型管理策略"><a href="#3-4-4-Monorepo-类型管理策略" class="headerlink" title="3.4.4 Monorepo 类型管理策略"></a>3.4.4 Monorepo 类型管理策略</h3><h1 id="四、框架集成实践"><a href="#四、框架集成实践" class="headerlink" title="四、框架集成实践"></a>四、框架集成实践</h1><h2 id="4-1-React-生态集成"><a href="#4-1-React-生态集成" class="headerlink" title="4.1 React 生态集成"></a>4.1 React 生态集成</h2><h3 id="4-1-1-组件-Props-高级类型设计"><a href="#4-1-1-组件-Props-高级类型设计" class="headerlink" title="4.1.1 组件 Props 高级类型设计"></a>4.1.1 组件 Props 高级类型设计</h3><h3 id="4-1-2-Hooks-泛型类型定义"><a href="#4-1-2-Hooks-泛型类型定义" class="headerlink" title="4.1.2 Hooks 泛型类型定义"></a>4.1.2 Hooks 泛型类型定义</h3><h3 id="4-1-3-Redux-Toolkit-类型安全"><a href="#4-1-3-Redux-Toolkit-类型安全" class="headerlink" title="4.1.3 Redux Toolkit 类型安全"></a>4.1.3 Redux Toolkit 类型安全</h3><h3 id="4-1-4-React-Router-类型守卫"><a href="#4-1-4-React-Router-类型守卫" class="headerlink" title="4.1.4 React Router 类型守卫"></a>4.1.4 React Router 类型守卫</h3><h2 id="4-2-Vue-3-类型系统"><a href="#4-2-Vue-3-类型系统" class="headerlink" title="4.2 Vue 3 类型系统"></a>4.2 Vue 3 类型系统</h2><h3 id="4-2-1-Composition-API-类型推导"><a href="#4-2-1-Composition-API-类型推导" class="headerlink" title="4.2.1 Composition API 类型推导"></a>4.2.1 Composition API 类型推导</h3><h3 id="4-2-2-组件泛型-Props-实现"><a href="#4-2-2-组件泛型-Props-实现" class="headerlink" title="4.2.2 组件泛型 Props 实现"></a>4.2.2 组件泛型 Props 实现</h3><h3 id="4-2-3-Pinia-状态管理类型安全"><a href="#4-2-3-Pinia-状态管理类型安全" class="headerlink" title="4.2.3 Pinia 状态管理类型安全"></a>4.2.3 Pinia 状态管理类型安全</h3><h3 id="4-2-4-Volar-类型增强实践"><a href="#4-2-4-Volar-类型增强实践" class="headerlink" title="4.2.4 Volar 类型增强实践"></a>4.2.4 Volar 类型增强实践</h3><h2 id="4-3-Node-js-后端开发"><a href="#4-3-Node-js-后端开发" class="headerlink" title="4.3 Node.js 后端开发"></a>4.3 Node.js 后端开发</h2><h3 id="4-3-1-Express-Koa-中间件类型"><a href="#4-3-1-Express-Koa-中间件类型" class="headerlink" title="4.3.1 Express&#x2F;Koa 中间件类型"></a>4.3.1 Express&#x2F;Koa 中间件类型</h3><h3 id="4-3-2-ORM-框架类型安全查询"><a href="#4-3-2-ORM-框架类型安全查询" class="headerlink" title="4.3.2 ORM 框架类型安全查询"></a>4.3.2 ORM 框架类型安全查询</h3><h3 id="4-3-3-RPC-通信类型契约"><a href="#4-3-3-RPC-通信类型契约" class="headerlink" title="4.3.3 RPC 通信类型契约"></a>4.3.3 RPC 通信类型契约</h3><h3 id="4-3-4-分布式事务类型保障"><a href="#4-3-4-分布式事务类型保障" class="headerlink" title="4.3.4 分布式事务类型保障"></a>4.3.4 分布式事务类型保障</h3><h1 id="五、性能优化"><a href="#五、性能优化" class="headerlink" title="五、性能优化"></a>五、性能优化</h1><h2 id="5-1-编译性能优化"><a href="#5-1-编译性能优化" class="headerlink" title="5.1 编译性能优化"></a>5.1 编译性能优化</h2><h3 id="5-1-1-项目引用-Project-References"><a href="#5-1-1-项目引用-Project-References" class="headerlink" title="5.1.1 项目引用(Project References)"></a>5.1.1 项目引用(Project References)</h3><h3 id="5-1-2-增量编译原理剖析"><a href="#5-1-2-增量编译原理剖析" class="headerlink" title="5.1.2 增量编译原理剖析"></a>5.1.2 增量编译原理剖析</h3><h3 id="5-1-3-分布式编译方案"><a href="#5-1-3-分布式编译方案" class="headerlink" title="5.1.3 分布式编译方案"></a>5.1.3 分布式编译方案</h3><h3 id="5-1-4-编译器缓存策略"><a href="#5-1-4-编译器缓存策略" class="headerlink" title="5.1.4 编译器缓存策略"></a>5.1.4 编译器缓存策略</h3><h2 id="5-2-类型性能优化"><a href="#5-2-类型性能优化" class="headerlink" title="5.2 类型性能优化"></a>5.2 类型性能优化</h2><h3 id="5-2-1-避免过度类型实例化"><a href="#5-2-1-避免过度类型实例化" class="headerlink" title="5.2.1 避免过度类型实例化"></a>5.2.1 避免过度类型实例化</h3><h3 id="5-2-2-条件类型短路技巧"><a href="#5-2-2-条件类型短路技巧" class="headerlink" title="5.2.2 条件类型短路技巧"></a>5.2.2 条件类型短路技巧</h3><h3 id="5-2-3-类型缓存策略实现"><a href="#5-2-3-类型缓存策略实现" class="headerlink" title="5.2.3 类型缓存策略实现"></a>5.2.3 类型缓存策略实现</h3><h3 id="5-2-4-类型复杂度分析"><a href="#5-2-4-类型复杂度分析" class="headerlink" title="5.2.4 类型复杂度分析"></a>5.2.4 类型复杂度分析</h3><h2 id="5-3-产物优化"><a href="#5-3-产物优化" class="headerlink" title="5.3 产物优化"></a>5.3 产物优化</h2><h3 id="5-3-1-Tree-Shaking-原理与实现"><a href="#5-3-1-Tree-Shaking-原理与实现" class="headerlink" title="5.3.1 Tree Shaking 原理与实现"></a>5.3.1 Tree Shaking 原理与实现</h3><h3 id="5-3-2-代码分割类型保障"><a href="#5-3-2-代码分割类型保障" class="headerlink" title="5.3.2 代码分割类型保障"></a>5.3.2 代码分割类型保障</h3><h3 id="5-3-3-运行时类型检查方案"><a href="#5-3-3-运行时类型检查方案" class="headerlink" title="5.3.3 运行时类型检查方案"></a>5.3.3 运行时类型检查方案</h3><h3 id="5-3-4-类型擦除与体积控制"><a href="#5-3-4-类型擦除与体积控制" class="headerlink" title="5.3.4 类型擦除与体积控制"></a>5.3.4 类型擦除与体积控制</h3><h1 id="六、综合能力"><a href="#六、综合能力" class="headerlink" title="六、综合能力"></a>六、综合能力</h1><h2 id="6-1-设计模式类型实现"><a href="#6-1-设计模式类型实现" class="headerlink" title="6.1 设计模式类型实现"></a>6.1 设计模式类型实现</h2><h3 id="6-1-1-装饰器元编程类型安全"><a href="#6-1-1-装饰器元编程类型安全" class="headerlink" title="6.1.1 装饰器元编程类型安全"></a>6.1.1 装饰器元编程类型安全</h3><h3 id="6-1-2-依赖注入类型推导"><a href="#6-1-2-依赖注入类型推导" class="headerlink" title="6.1.2 依赖注入类型推导"></a>6.1.2 依赖注入类型推导</h3><h3 id="6-1-3-策略模式类型映射"><a href="#6-1-3-策略模式类型映射" class="headerlink" title="6.1.3 策略模式类型映射"></a>6.1.3 策略模式类型映射</h3><h3 id="6-1-4-状态机类型实现"><a href="#6-1-4-状态机类型实现" class="headerlink" title="6.1.4 状态机类型实现"></a>6.1.4 状态机类型实现</h3><h2 id="6-2-调试与重构"><a href="#6-2-调试与重构" class="headerlink" title="6.2 调试与重构"></a>6.2 调试与重构</h2><h3 id="6-2-1-复杂类型错误追踪技巧"><a href="#6-2-1-复杂类型错误追踪技巧" class="headerlink" title="6.2.1 复杂类型错误追踪技巧"></a>6.2.1 复杂类型错误追踪技巧</h3><h3 id="6-2-2-声明文件调试方法论"><a href="#6-2-2-声明文件调试方法论" class="headerlink" title="6.2.2 声明文件调试方法论"></a>6.2.2 声明文件调试方法论</h3><h3 id="6-2-3-遗留系统渐进式迁移"><a href="#6-2-3-遗留系统渐进式迁移" class="headerlink" title="6.2.3 遗留系统渐进式迁移"></a>6.2.3 遗留系统渐进式迁移</h3><h3 id="6-2-4-类型安全的重构保障"><a href="#6-2-4-类型安全的重构保障" class="headerlink" title="6.2.4 类型安全的重构保障"></a>6.2.4 类型安全的重构保障</h3><h2 id="6-3-前沿架构"><a href="#6-3-前沿架构" class="headerlink" title="6.3 前沿架构"></a>6.3 前沿架构</h2><h3 id="6-3-1-微前端类型通信方案"><a href="#6-3-1-微前端类型通信方案" class="headerlink" title="6.3.1 微前端类型通信方案"></a>6.3.1 微前端类型通信方案</h3><h3 id="6-3-2-Serverless-函数类型安全"><a href="#6-3-2-Serverless-函数类型安全" class="headerlink" title="6.3.2 Serverless 函数类型安全"></a>6.3.2 Serverless 函数类型安全</h3><h3 id="6-3-3-WebAssembly-类型集成"><a href="#6-3-3-WebAssembly-类型集成" class="headerlink" title="6.3.3 WebAssembly 类型集成"></a>6.3.3 WebAssembly 类型集成</h3><h3 id="6-3-4-Web-Workers-类型通信"><a href="#6-3-4-Web-Workers-类型通信" class="headerlink" title="6.3.4 Web Workers 类型通信"></a>6.3.4 Web Workers 类型通信</h3><h2 id="6-4-面试专项"><a href="#6-4-面试专项" class="headerlink" title="6.4 面试专项"></a>6.4 面试专项</h2><h3 id="6-4-1-类型体操解题思路"><a href="#6-4-1-类型体操解题思路" class="headerlink" title="6.4.1 类型体操解题思路"></a>6.4.1 类型体操解题思路</h3><h3 id="6-4-2-编译原理相关问题"><a href="#6-4-2-编译原理相关问题" class="headerlink" title="6.4.2 编译原理相关问题"></a>6.4.2 编译原理相关问题</h3><h3 id="6-4-3-框架集成设计问题"><a href="#6-4-3-框架集成设计问题" class="headerlink" title="6.4.3 框架集成设计问题"></a>6.4.3 框架集成设计问题</h3><h3 id="6-4-4-性能优化指标分析"><a href="#6-4-4-性能优化指标分析" class="headerlink" title="6.4.4 性能优化指标分析"></a>6.4.4 性能优化指标分析</h3>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/TypeScript/" rel="tag"><i class="fa fa-tag"></i> TypeScript</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/07/05/NodeJS%20Study%20Notes/" rel="prev" title="专题知识学习：Node.js">
                  <i class="fa fa-angle-left"></i> 专题知识学习：Node.js
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/07/12/Docker%20Study%20Notes/" rel="next" title="专题知识学习：Docker">
                  专题知识学习：Docker <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Ariel</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">210k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">12:45</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/tianfei92" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
