

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Ariel">
  <meta name="keywords" content="">
  
    <meta name="description" content="一、核心概念与基础1.1 Webpack 定位与核心价值1.1.1 模块化打包的本质需求前端开发的核心演变 原始阶段：全局变量污染 1234&lt;!-- 传统开发方式 --&gt;&lt;script src&#x3D;&quot;jquery.js&quot;&gt;&lt;&#x2F;script&gt;&lt;script src&#x3D;&quot;plugin1.js&quot;&gt;&lt;&#x2F;script&amp;g">
<meta property="og:type" content="article">
<meta property="og:title" content="Webpack 专题知识学习">
<meta property="og:url" content="https://tianfei92.github.io/2025/07/03/Webpack%20Notes/index.html">
<meta property="og:site_name" content="Ariel&#39;s Blog">
<meta property="og:description" content="一、核心概念与基础1.1 Webpack 定位与核心价值1.1.1 模块化打包的本质需求前端开发的核心演变 原始阶段：全局变量污染 1234&lt;!-- 传统开发方式 --&gt;&lt;script src&#x3D;&quot;jquery.js&quot;&gt;&lt;&#x2F;script&gt;&lt;script src&#x3D;&quot;plugin1.js&quot;&gt;&lt;&#x2F;script&amp;g">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-07-03T01:11:35.000Z">
<meta property="article:modified_time" content="2025-07-03T13:12:14.885Z">
<meta property="article:author" content="Ariel">
<meta property="article:tag" content="Webpack">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>Webpack 专题知识学习 - Ariel&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"tianfei92.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Ariel</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Webpack 专题知识学习"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-07-03 09:11" pubdate>
          2025年7月3日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          18k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          147 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Webpack 专题知识学习</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="一、核心概念与基础"><a href="#一、核心概念与基础" class="headerlink" title="一、核心概念与基础"></a>一、核心概念与基础</h1><h2 id="1-1-Webpack-定位与核心价值"><a href="#1-1-Webpack-定位与核心价值" class="headerlink" title="1.1 Webpack 定位与核心价值"></a>1.1 Webpack 定位与核心价值</h2><h3 id="1-1-1-模块化打包的本质需求"><a href="#1-1-1-模块化打包的本质需求" class="headerlink" title="1.1.1 模块化打包的本质需求"></a>1.1.1 模块化打包的本质需求</h3><p><strong>前端开发的核心演变</strong></p>
<p>原始阶段：全局变量污染</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html">&lt;!-- 传统开发方式 --&gt;<br>&lt;script src=&quot;jquery.js&quot;&gt;&lt;/script&gt;<br>&lt;script src=&quot;plugin1.js&quot;&gt;&lt;/script&gt; &lt;!-- 可能覆盖全局变量 --&gt;<br>&lt;script src=&quot;plugin2.js&quot;&gt;&lt;/script&gt; &lt;!-- 依赖顺序必须正确 --&gt;<br></code></pre></td></tr></table></figure>

<p>模块化革命：</p>
<ul>
<li>CommonJS（Node.js）：const module &#x3D; require(‘.&#x2F;module’)</li>
<li>ES Modules（现代浏览器）：import module from ‘.&#x2F;module.js’</li>
</ul>
<span id="more"></span>

<p><strong>模块化打包要解决的四大核心问题</strong></p>
<table>
<thead>
<tr>
<th align="left">问题类型</th>
<th align="left">具体表现</th>
<th align="left">解决方案</th>
</tr>
</thead>
<tbody><tr>
<td align="left">依赖管理</td>
<td align="left">脚本加载顺序混乱<br>循环依赖风险</td>
<td align="left">构建依赖关系图(Dependency Graph)</td>
</tr>
<tr>
<td align="left">作用域隔离</td>
<td align="left">全局变量冲突<br>命名污染</td>
<td align="left">模块闭包封装</td>
</tr>
<tr>
<td align="left">资源整合</td>
<td align="left">多文件分散请求<br>资源类型多样</td>
<td align="left">统一打包策略<br>Loader转换机制</td>
</tr>
<tr>
<td align="left">生产优化</td>
<td align="left">未压缩代码<br>未Tree Shaking<br>无缓存优化</td>
<td align="left">压缩&#x2F;混淆<br>Dead Code消除<br>内容哈希</td>
</tr>
</tbody></table>
<p><strong>Webpack的核心解决机制</strong></p>
<p>(1) 依赖图谱构建</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// webpack内部生成的依赖图谱片段</span><br>&#123;<br>  <span class="hljs-string">&#x27;./src/index.js&#x27;</span>: &#123;<br>    <span class="hljs-attr">dependencies</span>: [<span class="hljs-string">&#x27;./header.js&#x27;</span>, <span class="hljs-string">&#x27;./sidebar.js&#x27;</span>],<br>    <span class="hljs-attr">code</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-variable language_">module</span>, <span class="hljs-built_in">exports</span>, <span class="hljs-built_in">require</span></span>) &#123;<br>      <span class="hljs-keyword">const</span> header = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./header.js&#x27;</span>);<br>      <span class="hljs-keyword">const</span> sidebar = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./sidebar.js&#x27;</span>);<br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&#x27;./header.js&#x27;</span>: &#123; <span class="hljs-comment">/* ... */</span> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) 作用域隔离（模块封装）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 打包后的模块代码</span><br>(<span class="hljs-function">() =&gt;</span> &#123; <span class="hljs-comment">// 自执行函数创建闭包</span><br>  <span class="hljs-keyword">var</span> __webpack_modules__ = &#123;<br>    <span class="hljs-string">&#x27;./src/math.js&#x27;</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-variable language_">module</span></span>) =&gt;</span> &#123;<br>      <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>        <span class="hljs-attr">add</span>: <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b,<br>        <span class="hljs-attr">pi</span>: <span class="hljs-number">3.14159</span><br>      &#125;<br>    &#125;<br>  &#125;;<br>&#125;)();<br></code></pre></td></tr></table></figure>

<p>(3) 资源统一处理流程</p>
<pre class="mermaid">graph LR
A[ES Modules] --> B[Babel Loader]
B --> C[JavaScript]
D[SCSS] --> E[Sass Loader]
E --> F[CSS]
F --> G[Style Loader]
H[Images] --> I[File Loader]
C --> J[打包输出]
G --> J
I --> J</pre>

<p><strong>模块化打包的核心价值</strong></p>
<ul>
<li>开发效率提升<ul>
<li>真正的组件化开发</li>
<li>依赖自动解析</li>
<li>热更新能力</li>
</ul>
</li>
<li>性能优化基础<ul>
<li>Tree Shaking消除无效代码</li>
<li>按需加载（Code Splitting）</li>
<li>长效缓存（Content Hash）</li>
</ul>
</li>
<li>工程化支撑<ul>
<li>统一构建流程</li>
<li>多环境适配</li>
<li>质量保障（Lint&#x2F;Test集成）</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 原始代码</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">used</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">/*...*/</span> &#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">unused</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">/*...*/</span> &#125;<br><br><span class="hljs-comment">// 打包后（未引用的unused被移除）</span><br><span class="hljs-comment">/* harmony export */</span> __webpack_exports__[<span class="hljs-string">&quot;used&quot;</span>] = used;<br></code></pre></td></tr></table></figure>

<p><strong>面试重点解析</strong></p>
<ul>
<li>为什么现代前端需要打包工具？</li>
<li>Webpack如何解决模块循环依赖问题？</li>
</ul>
<h3 id="1-1-2-与Rollup-Vite-Parcel的对比（适用场景差异）"><a href="#1-1-2-与Rollup-Vite-Parcel的对比（适用场景差异）" class="headerlink" title="1.1.2 与Rollup&#x2F;Vite&#x2F;Parcel的对比（适用场景差异）"></a>1.1.2 与Rollup&#x2F;Vite&#x2F;Parcel的对比（适用场景差异）</h3><p><strong>主流构建工具核心定位对比</strong></p>
<table>
<thead>
<tr>
<th align="left">工具</th>
<th align="left">核心定位</th>
<th align="left">设计哲学</th>
<th align="left">典型用户</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Webpack</td>
<td align="left">全能型模块打包器</td>
<td align="left">“一切皆模块”</td>
<td align="left">复杂SPA应用</td>
</tr>
<tr>
<td align="left">Rollup</td>
<td align="left">ES模块打包器</td>
<td align="left">“输出最简洁的库代码”</td>
<td align="left">库&#x2F;框架开发者</td>
</tr>
<tr>
<td align="left">Vite</td>
<td align="left">下一代前端工具链</td>
<td align="left">“原生ESM + 按需编译”</td>
<td align="left">现代框架项目</td>
</tr>
<tr>
<td align="left">Parcel</td>
<td align="left">零配置打包器</td>
<td align="left">“开箱即用”</td>
<td align="left">快速原型开发</td>
</tr>
</tbody></table>
<p><strong>架构原理差异</strong></p>
<p>(1) webpack</p>
<pre class="mermaid">graph LR
A[Entry] --> B[递归构建依赖图]
B --> C[Loader处理资源]
C --> D[Plugin优化]
D --> E[Chunk分割]
E --> F[输出Bundle]</pre>

<p>(2) rollup</p>
<pre class="mermaid">graph LR
A[ESM入口] --> B[静态分析依赖树]
B --> C[Tree-Shaking]
C --> D[作用域提升]
D --> E[输出扁平化Bundle]</pre>

<p>(3) vite</p>
<pre class="mermaid">graph LR
A[浏览器请求] --> B{是否为JS/CSS?}
B -->|是| C[按需编译]
B -->|否| D[直接返回]
C --> E[ESM方式返回]</pre>

<p>(4) parcel</p>
<pre class="mermaid">graph LR
A[入口文件] --> B[自动检测依赖]
B --> C[多核并行处理]
C --> D[零配置输出]</pre>

<p><strong>适用场景分析</strong></p>
<p>(1) Webpack 首选场景</p>
<ul>
<li>企业级复杂应用（特别是遗留系统）</li>
<li>需要深度定制构建流程</li>
<li>多页面应用（MPA）项目</li>
<li>需要集成大量第三方插件</li>
<li>示例：电商后台管理系统</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 典型特征</span><br>- 500+组件<br>- 需要代码分割<br>- 需要兼容IE11<br>- 集成Ant Design等大型UI库<br></code></pre></td></tr></table></figure>

<p>(2) Rollup 首选场景</p>
<ul>
<li>开源库&#x2F;框架开发</li>
<li>需要输出多种格式的包（UMD&#x2F;ESM&#x2F;CJS）</li>
<li>追求最小化bundle体积</li>
<li>示例：React组件库</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// rollup.config.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">input</span>: <span class="hljs-string">&#x27;src/index.js&#x27;</span>,<br>  <span class="hljs-attr">output</span>: [<br>    &#123; <span class="hljs-attr">file</span>: <span class="hljs-string">&#x27;dist/library.esm.js&#x27;</span>, <span class="hljs-attr">format</span>: <span class="hljs-string">&#x27;es&#x27;</span> &#125;,<br>    &#123; <span class="hljs-attr">file</span>: <span class="hljs-string">&#x27;dist/library.cjs.js&#x27;</span>, <span class="hljs-attr">format</span>: <span class="hljs-string">&#x27;cjs&#x27;</span> &#125;<br>  ],<br>  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">terser</span>()] <span class="hljs-comment">// 代码压缩</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>(3) Vite 首选场景</p>
<ul>
<li>基于现代框架的新项目（Vue&#x2F;React&#x2F;Svelte）</li>
<li>需要极速开发体验</li>
<li>使用大量ES模块的现代浏览器项目</li>
<li>示例：创新型SaaS平台</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 开发体验对比</span><br>Webpack启动: 15-25s <br>Vite启动: &lt;500ms <br></code></pre></td></tr></table></figure>

<p>(4) Parcel 首选场景</p>
<ul>
<li>快速原型开发</li>
<li>静态网站生成</li>
<li>不需要复杂配置的小型项目</li>
<li>示例：个人博客网站</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 零配置使用</span><br>parcel build index.html <br><span class="hljs-comment"># 自动处理：</span><br><span class="hljs-comment"># - Sass → CSS</span><br><span class="hljs-comment"># - TypeScript → JavaScript</span><br><span class="hljs-comment"># - 图片优化</span><br></code></pre></td></tr></table></figure>

<p><strong>面试高频问题解析</strong></p>
<p>(1) 为什么Vite开发环境比Webpack快？</p>
<ul>
<li>基于浏览器原生ES模块系统</li>
<li>按需编译（非全量打包）</li>
<li>使用ESBuild预构建（Go语言编写，比JS快10-100倍）</li>
</ul>
<h2 id="1-2-核心配置项解析"><a href="#1-2-核心配置项解析" class="headerlink" title="1.2 核心配置项解析"></a>1.2 核心配置项解析</h2><h3 id="1-2-1-entry：多入口、动态入口设计"><a href="#1-2-1-entry：多入口、动态入口设计" class="headerlink" title="1.2.1 entry：多入口、动态入口设计"></a>1.2.1 <code>entry</code>：多入口、动态入口设计</h3><p><strong>入口(Entry)的核心概念</strong></p>
<p>基本定义：</p>
<ul>
<li>入口起点(entry point)：Webpack构建依赖图的起始模块</li>
<li>单入口基础配置：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">entry</span>: <span class="hljs-string">&#x27;./src/index.js&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>入口的底层实现:</p>
<pre class="mermaid">graph LR
  A[Entry] --> B[创建依赖图]
  B --> C[递归解析依赖]
  C --> D[生成Chunk]</pre>

<p><strong>多入口配置实战</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// webpack.config.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">entry</span>: &#123;<br>    <span class="hljs-attr">main</span>: <span class="hljs-string">&#x27;./src/app.js&#x27;</span>,<br>    <span class="hljs-attr">admin</span>: <span class="hljs-string">&#x27;./src/admin.js&#x27;</span>,<br>    <span class="hljs-attr">vendor</span>: [<span class="hljs-string">&#x27;react&#x27;</span>, <span class="hljs-string">&#x27;react-dom&#x27;</span>]<br>  &#125;,<br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;[name].bundle.js&#x27;</span> <span class="hljs-comment">// 输出 main.bundle.js, admin.bundle.js</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>动态入口高级技巧</strong></p>
<p>(1) 函数式动态入库</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 根据环境变量动态生成入口</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">entry</span>: <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> entries = &#123;<br>      <span class="hljs-attr">main</span>: <span class="hljs-string">&#x27;./src/app.js&#x27;</span><br>    &#125;;<br>    <br>    <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;development&#x27;</span>) &#123;<br>      entries.<span class="hljs-property">debug</span> = <span class="hljs-string">&#x27;./src/debugPanel.js&#x27;</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">BUILD_TARGET</span> === <span class="hljs-string">&#x27;admin&#x27;</span>) &#123;<br>      entries.<span class="hljs-property">admin</span> = <span class="hljs-string">&#x27;./src/admin.js&#x27;</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> entries;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) 文件系统驱动入口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);<br><br><span class="hljs-comment">// 自动扫描pages目录创建入口</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">generateEntries</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> pagesDir = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;src/pages&#x27;</span>);<br>  <span class="hljs-keyword">return</span> fs.<span class="hljs-title function_">readdirSync</span>(pagesDir).<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">entries, page</span>) =&gt;</span> &#123;<br>    entries[page] = path.<span class="hljs-title function_">join</span>(pagesDir, page, <span class="hljs-string">&#x27;index.js&#x27;</span>);<br>    <span class="hljs-keyword">return</span> entries;<br>  &#125;, &#123;&#125;);<br>&#125;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">entry</span>: <span class="hljs-title function_">generateEntries</span>()<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(3) 远程配置入口（微前端场景）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">entry</span>: <span class="hljs-title function_">async</span> () =&gt; &#123;<br>    <span class="hljs-comment">// 从配置服务器获取入口配置</span><br>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;https://config-server.com/entries&#x27;</span>);<br>    <span class="hljs-keyword">const</span> remoteConfig = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();<br>    <br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">main</span>: <span class="hljs-string">&#x27;./src/app.js&#x27;</span>,<br>      ...remoteConfig.<span class="hljs-property">modules</span><br>    &#125;;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>性能优化策略</strong></p>
<p>(1) 入口依赖优化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">entry</span>: &#123;<br>    <span class="hljs-attr">app</span>: &#123;<br>      <span class="hljs-attr">import</span>: <span class="hljs-string">&#x27;./src/app.js&#x27;</span>,<br>      <span class="hljs-attr">dependOn</span>: <span class="hljs-string">&#x27;shared&#x27;</span> <span class="hljs-comment">// 共享依赖</span><br>    &#125;,<br>    <span class="hljs-attr">dashboard</span>: &#123;<br>      <span class="hljs-attr">import</span>: <span class="hljs-string">&#x27;./src/dashboard.js&#x27;</span>,<br>      <span class="hljs-attr">dependOn</span>: <span class="hljs-string">&#x27;shared&#x27;</span><br>    &#125;,<br>    <span class="hljs-attr">shared</span>: [<span class="hljs-string">&#x27;react&#x27;</span>, <span class="hljs-string">&#x27;react-dom&#x27;</span>] <span class="hljs-comment">// 公共模块</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) 动态入口懒加载</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 运行时动态加载入口（适用于插件系统）</span><br>button.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackIgnore: false */</span> <span class="hljs-string">&#x27;/plugins/&#x27;</span> + pluginName + <span class="hljs-string">&#x27;/entry.js&#x27;</span>)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">module</span> =&gt;</span> <span class="hljs-variable language_">module</span>.<span class="hljs-title function_">init</span>());<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>常见问题与解决方案</strong></p>
<p>(1) 入口文件过大问题</p>
<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-attr">entry</span>: &#123;<br>  <span class="hljs-attr">main</span>: &#123;<br>    <span class="hljs-attr">import</span>: <span class="hljs-string">&#x27;./src/app.js&#x27;</span>,<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;main/[name].js&#x27;</span>, <span class="hljs-comment">// 自定义输出路径</span><br>    <span class="hljs-attr">dependOn</span>: <span class="hljs-string">&#x27;vendors&#x27;</span><br>  &#125;,<br>  <span class="hljs-attr">vendors</span>: [<span class="hljs-string">&#x27;react&#x27;</span>, <span class="hljs-string">&#x27;lodash&#x27;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) 循环依赖警告</p>
<p>修复方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 重构模块结构或使用动态导入</span><br><span class="hljs-comment">// 错误示例</span><br><span class="hljs-comment">// a.js</span><br><span class="hljs-keyword">import</span> &#123; b &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./b.js&#x27;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">a</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">b</span>();<br><br><span class="hljs-comment">// b.js</span><br><span class="hljs-keyword">import</span> &#123; a &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./a.js&#x27;</span>; <span class="hljs-comment">// 循环依赖</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">b</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">a</span>();<br><br><span class="hljs-comment">// 正确方案</span><br><span class="hljs-comment">// b.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">b</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./a.js&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> m.<span class="hljs-title function_">a</span>());<br></code></pre></td></tr></table></figure>

<p><strong>面试重点解析</strong></p>
<p>(1) 多入口应用如何共享代码？</p>
<ul>
<li>使用dependOn显式声明共享模块</li>
<li>配置SplitChunksPlugin自动提取公共代码</li>
</ul>
<p>(2) 动态入口在微前端中的应用？</p>
<ul>
<li>主应用通过动态入口加载子应用</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-attr">entry</span>: &#123;<br>  <span class="hljs-attr">mainApp</span>: <span class="hljs-string">&#x27;./main.js&#x27;</span>,<br>  <span class="hljs-attr">childApp1</span>: <span class="hljs-string">&#x27;https://child-app.com/entry.js&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>结合Module Federation实现</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 动态配置remotes</span><br><span class="hljs-attr">remotes</span>: &#123;<br>  <span class="hljs-attr">childApp</span>: <span class="hljs-string">`promise import(&#x27;child_app/entry.js&#x27;)`</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-2-output：文件名哈希、CDN路径、Library导出"><a href="#1-2-2-output：文件名哈希、CDN路径、Library导出" class="headerlink" title="1.2.2 output：文件名哈希、CDN路径、Library导出"></a>1.2.2 <code>output</code>：文件名哈希、CDN路径、Library导出</h3><p><strong>Output 配置核心概念</strong></p>
<p>基本作用与结构：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;dist&#x27;</span>), <span class="hljs-comment">// 输出目录</span><br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;[name].[contenthash].js&#x27;</span>,  <span class="hljs-comment">// 文件名模板</span><br>    <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&#x27;https://cdn.example.com/&#x27;</span>, <span class="hljs-comment">// CDN路径</span><br>    <span class="hljs-attr">library</span>: <span class="hljs-string">&#x27;MyLibrary&#x27;</span>, <span class="hljs-comment">// 库导出名称</span><br>    <span class="hljs-attr">libraryTarget</span>: <span class="hljs-string">&#x27;umd&#x27;</span> <span class="hljs-comment">// 导出格式</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>文件名哈希策略</strong></p>
<table>
<thead>
<tr>
<th align="left">哈希类型</th>
<th align="left">计算依据</th>
<th align="left">适用场景</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[hash]</td>
<td align="left">整个项目构建</td>
<td align="left">所有输出文件相同哈希</td>
<td align="left">main.3a7f8e9.js</td>
</tr>
<tr>
<td align="left">[chunkhash]</td>
<td align="left">每个入口chunk内容</td>
<td align="left">独立更新的chunk</td>
<td align="left">app.4c2d8b1.js</td>
</tr>
<tr>
<td align="left">[contenthash]</td>
<td align="left">文件实际内容</td>
<td align="left">最佳缓存策略</td>
<td align="left">styles.5e6f7a2.css</td>
</tr>
<tr>
<td align="left">[fullhash]</td>
<td align="left">整个编译过程</td>
<td align="left">Webpack 5+ 替代[hash]</td>
<td align="left">vendor.9b0c3d4.js</td>
</tr>
</tbody></table>
<p>哈希失效问题解决方案</p>
<ul>
<li>问题：模块未变更但哈希变化</li>
<li>原因：Webpack引导代码(manifest)变化</li>
<li>修复：提取runtime到单独文件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-attr">optimization</span>: &#123;<br>  <span class="hljs-attr">runtimeChunk</span>: &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-function"><span class="hljs-params">entrypoint</span> =&gt;</span> <span class="hljs-string">`runtime-<span class="hljs-subst">$&#123;entrypoint.name&#125;</span>`</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>CDN路径配置策略</strong></p>
<p>(1) publicPath 动态配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 根据环境切换路径</span><br><span class="hljs-attr">output</span>: &#123;<br>  <span class="hljs-attr">publicPath</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span><br>    ? <span class="hljs-string">&#x27;https://cdn.example.com/assets/&#x27;</span><br>    : <span class="hljs-string">&#x27;/&#x27;</span><br>&#125;<br><br><span class="hljs-comment">// 自动检测协议</span><br><span class="hljs-attr">publicPath</span>: <span class="hljs-string">&#x27;//cdn.example.com/assets/&#x27;</span><br></code></pre></td></tr></table></figure>

<p>(2) 微前端场景下的 CDN 配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 主应用配置</span><br><span class="hljs-attr">output</span>: &#123;<br>  <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&#x27;https://main-app.com/&#x27;</span><br>&#125;<br><br><span class="hljs-comment">// 子应用配置</span><br><span class="hljs-attr">output</span>: &#123;<br>  <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&#x27;https://child-app.com/assets/&#x27;</span>,<br>  <span class="hljs-comment">// Webpack 5 Module Federation</span><br>  <span class="hljs-attr">uniqueName</span>: <span class="hljs-string">&#x27;childApp&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Library 导出配置</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-attr">output</span>: &#123;<br>  <span class="hljs-attr">library</span>: &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;MyLibrary&#x27;</span>,<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;umd&#x27;</span>,<br>    <span class="hljs-attr">export</span>: <span class="hljs-string">&#x27;default&#x27;</span> <span class="hljs-comment">// 导出默认值</span><br>  &#125;,<br>  <span class="hljs-attr">globalObject</span>: <span class="hljs-string">&#x27;this&#x27;</span> <span class="hljs-comment">// 兼容Node和浏览器</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>导出格式对比：</p>
<table>
<thead>
<tr>
<th align="left">格式类型</th>
<th align="left">使用场景</th>
<th align="left">示例输出</th>
<th align="left">运行环境</th>
</tr>
</thead>
<tbody><tr>
<td align="left">var</td>
<td align="left">全局变量</td>
<td align="left"><code>var MyLib = ...</code></td>
<td align="left">浏览器</td>
</tr>
<tr>
<td align="left">this</td>
<td align="left">当前上下文</td>
<td align="left"><code>this[&quot;MyLib&quot;] = ...</code></td>
<td align="left">浏览器&#x2F;Node</td>
</tr>
<tr>
<td align="left">commonjs</td>
<td align="left">CommonJS环境</td>
<td align="left"><code>exports[&quot;MyLib&quot;] = ...</code></td>
<td align="left">Node</td>
</tr>
<tr>
<td align="left">amd</td>
<td align="left">AMD模块</td>
<td align="left"><code>define(&quot;MyLib&quot;, [], ...)</code></td>
<td align="left">RequireJS</td>
</tr>
<tr>
<td align="left">umd</td>
<td align="left">通用模块定义</td>
<td align="left">兼容AMD&#x2F;CJS&#x2F;全局变量</td>
<td align="left">跨环境</td>
</tr>
<tr>
<td align="left">system</td>
<td align="left">SystemJS模块</td>
<td align="left"><code>System.register(&quot;MyLib&quot;, ...)</code></td>
<td align="left">SystemJS</td>
</tr>
</tbody></table>
<p>多入口库导出示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-attr">entry</span>: &#123;<br>  <span class="hljs-attr">main</span>: <span class="hljs-string">&#x27;./src/index.js&#x27;</span>,<br>  <span class="hljs-attr">utils</span>: <span class="hljs-string">&#x27;./src/utils.js&#x27;</span><br>&#125;,<br><span class="hljs-attr">output</span>: &#123;<br>  <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;[name].js&#x27;</span>,<br>  <span class="hljs-attr">library</span>: &#123;<br>    <span class="hljs-attr">name</span>: [<span class="hljs-string">&#x27;MyLib&#x27;</span>, <span class="hljs-string">&#x27;[name]&#x27;</span>], <span class="hljs-comment">// MyLib.main, MyLib.utils</span><br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;umd&#x27;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>性能优化实践</strong></p>
<p>(1) 哈希算法优化（Webpack 5+）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-attr">output</span>: &#123;<br>  <span class="hljs-attr">hashFunction</span>: <span class="hljs-string">&#x27;xxhash64&#x27;</span>, <span class="hljs-comment">// 比md4更快</span><br>  <span class="hljs-attr">hashDigestLength</span>: <span class="hljs-number">12</span> <span class="hljs-comment">// 更长的哈希减少碰撞</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) CDN 域名分散</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 使用多个CDN域名加速资源加载</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getCDNPath</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> cdns = [<br>    <span class="hljs-string">&#x27;https://cdn1.example.com&#x27;</span>,<br>    <span class="hljs-string">&#x27;https://cdn2.example.com&#x27;</span><br>  ];<br>  <span class="hljs-keyword">return</span> cdns[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * cdns.<span class="hljs-property">length</span>)];<br>&#125;<br><br><span class="hljs-attr">output</span>: &#123;<br>  <span class="hljs-attr">publicPath</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span> <br>    ? <span class="hljs-title function_">getCDNPath</span>() <br>    : <span class="hljs-string">&#x27;/&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>常见问题解决方案</strong></p>
<p>(1) 路径错误问题</p>
<ul>
<li>症状：Error: Cannot find module ‘.&#x2F;main.js’</li>
<li>原因：publicPath配置错误</li>
</ul>
<p>(2) 库导出冲突</p>
<ul>
<li>症状：多库共存时全局变量覆盖</li>
<li>解决方案：作用域隔离</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-attr">output</span>: &#123;<br>  <span class="hljs-attr">library</span>: &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;MyLib&#x27;</span>,<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;var&#x27;</span>,<br>    <span class="hljs-attr">umdNamedDefine</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 添加命名空间</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>面试重点解析</strong></p>
<p>(1) contenthash&#x2F;chunkhash&#x2F;hash的区别？</p>
<ul>
<li>hash：基于整个compilation生成，所有文件共享</li>
<li>chunkhash：基于入口chunk内容</li>
<li>contenthash：基于文件内容（最佳缓存策略）</li>
<li>使用场景：<ul>
<li>CSS文件应使用[contenthash]</li>
<li>入口JS使用[chunkhash]</li>
<li>避免使用[hash]</li>
</ul>
</li>
</ul>
<p>(2) 如何实现永久缓存？</p>
<ul>
<li>使用[contenthash]作为文件名</li>
<li>提取runtime到单独文件</li>
<li>稳定模块ID（optimization.moduleIds: ‘deterministic’）</li>
<li>避免内联webpack运行时代码</li>
</ul>
<p>(3) UMD库如何兼容不同环境？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-attr">output</span>: &#123;<br>  <span class="hljs-attr">library</span>: &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;MyLib&#x27;</span>,<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;umd&#x27;</span><br>  &#125;,<br>  <span class="hljs-attr">globalObject</span>: <span class="hljs-string">&#x27;typeof self !== &quot;undefined&quot; ? self : this&#x27;</span> <span class="hljs-comment">// 自动检测环境</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-2-3-mode：开发-生产模式内置优化"><a href="#1-2-3-mode：开发-生产模式内置优化" class="headerlink" title="1.2.3 mode：开发&#x2F;生产模式内置优化"></a>1.2.3 <code>mode</code>：开发&#x2F;生产模式内置优化</h3><p><strong>mode 配置的核心作用</strong></p>
<p>模式定义与默认行为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">mode</span>: <span class="hljs-string">&#x27;development&#x27;</span>, <span class="hljs-comment">// 可选：&#x27;development&#x27; | &#x27;production&#x27; | &#x27;none&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">模式</th>
<th align="left">默认行为概览</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">development</td>
<td align="left">优化开发体验</td>
<td align="left">本地开发</td>
</tr>
<tr>
<td align="left">production</td>
<td align="left">优化输出文件体积和性能</td>
<td align="left">生产部署</td>
</tr>
<tr>
<td align="left">none</td>
<td align="left">不启用任何默认优化</td>
<td align="left">自定义配置</td>
</tr>
</tbody></table>
<p><strong>开发模式(development)深度解析</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// mode: &#x27;development&#x27; 等效于以下配置</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">devtool</span>: <span class="hljs-string">&#x27;eval-cheap-module-source-map&#x27;</span>, <span class="hljs-comment">// 源映射(Source Map)</span><br>  <span class="hljs-attr">optimization</span>: &#123;<br>    <span class="hljs-attr">minimize</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 禁用压缩/优化</span><br>    <span class="hljs-attr">removeAvailableModules</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 保留变量名/注释</span><br>    <span class="hljs-attr">removeEmptyChunks</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 保留变量名/注释</span><br>    <span class="hljs-attr">splitChunks</span>: <span class="hljs-literal">false</span>,<br>  &#125;,<br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">HotModuleReplacementPlugin</span>() <span class="hljs-comment">// 热模块替换(HMR)</span><br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>生产模式(production)深度优化</strong></p>
<p>内置优化清单：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 生产模式等效配置</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">optimization</span>: &#123;<br>    <span class="hljs-attr">minimize</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 启用Terser压缩</span><br>    <span class="hljs-attr">minimizer</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>()], <br>    <span class="hljs-attr">splitChunks</span>: &#123; <span class="hljs-attr">chunks</span>: <span class="hljs-string">&#x27;all&#x27;</span> &#125;, <span class="hljs-comment">// 代码分割</span><br>    <span class="hljs-attr">concatenateModules</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 模块串联</span><br>    <span class="hljs-attr">flagIncludedChunks</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 标记包含的chunks</span><br>    <span class="hljs-attr">sideEffects</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 启用Tree Shaking</span><br>    <span class="hljs-attr">providedExports</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 分析导出</span><br>    <span class="hljs-attr">usedExports</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 标记使用导出</span><br>  &#125;,<br>  <span class="hljs-attr">performance</span>: &#123;<br>    <span class="hljs-attr">hints</span>: <span class="hljs-string">&#x27;warning&#x27;</span>, <span class="hljs-comment">// 性能提示</span><br>    <span class="hljs-attr">maxAssetSize</span>: <span class="hljs-number">250000</span>, <span class="hljs-comment">// 资源大小阈值</span><br>    <span class="hljs-attr">maxEntrypointSize</span>: <span class="hljs-number">250000</span> <span class="hljs-comment">// 入口大小阈值</span><br>  &#125;,<br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">DefinePlugin</span>(&#123; <br>      <span class="hljs-string">&#x27;process.env.NODE_ENV&#x27;</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-string">&#x27;production&#x27;</span>) <br>    &#125;),<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">CssMinimizerPlugin</span>() <span class="hljs-comment">// CSS压缩</span><br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>高级模式配置技巧</strong></p>
<p>(1) 多环境配置管理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// webpack.config.js</span><br><span class="hljs-keyword">const</span> configs = &#123;<br>  <span class="hljs-attr">development</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./webpack.dev.config&#x27;</span>),<br>  <span class="hljs-attr">production</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./webpack.prod.config&#x27;</span>),<br>  <span class="hljs-attr">staging</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./webpack.staging.config&#x27;</span>)<br>&#125;;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">env</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> configs[env.<span class="hljs-property">mode</span> || <span class="hljs-string">&#x27;development&#x27;</span>];<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) 模式扩展配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 扩展生产模式优化</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">mode</span>: <span class="hljs-string">&#x27;production&#x27;</span>,<br>  <span class="hljs-attr">optimization</span>: &#123;<br>    <span class="hljs-comment">// 保留原始配置并添加额外优化</span><br>    ...webpack.<span class="hljs-property">optimization</span>,<br>    <span class="hljs-attr">minimize</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">minimizer</span>: [<br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>(&#123;<br>        <span class="hljs-attr">parallel</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">terserOptions</span>: &#123;<br>          <span class="hljs-attr">compress</span>: &#123; <span class="hljs-attr">drop_console</span>: <span class="hljs-literal">true</span> &#125; <span class="hljs-comment">// 移除console</span><br>        &#125;<br>      &#125;)<br>    ]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>面试重点解析</strong></p>
<p>(1) mode配置具体做了哪些优化？</p>
<ul>
<li><p>开发模式：</p>
<ul>
<li>启用命名模块ID（非数字ID）</li>
<li>保留变量名和代码格式</li>
<li>启用eval-source-map</li>
<li>添加HMR支持</li>
</ul>
</li>
<li><p>生产模式：</p>
<ul>
<li>启用Terser代码压缩</li>
<li>开启Tree Shaking</li>
<li>启用作用域提升(Scope Hoisting)</li>
<li>设置process.env.NODE_ENV为production</li>
<li>启用性能提示</li>
</ul>
</li>
</ul>
<p>(2) 如何验证Tree Shaking生效？</p>
<p>验证步骤：</p>
<ol>
<li>确保使用生产模式：mode: ‘production’</li>
<li>检查导出的包中是否包含未使用的代码</li>
<li>使用webpack-bundle-analyzer可视化分析</li>
<li>在package.json中添加”sideEffects”: false</li>
</ol>
<p>(3) 为什么生产环境需要不同的Source Map？</p>
<p>安全与性能平衡：</p>
<ul>
<li>hidden-source-map：生成map文件但不关联</li>
<li>nosources-source-map：显示行号但不暴露源码</li>
<li>最佳实践：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-attr">devtool</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">SENTRY_URL</span> <br>  ? <span class="hljs-string">&#x27;source-map&#x27;</span> <span class="hljs-comment">// 错误监控需要完整sourcemap</span><br>  : <span class="hljs-string">&#x27;hidden-source-map&#x27;</span><br></code></pre></td></tr></table></figure>

<h3 id="1-2-4-devtool：Source-Map原理与选型"><a href="#1-2-4-devtool：Source-Map原理与选型" class="headerlink" title="1.2.4 devtool：Source Map原理与选型"></a>1.2.4 <code>devtool</code>：Source Map原理与选型</h3><p><strong>Source Map 核心原理</strong></p>
<p>工作原理示意图：</p>
<pre class="mermaid">graph LR
A[压缩混淆代码] --> B[错误位置: 第3行第15列]
B --> C[Source Map文件]
C --> D[原始代码位置: 第42行第8列]</pre>

<p>Source Map 文件结构：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JSON"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>                   <span class="hljs-comment">// Source Map版本</span><br>  <span class="hljs-attr">&quot;sources&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;app.js&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>           <span class="hljs-comment">// 源文件列表</span><br>  <span class="hljs-attr">&quot;names&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;add&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;multiply&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>    <span class="hljs-comment">// 变量名映射</span><br>  <span class="hljs-attr">&quot;mappings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;AAAA;ACDE;&quot;</span><span class="hljs-punctuation">,</span>        <span class="hljs-comment">// 位置映射编码</span><br>  <span class="hljs-attr">&quot;file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;app.min.js&quot;</span><span class="hljs-punctuation">,</span>            <span class="hljs-comment">// 生成的文件名</span><br>  <span class="hljs-attr">&quot;sourcesContent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;原始代码&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 原始源代码（可选）</span><br>  <span class="hljs-attr">&quot;sourceRoot&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/src&quot;</span>             <span class="hljs-comment">// 源文件根路径</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p><strong>映射编码解析（VLQ 原理）</strong></p>
<p>(1) VLQ 编码示例</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Text">原始位置 → 生成位置<br>第2行第5列 → 第1行第10列<br><br>VLQ编码：CAC1F<br></code></pre></td></tr></table></figure>

<p>(2) VLQ 解码过程</p>
<table>
<thead>
<tr>
<th align="left">字符</th>
<th align="left">Base64值</th>
<th align="left">二进制</th>
<th align="left">VLQ连续位</th>
<th align="left">实际值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">C</td>
<td align="left">2</td>
<td align="left">000010</td>
<td align="left">0</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">A</td>
<td align="left">0</td>
<td align="left">000000</td>
<td align="left">1</td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">C</td>
<td align="left">2</td>
<td align="left">000010</td>
<td align="left">0</td>
<td align="left">-1</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">17</td>
<td align="left">010001</td>
<td align="left">0</td>
<td align="left">8</td>
</tr>
<tr>
<td align="left">F</td>
<td align="left">5</td>
<td align="left">000101</td>
<td align="left">1</td>
<td align="left">5</td>
</tr>
</tbody></table>
<p>结果：行偏移+1，列偏移0 → 行偏移-1，列偏移8 → 列偏移+5</p>
<p><strong>Source Map 类型全解析</strong></p>
<p>(1) 开发环境推荐类型</p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">构建速度</th>
<th align="left">重建速度</th>
<th align="left">质量</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">eval</td>
<td align="left">+++</td>
<td align="left">+++</td>
<td align="left">无</td>
<td align="left">超快速开发</td>
</tr>
<tr>
<td align="left">eval-source-map</td>
<td align="left">+</td>
<td align="left">++</td>
<td align="left">完整</td>
<td align="left">Create React App 默认</td>
</tr>
<tr>
<td align="left">eval-cheap-source-map</td>
<td align="left">++</td>
<td align="left">+++</td>
<td align="left">行级</td>
<td align="left">大型项目开发</td>
</tr>
<tr>
<td align="left">eval-cheap-module-source-map</td>
<td align="left">++</td>
<td align="left">+++</td>
<td align="left">行级</td>
<td align="left">TypeScript项目</td>
</tr>
</tbody></table>
<p>(2) 生产环境推荐类型</p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">文件大小</th>
<th align="left">安全性</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">source-map</td>
<td align="left">大</td>
<td align="left">低</td>
<td align="left">需要完整源码映射</td>
</tr>
<tr>
<td align="left">hidden-source-map</td>
<td align="left">大</td>
<td align="left">高</td>
<td align="left">错误监控系统(Sentry)</td>
</tr>
<tr>
<td align="left">nosources-source-map</td>
<td align="left">中</td>
<td align="left">高</td>
<td align="left">生产环境调试</td>
</tr>
<tr>
<td align="left">cheap-module-source-map</td>
<td align="left">中</td>
<td align="left">中</td>
<td align="left">平衡性能与调试</td>
</tr>
</tbody></table>
<p><strong>常见问题解决方案</strong></p>
<p>(1) Source Map 不生效</p>
<p>诊断步骤：</p>
<ul>
<li>检查浏览器开发者工具设置（需启用Source Map）</li>
<li>验证HTTP响应头是否包含 <code>SourceMap: &lt;url&gt;</code></li>
<li>检查.map文件是否可访问</li>
<li>确认webpack配置未设置 devtool: false</li>
</ul>
<p><strong>面试重点解析</strong></p>
<p>(1) 为什么eval能提升构建速度？</p>
<p>技术原理：</p>
<ul>
<li>使用 eval() 执行代码</li>
<li>映射信息内联在代码中（非独立文件）</li>
<li>浏览器直接解析无需加载额外文件</li>
<li>避免磁盘I&#x2F;O操作</li>
</ul>
<p>(2) 如何选择生产环境的Source Map？</p>
<pre class="mermaid">graph LR
  A[需求分析] --> B{需要调试生产环境?}
  B -->|是| C{需要完整源码?}
  C -->|是| D[source-map]
  C -->|否| E[nosources-source-map]
  B -->|否| F{需要错误监控?}
  F -->|是| G[hidden-source-map]
  F -->|否| H[不生成Source Map]</pre>

<p>(3) Source Map如何影响性能？</p>
<p>影响维度：</p>
<ul>
<li>构建性能：生成sourcemap增加20%-30%构建时间</li>
<li>文件传输：.map文件增加额外网络请求</li>
<li>浏览器解析：加载sourcemap增加内存占用</li>
<li>安全风险：暴露原始代码结构</li>
</ul>
<h2 id="1-3-模块化兼容"><a href="#1-3-模块化兼容" class="headerlink" title="1.3 模块化兼容"></a>1.3 模块化兼容</h2><h3 id="1-3-1-ES-Module-CommonJS-AMD-混用处理"><a href="#1-3-1-ES-Module-CommonJS-AMD-混用处理" class="headerlink" title="1.3.1 ES Module &#x2F; CommonJS &#x2F; AMD 混用处理"></a>1.3.1 ES Module &#x2F; CommonJS &#x2F; AMD 混用处理</h3><p><strong>模块系统核心差异对比</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">ES Module (ESM)</th>
<th align="left">CommonJS (CJS)</th>
<th align="left">AMD</th>
</tr>
</thead>
<tbody><tr>
<td align="left">加载方式</td>
<td align="left">编译时静态分析</td>
<td align="left">运行时动态加载</td>
<td align="left">异步加载</td>
</tr>
<tr>
<td align="left">语法</td>
<td align="left">import&#x2F;export</td>
<td align="left">require&#x2F;module.exports</td>
<td align="left">define&#x2F;require</td>
</tr>
<tr>
<td align="left">适用环境</td>
<td align="left">现代浏览器&#x2F;Node.js v12+</td>
<td align="left">Node.js</td>
<td align="left">浏览器</td>
</tr>
<tr>
<td align="left">模块对象</td>
<td align="left">只读引用</td>
<td align="left">值拷贝</td>
<td align="left">值拷贝</td>
</tr>
<tr>
<td align="left">循环依赖处理</td>
<td align="left">支持（预编译解决）</td>
<td align="left">部分支持（运行时解决）</td>
<td align="left">支持</td>
</tr>
<tr>
<td align="left">Tree Shaking</td>
<td align="left">原生支持</td>
<td align="left">不支持</td>
<td align="left">不支持</td>
</tr>
</tbody></table>
<p><strong>混用场景下的问题与解决方案</strong></p>
<p>(1) 常见混用问题分析</p>
<pre class="mermaid">graph TD
  A[模块混用问题] --> B[语法冲突]
  A --> C[作用域污染]
  A --> D[循环依赖风险]
  A --> E[Tree Shaking失效]
  
  B --> B1[ESM的import与CJS的require共存]
  C --> C1[AMD的全局define污染]
  D --> D1[模块间相互引用导致死锁]
  E --> E1[CJS模块无法被Tree Shaking]</pre>

<p>(2) Webpack 的模块统一处理</p>
<pre class="mermaid">graph LR
  A[ESM] --> D[Webpack模块系统]
  B[CJS] --> D
  C[AMD] --> D
  D --> E[统一模块格式]
  E --> F[输出优化代码]</pre>

<p><strong>互操作实践指南</strong></p>
<p>(1) ESM 引用 CJS 模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// CJS模块 (math.cjs)</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">add</span>: <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b,<br>  <span class="hljs-attr">PI</span>: <span class="hljs-number">3.14</span><br>&#125;;<br><br><span class="hljs-comment">// ESM引用</span><br><span class="hljs-keyword">import</span> math <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./math.cjs&#x27;</span>; <span class="hljs-comment">// 默认导入整个对象</span><br><span class="hljs-keyword">import</span> &#123; add &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./math.cjs&#x27;</span>; <span class="hljs-comment">// 命名导入 - 需要特殊处理</span><br><br><span class="hljs-comment">// 解决方案：CJS模块添加__esModule标记</span><br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>, <span class="hljs-string">&#x27;__esModule&#x27;</span>, &#123; <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> &#125;);<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">add</span>: <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b,<br>  <span class="hljs-attr">PI</span>: <span class="hljs-number">3.14</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p>(2) CJS 引用 ESM 模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ESM模块 (utils.mjs)</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">log</span> = msg =&gt; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(msg);<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123; <span class="hljs-attr">version</span>: <span class="hljs-string">&#x27;1.0&#x27;</span> &#125;;<br><br><span class="hljs-comment">// CJS引用</span><br><span class="hljs-keyword">const</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./utils.mjs&#x27;</span>); <span class="hljs-comment">// 得到 &#123; default: &#123;...&#125;, log: fn &#125;</span><br><br><span class="hljs-comment">// 正确使用方式</span><br><span class="hljs-keyword">const</span> &#123; log &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./utils.mjs&#x27;</span>);<br><span class="hljs-keyword">const</span> defaultExport = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./utils.mjs&#x27;</span>).<span class="hljs-property">default</span>;<br></code></pre></td></tr></table></figure>

<p>(3) AMD 与 ESM&#x2F;CJS 互操作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// AMD定义模块</span><br><span class="hljs-title function_">define</span>([<span class="hljs-string">&#x27;require&#x27;</span>, <span class="hljs-string">&#x27;exports&#x27;</span>], <span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-built_in">require</span>, <span class="hljs-built_in">exports</span></span>) &#123;<br>  <span class="hljs-built_in">exports</span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// 引用ESM模块</span><br>    <span class="hljs-keyword">const</span> esModule = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./es-module&#x27;</span>);<br>    esModule.<span class="hljs-title function_">hello</span>();<br>  &#125;<br>&#125;);<br><br><span class="hljs-comment">// Webpack配置支持AMD</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">libraryTarget</span>: <span class="hljs-string">&#x27;amd&#x27;</span> <span class="hljs-comment">// 设置输出格式</span><br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>企业级实践案例</strong></p>
<p>(1) 渐进迁移策略</p>
<pre class="mermaid">graph LR
  A[旧AMD系统] --> B[包装为UMD]
  B --> C[新ESM模块]
  C --> D[逐步替换]
  
  subgraph 迁移过程
    B --> E[Webpack配置兼容]
    E --> F[同时支持AMD/ESM]
  end</pre>

<p>(2) 微前端架构中的应用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 主应用（ESM）</span><br><span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;child-app/cjs-module&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">module</span> =&gt;</span> &#123;<br>  <span class="hljs-variable language_">module</span>.<span class="hljs-title function_">init</span>();<br>&#125;);<br><br><span class="hljs-comment">// 子应用Webpack配置</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">library</span>: &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;commonjs2&#x27;</span> <span class="hljs-comment">// 输出CJS格式</span><br>    &#125;<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>常见问题解决方案</strong></p>
<p>(1) __esModule 标记缺失</p>
<p>症状：命名导入CJS模块时报错</p>
<p>解决：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// babel-plugin-transform-esm-to-cjs</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">plugins</span>: [<br>    [<span class="hljs-string">&#x27;@babel/transform-modules-commonjs&#x27;</span>, &#123;<br>      <span class="hljs-attr">strictMode</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 自动添加__esModule标记</span><br>    &#125;]<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) ESM 中动态导入 CJS</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 正确方式</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getModule</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> cjsModule = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./legacy.cjs&#x27;</span>);<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cjsModule.<span class="hljs-property">default</span>); <span class="hljs-comment">// 访问默认导出</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>最佳实践总结</strong></p>
<ul>
<li>统一模块规范：<ul>
<li>新项目使用ESM</li>
<li>旧项目逐步迁移</li>
</ul>
</li>
<li>构建配置：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">resolve</span>: &#123;<br>    <span class="hljs-attr">mainFields</span>: [<br>      <span class="hljs-string">&#x27;browser&#x27;</span>, <br>      <span class="hljs-string">&#x27;module&#x27;</span>, <span class="hljs-comment">// 优先ESM</span><br>      <span class="hljs-string">&#x27;main&#x27;</span>    <span class="hljs-comment">// 其次CJS</span><br>    ]<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>
<ul>
<li>代码质量：<ul>
<li>使用ESLint规则检测混用问题</li>
</ul>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JSON"><span class="hljs-comment">// .eslintrc</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;no-restricted-syntax&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-string">&quot;error&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;selector&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;CallExpression[callee.name=&#x27;require&#x27;]&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;请使用import语法&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<h3 id="1-3-2-Tree-Shaking深层原理（sideEffects标志）"><a href="#1-3-2-Tree-Shaking深层原理（sideEffects标志）" class="headerlink" title="1.3.2 Tree Shaking深层原理（sideEffects标志）"></a>1.3.2 Tree Shaking深层原理（<code>sideEffects</code>标志）</h3><p><strong>Tree Shaking 的本质与限制</strong></p>
<p>核心原理图解：</p>
<pre class="mermaid">graph LR
  A[原始代码] --> B[构建依赖图]
  B --> C[标记使用导出]
  C --> D[删除未使用代码]
  D --> E[优化后代码]</pre>

<p>技术前提条件：</p>
<ul>
<li>必须使用 ES Module 语法（import&#x2F;export）</li>
<li>模块依赖关系必须是静态可分析的</li>
<li>编译工具需支持（Webpack&#x2F;Rollup等）</li>
</ul>
<p>CommonJS 的限制：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 无法被Tree Shaking的CommonJS示例</span><br><span class="hljs-keyword">const</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./utils&#x27;</span>); <span class="hljs-comment">// 动态引入</span><br><span class="hljs-keyword">const</span> &#123; usedFunc &#125; = utils;       <span class="hljs-comment">// 无法静态分析</span><br></code></pre></td></tr></table></figure>

<p><strong>sideEffects 标志的深层机制</strong></p>
<p>配置方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// package.json</span><br>&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;my-package&quot;</span>,<br>  <span class="hljs-string">&quot;sideEffects&quot;</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 整个包无副作用</span><br>  <span class="hljs-comment">// 或指定有副作用的文件</span><br>  <span class="hljs-string">&quot;sideEffects&quot;</span>: [<br>    <span class="hljs-string">&quot;*.css&quot;</span>,<br>    <span class="hljs-string">&quot;src/polyfills.js&quot;</span><br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>

<p>副作用类型分析：</p>
<table>
<thead>
<tr>
<th align="left">副作用类型</th>
<th align="left">示例</th>
<th align="left">处理方式</th>
</tr>
</thead>
<tbody><tr>
<td align="left">函数调用副作用</td>
<td align="left"><code>window.APP_CONFIG = &#123;&#125;</code></td>
<td align="left">标记为有副作用</td>
</tr>
<tr>
<td align="left">CSS 导入副作用</td>
<td align="left"><code>import &#39;./styles.css&#39;</code></td>
<td align="left">需显式声明</td>
</tr>
<tr>
<td align="left">Polyfill 副作用</td>
<td align="left"><code>import &#39;core-js/stable&#39;</code></td>
<td align="left">需显式声明</td>
</tr>
<tr>
<td align="left">纯函数</td>
<td align="left"><code>export const add = (a,b) =&gt; a+b</code></td>
<td align="left">安全删除未使用</td>
</tr>
</tbody></table>
<p><strong>Webpack 的 Tree Shaking 处理流程</strong></p>
<p>完整处理流程：</p>
<pre class="mermaid">graph TD
  A[收集所有导出] --> B[标记使用导出]
  B --> C{是否有sideEffects标记?}
  C -->|无| D[删除未使用导出]
  C -->|有| E[分析具体副作用]
  E --> F{副作用是否被使用?}
  F -->|是| G[保留整个模块]
  F -->|否| H[删除整个模块]</pre>

<p>关键优化阶段：</p>
<ul>
<li>HarmonyExport：识别ESM导出</li>
<li>FlagDependencyUsage：标记依赖</li>
<li>SideEffectsFlag：处理副作用</li>
<li>MangleExports：混淆导出名称</li>
<li>InnerGraph：内部依赖分析（Webpack 5）</li>
</ul>
<p><strong>sideEffects 实战配置指南</strong></p>
<p>(1) 库开发者配置</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JSON"><span class="hljs-comment">// 组件库的package.json</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;sideEffects&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-string">&quot;**/*.css&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/*.scss&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;esm/index.js&quot;</span><span class="hljs-punctuation">,</span>    <span class="hljs-comment">// 入口文件可能有副作用</span><br>    <span class="hljs-string">&quot;src/setupTests.js&quot;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>(2) 应用开发者配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// webpack.config.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">mode</span>: <span class="hljs-string">&#x27;production&#x27;</span>,<br>  <span class="hljs-attr">optimization</span>: &#123;<br>    <span class="hljs-attr">usedExports</span>: <span class="hljs-literal">true</span>,   <span class="hljs-comment">// 启用标记</span><br>    <span class="hljs-attr">sideEffects</span>: <span class="hljs-literal">true</span>,   <span class="hljs-comment">// 启用副作用分析</span><br>    <span class="hljs-attr">minimize</span>: <span class="hljs-literal">true</span>,      <span class="hljs-comment">// 启用代码压缩</span><br>    <span class="hljs-attr">innerGraph</span>: <span class="hljs-literal">true</span>     <span class="hljs-comment">// 启用深度分析（Webpack 5）</span><br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>Tree Shaking 失效场景分析</strong></p>
<table>
<thead>
<tr>
<th align="left">失效场景</th>
<th align="left">原因分析</th>
<th align="left">解决方案</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Babel 转译ESM</td>
<td align="left">转为CJS丢失静态特性</td>
<td align="left">保留ESM语法</td>
</tr>
<tr>
<td align="left">动态导入模式</td>
<td align="left">import()非静态分析</td>
<td align="left">重构为静态导入</td>
</tr>
<tr>
<td align="left">副作用模块未声明</td>
<td align="left">CSS文件未声明副作用</td>
<td align="left">正确配置sideEffects</td>
</tr>
<tr>
<td align="left">对象属性访问</td>
<td align="left"><code>obj[dynamicKey]</code></td>
<td align="left">使用纯函数重构</td>
</tr>
<tr>
<td align="left">模块再导出</td>
<td align="left"><code>export * from &#39;./utils&#39;</code></td>
<td align="left">使用命名导出export { func }</td>
</tr>
</tbody></table>
<p>特殊案例：第三方库优化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 优化lodash导入</span><br><span class="hljs-keyword">import</span> &#123; debounce &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lodash-es&#x27;</span>; <span class="hljs-comment">// 正确</span><br><span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lodash&#x27;</span>;               <span class="hljs-comment">// 错误（整个包被引入）</span><br>_.<span class="hljs-title function_">debounce</span>();                         <span class="hljs-comment">// Tree Shaking失效</span><br></code></pre></td></tr></table></figure>

<p><strong>高级优化策略</strong></p>
<p>(1) 作用域提升（Scope Hoisting）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 优化前</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> b = <span class="hljs-number">2</span>;<br><br><span class="hljs-comment">// 优化后</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>, b = <span class="hljs-number">2</span>; <span class="hljs-comment">// 减少模块封装代码</span><br></code></pre></td></tr></table></figure>

<p>(2) 纯注解标记</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">/*#__PURE__*/</span> <br><span class="hljs-keyword">const</span> element = <span class="hljs-title function_">createElement</span>(); <span class="hljs-comment">// 明确标记无副作用</span><br><br><span class="hljs-comment">// 或使用JSDoc</span><br><span class="hljs-comment">/** @__PURE__ */</span><br><span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyClass</span>();<br></code></pre></td></tr></table></figure>

<p><strong>面试重点解析</strong></p>
<p>(1) 为什么CSS需要特殊处理？</p>
<ol>
<li>CSS导入语法：<code>import &#39;./styles.css&#39;</code></li>
<li>没有显式导出变量</li>
<li>Webpack无法判断是否被使用</li>
<li>需通过<code>sideEffects</code>显式声明：”sideEffects”: [“*.css”]</li>
</ol>
<p>(2) 如何验证Tree Shaking生效？</p>
<p>验证步骤：</p>
<ul>
<li>添加测试导出函数</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// utils.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">used</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">/*...*/</span> &#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">unused</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">/*...*/</span> &#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>只导入使用函数</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span> &#123; used &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./utils&#x27;</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>检查输出bundle：<ul>
<li>搜索 unused 函数是否存在</li>
<li>使用Webpack分析工具验证</li>
</ul>
</li>
</ul>
<p>(3) Webpack 5的Tree Shaking改进？</p>
<p>核心改进：</p>
<ul>
<li>Nested Tree Shaking：嵌套导出分析</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> nested = &#123;<br>  <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,<br>  <span class="hljs-attr">b</span>: <span class="hljs-number">2</span><br>&#125;<br><span class="hljs-comment">// 仅使用nested.a时删除b属性</span><br></code></pre></td></tr></table></figure>

<ul>
<li>Inner Graph：内部依赖追踪</li>
<li>CommonJS Tree Shaking：基础CJS支持</li>
<li>深度作用域分析：变量级删除</li>
</ul>
<h1 id="二、核心编译流程与扩展"><a href="#二、核心编译流程与扩展" class="headerlink" title="二、核心编译流程与扩展"></a>二、核心编译流程与扩展</h1><h2 id="2-1-Loader机制"><a href="#2-1-Loader机制" class="headerlink" title="2.1 Loader机制"></a>2.1 Loader机制</h2><h3 id="2-1-1-链式调用与执行顺序"><a href="#2-1-1-链式调用与执行顺序" class="headerlink" title="2.1.1 链式调用与执行顺序"></a>2.1.1 链式调用与执行顺序</h3><p><strong>Loader 的本质</strong></p>
<p>Loader本质上是导出为函数的JavaScript模块，webpack内部的loader runner会调用该函数，并将上一个loader的输出结果作为参数传给该函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// Loader 基本结构</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source, map, meta</span>) &#123;<br>  <span class="hljs-comment">// 1. 对源代码进行处理</span><br>  <span class="hljs-keyword">const</span> transformed = <span class="hljs-title function_">transform</span>(source);<br>  <br>  <span class="hljs-comment">// 2. 返回处理结果（支持多种格式）</span><br>  <span class="hljs-keyword">return</span> transformed; <br>  <br>  <span class="hljs-comment">// 或返回多个值</span><br>  <span class="hljs-comment">// this.callback(null, transformed, map, meta);</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>链式调用原理</strong></p>
<p>执行流程示意图：</p>
<pre class="mermaid">graph LR
  A[源文件] --> B[Loader1]
  B --> C[Loader2]
  C --> D[Loader3]
  D --> E[处理结果]
  
  subgraph 执行方向
    direction LR
    F[从右到左执行] --> G[从下到上传递]
  end</pre>

<p>执行顺序规则：</p>
<table>
<thead>
<tr>
<th align="left">配置位置</th>
<th align="left">执行顺序</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">配置数组最后</td>
<td align="left">最先执行</td>
<td align="left">use: [‘style-loader’]</td>
</tr>
<tr>
<td align="left">配置数组中间</td>
<td align="left">中间执行</td>
<td align="left">use: [‘css-loader’]</td>
</tr>
<tr>
<td align="left">配置数组最前</td>
<td align="left">最后执行</td>
<td align="left">use: [‘sass-loader’]</td>
</tr>
</tbody></table>
<p>**完整执行流程分析</p>
<p>(1) 文件处理流程</p>
<pre class="mermaid">graph TB
  A[源文件] --> B[Sass-loader]
  B --> |1.编译SCSS| C[CSS-loader]
  C --> |"2.处理@import/url"| D[PostCSS-loader]
  D --> |3.自动添加前缀| E[Style-loader]
  E --> |4.注入DOM| F[最终JS输出]</pre>

<p>(2) 数据传递机制</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 示例：SCSS文件处理流程</span><br><span class="hljs-comment">// 原始数据流</span><br>sass-<span class="hljs-title function_">loader</span>(scss) → css-<span class="hljs-title function_">loader</span>(css) → postcss-<span class="hljs-title function_">loader</span>(css) → style-<span class="hljs-title function_">loader</span>(js)<br><br><span class="hljs-comment">// 各阶段输出：</span><br><span class="hljs-comment">// sass-loader: CSS文本</span><br><span class="hljs-comment">// css-loader: JS模块代码</span><br><span class="hljs-comment">// postcss-loader: 优化后的CSS文本</span><br><span class="hljs-comment">// style-loader: 带DOM操作的JS代码</span><br></code></pre></td></tr></table></figure>

<p><strong>控制执行顺序的技巧</strong></p>
<p>(1) 配置优先级</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// webpack.config.js</span><br><span class="hljs-attr">module</span>: &#123;<br>  <span class="hljs-attr">rules</span>: [<br>    &#123;<br>      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.scss$/</span>,<br>      <span class="hljs-attr">use</span>: [<br>        <span class="hljs-string">&#x27;style-loader&#x27;</span>,  <span class="hljs-comment">// 最后执行（最先放入数组）</span><br>        &#123;<br>          <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;css-loader&#x27;</span>,<br>          <span class="hljs-attr">options</span>: &#123; <span class="hljs-attr">importLoaders</span>: <span class="hljs-number">2</span> &#125; <span class="hljs-comment">// 声明前置loader数量</span><br>        &#125;,<br>        <span class="hljs-string">&#x27;postcss-loader&#x27;</span>, <span class="hljs-comment">// 中间执行</span><br>        <span class="hljs-string">&#x27;sass-loader&#x27;</span>     <span class="hljs-comment">// 最先执行（最后放入数组）</span><br>      ]<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) 使用 enforce 强制排序</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-attr">rules</span>: [<br>  &#123;<br>    <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,<br>    <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;eslint-loader&#x27;</span>,<br>    <span class="hljs-attr">enforce</span>: <span class="hljs-string">&#x27;pre&#x27;</span>, <span class="hljs-comment">// 强制最先执行</span><br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,<br>    <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;babel-loader&#x27;</span> <span class="hljs-comment">// 默认顺序</span><br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,<br>    <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;style-loader&#x27;</span>, <br>    <span class="hljs-attr">enforce</span>: <span class="hljs-string">&#x27;post&#x27;</span> <span class="hljs-comment">// 强制最后执行</span><br>  &#125;<br>]<br></code></pre></td></tr></table></figure>

<p>(3) Loader Pitch</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">//每个 Loader 可定义一个 pitch 方法，Webpack 在真正处理模块内容前会从左向右执行所有 Loader 的 pitch 函数</span><br><span class="hljs-comment">// 当某个 Loader 的 pitch 函数返回非 undefined 值时，会触发熔断效果：</span><br><span class="hljs-comment">// 1.跳过后续所有 Loader 的 pitch 和正常执行</span><br><span class="hljs-comment">// 2.直接返回当前 pitch 的结果作为模块内容</span><br><span class="hljs-comment">// loaderB.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">pitch</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;console.log(&quot;Skipped by B pitch!&quot;);&#x27;</span>; <span class="hljs-comment">// 返回字符串</span><br>&#125;;<br><br><span class="hljs-comment">// 执行流程：</span><br><span class="hljs-comment">//   Pitch A → Pitch B (返回结果) → 跳过 Pitch C 和所有 Loader 执行</span><br><span class="hljs-comment">//   ↓</span><br><span class="hljs-comment">//   Webpack 直接将返回的字符串作为模块源码</span><br></code></pre></td></tr></table></figure>

<p><strong>特殊场景处理</strong></p>
<p>(1) 前置依赖处理（importLoaders）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// CSS中引用其他资源</span><br><span class="hljs-comment">/* index.css */</span><br>@<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;./reset.css&#x27;</span>; <span class="hljs-comment">// 需要重新走loader流程</span><br><br><span class="hljs-comment">// 配置保证@import正确处理</span><br>&#123;<br>  <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;css-loader&#x27;</span>,<br>  <span class="hljs-attr">options</span>: &#123;<br>    <span class="hljs-attr">importLoaders</span>: <span class="hljs-number">2</span> <span class="hljs-comment">// 指定前置2个loader</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Loader 执行上下文</strong></p>
<p>(1) 关键上下文属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) &#123;<br>  <span class="hljs-comment">// 1. 获取配置选项</span><br>  <span class="hljs-keyword">const</span> options = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getOptions</span>();<br>  <br>  <span class="hljs-comment">// 2. 异步回调处理</span><br>  <span class="hljs-keyword">const</span> callback = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">async</span>();<br>  <br>  <span class="hljs-comment">// 3. 资源路径信息</span><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">resourcePath</span>); <span class="hljs-comment">// 完整文件路径</span><br>  <br>  <span class="hljs-comment">// 4. 添加依赖监视</span><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addDependency</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">resourcePath</span> + <span class="hljs-string">&#x27;.map&#x27;</span>);<br>  <br>  <span class="hljs-comment">// 5. 缓存启用</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheable</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cacheable</span>();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) 异步Loader模式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 异步Loader示例</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) &#123;<br>  <span class="hljs-keyword">const</span> callback = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">async</span>();<br>  <br>  <span class="hljs-comment">// 模拟异步操作</span><br>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, source.<span class="hljs-title function_">replace</span>(<span class="hljs-string">&#x27;foo&#x27;</span>, <span class="hljs-string">&#x27;bar&#x27;</span>));<br>  &#125;, <span class="hljs-number">100</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>性能优化实践</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 避免不必要的Loader处理</span><br>&#123;<br>  <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,<br>  <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span>,<br>  <span class="hljs-attr">use</span>: [<br>    &#123;<br>      <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;babel-loader&#x27;</span>,<br>      <span class="hljs-attr">options</span>: &#123;<br>        <span class="hljs-attr">cacheDirectory</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 启用缓存</span><br>      &#125;<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>常见问题解决方案</strong></p>
<p>(1) Loader执行顺序错误</p>
<p>症状：样式未正确应用</p>
<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 正确顺序</span><br><span class="hljs-attr">use</span>: [<br>  <span class="hljs-title class_">MiniCssExtractPlugin</span>.<span class="hljs-property">loader</span>, <span class="hljs-comment">// 替代style-loader</span><br>  &#123;<br>    <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;css-loader&#x27;</span>,<br>    <span class="hljs-attr">options</span>: &#123; <span class="hljs-attr">importLoaders</span>: <span class="hljs-number">1</span> &#125;<br>  &#125;,<br>  <span class="hljs-string">&#x27;postcss-loader&#x27;</span> <span class="hljs-comment">// 先于css-loader执行</span><br>]<br></code></pre></td></tr></table></figure>

<p>(2) Loader未生效</p>
<p>排查步骤：</p>
<ul>
<li>检查Loader是否配置到正确规则</li>
<li>验证文件路径是否匹配test正则</li>
<li>检查Loader是否支持输入格式</li>
<li>在Loader函数中添加日志调试</li>
</ul>
<p><strong>Loader设计原则</strong></p>
<p>(1) 单一职责原则</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 避免</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">allInOneLoader</span>(<span class="hljs-params">source</span>) &#123;<br>  <span class="hljs-comment">// 处理TypeScript + SCSS + 压缩...</span><br>&#125;<br><br><span class="hljs-comment">// 推荐</span><br><span class="hljs-comment">// ts-loader → sass-loader → css-loader → minify-loader</span><br></code></pre></td></tr></table></figure>

<p>(2) 链式可组合</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 良好设计的Loader输出格式</span><br><span class="hljs-comment">// 文本Loader：输入/输出字符串</span><br><span class="hljs-comment">// JS Loader：输入/输出JS模块</span><br><span class="hljs-comment">// 文件Loader：输入/输出文件路径</span><br><span class="hljs-comment">// 最后一个loader的输出结果应该为String或Buffer类型</span><br></code></pre></td></tr></table></figure>

<p>(3) 无状态：不依赖全局状态，所有配置通过options传递</p>
<p>(4) 幂等性：相同输入始终相同输出，避免使用随机值</p>
<p><strong>面试重点解析</strong></p>
<p>(1) Loader为什么从右向左执行？</p>
<p>设计原理：</p>
<ol>
<li>函数组合原理：<code>compose(f, g)(x) = f(g(x))</code></li>
<li>管道模型：输出作为下一个Loader输入</li>
<li>符合直觉顺序：原始文件 → 编译 → 处理 → 输出</li>
</ol>
<p>(2) 如何控制Loader执行顺序？</p>
<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 方法1：配置数组顺序</span><br><span class="hljs-attr">use</span>: [first, second, third] <span class="hljs-comment">// third → second → first</span><br><br><span class="hljs-comment">// 方法2：enforce强制排序</span><br><span class="hljs-attr">enforce</span>: <span class="hljs-string">&#x27;pre&#x27;</span> <span class="hljs-comment">// 最先执行</span><br><span class="hljs-attr">enforce</span>: <span class="hljs-string">&#x27;post&#x27;</span> <span class="hljs-comment">// 最后执行</span><br><br><span class="hljs-comment">// 方法3：rule顺序（同优先级）</span><br><span class="hljs-comment">// 后定义的rule先执行（从下往上）</span><br></code></pre></td></tr></table></figure>

<p>(3) Loader可以异步执行吗？</p>
<p>实现方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 方式1：返回Promise</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(source), <span class="hljs-number">100</span>);<br>  &#125;);<br>&#125;<br><br><span class="hljs-comment">// 方式2：使用this.async()</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) &#123;<br>  <span class="hljs-keyword">const</span> callback = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">async</span>();<br>  <span class="hljs-title function_">asyncProcess</span>(source, callback);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-1-2-手写Loader（代码转换-国际化处理案例）"><a href="#2-1-2-手写Loader（代码转换-国际化处理案例）" class="headerlink" title="2.1.2 手写Loader（代码转换&#x2F;国际化处理案例）"></a>2.1.2 手写Loader（代码转换&#x2F;国际化处理案例）</h3><p><strong>Loader 开发基础</strong></p>
<p>Loader 核心结构：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// loader基本模板</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source, sourceMap, meta</span>) &#123;<br>  <span class="hljs-comment">// 1. 获取配置选项</span><br>  <span class="hljs-keyword">const</span> options = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getOptions</span>() || &#123;&#125;;<br>  <br>  <span class="hljs-comment">// 2. 处理源代码</span><br>  <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">transform</span>(source, options);<br>  <br>  <span class="hljs-comment">// 3. 返回处理结果</span><br>  <span class="hljs-keyword">return</span> result;<br>  <br>  <span class="hljs-comment">// 或返回多个值</span><br>  <span class="hljs-comment">// this.callback(null, result, sourceMap, meta);</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>代码转换案例：HTML 模板处理</strong></p>
<p>(1) 需求场景</p>
<ul>
<li>将 HTML 中的 &lt;%&#x3D; variable %&gt; 替换为 JS 变量</li>
<li>支持条件语句 &lt;% if(cond) { %&gt;</li>
<li>输出可执行 JS 函数</li>
</ul>
<p>(2) 完整实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// html-template-loader.js</span><br><span class="hljs-keyword">const</span> &#123; compile &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;html-template-tag&#x27;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) &#123;<br>  <span class="hljs-comment">// 1. 提取模板变量</span><br>  <span class="hljs-keyword">const</span> variableRegex = <span class="hljs-regexp">/&lt;%=\s*([a-zA-Z_$][\w$]*)\s*%&gt;/g</span>;<br>  <span class="hljs-keyword">const</span> variables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();<br>  <span class="hljs-keyword">let</span> match;<br>  <br>  <span class="hljs-keyword">while</span> ((match = variableRegex.<span class="hljs-title function_">exec</span>(source)) !== <span class="hljs-literal">null</span>) &#123;<br>    variables.<span class="hljs-title function_">add</span>(match[<span class="hljs-number">1</span>]);<br>  &#125;<br>  <br>  <span class="hljs-comment">// 2. 生成函数参数</span><br>  <span class="hljs-keyword">const</span> params = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(variables).<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;, &#x27;</span>);<br>  <br>  <span class="hljs-comment">// 3. 编译为模板函数</span><br>  <span class="hljs-keyword">const</span> templateCode = <span class="hljs-title function_">compile</span>(source);<br>  <br>  <span class="hljs-comment">// 4. 生成最终函数</span><br>  <span class="hljs-keyword">const</span> output = <span class="hljs-string">`</span><br><span class="hljs-string">    export default function render(<span class="hljs-subst">$&#123;params&#125;</span>) &#123;</span><br><span class="hljs-string">      return \`<span class="hljs-subst">$&#123;templateCode&#125;</span>\`;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">  `</span>;<br>  <br>  <span class="hljs-keyword">return</span> output;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>(3) 使用示例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// webpack配置</span><br><span class="hljs-attr">module</span>: &#123;<br>  <span class="hljs-attr">rules</span>: [<br>    &#123;<br>      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.html$/</span>,<br>      <span class="hljs-attr">use</span>: &#123;<br>        <span class="hljs-attr">loader</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;html-template-loader.js&#x27;</span>)<br>      &#125;<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>国际化处理案例：i18n 文本替换</strong></p>
<p>(1) 需求场景</p>
<ul>
<li>提取代码中的 __(“key”) 调用</li>
<li>根据语言配置替换为对应文本</li>
<li>支持动态插值 __(“welcome”, { name: user })</li>
</ul>
<p>(2) 完整实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// i18n-loader.js</span><br><span class="hljs-keyword">const</span> &#123; transform &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@babel/core&#x27;</span>);<br><span class="hljs-keyword">const</span> parser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@babel/parser&#x27;</span>);<br><span class="hljs-keyword">const</span> traverse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@babel/traverse&#x27;</span>).<span class="hljs-property">default</span>;<br><span class="hljs-keyword">const</span> generate = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@babel/generator&#x27;</span>).<span class="hljs-property">default</span>;<br><span class="hljs-keyword">const</span> t = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@babel/types&#x27;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) &#123;<br>  <span class="hljs-keyword">const</span> options = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getOptions</span>();<br>  <span class="hljs-keyword">const</span> locale = options.<span class="hljs-property">locale</span> || <span class="hljs-string">&#x27;en&#x27;</span>;<br>  <span class="hljs-keyword">const</span> messages = options.<span class="hljs-property">messages</span> || &#123;&#125;;<br>  <br>  <span class="hljs-comment">// 解析AST</span><br>  <span class="hljs-keyword">const</span> ast = parser.<span class="hljs-title function_">parse</span>(source, &#123;<br>    <span class="hljs-attr">sourceType</span>: <span class="hljs-string">&#x27;module&#x27;</span>,<br>    <span class="hljs-attr">plugins</span>: [<span class="hljs-string">&#x27;jsx&#x27;</span>]<br>  &#125;);<br>  <br>  <span class="hljs-comment">// 遍历AST查找__()调用</span><br>  <span class="hljs-title function_">traverse</span>(ast, &#123;<br>    <span class="hljs-title class_">CallExpression</span>(path) &#123;<br>      <span class="hljs-keyword">if</span> (t.<span class="hljs-title function_">isIdentifier</span>(path.<span class="hljs-property">node</span>.<span class="hljs-property">callee</span>, &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;__&#x27;</span> &#125;)) &#123;<br>        <span class="hljs-keyword">const</span> args = path.<span class="hljs-property">node</span>.<span class="hljs-property">arguments</span>;<br>        <br>        <span class="hljs-comment">// 验证第一个参数是字符串</span><br>        <span class="hljs-keyword">if</span> (args.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp; t.<span class="hljs-title function_">isStringLiteral</span>(args[<span class="hljs-number">0</span>])) &#123;<br>          <span class="hljs-keyword">const</span> key = args[<span class="hljs-number">0</span>].<span class="hljs-property">value</span>;<br>          <br>          <span class="hljs-comment">// 获取翻译文本</span><br>          <span class="hljs-keyword">const</span> translation = messages[locale]?.[key] || key;<br>          <br>          <span class="hljs-comment">// 处理插值</span><br>          <span class="hljs-keyword">if</span> (args.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span> &amp;&amp; t.<span class="hljs-title function_">isObjectExpression</span>(args[<span class="hljs-number">1</span>])) &#123;<br>            <span class="hljs-keyword">const</span> props = args[<span class="hljs-number">1</span>].<span class="hljs-property">properties</span>;<br>            <span class="hljs-keyword">let</span> template = translation;<br>            <br>            props.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">prop</span> =&gt;</span> &#123;<br>              <span class="hljs-keyword">const</span> varName = prop.<span class="hljs-property">key</span>.<span class="hljs-property">name</span>;<br>              template = template.<span class="hljs-title function_">replace</span>(<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`\\&#123;<span class="hljs-subst">$&#123;varName&#125;</span>\\&#125;`</span>, <span class="hljs-string">&#x27;g&#x27;</span>),<br>                <span class="hljs-string">`\$&#123;<span class="hljs-subst">$&#123;varName&#125;</span>&#125;`</span><br>              );<br>            &#125;);<br>            <br>            <span class="hljs-comment">// 替换为模板字符串</span><br>            path.<span class="hljs-title function_">replaceWith</span>(t.<span class="hljs-title function_">templateLiteral</span>(<br>              [t.<span class="hljs-title function_">templateElement</span>(&#123; <span class="hljs-attr">raw</span>: template, <span class="hljs-attr">cooked</span>: template &#125;)],<br>              props.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">prop</span> =&gt;</span> t.<span class="hljs-title function_">identifier</span>(prop.<span class="hljs-property">key</span>.<span class="hljs-property">name</span>))<br>            ));<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// 直接替换为文本</span><br>            path.<span class="hljs-title function_">replaceWith</span>(t.<span class="hljs-title function_">stringLiteral</span>(translation));<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;);<br>  <br>  <span class="hljs-comment">// 生成代码</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">generate</span>(ast).<span class="hljs-property">code</span>;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>(3) 配置示例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// webpack.config.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">module</span>: &#123;<br>    <span class="hljs-attr">rules</span>: [<br>      &#123;<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.jsx?$/</span>,<br>        <span class="hljs-attr">use</span>: &#123;<br>          <span class="hljs-attr">loader</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;i18n-loader.js&#x27;</span>),<br>          <span class="hljs-attr">options</span>: &#123;<br>            <span class="hljs-attr">locale</span>: <span class="hljs-string">&#x27;zh-CN&#x27;</span>,<br>            <span class="hljs-attr">messages</span>: &#123;<br>              <span class="hljs-string">&#x27;zh-CN&#x27;</span>: &#123;<br>                <span class="hljs-string">&#x27;welcome&#x27;</span>: <span class="hljs-string">&#x27;欢迎，&#123;name&#125;！&#x27;</span>,<br>                <span class="hljs-string">&#x27;logout&#x27;</span>: <span class="hljs-string">&#x27;退出登录&#x27;</span><br>              &#125;,<br>              <span class="hljs-attr">en</span>: &#123;<br>                <span class="hljs-string">&#x27;welcome&#x27;</span>: <span class="hljs-string">&#x27;Welcome, &#123;name&#125;!&#x27;</span>,<br>                <span class="hljs-string">&#x27;logout&#x27;</span>: <span class="hljs-string">&#x27;Logout&#x27;</span><br>              &#125;<br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    ]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Loader 高级功能实现</strong></p>
<p>(1) 缓存与性能优化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) &#123;<br>  <span class="hljs-comment">// 启用缓存</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cacheable</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cacheable</span>();<br>  <br>  <span class="hljs-comment">// 添加文件依赖</span><br>  <span class="hljs-keyword">const</span> i18nFile = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;locales.json&#x27;</span>);<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addDependency</span>(i18nFile);<br>  <br>  <span class="hljs-comment">// 异步处理</span><br>  <span class="hljs-keyword">const</span> callback = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">async</span>();<br>  <br>  fs.<span class="hljs-title function_">readFile</span>(i18nFile, <span class="hljs-string">&#x27;utf-8&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(err);<br>    <br>    <span class="hljs-keyword">const</span> messages = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data);<br>    <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">process</span>(source, messages);<br>    <br>    <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, result);<br>  &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>(2) Source Map 支持</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source, sourceMap</span>) &#123;<br>  <span class="hljs-comment">// 生成新Source Map</span><br>  <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">transform</span>(source);<br>  <br>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, result.<span class="hljs-property">code</span>, result.<span class="hljs-property">map</span>);<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>企业级案例：安全过滤Loader</strong></p>
<p>(1) 需求场景</p>
<ul>
<li>过滤生产环境中的调试代码</li>
<li>移除 console.debug 调用</li>
<li>删除 @test-only 标记的代码块</li>
</ul>
<p>(2) 完整实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// secure-loader.js</span><br><span class="hljs-keyword">const</span> parser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@babel/parser&#x27;</span>);<br><span class="hljs-keyword">const</span> traverse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@babel/traverse&#x27;</span>).<span class="hljs-property">default</span>;<br><span class="hljs-keyword">const</span> generate = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@babel/generator&#x27;</span>).<span class="hljs-property">default</span>;<br><span class="hljs-keyword">const</span> t = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@babel/types&#x27;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) &#123;<br>  <span class="hljs-comment">// 仅在生产环境启用</span><br>  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">&#x27;production&#x27;</span>) &#123;<br>    <span class="hljs-keyword">return</span> source;<br>  &#125;<br><br>  <span class="hljs-keyword">const</span> ast = parser.<span class="hljs-title function_">parse</span>(source, &#123;<br>    <span class="hljs-attr">sourceType</span>: <span class="hljs-string">&#x27;module&#x27;</span>,<br>    <span class="hljs-attr">plugins</span>: [<span class="hljs-string">&#x27;jsx&#x27;</span>, <span class="hljs-string">&#x27;typescript&#x27;</span>]<br>  &#125;);<br><br>  <span class="hljs-title function_">traverse</span>(ast, &#123;<br>    <span class="hljs-comment">// 移除console.debug</span><br>    <span class="hljs-title class_">CallExpression</span>(path) &#123;<br>      <span class="hljs-keyword">if</span> (t.<span class="hljs-title function_">isMemberExpression</span>(path.<span class="hljs-property">node</span>.<span class="hljs-property">callee</span>) &amp;&amp;<br>          t.<span class="hljs-title function_">isIdentifier</span>(path.<span class="hljs-property">node</span>.<span class="hljs-property">callee</span>.<span class="hljs-property">object</span>, &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;console&#x27;</span> &#125;) &amp;&amp;<br>          t.<span class="hljs-title function_">isIdentifier</span>(path.<span class="hljs-property">node</span>.<span class="hljs-property">callee</span>.<span class="hljs-property">property</span>, &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;debug&#x27;</span> &#125;)) &#123;<br>        path.<span class="hljs-title function_">remove</span>();<br>      &#125;<br>    &#125;,<br>    <br>    <span class="hljs-comment">// 移除@test-only标记代码块</span><br>    <span class="hljs-title class_">BlockStatement</span>(path) &#123;<br>      <span class="hljs-keyword">const</span> comments = path.<span class="hljs-property">node</span>.<span class="hljs-property">innerComments</span> || [];<br>      <span class="hljs-keyword">if</span> (comments.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.<span class="hljs-property">value</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;@test-only&#x27;</span>))) &#123;<br>        path.<span class="hljs-title function_">remove</span>();<br>      &#125;<br>    &#125;,<br>    <br>    <span class="hljs-comment">// 移除debugger语句</span><br>    <span class="hljs-title class_">DebuggerStatement</span>(path) &#123;<br>      path.<span class="hljs-title function_">remove</span>();<br>    &#125;<br>  &#125;);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">generate</span>(ast).<span class="hljs-property">code</span>;<br>&#125;;<br></code></pre></td></tr></table></figure>

<h3 id="2-1-3-性能优化：Loader缓存、多进程编译（thread-loader）"><a href="#2-1-3-性能优化：Loader缓存、多进程编译（thread-loader）" class="headerlink" title="2.1.3 性能优化：Loader缓存、多进程编译（thread-loader）"></a>2.1.3 性能优化：Loader缓存、多进程编译（<code>thread-loader</code>）</h3><p><strong>Loader 性能瓶颈分析</strong></p>
<p>常见性能问题：</p>
<table>
<thead>
<tr>
<th align="left">问题类型</th>
<th align="left">表现特征</th>
<th align="left">影响程度</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CPU密集型Loader</td>
<td align="left">Babel&#x2F;TypeScript编译慢</td>
<td align="left">高</td>
</tr>
<tr>
<td align="left">IO密集型Loader</td>
<td align="left">文件读取&#x2F;网络请求</td>
<td align="left">中</td>
</tr>
<tr>
<td align="left">重复计算</td>
<td align="left">相同文件反复处理</td>
<td align="left">高</td>
</tr>
<tr>
<td align="left">单线程阻塞</td>
<td align="left">无法利用多核CPU</td>
<td align="left">极高</td>
</tr>
</tbody></table>
<p>性能影响量化：</p>
<pre class="mermaid">graph LR
  A[构建时间] --> B[Loader处理]
  B --> C[CPU密集型 60%]
  B --> D[IO操作 30%]
  B --> E[其他 10%]</pre>

<p><strong>Loader 缓存优化方案</strong></p>
<p>(1) cache-loader 工作原理</p>
<pre class="mermaid">graph TB
  A[源文件] --> B[cache-loader]
  B --> C{缓存是否存在?}
  C -->|是| D[读取缓存结果]
  C -->|否| E[执行后续Loader]
  E --> F[保存结果到缓存]
  F --> G[返回处理结果]</pre>

<p>(2) 配置示例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// webpack.config.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">module</span>: &#123;<br>    <span class="hljs-attr">rules</span>: [<br>      &#123;<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,<br>        <span class="hljs-attr">use</span>: [<br>          &#123;<br>            <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;cache-loader&#x27;</span>,<br>            <span class="hljs-attr">options</span>: &#123;<br>              <span class="hljs-attr">cacheDirectory</span>: <span class="hljs-string">&#x27;./.cache/loader&#x27;</span>, <span class="hljs-comment">// 缓存路径</span><br>              <span class="hljs-attr">cacheIdentifier</span>: <span class="hljs-string">&#x27;v1&#x27;</span>, <span class="hljs-comment">// 缓存版本标识</span><br>            &#125;<br>          &#125;,<br>          <span class="hljs-string">&#x27;babel-loader&#x27;</span><br>        ]<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,<br>        <span class="hljs-attr">use</span>: [<br>          <span class="hljs-string">&#x27;style-loader&#x27;</span>,<br>          <span class="hljs-string">&#x27;cache-loader&#x27;</span>,<br>          <span class="hljs-string">&#x27;css-loader&#x27;</span>,<br>          <span class="hljs-string">&#x27;postcss-loader&#x27;</span><br>        ]<br>      &#125;<br>    ]<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>(3) 缓存策略对比</p>
<table>
<thead>
<tr>
<th align="left">方案</th>
<th align="left">适用场景</th>
<th align="left">优点</th>
<th align="left">缺点</th>
</tr>
</thead>
<tbody><tr>
<td align="left">cache-loader</td>
<td align="left">通用Loader</td>
<td align="left">配置简单</td>
<td align="left">额外I&#x2F;O开销</td>
</tr>
<tr>
<td align="left">babel-loader缓存</td>
<td align="left">Babel专用</td>
<td align="left">零配置</td>
<td align="left">仅适用Babel</td>
</tr>
<tr>
<td align="left">自定义文件缓存</td>
<td align="left">特殊需求</td>
<td align="left">灵活控制</td>
<td align="left">开发成本高</td>
</tr>
</tbody></table>
<p><strong>多进程编译：thread-loader</strong></p>
<p>架构原理：</p>
<pre class="mermaid">graph LR
  A[主进程] --> B[创建Worker池]
  B --> C[Worker 1]
  B --> D[Worker 2]
  B --> E[Worker 3]
  C --> F[处理文件1]
  D --> G[处理文件2]
  E --> H[处理文件3]</pre>

<p>完整配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">module</span>: &#123;<br>    <span class="hljs-attr">rules</span>: [<br>      &#123;<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,<br>        <span class="hljs-attr">use</span>: [<br>          &#123;<br>            <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;thread-loader&#x27;</span>,<br>            <span class="hljs-attr">options</span>: &#123;<br>              <span class="hljs-attr">workers</span>: <span class="hljs-number">4</span>, <span class="hljs-comment">// CPU核心数-1</span><br>              <span class="hljs-attr">workerParallelJobs</span>: <span class="hljs-number">50</span>,<br>              <span class="hljs-attr">poolTimeout</span>: <span class="hljs-number">2000</span>,<br>              <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;js-pool&#x27;</span><br>            &#125;<br>          &#125;,<br>          <span class="hljs-string">&#x27;babel-loader&#x27;</span><br>        ]<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,<br>        <span class="hljs-attr">use</span>: [<br>          <span class="hljs-string">&#x27;style-loader&#x27;</span>,<br>          &#123;<br>            <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;thread-loader&#x27;</span>,<br>            <span class="hljs-attr">options</span>: &#123;<br>              <span class="hljs-attr">workers</span>: <span class="hljs-number">2</span>,<br>              <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;css-pool&#x27;</span><br>            &#125;<br>          &#125;,<br>          <span class="hljs-string">&#x27;css-loader&#x27;</span>,<br>          <span class="hljs-string">&#x27;postcss-loader&#x27;</span><br>        ]<br>      &#125;<br>    ]<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>性能优化组合拳：缓存 + 多进程方案</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 最佳实践配置</span><br><span class="hljs-attr">use</span>: [<br>  <span class="hljs-string">&#x27;cache-loader&#x27;</span>,<br>  &#123;<br>    <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;thread-loader&#x27;</span>,<br>    <span class="hljs-attr">options</span>: &#123;<br>      <span class="hljs-attr">workers</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;os&#x27;</span>).<span class="hljs-title function_">cpus</span>().<span class="hljs-property">length</span> - <span class="hljs-number">1</span><br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&#x27;babel-loader&#x27;</span><br>]<br></code></pre></td></tr></table></figure>

<p><strong>高级优化策略</strong></p>
<p>(1) Worker 池共享</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// shared-pool.js</span><br><span class="hljs-keyword">const</span> threadLoader = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;thread-loader&#x27;</span>);<br><br><span class="hljs-comment">// 预热线程池</span><br>threadLoader.<span class="hljs-title function_">warmup</span>(<br>  &#123;<br>    <span class="hljs-attr">workers</span>: <span class="hljs-number">4</span>,<br>    <span class="hljs-attr">poolTimeout</span>: <span class="hljs-title class_">Infinity</span><br>  &#125;,<br>  [<span class="hljs-string">&#x27;babel-loader&#x27;</span>, <span class="hljs-string">&#x27;@babel/preset-env&#x27;</span>]<br>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">pool</span>: &#123;<br>    <span class="hljs-attr">workers</span>: <span class="hljs-number">4</span><br>  &#125;<br>&#125;;<br><br><span class="hljs-comment">// webpack.config.js</span><br><span class="hljs-keyword">const</span> &#123; pool &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./shared-pool&#x27;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">module</span>: &#123;<br>    <span class="hljs-attr">rules</span>: [<br>      &#123;<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,<br>        <span class="hljs-attr">use</span>: [<br>          &#123; <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;thread-loader&#x27;</span>, <span class="hljs-attr">options</span>: pool &#125;,<br>          <span class="hljs-string">&#x27;babel-loader&#x27;</span><br>        ]<br>      &#125;<br>    ]<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>(2) 智能任务分配</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 根据文件大小选择方案</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) &#123;<br>  <span class="hljs-keyword">const</span> fileSize = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">byteLength</span>(source);<br>  <br>  <span class="hljs-comment">// 小文件直接处理</span><br>  <span class="hljs-keyword">if</span> (fileSize &lt; <span class="hljs-number">1024</span> * <span class="hljs-number">10</span>) &#123; <span class="hljs-comment">// &lt; 10KB</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">processSmallFile</span>(source);<br>  &#125;<br>  <br>  <span class="hljs-comment">// 大文件使用Worker线程</span><br>  <span class="hljs-keyword">const</span> callback = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">async</span>();<br>  workerPool.<span class="hljs-title function_">run</span>(&#123; source &#125;, <span class="hljs-function">(<span class="hljs-params">err, result</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">callback</span>(err, result);<br>  &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>性能监控与调优</strong></p>
<p>(1) 构建分析工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1. 安装速度分析插件</span><br>npm install --save-dev speed-measure-webpack-plugin<br></code></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 2. 配置使用</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">SpeedMeasurePlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;speed-measure-webpack-plugin&#x27;</span>);<br><span class="hljs-keyword">const</span> smp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpeedMeasurePlugin</span>();<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = smp.<span class="hljs-title function_">wrap</span>(&#123;<br>  <span class="hljs-comment">// webpack配置</span><br>&#125;);<br></code></pre></td></tr></table></figure>

<p>(2) 优化决策树</p>
<pre class="mermaid">graph TD
  A[构建速度慢?] --> B{主要瓶颈类型}
  B --> C[CPU密集型] --> D[添加thread-loader]
  B --> E[IO密集型] --> F[添加cache-loader]
  B --> G[重复计算] --> H[启用持久化缓存]
  
  D --> I[Worker数量=CPU核心数-1]
  F --> J[缓存目录分离]
  H --> K[Webpack5持久化缓存]</pre>

<p><strong>常见问题解决方案</strong></p>
<p>(1) 缓存失效</p>
<p>症状：修改文件后未更新</p>
<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// cache-loader配置</span><br>&#123;<br>  <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;cache-loader&#x27;</span>,<br>  <span class="hljs-attr">options</span>: &#123;<br>    <span class="hljs-attr">cacheIdentifier</span>: <span class="hljs-string">`v2-<span class="hljs-subst">$&#123;process.env.NODE_ENV&#125;</span>`</span>, <span class="hljs-comment">// 添加环境变量</span><br>    <span class="hljs-attr">cacheDirectory</span>: <span class="hljs-string">&#x27;./.cache/$&#123;projectName&#125;&#x27;</span> <span class="hljs-comment">// 项目隔离</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) Worker内存泄漏</p>
<p>诊断：构建后进程未退出</p>
<p>解决：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript">&#123;<br>  <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;thread-loader&#x27;</span>,<br>  <span class="hljs-attr">options</span>: &#123;<br>    <span class="hljs-attr">poolTimeout</span>: <span class="hljs-number">2000</span> <span class="hljs-comment">// 超时自动关闭</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="2-2-Plugin系统"><a href="#2-2-Plugin系统" class="headerlink" title="2.2 Plugin系统"></a>2.2 Plugin系统</h2><p>webpack插件是一个具有 apply 方法的 JavaScript 类。apply 方法会被 webpack compiler 调用，并且在 整个 编译生命周期都可以访问 compiler 对象，插件目的在于解决 loader 无法实现的其他事，包括：打包优化，资源管理，注入环境变量。</p>
<h3 id="2-2-1-Compiler与Compilation对象生命周期"><a href="#2-2-1-Compiler与Compilation对象生命周期" class="headerlink" title="2.2.1 Compiler与Compilation对象生命周期"></a>2.2.1 Compiler与Compilation对象生命周期</h3><p><strong>核心对象关系图谱</strong></p>
<pre class="mermaid">graph TD
  A[Compiler] -->|创建| B[Compilation]
  B -->|模块处理| C[Module]
  C -->|依赖解析| D[Dependency]
  B -->|资源生成| E[Chunk]
  E -->|输出| F[Asset]
  
  subgraph 生命周期流程
    G[初始化] --> H[编译]
    H --> I[优化]
    I --> J[输出]
  end</pre>

<p><strong>Compiler对象深度解析</strong></p>
<p>Compiler核心职责：</p>
<ul>
<li>Webpack环境的总控制器</li>
<li>维护完整的配置信息</li>
<li>启动和停止构建过程</li>
<li>监听文件系统变化</li>
</ul>
<p>Compiler生命周期钩子：</p>
<table>
<thead>
<tr>
<th align="left">钩子名称</th>
<th align="left">触发时机</th>
<th align="left">类型</th>
<th align="left">典型应用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">initialize</td>
<td align="left">初始化时</td>
<td align="left">sync</td>
<td align="left">插件初始化</td>
</tr>
<tr>
<td align="left">run</td>
<td align="left">开始构建前</td>
<td align="left">async</td>
<td align="left">环境准备</td>
</tr>
<tr>
<td align="left">watchRun</td>
<td align="left">监听模式启动</td>
<td align="left">async</td>
<td align="left">开发服务器</td>
</tr>
<tr>
<td align="left">beforeRun</td>
<td align="left">实际构建前</td>
<td align="left">async</td>
<td align="left">清理操作</td>
</tr>
<tr>
<td align="left">compile</td>
<td align="left">创建Compilation前</td>
<td align="left">sync</td>
<td align="left">修改编译参数</td>
</tr>
<tr>
<td align="left">make</td>
<td align="left">编译阶段开始</td>
<td align="left">parallel</td>
<td align="left">添加entry</td>
</tr>
<tr>
<td align="left">emit</td>
<td align="left">生成资源前</td>
<td align="left">async</td>
<td align="left">修改输出文件</td>
</tr>
<tr>
<td align="left">afterEmit</td>
<td align="left">资源输出后</td>
<td align="left">async</td>
<td align="left">清理临时文件</td>
</tr>
<tr>
<td align="left">done</td>
<td align="left">构建完成</td>
<td align="left">async</td>
<td align="left">输出统计信息</td>
</tr>
<tr>
<td align="left">failed</td>
<td align="left">构建失败</td>
<td align="left">sync</td>
<td align="left">错误处理</td>
</tr>
</tbody></table>
<p><strong>Compilation对象深度解析</strong></p>
<p>Compilation核心职责：</p>
<ul>
<li>单次构建过程的控制器</li>
<li>维护模块依赖图</li>
<li>优化chunks结构</li>
<li>生成最终资源文件</li>
</ul>
<p>Compilation生命周期钩子：</p>
<table>
<thead>
<tr>
<th align="left">钩子名称</th>
<th align="left">触发时机</th>
<th align="left">类型</th>
<th align="left">典型应用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">buildModule</td>
<td align="left">模块构建前</td>
<td align="left">sync</td>
<td align="left">修改模块源码</td>
</tr>
<tr>
<td align="left">succeedModule</td>
<td align="left">模块构建成功</td>
<td align="left">sync</td>
<td align="left">模块分析</td>
</tr>
<tr>
<td align="left">finishModules</td>
<td align="left">所有模块完成</td>
<td align="left">sync</td>
<td align="left">依赖分析</td>
</tr>
<tr>
<td align="left">seal</td>
<td align="left">开始封装chunks</td>
<td align="left">sync</td>
<td align="left">修改chunk分组</td>
</tr>
<tr>
<td align="left">optimizeDependencies</td>
<td align="left">优化依赖</td>
<td align="left">sync</td>
<td align="left">删除未使用模块</td>
</tr>
<tr>
<td align="left">optimize</td>
<td align="left">优化阶段开始</td>
<td align="left">sync</td>
<td align="left">自定义优化</td>
</tr>
<tr>
<td align="left">optimizeModules</td>
<td align="left">优化模块</td>
<td align="left">sync</td>
<td align="left">模块级优化</td>
</tr>
<tr>
<td align="left">optimizeChunks</td>
<td align="left">优化chunks</td>
<td align="left">sync</td>
<td align="left">拆分&#x2F;合并chunk</td>
</tr>
<tr>
<td align="left">optimizeTree</td>
<td align="left">优化依赖树</td>
<td align="left">async</td>
<td align="left">高级优化</td>
</tr>
<tr>
<td align="left">optimizeChunkModules</td>
<td align="left">优化chunk中模块</td>
<td align="left">async</td>
<td align="left">模块级压缩</td>
</tr>
<tr>
<td align="left">optimizeAssets</td>
<td align="left">优化资源</td>
<td align="left">async</td>
<td align="left">资源压缩</td>
</tr>
<tr>
<td align="left">processAssets</td>
<td align="left">处理资源</td>
<td align="left">async</td>
<td align="left">资源修改</td>
</tr>
</tbody></table>
<p><strong>完整生命周期流程图</strong></p>
<pre class="mermaid">sequenceDiagram
  participant C as Compiler
  participant Cp as Compilation
  participant M as Module
  participant D as Dependencies

  C->>C: initialize
  C->>C: run
  C->>C: beforeRun
  C->>C: compile
  C->>Cp: 创建Compilation
  Cp->>Cp: addEntry
  Cp->>M: buildModule
  M->>D: 解析依赖
  D->>M: 递归添加新模块
  loop 所有模块
    Cp->>M: processModule
  end
  Cp->>Cp: finishModules
  Cp->>Cp: seal
  Cp->>Cp: optimizeDependencies
  Cp->>Cp: createChunks
  Cp->>Cp: optimizeChunks
  Cp->>Cp: optimizeAssets
  C->>C: emit
  C->>C: afterEmit
  Cp->>C: 报告统计信息
  C->>C: done</pre>

<p><strong>面试重点解析</strong></p>
<p>Compiler和Compilation的区别？</p>
<ul>
<li>职责范围：<ul>
<li>Compiler：全局控制器，负责整个Webpack环境的生命周期</li>
<li>Compilation：单次构建过程的控制器</li>
</ul>
</li>
<li>生命周期：<ul>
<li>Compiler：从启动到关闭持续存在</li>
<li>Compilation：每次构建时创建，构建结束后销毁</li>
</ul>
</li>
<li>数据存储：<ul>
<li>Compiler：存储全局配置、插件状态</li>
<li>Compilation：存储模块图、chunks、资源</li>
</ul>
</li>
</ul>
<h3 id="2-2-2-手写Plugin（资源注入-构建分析案例）"><a href="#2-2-2-手写Plugin（资源注入-构建分析案例）" class="headerlink" title="2.2.2 手写Plugin（资源注入&#x2F;构建分析案例）"></a>2.2.2 手写Plugin（资源注入&#x2F;构建分析案例）</h3><p><strong>Plugin 核心机制</strong></p>
<p>插件基本结构：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPlugin</span> &#123;<br>  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) &#123;<br>    <span class="hljs-comment">// 1. 注册生命周期钩子</span><br>    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">someHook</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&#x27;MyPlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">params</span>) =&gt;</span> &#123;<br>      <span class="hljs-comment">// 2. 处理逻辑</span><br>    &#125;);<br>    <br>    <span class="hljs-comment">// 3. 异步钩子处理</span><br>    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">tapAsync</span>(<span class="hljs-string">&#x27;MyPlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">compilation, callback</span>) =&gt;</span> &#123;<br>      <span class="hljs-comment">// 4. 操作compilation</span><br>      <span class="hljs-title function_">callback</span>(); <span class="hljs-comment">// 必须调用</span><br>    &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>资源注入案例：版本信息注入</strong></p>
<p>需求场景：</p>
<ul>
<li>在打包文件中添加构建版本号</li>
<li>自动生成构建时间戳</li>
<li>注入Git提交信息</li>
</ul>
<p>完整实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> &#123; execSync &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>);<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">VersionInfoPlugin</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options = &#123;&#125;</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">filename</span> = options.<span class="hljs-property">filename</span> || <span class="hljs-string">&#x27;version.json&#x27;</span>;<br>  &#125;<br>  <br>  <span class="hljs-title function_">getGitInfo</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-attr">branch</span>: <span class="hljs-title function_">execSync</span>(<span class="hljs-string">&#x27;git rev-parse --abbrev-ref HEAD&#x27;</span>).<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">trim</span>(),<br>        <span class="hljs-attr">commit</span>: <span class="hljs-title function_">execSync</span>(<span class="hljs-string">&#x27;git rev-parse HEAD&#x27;</span>).<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">7</span>),<br>        <span class="hljs-attr">date</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()<br>      &#125;;<br>    &#125; <span class="hljs-keyword">catch</span> &#123;<br>      <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;Git not available&#x27;</span> &#125;;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) &#123;<br>    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&#x27;VersionInfoPlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> versionInfo = &#123;<br>        <span class="hljs-attr">buildTime</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),<br>        <span class="hljs-attr">version</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">VERSION</span> || <span class="hljs-string">&#x27;1.0.0&#x27;</span>,<br>        <span class="hljs-attr">env</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span>,<br>        <span class="hljs-attr">git</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getGitInfo</span>()<br>      &#125;;<br>      <br>      <span class="hljs-comment">// 将版本信息转为JSON</span><br>      <span class="hljs-keyword">const</span> json = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(versionInfo, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>);<br>      <br>      <span class="hljs-comment">// 添加到资源列表</span><br>      compilation.<span class="hljs-property">assets</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">filename</span>] = &#123;<br>        <span class="hljs-attr">source</span>: <span class="hljs-function">() =&gt;</span> json,<br>        <span class="hljs-attr">size</span>: <span class="hljs-function">() =&gt;</span> json.<span class="hljs-property">length</span><br>      &#125;;<br>    &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>使用示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// webpack.config.js</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">VersionInfoPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./version-info-plugin&#x27;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">VersionInfoPlugin</span>(&#123;<br>      <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;build-info.json&#x27;</span><br>    &#125;)<br>  ]<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>构建分析案例：模块依赖报告</strong></p>
<p>需求场景：</p>
<ul>
<li>生成模块依赖关系图</li>
<li>统计模块大小分布</li>
<li>识别大型模块</li>
</ul>
<p>完整实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BundleAnalyzerPlugin</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options = &#123;&#125;</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">filename</span> = options.<span class="hljs-property">filename</span> || <span class="hljs-string">&#x27;module-report.html&#x27;</span>;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">threshold</span> = options.<span class="hljs-property">threshold</span> || <span class="hljs-number">100</span>; <span class="hljs-comment">// KB</span><br>  &#125;<br><br>  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) &#123;<br>    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">done</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&#x27;BundleAnalyzerPlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">stats</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> json = stats.<span class="hljs-title function_">toJson</span>();<br>      <span class="hljs-keyword">const</span> modules = json.<span class="hljs-property">modules</span>;<br>      <br>      <span class="hljs-comment">// 1. 收集模块数据</span><br>      <span class="hljs-keyword">const</span> moduleData = modules.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">module</span> =&gt;</span> (&#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-variable language_">module</span>.<span class="hljs-property">id</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-variable language_">module</span>.<span class="hljs-property">name</span>,<br>        <span class="hljs-attr">size</span>: <span class="hljs-variable language_">module</span>.<span class="hljs-property">size</span>,<br>        <span class="hljs-attr">chunks</span>: <span class="hljs-variable language_">module</span>.<span class="hljs-property">chunks</span>,<br>        <span class="hljs-attr">reasons</span>: <span class="hljs-variable language_">module</span>.<span class="hljs-property">reasons</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-property">moduleName</span>)<br>      &#125;));<br>      <br>      <span class="hljs-comment">// 2. 生成HTML报告</span><br>      <span class="hljs-keyword">const</span> html = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateReport</span>(moduleData);<br>      <br>      <span class="hljs-comment">// 3. 写入输出目录</span><br>      <span class="hljs-keyword">const</span> outputPath = path.<span class="hljs-title function_">join</span>(<br>        stats.<span class="hljs-property">compilation</span>.<span class="hljs-property">outputOptions</span>.<span class="hljs-property">path</span>, <br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">filename</span><br>      );<br>      fs.<span class="hljs-title function_">writeFileSync</span>(outputPath, html);<br>    &#125;);<br>  &#125;<br>  <br>  <span class="hljs-title function_">generateReport</span>(<span class="hljs-params">modules</span>) &#123;<br>    <span class="hljs-comment">// 过滤大型模块</span><br>    <span class="hljs-keyword">const</span> largeModules = modules.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> m.<span class="hljs-property">size</span> &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">threshold</span> * <span class="hljs-number">1024</span>);<br>    <br>    <span class="hljs-comment">// 生成HTML内容</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;!DOCTYPE html&gt;</span><br><span class="hljs-string">&lt;html&gt;</span><br><span class="hljs-string">&lt;head&gt;</span><br><span class="hljs-string">  &lt;title&gt;Bundle Analysis Report&lt;/title&gt;</span><br><span class="hljs-string">  &lt;style&gt;</span><br><span class="hljs-string">    table &#123; border-collapse: collapse; width: 100%; &#125;</span><br><span class="hljs-string">    th, td &#123; border: 1px solid #ddd; padding: 8px; &#125;</span><br><span class="hljs-string">    tr:nth-child(even) &#123; background-color: #f2f2f2; &#125;</span><br><span class="hljs-string">  &lt;/style&gt;</span><br><span class="hljs-string">&lt;/head&gt;</span><br><span class="hljs-string">&lt;body&gt;</span><br><span class="hljs-string">  &lt;h1&gt;Bundle Analysis Report&lt;/h1&gt;</span><br><span class="hljs-string">  </span><br><span class="hljs-string">  &lt;h2&gt;Large Modules (&gt;<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.threshold&#125;</span>KB)&lt;/h2&gt;</span><br><span class="hljs-string">  &lt;table&gt;</span><br><span class="hljs-string">    &lt;tr&gt;&lt;th&gt;Module&lt;/th&gt;&lt;th&gt;Size (KB)&lt;/th&gt;&lt;th&gt;Dependencies&lt;/th&gt;&lt;/tr&gt;</span><br><span class="hljs-string">    <span class="hljs-subst">$&#123;largeModules.map(m =&gt; <span class="hljs-string">`</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">      &lt;tr&gt;</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">        &lt;td&gt;<span class="hljs-subst">$&#123;m.name&#125;</span>&lt;/td&gt;</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">        &lt;td&gt;<span class="hljs-subst">$&#123;(m.size / <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">2</span>)&#125;</span>&lt;/td&gt;</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">        &lt;td&gt;<span class="hljs-subst">$&#123;m.reasons.join(<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>)&#125;</span>&lt;/td&gt;</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">      &lt;/tr&gt;</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">    `</span>).join(<span class="hljs-string">&#x27;&#x27;</span>)&#125;</span></span><br><span class="hljs-string">  &lt;/table&gt;</span><br><span class="hljs-string">  </span><br><span class="hljs-string">  &lt;h2&gt;All Modules&lt;/h2&gt;</span><br><span class="hljs-string">  &lt;table&gt;</span><br><span class="hljs-string">    &lt;tr&gt;&lt;th&gt;Module&lt;/th&gt;&lt;th&gt;Size (KB)&lt;/th&gt;&lt;/tr&gt;</span><br><span class="hljs-string">    <span class="hljs-subst">$&#123;modules.map(m =&gt; <span class="hljs-string">`</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">      &lt;tr&gt;</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">        &lt;td&gt;<span class="hljs-subst">$&#123;m.name&#125;</span>&lt;/td&gt;</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">        &lt;td&gt;<span class="hljs-subst">$&#123;(m.size / <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">2</span>)&#125;</span>&lt;/td&gt;</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">      &lt;/tr&gt;</span></span></span><br><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">    `</span>).join(<span class="hljs-string">&#x27;&#x27;</span>)&#125;</span></span><br><span class="hljs-string">  &lt;/table&gt;</span><br><span class="hljs-string">&lt;/body&gt;</span><br><span class="hljs-string">&lt;/html&gt;`</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>高级插件开发技巧</strong></p>
<p>(1) 多钩子协同工作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AdvancedPlugin</span> &#123;<br>  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) &#123;<br>    <span class="hljs-comment">// 编译开始前准备数据</span><br>    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">beforeRun</span>.<span class="hljs-title function_">tapAsync</span>(<span class="hljs-string">&#x27;AdvancedPlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">compiler, callback</span>) =&gt;</span> &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span> = <span class="hljs-title function_">fetchData</span>();<br>      <span class="hljs-title function_">callback</span>();<br>    &#125;);<br>    <br>    <span class="hljs-comment">// 处理模块</span><br>    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">compilation</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&#x27;AdvancedPlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> &#123;<br>      compilation.<span class="hljs-property">hooks</span>.<span class="hljs-property">buildModule</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&#x27;AdvancedPlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params"><span class="hljs-variable language_">module</span></span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">module</span>.<span class="hljs-property">useCache</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">has</span>(<span class="hljs-variable language_">module</span>.<span class="hljs-property">id</span>);<br>      &#125;);<br>    &#125;);<br>    <br>    <span class="hljs-comment">// 资源输出</span><br>    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&#x27;AdvancedPlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> &#123;<br>      compilation.<span class="hljs-property">assets</span>[<span class="hljs-string">&#x27;cache-info.json&#x27;</span>] = &#123;<br>        <span class="hljs-attr">source</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-property">stats</span>),<br>        <span class="hljs-attr">size</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-property">stats</span>).<span class="hljs-property">length</span><br>      &#125;;<br>    &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) 跨插件通信</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 插件A：提供数据</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataProviderPlugin</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = &#123;&#125;;<br>  &#125;<br>  <br>  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) &#123;<br>    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">thisCompilation</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&#x27;DataProviderPlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> &#123;<br>      compilation.<span class="hljs-property">dataProvider</span> = <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// 暴露接口</span><br>    &#125;);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 插件B：使用数据</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataConsumerPlugin</span> &#123;<br>  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) &#123;<br>    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">compilation</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&#x27;DataConsumerPlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (compilation.<span class="hljs-property">dataProvider</span>) &#123;<br>        <span class="hljs-keyword">const</span> data = compilation.<span class="hljs-property">dataProvider</span>.<span class="hljs-property">data</span>;<br>        <span class="hljs-comment">// 使用数据...</span><br>      &#125;<br>    &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>插件调试与测试</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;webpack&#x27;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">MemoryFS</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;memory-fs&#x27;</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">runWebpack</span>(<span class="hljs-params">config</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> compiler = <span class="hljs-title function_">webpack</span>(config);<br>    <span class="hljs-keyword">const</span> fs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MemoryFS</span>();<br>    compiler.<span class="hljs-property">outputFileSystem</span> = fs;<br>    <br>    compiler.<span class="hljs-title function_">run</span>(<span class="hljs-function">(<span class="hljs-params">err, stats</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(err);<br>      <span class="hljs-title function_">resolve</span>(&#123; stats, fs &#125;);<br>    &#125;);<br>  &#125;);<br>&#125;<br><br><span class="hljs-comment">// 测试用例</span><br><span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;VersionInfoPlugin generates file&#x27;</span>, <span class="hljs-title function_">async</span> () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> config = &#123;<br>    <span class="hljs-attr">plugins</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">VersionInfoPlugin</span>()]<br>  &#125;;<br>  <br>  <span class="hljs-keyword">const</span> &#123; fs &#125; = <span class="hljs-keyword">await</span> <span class="hljs-title function_">runWebpack</span>(config);<br>  <span class="hljs-title function_">expect</span>(fs.<span class="hljs-title function_">existsSync</span>(<span class="hljs-string">&#x27;/dist/version.json&#x27;</span>)).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);<br>  <br>  <span class="hljs-keyword">const</span> content = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;/dist/version.json&#x27;</span>));<br>  <span class="hljs-title function_">expect</span>(content).<span class="hljs-title function_">toHaveProperty</span>(<span class="hljs-string">&#x27;buildTime&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>性能优化策略</strong></p>
<p>(1) 避免阻塞钩子</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 错误：在同步钩子中执行I/O操作</span><br>compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">compilation</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&#x27;MyPlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> data = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;large-data.json&#x27;</span>); <span class="hljs-comment">// 阻塞操作</span><br>&#125;);<br><br><span class="hljs-comment">// 正确：异步处理</span><br>compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">beforeRun</span>.<span class="hljs-title function_">tapAsync</span>(<span class="hljs-string">&#x27;MyPlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">compiler, callback</span>) =&gt;</span> &#123;<br>  fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">&#x27;large-data.json&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(err);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = data;<br>    <span class="hljs-title function_">callback</span>();<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure>

<p>(2) 缓存计算结果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CachedPlugin</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span> = <span class="hljs-literal">null</span>;<br>  &#125;<br>  <br>  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) &#123;<br>    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">thisCompilation</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&#x27;CachedPlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span> = <span class="hljs-title function_">heavyCalculation</span>(); <span class="hljs-comment">// 只计算一次</span><br>      &#125;<br>      compilation.<span class="hljs-property">cache</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>;<br>    &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>最佳实践指南</strong></p>
<p>(1) 插件设计原则</p>
<table>
<thead>
<tr>
<th align="left">原则</th>
<th align="left">说明</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">单一职责</td>
<td align="left">一个插件只做一件事</td>
<td align="left">分离资源注入和构建分析</td>
</tr>
<tr>
<td align="left">配置驱动</td>
<td align="left">通过选项控制行为</td>
<td align="left"><code>new Plugin(&#123; filename: &#39;report.html&#39; &#125;)</code></td>
</tr>
<tr>
<td align="left">错误处理</td>
<td align="left">妥善处理异常</td>
<td align="left">使用compilation.errors收集错误</td>
</tr>
<tr>
<td align="left">文档完善</td>
<td align="left">提供使用说明</td>
<td align="left">包含README和类型定义</td>
</tr>
</tbody></table>
<p>(2) 安全注意事项</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SafePlugin</span> &#123;<br>  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) &#123;<br>    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&#x27;SafePlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> &#123;<br>      <span class="hljs-comment">// 1. 避免修改原始资源</span><br>      <span class="hljs-keyword">const</span> asset = compilation.<span class="hljs-property">assets</span>[<span class="hljs-string">&#x27;main.js&#x27;</span>];<br>      <span class="hljs-keyword">const</span> newSource = <span class="hljs-title function_">transform</span>(asset.<span class="hljs-title function_">source</span>()); <span class="hljs-comment">// 创建副本</span><br>      <br>      <span class="hljs-comment">// 2. 添加新资源</span><br>      compilation.<span class="hljs-property">assets</span>[<span class="hljs-string">&#x27;main-safe.js&#x27;</span>] = newSource;<br>      <br>      <span class="hljs-comment">// 3. 错误处理</span><br>      <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-title function_">riskyOperation</span>();<br>      &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>        compilation.<span class="hljs-property">errors</span>.<span class="hljs-title function_">push</span>(err);<br>      &#125;<br>    &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>面试重点解析</strong></p>
<p>(1) Plugin与Loader的区别？</p>
<table>
<thead>
<tr>
<th align="left">维度</th>
<th align="left">Loader</th>
<th align="left">Plugin</th>
</tr>
</thead>
<tbody><tr>
<td align="left">功能范围</td>
<td align="left">模块级别转换</td>
<td align="left">构建流程控制</td>
</tr>
<tr>
<td align="left">运行时机</td>
<td align="left">模块加载时</td>
<td align="left">整个构建生命周期</td>
</tr>
<tr>
<td align="left">使用方式</td>
<td align="left">配置在module.rules</td>
<td align="left">配置在plugins数组</td>
</tr>
<tr>
<td align="left">操作对象</td>
<td align="left">单个文件内容</td>
<td align="left">Compiler&#x2F;Compilation对象</td>
</tr>
<tr>
<td align="left">典型应用</td>
<td align="left">编译JSX、转换SCSS</td>
<td align="left">资源优化、环境注入、报告生成</td>
</tr>
</tbody></table>
<p>(2) 如何实现资源压缩插件？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MinifyPlugin</span> &#123;<br>  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) &#123;<br>    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&#x27;MinifyPlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> &#123;<br>      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(compilation.<span class="hljs-property">assets</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (name.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">&#x27;.js&#x27;</span>)) &#123;<br>          <span class="hljs-keyword">const</span> source = compilation.<span class="hljs-property">assets</span>[name].<span class="hljs-title function_">source</span>();<br>          <span class="hljs-keyword">const</span> minified = <span class="hljs-title function_">minify</span>(source); <span class="hljs-comment">// 压缩实现</span><br>          compilation.<span class="hljs-property">assets</span>[name] = &#123;<br>            <span class="hljs-attr">source</span>: <span class="hljs-function">() =&gt;</span> minified,<br>            <span class="hljs-attr">size</span>: <span class="hljs-function">() =&gt;</span> minified.<span class="hljs-property">length</span><br>          &#125;;<br>        &#125;<br>      &#125;);<br>    &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(3) 如何开发可配置的插件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurablePlugin</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options = &#123;&#125;</span>) &#123;<br>    <span class="hljs-comment">// 默认配置</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(&#123;<br>      <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;report.html&#x27;</span>,<br>      <span class="hljs-attr">threshold</span>: <span class="hljs-number">100</span>,<br>      <span class="hljs-attr">include</span>: <span class="hljs-regexp">/\.js$/</span><br>    &#125;, options);<br>  &#125;<br><br>  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) &#123;<br>    <span class="hljs-comment">// 使用this.options配置</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-3-常用插件原理剖析：HtmlWebpackPlugin-DefinePlugin"><a href="#2-2-3-常用插件原理剖析：HtmlWebpackPlugin-DefinePlugin" class="headerlink" title="2.2.3 常用插件原理剖析：HtmlWebpackPlugin &#x2F; DefinePlugin"></a>2.2.3 常用插件原理剖析：<code>HtmlWebpackPlugin</code> &#x2F; <code>DefinePlugin</code></h3><p><strong>HtmlWebpackPlugin 深度解析</strong></p>
<p>核心功能架构：</p>
<pre class="mermaid">graph TD
  A[入口配置] --> B[读取模板]
  B --> C[注入资源]
  C --> D[优化HTML]
  D --> E[生成HTML文件]
  
  subgraph 核心处理
    C1[资源注入] --> C2[Chunks映射]
    C3[变量替换] --> C4[模板渲染]
  end</pre>

<p>工作原理流程图：</p>
<pre class="mermaid">sequenceDiagram
  participant Webpack
  participant HtmlWebpackPlugin
  participant Compiler
  
  Webpack->>Compiler: 编译开始
  Compiler->>HtmlWebpackPlugin: 触发compilation事件
  HtmlWebpackPlugin->>HtmlWebpackPlugin: 初始化模板
  HtmlWebpackPlugin->>Compiler: 获取资源清单
  HtmlWebpackPlugin->>HtmlWebpackPlugin: 生成HTML内容
  HtmlWebpackPlugin->>Compiler: 添加HTML到资源
  Compiler->>Webpack: 输出HTML文件</pre>

<p><strong>HtmlWebpackPlugin 核心机制</strong></p>
<p>(1) 资源注入原理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 伪代码实现</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HtmlWebpackPlugin</span> &#123;<br>  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) &#123;<br>    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">tapAsync</span>(<span class="hljs-string">&#x27;HtmlWebpackPlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">compilation, callback</span>) =&gt;</span> &#123;<br>      <span class="hljs-comment">// 1. 获取所有资源文件</span><br>      <span class="hljs-keyword">const</span> assets = compilation.<span class="hljs-title function_">getAssets</span>();<br>      <br>      <span class="hljs-comment">// 2. 生成资源标签</span><br>      <span class="hljs-keyword">const</span> scripts = assets.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span> a.<span class="hljs-property">name</span>.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">&#x27;.js&#x27;</span>))<br>        .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span> <span class="hljs-string">`&lt;script src=&quot;<span class="hljs-subst">$&#123;a.name&#125;</span>&quot;&gt;&lt;/script&gt;`</span>);<br>      <br>      <span class="hljs-keyword">const</span> styles = assets.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span> a.<span class="hljs-property">name</span>.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">&#x27;.css&#x27;</span>))<br>        .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span> <span class="hljs-string">`&lt;link href=&quot;<span class="hljs-subst">$&#123;a.name&#125;</span>&quot; rel=&quot;stylesheet&quot;&gt;`</span>);<br>      <br>      <span class="hljs-comment">// 3. 读取模板</span><br>      <span class="hljs-keyword">const</span> template = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&#x27;template.html&#x27;</span>, <span class="hljs-string">&#x27;utf8&#x27;</span>);<br>      <br>      <span class="hljs-comment">// 4. 替换占位符</span><br>      <span class="hljs-keyword">const</span> html = template<br>        .<span class="hljs-title function_">replace</span>(<span class="hljs-string">&#x27;&lt;!-- scripts --&gt;&#x27;</span>, scripts.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>))<br>        .<span class="hljs-title function_">replace</span>(<span class="hljs-string">&#x27;&lt;!-- styles --&gt;&#x27;</span>, styles.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>));<br>      <br>      <span class="hljs-comment">// 5. 添加到资源列表</span><br>      compilation.<span class="hljs-property">assets</span>[<span class="hljs-string">&#x27;index.html&#x27;</span>] = &#123;<br>        <span class="hljs-attr">source</span>: <span class="hljs-function">() =&gt;</span> html,<br>        <span class="hljs-attr">size</span>: <span class="hljs-function">() =&gt;</span> html.<span class="hljs-property">length</span><br>      &#125;;<br>      <br>      <span class="hljs-title function_">callback</span>();<br>    &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) 多页面配置原理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 动态生成多页面配置</span><br><span class="hljs-keyword">const</span> pages = [<span class="hljs-string">&#x27;index&#x27;</span>, <span class="hljs-string">&#x27;about&#x27;</span>, <span class="hljs-string">&#x27;contact&#x27;</span>];<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">plugins</span>: pages.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">page</span> =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>(&#123;<br>    <span class="hljs-attr">template</span>: <span class="hljs-string">`./src/<span class="hljs-subst">$&#123;page&#125;</span>.html`</span>,<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;page&#125;</span>.html`</span>,<br>    <span class="hljs-attr">chunks</span>: [<span class="hljs-string">`<span class="hljs-subst">$&#123;page&#125;</span>`</span>] <span class="hljs-comment">// 仅注入当前页面chunk</span><br>  &#125;))<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>DefinePlugin 深度解析</strong></p>
<p>工作原理示意图：</p>
<pre class="mermaid">graph LR
  A[源码] --> B[DefinePlugin处理]
  B --> C{全局常量替换}
  C --> D[开发环境值]
  C --> E[生产环境值]
  D --> F[处理后的代码]
  E --> F</pre>

<p>源码替换过程：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 原始代码</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Environment: &quot;</span>, process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;API Key: &quot;</span>, <span class="hljs-variable constant_">API_KEY</span>);<br><br><span class="hljs-comment">// 经过DefinePlugin处理后</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Environment: &quot;</span>, <span class="hljs-string">&quot;development&quot;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;API Key: &quot;</span>, <span class="hljs-string">&quot;abc123xyz&quot;</span>);<br></code></pre></td></tr></table></figure>

<p><strong>DefinePlugin 核心机制</strong></p>
<p>(1) 实现原理剖析</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DefinePlugin</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">definitions</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">definitions</span> = definitions;<br>  &#125;<br><br>  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) &#123;<br>    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">compilation</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&#x27;DefinePlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> &#123;<br>      compilation.<span class="hljs-property">hooks</span>.<span class="hljs-property">normalModuleLoader</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&#x27;DefinePlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">loaderContext, <span class="hljs-variable language_">module</span></span>) =&gt;</span> &#123;<br>        <span class="hljs-comment">// 替换源代码中的标识符</span><br>        <span class="hljs-variable language_">module</span>.<span class="hljs-property">source</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-keyword">const</span> source = <span class="hljs-variable language_">module</span>.<span class="hljs-title function_">originalSource</span>();<br>          <span class="hljs-keyword">return</span> <span class="hljs-title function_">replaceIdentifiers</span>(source, <span class="hljs-variable language_">this</span>.<span class="hljs-property">definitions</span>);<br>        &#125;;<br>      &#125;);<br>    &#125;);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 标识符替换函数</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">replaceIdentifiers</span>(<span class="hljs-params">source, definitions</span>) &#123;<br>  <span class="hljs-keyword">let</span> code = source.<span class="hljs-title function_">source</span>();<br>  <br>  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(definitions).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> value = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(definitions[key]);<br>    <span class="hljs-keyword">const</span> regex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`\\b<span class="hljs-subst">$&#123;key&#125;</span>\\b`</span>, <span class="hljs-string">&#x27;g&#x27;</span>);<br>    code = code.<span class="hljs-title function_">replace</span>(regex, value);<br>  &#125;);<br>  <br>  <span class="hljs-keyword">return</span> code;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) 安全替换策略</p>
<table>
<thead>
<tr>
<th align="left">替换方式</th>
<th align="left">示例</th>
<th align="left">优点</th>
<th align="left">缺点</th>
</tr>
</thead>
<tbody><tr>
<td align="left">直接文本替换</td>
<td align="left"><code>API_KEY → &quot;abc123&quot;</code></td>
<td align="left">简单高效</td>
<td align="left">可能误替换变量</td>
</tr>
<tr>
<td align="left">作用域感知替换</td>
<td align="left"><code>process.env.NODE_ENV → &quot;production&quot;</code></td>
<td align="left">准确</td>
<td align="left">实现复杂</td>
</tr>
<tr>
<td align="left">AST级替换</td>
<td align="left">解析后替换标识符</td>
<td align="left">最安全</td>
<td align="left">性能开销大</td>
</tr>
</tbody></table>
<p><strong>企业级应用场景</strong></p>
<p>(1) 动态配置HtmlWebpackPlugin</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 根据环境生成不同配置</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>(&#123;<br>  <span class="hljs-attr">template</span>: <span class="hljs-string">&#x27;src/index.ejs&#x27;</span>,<br>  <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;index.html&#x27;</span>,<br>  <span class="hljs-attr">minify</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span> ? &#123;<br>    <span class="hljs-attr">collapseWhitespace</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">removeComments</span>: <span class="hljs-literal">true</span><br>  &#125; : <span class="hljs-literal">false</span>,<br>  <span class="hljs-attr">meta</span>: &#123;<br>    <span class="hljs-string">&#x27;og:image&#x27;</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span> <br>      ? <span class="hljs-string">&#x27;https://prod.cdn.com/logo.png&#x27;</span><br>      : <span class="hljs-string">&#x27;https://dev.cdn.com/logo.png&#x27;</span><br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>(2) 高级DefinePlugin配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">DefinePlugin</span>(&#123;<br>  <span class="hljs-comment">// 安全字符串化</span><br>  <span class="hljs-attr">__DEV__</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">&#x27;production&#x27;</span>),<br>  <br>  <span class="hljs-comment">// 计算值</span><br>  <span class="hljs-attr">__BUILD_DATE__</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()),<br>  <br>  <span class="hljs-comment">// 复杂对象</span><br>  <span class="hljs-attr">__APP_CONFIG__</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<br>    <span class="hljs-attr">apiEndpoint</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">API_URL</span> || <span class="hljs-string">&#x27;/api&#x27;</span>,<br>    <span class="hljs-attr">enableAnalytics</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span><br>  &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>

<p><strong>常见问题解决方案</strong></p>
<p>(1) HtmlWebpackPlugin 循环依赖问题</p>
<p>症状：Error: Cyclic dependency</p>
<p>原因：多个HTML模板相互引用</p>
<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 配置独立chunks</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>(&#123;<br>  <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;pageA.html&#x27;</span>,<br>  <span class="hljs-attr">chunks</span>: [<span class="hljs-string">&#x27;pageA&#x27;</span>] <span class="hljs-comment">// 仅包含当前页面chunk</span><br>&#125;)<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>(&#123;<br>  <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;pageB.html&#x27;</span>,<br>  <span class="hljs-attr">chunks</span>: [<span class="hljs-string">&#x27;pageB&#x27;</span>] <span class="hljs-comment">// 不包含pageA的chunk</span><br>&#125;)<br></code></pre></td></tr></table></figure>

<p>(2) DefinePlugin 替换不生效</p>
<p>诊断步骤：</p>
<ul>
<li>检查变量名是否完全匹配</li>
<li>确认是否被其他插件覆盖</li>
<li>验证环境变量是否传递正确</li>
<li>使用<code>console.log(__VARIABLE__)</code>调试</li>
</ul>
<p><strong>面试重点解析</strong></p>
<p>(1) HtmlWebpackPlugin如何实现多页面支持？</p>
<p>实现原理：</p>
<ul>
<li>根据配置创建多个实例</li>
<li>每个实例管理独立入口</li>
<li>通过chunks选项控制资源注入</li>
<li>共享模板引擎但隔离数据</li>
</ul>
<p>(2) DefinePlugin为什么比环境变量更安全？</p>
<p>安全优势：</p>
<ol>
<li>编译时替换：不暴露在运行时环境中</li>
<li>值优化：直接替换为字面量（如true而非字符串”true”）</li>
<li>作用域限定：只替换源代码中精确匹配的标识符</li>
<li>不可变：替换后无法在运行时修改</li>
</ol>
<p>(3) 如何自定义HtmlWebpackPlugin的模板？</p>
<p>实现方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 1. 使用EJS模板引擎</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>(&#123;<br>  <span class="hljs-attr">template</span>: <span class="hljs-string">&#x27;src/index.ejs&#x27;</span>,<br>  <span class="hljs-attr">templateParameters</span>: &#123;<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;自定义标题&#x27;</span><br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs HTML">&lt;!-- 2. 模板内容示例 --&gt;<br>&lt;!-- src/index.ejs --&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>  &lt;title&gt;&lt;%= htmlWebpackPlugin.options.title %&gt;&lt;/title&gt;<br>  &lt;%= htmlWebpackPlugin.tags.headTags %&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>  &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;<br>  &lt;%= htmlWebpackPlugin.tags.bodyTags %&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<h1 id="三、性能优化专项"><a href="#三、性能优化专项" class="headerlink" title="三、性能优化专项"></a>三、性能优化专项</h1><h2 id="3-1-构建速度优化"><a href="#3-1-构建速度优化" class="headerlink" title="3.1 构建速度优化"></a>3.1 构建速度优化</h2><h3 id="3-1-1-缓存策略：cache-loader-hard-source-webpack-plugin"><a href="#3-1-1-缓存策略：cache-loader-hard-source-webpack-plugin" class="headerlink" title="3.1.1 缓存策略：cache-loader&#x2F;hard-source-webpack-plugin"></a>3.1.1 缓存策略：<code>cache-loader</code>&#x2F;<code>hard-source-webpack-plugin</code></h3><p><strong>构建缓存核心原理</strong></p>
<p>缓存机制对比：</p>
<pre class="mermaid">graph LR
  A[源文件] --> B{缓存是否存在?}
  B -->|是| C[直接使用缓存结果]
  B -->|否| D[执行Loader处理]
  D --> E[保存结果到缓存]
  E --> F[返回处理结果]</pre>

<p>缓存层级架构：</p>
<table>
<thead>
<tr>
<th align="left">缓存类型</th>
<th align="left">作用范围</th>
<th align="left">持久性</th>
<th align="left">典型工具</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Loader级缓存</td>
<td align="left">单个Loader处理结果</td>
<td align="left">临时</td>
<td align="left">cache-loader</td>
</tr>
<tr>
<td align="left">模块级缓存</td>
<td align="left">完整模块构建结果</td>
<td align="left">持久</td>
<td align="left">hard-source-webpack-plugin</td>
</tr>
<tr>
<td align="left">系统级缓存</td>
<td align="left">整个构建过程</td>
<td align="left">持久</td>
<td align="left">Webpack 5 内置缓存</td>
</tr>
</tbody></table>
<p><strong>cache-loader 深度解析</strong></p>
<p>工作原理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 伪代码实现</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) &#123;<br>  <span class="hljs-keyword">const</span> cacheKey = <span class="hljs-title function_">generateCacheKey</span>(<span class="hljs-variable language_">this</span>, source);<br>  <br>  <span class="hljs-comment">// 检查缓存</span><br>  <span class="hljs-keyword">if</span> (cache.<span class="hljs-title function_">exists</span>(cacheKey)) &#123;<br>    <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">get</span>(cacheKey); <span class="hljs-comment">// 返回缓存结果</span><br>  &#125;<br>  <br>  <span class="hljs-comment">// 执行后续Loader</span><br>  <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">runNextLoaders</span>(source);<br>  <br>  <span class="hljs-comment">// 保存缓存</span><br>  cache.<span class="hljs-title function_">set</span>(cacheKey, result);<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>最佳配置实践：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// webpack.config.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">module</span>: &#123;<br>    <span class="hljs-attr">rules</span>: [<br>      &#123;<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.jsx?$/</span>,<br>        <span class="hljs-attr">use</span>: [<br>          &#123;<br>            <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;cache-loader&#x27;</span>,<br>            <span class="hljs-attr">options</span>: &#123;<br>              <span class="hljs-attr">cacheDirectory</span>: <span class="hljs-string">&#x27;./.cache/babel&#x27;</span>,<br>              <span class="hljs-attr">cacheIdentifier</span>: <span class="hljs-string">&#x27;v2&#x27;</span> <span class="hljs-comment">// 缓存版本标识</span><br>            &#125;<br>          &#125;,<br>          <span class="hljs-string">&#x27;babel-loader&#x27;</span><br>        ]<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.s?css$/</span>,<br>        <span class="hljs-attr">use</span>: [<br>          <span class="hljs-string">&#x27;style-loader&#x27;</span>,<br>          &#123;<br>            <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;cache-loader&#x27;</span>,<br>            <span class="hljs-attr">options</span>: &#123;<br>              <span class="hljs-attr">cacheDirectory</span>: <span class="hljs-string">&#x27;./.cache/css&#x27;</span><br>            &#125;<br>          &#125;,<br>          <span class="hljs-string">&#x27;css-loader&#x27;</span>,<br>          <span class="hljs-string">&#x27;postcss-loader&#x27;</span>,<br>          <span class="hljs-string">&#x27;sass-loader&#x27;</span><br>        ]<br>      &#125;<br>    ]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>hard-source-webpack-plugin 深度剖析</strong></p>
<p>核心优势：</p>
<table>
<thead>
<tr>
<th align="left">构建次数</th>
<th align="left">性能提升比例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">首次构建</td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">二次构建</td>
<td align="left">65</td>
</tr>
<tr>
<td align="left">三次构建</td>
<td align="left">80</td>
</tr>
</tbody></table>
<p>配置示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">HardSourceWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;hard-source-webpack-plugin&#x27;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">HardSourceWebpackPlugin</span>(&#123;<br>      <span class="hljs-comment">// 缓存目录</span><br>      <span class="hljs-attr">cacheDirectory</span>: <span class="hljs-string">&#x27;./.cache/hard-source/[confighash]&#x27;</span>,<br>      <br>      <span class="hljs-comment">// 环境变量哈希</span><br>      <span class="hljs-attr">environmentHash</span>: &#123;<br>        <span class="hljs-attr">root</span>: process.<span class="hljs-title function_">cwd</span>(),<br>        <span class="hljs-attr">directories</span>: [],<br>        <span class="hljs-attr">files</span>: [<span class="hljs-string">&#x27;package.json&#x27;</span>, <span class="hljs-string">&#x27;yarn.lock&#x27;</span>],<br>      &#125;,<br>      <br>      <span class="hljs-comment">// 缓存有效期</span><br>      <span class="hljs-attr">info</span>: &#123;<br>        <span class="hljs-attr">mode</span>: <span class="hljs-string">&#x27;none&#x27;</span>,<br>        <span class="hljs-attr">level</span>: <span class="hljs-string">&#x27;debug&#x27;</span><br>      &#125;,<br>      <br>      <span class="hljs-comment">// 自动清除过期缓存</span><br>      <span class="hljs-attr">cachePrune</span>: &#123;<br>        <span class="hljs-attr">maxAge</span>: <span class="hljs-number">7</span> * <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 7天</span><br>        <span class="hljs-attr">sizeThreshold</span>: <span class="hljs-number">100</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> <span class="hljs-comment">// 100MB</span><br>      &#125;<br>    &#125;)<br>  ]<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>缓存策略对比分析</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">cache-loader</th>
<th align="left">hard-source-webpack-plugin</th>
<th align="left">Webpack 5 内置缓存</th>
</tr>
</thead>
<tbody><tr>
<td align="left">缓存粒度</td>
<td align="left">单个Loader级别</td>
<td align="left">模块级别</td>
<td align="left">模块级别</td>
</tr>
<tr>
<td align="left">持久性</td>
<td align="left">临时(内存&#x2F;磁盘)</td>
<td align="left">持久(磁盘)</td>
<td align="left">持久(磁盘)</td>
</tr>
<tr>
<td align="left">配置复杂度</td>
<td align="left">低</td>
<td align="left">中</td>
<td align="left">低</td>
</tr>
<tr>
<td align="left">二次构建速度</td>
<td align="left">+30-50%</td>
<td align="left">+60-80%</td>
<td align="left">+80-90%</td>
</tr>
<tr>
<td align="left">内存占用</td>
<td align="left">中</td>
<td align="left">高</td>
<td align="left">低</td>
</tr>
<tr>
<td align="left">支持场景</td>
<td align="left">所有Webpack版本</td>
<td align="left">Webpack 4+</td>
<td align="left">Webpack 5+</td>
</tr>
<tr>
<td align="left">主要优势</td>
<td align="left">精准控制Loader缓存</td>
<td align="left">完整模块缓存</td>
<td align="left">原生集成高效</td>
</tr>
</tbody></table>
<p><strong>Webpack 5 内置缓存</strong></p>
<p>现代化配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">cache</span>: &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;filesystem&#x27;</span>, <span class="hljs-comment">// 使用文件系统缓存</span><br>    <span class="hljs-attr">version</span>: <span class="hljs-string">&#x27;v1&#x27;</span>,      <span class="hljs-comment">// 缓存版本标识</span><br>    <span class="hljs-attr">cacheDirectory</span>: <span class="hljs-string">&#x27;./.cache/webpack5&#x27;</span>,<br>    <br>    <span class="hljs-comment">// 缓存依赖文件</span><br>    <span class="hljs-attr">buildDependencies</span>: &#123;<br>      <span class="hljs-attr">config</span>: [__filename], <span class="hljs-comment">// 配置文件变更时失效缓存</span><br>      <span class="hljs-attr">tsconfig</span>: [<span class="hljs-string">&#x27;./tsconfig.json&#x27;</span>]<br>    &#125;,<br>    <br>    <span class="hljs-comment">// 缓存策略</span><br>    <span class="hljs-attr">managedPaths</span>: [<br>      path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;node_modules&#x27;</span>) <span class="hljs-comment">// 只缓存node_modules</span><br>    ],<br>    <span class="hljs-attr">profile</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 输出缓存使用情况</span><br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>缓存失效策略</strong></p>
<p>(1) 失效场景与解决方案</p>
<table>
<thead>
<tr>
<th align="left">失效场景</th>
<th align="left">检测方法</th>
<th align="left">解决方案</th>
</tr>
</thead>
<tbody><tr>
<td align="left">源代码变更</td>
<td align="left">文件内容哈希</td>
<td align="left">自动处理</td>
</tr>
<tr>
<td align="left">Loader配置变更</td>
<td align="left">配置内容哈希</td>
<td align="left">cacheIdentifier 参数</td>
</tr>
<tr>
<td align="left">依赖包更新</td>
<td align="left">lock文件哈希</td>
<td align="left">包含yarn.lock&#x2F;package-lock.json</td>
</tr>
<tr>
<td align="left">环境变量变更</td>
<td align="left">环境变量哈希</td>
<td align="left">environmentHash 配置</td>
</tr>
<tr>
<td align="left">Webpack升级</td>
<td align="left">版本号检测</td>
<td align="left">自动清除旧缓存</td>
</tr>
</tbody></table>
<p>(2) 手动清除缓存</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 清除所有缓存</span><br><span class="hljs-built_in">rm</span> -rf .cache<br><br><span class="hljs-comment"># Webpack 5 清除缓存</span><br>webpack --clear-cache<br></code></pre></td></tr></table></figure>

<p><strong>常见问题解决方案</strong></p>
<p>(1) 缓存不更新</p>
<p>症状：修改代码后构建结果不变</p>
<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// cache-loader 添加版本标识</span><br>&#123;<br>  <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;cache-loader&#x27;</span>,<br>  <span class="hljs-attr">options</span>: &#123;<br>    <span class="hljs-attr">cacheIdentifier</span>: <span class="hljs-string">`v3-<span class="hljs-subst">$&#123;<span class="hljs-built_in">Date</span>.now()&#125;</span>`</span> <span class="hljs-comment">// 开发环境使用时间戳</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// Webpack 5 配置</span><br><span class="hljs-attr">cache</span>: &#123;<br>  <span class="hljs-attr">version</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;process.env.GIT_COMMIT || <span class="hljs-string">&#x27;dev&#x27;</span>&#125;</span>`</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) 缓存占用过大</p>
<p>优化方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 1. 设置缓存有效期</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">HardSourceWebpackPlugin</span>(&#123;<br>  <span class="hljs-attr">cachePrune</span>: &#123;<br>    <span class="hljs-attr">maxAge</span>: <span class="hljs-number">2</span> * <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span> <span class="hljs-comment">// 2天</span><br>  &#125;<br>&#125;)<br><br><span class="hljs-comment">// 2. 排除node_modules</span><br><span class="hljs-attr">cache</span>: &#123;<br>  <span class="hljs-attr">managedPaths</span>: [path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;node_modules&#x27;</span>)]<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-1-2-范围缩小：module-noParse-resolve-modules"><a href="#3-1-2-范围缩小：module-noParse-resolve-modules" class="headerlink" title="3.1.2 范围缩小：module.noParse &#x2F; resolve.modules"></a>3.1.2 范围缩小：<code>module.noParse</code> &#x2F; <code>resolve.modules</code></h3><p><strong>范围缩小核心原理</strong></p>
<p>Webpack 模块解析流程：</p>
<pre class="mermaid">graph LR
  A[入口文件] --> B[解析依赖]
  B --> C{是否在 noParse 列表?}
  C -->|是| D[直接包含不解析]
  C -->|否| E[查找模块路径]
  E --> F{是否在 modules 路径?}
  F -->|是| G[直接使用]
  F -->|否| H[继续搜索 node_modules]</pre>

<p><strong>module.noParse 深度解析</strong></p>
<p>核心作用与适用场景：</p>
<ul>
<li>作用：跳过指定模块的解析过程</li>
<li>适用场景：<ul>
<li>大型库（如 jQuery、Lodash）</li>
<li>已知无依赖的独立模块</li>
<li>预编译资源（如 .wasm 文件）</li>
<li>性能敏感场景</li>
</ul>
</li>
</ul>
<p>配置方式对比：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// webpack.config.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">module</span>: &#123;<br>    <span class="hljs-attr">noParse</span>: [<br>      <span class="hljs-comment">// 1. 正则匹配</span><br>      <span class="hljs-regexp">/jquery|lodash/</span>,<br>      <br>      <span class="hljs-comment">// 2. 函数动态判断</span><br>      <span class="hljs-function">(<span class="hljs-params">content</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">return</span> content.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;This file is already minified&#x27;</span>);<br>      &#125;,<br>      <br>      <span class="hljs-comment">// 3. 精确路径匹配</span><br>      path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;vendor/react.production.min.js&#x27;</span>)<br>    ]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>resolve.modules 高级配置</strong></p>
<p>路径解析优化策略：</p>
<pre class="mermaid">graph TD
  A[模块导入] --> B{是否绝对路径?}
  B -->|是| C[直接使用]
  B -->|否| D{是否相对路径?}
  D -->|是| E[基于当前目录解析]
  D -->|否| F[搜索 resolve.modules]
  F --> G{是否找到?}
  G -->|是| H[使用找到的模块]
  G -->|否| I[搜索 node_modules]</pre>

<p>企业级配置方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">resolve</span>: &#123;<br>    <span class="hljs-attr">modules</span>: [<br>      <span class="hljs-comment">// 1. 优先项目源目录</span><br>      path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;src&#x27;</span>),<br>      <br>      <span class="hljs-comment">// 2. 公共组件目录</span><br>      path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;shared-components&#x27;</span>),<br>      <br>      <span class="hljs-comment">// 3. 最后 node_modules</span><br>      <span class="hljs-string">&#x27;node_modules&#x27;</span><br>    ]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>高级配置技巧</strong></p>
<p>(1) 动态 noParse 函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">module</span>: &#123;<br>    <span class="hljs-attr">noParse</span>: <span class="hljs-function">(<span class="hljs-params">content</span>) =&gt;</span> &#123;<br>      <span class="hljs-comment">// 跳过所有.min.js文件</span><br>      <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/\.min\.js$/</span>.<span class="hljs-title function_">test</span>(content.<span class="hljs-property">resource</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>      <br>      <span class="hljs-comment">// 跳过特定目录</span><br>      <span class="hljs-keyword">if</span> (content.<span class="hljs-property">context</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;vendor&#x27;</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>      <br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) 多环境路径配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> isProduction = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;production&#x27;</span>;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">resolve</span>: &#123;<br>    <span class="hljs-attr">modules</span>: [<br>      <span class="hljs-string">&#x27;src&#x27;</span>,<br>      <span class="hljs-comment">// 生产环境使用优化版库</span><br>      isProduction <br>        ? path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;dist/prod-libs&#x27;</span>)<br>        : path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;dist/dev-libs&#x27;</span>),<br>      <span class="hljs-string">&#x27;node_modules&#x27;</span><br>    ]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>常见问题解决方案</strong></p>
<p>(1) noParse 导致依赖缺失</p>
<p>症状：Uncaught ReferenceError: require is not defined</p>
<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 排除需要解析的模块</span><br><span class="hljs-attr">noParse</span>: <span class="hljs-function">(<span class="hljs-params">content</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">// 排除需要依赖的模块</span><br>  <span class="hljs-keyword">if</span> (content.<span class="hljs-property">resource</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;special-module&#x27;</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  <br>  <span class="hljs-comment">// 排除非JS模块</span><br>  <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/\.js$/</span>.<span class="hljs-title function_">test</span>(content.<span class="hljs-property">resource</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-regexp">/[\\/]vendor[\\/]/</span>.<span class="hljs-title function_">test</span>(content.<span class="hljs-property">resource</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) 路径解析冲突</p>
<p>症状：Module not found: Error: Can’t resolve ‘component’</p>
<p>解决方案：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-attr">resolve</span>: &#123;<br>  <span class="hljs-attr">modules</span>: [<br>    <span class="hljs-comment">// 明确路径顺序</span><br>    <span class="hljs-string">&#x27;src/components&#x27;</span>,  <span class="hljs-comment">// 1. 特定组件目录</span><br>    <span class="hljs-string">&#x27;src&#x27;</span>,             <span class="hljs-comment">// 2. 通用源目录</span><br>    <span class="hljs-string">&#x27;shared&#x27;</span>,          <span class="hljs-comment">// 3. 共享目录</span><br>    <span class="hljs-string">&#x27;node_modules&#x27;</span>     <span class="hljs-comment">// 4. 第三方库</span><br>  ],<br>  <span class="hljs-comment">// 使用别名精确控制</span><br>  <span class="hljs-attr">alias</span>: &#123;<br>    <span class="hljs-string">&#x27;@components&#x27;</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;src/components&#x27;</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>性能优化决策策略</strong></p>
<pre class="mermaid">graph TD
  A[构建速度慢?] --> B{瓶颈类型}
  B --> C[模块解析慢] --> D[优化 resolve.modules]
  B --> E[依赖分析慢] --> F[配置 module.noParse]
  
  D --> G[减少搜索路径数量]
  D --> H[设置精确路径顺序]
  F --> I[识别大型独立库]
  F --> J[跳过预编译资源]
  
  G --> K[冷启动加速20-30%]
  H --> L[热更新加速15-25%]
  I --> M[解析时间减少40-60%]
  J --> N[内存占用降低25-35%]</pre>

<h3 id="3-1-3-并行处理：thread-loader-parallel-webpack"><a href="#3-1-3-并行处理：thread-loader-parallel-webpack" class="headerlink" title="3.1.3 并行处理：thread-loader &#x2F; parallel-webpack"></a>3.1.3 并行处理：<code>thread-loader</code> &#x2F; <code>parallel-webpack</code></h3><p><strong>并行处理核心原理</strong></p>
<p>CPU多核利用机制：</p>
<pre class="mermaid">graph LR
  A[主进程] --> B[任务分配器]
  B --> C[Worker 1]
  B --> D[Worker 2]
  B --> E[Worker 3]
  C --> F[处理任务A]
  D --> G[处理任务B]
  E --> H[处理任务C]
  F --> I[结果合并]
  G --> I
  H --> I</pre>

<p><strong>thread-loader 深度解析</strong></p>
<p>工作原理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 伪代码实现</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) &#123;<br>  <span class="hljs-comment">// 1. 创建Worker线程池</span><br>  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">workerPool</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">workerPool</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WorkerPool</span>(&#123;<br>      <span class="hljs-attr">workers</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;os&#x27;</span>).<span class="hljs-title function_">cpus</span>().<span class="hljs-property">length</span> - <span class="hljs-number">1</span><br>    &#125;);<br>  &#125;<br>  <br>  <span class="hljs-comment">// 2. 提交任务到线程池</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">workerPool</span>.<span class="hljs-title function_">run</span>(&#123;<br>      <span class="hljs-attr">source</span>: source,<br>      <span class="hljs-attr">options</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getOptions</span>()<br>    &#125;, <span class="hljs-function">(<span class="hljs-params">err, result</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(err);<br>      <span class="hljs-title function_">resolve</span>(result);<br>    &#125;);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>最佳配置实践：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// webpack.config.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">module</span>: &#123;<br>    <span class="hljs-attr">rules</span>: [<br>      &#123;<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,<br>        <span class="hljs-attr">use</span>: [<br>          &#123;<br>            <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;thread-loader&#x27;</span>,<br>            <span class="hljs-attr">options</span>: &#123;<br>              <span class="hljs-attr">workers</span>: <span class="hljs-number">4</span>,                   <span class="hljs-comment">// CPU核心数-1</span><br>              <span class="hljs-attr">workerParallelJobs</span>: <span class="hljs-number">50</span>,       <span class="hljs-comment">// 每个Worker并行任务数</span><br>              <span class="hljs-attr">poolTimeout</span>: <span class="hljs-number">2000</span>,            <span class="hljs-comment">// 空闲时自动关闭时间</span><br>              <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;js-pool&#x27;</span>               <span class="hljs-comment">// 线程池名称</span><br>            &#125;<br>          &#125;,<br>          <span class="hljs-string">&#x27;babel-loader&#x27;</span><br>        ]<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,<br>        <span class="hljs-attr">use</span>: [<br>          <span class="hljs-string">&#x27;style-loader&#x27;</span>,<br>          &#123;<br>            <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;thread-loader&#x27;</span>,<br>            <span class="hljs-attr">options</span>: &#123;<br>              <span class="hljs-attr">workers</span>: <span class="hljs-number">2</span>,                   <span class="hljs-comment">// CSS处理通常较轻量</span><br>              <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;css-pool&#x27;</span><br>            &#125;<br>          &#125;,<br>          <span class="hljs-string">&#x27;css-loader&#x27;</span>,<br>          <span class="hljs-string">&#x27;postcss-loader&#x27;</span><br>        ]<br>      &#125;<br>    ]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>parallel-webpack 高级应用</strong></p>
<p>(1) 多配置并行处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 创建webpack.parallel.config.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = [<br>  &#123;<br>    <span class="hljs-attr">entry</span>: <span class="hljs-string">&#x27;./app.js&#x27;</span>,<br>    <span class="hljs-attr">output</span>: &#123; <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;app-bundle.js&#x27;</span> &#125;<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">entry</span>: <span class="hljs-string">&#x27;./admin.js&#x27;</span>,<br>    <span class="hljs-attr">output</span>: &#123; <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;admin-bundle.js&#x27;</span> &#125;<br>  &#125;<br>];<br><br><span class="hljs-comment">// 运行命令</span><br>parallel-webpack --config=webpack.<span class="hljs-property">parallel</span>.<span class="hljs-property">config</span>.<span class="hljs-property">js</span><br></code></pre></td></tr></table></figure>

<p>(2) 动态配置生成</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 生成多页面配置</span><br><span class="hljs-keyword">const</span> pages = [<span class="hljs-string">&#x27;home&#x27;</span>, <span class="hljs-string">&#x27;about&#x27;</span>, <span class="hljs-string">&#x27;contact&#x27;</span>];<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = pages.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">page</span> =&gt;</span> (&#123;<br>  <span class="hljs-attr">entry</span>: <span class="hljs-string">`./src/<span class="hljs-subst">$&#123;page&#125;</span>.js`</span>,<br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;page&#125;</span>.bundle.js`</span><br>  &#125;,<br>  <span class="hljs-attr">plugins</span>: [<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>(&#123;<br>      <span class="hljs-attr">template</span>: <span class="hljs-string">`./src/<span class="hljs-subst">$&#123;page&#125;</span>.html`</span><br>    &#125;)<br>  ]<br>&#125;));<br></code></pre></td></tr></table></figure>

<p><strong>决策树：选择并行策略</strong></p>
<pre class="mermaid">graph TD
  A[需要并行处理?] --> B{项目类型}
  B --> C[单入口SPA] --> D[使用thread-loader]
  B --> E[多入口/多页面] --> F[使用parallel-webpack]
  B --> G[微前端架构] --> H[组合使用]
  
  D --> I[CPU密集型Loader]
  F --> J[独立配置构建]
  H --> K[主应用thread-loader + 子应用parallel-webpack]
  
  I --> L[提升50-70%构建速度]
  J --> M[提升60-80%构建速度]
  K --> N[提升70-90%构建速度]</pre>

<h2 id="3-2-输出包体积优化"><a href="#3-2-输出包体积优化" class="headerlink" title="3.2 输出包体积优化"></a>3.2 输出包体积优化</h2><h3 id="3-2-1-Tree-Shaking失效场景分析（副作用处理）"><a href="#3-2-1-Tree-Shaking失效场景分析（副作用处理）" class="headerlink" title="3.2.1 Tree Shaking失效场景分析（副作用处理）"></a>3.2.1 Tree Shaking失效场景分析（副作用处理）</h3><p><strong>Tree Shaking 核心原理</strong></p>
<p>工作原理示意图：</p>
<pre class="mermaid">graph TD
  A[源代码] --> B[构建依赖图]
  B --> C{标记活动代码}
  C --> D[删除未使用代码]
  D --> E[优化后代码]
  
  subgraph 关键步骤
    C1[ESM静态分析] --> C2[识别导出导入]
    C3[副作用检测] --> C4[安全删除]
  end</pre>

<p><strong>Tree Shaking 失效的六大场景</strong></p>
<p>(1) 副作用模块未声明</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 场景：CSS导入无副作用声明</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;./styles.css&#x27;</span>; <span class="hljs-comment">// 无显式导出</span><br><br><span class="hljs-comment">// 解决方案：package.json</span><br>&#123;<br>  <span class="hljs-string">&quot;sideEffects&quot;</span>: [<span class="hljs-string">&quot;*.css&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>

<p>(2) CommonJS 模块使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 场景：CommonJS无法静态分析</span><br><span class="hljs-keyword">const</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./utils&#x27;</span>); <span class="hljs-comment">// 动态导入</span><br><span class="hljs-keyword">const</span> &#123; usedFunc &#125; = utils;<br><br><span class="hljs-comment">// 解决方案：转为ESM</span><br><span class="hljs-keyword">import</span> &#123; usedFunc &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./utils&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>(3) 动态导入模式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 场景：动态属性访问</span><br><span class="hljs-keyword">import</span> utils <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./utils&#x27;</span>;<br><span class="hljs-keyword">const</span> funcName = <span class="hljs-string">&#x27;usedFunc&#x27;</span>;<br>utils[funcName](); <span class="hljs-comment">// 无法静态分析</span><br><br><span class="hljs-comment">// 解决方案：直接引用</span><br><span class="hljs-keyword">import</span> &#123; usedFunc &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./utils&#x27;</span>;<br><span class="hljs-title function_">usedFunc</span>();<br></code></pre></td></tr></table></figure>

<p>(4) Babel 转换破坏 ESM</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 场景：Babel转换ESM为CommonJS</span><br><span class="hljs-comment">// .babelrc</span><br>&#123;<br>  <span class="hljs-string">&quot;presets&quot;</span>: [[<span class="hljs-string">&quot;@babel/preset-env&quot;</span>, &#123; <span class="hljs-string">&quot;modules&quot;</span>: <span class="hljs-string">&quot;commonjs&quot;</span> &#125;]] <span class="hljs-comment">// 错误！</span><br>&#125;<br><br><span class="hljs-comment">// 解决方案：保留ESM</span><br>&#123;<br>  <span class="hljs-string">&quot;presets&quot;</span>: [[<span class="hljs-string">&quot;@babel/preset-env&quot;</span>, &#123; <span class="hljs-string">&quot;modules&quot;</span>: <span class="hljs-literal">false</span> &#125;]] <span class="hljs-comment">// 正确</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>(5) 模块再导出问题</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 场景：通配符再导出</span><br><span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./utils&#x27;</span>; <span class="hljs-comment">// 无法单独Tree Shake</span><br><br><span class="hljs-comment">// 解决方案：命名导出</span><br><span class="hljs-keyword">export</span> &#123; utilA, utilB &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./utils&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>(6) 外部包未优化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 场景：全量导入lodash</span><br><span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lodash&#x27;</span>; <span class="hljs-comment">// 整个包被引入</span><br>_.<span class="hljs-title function_">debounce</span>();<br><br><span class="hljs-comment">// 解决方案：按需导入</span><br><span class="hljs-keyword">import</span> debounce <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lodash/debounce&#x27;</span>;<br><span class="hljs-comment">// 或使用ES版本</span><br><span class="hljs-keyword">import</span> &#123; debounce &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lodash-es&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><strong>副作用处理深度解析</strong></p>
<p>(1) sideEffects 配置策略</p>
<table>
<thead>
<tr>
<th align="left">配置方式</th>
<th align="left">效果</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">false</td>
<td align="left">所有文件无副作用</td>
<td align="left">纯工具库</td>
</tr>
<tr>
<td align="left">文件路径数组</td>
<td align="left">标记有副作用的文件</td>
<td align="left">含CSS&#x2F;PNG的组件库</td>
</tr>
<tr>
<td align="left">正则表达式</td>
<td align="left">匹配有副作用的文件</td>
<td align="left">批量标记</td>
</tr>
</tbody></table>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JSON"><span class="hljs-comment">// 典型配置示例</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;my-library&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;sideEffects&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-string">&quot;**/*.css&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;**/*.scss&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-string">&quot;src/polyfill.js&quot;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>(2) 函数级副作用标记</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 明确标记无副作用</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>) &#123;<br>  <span class="hljs-keyword">return</span> a + b;<br>&#125;<br><br><span class="hljs-comment">/*#__PURE__*/</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> version = process.<span class="hljs-property">env</span>.<span class="hljs-property">VERSION</span>; <span class="hljs-comment">// 标记为纯</span><br><br><span class="hljs-comment">// 标记副作用函数</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">window</span>.<span class="hljs-property">appConfig</span> = &#123;&#125;; <span class="hljs-comment">// 有副作用</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Webpack 优化配置</strong></p>
<p>完整Tree Shaking配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">mode</span>: <span class="hljs-string">&#x27;production&#x27;</span>,<br>  <span class="hljs-attr">optimization</span>: &#123;<br>    <span class="hljs-attr">usedExports</span>: <span class="hljs-literal">true</span>,   <span class="hljs-comment">// 启用导出标记</span><br>    <span class="hljs-attr">sideEffects</span>: <span class="hljs-literal">true</span>,   <span class="hljs-comment">// 启用副作用分析</span><br>    <span class="hljs-attr">minimize</span>: <span class="hljs-literal">true</span>,      <span class="hljs-comment">// 启用代码压缩</span><br>    <span class="hljs-attr">concatenateModules</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 作用域提升</span><br>    <span class="hljs-attr">innerGraph</span>: <span class="hljs-literal">true</span>     <span class="hljs-comment">// 深度依赖分析(Webpack 5)</span><br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><strong>决策树：解决Tree Shaking失效</strong></p>
<pre class="mermaid">graph TD
  A[Tree Shaking失效] --> B{具体场景}
  B --> C[模块有副作用] --> D[配置sideEffects]
  B --> E[使用CommonJS] --> F[转为ESM]
  B --> G[动态导入] --> H[重构为静态引用]
  B --> I[Babel转换问题] --> J[设置 modules: false]
  B --> K[通配符导出] --> L[使用命名导出]
  B --> M[第三方库问题] --> N[使用ES版本或按需导入]</pre>

<h3 id="3-2-2-代码分割：SplitChunksPlugin配置策略（chunks-minSize-cacheGroups）"><a href="#3-2-2-代码分割：SplitChunksPlugin配置策略（chunks-minSize-cacheGroups）" class="headerlink" title="3.2.2 代码分割：SplitChunksPlugin配置策略（chunks&#x2F;minSize&#x2F;cacheGroups）"></a>3.2.2 代码分割：<code>SplitChunksPlugin</code>配置策略（<code>chunks</code>&#x2F;<code>minSize</code>&#x2F;<code>cacheGroups</code>）</h3><p><strong>基础配置项</strong></p>
<table>
<thead>
<tr>
<th align="left">配置项</th>
<th align="left">默认值</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">chunks</td>
<td align="left">‘async’</td>
<td align="left">控制分割范围：async(动态导入) &#x2F; initial(同步导入) &#x2F; all(全部)</td>
</tr>
<tr>
<td align="left">minSize</td>
<td align="left">20000 (20KB)</td>
<td align="left">生成新chunk的最小体积（过小模块不分割）</td>
</tr>
<tr>
<td align="left">minChunks</td>
<td align="left">1</td>
<td align="left">模块被至少多少个chunk引用才分割</td>
</tr>
<tr>
<td align="left">maxAsyncRequests</td>
<td align="left">30</td>
<td align="left">每个异步加载中最大并行请求数</td>
</tr>
<tr>
<td align="left">maxInitialRequests</td>
<td align="left">30</td>
<td align="left">入口点最大并行请求数</td>
</tr>
</tbody></table>
<p><strong>核心配置 cacheGroups（重点！）</strong></p>
<p>定义自定义分割规则组，优先级高于全局配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-attr">optimization</span>: &#123;<br>  <span class="hljs-attr">splitChunks</span>: &#123;<br>    <span class="hljs-attr">cacheGroups</span>: &#123;<br>      <span class="hljs-comment">// 1. 分离第三方库</span><br>      <span class="hljs-attr">vendors</span>: &#123;<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]/</span>, <span class="hljs-comment">// 路径匹配</span><br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;vendors&#x27;</span>,                  <span class="hljs-comment">// 输出文件名</span><br>        <span class="hljs-attr">chunks</span>: <span class="hljs-string">&#x27;all&#x27;</span>,                    <span class="hljs-comment">// 覆盖全局chunks设置</span><br>        <span class="hljs-attr">priority</span>: <span class="hljs-number">10</span>,                     <span class="hljs-comment">// 优先级（数字越大越优先）</span><br>        <span class="hljs-attr">reuseExistingChunk</span>: <span class="hljs-literal">true</span>          <span class="hljs-comment">// 重用已存在chunk</span><br>      &#125;,<br>      <span class="hljs-comment">// 2. 分离公共模块（被2个以上chunk引用）</span><br>      <span class="hljs-attr">common</span>: &#123;<br>        <span class="hljs-attr">minChunks</span>: <span class="hljs-number">2</span>,                     <span class="hljs-comment">// 最小引用次数</span><br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;common&#x27;</span>,<br>        <span class="hljs-attr">priority</span>: <span class="hljs-number">5</span>,<br>        <span class="hljs-attr">minSize</span>: <span class="hljs-number">0</span>                        <span class="hljs-comment">// 允许小模块（如工具函数）</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>配置策略实战技巧</strong></p>
<p>(1) chunks 选型策略</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 场景1：SPA应用（推荐）</span><br><span class="hljs-attr">chunks</span>: <span class="hljs-string">&#x27;all&#x27;</span> <span class="hljs-comment">// 同时优化首屏和异步加载</span><br><br><span class="hljs-comment">// 场景2：多页应用（MPA）</span><br><span class="hljs-attr">chunks</span>: <span class="hljs-string">&#x27;initial&#x27;</span> <span class="hljs-comment">// 仅分割入口公共依赖</span><br></code></pre></td></tr></table></figure>

<p>(2) 体积阈值调优</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-attr">minSize</span>: &#123;<br>  <span class="hljs-attr">javascript</span>: <span class="hljs-number">30000</span>,  <span class="hljs-comment">// JS最小30KB</span><br>  <span class="hljs-attr">style</span>: <span class="hljs-number">50000</span>        <span class="hljs-comment">// CSS最小50KB</span><br>&#125;,<br><span class="hljs-attr">maxSize</span>: <span class="hljs-number">150000</span>,      <span class="hljs-comment">// 尝试拆分大于150KB的包</span><br></code></pre></td></tr></table></figure>

<p>(3) cacheGroups 高级用法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 分离指定框架（如React）</span><br><span class="hljs-attr">react</span>: &#123;<br>  <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]react|react-dom[\\/]/</span>,<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;react-core&#x27;</span>,<br>  <span class="hljs-attr">priority</span>: <span class="hljs-number">20</span>  <span class="hljs-comment">// 高于默认vendors</span><br>&#125;<br><br><span class="hljs-comment">// 按目录结构分组</span><br><span class="hljs-attr">utils</span>: &#123;<br>  <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]src[\\/]utils[\\/]/</span>,<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;shared-utils&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>常见优化场景解决方案</strong></p>
<table>
<thead>
<tr>
<th align="left">问题现象</th>
<th align="left">解决方案</th>
</tr>
</thead>
<tbody><tr>
<td align="left">首屏加载慢</td>
<td align="left">提高 minSize 避免过小包，增大 maxInitialRequests</td>
</tr>
<tr>
<td align="left">公共模块重复打包</td>
<td align="left">设置 minChunks: 2 + cacheGroups.common</td>
</tr>
<tr>
<td align="left">Lodash等工具库未单独拆分</td>
<td align="left">在 cacheGroups 添加专属规则（test: &#x2F;lodash&#x2F;）</td>
</tr>
<tr>
<td align="left">异步加载的组件库体积过大</td>
<td align="left">配置 maxAsyncRequests: 10 限制并发请求数</td>
</tr>
</tbody></table>
<p><strong>配置优先级规则</strong></p>
<p>模块匹配顺序：</p>
<pre class="mermaid">graph TB
  A[模块] --> B{是否匹配 cacheGroups 规则?}
  B -->|是| C[按 priority 选择最高优先级组]
  B -->|否| D[应用全局 splitChunks 配置]</pre>

<p>冲突处理原则：</p>
<ul>
<li>priority 决定规则优先级</li>
<li>同时匹配多规则时，选择 priority 值更大的组</li>
<li>未匹配任何组时回退到全局配置</li>
</ul>
<p><strong>面试高频问题</strong></p>
<p>(1) 如何避免分割出过多小文件？</p>
<p>合理设置 minSize（推荐30KB+）和 maxAsyncRequests（建议5-10），并启用 reuseExistingChunk</p>
<p>(2) 同步模块(initial)和异步模块(async)分割的区别？</p>
<p>同步分割影响首屏请求数，需配合 maxInitialRequests 控制；异步分割优化动态加载性能</p>
<p>(3) 为什么配置了 minChunks: 2 但公共模块未分离？</p>
<p>排查点：</p>
<ul>
<li>模块体积是否小于 minSize</li>
<li>是否被更高优先级规则匹配</li>
<li>chunks 范围是否包含该模块类型</li>
</ul>
<h3 id="3-2-3-动态加载：import-语法与Prefetch-Preload"><a href="#3-2-3-动态加载：import-语法与Prefetch-Preload" class="headerlink" title="3.2.3 动态加载：import()语法与Prefetch&#x2F;Preload"></a>3.2.3 动态加载：<code>import()</code>语法与Prefetch&#x2F;Preload</h3><p><strong>基础语法与原理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 1. 基础动态导入</span><br>button.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./module.js&#x27;</span>)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">module</span> =&gt;</span> <span class="hljs-variable language_">module</span>.<span class="hljs-title function_">doSomething</span>())<br>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;加载失败&#x27;</span>, err));<br>&#125;);<br><br><span class="hljs-comment">// 2. 结合async/await</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">loadModule</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; export1, export2 &#125; = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./module.js&#x27;</span>);<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>编译结果：<br>Webpack 会将动态导入模块拆分为独立 chunk（如 1.bundle.js），并自动注入：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 运行时生成的加载逻辑</span><br>__webpack_require__.<span class="hljs-title function_">e</span>(<span class="hljs-comment">/*! import() */</span> <span class="hljs-number">1</span>)<br>  .<span class="hljs-title function_">then</span>(__webpack_require__.<span class="hljs-title function_">bind</span>(<span class="hljs-number">1</span>))<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">module</span> =&gt;</span> ...)<br></code></pre></td></tr></table></figure>

<p><strong>魔法注释（Magic Comments）</strong></p>
<p>通过注释传递配置参数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">import</span>(<br>  <span class="hljs-comment">/* webpackChunkName: &quot;chartjs&quot; */</span><br>  <span class="hljs-comment">/* webpackPrefetch: true */</span><br>  <span class="hljs-comment">/* webpackPreload: true */</span><br>  <span class="hljs-comment">/* webpackMode: &quot;lazy-once&quot; */</span><br>  <span class="hljs-string">&#x27;./chart&#x27;</span><br>)<br></code></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">注释指令</th>
<th align="left">作用</th>
<th align="left">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left">webpackChunkName</td>
<td align="left">指定生成chunk的名称（支持占位符[name]）</td>
<td align="left">分组同类模块</td>
</tr>
<tr>
<td align="left">webpackPrefetch</td>
<td align="left">预取：空闲时加载资源（优先级低）</td>
<td align="left">未来可能需要的功能（如下页）</td>
</tr>
<tr>
<td align="left">webpackPreload</td>
<td align="left">预加载：与父模块并行加载（优先级高）</td>
<td align="left">首屏关键异步组件</td>
</tr>
<tr>
<td align="left">webpackMode</td>
<td align="left">加载模式：lazy(默认)&#x2F;eager(不分离chunk)&#x2F;lazy-once(统一chunk)</td>
<td align="left">特殊加载需求</td>
</tr>
</tbody></table>
<p><strong>Prefetch vs Preload 核心差异</strong></p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">prefetch</th>
<th align="left">preload</th>
</tr>
</thead>
<tbody><tr>
<td align="left">加载时机</td>
<td align="left">浏览器空闲时</td>
<td align="left">立即与父模块并行加载</td>
</tr>
<tr>
<td align="left">优先级</td>
<td align="left">Low</td>
<td align="left">High</td>
</tr>
<tr>
<td align="left">执行顺序</td>
<td align="left">主流程完成后</td>
<td align="left">阻塞父模块渲染</td>
</tr>
<tr>
<td align="left">适用场景</td>
<td align="left">非关键功能（如弹窗&#x2F;下页内容）</td>
<td align="left">关键异步路由&#x2F;首屏必要组件</td>
</tr>
<tr>
<td align="left">HTTP头</td>
<td align="left"><code>&lt;link rel=&quot;prefetch&quot; href=&quot;...&quot;&gt;</code></td>
<td align="left"><code>&lt;link rel=&quot;preload&quot; href=&quot;...&quot;&gt;</code></td>
</tr>
</tbody></table>
<p>错误用法警示：<br>滥用 preload 会导致关键资源被抢占，反而延长首屏时间</p>
<p><strong>工程化最佳实践</strong></p>
<p>(1) 路由级代码分割（React&#x2F;Vue）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// React + React.lazy</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ProductPage</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <br>  <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackPrefetch: true */</span> <span class="hljs-string">&#x27;./ProductPage&#x27;</span>)<br>);<br><br><span class="hljs-comment">// Vue 异步组件</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">UserProfile</span> = (<span class="hljs-params"></span>) =&gt; (&#123;<br>  <span class="hljs-attr">component</span>: <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackChunkName: &quot;profile&quot; */</span> <span class="hljs-string">&#x27;./UserProfile.vue&#x27;</span>),<br>  <span class="hljs-attr">delay</span>: <span class="hljs-number">200</span> <span class="hljs-comment">// 延迟展示loading时间</span><br>&#125;);<br></code></pre></td></tr></table></figure>

<p>(2) 组件库按需加载</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 点击时加载富文本编辑器</span><br>editButton.<span class="hljs-property">onclick</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackChunkName: &quot;editor&quot; */</span> <span class="hljs-string">&#x27;tinymce&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">editor</span> =&gt;</span> &#123;<br>    editor.<span class="hljs-title function_">init</span>();<br>  &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>(3) 预取策略优化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 页面加载完成后预取下页资源</span><br><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;load&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackPrefetch: true */</span> <span class="hljs-string">&#x27;./next-page-module.js&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>性能优化指标关联</strong></p>
<table>
<thead>
<tr>
<th align="left">优化手段</th>
<th align="left">影响的核心指标</th>
</tr>
</thead>
<tbody><tr>
<td align="left">基础动态导入</td>
<td align="left">减少FCP时间（首次内容绘制）</td>
</tr>
<tr>
<td align="left">Prefetch</td>
<td align="left">提升LCP（最大内容绘制）后的交互体验</td>
</tr>
<tr>
<td align="left">Preload</td>
<td align="left">优化LCP本身（关键内容加载）</td>
</tr>
<tr>
<td align="left">合理拆分chunk</td>
<td align="left">降低TBT（总阻塞时间）</td>
</tr>
</tbody></table>
<p><strong>常见问题解决方案</strong></p>
<p>Q1：动态加载的chunk文件过多导致HTTP&#x2F;2阻塞？</p>
<p>方案：合并小文件 + 域名分片</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 统一命名合并同类模块</span><br><span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackChunkName: &quot;utils-[request]&quot; */</span> <span class="hljs-string">`./utils/<span class="hljs-subst">$&#123;file&#125;</span>`</span>)<br></code></pre></td></tr></table></figure>

<p>Q2：如何捕获加载失败？</p>
<p>方案：添加错误边界（React） + 重试机制</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// React错误边界</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ErrorBoundary</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  <span class="hljs-title function_">componentDidCatch</span>(<span class="hljs-params">error</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isChunkLoadError</span>(error)) <span class="hljs-title function_">retryLoading</span>();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Q3：预取资源过早影响首屏？</p>
<p>方案：动态计算触发时机</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 根据网络速度延迟预取</span><br><span class="hljs-keyword">if</span> (navigator.<span class="hljs-property">connection</span>.<span class="hljs-property">saveData</span> === <span class="hljs-literal">false</span>) &#123;<br>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">prefetchModule</span>(), <span class="hljs-number">10000</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-4-资源压缩：Terser多进程压缩-CSS-cssnano"><a href="#3-2-4-资源压缩：Terser多进程压缩-CSS-cssnano" class="headerlink" title="3.2.4 资源压缩：Terser多进程压缩 &#x2F; CSS cssnano"></a>3.2.4 资源压缩：Terser多进程压缩 &#x2F; CSS <code>cssnano</code></h3><p><strong>JavaScript压缩：Terser核心机制</strong></p>
<p>Terser（Webpack 5+默认）替代UglifyJS，支持ES6+语法压缩，配置示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// webpack.config.js</span><br><span class="hljs-attr">optimization</span>: &#123;<br>  <span class="hljs-attr">minimize</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">minimizer</span>: [<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>(&#123;<br>      <span class="hljs-attr">parallel</span>: <span class="hljs-literal">true</span>,         <span class="hljs-comment">// 启用多进程（默认CPU数-1）</span><br>      <span class="hljs-attr">extractComments</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 不提取注释到单独文件</span><br>      <span class="hljs-attr">terserOptions</span>: &#123;<br>        <span class="hljs-attr">compress</span>: &#123;<br>          <span class="hljs-attr">drop_console</span>: <span class="hljs-literal">true</span>,    <span class="hljs-comment">// 移除console</span><br>          <span class="hljs-attr">pure_funcs</span>: [<span class="hljs-string">&#x27;alert&#x27;</span>], <span class="hljs-comment">// 删除指定函数</span><br>        &#125;,<br>        <span class="hljs-attr">format</span>: &#123;<br>          <span class="hljs-attr">comments</span>: <span class="hljs-literal">false</span>,       <span class="hljs-comment">// 移除所有注释</span><br>        &#125;,<br>        <span class="hljs-attr">mangle</span>: &#123;<br>          <span class="hljs-attr">properties</span>: &#123;<br>            <span class="hljs-attr">regex</span>: <span class="hljs-regexp">/^_/</span>,        <span class="hljs-comment">// 混淆以_开头的私有属性</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;)<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>

<p>关键配置项解析：</p>
<table>
<thead>
<tr>
<th align="left">类别</th>
<th align="left">选项</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">压缩</td>
<td align="left">drop_console<br>dead_code<br>reduce_vars</td>
<td align="left">删除所有console.*调用<br>移除不可达代码（需配合Tree Shaking）<br>变量复用（将重复变量合并）</td>
</tr>
<tr>
<td align="left">混淆</td>
<td align="left">mangle<br>mangle.properties</td>
<td align="left">变量名缩短（默认启用）<br>混淆对象属性名（慎用！可能破坏代码逻辑）</td>
</tr>
<tr>
<td align="left">格式</td>
<td align="left">comments</td>
<td align="left">保留特定注释（如@license）</td>
</tr>
</tbody></table>
<p><strong>CSS压缩：cssnano高级策略</strong></p>
<p>cssnano（通过css-minimizer-webpack-plugin集成）提供智能样式压缩：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">CssMinimizerPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;css-minimizer-webpack-plugin&#x27;</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">optimization</span>: &#123;<br>    <span class="hljs-attr">minimizer</span>: [<br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">CssMinimizerPlugin</span>(&#123;<br>        <span class="hljs-attr">parallel</span>: <span class="hljs-number">4</span>, <span class="hljs-comment">// 指定4个进程</span><br>        <span class="hljs-attr">minimizerOptions</span>: &#123;<br>          <span class="hljs-attr">preset</span>: [<br>            <span class="hljs-string">&#x27;advanced&#x27;</span>, <span class="hljs-comment">// 启用高级优化</span><br>            &#123; <br>              <span class="hljs-attr">discardComments</span>: &#123; <span class="hljs-attr">removeAll</span>: <span class="hljs-literal">true</span> &#125;,<br>              <span class="hljs-attr">normalizeUrl</span>: &#123; <span class="hljs-attr">stripWWW</span>: <span class="hljs-literal">false</span> &#125; <span class="hljs-comment">// 保留www域名</span><br>            &#125;<br>          ]<br>        &#125;<br>      &#125;)<br>    ]<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>cssnano优化规则示例：</p>
<table>
<thead>
<tr>
<th align="left">优化类型</th>
<th align="left">原始样式</th>
<th align="left">压缩后</th>
<th align="left">节省字节</th>
</tr>
</thead>
<tbody><tr>
<td align="left">颜色简化</td>
<td align="left">color: #ff0000;</td>
<td align="left">color:red;</td>
<td align="left">6 bytes</td>
</tr>
<tr>
<td align="left">单位简化</td>
<td align="left">padding: 0px 10px;</td>
<td align="left">padding:0 10px;</td>
<td align="left">2 bytes</td>
</tr>
<tr>
<td align="left">合并重复</td>
<td align="left">margin:10px; margin:5px</td>
<td align="left">margin:5px</td>
<td align="left">11 bytes</td>
</tr>
<tr>
<td align="left">删除过时前缀</td>
<td align="left">-webkit-border-radius</td>
<td align="left">border-radius</td>
<td align="left">9 bytes</td>
</tr>
</tbody></table>
<p><strong>压缩陷阱与解决方案</strong></p>
<p>(1) Source Map失效问题</p>
<p>现象：生产环境错误堆栈无法映射源码</p>
<p>解决：配置生成精准Source Map</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// Terser配置</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>(&#123;<br>  <span class="hljs-attr">sourceMap</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 必须启用</span><br>&#125;)<br><br><span class="hljs-comment">// Webpack总配置</span><br><span class="hljs-attr">devtool</span>: <span class="hljs-string">&#x27;hidden-source-map&#x27;</span> <span class="hljs-comment">// 生成map文件但不暴露给浏览器</span><br></code></pre></td></tr></table></figure>

<p>(2) 混淆导致样式异常</p>
<p>案例：CSS Modules类名被压缩破坏</p>
<p>解决：安全混淆配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>(&#123;<br>  <span class="hljs-attr">terserOptions</span>: &#123;<br>    <span class="hljs-attr">mangle</span>: &#123;<br>      <span class="hljs-attr">properties</span>: &#123;<br>        <span class="hljs-attr">reserved</span>: [<span class="hljs-string">&#x27;_className&#x27;</span>] <span class="hljs-comment">// 保留特定属性名</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>(3) 压缩引发框架Bug</p>
<p>案例：Vue响应式系统因属性混淆失效</p>
<p>解决：禁用属性混淆</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-attr">mangle</span>: &#123;<br>  <span class="hljs-attr">properties</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 关闭属性混淆</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>企业级优化实践</strong></p>
<p>(1) 差异化压缩策略</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 根据环境动态配置</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">env</span>) =&gt;</span> (&#123;<br>  <span class="hljs-attr">optimization</span>: &#123;<br>    <span class="hljs-attr">minimizer</span>: env.<span class="hljs-property">production</span> ? [<br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>(&#123; <span class="hljs-comment">/* 生产配置 */</span> &#125;),<br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">CssMinimizerPlugin</span>()<br>    ] : []<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>(2) 定制删除规则（如多语言项目）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 删除特定语言的代码块</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>(&#123;<br>  <span class="hljs-attr">terserOptions</span>: &#123;<br>    <span class="hljs-attr">compress</span>: &#123;<br>      <span class="hljs-attr">global_defs</span>: &#123;<br>        <span class="hljs-comment">// 删除__DEV__代码块</span><br>        <span class="hljs-attr">__DEV__</span>: <span class="hljs-literal">false</span>,<br>        <span class="hljs-comment">// 删除中文注释（需配合自定义插件）</span><br>        <span class="hljs-attr">__LANG_CN__</span>: <span class="hljs-literal">false</span>  <br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>(3) 压缩率监控（接入CI）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 安装体积分析插件</span><br>npm install --save-dev size-limit<br></code></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JSON"># package.json<br><span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;size-limit&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p><strong>面试要点</strong></p>
<p>Q1：Terser与UglifyJS核心区别</p>
<p>Terser支持ES6+语法、多进程压缩、更精准的Tree Shaking</p>
<p>Q2：如何保留特定注释？</p>
<p>Terser中设置<code>format.comments: /@license/i，cssnano用discardComments: &#123; remove: (comment) =&gt; !comment.includes(&#39;!&#39;) &#125;</code></p>
<p>Q3：压缩导致线上Bug的排查思路</p>
<p>步骤：</p>
<ul>
<li>确认Source Map可还原堆栈</li>
<li>检查混淆配置是否影响框架运行时</li>
<li>通过<code>/*#__PURE__*/</code>标记副作用函数</li>
</ul>
<h1 id="四、高级特性与工程化"><a href="#四、高级特性与工程化" class="headerlink" title="四、高级特性与工程化"></a>四、高级特性与工程化</h1><h2 id="4-1-环境区分与动态配置"><a href="#4-1-环境区分与动态配置" class="headerlink" title="4.1 环境区分与动态配置"></a>4.1 环境区分与动态配置</h2><h3 id="4-1-1-基于webpack-merge的多环境配置"><a href="#4-1-1-基于webpack-merge的多环境配置" class="headerlink" title="4.1.1 基于webpack-merge的多环境配置"></a>4.1.1 基于<code>webpack-merge</code>的多环境配置</h3><h3 id="4-1-2-环境变量注入（dotenv与DefinePlugin结合）"><a href="#4-1-2-环境变量注入（dotenv与DefinePlugin结合）" class="headerlink" title="4.1.2 环境变量注入（dotenv与DefinePlugin结合）"></a>4.1.2 环境变量注入（<code>dotenv</code>与<code>DefinePlugin</code>结合）</h3><h2 id="4-2-微前端集成"><a href="#4-2-微前端集成" class="headerlink" title="4.2 微前端集成"></a>4.2 微前端集成</h2><h3 id="4-2-1-Module-Federation原理与配置"><a href="#4-2-1-Module-Federation原理与配置" class="headerlink" title="4.2.1 Module Federation原理与配置"></a>4.2.1 Module Federation原理与配置</h3><h3 id="4-2-2-跨应用共享模块策略"><a href="#4-2-2-跨应用共享模块策略" class="headerlink" title="4.2.2 跨应用共享模块策略"></a>4.2.2 跨应用共享模块策略</h3><h2 id="4-3-自定义构建流程"><a href="#4-3-自定义构建流程" class="headerlink" title="4.3 自定义构建流程"></a>4.3 自定义构建流程</h2><h3 id="4-3-1-编写CLI工具集成Webpack"><a href="#4-3-1-编写CLI工具集成Webpack" class="headerlink" title="4.3.1 编写CLI工具集成Webpack"></a>4.3.1 编写CLI工具集成Webpack</h3><h3 id="4-3-2-钩子函数深度使用（afterEmit-done）"><a href="#4-3-2-钩子函数深度使用（afterEmit-done）" class="headerlink" title="4.3.2 钩子函数深度使用（afterEmit&#x2F;done）"></a>4.3.2 钩子函数深度使用（<code>afterEmit</code>&#x2F;<code>done</code>）</h3><h1 id="五、调试与性能分析"><a href="#五、调试与性能分析" class="headerlink" title="五、调试与性能分析"></a>五、调试与性能分析</h1><h2 id="5-1-构建过程监控"><a href="#5-1-构建过程监控" class="headerlink" title="5.1 构建过程监控"></a>5.1 构建过程监控</h2><h3 id="5-1-1-speed-measure-webpack-plugin（构建耗时分析）"><a href="#5-1-1-speed-measure-webpack-plugin（构建耗时分析）" class="headerlink" title="5.1.1 speed-measure-webpack-plugin（构建耗时分析）"></a>5.1.1 <code>speed-measure-webpack-plugin</code>（构建耗时分析）</h3><h3 id="5-1-2-webpack-bundle-analyzer（产物体积可视化）"><a href="#5-1-2-webpack-bundle-analyzer（产物体积可视化）" class="headerlink" title="5.1.2 webpack-bundle-analyzer（产物体积可视化）"></a>5.1.2 <code>webpack-bundle-analyzer</code>（产物体积可视化）</h3><h2 id="5-2-DevServer深度配置"><a href="#5-2-DevServer深度配置" class="headerlink" title="5.2 DevServer深度配置"></a>5.2 DevServer深度配置</h2><h3 id="5-2-1-HMR原理与热更新范围控制"><a href="#5-2-1-HMR原理与热更新范围控制" class="headerlink" title="5.2.1 HMR原理与热更新范围控制"></a>5.2.1 HMR原理与热更新范围控制</h3><h3 id="5-2-2-Proxy配置解决跨域（pathRewrite-context）"><a href="#5-2-2-Proxy配置解决跨域（pathRewrite-context）" class="headerlink" title="5.2.2 Proxy配置解决跨域（pathRewrite&#x2F;context）"></a>5.2.2 Proxy配置解决跨域（<code>pathRewrite</code>&#x2F;<code>context</code>）</h3><h3 id="5-2-3-中间件扩展（before-after钩子）"><a href="#5-2-3-中间件扩展（before-after钩子）" class="headerlink" title="5.2.3 中间件扩展（before&#x2F;after钩子）"></a>5.2.3 中间件扩展（<code>before</code>&#x2F;<code>after</code>钩子）</h3><h1 id="六、原理与源码层"><a href="#六、原理与源码层" class="headerlink" title="六、原理与源码层"></a>六、原理与源码层</h1><h2 id="6-1-Tapable事件流机制"><a href="#6-1-Tapable事件流机制" class="headerlink" title="6.1 Tapable事件流机制"></a>6.1 Tapable事件流机制</h2><h3 id="6-1-1-同步-异步钩子调用流程"><a href="#6-1-1-同步-异步钩子调用流程" class="headerlink" title="6.1.1 同步&#x2F;异步钩子调用流程"></a>6.1.1 同步&#x2F;异步钩子调用流程</h3><h3 id="6-1-2-插件注册与触发原理"><a href="#6-1-2-插件注册与触发原理" class="headerlink" title="6.1.2 插件注册与触发原理"></a>6.1.2 插件注册与触发原理</h3><h2 id="6-2-AST应用"><a href="#6-2-AST应用" class="headerlink" title="6.2 AST应用"></a>6.2 AST应用</h2><h3 id="6-2-1-Loader中的AST操作（Babel-Parser案例）"><a href="#6-2-1-Loader中的AST操作（Babel-Parser案例）" class="headerlink" title="6.2.1 Loader中的AST操作（Babel Parser案例）"></a>6.2.1 Loader中的AST操作（Babel Parser案例）</h3><h3 id="6-2-2-依赖图（Dependency-Graph）生成过程"><a href="#6-2-2-依赖图（Dependency-Graph）生成过程" class="headerlink" title="6.2.2 依赖图（Dependency Graph）生成过程"></a>6.2.2 依赖图（Dependency Graph）生成过程</h3><h2 id="6-3-核心流程源码解析"><a href="#6-3-核心流程源码解析" class="headerlink" title="6.3 核心流程源码解析"></a>6.3 核心流程源码解析</h2><h3 id="6-3-1-编译阶段：Module-→-Chunk-→-Asset-转换"><a href="#6-3-1-编译阶段：Module-→-Chunk-→-Asset-转换" class="headerlink" title="6.3.1 编译阶段：Module → Chunk → Asset 转换"></a>6.3.1 编译阶段：Module → Chunk → Asset 转换</h3><h3 id="6-3-2-输出阶段：Template渲染与文件生成"><a href="#6-3-2-输出阶段：Template渲染与文件生成" class="headerlink" title="6.3.2 输出阶段：Template渲染与文件生成"></a>6.3.2 输出阶段：Template渲染与文件生成</h3><h1 id="七、生态与未来趋势"><a href="#七、生态与未来趋势" class="headerlink" title="七、生态与未来趋势"></a>七、生态与未来趋势</h1><h2 id="7-1-Webpack-5-新特性"><a href="#7-1-Webpack-5-新特性" class="headerlink" title="7.1 Webpack 5 新特性"></a>7.1 Webpack 5 新特性</h2><h3 id="7-1-1-持久化缓存（persistentCache）"><a href="#7-1-1-持久化缓存（persistentCache）" class="headerlink" title="7.1.1 持久化缓存（persistentCache）"></a>7.1.1 持久化缓存（<code>persistentCache</code>）</h3><h3 id="7-1-2-模块联邦（Module-Federation）"><a href="#7-1-2-模块联邦（Module-Federation）" class="headerlink" title="7.1.2 模块联邦（Module Federation）"></a>7.1.2 模块联邦（Module Federation）</h3><h3 id="7-1-3-Asset-Modules资源处理"><a href="#7-1-3-Asset-Modules资源处理" class="headerlink" title="7.1.3 Asset Modules资源处理"></a>7.1.3 Asset Modules资源处理</h3><h2 id="7-2-与新兴工具协作"><a href="#7-2-与新兴工具协作" class="headerlink" title="7.2 与新兴工具协作"></a>7.2 与新兴工具协作</h2><h3 id="7-2-1-Webpack-Vite-混合开发模式"><a href="#7-2-1-Webpack-Vite-混合开发模式" class="headerlink" title="7.2.1 Webpack + Vite 混合开发模式"></a>7.2.1 Webpack + Vite 混合开发模式</h3><h3 id="7-2-2-Rust工具链集成（swc-loader替代Babel）"><a href="#7-2-2-Rust工具链集成（swc-loader替代Babel）" class="headerlink" title="7.2.2 Rust工具链集成（swc-loader替代Babel）"></a>7.2.2 Rust工具链集成（<code>swc-loader</code>替代Babel）</h3><hr>
<h1 id="八、面试专项准备建议"><a href="#八、面试专项准备建议" class="headerlink" title="八、面试专项准备建议"></a>八、面试专项准备建议</h1><h2 id="8-1-高频考点"><a href="#8-1-高频考点" class="headerlink" title="8.1 高频考点"></a>8.1 高频考点</h2><h3 id="8-1-1-Tree-Shaking条件与副作用处理"><a href="#8-1-1-Tree-Shaking条件与副作用处理" class="headerlink" title="8.1.1 Tree Shaking条件与副作用处理"></a>8.1.1 Tree Shaking条件与副作用处理</h3><h3 id="8-1-2-SplitChunks配置项优先级"><a href="#8-1-2-SplitChunks配置项优先级" class="headerlink" title="8.1.2 SplitChunks配置项优先级"></a>8.1.2 SplitChunks配置项优先级</h3><h3 id="8-1-3-HMR工作流程（WebSocket-→-HotModuleReplacementPlugin）"><a href="#8-1-3-HMR工作流程（WebSocket-→-HotModuleReplacementPlugin）" class="headerlink" title="8.1.3 HMR工作流程（WebSocket → HotModuleReplacementPlugin）"></a>8.1.3 HMR工作流程（WebSocket → HotModuleReplacementPlugin）</h3><h2 id="8-2-场景设计题"><a href="#8-2-场景设计题" class="headerlink" title="8.2 场景设计题"></a>8.2 场景设计题</h2><h3 id="8-2-1-“如何实现秒级构建的微前端项目？”"><a href="#8-2-1-“如何实现秒级构建的微前端项目？”" class="headerlink" title="8.2.1 “如何实现秒级构建的微前端项目？”"></a>8.2.1 “如何实现秒级构建的微前端项目？”</h3><h3 id="8-2-2-“首屏加载慢，从哪些维度优化？”"><a href="#8-2-2-“首屏加载慢，从哪些维度优化？”" class="headerlink" title="8.2.2 “首屏加载慢，从哪些维度优化？”"></a>8.2.2 “首屏加载慢，从哪些维度优化？”</h3><h2 id="8-3-原理深挖"><a href="#8-3-原理深挖" class="headerlink" title="8.3 原理深挖"></a>8.3 原理深挖</h2><h3 id="8-3-1-手写简易Webpack核心流程（解析依赖→生成Chunk）"><a href="#8-3-1-手写简易Webpack核心流程（解析依赖→生成Chunk）" class="headerlink" title="8.3.1 手写简易Webpack核心流程（解析依赖→生成Chunk）"></a>8.3.1 手写简易Webpack核心流程（解析依赖→生成Chunk）</h3><h3 id="8-3-2-对比Webpack与Vite的Bundleless设计差异"><a href="#8-3-2-对比Webpack与Vite的Bundleless设计差异" class="headerlink" title="8.3.2 对比Webpack与Vite的Bundleless设计差异"></a>8.3.2 对比Webpack与Vite的Bundleless设计差异</h3><hr>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Webpack/" class="category-chain-item">Webpack</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Webpack/" class="print-no-link">#Webpack</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Webpack 专题知识学习</div>
      <div>https://tianfei92.github.io/2025/07/03/Webpack Notes/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Ariel</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年7月3日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/06/29/Performance%20Optimization/" title="前端性能优化知识专题学习">
                        <span class="hidden-mobile">前端性能优化知识专题学习</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  



  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.utils.listenDOMLoaded(function() {
      Fluid.events.registerRefreshCallback(function() {
        if ('mermaid' in window) {
          mermaid.init();
        }
      });
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
